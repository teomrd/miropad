(()=>{var qte=Object.create;var ng=Object.defineProperty;var Gte=Object.getOwnPropertyDescriptor;var jte=Object.getOwnPropertyNames;var Wte=Object.getPrototypeOf,Yte=Object.prototype.hasOwnProperty;var Qte=(r,e,t)=>e in r?ng(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ed=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var B=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),zt=(r,e)=>{for(var t in e)ng(r,t,{get:e[t],enumerable:!0})},Xte=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of jte(e))!Yte.call(r,i)&&i!==t&&ng(r,i,{get:()=>e[i],enumerable:!(n=Gte(e,i))||n.enumerable});return r};var C=(r,e,t)=>(t=r!=null?qte(Wte(r)):{},Xte(e||!r||!r.__esModule?ng(t,"default",{value:r,enumerable:!0}):t,r));var td=(r,e,t)=>(Qte(r,typeof e!="symbol"?e+"":e,t),t),IA=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var Ec=(r,e,t)=>(IA(r,e,"read from private field"),t?t.call(r):e.get(r)),ig=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},ua=(r,e,t,n)=>(IA(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),qw=(r,e,t,n)=>({set _(i){ua(r,e,i,t)},get _(){return Ec(r,e,n)}});var cI=B((aI,pg)=>{(function(){function r(p){"use strict";var g={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `\xAB\xAB\xAB` and `\xBB\xBB\xBB` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(p===!1)return JSON.parse(JSON.stringify(g));var y={};for(var E in g)g.hasOwnProperty(E)&&(y[E]=g[E].defaultValue);return y}function e(){"use strict";var p=r(!0),g={};for(var y in p)p.hasOwnProperty(y)&&(g[y]=!0);return g}var t={},n={},i={},s=r(!0),o="vanilla",a={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:r(!0),allOn:e()};t.helper={},t.extensions={},t.setOption=function(p,g){"use strict";return s[p]=g,this},t.getOption=function(p){"use strict";return s[p]},t.getOptions=function(){"use strict";return s},t.resetOptions=function(){"use strict";s=r(!0)},t.setFlavor=function(p){"use strict";if(!a.hasOwnProperty(p))throw Error(p+" flavor was not found");t.resetOptions();var g=a[p];o=p;for(var y in g)g.hasOwnProperty(y)&&(s[y]=g[y])},t.getFlavor=function(){"use strict";return o},t.getFlavorOptions=function(p){"use strict";if(a.hasOwnProperty(p))return a[p]},t.getDefaultOptions=function(p){"use strict";return r(p)},t.subParser=function(p,g){"use strict";if(t.helper.isString(p))if(typeof g<"u")n[p]=g;else{if(n.hasOwnProperty(p))return n[p];throw Error("SubParser named "+p+" not registered!")}},t.extension=function(p,g){"use strict";if(!t.helper.isString(p))throw Error("Extension 'name' must be a string");if(p=t.helper.stdExtName(p),t.helper.isUndefined(g)){if(!i.hasOwnProperty(p))throw Error("Extension named "+p+" is not registered!");return i[p]}else{typeof g=="function"&&(g=g()),t.helper.isArray(g)||(g=[g]);var y=c(g,p);if(y.valid)i[p]=g;else throw Error(y.error)}},t.getAllExtensions=function(){"use strict";return i},t.removeExtension=function(p){"use strict";delete i[p]},t.resetExtensions=function(){"use strict";i={}};function c(p,g){"use strict";var y=g?"Error in "+g+" extension->":"Error in unnamed extension",E={valid:!0,error:""};t.helper.isArray(p)||(p=[p]);for(var _=0;_<p.length;++_){var x=y+" sub-extension "+_+": ",S=p[_];if(typeof S!="object")return E.valid=!1,E.error=x+"must be an object, but "+typeof S+" given",E;if(!t.helper.isString(S.type))return E.valid=!1,E.error=x+'property "type" must be a string, but '+typeof S.type+" given",E;var I=S.type=S.type.toLowerCase();if(I==="language"&&(I=S.type="lang"),I==="html"&&(I=S.type="output"),I!=="lang"&&I!=="output"&&I!=="listener")return E.valid=!1,E.error=x+"type "+I+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',E;if(I==="listener"){if(t.helper.isUndefined(S.listeners))return E.valid=!1,E.error=x+'. Extensions of type "listener" must have a property called "listeners"',E}else if(t.helper.isUndefined(S.filter)&&t.helper.isUndefined(S.regex))return E.valid=!1,E.error=x+I+' extensions must define either a "regex" property or a "filter" method',E;if(S.listeners){if(typeof S.listeners!="object")return E.valid=!1,E.error=x+'"listeners" property must be an object but '+typeof S.listeners+" given",E;for(var k in S.listeners)if(S.listeners.hasOwnProperty(k)&&typeof S.listeners[k]!="function")return E.valid=!1,E.error=x+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+k+" must be a function but "+typeof S.listeners[k]+" given",E}if(S.filter){if(typeof S.filter!="function")return E.valid=!1,E.error=x+'"filter" must be a function, but '+typeof S.filter+" given",E}else if(S.regex){if(t.helper.isString(S.regex)&&(S.regex=new RegExp(S.regex,"g")),!(S.regex instanceof RegExp))return E.valid=!1,E.error=x+'"regex" property must either be a string or a RegExp object, but '+typeof S.regex+" given",E;if(t.helper.isUndefined(S.replace))return E.valid=!1,E.error=x+'"regex" extensions must implement a replace string or function',E}}return E}t.validateExtension=function(p){"use strict";var g=c(p,null);return g.valid?!0:(console.warn(g.error),!1)},t.hasOwnProperty("helper")||(t.helper={}),t.helper.isString=function(p){"use strict";return typeof p=="string"||p instanceof String},t.helper.isFunction=function(p){"use strict";var g={};return p&&g.toString.call(p)==="[object Function]"},t.helper.isArray=function(p){"use strict";return Array.isArray(p)},t.helper.isUndefined=function(p){"use strict";return typeof p>"u"},t.helper.forEach=function(p,g){"use strict";if(t.helper.isUndefined(p))throw new Error("obj param is required");if(t.helper.isUndefined(g))throw new Error("callback param is required");if(!t.helper.isFunction(g))throw new Error("callback param must be a function/closure");if(typeof p.forEach=="function")p.forEach(g);else if(t.helper.isArray(p))for(var y=0;y<p.length;y++)g(p[y],y,p);else if(typeof p=="object")for(var E in p)p.hasOwnProperty(E)&&g(p[E],E,p);else throw new Error("obj does not seem to be an array or an iterable object")},t.helper.stdExtName=function(p){"use strict";return p.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function u(p,g){"use strict";var y=g.charCodeAt(0);return"\xA8E"+y+"E"}t.helper.escapeCharactersCallback=u,t.helper.escapeCharacters=function(p,g,y){"use strict";var E="(["+g.replace(/([\[\]\\])/g,"\\$1")+"])";y&&(E="\\\\"+E);var _=new RegExp(E,"g");return p=p.replace(_,u),p},t.helper.unescapeHTMLEntities=function(p){"use strict";return p.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var l=function(p,g,y,E){"use strict";var _=E||"",x=_.indexOf("g")>-1,S=new RegExp(g+"|"+y,"g"+_.replace(/g/g,"")),I=new RegExp(g,_.replace(/g/g,"")),k=[],N,L,G,R,K;do for(N=0;G=S.exec(p);)if(I.test(G[0]))N++||(L=S.lastIndex,R=L-G[0].length);else if(N&&!--N){K=G.index+G[0].length;var F={left:{start:R,end:L},match:{start:L,end:G.index},right:{start:G.index,end:K},wholeMatch:{start:R,end:K}};if(k.push(F),!x)return k}while(N&&(S.lastIndex=L));return k};t.helper.matchRecursiveRegExp=function(p,g,y,E){"use strict";for(var _=l(p,g,y,E),x=[],S=0;S<_.length;++S)x.push([p.slice(_[S].wholeMatch.start,_[S].wholeMatch.end),p.slice(_[S].match.start,_[S].match.end),p.slice(_[S].left.start,_[S].left.end),p.slice(_[S].right.start,_[S].right.end)]);return x},t.helper.replaceRecursiveRegExp=function(p,g,y,E,_){"use strict";if(!t.helper.isFunction(g)){var x=g;g=function(){return x}}var S=l(p,y,E,_),I=p,k=S.length;if(k>0){var N=[];S[0].wholeMatch.start!==0&&N.push(p.slice(0,S[0].wholeMatch.start));for(var L=0;L<k;++L)N.push(g(p.slice(S[L].wholeMatch.start,S[L].wholeMatch.end),p.slice(S[L].match.start,S[L].match.end),p.slice(S[L].left.start,S[L].left.end),p.slice(S[L].right.start,S[L].right.end))),L<k-1&&N.push(p.slice(S[L].wholeMatch.end,S[L+1].wholeMatch.start));S[k-1].wholeMatch.end<p.length&&N.push(p.slice(S[k-1].wholeMatch.end)),I=N.join("")}return I},t.helper.regexIndexOf=function(p,g,y){"use strict";if(!t.helper.isString(p))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(g instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var E=p.substring(y||0).search(g);return E>=0?E+(y||0):E},t.helper.splitAtIndex=function(p,g){"use strict";if(!t.helper.isString(p))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[p.substring(0,g),p.substring(g)]},t.helper.encodeEmailAddress=function(p){"use strict";var g=[function(y){return"&#"+y.charCodeAt(0)+";"},function(y){return"&#x"+y.charCodeAt(0).toString(16)+";"},function(y){return y}];return p=p.replace(/./g,function(y){if(y==="@")y=g[Math.floor(Math.random()*2)](y);else{var E=Math.random();y=E>.9?g[2](y):E>.45?g[1](y):g[0](y)}return y}),p},t.helper.padEnd=function(g,y,E){"use strict";return y=y>>0,E=String(E||" "),g.length>y?String(g):(y=y-g.length,y>E.length&&(E+=E.repeat(y/E.length)),String(g)+E.slice(0,y))},typeof console>"u"&&(console={warn:function(p){"use strict";alert(p)},log:function(p){"use strict";alert(p)},error:function(p){"use strict";throw p}}),t.helper.regexes={asteriskDashAndColon:/([*_:~])/g},t.helper.emojis={"+1":"\u{1F44D}","-1":"\u{1F44E}",100:"\u{1F4AF}",1234:"\u{1F522}","1st_place_medal":"\u{1F947}","2nd_place_medal":"\u{1F948}","3rd_place_medal":"\u{1F949}","8ball":"\u{1F3B1}",a:"\u{1F170}\uFE0F",ab:"\u{1F18E}",abc:"\u{1F524}",abcd:"\u{1F521}",accept:"\u{1F251}",aerial_tramway:"\u{1F6A1}",airplane:"\u2708\uFE0F",alarm_clock:"\u23F0",alembic:"\u2697\uFE0F",alien:"\u{1F47D}",ambulance:"\u{1F691}",amphora:"\u{1F3FA}",anchor:"\u2693\uFE0F",angel:"\u{1F47C}",anger:"\u{1F4A2}",angry:"\u{1F620}",anguished:"\u{1F627}",ant:"\u{1F41C}",apple:"\u{1F34E}",aquarius:"\u2652\uFE0F",aries:"\u2648\uFE0F",arrow_backward:"\u25C0\uFE0F",arrow_double_down:"\u23EC",arrow_double_up:"\u23EB",arrow_down:"\u2B07\uFE0F",arrow_down_small:"\u{1F53D}",arrow_forward:"\u25B6\uFE0F",arrow_heading_down:"\u2935\uFE0F",arrow_heading_up:"\u2934\uFE0F",arrow_left:"\u2B05\uFE0F",arrow_lower_left:"\u2199\uFE0F",arrow_lower_right:"\u2198\uFE0F",arrow_right:"\u27A1\uFE0F",arrow_right_hook:"\u21AA\uFE0F",arrow_up:"\u2B06\uFE0F",arrow_up_down:"\u2195\uFE0F",arrow_up_small:"\u{1F53C}",arrow_upper_left:"\u2196\uFE0F",arrow_upper_right:"\u2197\uFE0F",arrows_clockwise:"\u{1F503}",arrows_counterclockwise:"\u{1F504}",art:"\u{1F3A8}",articulated_lorry:"\u{1F69B}",artificial_satellite:"\u{1F6F0}",astonished:"\u{1F632}",athletic_shoe:"\u{1F45F}",atm:"\u{1F3E7}",atom_symbol:"\u269B\uFE0F",avocado:"\u{1F951}",b:"\u{1F171}\uFE0F",baby:"\u{1F476}",baby_bottle:"\u{1F37C}",baby_chick:"\u{1F424}",baby_symbol:"\u{1F6BC}",back:"\u{1F519}",bacon:"\u{1F953}",badminton:"\u{1F3F8}",baggage_claim:"\u{1F6C4}",baguette_bread:"\u{1F956}",balance_scale:"\u2696\uFE0F",balloon:"\u{1F388}",ballot_box:"\u{1F5F3}",ballot_box_with_check:"\u2611\uFE0F",bamboo:"\u{1F38D}",banana:"\u{1F34C}",bangbang:"\u203C\uFE0F",bank:"\u{1F3E6}",bar_chart:"\u{1F4CA}",barber:"\u{1F488}",baseball:"\u26BE\uFE0F",basketball:"\u{1F3C0}",basketball_man:"\u26F9\uFE0F",basketball_woman:"\u26F9\uFE0F&zwj;\u2640\uFE0F",bat:"\u{1F987}",bath:"\u{1F6C0}",bathtub:"\u{1F6C1}",battery:"\u{1F50B}",beach_umbrella:"\u{1F3D6}",bear:"\u{1F43B}",bed:"\u{1F6CF}",bee:"\u{1F41D}",beer:"\u{1F37A}",beers:"\u{1F37B}",beetle:"\u{1F41E}",beginner:"\u{1F530}",bell:"\u{1F514}",bellhop_bell:"\u{1F6CE}",bento:"\u{1F371}",biking_man:"\u{1F6B4}",bike:"\u{1F6B2}",biking_woman:"\u{1F6B4}&zwj;\u2640\uFE0F",bikini:"\u{1F459}",biohazard:"\u2623\uFE0F",bird:"\u{1F426}",birthday:"\u{1F382}",black_circle:"\u26AB\uFE0F",black_flag:"\u{1F3F4}",black_heart:"\u{1F5A4}",black_joker:"\u{1F0CF}",black_large_square:"\u2B1B\uFE0F",black_medium_small_square:"\u25FE\uFE0F",black_medium_square:"\u25FC\uFE0F",black_nib:"\u2712\uFE0F",black_small_square:"\u25AA\uFE0F",black_square_button:"\u{1F532}",blonde_man:"\u{1F471}",blonde_woman:"\u{1F471}&zwj;\u2640\uFE0F",blossom:"\u{1F33C}",blowfish:"\u{1F421}",blue_book:"\u{1F4D8}",blue_car:"\u{1F699}",blue_heart:"\u{1F499}",blush:"\u{1F60A}",boar:"\u{1F417}",boat:"\u26F5\uFE0F",bomb:"\u{1F4A3}",book:"\u{1F4D6}",bookmark:"\u{1F516}",bookmark_tabs:"\u{1F4D1}",books:"\u{1F4DA}",boom:"\u{1F4A5}",boot:"\u{1F462}",bouquet:"\u{1F490}",bowing_man:"\u{1F647}",bow_and_arrow:"\u{1F3F9}",bowing_woman:"\u{1F647}&zwj;\u2640\uFE0F",bowling:"\u{1F3B3}",boxing_glove:"\u{1F94A}",boy:"\u{1F466}",bread:"\u{1F35E}",bride_with_veil:"\u{1F470}",bridge_at_night:"\u{1F309}",briefcase:"\u{1F4BC}",broken_heart:"\u{1F494}",bug:"\u{1F41B}",building_construction:"\u{1F3D7}",bulb:"\u{1F4A1}",bullettrain_front:"\u{1F685}",bullettrain_side:"\u{1F684}",burrito:"\u{1F32F}",bus:"\u{1F68C}",business_suit_levitating:"\u{1F574}",busstop:"\u{1F68F}",bust_in_silhouette:"\u{1F464}",busts_in_silhouette:"\u{1F465}",butterfly:"\u{1F98B}",cactus:"\u{1F335}",cake:"\u{1F370}",calendar:"\u{1F4C6}",call_me_hand:"\u{1F919}",calling:"\u{1F4F2}",camel:"\u{1F42B}",camera:"\u{1F4F7}",camera_flash:"\u{1F4F8}",camping:"\u{1F3D5}",cancer:"\u264B\uFE0F",candle:"\u{1F56F}",candy:"\u{1F36C}",canoe:"\u{1F6F6}",capital_abcd:"\u{1F520}",capricorn:"\u2651\uFE0F",car:"\u{1F697}",card_file_box:"\u{1F5C3}",card_index:"\u{1F4C7}",card_index_dividers:"\u{1F5C2}",carousel_horse:"\u{1F3A0}",carrot:"\u{1F955}",cat:"\u{1F431}",cat2:"\u{1F408}",cd:"\u{1F4BF}",chains:"\u26D3",champagne:"\u{1F37E}",chart:"\u{1F4B9}",chart_with_downwards_trend:"\u{1F4C9}",chart_with_upwards_trend:"\u{1F4C8}",checkered_flag:"\u{1F3C1}",cheese:"\u{1F9C0}",cherries:"\u{1F352}",cherry_blossom:"\u{1F338}",chestnut:"\u{1F330}",chicken:"\u{1F414}",children_crossing:"\u{1F6B8}",chipmunk:"\u{1F43F}",chocolate_bar:"\u{1F36B}",christmas_tree:"\u{1F384}",church:"\u26EA\uFE0F",cinema:"\u{1F3A6}",circus_tent:"\u{1F3AA}",city_sunrise:"\u{1F307}",city_sunset:"\u{1F306}",cityscape:"\u{1F3D9}",cl:"\u{1F191}",clamp:"\u{1F5DC}",clap:"\u{1F44F}",clapper:"\u{1F3AC}",classical_building:"\u{1F3DB}",clinking_glasses:"\u{1F942}",clipboard:"\u{1F4CB}",clock1:"\u{1F550}",clock10:"\u{1F559}",clock1030:"\u{1F565}",clock11:"\u{1F55A}",clock1130:"\u{1F566}",clock12:"\u{1F55B}",clock1230:"\u{1F567}",clock130:"\u{1F55C}",clock2:"\u{1F551}",clock230:"\u{1F55D}",clock3:"\u{1F552}",clock330:"\u{1F55E}",clock4:"\u{1F553}",clock430:"\u{1F55F}",clock5:"\u{1F554}",clock530:"\u{1F560}",clock6:"\u{1F555}",clock630:"\u{1F561}",clock7:"\u{1F556}",clock730:"\u{1F562}",clock8:"\u{1F557}",clock830:"\u{1F563}",clock9:"\u{1F558}",clock930:"\u{1F564}",closed_book:"\u{1F4D5}",closed_lock_with_key:"\u{1F510}",closed_umbrella:"\u{1F302}",cloud:"\u2601\uFE0F",cloud_with_lightning:"\u{1F329}",cloud_with_lightning_and_rain:"\u26C8",cloud_with_rain:"\u{1F327}",cloud_with_snow:"\u{1F328}",clown_face:"\u{1F921}",clubs:"\u2663\uFE0F",cocktail:"\u{1F378}",coffee:"\u2615\uFE0F",coffin:"\u26B0\uFE0F",cold_sweat:"\u{1F630}",comet:"\u2604\uFE0F",computer:"\u{1F4BB}",computer_mouse:"\u{1F5B1}",confetti_ball:"\u{1F38A}",confounded:"\u{1F616}",confused:"\u{1F615}",congratulations:"\u3297\uFE0F",construction:"\u{1F6A7}",construction_worker_man:"\u{1F477}",construction_worker_woman:"\u{1F477}&zwj;\u2640\uFE0F",control_knobs:"\u{1F39B}",convenience_store:"\u{1F3EA}",cookie:"\u{1F36A}",cool:"\u{1F192}",policeman:"\u{1F46E}",copyright:"\xA9\uFE0F",corn:"\u{1F33D}",couch_and_lamp:"\u{1F6CB}",couple:"\u{1F46B}",couple_with_heart_woman_man:"\u{1F491}",couple_with_heart_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F468}",couple_with_heart_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F469}",couplekiss_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F468}",couplekiss_man_woman:"\u{1F48F}",couplekiss_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F469}",cow:"\u{1F42E}",cow2:"\u{1F404}",cowboy_hat_face:"\u{1F920}",crab:"\u{1F980}",crayon:"\u{1F58D}",credit_card:"\u{1F4B3}",crescent_moon:"\u{1F319}",cricket:"\u{1F3CF}",crocodile:"\u{1F40A}",croissant:"\u{1F950}",crossed_fingers:"\u{1F91E}",crossed_flags:"\u{1F38C}",crossed_swords:"\u2694\uFE0F",crown:"\u{1F451}",cry:"\u{1F622}",crying_cat_face:"\u{1F63F}",crystal_ball:"\u{1F52E}",cucumber:"\u{1F952}",cupid:"\u{1F498}",curly_loop:"\u27B0",currency_exchange:"\u{1F4B1}",curry:"\u{1F35B}",custard:"\u{1F36E}",customs:"\u{1F6C3}",cyclone:"\u{1F300}",dagger:"\u{1F5E1}",dancer:"\u{1F483}",dancing_women:"\u{1F46F}",dancing_men:"\u{1F46F}&zwj;\u2642\uFE0F",dango:"\u{1F361}",dark_sunglasses:"\u{1F576}",dart:"\u{1F3AF}",dash:"\u{1F4A8}",date:"\u{1F4C5}",deciduous_tree:"\u{1F333}",deer:"\u{1F98C}",department_store:"\u{1F3EC}",derelict_house:"\u{1F3DA}",desert:"\u{1F3DC}",desert_island:"\u{1F3DD}",desktop_computer:"\u{1F5A5}",male_detective:"\u{1F575}\uFE0F",diamond_shape_with_a_dot_inside:"\u{1F4A0}",diamonds:"\u2666\uFE0F",disappointed:"\u{1F61E}",disappointed_relieved:"\u{1F625}",dizzy:"\u{1F4AB}",dizzy_face:"\u{1F635}",do_not_litter:"\u{1F6AF}",dog:"\u{1F436}",dog2:"\u{1F415}",dollar:"\u{1F4B5}",dolls:"\u{1F38E}",dolphin:"\u{1F42C}",door:"\u{1F6AA}",doughnut:"\u{1F369}",dove:"\u{1F54A}",dragon:"\u{1F409}",dragon_face:"\u{1F432}",dress:"\u{1F457}",dromedary_camel:"\u{1F42A}",drooling_face:"\u{1F924}",droplet:"\u{1F4A7}",drum:"\u{1F941}",duck:"\u{1F986}",dvd:"\u{1F4C0}","e-mail":"\u{1F4E7}",eagle:"\u{1F985}",ear:"\u{1F442}",ear_of_rice:"\u{1F33E}",earth_africa:"\u{1F30D}",earth_americas:"\u{1F30E}",earth_asia:"\u{1F30F}",egg:"\u{1F95A}",eggplant:"\u{1F346}",eight_pointed_black_star:"\u2734\uFE0F",eight_spoked_asterisk:"\u2733\uFE0F",electric_plug:"\u{1F50C}",elephant:"\u{1F418}",email:"\u2709\uFE0F",end:"\u{1F51A}",envelope_with_arrow:"\u{1F4E9}",euro:"\u{1F4B6}",european_castle:"\u{1F3F0}",european_post_office:"\u{1F3E4}",evergreen_tree:"\u{1F332}",exclamation:"\u2757\uFE0F",expressionless:"\u{1F611}",eye:"\u{1F441}",eye_speech_bubble:"\u{1F441}&zwj;\u{1F5E8}",eyeglasses:"\u{1F453}",eyes:"\u{1F440}",face_with_head_bandage:"\u{1F915}",face_with_thermometer:"\u{1F912}",fist_oncoming:"\u{1F44A}",factory:"\u{1F3ED}",fallen_leaf:"\u{1F342}",family_man_woman_boy:"\u{1F46A}",family_man_boy:"\u{1F468}&zwj;\u{1F466}",family_man_boy_boy:"\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_girl:"\u{1F468}&zwj;\u{1F467}",family_man_girl_boy:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_girl_girl:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_man_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}",family_man_man_boy_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_man_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}",family_man_man_girl_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_man_girl_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_woman_boy_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_woman_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}",family_man_woman_girl_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_woman_girl_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_boy:"\u{1F469}&zwj;\u{1F466}",family_woman_boy_boy:"\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_girl:"\u{1F469}&zwj;\u{1F467}",family_woman_girl_boy:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_girl_girl:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_woman_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}",family_woman_woman_boy_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_woman_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}",family_woman_woman_girl_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_woman_girl_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",fast_forward:"\u23E9",fax:"\u{1F4E0}",fearful:"\u{1F628}",feet:"\u{1F43E}",female_detective:"\u{1F575}\uFE0F&zwj;\u2640\uFE0F",ferris_wheel:"\u{1F3A1}",ferry:"\u26F4",field_hockey:"\u{1F3D1}",file_cabinet:"\u{1F5C4}",file_folder:"\u{1F4C1}",film_projector:"\u{1F4FD}",film_strip:"\u{1F39E}",fire:"\u{1F525}",fire_engine:"\u{1F692}",fireworks:"\u{1F386}",first_quarter_moon:"\u{1F313}",first_quarter_moon_with_face:"\u{1F31B}",fish:"\u{1F41F}",fish_cake:"\u{1F365}",fishing_pole_and_fish:"\u{1F3A3}",fist_raised:"\u270A",fist_left:"\u{1F91B}",fist_right:"\u{1F91C}",flags:"\u{1F38F}",flashlight:"\u{1F526}",fleur_de_lis:"\u269C\uFE0F",flight_arrival:"\u{1F6EC}",flight_departure:"\u{1F6EB}",floppy_disk:"\u{1F4BE}",flower_playing_cards:"\u{1F3B4}",flushed:"\u{1F633}",fog:"\u{1F32B}",foggy:"\u{1F301}",football:"\u{1F3C8}",footprints:"\u{1F463}",fork_and_knife:"\u{1F374}",fountain:"\u26F2\uFE0F",fountain_pen:"\u{1F58B}",four_leaf_clover:"\u{1F340}",fox_face:"\u{1F98A}",framed_picture:"\u{1F5BC}",free:"\u{1F193}",fried_egg:"\u{1F373}",fried_shrimp:"\u{1F364}",fries:"\u{1F35F}",frog:"\u{1F438}",frowning:"\u{1F626}",frowning_face:"\u2639\uFE0F",frowning_man:"\u{1F64D}&zwj;\u2642\uFE0F",frowning_woman:"\u{1F64D}",middle_finger:"\u{1F595}",fuelpump:"\u26FD\uFE0F",full_moon:"\u{1F315}",full_moon_with_face:"\u{1F31D}",funeral_urn:"\u26B1\uFE0F",game_die:"\u{1F3B2}",gear:"\u2699\uFE0F",gem:"\u{1F48E}",gemini:"\u264A\uFE0F",ghost:"\u{1F47B}",gift:"\u{1F381}",gift_heart:"\u{1F49D}",girl:"\u{1F467}",globe_with_meridians:"\u{1F310}",goal_net:"\u{1F945}",goat:"\u{1F410}",golf:"\u26F3\uFE0F",golfing_man:"\u{1F3CC}\uFE0F",golfing_woman:"\u{1F3CC}\uFE0F&zwj;\u2640\uFE0F",gorilla:"\u{1F98D}",grapes:"\u{1F347}",green_apple:"\u{1F34F}",green_book:"\u{1F4D7}",green_heart:"\u{1F49A}",green_salad:"\u{1F957}",grey_exclamation:"\u2755",grey_question:"\u2754",grimacing:"\u{1F62C}",grin:"\u{1F601}",grinning:"\u{1F600}",guardsman:"\u{1F482}",guardswoman:"\u{1F482}&zwj;\u2640\uFE0F",guitar:"\u{1F3B8}",gun:"\u{1F52B}",haircut_woman:"\u{1F487}",haircut_man:"\u{1F487}&zwj;\u2642\uFE0F",hamburger:"\u{1F354}",hammer:"\u{1F528}",hammer_and_pick:"\u2692",hammer_and_wrench:"\u{1F6E0}",hamster:"\u{1F439}",hand:"\u270B",handbag:"\u{1F45C}",handshake:"\u{1F91D}",hankey:"\u{1F4A9}",hatched_chick:"\u{1F425}",hatching_chick:"\u{1F423}",headphones:"\u{1F3A7}",hear_no_evil:"\u{1F649}",heart:"\u2764\uFE0F",heart_decoration:"\u{1F49F}",heart_eyes:"\u{1F60D}",heart_eyes_cat:"\u{1F63B}",heartbeat:"\u{1F493}",heartpulse:"\u{1F497}",hearts:"\u2665\uFE0F",heavy_check_mark:"\u2714\uFE0F",heavy_division_sign:"\u2797",heavy_dollar_sign:"\u{1F4B2}",heavy_heart_exclamation:"\u2763\uFE0F",heavy_minus_sign:"\u2796",heavy_multiplication_x:"\u2716\uFE0F",heavy_plus_sign:"\u2795",helicopter:"\u{1F681}",herb:"\u{1F33F}",hibiscus:"\u{1F33A}",high_brightness:"\u{1F506}",high_heel:"\u{1F460}",hocho:"\u{1F52A}",hole:"\u{1F573}",honey_pot:"\u{1F36F}",horse:"\u{1F434}",horse_racing:"\u{1F3C7}",hospital:"\u{1F3E5}",hot_pepper:"\u{1F336}",hotdog:"\u{1F32D}",hotel:"\u{1F3E8}",hotsprings:"\u2668\uFE0F",hourglass:"\u231B\uFE0F",hourglass_flowing_sand:"\u23F3",house:"\u{1F3E0}",house_with_garden:"\u{1F3E1}",houses:"\u{1F3D8}",hugs:"\u{1F917}",hushed:"\u{1F62F}",ice_cream:"\u{1F368}",ice_hockey:"\u{1F3D2}",ice_skate:"\u26F8",icecream:"\u{1F366}",id:"\u{1F194}",ideograph_advantage:"\u{1F250}",imp:"\u{1F47F}",inbox_tray:"\u{1F4E5}",incoming_envelope:"\u{1F4E8}",tipping_hand_woman:"\u{1F481}",information_source:"\u2139\uFE0F",innocent:"\u{1F607}",interrobang:"\u2049\uFE0F",iphone:"\u{1F4F1}",izakaya_lantern:"\u{1F3EE}",jack_o_lantern:"\u{1F383}",japan:"\u{1F5FE}",japanese_castle:"\u{1F3EF}",japanese_goblin:"\u{1F47A}",japanese_ogre:"\u{1F479}",jeans:"\u{1F456}",joy:"\u{1F602}",joy_cat:"\u{1F639}",joystick:"\u{1F579}",kaaba:"\u{1F54B}",key:"\u{1F511}",keyboard:"\u2328\uFE0F",keycap_ten:"\u{1F51F}",kick_scooter:"\u{1F6F4}",kimono:"\u{1F458}",kiss:"\u{1F48B}",kissing:"\u{1F617}",kissing_cat:"\u{1F63D}",kissing_closed_eyes:"\u{1F61A}",kissing_heart:"\u{1F618}",kissing_smiling_eyes:"\u{1F619}",kiwi_fruit:"\u{1F95D}",koala:"\u{1F428}",koko:"\u{1F201}",label:"\u{1F3F7}",large_blue_circle:"\u{1F535}",large_blue_diamond:"\u{1F537}",large_orange_diamond:"\u{1F536}",last_quarter_moon:"\u{1F317}",last_quarter_moon_with_face:"\u{1F31C}",latin_cross:"\u271D\uFE0F",laughing:"\u{1F606}",leaves:"\u{1F343}",ledger:"\u{1F4D2}",left_luggage:"\u{1F6C5}",left_right_arrow:"\u2194\uFE0F",leftwards_arrow_with_hook:"\u21A9\uFE0F",lemon:"\u{1F34B}",leo:"\u264C\uFE0F",leopard:"\u{1F406}",level_slider:"\u{1F39A}",libra:"\u264E\uFE0F",light_rail:"\u{1F688}",link:"\u{1F517}",lion:"\u{1F981}",lips:"\u{1F444}",lipstick:"\u{1F484}",lizard:"\u{1F98E}",lock:"\u{1F512}",lock_with_ink_pen:"\u{1F50F}",lollipop:"\u{1F36D}",loop:"\u27BF",loud_sound:"\u{1F50A}",loudspeaker:"\u{1F4E2}",love_hotel:"\u{1F3E9}",love_letter:"\u{1F48C}",low_brightness:"\u{1F505}",lying_face:"\u{1F925}",m:"\u24C2\uFE0F",mag:"\u{1F50D}",mag_right:"\u{1F50E}",mahjong:"\u{1F004}\uFE0F",mailbox:"\u{1F4EB}",mailbox_closed:"\u{1F4EA}",mailbox_with_mail:"\u{1F4EC}",mailbox_with_no_mail:"\u{1F4ED}",man:"\u{1F468}",man_artist:"\u{1F468}&zwj;\u{1F3A8}",man_astronaut:"\u{1F468}&zwj;\u{1F680}",man_cartwheeling:"\u{1F938}&zwj;\u2642\uFE0F",man_cook:"\u{1F468}&zwj;\u{1F373}",man_dancing:"\u{1F57A}",man_facepalming:"\u{1F926}&zwj;\u2642\uFE0F",man_factory_worker:"\u{1F468}&zwj;\u{1F3ED}",man_farmer:"\u{1F468}&zwj;\u{1F33E}",man_firefighter:"\u{1F468}&zwj;\u{1F692}",man_health_worker:"\u{1F468}&zwj;\u2695\uFE0F",man_in_tuxedo:"\u{1F935}",man_judge:"\u{1F468}&zwj;\u2696\uFE0F",man_juggling:"\u{1F939}&zwj;\u2642\uFE0F",man_mechanic:"\u{1F468}&zwj;\u{1F527}",man_office_worker:"\u{1F468}&zwj;\u{1F4BC}",man_pilot:"\u{1F468}&zwj;\u2708\uFE0F",man_playing_handball:"\u{1F93E}&zwj;\u2642\uFE0F",man_playing_water_polo:"\u{1F93D}&zwj;\u2642\uFE0F",man_scientist:"\u{1F468}&zwj;\u{1F52C}",man_shrugging:"\u{1F937}&zwj;\u2642\uFE0F",man_singer:"\u{1F468}&zwj;\u{1F3A4}",man_student:"\u{1F468}&zwj;\u{1F393}",man_teacher:"\u{1F468}&zwj;\u{1F3EB}",man_technologist:"\u{1F468}&zwj;\u{1F4BB}",man_with_gua_pi_mao:"\u{1F472}",man_with_turban:"\u{1F473}",tangerine:"\u{1F34A}",mans_shoe:"\u{1F45E}",mantelpiece_clock:"\u{1F570}",maple_leaf:"\u{1F341}",martial_arts_uniform:"\u{1F94B}",mask:"\u{1F637}",massage_woman:"\u{1F486}",massage_man:"\u{1F486}&zwj;\u2642\uFE0F",meat_on_bone:"\u{1F356}",medal_military:"\u{1F396}",medal_sports:"\u{1F3C5}",mega:"\u{1F4E3}",melon:"\u{1F348}",memo:"\u{1F4DD}",men_wrestling:"\u{1F93C}&zwj;\u2642\uFE0F",menorah:"\u{1F54E}",mens:"\u{1F6B9}",metal:"\u{1F918}",metro:"\u{1F687}",microphone:"\u{1F3A4}",microscope:"\u{1F52C}",milk_glass:"\u{1F95B}",milky_way:"\u{1F30C}",minibus:"\u{1F690}",minidisc:"\u{1F4BD}",mobile_phone_off:"\u{1F4F4}",money_mouth_face:"\u{1F911}",money_with_wings:"\u{1F4B8}",moneybag:"\u{1F4B0}",monkey:"\u{1F412}",monkey_face:"\u{1F435}",monorail:"\u{1F69D}",moon:"\u{1F314}",mortar_board:"\u{1F393}",mosque:"\u{1F54C}",motor_boat:"\u{1F6E5}",motor_scooter:"\u{1F6F5}",motorcycle:"\u{1F3CD}",motorway:"\u{1F6E3}",mount_fuji:"\u{1F5FB}",mountain:"\u26F0",mountain_biking_man:"\u{1F6B5}",mountain_biking_woman:"\u{1F6B5}&zwj;\u2640\uFE0F",mountain_cableway:"\u{1F6A0}",mountain_railway:"\u{1F69E}",mountain_snow:"\u{1F3D4}",mouse:"\u{1F42D}",mouse2:"\u{1F401}",movie_camera:"\u{1F3A5}",moyai:"\u{1F5FF}",mrs_claus:"\u{1F936}",muscle:"\u{1F4AA}",mushroom:"\u{1F344}",musical_keyboard:"\u{1F3B9}",musical_note:"\u{1F3B5}",musical_score:"\u{1F3BC}",mute:"\u{1F507}",nail_care:"\u{1F485}",name_badge:"\u{1F4DB}",national_park:"\u{1F3DE}",nauseated_face:"\u{1F922}",necktie:"\u{1F454}",negative_squared_cross_mark:"\u274E",nerd_face:"\u{1F913}",neutral_face:"\u{1F610}",new:"\u{1F195}",new_moon:"\u{1F311}",new_moon_with_face:"\u{1F31A}",newspaper:"\u{1F4F0}",newspaper_roll:"\u{1F5DE}",next_track_button:"\u23ED",ng:"\u{1F196}",no_good_man:"\u{1F645}&zwj;\u2642\uFE0F",no_good_woman:"\u{1F645}",night_with_stars:"\u{1F303}",no_bell:"\u{1F515}",no_bicycles:"\u{1F6B3}",no_entry:"\u26D4\uFE0F",no_entry_sign:"\u{1F6AB}",no_mobile_phones:"\u{1F4F5}",no_mouth:"\u{1F636}",no_pedestrians:"\u{1F6B7}",no_smoking:"\u{1F6AD}","non-potable_water":"\u{1F6B1}",nose:"\u{1F443}",notebook:"\u{1F4D3}",notebook_with_decorative_cover:"\u{1F4D4}",notes:"\u{1F3B6}",nut_and_bolt:"\u{1F529}",o:"\u2B55\uFE0F",o2:"\u{1F17E}\uFE0F",ocean:"\u{1F30A}",octopus:"\u{1F419}",oden:"\u{1F362}",office:"\u{1F3E2}",oil_drum:"\u{1F6E2}",ok:"\u{1F197}",ok_hand:"\u{1F44C}",ok_man:"\u{1F646}&zwj;\u2642\uFE0F",ok_woman:"\u{1F646}",old_key:"\u{1F5DD}",older_man:"\u{1F474}",older_woman:"\u{1F475}",om:"\u{1F549}",on:"\u{1F51B}",oncoming_automobile:"\u{1F698}",oncoming_bus:"\u{1F68D}",oncoming_police_car:"\u{1F694}",oncoming_taxi:"\u{1F696}",open_file_folder:"\u{1F4C2}",open_hands:"\u{1F450}",open_mouth:"\u{1F62E}",open_umbrella:"\u2602\uFE0F",ophiuchus:"\u26CE",orange_book:"\u{1F4D9}",orthodox_cross:"\u2626\uFE0F",outbox_tray:"\u{1F4E4}",owl:"\u{1F989}",ox:"\u{1F402}",package:"\u{1F4E6}",page_facing_up:"\u{1F4C4}",page_with_curl:"\u{1F4C3}",pager:"\u{1F4DF}",paintbrush:"\u{1F58C}",palm_tree:"\u{1F334}",pancakes:"\u{1F95E}",panda_face:"\u{1F43C}",paperclip:"\u{1F4CE}",paperclips:"\u{1F587}",parasol_on_ground:"\u26F1",parking:"\u{1F17F}\uFE0F",part_alternation_mark:"\u303D\uFE0F",partly_sunny:"\u26C5\uFE0F",passenger_ship:"\u{1F6F3}",passport_control:"\u{1F6C2}",pause_button:"\u23F8",peace_symbol:"\u262E\uFE0F",peach:"\u{1F351}",peanuts:"\u{1F95C}",pear:"\u{1F350}",pen:"\u{1F58A}",pencil2:"\u270F\uFE0F",penguin:"\u{1F427}",pensive:"\u{1F614}",performing_arts:"\u{1F3AD}",persevere:"\u{1F623}",person_fencing:"\u{1F93A}",pouting_woman:"\u{1F64E}",phone:"\u260E\uFE0F",pick:"\u26CF",pig:"\u{1F437}",pig2:"\u{1F416}",pig_nose:"\u{1F43D}",pill:"\u{1F48A}",pineapple:"\u{1F34D}",ping_pong:"\u{1F3D3}",pisces:"\u2653\uFE0F",pizza:"\u{1F355}",place_of_worship:"\u{1F6D0}",plate_with_cutlery:"\u{1F37D}",play_or_pause_button:"\u23EF",point_down:"\u{1F447}",point_left:"\u{1F448}",point_right:"\u{1F449}",point_up:"\u261D\uFE0F",point_up_2:"\u{1F446}",police_car:"\u{1F693}",policewoman:"\u{1F46E}&zwj;\u2640\uFE0F",poodle:"\u{1F429}",popcorn:"\u{1F37F}",post_office:"\u{1F3E3}",postal_horn:"\u{1F4EF}",postbox:"\u{1F4EE}",potable_water:"\u{1F6B0}",potato:"\u{1F954}",pouch:"\u{1F45D}",poultry_leg:"\u{1F357}",pound:"\u{1F4B7}",rage:"\u{1F621}",pouting_cat:"\u{1F63E}",pouting_man:"\u{1F64E}&zwj;\u2642\uFE0F",pray:"\u{1F64F}",prayer_beads:"\u{1F4FF}",pregnant_woman:"\u{1F930}",previous_track_button:"\u23EE",prince:"\u{1F934}",princess:"\u{1F478}",printer:"\u{1F5A8}",purple_heart:"\u{1F49C}",purse:"\u{1F45B}",pushpin:"\u{1F4CC}",put_litter_in_its_place:"\u{1F6AE}",question:"\u2753",rabbit:"\u{1F430}",rabbit2:"\u{1F407}",racehorse:"\u{1F40E}",racing_car:"\u{1F3CE}",radio:"\u{1F4FB}",radio_button:"\u{1F518}",radioactive:"\u2622\uFE0F",railway_car:"\u{1F683}",railway_track:"\u{1F6E4}",rainbow:"\u{1F308}",rainbow_flag:"\u{1F3F3}\uFE0F&zwj;\u{1F308}",raised_back_of_hand:"\u{1F91A}",raised_hand_with_fingers_splayed:"\u{1F590}",raised_hands:"\u{1F64C}",raising_hand_woman:"\u{1F64B}",raising_hand_man:"\u{1F64B}&zwj;\u2642\uFE0F",ram:"\u{1F40F}",ramen:"\u{1F35C}",rat:"\u{1F400}",record_button:"\u23FA",recycle:"\u267B\uFE0F",red_circle:"\u{1F534}",registered:"\xAE\uFE0F",relaxed:"\u263A\uFE0F",relieved:"\u{1F60C}",reminder_ribbon:"\u{1F397}",repeat:"\u{1F501}",repeat_one:"\u{1F502}",rescue_worker_helmet:"\u26D1",restroom:"\u{1F6BB}",revolving_hearts:"\u{1F49E}",rewind:"\u23EA",rhinoceros:"\u{1F98F}",ribbon:"\u{1F380}",rice:"\u{1F35A}",rice_ball:"\u{1F359}",rice_cracker:"\u{1F358}",rice_scene:"\u{1F391}",right_anger_bubble:"\u{1F5EF}",ring:"\u{1F48D}",robot:"\u{1F916}",rocket:"\u{1F680}",rofl:"\u{1F923}",roll_eyes:"\u{1F644}",roller_coaster:"\u{1F3A2}",rooster:"\u{1F413}",rose:"\u{1F339}",rosette:"\u{1F3F5}",rotating_light:"\u{1F6A8}",round_pushpin:"\u{1F4CD}",rowing_man:"\u{1F6A3}",rowing_woman:"\u{1F6A3}&zwj;\u2640\uFE0F",rugby_football:"\u{1F3C9}",running_man:"\u{1F3C3}",running_shirt_with_sash:"\u{1F3BD}",running_woman:"\u{1F3C3}&zwj;\u2640\uFE0F",sa:"\u{1F202}\uFE0F",sagittarius:"\u2650\uFE0F",sake:"\u{1F376}",sandal:"\u{1F461}",santa:"\u{1F385}",satellite:"\u{1F4E1}",saxophone:"\u{1F3B7}",school:"\u{1F3EB}",school_satchel:"\u{1F392}",scissors:"\u2702\uFE0F",scorpion:"\u{1F982}",scorpius:"\u264F\uFE0F",scream:"\u{1F631}",scream_cat:"\u{1F640}",scroll:"\u{1F4DC}",seat:"\u{1F4BA}",secret:"\u3299\uFE0F",see_no_evil:"\u{1F648}",seedling:"\u{1F331}",selfie:"\u{1F933}",shallow_pan_of_food:"\u{1F958}",shamrock:"\u2618\uFE0F",shark:"\u{1F988}",shaved_ice:"\u{1F367}",sheep:"\u{1F411}",shell:"\u{1F41A}",shield:"\u{1F6E1}",shinto_shrine:"\u26E9",ship:"\u{1F6A2}",shirt:"\u{1F455}",shopping:"\u{1F6CD}",shopping_cart:"\u{1F6D2}",shower:"\u{1F6BF}",shrimp:"\u{1F990}",signal_strength:"\u{1F4F6}",six_pointed_star:"\u{1F52F}",ski:"\u{1F3BF}",skier:"\u26F7",skull:"\u{1F480}",skull_and_crossbones:"\u2620\uFE0F",sleeping:"\u{1F634}",sleeping_bed:"\u{1F6CC}",sleepy:"\u{1F62A}",slightly_frowning_face:"\u{1F641}",slightly_smiling_face:"\u{1F642}",slot_machine:"\u{1F3B0}",small_airplane:"\u{1F6E9}",small_blue_diamond:"\u{1F539}",small_orange_diamond:"\u{1F538}",small_red_triangle:"\u{1F53A}",small_red_triangle_down:"\u{1F53B}",smile:"\u{1F604}",smile_cat:"\u{1F638}",smiley:"\u{1F603}",smiley_cat:"\u{1F63A}",smiling_imp:"\u{1F608}",smirk:"\u{1F60F}",smirk_cat:"\u{1F63C}",smoking:"\u{1F6AC}",snail:"\u{1F40C}",snake:"\u{1F40D}",sneezing_face:"\u{1F927}",snowboarder:"\u{1F3C2}",snowflake:"\u2744\uFE0F",snowman:"\u26C4\uFE0F",snowman_with_snow:"\u2603\uFE0F",sob:"\u{1F62D}",soccer:"\u26BD\uFE0F",soon:"\u{1F51C}",sos:"\u{1F198}",sound:"\u{1F509}",space_invader:"\u{1F47E}",spades:"\u2660\uFE0F",spaghetti:"\u{1F35D}",sparkle:"\u2747\uFE0F",sparkler:"\u{1F387}",sparkles:"\u2728",sparkling_heart:"\u{1F496}",speak_no_evil:"\u{1F64A}",speaker:"\u{1F508}",speaking_head:"\u{1F5E3}",speech_balloon:"\u{1F4AC}",speedboat:"\u{1F6A4}",spider:"\u{1F577}",spider_web:"\u{1F578}",spiral_calendar:"\u{1F5D3}",spiral_notepad:"\u{1F5D2}",spoon:"\u{1F944}",squid:"\u{1F991}",stadium:"\u{1F3DF}",star:"\u2B50\uFE0F",star2:"\u{1F31F}",star_and_crescent:"\u262A\uFE0F",star_of_david:"\u2721\uFE0F",stars:"\u{1F320}",station:"\u{1F689}",statue_of_liberty:"\u{1F5FD}",steam_locomotive:"\u{1F682}",stew:"\u{1F372}",stop_button:"\u23F9",stop_sign:"\u{1F6D1}",stopwatch:"\u23F1",straight_ruler:"\u{1F4CF}",strawberry:"\u{1F353}",stuck_out_tongue:"\u{1F61B}",stuck_out_tongue_closed_eyes:"\u{1F61D}",stuck_out_tongue_winking_eye:"\u{1F61C}",studio_microphone:"\u{1F399}",stuffed_flatbread:"\u{1F959}",sun_behind_large_cloud:"\u{1F325}",sun_behind_rain_cloud:"\u{1F326}",sun_behind_small_cloud:"\u{1F324}",sun_with_face:"\u{1F31E}",sunflower:"\u{1F33B}",sunglasses:"\u{1F60E}",sunny:"\u2600\uFE0F",sunrise:"\u{1F305}",sunrise_over_mountains:"\u{1F304}",surfing_man:"\u{1F3C4}",surfing_woman:"\u{1F3C4}&zwj;\u2640\uFE0F",sushi:"\u{1F363}",suspension_railway:"\u{1F69F}",sweat:"\u{1F613}",sweat_drops:"\u{1F4A6}",sweat_smile:"\u{1F605}",sweet_potato:"\u{1F360}",swimming_man:"\u{1F3CA}",swimming_woman:"\u{1F3CA}&zwj;\u2640\uFE0F",symbols:"\u{1F523}",synagogue:"\u{1F54D}",syringe:"\u{1F489}",taco:"\u{1F32E}",tada:"\u{1F389}",tanabata_tree:"\u{1F38B}",taurus:"\u2649\uFE0F",taxi:"\u{1F695}",tea:"\u{1F375}",telephone_receiver:"\u{1F4DE}",telescope:"\u{1F52D}",tennis:"\u{1F3BE}",tent:"\u26FA\uFE0F",thermometer:"\u{1F321}",thinking:"\u{1F914}",thought_balloon:"\u{1F4AD}",ticket:"\u{1F3AB}",tickets:"\u{1F39F}",tiger:"\u{1F42F}",tiger2:"\u{1F405}",timer_clock:"\u23F2",tipping_hand_man:"\u{1F481}&zwj;\u2642\uFE0F",tired_face:"\u{1F62B}",tm:"\u2122\uFE0F",toilet:"\u{1F6BD}",tokyo_tower:"\u{1F5FC}",tomato:"\u{1F345}",tongue:"\u{1F445}",top:"\u{1F51D}",tophat:"\u{1F3A9}",tornado:"\u{1F32A}",trackball:"\u{1F5B2}",tractor:"\u{1F69C}",traffic_light:"\u{1F6A5}",train:"\u{1F68B}",train2:"\u{1F686}",tram:"\u{1F68A}",triangular_flag_on_post:"\u{1F6A9}",triangular_ruler:"\u{1F4D0}",trident:"\u{1F531}",triumph:"\u{1F624}",trolleybus:"\u{1F68E}",trophy:"\u{1F3C6}",tropical_drink:"\u{1F379}",tropical_fish:"\u{1F420}",truck:"\u{1F69A}",trumpet:"\u{1F3BA}",tulip:"\u{1F337}",tumbler_glass:"\u{1F943}",turkey:"\u{1F983}",turtle:"\u{1F422}",tv:"\u{1F4FA}",twisted_rightwards_arrows:"\u{1F500}",two_hearts:"\u{1F495}",two_men_holding_hands:"\u{1F46C}",two_women_holding_hands:"\u{1F46D}",u5272:"\u{1F239}",u5408:"\u{1F234}",u55b6:"\u{1F23A}",u6307:"\u{1F22F}\uFE0F",u6708:"\u{1F237}\uFE0F",u6709:"\u{1F236}",u6e80:"\u{1F235}",u7121:"\u{1F21A}\uFE0F",u7533:"\u{1F238}",u7981:"\u{1F232}",u7a7a:"\u{1F233}",umbrella:"\u2614\uFE0F",unamused:"\u{1F612}",underage:"\u{1F51E}",unicorn:"\u{1F984}",unlock:"\u{1F513}",up:"\u{1F199}",upside_down_face:"\u{1F643}",v:"\u270C\uFE0F",vertical_traffic_light:"\u{1F6A6}",vhs:"\u{1F4FC}",vibration_mode:"\u{1F4F3}",video_camera:"\u{1F4F9}",video_game:"\u{1F3AE}",violin:"\u{1F3BB}",virgo:"\u264D\uFE0F",volcano:"\u{1F30B}",volleyball:"\u{1F3D0}",vs:"\u{1F19A}",vulcan_salute:"\u{1F596}",walking_man:"\u{1F6B6}",walking_woman:"\u{1F6B6}&zwj;\u2640\uFE0F",waning_crescent_moon:"\u{1F318}",waning_gibbous_moon:"\u{1F316}",warning:"\u26A0\uFE0F",wastebasket:"\u{1F5D1}",watch:"\u231A\uFE0F",water_buffalo:"\u{1F403}",watermelon:"\u{1F349}",wave:"\u{1F44B}",wavy_dash:"\u3030\uFE0F",waxing_crescent_moon:"\u{1F312}",wc:"\u{1F6BE}",weary:"\u{1F629}",wedding:"\u{1F492}",weight_lifting_man:"\u{1F3CB}\uFE0F",weight_lifting_woman:"\u{1F3CB}\uFE0F&zwj;\u2640\uFE0F",whale:"\u{1F433}",whale2:"\u{1F40B}",wheel_of_dharma:"\u2638\uFE0F",wheelchair:"\u267F\uFE0F",white_check_mark:"\u2705",white_circle:"\u26AA\uFE0F",white_flag:"\u{1F3F3}\uFE0F",white_flower:"\u{1F4AE}",white_large_square:"\u2B1C\uFE0F",white_medium_small_square:"\u25FD\uFE0F",white_medium_square:"\u25FB\uFE0F",white_small_square:"\u25AB\uFE0F",white_square_button:"\u{1F533}",wilted_flower:"\u{1F940}",wind_chime:"\u{1F390}",wind_face:"\u{1F32C}",wine_glass:"\u{1F377}",wink:"\u{1F609}",wolf:"\u{1F43A}",woman:"\u{1F469}",woman_artist:"\u{1F469}&zwj;\u{1F3A8}",woman_astronaut:"\u{1F469}&zwj;\u{1F680}",woman_cartwheeling:"\u{1F938}&zwj;\u2640\uFE0F",woman_cook:"\u{1F469}&zwj;\u{1F373}",woman_facepalming:"\u{1F926}&zwj;\u2640\uFE0F",woman_factory_worker:"\u{1F469}&zwj;\u{1F3ED}",woman_farmer:"\u{1F469}&zwj;\u{1F33E}",woman_firefighter:"\u{1F469}&zwj;\u{1F692}",woman_health_worker:"\u{1F469}&zwj;\u2695\uFE0F",woman_judge:"\u{1F469}&zwj;\u2696\uFE0F",woman_juggling:"\u{1F939}&zwj;\u2640\uFE0F",woman_mechanic:"\u{1F469}&zwj;\u{1F527}",woman_office_worker:"\u{1F469}&zwj;\u{1F4BC}",woman_pilot:"\u{1F469}&zwj;\u2708\uFE0F",woman_playing_handball:"\u{1F93E}&zwj;\u2640\uFE0F",woman_playing_water_polo:"\u{1F93D}&zwj;\u2640\uFE0F",woman_scientist:"\u{1F469}&zwj;\u{1F52C}",woman_shrugging:"\u{1F937}&zwj;\u2640\uFE0F",woman_singer:"\u{1F469}&zwj;\u{1F3A4}",woman_student:"\u{1F469}&zwj;\u{1F393}",woman_teacher:"\u{1F469}&zwj;\u{1F3EB}",woman_technologist:"\u{1F469}&zwj;\u{1F4BB}",woman_with_turban:"\u{1F473}&zwj;\u2640\uFE0F",womans_clothes:"\u{1F45A}",womans_hat:"\u{1F452}",women_wrestling:"\u{1F93C}&zwj;\u2640\uFE0F",womens:"\u{1F6BA}",world_map:"\u{1F5FA}",worried:"\u{1F61F}",wrench:"\u{1F527}",writing_hand:"\u270D\uFE0F",x:"\u274C",yellow_heart:"\u{1F49B}",yen:"\u{1F4B4}",yin_yang:"\u262F\uFE0F",yum:"\u{1F60B}",zap:"\u26A1\uFE0F",zipper_mouth_face:"\u{1F910}",zzz:"\u{1F4A4}",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},t.Converter=function(p){"use strict";var g={},y=[],E=[],_={},x=o,S={parsed:{},raw:"",format:""};I();function I(){p=p||{};for(var R in s)s.hasOwnProperty(R)&&(g[R]=s[R]);if(typeof p=="object")for(var K in p)p.hasOwnProperty(K)&&(g[K]=p[K]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof p+" was passed instead.");g.extensions&&t.helper.forEach(g.extensions,k)}function k(R,K){if(K=K||null,t.helper.isString(R))if(R=t.helper.stdExtName(R),K=R,t.extensions[R]){console.warn("DEPRECATION WARNING: "+R+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),N(t.extensions[R],R);return}else if(!t.helper.isUndefined(i[R]))R=i[R];else throw Error('Extension "'+R+'" could not be loaded. It was either not found or is not a valid extension.');typeof R=="function"&&(R=R()),t.helper.isArray(R)||(R=[R]);var F=c(R,K);if(!F.valid)throw Error(F.error);for(var J=0;J<R.length;++J){switch(R[J].type){case"lang":y.push(R[J]);break;case"output":E.push(R[J]);break}if(R[J].hasOwnProperty("listeners"))for(var ye in R[J].listeners)R[J].listeners.hasOwnProperty(ye)&&L(ye,R[J].listeners[ye])}}function N(R,K){typeof R=="function"&&(R=R(new t.Converter)),t.helper.isArray(R)||(R=[R]);var F=c(R,K);if(!F.valid)throw Error(F.error);for(var J=0;J<R.length;++J)switch(R[J].type){case"lang":y.push(R[J]);break;case"output":E.push(R[J]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function L(R,K){if(!t.helper.isString(R))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof R+" given");if(typeof K!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof K+" given");_.hasOwnProperty(R)||(_[R]=[]),_[R].push(K)}function G(R){var K=R.match(/^\s*/)[0].length,F=new RegExp("^\\s{0,"+K+"}","gm");return R.replace(F,"")}this._dispatch=function(K,F,J,ye){if(_.hasOwnProperty(K))for(var se=0;se<_[K].length;++se){var Re=_[K][se](K,F,this,J,ye);Re&&typeof Re<"u"&&(F=Re)}return F},this.listen=function(R,K){return L(R,K),this},this.makeHtml=function(R){if(!R)return R;var K={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:y,outputModifiers:E,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return R=R.replace(/¨/g,"\xA8T"),R=R.replace(/\$/g,"\xA8D"),R=R.replace(/\r\n/g,`
`),R=R.replace(/\r/g,`
`),R=R.replace(/\u00A0/g,"&nbsp;"),g.smartIndentationFix&&(R=G(R)),R=`

`+R+`

`,R=t.subParser("detab")(R,g,K),R=R.replace(/^[ \t]+$/mg,""),t.helper.forEach(y,function(F){R=t.subParser("runExtension")(F,R,g,K)}),R=t.subParser("metadata")(R,g,K),R=t.subParser("hashPreCodeTags")(R,g,K),R=t.subParser("githubCodeBlocks")(R,g,K),R=t.subParser("hashHTMLBlocks")(R,g,K),R=t.subParser("hashCodeTags")(R,g,K),R=t.subParser("stripLinkDefinitions")(R,g,K),R=t.subParser("blockGamut")(R,g,K),R=t.subParser("unhashHTMLSpans")(R,g,K),R=t.subParser("unescapeSpecialChars")(R,g,K),R=R.replace(/¨D/g,"$$"),R=R.replace(/¨T/g,"\xA8"),R=t.subParser("completeHTMLDocument")(R,g,K),t.helper.forEach(E,function(F){R=t.subParser("runExtension")(F,R,g,K)}),S=K.metadata,R},this.makeMarkdown=this.makeMd=function(R,K){if(R=R.replace(/\r\n/g,`
`),R=R.replace(/\r/g,`
`),R=R.replace(/>[ \t]+</,">\xA8NBSP;<"),!K)if(window&&window.document)K=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var F=K.createElement("div");F.innerHTML=R;var J={preList:Ke(F)};De(F);for(var ye=F.childNodes,se="",Re=0;Re<ye.length;Re++)se+=t.subParser("makeMarkdown.node")(ye[Re],J);function De(Ne){for(var Be=0;Be<Ne.childNodes.length;++Be){var Me=Ne.childNodes[Be];Me.nodeType===3?!/\S/.test(Me.nodeValue)&&!/^[ ]+$/.test(Me.nodeValue)?(Ne.removeChild(Me),--Be):(Me.nodeValue=Me.nodeValue.split(`
`).join(" "),Me.nodeValue=Me.nodeValue.replace(/(\s)+/g,"$1")):Me.nodeType===1&&De(Me)}}function Ke(Ne){for(var Be=Ne.querySelectorAll("pre"),Me=[],Fe=0;Fe<Be.length;++Fe)if(Be[Fe].childElementCount===1&&Be[Fe].firstChild.tagName.toLowerCase()==="code"){var Vr=Be[Fe].firstChild.innerHTML.trim(),zr=Be[Fe].firstChild.getAttribute("data-language")||"";if(zr==="")for(var Zr=Be[Fe].firstChild.className.split(" "),Kr=0;Kr<Zr.length;++Kr){var Jr=Zr[Kr].match(/^language-(.+)$/);if(Jr!==null){zr=Jr[1];break}}Vr=t.helper.unescapeHTMLEntities(Vr),Me.push(Vr),Be[Fe].outerHTML='<precode language="'+zr+'" precodenum="'+Fe.toString()+'"></precode>'}else Me.push(Be[Fe].innerHTML),Be[Fe].innerHTML="",Be[Fe].setAttribute("prenum",Fe.toString());return Me}return se},this.setOption=function(R,K){g[R]=K},this.getOption=function(R){return g[R]},this.getOptions=function(){return g},this.addExtension=function(R,K){K=K||null,k(R,K)},this.useExtension=function(R){k(R)},this.setFlavor=function(R){if(!a.hasOwnProperty(R))throw Error(R+" flavor was not found");var K=a[R];x=R;for(var F in K)K.hasOwnProperty(F)&&(g[F]=K[F])},this.getFlavor=function(){return x},this.removeExtension=function(R){t.helper.isArray(R)||(R=[R]);for(var K=0;K<R.length;++K){for(var F=R[K],J=0;J<y.length;++J)y[J]===F&&y.splice(J,1);for(var ye=0;ye<E.length;++ye)E[ye]===F&&E.splice(ye,1)}},this.getAllExtensions=function(){return{language:y,output:E}},this.getMetadata=function(R){return R?S.raw:S.parsed},this.getMetadataFormat=function(){return S.format},this._setMetadataPair=function(R,K){S.parsed[R]=K},this._setMetadataFormat=function(R){S.format=R},this._setMetadataRaw=function(R){S.raw=R}},t.subParser("anchors",function(p,g,y){"use strict";p=y.converter._dispatch("anchors.before",p,g,y);var E=function(_,x,S,I,k,N,L){if(t.helper.isUndefined(L)&&(L=""),S=S.toLowerCase(),_.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)I="";else if(!I)if(S||(S=x.toLowerCase().replace(/ ?\n/g," ")),I="#"+S,!t.helper.isUndefined(y.gUrls[S]))I=y.gUrls[S],t.helper.isUndefined(y.gTitles[S])||(L=y.gTitles[S]);else return _;I=I.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var G='<a href="'+I+'"';return L!==""&&L!==null&&(L=L.replace(/"/g,"&quot;"),L=L.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),G+=' title="'+L+'"'),g.openLinksInNewWindow&&!/^#/.test(I)&&(G+=' rel="noopener noreferrer" target="\xA8E95Eblank"'),G+=">"+x+"</a>",G};return p=p.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,E),p=p.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,E),p=p.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,E),p=p.replace(/\[([^\[\]]+)]()()()()()/g,E),g.ghMentions&&(p=p.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(_,x,S,I,k){if(S==="\\")return x+I;if(!t.helper.isString(g.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var N=g.ghMentionsLink.replace(/\{u}/g,k),L="";return g.openLinksInNewWindow&&(L=' rel="noopener noreferrer" target="\xA8E95Eblank"'),x+'<a href="'+N+'"'+L+">"+I+"</a>"})),p=y.converter._dispatch("anchors.after",p,g,y),p});var f=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,h=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,d=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,m=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,w=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,b=function(p){"use strict";return function(g,y,E,_,x,S,I){E=E.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var k=E,N="",L="",G=y||"",R=I||"";return/^www\./i.test(E)&&(E=E.replace(/^www\./i,"http://www.")),p.excludeTrailingPunctuationFromURLs&&S&&(N=S),p.openLinksInNewWindow&&(L=' rel="noopener noreferrer" target="\xA8E95Eblank"'),G+'<a href="'+E+'"'+L+">"+k+"</a>"+N+R}},v=function(p,g){"use strict";return function(y,E,_){var x="mailto:";return E=E||"",_=t.subParser("unescapeSpecialChars")(_,p,g),p.encodeEmails?(x=t.helper.encodeEmailAddress(x+_),_=t.helper.encodeEmailAddress(_)):x=x+_,E+'<a href="'+x+'">'+_+"</a>"}};t.subParser("autoLinks",function(p,g,y){"use strict";return p=y.converter._dispatch("autoLinks.before",p,g,y),p=p.replace(d,b(g)),p=p.replace(w,v(g,y)),p=y.converter._dispatch("autoLinks.after",p,g,y),p}),t.subParser("simplifiedAutoLinks",function(p,g,y){"use strict";return g.simplifiedAutoLink&&(p=y.converter._dispatch("simplifiedAutoLinks.before",p,g,y),g.excludeTrailingPunctuationFromURLs?p=p.replace(h,b(g)):p=p.replace(f,b(g)),p=p.replace(m,v(g,y)),p=y.converter._dispatch("simplifiedAutoLinks.after",p,g,y)),p}),t.subParser("blockGamut",function(p,g,y){"use strict";return p=y.converter._dispatch("blockGamut.before",p,g,y),p=t.subParser("blockQuotes")(p,g,y),p=t.subParser("headers")(p,g,y),p=t.subParser("horizontalRule")(p,g,y),p=t.subParser("lists")(p,g,y),p=t.subParser("codeBlocks")(p,g,y),p=t.subParser("tables")(p,g,y),p=t.subParser("hashHTMLBlocks")(p,g,y),p=t.subParser("paragraphs")(p,g,y),p=y.converter._dispatch("blockGamut.after",p,g,y),p}),t.subParser("blockQuotes",function(p,g,y){"use strict";p=y.converter._dispatch("blockQuotes.before",p,g,y),p=p+`

`;var E=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return g.splitAdjacentBlockquotes&&(E=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),p=p.replace(E,function(_){return _=_.replace(/^[ \t]*>[ \t]?/gm,""),_=_.replace(/¨0/g,""),_=_.replace(/^[ \t]+$/gm,""),_=t.subParser("githubCodeBlocks")(_,g,y),_=t.subParser("blockGamut")(_,g,y),_=_.replace(/(^|\n)/g,"$1  "),_=_.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(x,S){var I=S;return I=I.replace(/^  /mg,"\xA80"),I=I.replace(/¨0/g,""),I}),t.subParser("hashBlock")(`<blockquote>
`+_+`
</blockquote>`,g,y)}),p=y.converter._dispatch("blockQuotes.after",p,g,y),p}),t.subParser("codeBlocks",function(p,g,y){"use strict";p=y.converter._dispatch("codeBlocks.before",p,g,y),p+="\xA80";var E=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return p=p.replace(E,function(_,x,S){var I=x,k=S,N=`
`;return I=t.subParser("outdent")(I,g,y),I=t.subParser("encodeCode")(I,g,y),I=t.subParser("detab")(I,g,y),I=I.replace(/^\n+/g,""),I=I.replace(/\n+$/g,""),g.omitExtraWLInCodeBlocks&&(N=""),I="<pre><code>"+I+N+"</code></pre>",t.subParser("hashBlock")(I,g,y)+k}),p=p.replace(/¨0/,""),p=y.converter._dispatch("codeBlocks.after",p,g,y),p}),t.subParser("codeSpans",function(p,g,y){"use strict";return p=y.converter._dispatch("codeSpans.before",p,g,y),typeof p>"u"&&(p=""),p=p.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(E,_,x,S){var I=S;return I=I.replace(/^([ \t]*)/g,""),I=I.replace(/[ \t]*$/g,""),I=t.subParser("encodeCode")(I,g,y),I=_+"<code>"+I+"</code>",I=t.subParser("hashHTMLSpans")(I,g,y),I}),p=y.converter._dispatch("codeSpans.after",p,g,y),p}),t.subParser("completeHTMLDocument",function(p,g,y){"use strict";if(!g.completeHTMLDocument)return p;p=y.converter._dispatch("completeHTMLDocument.before",p,g,y);var E="html",_=`<!DOCTYPE HTML>
`,x="",S=`<meta charset="utf-8">
`,I="",k="";typeof y.metadata.parsed.doctype<"u"&&(_="<!DOCTYPE "+y.metadata.parsed.doctype+`>
`,E=y.metadata.parsed.doctype.toString().toLowerCase(),(E==="html"||E==="html5")&&(S='<meta charset="utf-8">'));for(var N in y.metadata.parsed)if(y.metadata.parsed.hasOwnProperty(N))switch(N.toLowerCase()){case"doctype":break;case"title":x="<title>"+y.metadata.parsed.title+`</title>
`;break;case"charset":E==="html"||E==="html5"?S='<meta charset="'+y.metadata.parsed.charset+`">
`:S='<meta name="charset" content="'+y.metadata.parsed.charset+`">
`;break;case"language":case"lang":I=' lang="'+y.metadata.parsed[N]+'"',k+='<meta name="'+N+'" content="'+y.metadata.parsed[N]+`">
`;break;default:k+='<meta name="'+N+'" content="'+y.metadata.parsed[N]+`">
`}return p=_+"<html"+I+`>
<head>
`+x+S+k+`</head>
<body>
`+p.trim()+`
</body>
</html>`,p=y.converter._dispatch("completeHTMLDocument.after",p,g,y),p}),t.subParser("detab",function(p,g,y){"use strict";return p=y.converter._dispatch("detab.before",p,g,y),p=p.replace(/\t(?=\t)/g,"    "),p=p.replace(/\t/g,"\xA8A\xA8B"),p=p.replace(/¨B(.+?)¨A/g,function(E,_){for(var x=_,S=4-x.length%4,I=0;I<S;I++)x+=" ";return x}),p=p.replace(/¨A/g,"    "),p=p.replace(/¨B/g,""),p=y.converter._dispatch("detab.after",p,g,y),p}),t.subParser("ellipsis",function(p,g,y){"use strict";return g.ellipsis&&(p=y.converter._dispatch("ellipsis.before",p,g,y),p=p.replace(/\.\.\./g,"\u2026"),p=y.converter._dispatch("ellipsis.after",p,g,y)),p}),t.subParser("emoji",function(p,g,y){"use strict";if(!g.emoji)return p;p=y.converter._dispatch("emoji.before",p,g,y);var E=/:([\S]+?):/g;return p=p.replace(E,function(_,x){return t.helper.emojis.hasOwnProperty(x)?t.helper.emojis[x]:_}),p=y.converter._dispatch("emoji.after",p,g,y),p}),t.subParser("encodeAmpsAndAngles",function(p,g,y){"use strict";return p=y.converter._dispatch("encodeAmpsAndAngles.before",p,g,y),p=p.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),p=p.replace(/<(?![a-z\/?$!])/gi,"&lt;"),p=p.replace(/</g,"&lt;"),p=p.replace(/>/g,"&gt;"),p=y.converter._dispatch("encodeAmpsAndAngles.after",p,g,y),p}),t.subParser("encodeBackslashEscapes",function(p,g,y){"use strict";return p=y.converter._dispatch("encodeBackslashEscapes.before",p,g,y),p=p.replace(/\\(\\)/g,t.helper.escapeCharactersCallback),p=p.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,t.helper.escapeCharactersCallback),p=y.converter._dispatch("encodeBackslashEscapes.after",p,g,y),p}),t.subParser("encodeCode",function(p,g,y){"use strict";return p=y.converter._dispatch("encodeCode.before",p,g,y),p=p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,t.helper.escapeCharactersCallback),p=y.converter._dispatch("encodeCode.after",p,g,y),p}),t.subParser("escapeSpecialCharsWithinTagAttributes",function(p,g,y){"use strict";p=y.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",p,g,y);var E=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,_=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return p=p.replace(E,function(x){return x.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),p=p.replace(_,function(x){return x.replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),p=y.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",p,g,y),p}),t.subParser("githubCodeBlocks",function(p,g,y){"use strict";return g.ghCodeBlocks?(p=y.converter._dispatch("githubCodeBlocks.before",p,g,y),p+="\xA80",p=p.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(E,_,x,S){var I=g.omitExtraWLInCodeBlocks?"":`
`;return S=t.subParser("encodeCode")(S,g,y),S=t.subParser("detab")(S,g,y),S=S.replace(/^\n+/g,""),S=S.replace(/\n+$/g,""),S="<pre><code"+(x?' class="'+x+" language-"+x+'"':"")+">"+S+I+"</code></pre>",S=t.subParser("hashBlock")(S,g,y),`

\xA8G`+(y.ghCodeBlocks.push({text:E,codeblock:S})-1)+`G

`}),p=p.replace(/¨0/,""),y.converter._dispatch("githubCodeBlocks.after",p,g,y)):p}),t.subParser("hashBlock",function(p,g,y){"use strict";return p=y.converter._dispatch("hashBlock.before",p,g,y),p=p.replace(/(^\n+|\n+$)/g,""),p=`

\xA8K`+(y.gHtmlBlocks.push(p)-1)+`K

`,p=y.converter._dispatch("hashBlock.after",p,g,y),p}),t.subParser("hashCodeTags",function(p,g,y){"use strict";p=y.converter._dispatch("hashCodeTags.before",p,g,y);var E=function(_,x,S,I){var k=S+t.subParser("encodeCode")(x,g,y)+I;return"\xA8C"+(y.gHtmlSpans.push(k)-1)+"C"};return p=t.helper.replaceRecursiveRegExp(p,E,"<code\\b[^>]*>","</code>","gim"),p=y.converter._dispatch("hashCodeTags.after",p,g,y),p}),t.subParser("hashElement",function(p,g,y){"use strict";return function(E,_){var x=_;return x=x.replace(/\n\n/g,`
`),x=x.replace(/^\n/,""),x=x.replace(/\n+$/g,""),x=`

\xA8K`+(y.gHtmlBlocks.push(x)-1)+`K

`,x}}),t.subParser("hashHTMLBlocks",function(p,g,y){"use strict";p=y.converter._dispatch("hashHTMLBlocks.before",p,g,y);var E=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],_=function(R,K,F,J){var ye=R;return F.search(/\bmarkdown\b/)!==-1&&(ye=F+y.converter.makeHtml(K)+J),`

\xA8K`+(y.gHtmlBlocks.push(ye)-1)+`K

`};g.backslashEscapesHTMLTags&&(p=p.replace(/\\<(\/?[^>]+?)>/g,function(R,K){return"&lt;"+K+"&gt;"}));for(var x=0;x<E.length;++x)for(var S,I=new RegExp("^ {0,3}(<"+E[x]+"\\b[^>]*>)","im"),k="<"+E[x]+"\\b[^>]*>",N="</"+E[x]+">";(S=t.helper.regexIndexOf(p,I))!==-1;){var L=t.helper.splitAtIndex(p,S),G=t.helper.replaceRecursiveRegExp(L[1],_,k,N,"im");if(G===L[1])break;p=L[0].concat(G)}return p=p.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(p,g,y)),p=t.helper.replaceRecursiveRegExp(p,function(R){return`

\xA8K`+(y.gHtmlBlocks.push(R)-1)+`K

`},"^ {0,3}<!--","-->","gm"),p=p.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(p,g,y)),p=y.converter._dispatch("hashHTMLBlocks.after",p,g,y),p}),t.subParser("hashHTMLSpans",function(p,g,y){"use strict";p=y.converter._dispatch("hashHTMLSpans.before",p,g,y);function E(_){return"\xA8C"+(y.gHtmlSpans.push(_)-1)+"C"}return p=p.replace(/<[^>]+?\/>/gi,function(_){return E(_)}),p=p.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(_){return E(_)}),p=p.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(_){return E(_)}),p=p.replace(/<[^>]+?>/gi,function(_){return E(_)}),p=y.converter._dispatch("hashHTMLSpans.after",p,g,y),p}),t.subParser("unhashHTMLSpans",function(p,g,y){"use strict";p=y.converter._dispatch("unhashHTMLSpans.before",p,g,y);for(var E=0;E<y.gHtmlSpans.length;++E){for(var _=y.gHtmlSpans[E],x=0;/¨C(\d+)C/.test(_);){var S=RegExp.$1;if(_=_.replace("\xA8C"+S+"C",y.gHtmlSpans[S]),x===10){console.error("maximum nesting of 10 spans reached!!!");break}++x}p=p.replace("\xA8C"+E+"C",_)}return p=y.converter._dispatch("unhashHTMLSpans.after",p,g,y),p}),t.subParser("hashPreCodeTags",function(p,g,y){"use strict";p=y.converter._dispatch("hashPreCodeTags.before",p,g,y);var E=function(_,x,S,I){var k=S+t.subParser("encodeCode")(x,g,y)+I;return`

\xA8G`+(y.ghCodeBlocks.push({text:_,codeblock:k})-1)+`G

`};return p=t.helper.replaceRecursiveRegExp(p,E,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),p=y.converter._dispatch("hashPreCodeTags.after",p,g,y),p}),t.subParser("headers",function(p,g,y){"use strict";p=y.converter._dispatch("headers.before",p,g,y);var E=isNaN(parseInt(g.headerLevelStart))?1:parseInt(g.headerLevelStart),_=g.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,x=g.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;p=p.replace(_,function(k,N){var L=t.subParser("spanGamut")(N,g,y),G=g.noHeaderId?"":' id="'+I(N)+'"',R=E,K="<h"+R+G+">"+L+"</h"+R+">";return t.subParser("hashBlock")(K,g,y)}),p=p.replace(x,function(k,N){var L=t.subParser("spanGamut")(N,g,y),G=g.noHeaderId?"":' id="'+I(N)+'"',R=E+1,K="<h"+R+G+">"+L+"</h"+R+">";return t.subParser("hashBlock")(K,g,y)});var S=g.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;p=p.replace(S,function(k,N,L){var G=L;g.customizedHeaderId&&(G=L.replace(/\s?\{([^{]+?)}\s*$/,""));var R=t.subParser("spanGamut")(G,g,y),K=g.noHeaderId?"":' id="'+I(L)+'"',F=E-1+N.length,J="<h"+F+K+">"+R+"</h"+F+">";return t.subParser("hashBlock")(J,g,y)});function I(k){var N,L;if(g.customizedHeaderId){var G=k.match(/\{([^{]+?)}\s*$/);G&&G[1]&&(k=G[1])}return N=k,t.helper.isString(g.prefixHeaderId)?L=g.prefixHeaderId:g.prefixHeaderId===!0?L="section-":L="",g.rawPrefixHeaderId||(N=L+N),g.ghCompatibleHeaderId?N=N.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():g.rawHeaderId?N=N.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"\xA8").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():N=N.replace(/[^\w]/g,"").toLowerCase(),g.rawPrefixHeaderId&&(N=L+N),y.hashLinkCounts[N]?N=N+"-"+y.hashLinkCounts[N]++:y.hashLinkCounts[N]=1,N}return p=y.converter._dispatch("headers.after",p,g,y),p}),t.subParser("horizontalRule",function(p,g,y){"use strict";p=y.converter._dispatch("horizontalRule.before",p,g,y);var E=t.subParser("hashBlock")("<hr />",g,y);return p=p.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,E),p=p.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,E),p=p.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,E),p=y.converter._dispatch("horizontalRule.after",p,g,y),p}),t.subParser("images",function(p,g,y){"use strict";p=y.converter._dispatch("images.before",p,g,y);var E=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,_=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,x=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,S=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,I=/!\[([^\[\]]+)]()()()()()/g;function k(L,G,R,K,F,J,ye,se){return K=K.replace(/\s/g,""),N(L,G,R,K,F,J,ye,se)}function N(L,G,R,K,F,J,ye,se){var Re=y.gUrls,De=y.gTitles,Ke=y.gDimensions;if(R=R.toLowerCase(),se||(se=""),L.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)K="";else if(K===""||K===null)if((R===""||R===null)&&(R=G.toLowerCase().replace(/ ?\n/g," ")),K="#"+R,!t.helper.isUndefined(Re[R]))K=Re[R],t.helper.isUndefined(De[R])||(se=De[R]),t.helper.isUndefined(Ke[R])||(F=Ke[R].width,J=Ke[R].height);else return L;G=G.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),K=K.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var Ne='<img src="'+K+'" alt="'+G+'"';return se&&t.helper.isString(se)&&(se=se.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),Ne+=' title="'+se+'"'),F&&J&&(F=F==="*"?"auto":F,J=J==="*"?"auto":J,Ne+=' width="'+F+'"',Ne+=' height="'+J+'"'),Ne+=" />",Ne}return p=p.replace(S,N),p=p.replace(x,k),p=p.replace(_,N),p=p.replace(E,N),p=p.replace(I,N),p=y.converter._dispatch("images.after",p,g,y),p}),t.subParser("italicsAndBold",function(p,g,y){"use strict";p=y.converter._dispatch("italicsAndBold.before",p,g,y);function E(_,x,S){return x+_+S}return g.literalMidWordUnderscores?(p=p.replace(/\b___(\S[\s\S]*?)___\b/g,function(_,x){return E(x,"<strong><em>","</em></strong>")}),p=p.replace(/\b__(\S[\s\S]*?)__\b/g,function(_,x){return E(x,"<strong>","</strong>")}),p=p.replace(/\b_(\S[\s\S]*?)_\b/g,function(_,x){return E(x,"<em>","</em>")})):(p=p.replace(/___(\S[\s\S]*?)___/g,function(_,x){return/\S$/.test(x)?E(x,"<strong><em>","</em></strong>"):_}),p=p.replace(/__(\S[\s\S]*?)__/g,function(_,x){return/\S$/.test(x)?E(x,"<strong>","</strong>"):_}),p=p.replace(/_([^\s_][\s\S]*?)_/g,function(_,x){return/\S$/.test(x)?E(x,"<em>","</em>"):_})),g.literalMidWordAsterisks?(p=p.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(_,x,S){return E(S,x+"<strong><em>","</em></strong>")}),p=p.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(_,x,S){return E(S,x+"<strong>","</strong>")}),p=p.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(_,x,S){return E(S,x+"<em>","</em>")})):(p=p.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(_,x){return/\S$/.test(x)?E(x,"<strong><em>","</em></strong>"):_}),p=p.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(_,x){return/\S$/.test(x)?E(x,"<strong>","</strong>"):_}),p=p.replace(/\*([^\s*][\s\S]*?)\*/g,function(_,x){return/\S$/.test(x)?E(x,"<em>","</em>"):_})),p=y.converter._dispatch("italicsAndBold.after",p,g,y),p}),t.subParser("lists",function(p,g,y){"use strict";function E(S,I){y.gListLevel++,S=S.replace(/\n{2,}$/,`
`),S+="\xA80";var k=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,N=/\n[ \t]*\n(?!¨0)/.test(S);return g.disableForced4SpacesIndentedSublists&&(k=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),S=S.replace(k,function(L,G,R,K,F,J,ye){ye=ye&&ye.trim()!=="";var se=t.subParser("outdent")(F,g,y),Re="";return J&&g.tasklists&&(Re=' class="task-list-item" style="list-style-type: none;"',se=se.replace(/^[ \t]*\[(x|X| )?]/m,function(){var De='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return ye&&(De+=" checked"),De+=">",De})),se=se.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(De){return"\xA8A"+De}),G||se.search(/\n{2,}/)>-1?(se=t.subParser("githubCodeBlocks")(se,g,y),se=t.subParser("blockGamut")(se,g,y)):(se=t.subParser("lists")(se,g,y),se=se.replace(/\n$/,""),se=t.subParser("hashHTMLBlocks")(se,g,y),se=se.replace(/\n\n+/g,`

`),N?se=t.subParser("paragraphs")(se,g,y):se=t.subParser("spanGamut")(se,g,y)),se=se.replace("\xA8A",""),se="<li"+Re+">"+se+`</li>
`,se}),S=S.replace(/¨0/g,""),y.gListLevel--,I&&(S=S.replace(/\s+$/,"")),S}function _(S,I){if(I==="ol"){var k=S.match(/^ *(\d+)\./);if(k&&k[1]!=="1")return' start="'+k[1]+'"'}return""}function x(S,I,k){var N=g.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,L=g.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,G=I==="ul"?N:L,R="";if(S.search(G)!==-1)(function F(J){var ye=J.search(G),se=_(S,I);ye!==-1?(R+=`

<`+I+se+`>
`+E(J.slice(0,ye),!!k)+"</"+I+`>
`,I=I==="ul"?"ol":"ul",G=I==="ul"?N:L,F(J.slice(ye))):R+=`

<`+I+se+`>
`+E(J,!!k)+"</"+I+`>
`})(S);else{var K=_(S,I);R=`

<`+I+K+`>
`+E(S,!!k)+"</"+I+`>
`}return R}return p=y.converter._dispatch("lists.before",p,g,y),p+="\xA80",y.gListLevel?p=p.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(S,I,k){var N=k.search(/[*+-]/g)>-1?"ul":"ol";return x(I,N,!0)}):p=p.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(S,I,k,N){var L=N.search(/[*+-]/g)>-1?"ul":"ol";return x(k,L,!1)}),p=p.replace(/¨0/,""),p=y.converter._dispatch("lists.after",p,g,y),p}),t.subParser("metadata",function(p,g,y){"use strict";if(!g.metadata)return p;p=y.converter._dispatch("metadata.before",p,g,y);function E(_){y.metadata.raw=_,_=_.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),_=_.replace(/\n {4}/g," "),_.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(x,S,I){return y.metadata.parsed[S]=I,""})}return p=p.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(_,x,S){return E(S),"\xA8M"}),p=p.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(_,x,S){return x&&(y.metadata.format=x),E(S),"\xA8M"}),p=p.replace(/¨M/g,""),p=y.converter._dispatch("metadata.after",p,g,y),p}),t.subParser("outdent",function(p,g,y){"use strict";return p=y.converter._dispatch("outdent.before",p,g,y),p=p.replace(/^(\t|[ ]{1,4})/gm,"\xA80"),p=p.replace(/¨0/g,""),p=y.converter._dispatch("outdent.after",p,g,y),p}),t.subParser("paragraphs",function(p,g,y){"use strict";p=y.converter._dispatch("paragraphs.before",p,g,y),p=p.replace(/^\n+/g,""),p=p.replace(/\n+$/g,"");for(var E=p.split(/\n{2,}/g),_=[],x=E.length,S=0;S<x;S++){var I=E[S];I.search(/¨(K|G)(\d+)\1/g)>=0?_.push(I):I.search(/\S/)>=0&&(I=t.subParser("spanGamut")(I,g,y),I=I.replace(/^([ \t]*)/g,"<p>"),I+="</p>",_.push(I))}for(x=_.length,S=0;S<x;S++){for(var k="",N=_[S],L=!1;/¨(K|G)(\d+)\1/.test(N);){var G=RegExp.$1,R=RegExp.$2;G==="K"?k=y.gHtmlBlocks[R]:L?k=t.subParser("encodeCode")(y.ghCodeBlocks[R].text,g,y):k=y.ghCodeBlocks[R].codeblock,k=k.replace(/\$/g,"$$$$"),N=N.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,k),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(N)&&(L=!0)}_[S]=N}return p=_.join(`
`),p=p.replace(/^\n+/g,""),p=p.replace(/\n+$/g,""),y.converter._dispatch("paragraphs.after",p,g,y)}),t.subParser("runExtension",function(p,g,y,E){"use strict";if(p.filter)g=p.filter(g,E.converter,y);else if(p.regex){var _=p.regex;_ instanceof RegExp||(_=new RegExp(_,"g")),g=g.replace(_,p.replace)}return g}),t.subParser("spanGamut",function(p,g,y){"use strict";return p=y.converter._dispatch("spanGamut.before",p,g,y),p=t.subParser("codeSpans")(p,g,y),p=t.subParser("escapeSpecialCharsWithinTagAttributes")(p,g,y),p=t.subParser("encodeBackslashEscapes")(p,g,y),p=t.subParser("images")(p,g,y),p=t.subParser("anchors")(p,g,y),p=t.subParser("autoLinks")(p,g,y),p=t.subParser("simplifiedAutoLinks")(p,g,y),p=t.subParser("emoji")(p,g,y),p=t.subParser("underline")(p,g,y),p=t.subParser("italicsAndBold")(p,g,y),p=t.subParser("strikethrough")(p,g,y),p=t.subParser("ellipsis")(p,g,y),p=t.subParser("hashHTMLSpans")(p,g,y),p=t.subParser("encodeAmpsAndAngles")(p,g,y),g.simpleLineBreaks?/\n\n¨K/.test(p)||(p=p.replace(/\n+/g,`<br />
`)):p=p.replace(/  +\n/g,`<br />
`),p=y.converter._dispatch("spanGamut.after",p,g,y),p}),t.subParser("strikethrough",function(p,g,y){"use strict";function E(_){return g.simplifiedAutoLink&&(_=t.subParser("simplifiedAutoLinks")(_,g,y)),"<del>"+_+"</del>"}return g.strikethrough&&(p=y.converter._dispatch("strikethrough.before",p,g,y),p=p.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(_,x){return E(x)}),p=y.converter._dispatch("strikethrough.after",p,g,y)),p}),t.subParser("stripLinkDefinitions",function(p,g,y){"use strict";var E=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,_=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;p+="\xA80";var x=function(S,I,k,N,L,G,R){return I=I.toLowerCase(),p.toLowerCase().split(I).length-1<2?S:(k.match(/^data:.+?\/.+?;base64,/)?y.gUrls[I]=k.replace(/\s/g,""):y.gUrls[I]=t.subParser("encodeAmpsAndAngles")(k,g,y),G?G+R:(R&&(y.gTitles[I]=R.replace(/"|'/g,"&quot;")),g.parseImgDimensions&&N&&L&&(y.gDimensions[I]={width:N,height:L}),""))};return p=p.replace(_,x),p=p.replace(E,x),p=p.replace(/¨0/,""),p}),t.subParser("tables",function(p,g,y){"use strict";if(!g.tables)return p;var E=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,_=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function x(L){return/^:[ \t]*--*$/.test(L)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(L)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(L)?' style="text-align:center;"':""}function S(L,G){var R="";return L=L.trim(),(g.tablesHeaderId||g.tableHeaderId)&&(R=' id="'+L.replace(/ /g,"_").toLowerCase()+'"'),L=t.subParser("spanGamut")(L,g,y),"<th"+R+G+">"+L+`</th>
`}function I(L,G){var R=t.subParser("spanGamut")(L,g,y);return"<td"+G+">"+R+`</td>
`}function k(L,G){for(var R=`<table>
<thead>
<tr>
`,K=L.length,F=0;F<K;++F)R+=L[F];for(R+=`</tr>
</thead>
<tbody>
`,F=0;F<G.length;++F){R+=`<tr>
`;for(var J=0;J<K;++J)R+=G[F][J];R+=`</tr>
`}return R+=`</tbody>
</table>
`,R}function N(L){var G,R=L.split(`
`);for(G=0;G<R.length;++G)/^ {0,3}\|/.test(R[G])&&(R[G]=R[G].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(R[G])&&(R[G]=R[G].replace(/\|[ \t]*$/,"")),R[G]=t.subParser("codeSpans")(R[G],g,y);var K=R[0].split("|").map(function(Ne){return Ne.trim()}),F=R[1].split("|").map(function(Ne){return Ne.trim()}),J=[],ye=[],se=[],Re=[];for(R.shift(),R.shift(),G=0;G<R.length;++G)R[G].trim()!==""&&J.push(R[G].split("|").map(function(Ne){return Ne.trim()}));if(K.length<F.length)return L;for(G=0;G<F.length;++G)se.push(x(F[G]));for(G=0;G<K.length;++G)t.helper.isUndefined(se[G])&&(se[G]=""),ye.push(S(K[G],se[G]));for(G=0;G<J.length;++G){for(var De=[],Ke=0;Ke<ye.length;++Ke)t.helper.isUndefined(J[G][Ke]),De.push(I(J[G][Ke],se[Ke]));Re.push(De)}return k(ye,Re)}return p=y.converter._dispatch("tables.before",p,g,y),p=p.replace(/\\(\|)/g,t.helper.escapeCharactersCallback),p=p.replace(E,N),p=p.replace(_,N),p=y.converter._dispatch("tables.after",p,g,y),p}),t.subParser("underline",function(p,g,y){"use strict";return g.underline&&(p=y.converter._dispatch("underline.before",p,g,y),g.literalMidWordUnderscores?(p=p.replace(/\b___(\S[\s\S]*?)___\b/g,function(E,_){return"<u>"+_+"</u>"}),p=p.replace(/\b__(\S[\s\S]*?)__\b/g,function(E,_){return"<u>"+_+"</u>"})):(p=p.replace(/___(\S[\s\S]*?)___/g,function(E,_){return/\S$/.test(_)?"<u>"+_+"</u>":E}),p=p.replace(/__(\S[\s\S]*?)__/g,function(E,_){return/\S$/.test(_)?"<u>"+_+"</u>":E})),p=p.replace(/(_)/g,t.helper.escapeCharactersCallback),p=y.converter._dispatch("underline.after",p,g,y)),p}),t.subParser("unescapeSpecialChars",function(p,g,y){"use strict";return p=y.converter._dispatch("unescapeSpecialChars.before",p,g,y),p=p.replace(/¨E(\d+)E/g,function(E,_){var x=parseInt(_);return String.fromCharCode(x)}),p=y.converter._dispatch("unescapeSpecialChars.after",p,g,y),p}),t.subParser("makeMarkdown.blockquote",function(p,g){"use strict";var y="";if(p.hasChildNodes())for(var E=p.childNodes,_=E.length,x=0;x<_;++x){var S=t.subParser("makeMarkdown.node")(E[x],g);S!==""&&(y+=S)}return y=y.trim(),y="> "+y.split(`
`).join(`
> `),y}),t.subParser("makeMarkdown.codeBlock",function(p,g){"use strict";var y=p.getAttribute("language"),E=p.getAttribute("precodenum");return"```"+y+`
`+g.preList[E]+"\n```"}),t.subParser("makeMarkdown.codeSpan",function(p){"use strict";return"`"+p.innerHTML+"`"}),t.subParser("makeMarkdown.emphasis",function(p,g){"use strict";var y="";if(p.hasChildNodes()){y+="*";for(var E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);y+="*"}return y}),t.subParser("makeMarkdown.header",function(p,g,y){"use strict";var E=new Array(y+1).join("#"),_="";if(p.hasChildNodes()){_=E+" ";for(var x=p.childNodes,S=x.length,I=0;I<S;++I)_+=t.subParser("makeMarkdown.node")(x[I],g)}return _}),t.subParser("makeMarkdown.hr",function(){"use strict";return"---"}),t.subParser("makeMarkdown.image",function(p){"use strict";var g="";return p.hasAttribute("src")&&(g+="!["+p.getAttribute("alt")+"](",g+="<"+p.getAttribute("src")+">",p.hasAttribute("width")&&p.hasAttribute("height")&&(g+=" ="+p.getAttribute("width")+"x"+p.getAttribute("height")),p.hasAttribute("title")&&(g+=' "'+p.getAttribute("title")+'"'),g+=")"),g}),t.subParser("makeMarkdown.links",function(p,g){"use strict";var y="";if(p.hasChildNodes()&&p.hasAttribute("href")){var E=p.childNodes,_=E.length;y="[";for(var x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);y+="](",y+="<"+p.getAttribute("href")+">",p.hasAttribute("title")&&(y+=' "'+p.getAttribute("title")+'"'),y+=")"}return y}),t.subParser("makeMarkdown.list",function(p,g,y){"use strict";var E="";if(!p.hasChildNodes())return"";for(var _=p.childNodes,x=_.length,S=p.getAttribute("start")||1,I=0;I<x;++I)if(!(typeof _[I].tagName>"u"||_[I].tagName.toLowerCase()!=="li")){var k="";y==="ol"?k=S.toString()+". ":k="- ",E+=k+t.subParser("makeMarkdown.listItem")(_[I],g),++S}return E+=`
<!-- -->
`,E.trim()}),t.subParser("makeMarkdown.listItem",function(p,g){"use strict";for(var y="",E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);return/\n$/.test(y)?y=y.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):y+=`
`,y}),t.subParser("makeMarkdown.node",function(p,g,y){"use strict";y=y||!1;var E="";if(p.nodeType===3)return t.subParser("makeMarkdown.txt")(p,g);if(p.nodeType===8)return"<!--"+p.data+`-->

`;if(p.nodeType!==1)return"";var _=p.tagName.toLowerCase();switch(_){case"h1":y||(E=t.subParser("makeMarkdown.header")(p,g,1)+`

`);break;case"h2":y||(E=t.subParser("makeMarkdown.header")(p,g,2)+`

`);break;case"h3":y||(E=t.subParser("makeMarkdown.header")(p,g,3)+`

`);break;case"h4":y||(E=t.subParser("makeMarkdown.header")(p,g,4)+`

`);break;case"h5":y||(E=t.subParser("makeMarkdown.header")(p,g,5)+`

`);break;case"h6":y||(E=t.subParser("makeMarkdown.header")(p,g,6)+`

`);break;case"p":y||(E=t.subParser("makeMarkdown.paragraph")(p,g)+`

`);break;case"blockquote":y||(E=t.subParser("makeMarkdown.blockquote")(p,g)+`

`);break;case"hr":y||(E=t.subParser("makeMarkdown.hr")(p,g)+`

`);break;case"ol":y||(E=t.subParser("makeMarkdown.list")(p,g,"ol")+`

`);break;case"ul":y||(E=t.subParser("makeMarkdown.list")(p,g,"ul")+`

`);break;case"precode":y||(E=t.subParser("makeMarkdown.codeBlock")(p,g)+`

`);break;case"pre":y||(E=t.subParser("makeMarkdown.pre")(p,g)+`

`);break;case"table":y||(E=t.subParser("makeMarkdown.table")(p,g)+`

`);break;case"code":E=t.subParser("makeMarkdown.codeSpan")(p,g);break;case"em":case"i":E=t.subParser("makeMarkdown.emphasis")(p,g);break;case"strong":case"b":E=t.subParser("makeMarkdown.strong")(p,g);break;case"del":E=t.subParser("makeMarkdown.strikethrough")(p,g);break;case"a":E=t.subParser("makeMarkdown.links")(p,g);break;case"img":E=t.subParser("makeMarkdown.image")(p,g);break;default:E=p.outerHTML+`

`}return E}),t.subParser("makeMarkdown.paragraph",function(p,g){"use strict";var y="";if(p.hasChildNodes())for(var E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);return y=y.trim(),y}),t.subParser("makeMarkdown.pre",function(p,g){"use strict";var y=p.getAttribute("prenum");return"<pre>"+g.preList[y]+"</pre>"}),t.subParser("makeMarkdown.strikethrough",function(p,g){"use strict";var y="";if(p.hasChildNodes()){y+="~~";for(var E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);y+="~~"}return y}),t.subParser("makeMarkdown.strong",function(p,g){"use strict";var y="";if(p.hasChildNodes()){y+="**";for(var E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g);y+="**"}return y}),t.subParser("makeMarkdown.table",function(p,g){"use strict";var y="",E=[[],[]],_=p.querySelectorAll("thead>tr>th"),x=p.querySelectorAll("tbody>tr"),S,I;for(S=0;S<_.length;++S){var k=t.subParser("makeMarkdown.tableCell")(_[S],g),N="---";if(_[S].hasAttribute("style")){var L=_[S].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(L){case"text-align:left;":N=":---";break;case"text-align:right;":N="---:";break;case"text-align:center;":N=":---:";break}}E[0][S]=k.trim(),E[1][S]=N}for(S=0;S<x.length;++S){var G=E.push([])-1,R=x[S].getElementsByTagName("td");for(I=0;I<_.length;++I){var K=" ";typeof R[I]<"u"&&(K=t.subParser("makeMarkdown.tableCell")(R[I],g)),E[G].push(K)}}var F=3;for(S=0;S<E.length;++S)for(I=0;I<E[S].length;++I){var J=E[S][I].length;J>F&&(F=J)}for(S=0;S<E.length;++S){for(I=0;I<E[S].length;++I)S===1?E[S][I].slice(-1)===":"?E[S][I]=t.helper.padEnd(E[S][I].slice(-1),F-1,"-")+":":E[S][I]=t.helper.padEnd(E[S][I],F,"-"):E[S][I]=t.helper.padEnd(E[S][I],F);y+="| "+E[S].join(" | ")+` |
`}return y.trim()}),t.subParser("makeMarkdown.tableCell",function(p,g){"use strict";var y="";if(!p.hasChildNodes())return"";for(var E=p.childNodes,_=E.length,x=0;x<_;++x)y+=t.subParser("makeMarkdown.node")(E[x],g,!0);return y.trim()}),t.subParser("makeMarkdown.txt",function(p){"use strict";var g=p.nodeValue;return g=g.replace(/ +/g," "),g=g.replace(/¨NBSP;/g," "),g=t.helper.unescapeHTMLEntities(g),g=g.replace(/([*_~|`])/g,"\\$1"),g=g.replace(/^(\s*)>/g,"\\$1>"),g=g.replace(/^#/gm,"\\#"),g=g.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),g=g.replace(/^( {0,3}\d+)\./gm,"$1\\."),g=g.replace(/^( {0,3})([+-])/gm,"$1\\$2"),g=g.replace(/]([\s]*)\(/g,"\\]$1\\("),g=g.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),g});var T=this;typeof define=="function"&&define.amd?define(function(){"use strict";return t}):typeof pg<"u"&&pg.exports?pg.exports=t:T.showdown=t}).call(aI)});var LI=B((CEe,OI)=>{"use strict";OI.exports=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}});var m7=B((FI,VI)=>{"use strict";var yg=LI(),{hasOwnProperty:MI}=Object.prototype,{propertyIsEnumerable:Tne}=Object,ld=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),Ane=FI,BI={concatArrays:!1,ignoreUndefined:!1},wg=r=>{let e=[];for(let t in r)MI.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)Tne.call(r,n)&&e.push(n)}return e};function fd(r){return Array.isArray(r)?Ine(r):yg(r)?Rne(r):r}function Ine(r){let e=r.slice(0,0);return wg(r).forEach(t=>{ld(e,t,fd(r[t]))}),e}function Rne(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return wg(r).forEach(t=>{ld(e,t,fd(r[t]))}),e}var UI=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?ld(r,i,p7(r[i],e[i],n)):ld(r,i,fd(e[i])))}),r),Cne=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{let o=[];for(let a=0;a<s.length;a++)MI.call(s,a)&&(o.push(String(a)),s===r?ld(n,i++,s[a]):ld(n,i++,fd(s[a])));n=UI(n,s,wg(s).filter(a=>!o.includes(a)),t)}),n};function p7(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?Cne(r,e,t):!yg(e)||!yg(r)?fd(e):UI(r,e,wg(e),t)}VI.exports=function(...r){let e=p7(fd(BI),this!==Ane&&this||{},BI),t={_:{}};for(let n of r)if(n!==void 0){if(!yg(n))throw new TypeError("`"+n+"` is not an Option Object");t=p7(t,{_:n},e)}return t._}});var g7=B((kEe,KI)=>{function Pne(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}KI.exports=Pne});var _g=B((DEe,HI)=>{"use strict";var kne=g7(),bg=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,cp=kne(),Dne=bg&&!cp,Nne=cp&&!bg,One=cp&&bg,Lne=typeof ed=="function"&&typeof process<"u"&&typeof process.release<"u"&&process.release.name==="node"&&!cp,Bne=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Mne=typeof process<"u"&&typeof process.env<"u"&&!1,Une=typeof navigator<"u"&&navigator.product==="ReactNative";HI.exports={isTest:Mne,isElectron:cp,isElectronMain:Nne,isElectronRenderer:One,isNode:Lne,isBrowser:Dne,isWebWorker:Bne,isEnvWithDom:bg,isReactNative:Une}});var qI=B((OEe,$I)=>{var dd=1e3,hd=dd*60,pd=hd*60,sl=pd*24,Fne=sl*7,Vne=sl*365.25;$I.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return zne(r);if(t==="number"&&isFinite(r))return e.long?Hne(r):Kne(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function zne(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Vne;case"weeks":case"week":case"w":return t*Fne;case"days":case"day":case"d":return t*sl;case"hours":case"hour":case"hrs":case"hr":case"h":return t*pd;case"minutes":case"minute":case"mins":case"min":case"m":return t*hd;case"seconds":case"second":case"secs":case"sec":case"s":return t*dd;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Kne(r){var e=Math.abs(r);return e>=sl?Math.round(r/sl)+"d":e>=pd?Math.round(r/pd)+"h":e>=hd?Math.round(r/hd)+"m":e>=dd?Math.round(r/dd)+"s":r+"ms"}function Hne(r){var e=Math.abs(r);return e>=sl?Eg(r,e,sl,"day"):e>=pd?Eg(r,e,pd,"hour"):e>=hd?Eg(r,e,hd,"minute"):e>=dd?Eg(r,e,dd,"second"):r+" ms"}function Eg(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var jI=B((LEe,GI)=>{function $ne(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=qI(),t.destroy=u,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let h=0;h<l.length;h++)f=(f<<5)-f+l.charCodeAt(h),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,h=null,d,m;function w(...b){if(!w.enabled)return;let v=w,T=Number(new Date),p=T-(f||T);v.diff=p,v.prev=f,v.curr=T,f=T,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let g=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(E,_)=>{if(E==="%%")return"%";g++;let x=t.formatters[_];if(typeof x=="function"){let S=b[g];E=x.call(v,S),b.splice(g,1),g--}return E}),t.formatArgs.call(v,b),(v.log||t.log).apply(v,b)}return w.namespace=l,w.useColors=t.useColors(),w.color=t.selectColor(l),w.extend=n,w.destroy=t.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(d!==t.namespaces&&(d=t.namespaces,m=t.enabled(l)),m),set:b=>{h=b}}),typeof t.init=="function"&&t.init(w),w}function n(l,f){let h=t(this.namespace+(typeof f>"u"?":":f)+l);return h.log=this.log,h}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f,h=(typeof l=="string"?l:"").split(/[\s,]+/),d=h.length;for(f=0;f<d;f++)h[f]&&(l=h[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){let l=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,h;for(f=0,h=t.skips.length;f<h;f++)if(t.skips[f].test(l))return!1;for(f=0,h=t.names.length;f<h;f++)if(t.names[f].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}GI.exports=$ne});var Gi=B((mi,vg)=>{mi.formatArgs=Gne;mi.save=jne;mi.load=Wne;mi.useColors=qne;mi.storage=Yne();mi.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();mi.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function qne(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Gne(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+vg.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}mi.log=console.debug||console.log||(()=>{});function jne(r){try{r?mi.storage.setItem("debug",r):mi.storage.removeItem("debug")}catch{}}function Wne(){let r;try{r=mi.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Yne(){try{return localStorage}catch{}}vg.exports=jI()(mi);var{formatters:Qne}=vg.exports;Qne.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Y=B((zEe,YI)=>{"use strict";function WI(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Jne(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return WI(r,t)}catch{t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),WI(new i,t)}}YI.exports=Jne});var w7=B((KEe,QI)=>{"use strict";QI.exports=eie;function eie(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(l){if(s)if(s=!1,l)c(l);else{for(var f=new Array(arguments.length-1),h=0;h<f.length;)f[h++]=arguments[h];a.apply(null,f)}};try{r.apply(e||null,t)}catch(u){s&&(s=!1,c(u))}})}});var b7=B(JI=>{"use strict";var Sg=JI;Sg.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var gd=new Array(64),ZI=new Array(123);for(Ts=0;Ts<64;)ZI[gd[Ts]=Ts<26?Ts+65:Ts<52?Ts+71:Ts<62?Ts-4:Ts-59|43]=Ts++;var Ts;Sg.encode=function(e,t,n){for(var i=null,s=[],o=0,a=0,c;t<n;){var u=e[t++];switch(a){case 0:s[o++]=gd[u>>2],c=(u&3)<<4,a=1;break;case 1:s[o++]=gd[c|u>>4],c=(u&15)<<2,a=2;break;case 2:s[o++]=gd[c|u>>6],s[o++]=gd[u&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=gd[c],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var XI="invalid encoding";Sg.decode=function(e,t,n){for(var i=n,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=ZI[c])===void 0)throw Error(XI);switch(s){case 0:o=c,s=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[n++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(XI);return n-i};Sg.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var _7=B(($Ee,eR)=>{"use strict";eR.exports=xg;function xg(){this._listeners={}}xg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};xg.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};xg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var E7=B((qEe,oR)=>{"use strict";oR.exports=tR(tR);function tR(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,u,l){e[0]=c,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3]}function s(c,u,l){e[0]=c,u[l]=t[3],u[l+1]=t[2],u[l+2]=t[1],u[l+3]=t[0]}r.writeFloatLE=n?i:s,r.writeFloatBE=n?s:i;function o(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],e[0]}function a(c,u){return t[3]=c[u],t[2]=c[u+1],t[1]=c[u+2],t[0]=c[u+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(i)/Math.LN2),u=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|u)>>>0,s,o)}}r.writeFloatLE=e.bind(null,rR),r.writeFloatBE=e.bind(null,nR);function t(n,i,s){var o=n(i,s),a=(o>>31)*2+1,c=o>>>23&255,u=o&8388607;return c===255?u?NaN:a*(1/0):c===0?a*1401298464324817e-60*u:a*Math.pow(2,c-150)*(u+8388608)}r.readFloatLE=t.bind(null,iR),r.readFloatBE=t.bind(null,sR)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,u,l){e[0]=c,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3],u[l+4]=t[4],u[l+5]=t[5],u[l+6]=t[6],u[l+7]=t[7]}function s(c,u,l){e[0]=c,u[l]=t[7],u[l+1]=t[6],u[l+2]=t[5],u[l+3]=t[4],u[l+4]=t[3],u[l+5]=t[2],u[l+6]=t[1],u[l+7]=t[0]}r.writeDoubleLE=n?i:s,r.writeDoubleBE=n?s:i;function o(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],t[4]=c[u+4],t[5]=c[u+5],t[6]=c[u+6],t[7]=c[u+7],e[0]}function a(c,u){return t[7]=c[u],t[6]=c[u+1],t[5]=c[u+2],t[4]=c[u+3],t[3]=c[u+4],t[2]=c[u+5],t[1]=c[u+6],t[0]=c[u+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,c){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,a,c+i),n(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))n(0,a,c+i),n(2146959360,a,c+s);else if(o>17976931348623157e292)n(0,a,c+i),n((u<<31|2146435072)>>>0,a,c+s);else{var l;if(o<22250738585072014e-324)l=o/5e-324,n(l>>>0,a,c+i),n((u<<31|l/4294967296)>>>0,a,c+s);else{var f=Math.floor(Math.log(o)/Math.LN2);f===1024&&(f=1023),l=o*Math.pow(2,-f),n(l*4503599627370496>>>0,a,c+i),n((u<<31|f+1023<<20|l*1048576&1048575)>>>0,a,c+s)}}}r.writeDoubleLE=e.bind(null,rR,0,4),r.writeDoubleBE=e.bind(null,nR,4,0);function t(n,i,s,o,a){var c=n(o,a+i),u=n(o,a+s),l=(u>>31)*2+1,f=u>>>20&2047,h=4294967296*(u&1048575)+c;return f===2047?h?NaN:l*(1/0):f===0?l*5e-324*h:l*Math.pow(2,f-1075)*(h+4503599627370496)}r.readDoubleLE=t.bind(null,iR,0,4),r.readDoubleBE=t.bind(null,sR,4,0)}(),r}function rR(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function nR(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function iR(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function sR(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var v7=B((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var x7=B(aR=>{"use strict";var S7=aR;S7.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};S7.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var s=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};S7.write=function(e,t,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128);return n-i}});var T7=B((jEe,cR)=>{"use strict";cR.exports=tie;function tie(r,e,t){var n=t||8192,i=n>>>1,s=null,o=n;return function(c){if(c<1||c>i)return r(c);o+c>n&&(s=r(n),o=0);var u=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),u}}});var lR=B((WEe,uR)=>{"use strict";uR.exports=sn;var up=pa();function sn(r,e){this.lo=r>>>0,this.hi=e>>>0}var ol=sn.zero=new sn(0,0);ol.toNumber=function(){return 0};ol.zzEncode=ol.zzDecode=function(){return this};ol.length=function(){return 1};var rie=sn.zeroHash="\0\0\0\0\0\0\0\0";sn.fromNumber=function(e){if(e===0)return ol;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new sn(n,i)};sn.from=function(e){if(typeof e=="number")return sn.fromNumber(e);if(up.isString(e))if(up.Long)e=up.Long.fromString(e);else return sn.fromNumber(parseInt(e,10));return e.low||e.high?new sn(e.low>>>0,e.high>>>0):ol};sn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};sn.prototype.toLong=function(e){return up.Long?new up.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Ac=String.prototype.charCodeAt;sn.fromHash=function(e){return e===rie?ol:new sn((Ac.call(e,0)|Ac.call(e,1)<<8|Ac.call(e,2)<<16|Ac.call(e,3)<<24)>>>0,(Ac.call(e,4)|Ac.call(e,5)<<8|Ac.call(e,6)<<16|Ac.call(e,7)<<24)>>>0)};sn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};sn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};sn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};sn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var pa=B(A7=>{"use strict";var Ee=A7;Ee.asPromise=w7();Ee.base64=b7();Ee.EventEmitter=_7();Ee.float=E7();Ee.inquire=v7();Ee.utf8=x7();Ee.pool=T7();Ee.LongBits=lR();Ee.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Ee.global=Ee.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||A7;Ee.emptyArray=Object.freeze?Object.freeze([]):[];Ee.emptyObject=Object.freeze?Object.freeze({}):{};Ee.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ee.isString=function(e){return typeof e=="string"||e instanceof String};Ee.isObject=function(e){return e&&typeof e=="object"};Ee.isset=Ee.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Ee.Buffer=function(){try{var r=Ee.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Ee._Buffer_from=null;Ee._Buffer_allocUnsafe=null;Ee.newBuffer=function(e){return typeof e=="number"?Ee.Buffer?Ee._Buffer_allocUnsafe(e):new Ee.Array(e):Ee.Buffer?Ee._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ee.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ee.Long=Ee.global.dcodeIO&&Ee.global.dcodeIO.Long||Ee.global.Long||Ee.inquire("long");Ee.key2Re=/^true|false|0|1$/;Ee.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ee.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ee.longToHash=function(e){return e?Ee.LongBits.from(e).toHash():Ee.LongBits.zeroHash};Ee.longFromHash=function(e,t){var n=Ee.LongBits.fromHash(e);return Ee.Long?Ee.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function fR(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Ee.merge=fR;Ee.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function dR(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&fR(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Ee.newError=dR;Ee.ProtocolError=dR("ProtocolError");Ee.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Ee.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Ee.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ee._configure=function(){var r=Ee.Buffer;if(!r){Ee._Buffer_from=Ee._Buffer_allocUnsafe=null;return}Ee._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Ee._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var Ag=B((QEe,gR)=>{"use strict";gR.exports=Tt;var ji=pa(),I7,Tg=ji.LongBits,hR=ji.base64,pR=ji.utf8;function lp(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function C7(){}function nie(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Tt(){this.len=0,this.head=new lp(C7,0,0),this.tail=this.head,this.states=null}var mR=function(){return ji.Buffer?function(){return(Tt.create=function(){return new I7})()}:function(){return new Tt}};Tt.create=mR();Tt.alloc=function(e){return new ji.Array(e)};ji.Array!==Array&&(Tt.alloc=ji.pool(Tt.alloc,ji.Array.prototype.subarray));Tt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new lp(e,t,n),this.len+=t,this};function P7(r,e,t){e[t]=r&255}function iie(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function k7(r,e){this.len=r,this.next=void 0,this.val=e}k7.prototype=Object.create(lp.prototype);k7.prototype.fn=iie;Tt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new k7((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Tt.prototype.int32=function(e){return e<0?this._push(D7,10,Tg.fromNumber(e)):this.uint32(e)};Tt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function D7(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Tt.prototype.uint64=function(e){var t=Tg.from(e);return this._push(D7,t.length(),t)};Tt.prototype.int64=Tt.prototype.uint64;Tt.prototype.sint64=function(e){var t=Tg.from(e).zzEncode();return this._push(D7,t.length(),t)};Tt.prototype.bool=function(e){return this._push(P7,1,e?1:0)};function R7(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Tt.prototype.fixed32=function(e){return this._push(R7,4,e>>>0)};Tt.prototype.sfixed32=Tt.prototype.fixed32;Tt.prototype.fixed64=function(e){var t=Tg.from(e);return this._push(R7,4,t.lo)._push(R7,4,t.hi)};Tt.prototype.sfixed64=Tt.prototype.fixed64;Tt.prototype.float=function(e){return this._push(ji.float.writeFloatLE,4,e)};Tt.prototype.double=function(e){return this._push(ji.float.writeDoubleLE,8,e)};var sie=ji.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Tt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(P7,1,0);if(ji.isString(e)){var n=Tt.alloc(t=hR.length(e));hR.decode(e,n,0),e=n}return this.uint32(t)._push(sie,t,e)};Tt.prototype.string=function(e){var t=pR.length(e);return t?this.uint32(t)._push(pR.write,t,e):this._push(P7,1,0)};Tt.prototype.fork=function(){return this.states=new nie(this),this.head=this.tail=new lp(C7,0,0),this.len=0,this};Tt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new lp(C7,0,0),this.len=0),this};Tt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Tt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Tt._configure=function(r){I7=r,Tt.create=mR(),I7._configure()}});var N7=B((XEe,wR)=>{"use strict";wR.exports=uo;var yR=Ag();(uo.prototype=Object.create(yR.prototype)).constructor=uo;var Ic=pa();function uo(){yR.call(this)}uo._configure=function(){uo.alloc=Ic._Buffer_allocUnsafe,uo.writeBytesBuffer=Ic.Buffer&&Ic.Buffer.prototype instanceof Uint8Array&&Ic.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};uo.prototype.bytes=function(e){Ic.isString(e)&&(e=Ic._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(uo.writeBytesBuffer,t,e),this};function oie(r,e,t){r.length<40?Ic.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}uo.prototype.string=function(e){var t=Ic.Buffer.byteLength(e);return this.uint32(t),t&&this._push(oie,t,e),this};uo._configure()});var Rg=B((ZEe,SR)=>{"use strict";SR.exports=Nr;var lo=pa(),L7,ER=lo.LongBits,aie=lo.utf8;function As(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function Nr(r){this.buf=r,this.pos=0,this.len=r.length}var bR=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Nr(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Nr(e);throw Error("illegal buffer")},vR=function(){return lo.Buffer?function(t){return(Nr.create=function(i){return lo.Buffer.isBuffer(i)?new L7(i):bR(i)})(t)}:bR};Nr.create=vR();Nr.prototype._slice=lo.Array.prototype.subarray||lo.Array.prototype.slice;Nr.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,As(this,10);return e}}();Nr.prototype.int32=function(){return this.uint32()|0};Nr.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function O7(){var r=new ER(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw As(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw As(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Nr.prototype.bool=function(){return this.uint32()!==0};function Ig(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}Nr.prototype.fixed32=function(){if(this.pos+4>this.len)throw As(this,4);return Ig(this.buf,this.pos+=4)};Nr.prototype.sfixed32=function(){if(this.pos+4>this.len)throw As(this,4);return Ig(this.buf,this.pos+=4)|0};function _R(){if(this.pos+8>this.len)throw As(this,8);return new ER(Ig(this.buf,this.pos+=4),Ig(this.buf,this.pos+=4))}Nr.prototype.float=function(){if(this.pos+4>this.len)throw As(this,4);var e=lo.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Nr.prototype.double=function(){if(this.pos+8>this.len)throw As(this,4);var e=lo.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Nr.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw As(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Nr.prototype.string=function(){var e=this.bytes();return aie.read(e,0,e.length)};Nr.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw As(this,e);this.pos+=e}else do if(this.pos>=this.len)throw As(this);while(this.buf[this.pos++]&128);return this};Nr.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Nr._configure=function(r){L7=r,Nr.create=vR(),L7._configure();var e=lo.Long?"toLong":"toNumber";lo.merge(Nr.prototype,{int64:function(){return O7.call(this)[e](!1)},uint64:function(){return O7.call(this)[e](!0)},sint64:function(){return O7.call(this).zzDecode()[e](!1)},fixed64:function(){return _R.call(this)[e](!0)},sfixed64:function(){return _R.call(this)[e](!1)}})}});var B7=B((JEe,AR)=>{"use strict";AR.exports=al;var TR=Rg();(al.prototype=Object.create(TR.prototype)).constructor=al;var xR=pa();function al(r){TR.call(this,r)}al._configure=function(){xR.Buffer&&(al.prototype._slice=xR.Buffer.prototype.slice)};al.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};al._configure()});var RR=B((e9e,IR)=>{"use strict";IR.exports=fp;var M7=pa();(fp.prototype=Object.create(M7.EventEmitter.prototype)).constructor=fp;function fp(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");M7.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}fp.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return M7.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,e),s(l)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};fp.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var PR=B(CR=>{"use strict";var cie=CR;cie.Service=RR()});var DR=B((r9e,kR)=>{"use strict";kR.exports={}});var LR=B(OR=>{"use strict";var Jn=OR;Jn.build="minimal";Jn.Writer=Ag();Jn.BufferWriter=N7();Jn.Reader=Rg();Jn.BufferReader=B7();Jn.util=pa();Jn.rpc=PR();Jn.roots=DR();Jn.configure=NR;function NR(){Jn.util._configure(),Jn.Writer._configure(Jn.BufferWriter),Jn.Reader._configure(Jn.BufferReader)}NR()});var fo=B((i9e,BR)=>{"use strict";BR.exports=LR()});var _P=B((oSe,bP)=>{"use strict";bP.exports=function(){return Date.now()}});var hb=B((aSe,EP)=>{"use strict";var Gg=_P(),db=class{constructor(e,t,n){let i=this;this._started=Gg(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(Gg()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=Gg();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=Gg(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}};function Hse(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new db(arguments[0],arguments[1],r)}EP.exports=Hse});var en=B((cSe,SP)=>{"use strict";var{AbortController:$se}=globalThis,vP=hb(),Sp=class extends $se{constructor(e){super(),this._ms=e,this._timer=vP(()=>this.abort(),e),Object.setPrototypeOf(this,Sp.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=vP(()=>this.abort(),this._ms)}};SP.exports={TimeoutController:Sp}});var OP=B((ESe,NP)=>{NP.exports=gb;var DP=128,Qse=127,Xse=~Qse,Zse=Math.pow(2,31);function gb(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw gb.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=Zse;)e[t++]=r&255|DP,r/=128;for(;r&Xse;)e[t++]=r&255|DP,r>>>=7;return e[t]=r|0,gb.bytes=t-n+1,e}});var MP=B((vSe,BP)=>{BP.exports=yb;var Jse=128,LP=127;function yb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a||i>49)throw yb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&LP)<<i:(o&LP)*Math.pow(2,i),i+=7}while(o>=Jse);return yb.bytes=s-n,t}});var FP=B((SSe,UP)=>{var eoe=Math.pow(2,7),toe=Math.pow(2,14),roe=Math.pow(2,21),noe=Math.pow(2,28),ioe=Math.pow(2,35),soe=Math.pow(2,42),ooe=Math.pow(2,49),aoe=Math.pow(2,56),coe=Math.pow(2,63);UP.exports=function(r){return r<eoe?1:r<toe?2:r<roe?3:r<noe?4:r<ioe?5:r<soe?6:r<ooe?7:r<aoe?8:r<coe?9:10}});var po=B((xSe,VP)=>{VP.exports={encode:OP(),decode:MP(),encodingLength:FP()}});var kb=B((XSe,ak)=>{"use strict";var Poe=typeof navigator<"u"&&navigator.product==="ReactNative";function koe(){return Poe?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}var Pp=self.URL,ok=koe(),Pb=class{constructor(e="",t=ok){this.super=new Pp(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return Pp.createObjectURL(e)}static revokeObjectURL(e){Pp.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}};function Doe(r){if(typeof r=="string")return new Pp(r).toString();if(!(r instanceof Pp)){let e=r.username&&r.password?`${r.username}:${r.password}@`:"",t=r.auth?r.auth+"@":"",n=r.port?":"+r.port:"",i=r.protocol?r.protocol+"//":"",s=r.host||"",o=r.hostname||"",a=r.search||(r.query?"?"+r.query:""),c=r.hash||"",u=r.pathname||"",l=r.path||u+a;return`${i}${e||t}${s||o+n}${l}${c}`}}ak.exports={URLWithLegacySupport:Pb,URLSearchParams:self.URLSearchParams,defaultBase:ok,format:Doe}});var lk=B((ZSe,uk)=>{"use strict";var{URLWithLegacySupport:ck,format:Noe}=kb();uk.exports=(r,e={},t={},n)=>{let i=e.protocol?e.protocol.replace(":",""):"http";i=(t[i]||n||i)+":";let s;try{s=new ck(r)}catch{s={}}let o=Object.assign({},e,{protocol:i||s.protocol,host:e.host||s.host});return new ck(r,Noe(o)).toString()}});var r3=B((JSe,fk)=>{"use strict";var{URLWithLegacySupport:Ooe,format:Loe,URLSearchParams:Boe,defaultBase:Moe}=kb(),Uoe=lk();fk.exports={URL:Ooe,URLSearchParams:Boe,format:Loe,relative:Uoe,defaultBase:Moe}});var Kn=B((lxe,Db)=>{function vk(r){let e=new globalThis.AbortController;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}Db.exports=vk;Db.exports.anySignal=vk});var Dp=B((Pxe,Dk)=>{Dk.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var Lk=B((Dxe,Lb)=>{"use strict";var qoe=Object.prototype.hasOwnProperty,Hn="~";function Np(){}Object.create&&(Np.prototype=Object.create(null),new Np().__proto__||(Hn=!1));function Goe(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Ok(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new Goe(t,n||r,i),o=Hn?Hn+e:e;return r._events[o]?r._events[o].fn?r._events[o]=[r._events[o],s]:r._events[o].push(s):(r._events[o]=s,r._eventsCount++),r}function h3(r,e){--r._eventsCount===0?r._events=new Np:delete r._events[e]}function Nn(){this._events=new Np,this._eventsCount=0}Nn.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)qoe.call(t,n)&&e.push(Hn?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Nn.prototype.listeners=function(e){var t=Hn?Hn+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o};Nn.prototype.listenerCount=function(e){var t=Hn?Hn+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Nn.prototype.emit=function(e,t,n,i,s,o){var a=Hn?Hn+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,l,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,s),!0;case 6:return c.fn.call(c.context,t,n,i,s,o),!0}for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c.fn.apply(c.context,l)}else{var h=c.length,d;for(f=0;f<h;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),u){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,i);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[f].fn.apply(c[f].context,l)}}return!0};Nn.prototype.on=function(e,t,n){return Ok(this,e,t,n,!1)};Nn.prototype.once=function(e,t,n){return Ok(this,e,t,n,!0)};Nn.prototype.removeListener=function(e,t,n,i){var s=Hn?Hn+e:e;if(!this._events[s])return this;if(!t)return h3(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!n||o.context===n)&&h3(this,s);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==t||i&&!o[a].once||n&&o[a].context!==n)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:h3(this,s)}return this};Nn.prototype.removeAllListeners=function(e){var t;return e?(t=Hn?Hn+e:e,this._events[t]&&h3(this,t)):(this._events=new Np,this._eventsCount=0),this};Nn.prototype.off=Nn.prototype.removeListener;Nn.prototype.addListener=Nn.prototype.on;Nn.prefixed=Hn;Nn.EventEmitter=Nn;typeof Lb<"u"&&(Lb.exports=Nn)});var Hb=B(v3=>{"use strict";var Vb=class extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}};v3.TimeoutError=Vb;var zb=class extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}};v3.AbortError=zb;var Kb=class extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}};v3.HTTPError=Kb});var zp=B((Od,qk)=>{"use strict";var joe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},ml=joe();qk.exports=Od=ml.fetch;ml.fetch&&(Od.default=ml.fetch.bind(ml));Od.Headers=ml.Headers;Od.Request=ml.Request;Od.Response=ml.Response});var Gk=B((zxe,$b)=>{"use strict";globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?$b.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:$b.exports={default:zp().default,Headers:zp().Headers,Request:zp().Request,Response:zp().Response}});var Wk=B((Kxe,jk)=>{"use strict";jk.exports=Gk()});var Xk=B((Hxe,Qk)=>{"use strict";var{TimeoutError:Woe,AbortError:Yoe}=Hb(),{Response:Yk,Request:Qoe,Headers:Gb,default:Xoe}=Wk(),Zoe=(r,e={})=>{let t=new XMLHttpRequest;t.open(e.method||"GET",r.toString(),!0);let{timeout:n,headers:i}=e;if(n&&n>0&&n<1/0&&(t.timeout=n),e.overrideMimeType!=null&&t.overrideMimeType(e.overrideMimeType),i)for(let[s,o]of new Gb(i))t.setRequestHeader(s,o);return e.signal&&(e.signal.onabort=()=>t.abort()),e.onUploadProgress&&(t.upload.onprogress=e.onUploadProgress),t.responseType="arraybuffer",new Promise((s,o)=>{let a=c=>{switch(c.type){case"error":{s(Yk.error());break}case"load":{s(new qb(t.responseURL,t.response,{status:t.status,statusText:t.statusText,headers:tae(t.getAllResponseHeaders())}));break}case"timeout":{o(new Woe);break}case"abort":{o(new Yoe);break}default:break}};t.onerror=a,t.onload=a,t.ontimeout=a,t.onabort=a,t.send(e.body)})},Joe=Xoe,eae=(r,e={})=>e.onUploadProgress!=null?Zoe(r,e):Joe(r,e),tae=r=>{let e=new Gb;for(let t of r.trim().split(/[\r\n]+/)){let n=t.indexOf(": ");n>0&&e.set(t.slice(0,n),t.slice(n+1))}return e},qb=class extends Yk{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}};Qk.exports={fetch:eae,Request:Qoe,Headers:Gb}});var Jk=B(($xe,Zk)=>{"use strict";async function*rae(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&t.cancel(),t.releaseLock()}}Zk.exports=rae});var tD=B((qxe,eD)=>{"use strict";var nae=async r=>{let e=[];for await(let t of r)e.push(t);return e};eD.exports=nae});var Ld=B((Gxe,aD)=>{"use strict";var{fetch:iae,Request:sae,Headers:oae}=Xk(),{TimeoutError:jb,HTTPError:sD}=Hb(),rD=m7().bind({ignoreUndefined:!0}),{URL:nD,URLSearchParams:iD}=r3(),aae=Kn(),cae=Jk(),{isBrowser:uae,isWebWorker:lae}=_g(),fae=tD(),dae=(r,e,t)=>{if(e===void 0)return r;let n=Date.now(),i=()=>Date.now()-n>=e;return new Promise((s,o)=>{let a=setTimeout(()=>{i()&&(o(new jb),t.abort())},e),c=u=>f=>{if(clearTimeout(a),i()){o(new jb);return}u(f)};r.then(c(s),c(o))})},hae={throwHttpErrors:!0,credentials:"same-origin"},On=class{constructor(e={}){this.opts=rD(hae,e)}async fetch(e,t={}){let n=rD(this.opts,t),i=new oae(n.headers);if(typeof e!="string"&&!(e instanceof nD||e instanceof sae))throw new TypeError("`resource` must be a string, URL, or Request");let s=new nD(e.toString(),n.base),{searchParams:o,transformSearchParams:a,json:c}=n;o&&(typeof a=="function"?s.search=a(new iD(n.searchParams)):s.search=new iD(n.searchParams)),c&&(n.body=JSON.stringify(n.json),i.set("content-type","application/json"));let u=new AbortController,l=aae([u.signal,n.signal]);globalThis.ReadableStream!=null&&n.body instanceof globalThis.ReadableStream&&(uae||lae)&&(n.body=new Blob(await fae(cae(n.body))));let f=await dae(iae(s.toString(),{...n,signal:l,timeout:void 0,headers:i,duplex:"half"}),n.timeout,u);if(!f.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(f),new sD(f);return f.iterator=async function*(){yield*oD(f.body)},f.ndjson=async function*(){for await(let h of pae(f.iterator()))t.transform?yield t.transform(h):yield h},f}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}},pae=async function*(r){let e=new TextDecoder,t="";for await(let n of r){t+=e.decode(n,{stream:!0});let i=t.split(/\r?\n/);for(let s=0;s<i.length-1;s++){let o=i[s].trim();o.length>0&&(yield JSON.parse(o))}t=i[i.length-1]}t+=e.decode(),t=t.trim(),t.length!==0&&(yield JSON.parse(t))},oD=r=>{if(mae(r))return r;if(yae(r)){let e=r[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:e.next.bind(e),return(t){return r.destroy(),typeof e.return=="function"?e.return():Promise.resolve({done:!0,value:t})}}}}}if(gae(r)){let e=r.getReader();return async function*(){try{for(;;){let{done:t,value:n}=await e.read();if(t)return;n&&(yield n)}}finally{e.releaseLock()}}()}throw new TypeError("Body can't be converted to AsyncIterable")},mae=r=>typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function",gae=r=>r&&typeof r.getReader=="function",yae=r=>Object.prototype.hasOwnProperty.call(r,"readable")&&Object.prototype.hasOwnProperty.call(r,"writable");On.HTTPError=sD;On.TimeoutError=jb;On.streamToAsyncIterator=oD;On.post=(r,e)=>new On(e).post(r,e);On.get=(r,e)=>new On(e).get(r,e);On.put=(r,e)=>new On(e).put(r,e);On.delete=(r,e)=>new On(e).delete(r,e);On.options=(r,e)=>new On(e).options(r,e);aD.exports=On});var vD=B((jTe,Jb)=>{var GTe=function(){typeof Jb<"u"&&(Jb.exports=w);var r=86400,e=3200,t=146097*e/400,n=r*t,i=1e3*n,s=864e13,o=4294967296,a=1e6,c="000000000",u=Math.trunc||function(x){var S=x-x%1;return S==0&&(x<0||x===0&&1/x!=1/0)?-0:S},l=w.prototype,f=(w.fromDate=function(x){return new w(+x)},w.fromInt64BE=g(0,1,2,3,0,4),w.fromInt64LE=g(3,2,1,0,4,0),w.fromString=function(k){var S,I=new w,k=(k+="").replace(/^\s*[+\-]?\d+/,function(L){var L=+L,G=1970+(L-1970)%400;return I.year=L-G,G}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(N,L,G){return L<0&&(G*=-1),S=6e4*(60*+L+ +G),""}).replace(/\.\d+$/,function(N){return I.nano=+(N+c).substr(1,9),""}).split(/\D+/);if(1<k.length?k[1]--:k[1]=0,I.time=S=Date.UTC.apply(Date,k)-(S||0),isNaN(S))throw new TypeError("Invalid Date");return b(I)},w.fromTimeT=function(x){return T(x,0)},l.year=0,l.time=0,l.nano=0,l.addNano=function(x){return this.nano+=+x||0,this},l.getNano=function(){var x=b(this);return(x.time%1e3*a+ +x.nano+1e9)%1e9},l.getTimeT=function(){var S=b(this),x=Math.floor(S.time/1e3),S=S.year;return S&&(x+=S*t*r/e),x},l.getYear=function(){return this.toDate().getUTCFullYear()+this.year},l.toDate=function(){return v(b(this).time)},l.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},l.toString=function(x){var S=this,I=S.toDate(),k={H:function(){return E(I.getUTCHours())},L:function(){return _(I.getUTCMilliseconds(),3)},M:function(){return E(I.getUTCMinutes())},N:function(){return _(S.getNano(),9)},S:function(){return E(I.getUTCSeconds())},Y:function(){var N=S.getYear();return 999999<N?"+"+N:9999<N?"+"+_(N,6):0<=N?_(N,4):-999999<=N?"-"+_(-N,6):N},a:function(){return d[I.getUTCDay()]},b:function(){return h[I.getUTCMonth()]},d:function(){return E(I.getUTCDate())},e:function(){return function(N){return(9<N?"":" ")+(0|N)}(I.getUTCDate())},m:function(){return E(I.getUTCMonth()+1)}};return function N(L){return L.replace(/%./g,function(G){var K=G[1],R=m[K],K=k[K];return R?N(R):K?K():G})}(x||f)},l.writeInt64BE=p(0,1,2,3,0,4),l.writeInt64LE=p(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return w;function w(x,S,I){var k=this;if(!(k instanceof w))return new w(x,S,I);k.time=+x||0,k.nano=+S||0,k.year=+I||0,b(k)}function b(x){var S,I,k,N=x.year,L=x.time,G=x.nano,R=((G<0||a<=G)&&(G-=(I=Math.floor(G/a))*a,L+=I,I=1),N%e);return(L<-s||s<L||R)&&((S=u(L/i))&&(N+=S*e,L-=S*i),(k=v(L)).setUTCFullYear(R+k.getUTCFullYear()),k=(L=+k)+(S=u((N-=R)/e))*i,S&&-s<=k&&k<=s&&(N-=S*e,L=k),I=1),I&&(x.year=N,x.time=L,x.nano=G),x}function v(x){var S=new Date(0);return S.setTime(x),S}function T(N,k){N=+N||0;var I=u((k=(k|0)*o)/n)+u(N/n),k=k%n+N%n,N=u(k/n);return N&&(I+=N,k-=N*n),new w(1e3*k,0,I*e)}function p(x,S,I,k,N,L){return function(R,K){var J=b(this);R=R||new Array(8),y(R,K|=0);var ye=Math.floor(J.time/1e3),J=J.year*(t*r/e),F=u(J/o)+u(ye/o),J=J%o+ye%o,ye=Math.floor(J/o);return ye&&(F+=ye,J-=ye*o),G(R,K+N,F),G(R,K+L,J),R};function G(R,K,F){R[K+x]=F>>24&255,R[K+S]=F>>16&255,R[K+I]=F>>8&255,R[K+k]=255&F}}function g(x,S,I,k,N,L){return function(R,K){y(R,K|=0);var F=G(R,K+N);return T(G(R,K+L),F)};function G(R,K){return 16777216*R[K+x]+(R[K+S]<<16|R[K+I]<<8|R[K+k])}}function y(x,S){if(x=x&&x.length,x==null)throw new TypeError("Invalid Buffer");if(x<S+8)throw new RangeError("Out of range")}function E(x){return(9<x?"":"0")+(0|x)}function _(x,S){return(c+(0|x)).substr(-S)}}()});var it=B((fAe,ID)=>{ID.exports={options:{usePureJavaScript:!1}}});var PD=B((dAe,CD)=>{var s_={};CD.exports=s_;var RD={};s_.encode=function(r,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(r instanceof Uint8Array))n=kae(r,e);else{var i=0,s=e.length,o=e.charAt(0),a=[0];for(i=0;i<r.length;++i){for(var c=0,u=r[i];c<a.length;++c)u+=a[c]<<8,a[c]=u%s,u=u/s|0;for(;u>0;)a.push(u%s),u=u/s|0}for(i=0;r[i]===0&&i<r.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=e[a[i]]}if(t){var l=new RegExp(".{1,"+t+"}","g");n=n.match(l).join(`\r
`)}return n};s_.decode=function(r,e){if(typeof r!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=RD[e];if(!t){t=RD[e]=[];for(var n=0;n<e.length;++n)t[e.charCodeAt(n)]=n}r=r.replace(/\s/g,"");for(var i=e.length,s=e.charAt(0),o=[0],n=0;n<r.length;n++){var a=t[r.charCodeAt(n)];if(a===void 0)return;for(var c=0,u=a;c<o.length;++c)u+=o[c]*i,o[c]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var l=0;r[l]===s&&l<r.length-1;++l)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function kae(r,e){var t=0,n=e.length,i=e.charAt(0),s=[0];for(t=0;t<r.length();++t){for(var o=0,a=r.at(t);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var c="";for(t=0;r.at(t)===0&&t<r.length()-1;++t)c+=i;for(t=s.length-1;t>=0;--t)c+=e[s[t]];return c}});var Jt=B((hAe,OD)=>{var kD=it(),DD=PD(),V=OD.exports=kD.util=kD.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){V.nextTick=process.nextTick,typeof setImmediate=="function"?V.setImmediate=setImmediate:V.setImmediate=V.nextTick;return}if(typeof setImmediate=="function"){V.setImmediate=function(){return setImmediate.apply(void 0,arguments)},V.nextTick=function(a){return setImmediate(a)};return}if(V.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(c){if(c.source===window&&c.data===r){c.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(l){l()})}};var o=a,r="forge.setImmediate",e=[];V.setImmediate=function(c){e.push(c),e.length===1&&window.postMessage(r,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),n=!0,i=document.createElement("div"),e=[];new MutationObserver(function(){var c=e.slice();e.length=0,c.forEach(function(u){u()})}).observe(i,{attributes:!0});var s=V.setImmediate;V.setImmediate=function(c){Date.now()-t>15?(t=Date.now(),s(c)):(e.push(c),e.length===1&&i.setAttribute("a",n=!n))}}V.nextTick=V.setImmediate})();V.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;V.globalScope=function(){return V.isNodejs?globalThis:typeof self>"u"?window:self}();V.isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};V.isArrayBuffer=function(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer};V.isArrayBufferView=function(r){return r&&V.isArrayBuffer(r.buffer)&&r.byteLength!==void 0};function $p(r){if(!(r===8||r===16||r===24||r===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+r)}V.ByteBuffer=o_;function o_(r){if(this.data="",this.read=0,typeof r=="string")this.data=r;else if(V.isArrayBuffer(r)||V.isArrayBufferView(r))if(typeof Buffer<"u"&&r instanceof Buffer)this.data=r.toString("binary");else{var e=new Uint8Array(r);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(r instanceof o_||typeof r=="object"&&typeof r.data=="string"&&typeof r.read=="number")&&(this.data=r.data,this.read=r.read);this._constructedStringLength=0}V.ByteStringBuffer=o_;var Dae=4096;V.ByteStringBuffer.prototype._optimizeConstructedString=function(r){this._constructedStringLength+=r,this._constructedStringLength>Dae&&(this.data.substr(0,1),this._constructedStringLength=0)};V.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};V.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};V.ByteStringBuffer.prototype.putByte=function(r){return this.putBytes(String.fromCharCode(r))};V.ByteStringBuffer.prototype.fillWithByte=function(r,e){r=String.fromCharCode(r);for(var t=this.data;e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return this.data=t,this._optimizeConstructedString(e),this};V.ByteStringBuffer.prototype.putBytes=function(r){return this.data+=r,this._optimizeConstructedString(r.length),this};V.ByteStringBuffer.prototype.putString=function(r){return this.putBytes(V.encodeUtf8(r))};V.ByteStringBuffer.prototype.putInt16=function(r){return this.putBytes(String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};V.ByteStringBuffer.prototype.putInt24=function(r){return this.putBytes(String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};V.ByteStringBuffer.prototype.putInt32=function(r){return this.putBytes(String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};V.ByteStringBuffer.prototype.putInt16Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255))};V.ByteStringBuffer.prototype.putInt24Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255))};V.ByteStringBuffer.prototype.putInt32Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>24&255))};V.ByteStringBuffer.prototype.putInt=function(r,e){$p(e);var t="";do e-=8,t+=String.fromCharCode(r>>e&255);while(e>0);return this.putBytes(t)};V.ByteStringBuffer.prototype.putSignedInt=function(r,e){return r<0&&(r+=2<<e-1),this.putInt(r,e)};V.ByteStringBuffer.prototype.putBuffer=function(r){return this.putBytes(r.getBytes())};V.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};V.ByteStringBuffer.prototype.getInt16=function(){var r=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,r};V.ByteStringBuffer.prototype.getInt24=function(){var r=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,r};V.ByteStringBuffer.prototype.getInt32=function(){var r=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,r};V.ByteStringBuffer.prototype.getInt16Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,r};V.ByteStringBuffer.prototype.getInt24Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,r};V.ByteStringBuffer.prototype.getInt32Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,r};V.ByteStringBuffer.prototype.getInt=function(r){$p(r);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),r-=8;while(r>0);return e};V.ByteStringBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};V.ByteStringBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};V.ByteStringBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};V.ByteStringBuffer.prototype.at=function(r){return this.data.charCodeAt(this.read+r)};V.ByteStringBuffer.prototype.setAt=function(r,e){return this.data=this.data.substr(0,this.read+r)+String.fromCharCode(e)+this.data.substr(this.read+r+1),this};V.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};V.ByteStringBuffer.prototype.copy=function(){var r=V.createBuffer(this.data);return r.read=this.read,r};V.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};V.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};V.ByteStringBuffer.prototype.truncate=function(r){var e=Math.max(0,this.length()-r);return this.data=this.data.substr(this.read,e),this.read=0,this};V.ByteStringBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(r+="0"),r+=t.toString(16)}return r};V.ByteStringBuffer.prototype.toString=function(){return V.decodeUtf8(this.bytes())};function Nae(r,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=V.isArrayBuffer(r),n=V.isArrayBufferView(r);if(t||n){t?this.data=new DataView(r):this.data=new DataView(r.buffer,r.byteOffset,r.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,r!=null&&this.putBytes(r),"writeOffset"in e&&(this.write=e.writeOffset)}V.DataBuffer=Nae;V.DataBuffer.prototype.length=function(){return this.write-this.read};V.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};V.DataBuffer.prototype.accommodate=function(r,e){if(this.length()>=r)return this;e=Math.max(e||this.growSize,r);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(t),this.data=new DataView(n.buffer),this};V.DataBuffer.prototype.putByte=function(r){return this.accommodate(1),this.data.setUint8(this.write++,r),this};V.DataBuffer.prototype.fillWithByte=function(r,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(r);return this};V.DataBuffer.prototype.putBytes=function(r,e){if(V.isArrayBufferView(r)){var t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),n=t.byteLength-t.byteOffset;this.accommodate(n);var i=new Uint8Array(this.data.buffer,this.write);return i.set(t),this.write+=n,this}if(V.isArrayBuffer(r)){var t=new Uint8Array(r);this.accommodate(t.byteLength);var i=new Uint8Array(this.data.buffer);return i.set(t,this.write),this.write+=t.byteLength,this}if(r instanceof V.DataBuffer||typeof r=="object"&&typeof r.read=="number"&&typeof r.write=="number"&&V.isArrayBufferView(r.data)){var t=new Uint8Array(r.data.byteLength,r.read,r.length());this.accommodate(t.byteLength);var i=new Uint8Array(r.data.byteLength,this.write);return i.set(t),this.write+=t.byteLength,this}if(r instanceof V.ByteStringBuffer&&(r=r.data,e="binary"),e=e||"binary",typeof r=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(r.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=V.binary.hex.decode(r,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(r.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=V.binary.base64.decode(r,s,this.write),this;if(e==="utf8"&&(r=V.encodeUtf8(r),e="binary"),e==="binary"||e==="raw")return this.accommodate(r.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=V.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(r.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=V.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+r)};V.DataBuffer.prototype.putBuffer=function(r){return this.putBytes(r),r.clear(),this};V.DataBuffer.prototype.putString=function(r){return this.putBytes(r,"utf16")};V.DataBuffer.prototype.putInt16=function(r){return this.accommodate(2),this.data.setInt16(this.write,r),this.write+=2,this};V.DataBuffer.prototype.putInt24=function(r){return this.accommodate(3),this.data.setInt16(this.write,r>>8&65535),this.data.setInt8(this.write,r>>16&255),this.write+=3,this};V.DataBuffer.prototype.putInt32=function(r){return this.accommodate(4),this.data.setInt32(this.write,r),this.write+=4,this};V.DataBuffer.prototype.putInt16Le=function(r){return this.accommodate(2),this.data.setInt16(this.write,r,!0),this.write+=2,this};V.DataBuffer.prototype.putInt24Le=function(r){return this.accommodate(3),this.data.setInt8(this.write,r>>16&255),this.data.setInt16(this.write,r>>8&65535,!0),this.write+=3,this};V.DataBuffer.prototype.putInt32Le=function(r){return this.accommodate(4),this.data.setInt32(this.write,r,!0),this.write+=4,this};V.DataBuffer.prototype.putInt=function(r,e){$p(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,r>>e&255);while(e>0);return this};V.DataBuffer.prototype.putSignedInt=function(r,e){return $p(e),this.accommodate(e/8),r<0&&(r+=2<<e-1),this.putInt(r,e)};V.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};V.DataBuffer.prototype.getInt16=function(){var r=this.data.getInt16(this.read);return this.read+=2,r};V.DataBuffer.prototype.getInt24=function(){var r=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,r};V.DataBuffer.prototype.getInt32=function(){var r=this.data.getInt32(this.read);return this.read+=4,r};V.DataBuffer.prototype.getInt16Le=function(){var r=this.data.getInt16(this.read,!0);return this.read+=2,r};V.DataBuffer.prototype.getInt24Le=function(){var r=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,r};V.DataBuffer.prototype.getInt32Le=function(){var r=this.data.getInt32(this.read,!0);return this.read+=4,r};V.DataBuffer.prototype.getInt=function(r){$p(r);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),r-=8;while(r>0);return e};V.DataBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};V.DataBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};V.DataBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};V.DataBuffer.prototype.at=function(r){return this.data.getUint8(this.read+r)};V.DataBuffer.prototype.setAt=function(r,e){return this.data.setUint8(r,e),this};V.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};V.DataBuffer.prototype.copy=function(){return new V.DataBuffer(this)};V.DataBuffer.prototype.compact=function(){if(this.read>0){var r=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(r.byteLength);e.set(r),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};V.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};V.DataBuffer.prototype.truncate=function(r){return this.write=Math.max(0,this.length()-r),this.read=Math.min(this.read,this.write),this};V.DataBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(r+="0"),r+=t.toString(16)}return r};V.DataBuffer.prototype.toString=function(r){var e=new Uint8Array(this.data,this.read,this.length());if(r=r||"utf8",r==="binary"||r==="raw")return V.binary.raw.encode(e);if(r==="hex")return V.binary.hex.encode(e);if(r==="base64")return V.binary.base64.encode(e);if(r==="utf8")return V.text.utf8.decode(e);if(r==="utf16")return V.text.utf16.decode(e);throw new Error("Invalid encoding: "+r)};V.createBuffer=function(r,e){return e=e||"raw",r!==void 0&&e==="utf8"&&(r=V.encodeUtf8(r)),new V.ByteBuffer(r)};V.fillString=function(r,e){for(var t="";e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return t};V.xorBytes=function(r,e,t){for(var n="",i="",s="",o=0,a=0;t>0;--t,++o)i=r.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+=s,n};V.hexToBytes=function(r){var e="",t=0;for(r.length&!0&&(t=1,e+=String.fromCharCode(parseInt(r[0],16)));t<r.length;t+=2)e+=String.fromCharCode(parseInt(r.substr(t,2),16));return e};V.bytesToHex=function(r){return V.createBuffer(r).toHex()};V.int32ToBytes=function(r){return String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255)};var Vc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",zc=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],ND="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";V.encode64=function(r,e){for(var t="",n="",i,s,o,a=0;a<r.length;)i=r.charCodeAt(a++),s=r.charCodeAt(a++),o=r.charCodeAt(a++),t+=Vc.charAt(i>>2),t+=Vc.charAt((i&3)<<4|s>>4),isNaN(s)?t+="==":(t+=Vc.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":Vc.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};V.decode64=function(r){r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,n,i,s,o=0;o<r.length;)t=zc[r.charCodeAt(o++)-43],n=zc[r.charCodeAt(o++)-43],i=zc[r.charCodeAt(o++)-43],s=zc[r.charCodeAt(o++)-43],e+=String.fromCharCode(t<<2|n>>4),i!==64&&(e+=String.fromCharCode((n&15)<<4|i>>2),s!==64&&(e+=String.fromCharCode((i&3)<<6|s)));return e};V.encodeUtf8=function(r){return unescape(encodeURIComponent(r))};V.decodeUtf8=function(r){return decodeURIComponent(escape(r))};V.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:DD.encode,decode:DD.decode}};V.binary.raw.encode=function(r){return String.fromCharCode.apply(null,r)};V.binary.raw.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,s=0;s<r.length;++s)n[i++]=r.charCodeAt(s);return e?i-t:n};V.binary.hex.encode=V.bytesToHex;V.binary.hex.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/2))),t=t||0;var i=0,s=t;for(r.length&1&&(i=1,n[s++]=parseInt(r[0],16));i<r.length;i+=2)n[s++]=parseInt(r.substr(i,2),16);return e?s-t:n};V.binary.base64.encode=function(r,e){for(var t="",n="",i,s,o,a=0;a<r.byteLength;)i=r[a++],s=r[a++],o=r[a++],t+=Vc.charAt(i>>2),t+=Vc.charAt((i&3)<<4|s>>4),isNaN(s)?t+="==":(t+=Vc.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":Vc.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};V.binary.base64.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/4)*3)),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var i,s,o,a,c=0,u=t;c<r.length;)i=zc[r.charCodeAt(c++)-43],s=zc[r.charCodeAt(c++)-43],o=zc[r.charCodeAt(c++)-43],a=zc[r.charCodeAt(c++)-43],n[u++]=i<<2|s>>4,o!==64&&(n[u++]=(s&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-t:n.subarray(0,u)};V.binary.base58.encode=function(r,e){return V.binary.baseN.encode(r,ND,e)};V.binary.base58.decode=function(r,e){return V.binary.baseN.decode(r,ND,e)};V.text={utf8:{},utf16:{}};V.text.utf8.encode=function(r,e,t){r=V.encodeUtf8(r);var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,s=0;s<r.length;++s)n[i++]=r.charCodeAt(s);return e?i-t:n};V.text.utf8.decode=function(r){return V.decodeUtf8(String.fromCharCode.apply(null,r))};V.text.utf16.encode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length*2));var i=new Uint16Array(n.buffer);t=t||0;for(var s=t,o=t,a=0;a<r.length;++a)i[o++]=r.charCodeAt(a),s+=2;return e?s-t:n};V.text.utf16.decode=function(r){return String.fromCharCode.apply(null,new Uint16Array(r.buffer))};V.deflate=function(r,e,t){if(e=V.decode64(r.deflate(V.encode64(e)).rval),t){var n=2,i=e.charCodeAt(1);i&32&&(n=6),e=e.substring(n,e.length-4)}return e};V.inflate=function(r,e,t){var n=r.inflate(V.encode64(e)).rval;return n===null?null:V.decode64(n)};var a_=function(r,e,t){if(!r)throw new Error("WebStorage not available.");var n;if(t===null?n=r.removeItem(e):(t=V.encode64(JSON.stringify(t)),n=r.setItem(e,t)),typeof n<"u"&&n.rval!==!0){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},c_=function(r,e){if(!r)throw new Error("WebStorage not available.");var t=r.getItem(e);if(r.init)if(t.rval===null){if(t.error){var n=new Error(t.error.message);throw n.id=t.error.id,n.name=t.error.name,n}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(V.decode64(t))),t},Oae=function(r,e,t,n){var i=c_(r,e);i===null&&(i={}),i[t]=n,a_(r,e,i)},Lae=function(r,e,t){var n=c_(r,e);return n!==null&&(n=t in n?n[t]:null),n},Bae=function(r,e,t){var n=c_(r,e);if(n!==null&&t in n){delete n[t];var i=!0;for(var s in n){i=!1;break}i&&(n=null),a_(r,e,n)}},Mae=function(r,e){a_(r,e,null)},R3=function(r,e,t){var n=null;typeof t>"u"&&(t=["web","flash"]);var i,s=!1,o=null;for(var a in t){i=t[a];try{if(i==="flash"||i==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=r.apply(this,e),s=i==="flash"}(i==="web"||i==="both")&&(e[0]=localStorage,n=r.apply(this,e),s=!0)}catch(c){o=c}if(s)break}if(!s)throw o;return n};V.setItem=function(r,e,t,n,i){R3(Oae,arguments,i)};V.getItem=function(r,e,t,n){return R3(Lae,arguments,n)};V.removeItem=function(r,e,t,n){R3(Bae,arguments,n)};V.clearItems=function(r,e,t){R3(Mae,arguments,t)};V.isEmpty=function(r){for(var e in r)if(r.hasOwnProperty(e))return!1;return!0};V.format=function(r){for(var e=/%./g,t,n,i=0,s=[],o=0;t=e.exec(r);){n=r.substring(o,e.lastIndex-2),n.length>0&&s.push(n),o=e.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[i+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(r.substring(o)),s.join("")};V.formatNumber=function(r,e,t,n){var i=r,s=isNaN(e=Math.abs(e))?2:e,o=t===void 0?",":t,a=n===void 0?".":n,c=i<0?"-":"",u=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",l=u.length>3?u.length%3:0;return c+(l?u.substr(0,l)+a:"")+u.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-u).toFixed(s).slice(2):"")};V.formatSize=function(r){return r>=1073741824?r=V.formatNumber(r/1073741824,2,".","")+" GiB":r>=1048576?r=V.formatNumber(r/1048576,2,".","")+" MiB":r>=1024?r=V.formatNumber(r/1024,0)+" KiB":r=V.formatNumber(r,0)+" bytes",r};V.bytesFromIP=function(r){return r.indexOf(".")!==-1?V.bytesFromIPv4(r):r.indexOf(":")!==-1?V.bytesFromIPv6(r):null};V.bytesFromIPv4=function(r){if(r=r.split("."),r.length!==4)return null;for(var e=V.createBuffer(),t=0;t<r.length;++t){var n=parseInt(r[t],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};V.bytesFromIPv6=function(r){var e=0;r=r.split(":").filter(function(o){return o.length===0&&++e,!0});for(var t=(8-r.length+e)*2,n=V.createBuffer(),i=0;i<8;++i){if(!r[i]||r[i].length===0){n.fillWithByte(0,t),t=0;continue}var s=V.hexToBytes(r[i]);s.length<2&&n.putByte(0),n.putBytes(s)}return n.getBytes()};V.bytesToIP=function(r){return r.length===4?V.bytesToIPv4(r):r.length===16?V.bytesToIPv6(r):null};V.bytesToIPv4=function(r){if(r.length!==4)return null;for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e.join(".")};V.bytesToIPv6=function(r){if(r.length!==16)return null;for(var e=[],t=[],n=0,i=0;i<r.length;i+=2){for(var s=V.bytesToHex(r[i]+r[i+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var o=t[t.length-1],a=e.length;!o||a!==o.end+1?t.push({start:a,end:a}):(o.end=a,o.end-o.start>t[n].end-t[n].start&&(n=t.length-1))}e.push(s)}if(t.length>0){var c=t[n];c.end-c.start>0&&(e.splice(c.start,c.end-c.start+1,""),c.start===0&&e.unshift(""),c.end===7&&e.push(""))}return e.join(":")};V.estimateCores=function(r,e){if(typeof r=="function"&&(e=r,r={}),r=r||{},"cores"in V&&!r.update)return e(null,V.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return V.cores=navigator.hardwareConcurrency,e(null,V.cores);if(typeof Worker>"u")return V.cores=1,e(null,V.cores);if(typeof Blob>"u")return V.cores=2,e(null,V.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),c=a+4;Date.now()<c;);self.postMessage({st:a,et:c})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,c){if(a===0){var u=Math.floor(o.reduce(function(l,f){return l+f},0)/o.length);return V.cores=Math.max(1,u),URL.revokeObjectURL(t),e(null,V.cores)}i(c,function(l,f){o.push(s(c,f)),n(o,a-1,c)})}function i(o,a){for(var c=[],u=[],l=0;l<o;++l){var f=new Worker(t);f.addEventListener("message",function(h){if(u.push(h.data),u.length===o){for(var d=0;d<o;++d)c[d].terminate();a(null,u)}}),c.push(f)}for(var l=0;l<o;++l)c[l].postMessage(l)}function s(o,a){for(var c=[],u=0;u<o;++u)for(var l=a[u],f=c[u]=[],h=0;h<o;++h)if(u!==h){var d=a[h];(l.st>d.st&&l.st<d.et||d.st>l.st&&d.st<l.et)&&f.push(h)}return c.reduce(function(m,w){return Math.max(m,w.length)},0)}}});var Vd=B((pAe,LD)=>{var qp=it();qp.pki=qp.pki||{};var u_=LD.exports=qp.pki.oids=qp.oids=qp.oids||{};function ne(r,e){u_[r]=e,u_[e]=r}function Ut(r,e){u_[r]=e}ne("1.2.840.113549.1.1.1","rsaEncryption");ne("1.2.840.113549.1.1.4","md5WithRSAEncryption");ne("1.2.840.113549.1.1.5","sha1WithRSAEncryption");ne("1.2.840.113549.1.1.7","RSAES-OAEP");ne("1.2.840.113549.1.1.8","mgf1");ne("1.2.840.113549.1.1.9","pSpecified");ne("1.2.840.113549.1.1.10","RSASSA-PSS");ne("1.2.840.113549.1.1.11","sha256WithRSAEncryption");ne("1.2.840.113549.1.1.12","sha384WithRSAEncryption");ne("1.2.840.113549.1.1.13","sha512WithRSAEncryption");ne("1.3.101.112","EdDSA25519");ne("1.2.840.10040.4.3","dsa-with-sha1");ne("1.3.14.3.2.7","desCBC");ne("1.3.14.3.2.26","sha1");ne("1.3.14.3.2.29","sha1WithRSASignature");ne("2.16.840.1.101.3.4.2.1","sha256");ne("2.16.840.1.101.3.4.2.2","sha384");ne("2.16.840.1.101.3.4.2.3","sha512");ne("2.16.840.1.101.3.4.2.4","sha224");ne("2.16.840.1.101.3.4.2.5","sha512-224");ne("2.16.840.1.101.3.4.2.6","sha512-256");ne("1.2.840.113549.2.2","md2");ne("1.2.840.113549.2.5","md5");ne("1.2.840.113549.1.7.1","data");ne("1.2.840.113549.1.7.2","signedData");ne("1.2.840.113549.1.7.3","envelopedData");ne("1.2.840.113549.1.7.4","signedAndEnvelopedData");ne("1.2.840.113549.1.7.5","digestedData");ne("1.2.840.113549.1.7.6","encryptedData");ne("1.2.840.113549.1.9.1","emailAddress");ne("1.2.840.113549.1.9.2","unstructuredName");ne("1.2.840.113549.1.9.3","contentType");ne("1.2.840.113549.1.9.4","messageDigest");ne("1.2.840.113549.1.9.5","signingTime");ne("1.2.840.113549.1.9.6","counterSignature");ne("1.2.840.113549.1.9.7","challengePassword");ne("1.2.840.113549.1.9.8","unstructuredAddress");ne("1.2.840.113549.1.9.14","extensionRequest");ne("1.2.840.113549.1.9.20","friendlyName");ne("1.2.840.113549.1.9.21","localKeyId");ne("1.2.840.113549.1.9.22.1","x509Certificate");ne("1.2.840.113549.1.12.10.1.1","keyBag");ne("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");ne("1.2.840.113549.1.12.10.1.3","certBag");ne("1.2.840.113549.1.12.10.1.4","crlBag");ne("1.2.840.113549.1.12.10.1.5","secretBag");ne("1.2.840.113549.1.12.10.1.6","safeContentsBag");ne("1.2.840.113549.1.5.13","pkcs5PBES2");ne("1.2.840.113549.1.5.12","pkcs5PBKDF2");ne("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");ne("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");ne("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");ne("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");ne("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");ne("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");ne("1.2.840.113549.2.7","hmacWithSHA1");ne("1.2.840.113549.2.8","hmacWithSHA224");ne("1.2.840.113549.2.9","hmacWithSHA256");ne("1.2.840.113549.2.10","hmacWithSHA384");ne("1.2.840.113549.2.11","hmacWithSHA512");ne("1.2.840.113549.3.7","des-EDE3-CBC");ne("2.16.840.1.101.3.4.1.2","aes128-CBC");ne("2.16.840.1.101.3.4.1.22","aes192-CBC");ne("2.16.840.1.101.3.4.1.42","aes256-CBC");ne("2.5.4.3","commonName");ne("2.5.4.4","surname");ne("2.5.4.5","serialNumber");ne("2.5.4.6","countryName");ne("2.5.4.7","localityName");ne("2.5.4.8","stateOrProvinceName");ne("2.5.4.9","streetAddress");ne("2.5.4.10","organizationName");ne("2.5.4.11","organizationalUnitName");ne("2.5.4.12","title");ne("2.5.4.13","description");ne("2.5.4.15","businessCategory");ne("2.5.4.17","postalCode");ne("2.5.4.42","givenName");ne("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");ne("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");ne("2.16.840.1.113730.1.1","nsCertType");ne("2.16.840.1.113730.1.13","nsComment");Ut("2.5.29.1","authorityKeyIdentifier");Ut("2.5.29.2","keyAttributes");Ut("2.5.29.3","certificatePolicies");Ut("2.5.29.4","keyUsageRestriction");Ut("2.5.29.5","policyMapping");Ut("2.5.29.6","subtreesConstraint");Ut("2.5.29.7","subjectAltName");Ut("2.5.29.8","issuerAltName");Ut("2.5.29.9","subjectDirectoryAttributes");Ut("2.5.29.10","basicConstraints");Ut("2.5.29.11","nameConstraints");Ut("2.5.29.12","policyConstraints");Ut("2.5.29.13","basicConstraints");ne("2.5.29.14","subjectKeyIdentifier");ne("2.5.29.15","keyUsage");Ut("2.5.29.16","privateKeyUsagePeriod");ne("2.5.29.17","subjectAltName");ne("2.5.29.18","issuerAltName");ne("2.5.29.19","basicConstraints");Ut("2.5.29.20","cRLNumber");Ut("2.5.29.21","cRLReason");Ut("2.5.29.22","expirationDate");Ut("2.5.29.23","instructionCode");Ut("2.5.29.24","invalidityDate");Ut("2.5.29.25","cRLDistributionPoints");Ut("2.5.29.26","issuingDistributionPoint");Ut("2.5.29.27","deltaCRLIndicator");Ut("2.5.29.28","issuingDistributionPoint");Ut("2.5.29.29","certificateIssuer");Ut("2.5.29.30","nameConstraints");ne("2.5.29.31","cRLDistributionPoints");ne("2.5.29.32","certificatePolicies");Ut("2.5.29.33","policyMappings");Ut("2.5.29.34","policyConstraints");ne("2.5.29.35","authorityKeyIdentifier");Ut("2.5.29.36","policyConstraints");ne("2.5.29.37","extKeyUsage");Ut("2.5.29.46","freshestCRL");Ut("2.5.29.54","inhibitAnyPolicy");ne("1.3.6.1.4.1.11129.2.4.2","timestampList");ne("1.3.6.1.5.5.7.1.1","authorityInfoAccess");ne("1.3.6.1.5.5.7.3.1","serverAuth");ne("1.3.6.1.5.5.7.3.2","clientAuth");ne("1.3.6.1.5.5.7.3.3","codeSigning");ne("1.3.6.1.5.5.7.3.4","emailProtection");ne("1.3.6.1.5.5.7.3.8","timeStamping")});var Kc=B((mAe,MD)=>{var ir=it();Jt();Vd();var he=MD.exports=ir.asn1=ir.asn1||{};he.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};he.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};he.create=function(r,e,t,n,i){if(ir.util.isArray(n)){for(var s=[],o=0;o<n.length;++o)n[o]!==void 0&&s.push(n[o]);n=s}var a={tagClass:r,type:e,constructed:t,composed:t||ir.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=he.copy(a)),a};he.copy=function(r,e){var t;if(ir.util.isArray(r)){t=[];for(var n=0;n<r.length;++n)t.push(he.copy(r[n],e));return t}return typeof r=="string"?r:(t={tagClass:r.tagClass,type:r.type,constructed:r.constructed,composed:r.composed,value:he.copy(r.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=r.bitStringContents),t)};he.equals=function(r,e,t){if(ir.util.isArray(r)){if(!ir.util.isArray(e)||r.length!==e.length)return!1;for(var n=0;n<r.length;++n)if(!he.equals(r[n],e[n]))return!1;return!0}if(typeof r!=typeof e)return!1;if(typeof r=="string")return r===e;var i=r.tagClass===e.tagClass&&r.type===e.type&&r.constructed===e.constructed&&r.composed===e.composed&&he.equals(r.value,e.value);return t&&t.includeBitStringContents&&(i=i&&r.bitStringContents===e.bitStringContents),i};he.getBerValueLength=function(r){var e=r.getByte();if(e!==128){var t,n=e&128;return n?t=r.getInt((e&127)<<3):t=e,t}};function Gp(r,e,t){if(t>e){var n=new Error("Too few bytes to parse DER.");throw n.available=r.length(),n.remaining=e,n.requested=t,n}}var Uae=function(r,e){var t=r.getByte();if(e--,t!==128){var n,i=t&128;if(!i)n=t;else{var s=t&127;Gp(r,e,s),n=r.getInt(s<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};he.fromDer=function(r,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof r=="string"&&(r=ir.util.createBuffer(r));var t=r.length(),n=C3(r,r.length(),0,e);if(e.parseAllBytes&&r.length()!==0){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=t,i.remaining=r.length(),i}return n};function C3(r,e,t,n){var i;Gp(r,e,2);var s=r.getByte();e--;var o=s&192,a=s&31;i=r.length();var c=Uae(r,e);if(e-=i-r.length(),c!==void 0&&c>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=r.length(),u.remaining=e,u.requested=c,u}c=e}var l,f,h=(s&32)===32;if(h)if(l=[],c===void 0)for(;;){if(Gp(r,e,2),r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2),e-=2;break}i=r.length(),l.push(C3(r,e,t+1,n)),e-=i-r.length()}else for(;c>0;)i=r.length(),l.push(C3(r,c,t+1,n)),e-=i-r.length(),c-=i-r.length();if(l===void 0&&o===he.Class.UNIVERSAL&&a===he.Type.BITSTRING&&(f=r.bytes(c)),l===void 0&&n.decodeBitStrings&&o===he.Class.UNIVERSAL&&a===he.Type.BITSTRING&&c>1){var d=r.read,m=e,w=0;if(a===he.Type.BITSTRING&&(Gp(r,e,1),w=r.getByte(),e--),w===0)try{i=r.length();var b={strict:!0,decodeBitStrings:!0},v=C3(r,e,t+1,b),T=i-r.length();e-=T,a==he.Type.BITSTRING&&T++;var p=v.tagClass;T===c&&(p===he.Class.UNIVERSAL||p===he.Class.CONTEXT_SPECIFIC)&&(l=[v])}catch{}l===void 0&&(r.read=d,e=m)}if(l===void 0){if(c===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e}if(a===he.Type.BMPSTRING)for(l="";c>0;c-=2)Gp(r,e,2),l+=String.fromCharCode(r.getInt16()),e-=2;else l=r.getBytes(c),e-=c}var g=f===void 0?null:{bitStringContents:f};return he.create(o,a,h,l,g)}he.toDer=function(r){var e=ir.util.createBuffer(),t=r.tagClass|r.type,n=ir.util.createBuffer(),i=!1;if("bitStringContents"in r&&(i=!0,r.original&&(i=he.equals(r,r.original))),i)n.putBytes(r.bitStringContents);else if(r.composed){r.constructed?t|=32:n.putByte(0);for(var s=0;s<r.value.length;++s)r.value[s]!==void 0&&n.putBuffer(he.toDer(r.value[s]))}else if(r.type===he.Type.BMPSTRING)for(var s=0;s<r.value.length;++s)n.putInt16(r.value.charCodeAt(s));else r.type===he.Type.INTEGER&&r.value.length>1&&(r.value.charCodeAt(0)===0&&!(r.value.charCodeAt(1)&128)||r.value.charCodeAt(0)===255&&(r.value.charCodeAt(1)&128)===128)?n.putBytes(r.value.substr(1)):n.putBytes(r.value);if(e.putByte(t),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var s=a.length-1;s>=0;--s)e.putByte(a.charCodeAt(s))}return e.putBuffer(n),e};he.oidToDer=function(r){var e=r.split("."),t=ir.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,i,s,o,a=2;a<e.length;++a){n=!0,i=[],s=parseInt(e[a],10);do o=s&127,s=s>>>7,n||(o|=128),i.push(o),n=!1;while(s>0);for(var c=i.length-1;c>=0;--c)t.putByte(i[c])}return t};he.derToOid=function(r){var e;typeof r=="string"&&(r=ir.util.createBuffer(r));var t=r.getByte();e=Math.floor(t/40)+"."+t%40;for(var n=0;r.length()>0;)t=r.getByte(),n=n<<7,t&128?n+=t&127:(e+="."+(n+t),n=0);return e};he.utcTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,2),10);t=t>=50?1900+t:2e3+t;var n=parseInt(r.substr(2,2),10)-1,i=parseInt(r.substr(4,2),10),s=parseInt(r.substr(6,2),10),o=parseInt(r.substr(8,2),10),a=0;if(r.length>11){var c=r.charAt(10),u=10;c!=="+"&&c!=="-"&&(a=parseInt(r.substr(10,2),10),u+=2)}if(e.setUTCFullYear(t,n,i),e.setUTCHours(s,o,a,0),u&&(c=r.charAt(u),c==="+"||c==="-")){var l=parseInt(r.substr(u+1,2),10),f=parseInt(r.substr(u+4,2),10),h=l*60+f;h*=6e4,c==="+"?e.setTime(+e-h):e.setTime(+e+h)}return e};he.generalizedTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,4),10),n=parseInt(r.substr(4,2),10)-1,i=parseInt(r.substr(6,2),10),s=parseInt(r.substr(8,2),10),o=parseInt(r.substr(10,2),10),a=parseInt(r.substr(12,2),10),c=0,u=0,l=!1;r.charAt(r.length-1)==="Z"&&(l=!0);var f=r.length-5,h=r.charAt(f);if(h==="+"||h==="-"){var d=parseInt(r.substr(f+1,2),10),m=parseInt(r.substr(f+4,2),10);u=d*60+m,u*=6e4,h==="+"&&(u*=-1),l=!0}return r.charAt(14)==="."&&(c=parseFloat(r.substr(14),10)*1e3),l?(e.setUTCFullYear(t,n,i),e.setUTCHours(s,o,a,c),e.setTime(+e+u)):(e.setFullYear(t,n,i),e.setHours(s,o,a,c)),e};he.dateToUtcTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push((""+r.getUTCFullYear()).substr(2)),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};he.dateToGeneralizedTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push(""+r.getUTCFullYear()),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};he.integerToDer=function(r){var e=ir.util.createBuffer();if(r>=-128&&r<128)return e.putSignedInt(r,8);if(r>=-32768&&r<32768)return e.putSignedInt(r,16);if(r>=-8388608&&r<8388608)return e.putSignedInt(r,24);if(r>=-2147483648&&r<2147483648)return e.putSignedInt(r,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=r,t};he.derToInteger=function(r){typeof r=="string"&&(r=ir.util.createBuffer(r));var e=r.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return r.getSignedInt(e)};he.validate=function(r,e,t,n){var i=!1;if((r.tagClass===e.tagClass||typeof e.tagClass>"u")&&(r.type===e.type||typeof e.type>"u"))if(r.constructed===e.constructed||typeof e.constructed>"u"){if(i=!0,e.value&&ir.util.isArray(e.value))for(var s=0,o=0;i&&o<e.value.length;++o)i=e.value[o].optional||!1,r.value[s]&&(i=he.validate(r.value[s],e.value[o],t,n),i?++s:e.value[o].optional&&(i=!0)),!i&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+r.value.length+'"');if(i&&t&&(e.capture&&(t[e.capture]=r.value),e.captureAsn1&&(t[e.captureAsn1]=r),e.captureBitStringContents&&"bitStringContents"in r&&(t[e.captureBitStringContents]=r.bitStringContents),e.captureBitStringValue&&"bitStringContents"in r)){var a;if(r.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var c=r.bitStringContents.charCodeAt(0);if(c!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=r.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+r.constructed+'"');else n&&(r.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+r.tagClass+'"'),r.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+r.type+'"'));return i};var BD=/[^\\u0000-\\u00ff]/;he.prettyPrint=function(r,e,t){var n="";e=e||0,t=t||2,e>0&&(n+=`
`);for(var i="",s=0;s<e*t;++s)i+=" ";switch(n+=i+"Tag: ",r.tagClass){case he.Class.UNIVERSAL:n+="Universal:";break;case he.Class.APPLICATION:n+="Application:";break;case he.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case he.Class.PRIVATE:n+="Private:";break}if(r.tagClass===he.Class.UNIVERSAL)switch(n+=r.type,r.type){case he.Type.NONE:n+=" (None)";break;case he.Type.BOOLEAN:n+=" (Boolean)";break;case he.Type.INTEGER:n+=" (Integer)";break;case he.Type.BITSTRING:n+=" (Bit string)";break;case he.Type.OCTETSTRING:n+=" (Octet string)";break;case he.Type.NULL:n+=" (Null)";break;case he.Type.OID:n+=" (Object Identifier)";break;case he.Type.ODESC:n+=" (Object Descriptor)";break;case he.Type.EXTERNAL:n+=" (External or Instance of)";break;case he.Type.REAL:n+=" (Real)";break;case he.Type.ENUMERATED:n+=" (Enumerated)";break;case he.Type.EMBEDDED:n+=" (Embedded PDV)";break;case he.Type.UTF8:n+=" (UTF8)";break;case he.Type.ROID:n+=" (Relative Object Identifier)";break;case he.Type.SEQUENCE:n+=" (Sequence)";break;case he.Type.SET:n+=" (Set)";break;case he.Type.PRINTABLESTRING:n+=" (Printable String)";break;case he.Type.IA5String:n+=" (IA5String (ASCII))";break;case he.Type.UTCTIME:n+=" (UTC time)";break;case he.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case he.Type.BMPSTRING:n+=" (BMP String)";break}else n+=r.type;if(n+=`
`,n+=i+"Constructed: "+r.constructed+`
`,r.composed){for(var o=0,a="",s=0;s<r.value.length;++s)r.value[s]!==void 0&&(o+=1,a+=he.prettyPrint(r.value[s],e+1,t),s+1<r.value.length&&(a+=","));n+=i+"Sub values: "+o+a}else{if(n+=i+"Value: ",r.type===he.Type.OID){var c=he.derToOid(r.value);n+=c,ir.pki&&ir.pki.oids&&c in ir.pki.oids&&(n+=" ("+ir.pki.oids[c]+") ")}if(r.type===he.Type.INTEGER)try{n+=he.derToInteger(r.value)}catch{n+="0x"+ir.util.bytesToHex(r.value)}else if(r.type===he.Type.BITSTRING){if(r.value.length>1?n+="0x"+ir.util.bytesToHex(r.value.slice(1)):n+="(none)",r.value.length>0){var u=r.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(r.type===he.Type.OCTETSTRING)BD.test(r.value)||(n+="("+r.value+") "),n+="0x"+ir.util.bytesToHex(r.value);else if(r.type===he.Type.UTF8)try{n+=ir.util.decodeUtf8(r.value)}catch(l){if(l.message==="URI malformed")n+="0x"+ir.util.bytesToHex(r.value)+" (malformed UTF8)";else throw l}else r.type===he.Type.PRINTABLESTRING||r.type===he.Type.IA5String?n+=r.value:BD.test(r.value)?n+="0x"+ir.util.bytesToHex(r.value):r.value.length===0?n+="[null]":n+=r.value}return n}});var f_=B((gAe,UD)=>{var un=it();Jt();UD.exports=un.cipher=un.cipher||{};un.cipher.algorithms=un.cipher.algorithms||{};un.cipher.createCipher=function(r,e){var t=r;if(typeof t=="string"&&(t=un.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new un.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};un.cipher.createDecipher=function(r,e){var t=r;if(typeof t=="string"&&(t=un.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new un.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};un.cipher.registerAlgorithm=function(r,e){r=r.toUpperCase(),un.cipher.algorithms[r]=e};un.cipher.getAlgorithm=function(r){return r=r.toUpperCase(),r in un.cipher.algorithms?un.cipher.algorithms[r]:null};var l_=un.cipher.BlockCipher=function(r){this.algorithm=r.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=r.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=r.decrypt,this.algorithm.initialize(r)};l_.prototype.start=function(r){r=r||{};var e={};for(var t in r)e[t]=r[t];e.decrypt=this._decrypt,this._finish=!1,this._input=un.util.createBuffer(),this.output=r.output||un.util.createBuffer(),this.mode.start(e)};l_.prototype.update=function(r){for(r&&this._input.putBuffer(r);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};l_.prototype.finish=function(r){r&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return r(this.blockSize,t,!1)},this.mode.unpad=function(t){return r(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var h_=B((yAe,FD)=>{var ln=it();Jt();ln.cipher=ln.cipher||{};var st=FD.exports=ln.cipher.modes=ln.cipher.modes||{};st.ecb=function(r){r=r||{},this.name="ECB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};st.ecb.prototype.start=function(r){};st.ecb.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};st.ecb.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};st.ecb.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};st.ecb.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};st.cbc=function(r){r=r||{},this.name="CBC",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};st.cbc.prototype.start=function(r){if(r.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in r)this._iv=P3(r.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};st.cbc.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};st.cbc.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};st.cbc.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};st.cbc.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};st.cfb=function(r){r=r||{},this.name="CFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=ln.util.createBuffer(),this._partialBytes=0};st.cfb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=P3(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};st.cfb.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};st.cfb.prototype.decrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};st.ofb=function(r){r=r||{},this.name="OFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ln.util.createBuffer(),this._partialBytes=0};st.ofb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=P3(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};st.ofb.prototype.encrypt=function(r,e,t){var n=r.length();if(r.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};st.ofb.prototype.decrypt=st.ofb.prototype.encrypt;st.ctr=function(r){r=r||{},this.name="CTR",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ln.util.createBuffer(),this._partialBytes=0};st.ctr.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=P3(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};st.ctr.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s>0&&(r.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}k3(this._inBlock)};st.ctr.prototype.decrypt=st.ctr.prototype.encrypt;st.gcm=function(r){r=r||{},this.name="GCM",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=ln.util.createBuffer(),this._partialBytes=0,this._R=3774873600};st.gcm.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");var e=ln.util.createBuffer(r.iv);this._cipherLength=0;var t;if("additionalData"in r?t=ln.util.createBuffer(r.additionalData):t=ln.util.createBuffer(),"tagLength"in r?this._tagLength=r.tagLength:this._tagLength=128,this._tag=null,r.decrypt&&(this._tag=ln.util.createBuffer(r.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(d_(n*8)))}this._inBlock=this._j0.slice(0),k3(this._inBlock),this._partialBytes=0,t=ln.util.createBuffer(t),this._aDataLength=d_(t.length()*8);var i=t.length()%this.blockSize;for(i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};st.gcm.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=r.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(s<=0||t){if(t){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return r.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),k3(this._inBlock)};st.gcm.prototype.decrypt=function(r,e,t){var n=r.length();if(n<this.blockSize&&!(t&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),k3(this._inBlock),this._hashBlock[0]=r.getInt32(),this._hashBlock[1]=r.getInt32(),this._hashBlock[2]=r.getInt32(),this._hashBlock[3]=r.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};st.gcm.prototype.afterFinish=function(r,e){var t=!0;e.decrypt&&e.overflow&&r.truncate(this.blockSize-e.overflow),this.tag=ln.util.createBuffer();var n=this._aDataLength.concat(d_(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^i[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};st.gcm.prototype.multiply=function(r,e){for(var t=[0,0,0,0],n=e.slice(0),i=0;i<128;++i){var s=r[i/32|0]&1<<31-i%32;s&&(t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3]),this.pow(n,n)}return t};st.gcm.prototype.pow=function(r,e){for(var t=r[3]&1,n=3;n>0;--n)e[n]=r[n]>>>1|(r[n-1]&1)<<31;e[0]=r[0]>>>1,t&&(e[0]^=this._R)};st.gcm.prototype.tableMultiply=function(r){for(var e=[0,0,0,0],t=0;t<32;++t){var n=t/8|0,i=r[n]>>>(7-t%8)*4&15,s=this._m[t][i];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};st.gcm.prototype.ghash=function(r,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};st.gcm.prototype.generateHashTable=function(r,e){for(var t=8/e,n=4*t,i=16*t,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],c=o/n|0,u=(n-1-o%n)*e;a[c]=1<<e-1<<u,s[o]=this.generateSubHashTable(this.multiply(a,r),e)}return s};st.gcm.prototype.generateSubHashTable=function(r,e){var t=1<<e,n=t>>>1,i=new Array(t);i[n]=r.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],c=i[o];i[s+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<t;++s){var u=i[s^n];i[s]=[r[0]^u[0],r[1]^u[1],r[2]^u[2],r[3]^u[3]]}return i};function P3(r,e){if(typeof r=="string"&&(r=ln.util.createBuffer(r)),ln.util.isArray(r)&&r.length>4){var t=r;r=ln.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}if(r.length()<e)throw new Error("Invalid IV length; got "+r.length()+" bytes and expected "+e+" bytes.");if(!ln.util.isArray(r)){for(var i=[],s=e/4,n=0;n<s;++n)i.push(r.getInt32());r=i}return r}function k3(r){r[r.length-1]=r[r.length-1]+1&4294967295}function d_(r){return[r/4294967296|0,r&4294967295]}});var Hd=B((wAe,HD)=>{var er=it();f_();h_();Jt();HD.exports=er.aes=er.aes||{};er.aes.startEncrypting=function(r,e,t,n){var i=D3({key:r,output:t,decrypt:!1,mode:n});return i.start(e),i};er.aes.createEncryptionCipher=function(r,e){return D3({key:r,output:null,decrypt:!1,mode:e})};er.aes.startDecrypting=function(r,e,t,n){var i=D3({key:r,output:t,decrypt:!0,mode:n});return i.start(e),i};er.aes.createDecryptionCipher=function(r,e){return D3({key:r,output:null,decrypt:!0,mode:e})};er.aes.Algorithm=function(r,e){g_||zD();var t=this;t.name=r,t.mode=new e({blockSize:16,cipher:{encrypt:function(n,i){return m_(t._w,n,i,!1)},decrypt:function(n,i){return m_(t._w,n,i,!0)}}}),t._init=!1};er.aes.Algorithm.prototype.initialize=function(r){if(!this._init){var e=r.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=er.util.createBuffer(e);else if(er.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=er.util.createBuffer();for(var n=0;n<t.length;++n)e.putByte(t[n])}if(!er.util.isArray(e)){t=e,e=[];var i=t.length();if(i===16||i===24||i===32){i=i>>>2;for(var n=0;n<i;++n)e.push(t.getInt32())}}if(!er.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=KD(e,r.decrypt&&!o),this._init=!0}};er.aes._expandKey=function(r,e){return g_||zD(),KD(r,e)};er.aes._updateBlock=m_;Kd("AES-ECB",er.cipher.modes.ecb);Kd("AES-CBC",er.cipher.modes.cbc);Kd("AES-CFB",er.cipher.modes.cfb);Kd("AES-OFB",er.cipher.modes.ofb);Kd("AES-CTR",er.cipher.modes.ctr);Kd("AES-GCM",er.cipher.modes.gcm);function Kd(r,e){var t=function(){return new er.aes.Algorithm(r,e)};er.cipher.registerAlgorithm(r,t)}var g_=!1,zd=4,Gn,p_,VD,bl,Ms;function zD(){g_=!0,VD=[0,1,2,4,8,16,32,64,128,27,54];for(var r=new Array(256),e=0;e<128;++e)r[e]=e<<1,r[e+128]=e+128<<1^283;Gn=new Array(256),p_=new Array(256),bl=new Array(4),Ms=new Array(4);for(var e=0;e<4;++e)bl[e]=new Array(256),Ms[e]=new Array(256);for(var t=0,n=0,i,s,o,a,c,u,l,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,Gn[t]=a,p_[a]=t,c=r[a],i=r[t],s=r[i],o=r[s],u=c<<24^a<<16^a<<8^(a^c),l=(i^s^o)<<24^(t^o)<<16^(t^s^o)<<8^(t^i^o);for(var f=0;f<4;++f)bl[f][t]=u,Ms[f][a]=l,u=u<<24|u>>>8,l=l<<24|l>>>8;t===0?t=n=1:(t=i^r[r[r[i^o]]],n^=r[r[n]])}}function KD(r,e){for(var t=r.slice(0),n,i=1,s=t.length,o=s+6+1,a=zd*o,c=s;c<a;++c)n=t[c-1],c%s===0?(n=Gn[n>>>16&255]<<24^Gn[n>>>8&255]<<16^Gn[n&255]<<8^Gn[n>>>24]^VD[i]<<24,i++):s>6&&c%s===4&&(n=Gn[n>>>24]<<24^Gn[n>>>16&255]<<16^Gn[n>>>8&255]<<8^Gn[n&255]),t[c]=t[c-s]^n;if(e){var u,l=Ms[0],f=Ms[1],h=Ms[2],d=Ms[3],m=t.slice(0);a=t.length;for(var c=0,w=a-zd;c<a;c+=zd,w-=zd)if(c===0||c===a-zd)m[c]=t[w],m[c+1]=t[w+3],m[c+2]=t[w+2],m[c+3]=t[w+1];else for(var b=0;b<zd;++b)u=t[w+b],m[c+(3&-b)]=l[Gn[u>>>24]]^f[Gn[u>>>16&255]]^h[Gn[u>>>8&255]]^d[Gn[u&255]];t=m}return t}function m_(r,e,t,n){var i=r.length/4-1,s,o,a,c,u;n?(s=Ms[0],o=Ms[1],a=Ms[2],c=Ms[3],u=p_):(s=bl[0],o=bl[1],a=bl[2],c=bl[3],u=Gn);var l,f,h,d,m,w,b;l=e[0]^r[0],f=e[n?3:1]^r[1],h=e[2]^r[2],d=e[n?1:3]^r[3];for(var v=3,T=1;T<i;++T)m=s[l>>>24]^o[f>>>16&255]^a[h>>>8&255]^c[d&255]^r[++v],w=s[f>>>24]^o[h>>>16&255]^a[d>>>8&255]^c[l&255]^r[++v],b=s[h>>>24]^o[d>>>16&255]^a[l>>>8&255]^c[f&255]^r[++v],d=s[d>>>24]^o[l>>>16&255]^a[f>>>8&255]^c[h&255]^r[++v],l=m,f=w,h=b;t[0]=u[l>>>24]<<24^u[f>>>16&255]<<16^u[h>>>8&255]<<8^u[d&255]^r[++v],t[n?3:1]=u[f>>>24]<<24^u[h>>>16&255]<<16^u[d>>>8&255]<<8^u[l&255]^r[++v],t[2]=u[h>>>24]<<24^u[d>>>16&255]<<16^u[l>>>8&255]<<8^u[f&255]^r[++v],t[n?1:3]=u[d>>>24]<<24^u[l>>>16&255]<<16^u[f>>>8&255]<<8^u[h&255]^r[++v]}function D3(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="AES-"+e,n;r.decrypt?n=er.cipher.createDecipher(t,r.key):n=er.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof er.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var O3=B((bAe,qD)=>{var ur=it();f_();h_();Jt();qD.exports=ur.des=ur.des||{};ur.des.startEncrypting=function(r,e,t,n){var i=N3({key:r,output:t,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};ur.des.createEncryptionCipher=function(r,e){return N3({key:r,output:null,decrypt:!1,mode:e})};ur.des.startDecrypting=function(r,e,t,n){var i=N3({key:r,output:t,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};ur.des.createDecryptionCipher=function(r,e){return N3({key:r,output:null,decrypt:!0,mode:e})};ur.des.Algorithm=function(r,e){var t=this;t.name=r,t.mode=new e({blockSize:8,cipher:{encrypt:function(n,i){return $D(t._keys,n,i,!1)},decrypt:function(n,i){return $D(t._keys,n,i,!0)}}}),t._init=!1};ur.des.Algorithm.prototype.initialize=function(r){if(!this._init){var e=ur.util.createBuffer(r.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=jae(e),this._init=!0}};wo("DES-ECB",ur.cipher.modes.ecb);wo("DES-CBC",ur.cipher.modes.cbc);wo("DES-CFB",ur.cipher.modes.cfb);wo("DES-OFB",ur.cipher.modes.ofb);wo("DES-CTR",ur.cipher.modes.ctr);wo("3DES-ECB",ur.cipher.modes.ecb);wo("3DES-CBC",ur.cipher.modes.cbc);wo("3DES-CFB",ur.cipher.modes.cfb);wo("3DES-OFB",ur.cipher.modes.ofb);wo("3DES-CTR",ur.cipher.modes.ctr);function wo(r,e){var t=function(){return new ur.des.Algorithm(r,e)};ur.cipher.registerAlgorithm(r,t)}var Fae=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],Vae=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],zae=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],Kae=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Hae=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],$ae=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],qae=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Gae=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function jae(r){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],m=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],w=r.length()>8?3:1,b=[],v=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],T=0,p,g=0;g<w;g++){var y=r.getInt32(),E=r.getInt32();p=(y>>>4^E)&252645135,E^=p,y^=p<<4,p=(E>>>-16^y)&65535,y^=p,E^=p<<-16,p=(y>>>2^E)&858993459,E^=p,y^=p<<2,p=(E>>>-16^y)&65535,y^=p,E^=p<<-16,p=(y>>>1^E)&1431655765,E^=p,y^=p<<1,p=(E>>>8^y)&16711935,y^=p,E^=p<<8,p=(y>>>1^E)&1431655765,E^=p,y^=p<<1,p=y<<8|E>>>20&240,y=E<<24|E<<8&16711680|E>>>8&65280|E>>>24&240,E=p;for(var _=0;_<v.length;++_){v[_]?(y=y<<2|y>>>26,E=E<<2|E>>>26):(y=y<<1|y>>>27,E=E<<1|E>>>27),y&=-15,E&=-15;var x=e[y>>>28]|t[y>>>24&15]|n[y>>>20&15]|i[y>>>16&15]|s[y>>>12&15]|o[y>>>8&15]|a[y>>>4&15],S=c[E>>>28]|u[E>>>24&15]|l[E>>>20&15]|f[E>>>16&15]|h[E>>>12&15]|d[E>>>8&15]|m[E>>>4&15];p=(S>>>16^x)&65535,b[T++]=x^p,b[T++]=S^p<<16}}return b}function $D(r,e,t,n){var i=r.length===32?3:9,s;i===3?s=n?[30,-2,-2]:[0,32,2]:s=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],c=e[1];o=(a>>>4^c)&252645135,c^=o,a^=o<<4,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,a=a<<1|a>>>31,c=c<<1|c>>>31;for(var u=0;u<i;u+=3){for(var l=s[u+1],f=s[u+2],h=s[u];h!=l;h+=f){var d=c^r[h],m=(c>>>4|c<<28)^r[h+1];o=a,a=c,c=o^(Vae[d>>>24&63]|Kae[d>>>16&63]|$ae[d>>>8&63]|Gae[d&63]|Fae[m>>>24&63]|zae[m>>>16&63]|Hae[m>>>8&63]|qae[m&63])}o=a,a=c,c=o}a=a>>>1|a<<31,c=c>>>1|c<<31,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(a>>>4^c)&252645135,c^=o,a^=o<<4,t[0]=a,t[1]=c}function N3(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="DES-"+e,n;r.decrypt?n=ur.cipher.createDecipher(t,r.key):n=ur.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof ur.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var Hc=B((_Ae,GD)=>{var L3=it();GD.exports=L3.md=L3.md||{};L3.md.algorithms=L3.md.algorithms||{}});var WD=B((EAe,jD)=>{var Ca=it();Hc();Jt();var Wae=jD.exports=Ca.hmac=Ca.hmac||{};Wae.create=function(){var r=null,e=null,t=null,n=null,i={};return i.start=function(s,o){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in Ca.md.algorithms)e=Ca.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(o===null)o=r;else{if(typeof o=="string")o=Ca.util.createBuffer(o);else if(Ca.util.isArray(o)){var a=o;o=Ca.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),t=Ca.util.createBuffer(),n=Ca.util.createBuffer(),u=o.length();for(var c=0;c<u;++c){var a=o.at(c);t.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,c=0;c<a;++c)t.putByte(54),n.putByte(92);r=o,t=t.bytes(),n=n.bytes()}e.start(),e.update(t)},i.update=function(s){e.update(s)},i.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(n),e.update(s),e.digest()},i.digest=i.getMac,i}});var $c=B(()=>{});var y_=B((xAe,YD)=>{var jn=it();WD();Hc();Jt();var Yae=jn.pkcs5=jn.pkcs5||{},Pa;jn.util.isNodejs&&!jn.options.usePureJavaScript&&(Pa=$c());YD.exports=jn.pbkdf2=Yae.pbkdf2=function(r,e,t,n,i,s){if(typeof i=="function"&&(s=i,i=null),jn.util.isNodejs&&!jn.options.usePureJavaScript&&Pa.pbkdf2&&(i===null||typeof i!="object")&&(Pa.pbkdf2Sync.length>4||!i||i==="sha1"))return typeof i!="string"&&(i="sha1"),r=Buffer.from(r,"binary"),e=Buffer.from(e,"binary"),s?Pa.pbkdf2Sync.length===4?Pa.pbkdf2(r,e,t,n,function(p,g){if(p)return s(p);s(null,g.toString("binary"))}):Pa.pbkdf2(r,e,t,n,i,function(p,g){if(p)return s(p);s(null,g.toString("binary"))}):Pa.pbkdf2Sync.length===4?Pa.pbkdf2Sync(r,e,t,n).toString("binary"):Pa.pbkdf2Sync(r,e,t,n,i).toString("binary");if((typeof i>"u"||i===null)&&(i="sha1"),typeof i=="string"){if(!(i in jn.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=jn.md[i].create()}var o=i.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var c=Math.ceil(n/o),u=n-(c-1)*o,l=jn.hmac.create();l.start(i,r);var f="",h,d,m;if(!s){for(var w=1;w<=c;++w){l.start(null,null),l.update(e),l.update(jn.util.int32ToBytes(w)),h=m=l.digest().getBytes();for(var b=2;b<=t;++b)l.start(null,null),l.update(m),d=l.digest().getBytes(),h=jn.util.xorBytes(h,d,o),m=d;f+=w<c?h:h.substr(0,u)}return f}var w=1,b;function v(){if(w>c)return s(null,f);l.start(null,null),l.update(e),l.update(jn.util.int32ToBytes(w)),h=m=l.digest().getBytes(),b=2,T()}function T(){if(b<=t)return l.start(null,null),l.update(m),d=l.digest().getBytes(),h=jn.util.xorBytes(h,d,o),m=d,++b,jn.util.setImmediate(T);f+=w<c?h:h.substr(0,u),++w,v()}v()}});var U3=B((TAe,XD)=>{var M3=it();Jt();var QD=XD.exports=M3.pem=M3.pem||{};QD.encode=function(r,e){e=e||{};var t="-----BEGIN "+r.type+`-----\r
`,n;if(r.procType&&(n={name:"Proc-Type",values:[String(r.procType.version),r.procType.type]},t+=B3(n)),r.contentDomain&&(n={name:"Content-Domain",values:[r.contentDomain]},t+=B3(n)),r.dekInfo&&(n={name:"DEK-Info",values:[r.dekInfo.algorithm]},r.dekInfo.parameters&&n.values.push(r.dekInfo.parameters),t+=B3(n)),r.headers)for(var i=0;i<r.headers.length;++i)t+=B3(r.headers[i]);return r.procType&&(t+=`\r
`),t+=M3.util.encode64(r.body,e.maxline||64)+`\r
`,t+="-----END "+r.type+`-----\r
`,t};QD.decode=function(r){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/,s;s=t.exec(r),!!s;){var o=s[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:M3.util.decode64(s[3])};if(e.push(a),!!s[2]){for(var c=s[2].split(i),u=0;s&&u<c.length;){for(var l=c[u].replace(/\s+$/,""),f=u+1;f<c.length;++f){var h=c[f];if(!/\s/.test(h[0]))break;l+=h,u=f}if(s=l.match(n),s){for(var d={name:s[1],values:[]},m=s[2].split(","),w=0;w<m.length;++w)d.values.push(Qae(m[w]));if(a.procType)if(!a.contentDomain&&d.name==="Content-Domain")a.contentDomain=m[0]||"";else if(!a.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:m[0],parameters:m[1]||null}}else a.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:m[0],type:m[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function B3(r){for(var e=r.name+": ",t=[],n=function(c,u){return" "+u},i=0;i<r.values.length;++i)t.push(r.values[i].replace(/^(\S+\r\n)/,n));e+=t.join(",")+`\r
`;for(var s=0,o=-1,i=0;i<e.length;++i,++s)if(s>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),s=i-o-1,o=-1,++i}else(e[i]===" "||e[i]==="	"||e[i]===",")&&(o=i);return e}function Qae(r){return r.replace(/^\s+/,"")}});var nN=B((AAe,rN)=>{var bo=it();Hc();Jt();var JD=rN.exports=bo.sha256=bo.sha256||{};bo.md.sha256=bo.md.algorithms.sha256=JD;JD.create=function(){eN||Xae();var r=null,e=bo.util.createBuffer(),t=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=bo.util.createBuffer(),r={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=bo.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),ZD(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=bo.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(w_.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,l=0;l<n.fullMessageLength.length-1;++l)a=n.fullMessageLength[l+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4,h5:r.h5,h6:r.h6,h7:r.h7};ZD(f,t,i);var h=bo.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h.putInt32(f.h5),h.putInt32(f.h6),h.putInt32(f.h7),h},n};var w_=null,eN=!1,tN=null;function Xae(){w_=String.fromCharCode(128),w_+=bo.util.fillString(String.fromCharCode(0),64),tN=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],eN=!0}function ZD(r,e,t){for(var n,i,s,o,a,c,u,l,f,h,d,m,w,b,v,T=t.length();T>=64;){for(u=0;u<16;++u)e[u]=t.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=n+e[u-7]+i+e[u-16]|0;for(l=r.h0,f=r.h1,h=r.h2,d=r.h3,m=r.h4,w=r.h5,b=r.h6,v=r.h7,u=0;u<64;++u)o=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),a=b^m&(w^b),s=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),c=l&f|h&(l^f),n=v+o+a+tN[u]+e[u],i=s+c,v=b,b=w,w=m,m=d+n>>>0,d=h,h=f,f=l,l=n+i>>>0;r.h0=r.h0+l|0,r.h1=r.h1+f|0,r.h2=r.h2+h|0,r.h3=r.h3+d|0,r.h4=r.h4+m|0,r.h5=r.h5+w|0,r.h6=r.h6+b|0,r.h7=r.h7+v|0,T-=64}}});var sN=B((IAe,iN)=>{var _o=it();Jt();var F3=null;_o.util.isNodejs&&!_o.options.usePureJavaScript&&!process.versions["node-webkit"]&&(F3=$c());var Zae=iN.exports=_o.prng=_o.prng||{};Zae.create=function(r){for(var e={plugin:r,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=r.md,n=new Array(32),i=0;i<32;++i)n[i]=t.create();e.pools=n,e.pool=0,e.generate=function(u,l){if(!l)return e.generateSync(u);var f=e.plugin.cipher,h=e.plugin.increment,d=e.plugin.formatKey,m=e.plugin.formatSeed,w=_o.util.createBuffer();e.key=null,b();function b(v){if(v)return l(v);if(w.length()>=u)return l(null,w.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return _o.util.nextTick(function(){s(b)});var T=f(e.key,e.seed);e.generated+=T.length,w.putBytes(T),e.key=d(f(e.key,h(e.seed))),e.seed=m(f(e.key,e.seed)),_o.util.setImmediate(b)}},e.generateSync=function(u){var l=e.plugin.cipher,f=e.plugin.increment,h=e.plugin.formatKey,d=e.plugin.formatSeed;e.key=null;for(var m=_o.util.createBuffer();m.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var w=l(e.key,e.seed);e.generated+=w.length,m.putBytes(w),e.key=h(l(e.key,f(e.seed))),e.seed=d(l(e.key,e.seed))}return m.getBytes(u)};function s(u){if(e.pools[0].messageLength>=32)return a(),u();var l=32-e.pools[0].messageLength<<5;e.seedFile(l,function(f,h){if(f)return u(f);e.collect(h),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var l=1,f=0;f<32;++f)e.reseeds%l===0&&(u.update(e.pools[f].digest().getBytes()),e.pools[f].start()),l=l<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var h=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(h),e.generated=0}function c(u){var l=null,f=_o.util.globalScope,h=f.crypto||f.msCrypto;h&&h.getRandomValues&&(l=function(y){return h.getRandomValues(y)});var d=_o.util.createBuffer();if(l)for(;d.length()<u;){var m=Math.max(1,Math.min(u-d.length(),65536)/4),w=new Uint32Array(Math.floor(m));try{l(w);for(var b=0;b<w.length;++b)d.putInt32(w[b])}catch(y){if(!(typeof QuotaExceededError<"u"&&y instanceof QuotaExceededError))throw y}}if(d.length()<u)for(var v,T,p,g=Math.floor(Math.random()*65536);d.length()<u;){T=16807*(g&65535),v=16807*(g>>16),T+=(v&32767)<<16,T+=v>>15,T=(T&2147483647)+(T>>31),g=T&4294967295;for(var b=0;b<3;++b)p=g>>>(b<<3),p^=Math.floor(Math.random()*256),d.putByte(p&255)}return d.getBytes(u)}return F3?(e.seedFile=function(u,l){F3.randomBytes(u,function(f,h){if(f)return l(f);l(null,h.toString())})},e.seedFileSync=function(u){return F3.randomBytes(u).toString()}):(e.seedFile=function(u,l){try{l(null,c(u))}catch(f){l(f)}},e.seedFileSync=c),e.collect=function(u){for(var l=u.length,f=0;f<l;++f)e.pools[e.pool].update(u.substr(f,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,l){for(var f="",h=0;h<l;h+=8)f+=String.fromCharCode(u>>h&255);e.collect(f)},e.registerWorker=function(u){if(u===self)e.seedFile=function(f,h){function d(m){var w=m.data;w.forge&&w.forge.prng&&(self.removeEventListener("message",d),h(w.forge.prng.err,w.forge.prng.bytes))}self.addEventListener("message",d),self.postMessage({forge:{prng:{needed:f}}})};else{var l=function(f){var h=f.data;h.forge&&h.forge.prng&&e.seedFile(h.forge.prng.needed,function(d,m){u.postMessage({forge:{prng:{err:d,bytes:m}}})})};u.addEventListener("message",l)}},e}});var _l=B((RAe,b_)=>{var fn=it();Hd();nN();sN();Jt();(function(){if(fn.random&&fn.random.getBytes){b_.exports=fn.random;return}(function(r){var e={},t=new Array(4),n=fn.util.createBuffer();e.formatKey=function(f){var h=fn.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),fn.aes._expandKey(f,!1)},e.formatSeed=function(f){var h=fn.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),f},e.cipher=function(f,h){return fn.aes._updateBlock(f,h,t,!1),n.putInt32(t[0]),n.putInt32(t[1]),n.putInt32(t[2]),n.putInt32(t[3]),n.getBytes()},e.increment=function(f){return++f[3],f},e.md=fn.md.sha256;function i(){var f=fn.prng.create(e);return f.getBytes=function(h,d){return f.generate(h,d)},f.getBytesSync=function(h){return f.generate(h)},f}var s=i(),o=null,a=fn.util.globalScope,c=a.crypto||a.msCrypto;if(c&&c.getRandomValues&&(o=function(f){return c.getRandomValues(f)}),fn.options.usePureJavaScript||!fn.util.isNodejs&&!o){if(typeof window>"u"||window.document,s.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var l in navigator)try{typeof navigator[l]=="string"&&(u+=navigator[l])}catch{}s.collect(u),u=null}r&&(r().mousemove(function(f){s.collectInt(f.clientX,16),s.collectInt(f.clientY,16)}),r().keypress(function(f){s.collectInt(f.charCode,8)}))}if(!fn.random)fn.random=s;else for(var l in s)fn.random[l]=s[l];fn.random.createInstance=i,b_.exports=fn.random})(typeof jQuery<"u"?jQuery:null)})()});var uN=B((CAe,cN)=>{var ti=it();Jt();var __=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],oN=[1,2,3,5],Jae=function(r,e){return r<<e&65535|(r&65535)>>16-e},ece=function(r,e){return(r&65535)>>e|r<<16-e&65535};cN.exports=ti.rc2=ti.rc2||{};ti.rc2.expandKey=function(r,e){typeof r=="string"&&(r=ti.util.createBuffer(r)),e=e||128;var t=r,n=r.length(),i=e,s=Math.ceil(i/8),o=255>>(i&7),a;for(a=n;a<128;a++)t.putByte(__[t.at(a-1)+t.at(a-n)&255]);for(t.setAt(128-s,__[t.at(128-s)&o]),a=127-s;a>=0;a--)t.setAt(a,__[t.at(a+1)^t.at(a+s)]);return t};var aN=function(r,e,t){var n=!1,i=null,s=null,o=null,a,c,u,l,f=[];for(r=ti.rc2.expandKey(r,e),u=0;u<64;u++)f.push(r.getInt16Le());t?(a=function(m){for(u=0;u<4;u++)m[u]+=f[l]+(m[(u+3)%4]&m[(u+2)%4])+(~m[(u+3)%4]&m[(u+1)%4]),m[u]=Jae(m[u],oN[u]),l++},c=function(m){for(u=0;u<4;u++)m[u]+=f[m[(u+3)%4]&63]}):(a=function(m){for(u=3;u>=0;u--)m[u]=ece(m[u],oN[u]),m[u]-=f[l]+(m[(u+3)%4]&m[(u+2)%4])+(~m[(u+3)%4]&m[(u+1)%4]),l--},c=function(m){for(u=3;u>=0;u--)m[u]-=f[m[(u+3)%4]&63]});var h=function(m){var w=[];for(u=0;u<4;u++){var b=i.getInt16Le();o!==null&&(t?b^=o.getInt16Le():o.putInt16Le(b)),w.push(b&65535)}l=t?0:63;for(var v=0;v<m.length;v++)for(var T=0;T<m[v][0];T++)m[v][1](w);for(u=0;u<4;u++)o!==null&&(t?o.putInt16Le(w[u]):w[u]^=o.getInt16Le()),s.putInt16Le(w[u])},d=null;return d={start:function(m,w){m&&typeof m=="string"&&(m=ti.util.createBuffer(m)),n=!1,i=ti.util.createBuffer(),s=w||new ti.util.createBuffer,o=m,d.output=s},update:function(m){for(n||i.putBuffer(m);i.length()>=8;)h([[5,a],[1,c],[6,a],[1,c],[5,a]])},finish:function(m){var w=!0;if(t)if(m)w=m(8,i,!t);else{var b=i.length()===8?8:8-i.length();i.fillWithByte(b,b)}if(w&&(n=!0,d.update()),!t&&(w=i.length()===0,w))if(m)w=m(8,s,!t);else{var v=s.length(),T=s.at(v-1);T>v?w=!1:s.truncate(T)}return w}},d};ti.rc2.startEncrypting=function(r,e,t){var n=ti.rc2.createEncryptionCipher(r,128);return n.start(e,t),n};ti.rc2.createEncryptionCipher=function(r,e){return aN(r,e,!0)};ti.rc2.startDecrypting=function(r,e,t){var n=ti.rc2.createDecryptionCipher(r,128);return n.start(e,t),n};ti.rc2.createDecryptionCipher=function(r,e){return aN(r,e,!1)}});var K3=B((PAe,yN)=>{var E_=it();yN.exports=E_.jsbn=E_.jsbn||{};var ka,tce=0xdeadbeefcafe,lN=(tce&16777215)==15715070;function ee(r,e,t){this.data=[],r!=null&&(typeof r=="number"?this.fromNumber(r,e,t):e==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,e))}E_.jsbn.BigInteger=ee;function At(){return new ee(null)}function rce(r,e,t,n,i,s){for(;--s>=0;){var o=e*this.data[r++]+t.data[n]+i;i=Math.floor(o/67108864),t.data[n++]=o&67108863}return i}function nce(r,e,t,n,i,s){for(var o=e&32767,a=e>>15;--s>=0;){var c=this.data[r]&32767,u=this.data[r++]>>15,l=a*c+u*o;c=o*c+((l&32767)<<15)+t.data[n]+(i&1073741823),i=(c>>>30)+(l>>>15)+a*u+(i>>>30),t.data[n++]=c&1073741823}return i}function fN(r,e,t,n,i,s){for(var o=e&16383,a=e>>14;--s>=0;){var c=this.data[r]&16383,u=this.data[r++]>>14,l=a*c+u*o;c=o*c+((l&16383)<<14)+t.data[n]+i,i=(c>>28)+(l>>14)+a*u,t.data[n++]=c&268435455}return i}typeof navigator>"u"?(ee.prototype.am=fN,ka=28):lN&&navigator.appName=="Microsoft Internet Explorer"?(ee.prototype.am=nce,ka=30):lN&&navigator.appName!="Netscape"?(ee.prototype.am=rce,ka=26):(ee.prototype.am=fN,ka=28);ee.prototype.DB=ka;ee.prototype.DM=(1<<ka)-1;ee.prototype.DV=1<<ka;var v_=52;ee.prototype.FV=Math.pow(2,v_);ee.prototype.F1=v_-ka;ee.prototype.F2=2*ka-v_;var ice="0123456789abcdefghijklmnopqrstuvwxyz",V3=new Array,$d,Zi;$d="0".charCodeAt(0);for(Zi=0;Zi<=9;++Zi)V3[$d++]=Zi;$d="a".charCodeAt(0);for(Zi=10;Zi<36;++Zi)V3[$d++]=Zi;$d="A".charCodeAt(0);for(Zi=10;Zi<36;++Zi)V3[$d++]=Zi;function dN(r){return ice.charAt(r)}function hN(r,e){var t=V3[r.charCodeAt(e)];return t??-1}function sce(r){for(var e=this.t-1;e>=0;--e)r.data[e]=this.data[e];r.t=this.t,r.s=this.s}function oce(r){this.t=1,this.s=r<0?-1:0,r>0?this.data[0]=r:r<-1?this.data[0]=r+this.DV:this.t=0}function qc(r){var e=At();return e.fromInt(r),e}function ace(r,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(r,e);return}this.t=0,this.s=0;for(var n=r.length,i=!1,s=0;--n>=0;){var o=t==8?r[n]&255:hN(r,n);if(o<0){r.charAt(n)=="-"&&(i=!0);continue}i=!1,s==0?this.data[this.t++]=o:s+t>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=t,s>=this.DB&&(s-=this.DB)}t==8&&r[0]&128&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&ee.ZERO.subTo(this,this)}function cce(){for(var r=this.s&this.DM;this.t>0&&this.data[this.t-1]==r;)--this.t}function uce(r){if(this.s<0)return"-"+this.negate().toString(r);var e;if(r==16)e=4;else if(r==8)e=3;else if(r==2)e=1;else if(r==32)e=5;else if(r==4)e=2;else return this.toRadix(r);var t=(1<<e)-1,n,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(i=!0,s=dN(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&t,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=dN(n));return i?s:"0"}function lce(){var r=At();return ee.ZERO.subTo(this,r),r}function fce(){return this.s<0?this.negate():this}function dce(r){var e=this.s-r.s;if(e!=0)return e;var t=this.t;if(e=t-r.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-r.data[t])!=0)return e;return 0}function z3(r){var e=1,t;return(t=r>>>16)!=0&&(r=t,e+=16),(t=r>>8)!=0&&(r=t,e+=8),(t=r>>4)!=0&&(r=t,e+=4),(t=r>>2)!=0&&(r=t,e+=2),(t=r>>1)!=0&&(r=t,e+=1),e}function hce(){return this.t<=0?0:this.DB*(this.t-1)+z3(this.data[this.t-1]^this.s&this.DM)}function pce(r,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+r]=this.data[t];for(t=r-1;t>=0;--t)e.data[t]=0;e.t=this.t+r,e.s=this.s}function mce(r,e){for(var t=r;t<this.t;++t)e.data[t-r]=this.data[t];e.t=Math.max(this.t-r,0),e.s=this.s}function gce(r,e){var t=r%this.DB,n=this.DB-t,i=(1<<n)-1,s=Math.floor(r/this.DB),o=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+s+1]=this.data[a]>>n|o,o=(this.data[a]&i)<<t;for(a=s-1;a>=0;--a)e.data[a]=0;e.data[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function yce(r,e){e.s=this.s;var t=Math.floor(r/this.DB);if(t>=this.t){e.t=0;return}var n=r%this.DB,i=this.DB-n,s=(1<<n)-1;e.data[0]=this.data[t]>>n;for(var o=t+1;o<this.t;++o)e.data[o-t-1]|=(this.data[o]&s)<<i,e.data[o-t]=this.data[o]>>n;n>0&&(e.data[this.t-t-1]|=(this.s&s)<<i),e.t=this.t-t,e.clamp()}function wce(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]-r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n-=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n-=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n-=r.s}e.s=n<0?-1:0,n<-1?e.data[t++]=this.DV+n:n>0&&(e.data[t++]=n),e.t=t,e.clamp()}function bce(r,e){var t=this.abs(),n=r.abs(),i=t.t;for(e.t=i+n.t;--i>=0;)e.data[i]=0;for(i=0;i<n.t;++i)e.data[i+t.t]=t.am(0,n.data[i],e,i,0,t.t);e.s=0,e.clamp(),this.s!=r.s&&ee.ZERO.subTo(e,e)}function _ce(r){for(var e=this.abs(),t=r.t=2*e.t;--t>=0;)r.data[t]=0;for(t=0;t<e.t-1;++t){var n=e.am(t,e.data[t],r,2*t,0,1);(r.data[t+e.t]+=e.am(t+1,2*e.data[t],r,2*t+1,n,e.t-t-1))>=e.DV&&(r.data[t+e.t]-=e.DV,r.data[t+e.t+1]=1)}r.t>0&&(r.data[r.t-1]+=e.am(t,e.data[t],r,2*t,0,1)),r.s=0,r.clamp()}function Ece(r,e,t){var n=r.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e!=null&&e.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=At());var s=At(),o=this.s,a=r.s,c=this.DB-z3(n.data[n.t-1]);c>0?(n.lShiftTo(c,s),i.lShiftTo(c,t)):(n.copyTo(s),i.copyTo(t));var u=s.t,l=s.data[u-1];if(l!=0){var f=l*(1<<this.F1)+(u>1?s.data[u-2]>>this.F2:0),h=this.FV/f,d=(1<<this.F1)/f,m=1<<this.F2,w=t.t,b=w-u,v=e??At();for(s.dlShiftTo(b,v),t.compareTo(v)>=0&&(t.data[t.t++]=1,t.subTo(v,t)),ee.ONE.dlShiftTo(u,v),v.subTo(s,s);s.t<u;)s.data[s.t++]=0;for(;--b>=0;){var T=t.data[--w]==l?this.DM:Math.floor(t.data[w]*h+(t.data[w-1]+m)*d);if((t.data[w]+=s.am(0,T,t,b,0,u))<T)for(s.dlShiftTo(b,v),t.subTo(v,t);t.data[w]<--T;)t.subTo(v,t)}e!=null&&(t.drShiftTo(u,e),o!=a&&ee.ZERO.subTo(e,e)),t.t=u,t.clamp(),c>0&&t.rShiftTo(c,t),o<0&&ee.ZERO.subTo(t,t)}}}function vce(r){var e=At();return this.abs().divRemTo(r,null,e),this.s<0&&e.compareTo(ee.ZERO)>0&&r.subTo(e,e),e}function El(r){this.m=r}function Sce(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r}function xce(r){return r}function Tce(r){r.divRemTo(this.m,null,r)}function Ace(r,e,t){r.multiplyTo(e,t),this.reduce(t)}function Ice(r,e){r.squareTo(e),this.reduce(e)}El.prototype.convert=Sce;El.prototype.revert=xce;El.prototype.reduce=Tce;El.prototype.mulTo=Ace;El.prototype.sqrTo=Ice;function Rce(){if(this.t<1)return 0;var r=this.data[0];if(!(r&1))return 0;var e=r&3;return e=e*(2-(r&15)*e)&15,e=e*(2-(r&255)*e)&255,e=e*(2-((r&65535)*e&65535))&65535,e=e*(2-r*e%this.DV)%this.DV,e>0?this.DV-e:-e}function vl(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function Cce(r){var e=At();return r.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),r.s<0&&e.compareTo(ee.ZERO)>0&&this.m.subTo(e,e),e}function Pce(r){var e=At();return r.copyTo(e),this.reduce(e),e}function kce(r){for(;r.t<=this.mt2;)r.data[r.t++]=0;for(var e=0;e<this.m.t;++e){var t=r.data[e]&32767,n=t*this.mpl+((t*this.mph+(r.data[e]>>15)*this.mpl&this.um)<<15)&r.DM;for(t=e+this.m.t,r.data[t]+=this.m.am(0,n,r,e,0,this.m.t);r.data[t]>=r.DV;)r.data[t]-=r.DV,r.data[++t]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function Dce(r,e){r.squareTo(e),this.reduce(e)}function Nce(r,e,t){r.multiplyTo(e,t),this.reduce(t)}vl.prototype.convert=Cce;vl.prototype.revert=Pce;vl.prototype.reduce=kce;vl.prototype.mulTo=Nce;vl.prototype.sqrTo=Dce;function Oce(){return(this.t>0?this.data[0]&1:this.s)==0}function Lce(r,e){if(r>4294967295||r<1)return ee.ONE;var t=At(),n=At(),i=e.convert(this),s=z3(r)-1;for(i.copyTo(t);--s>=0;)if(e.sqrTo(t,n),(r&1<<s)>0)e.mulTo(n,i,t);else{var o=t;t=n,n=o}return e.revert(t)}function Bce(r,e){var t;return r<256||e.isEven()?t=new El(e):t=new vl(e),this.exp(r,t)}ee.prototype.copyTo=sce;ee.prototype.fromInt=oce;ee.prototype.fromString=ace;ee.prototype.clamp=cce;ee.prototype.dlShiftTo=pce;ee.prototype.drShiftTo=mce;ee.prototype.lShiftTo=gce;ee.prototype.rShiftTo=yce;ee.prototype.subTo=wce;ee.prototype.multiplyTo=bce;ee.prototype.squareTo=_ce;ee.prototype.divRemTo=Ece;ee.prototype.invDigit=Rce;ee.prototype.isEven=Oce;ee.prototype.exp=Lce;ee.prototype.toString=uce;ee.prototype.negate=lce;ee.prototype.abs=fce;ee.prototype.compareTo=dce;ee.prototype.bitLength=hce;ee.prototype.mod=vce;ee.prototype.modPowInt=Bce;ee.ZERO=qc(0);ee.ONE=qc(1);function Mce(){var r=At();return this.copyTo(r),r}function Uce(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function Fce(){return this.t==0?this.s:this.data[0]<<24>>24}function Vce(){return this.t==0?this.s:this.data[0]<<16>>16}function zce(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function Kce(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Hce(r){if(r==null&&(r=10),this.signum()==0||r<2||r>36)return"0";var e=this.chunkSize(r),t=Math.pow(r,e),n=qc(t),i=At(),s=At(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(t+s.intValue()).toString(r).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(r)+o}function $ce(r,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),n=Math.pow(e,t),i=!1,s=0,o=0,a=0;a<r.length;++a){var c=hN(r,a);if(c<0){r.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}o=e*o+c,++s>=t&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&ee.ZERO.subTo(this,this)}function qce(r,e,t){if(typeof e=="number")if(r<2)this.fromInt(1);else for(this.fromNumber(r,t),this.testBit(r-1)||this.bitwiseTo(ee.ONE.shiftLeft(r-1),S_,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(ee.ONE.shiftLeft(r-1),this);else{var n=new Array,i=r&7;n.length=(r>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function Gce(){var r=this.t,e=new Array;e[0]=this.s;var t=this.DB-r*this.DB%8,n,i=0;if(r-- >0)for(t<this.DB&&(n=this.data[r]>>t)!=(this.s&this.DM)>>t&&(e[i++]=n|this.s<<this.DB-t);r>=0;)t<8?(n=(this.data[r]&(1<<t)-1)<<8-t,n|=this.data[--r]>>(t+=this.DB-8)):(n=this.data[r]>>(t-=8)&255,t<=0&&(t+=this.DB,--r)),n&128&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function jce(r){return this.compareTo(r)==0}function Wce(r){return this.compareTo(r)<0?this:r}function Yce(r){return this.compareTo(r)>0?this:r}function Qce(r,e,t){var n,i,s=Math.min(r.t,this.t);for(n=0;n<s;++n)t.data[n]=e(this.data[n],r.data[n]);if(r.t<this.t){for(i=r.s&this.DM,n=s;n<this.t;++n)t.data[n]=e(this.data[n],i);t.t=this.t}else{for(i=this.s&this.DM,n=s;n<r.t;++n)t.data[n]=e(i,r.data[n]);t.t=r.t}t.s=e(this.s,r.s),t.clamp()}function Xce(r,e){return r&e}function Zce(r){var e=At();return this.bitwiseTo(r,Xce,e),e}function S_(r,e){return r|e}function Jce(r){var e=At();return this.bitwiseTo(r,S_,e),e}function pN(r,e){return r^e}function eue(r){var e=At();return this.bitwiseTo(r,pN,e),e}function mN(r,e){return r&~e}function tue(r){var e=At();return this.bitwiseTo(r,mN,e),e}function rue(){for(var r=At(),e=0;e<this.t;++e)r.data[e]=this.DM&~this.data[e];return r.t=this.t,r.s=~this.s,r}function nue(r){var e=At();return r<0?this.rShiftTo(-r,e):this.lShiftTo(r,e),e}function iue(r){var e=At();return r<0?this.lShiftTo(-r,e):this.rShiftTo(r,e),e}function sue(r){if(r==0)return-1;var e=0;return r&65535||(r>>=16,e+=16),r&255||(r>>=8,e+=8),r&15||(r>>=4,e+=4),r&3||(r>>=2,e+=2),r&1||++e,e}function oue(){for(var r=0;r<this.t;++r)if(this.data[r]!=0)return r*this.DB+sue(this.data[r]);return this.s<0?this.t*this.DB:-1}function aue(r){for(var e=0;r!=0;)r&=r-1,++e;return e}function cue(){for(var r=0,e=this.s&this.DM,t=0;t<this.t;++t)r+=aue(this.data[t]^e);return r}function uue(r){var e=Math.floor(r/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<r%this.DB)!=0}function lue(r,e){var t=ee.ONE.shiftLeft(r);return this.bitwiseTo(t,e,t),t}function fue(r){return this.changeBit(r,S_)}function due(r){return this.changeBit(r,mN)}function hue(r){return this.changeBit(r,pN)}function pue(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]+r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n+=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n+=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=r.s}e.s=n<0?-1:0,n>0?e.data[t++]=n:n<-1&&(e.data[t++]=this.DV+n),e.t=t,e.clamp()}function mue(r){var e=At();return this.addTo(r,e),e}function gue(r){var e=At();return this.subTo(r,e),e}function yue(r){var e=At();return this.multiplyTo(r,e),e}function wue(r){var e=At();return this.divRemTo(r,e,null),e}function bue(r){var e=At();return this.divRemTo(r,null,e),e}function _ue(r){var e=At(),t=At();return this.divRemTo(r,e,t),new Array(e,t)}function Eue(r){this.data[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()}function vue(r,e){if(r!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=r;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function jp(){}function gN(r){return r}function Sue(r,e,t){r.multiplyTo(e,t)}function xue(r,e){r.squareTo(e)}jp.prototype.convert=gN;jp.prototype.revert=gN;jp.prototype.mulTo=Sue;jp.prototype.sqrTo=xue;function Tue(r){return this.exp(r,new jp)}function Aue(r,e,t){var n=Math.min(this.t+r.t,e);for(t.s=0,t.t=n;n>0;)t.data[--n]=0;var i;for(i=t.t-this.t;n<i;++n)t.data[n+this.t]=this.am(0,r.data[n],t,n,0,this.t);for(i=Math.min(r.t,e);n<i;++n)this.am(0,r.data[n],t,n,0,e-n);t.clamp()}function Iue(r,e,t){--e;var n=t.t=this.t+r.t-e;for(t.s=0;--n>=0;)t.data[n]=0;for(n=Math.max(e-this.t,0);n<r.t;++n)t.data[this.t+n-e]=this.am(e-n,r.data[n],t,0,0,this.t+n-e);t.clamp(),t.drShiftTo(1,t)}function qd(r){this.r2=At(),this.q3=At(),ee.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}function Rue(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var e=At();return r.copyTo(e),this.reduce(e),e}function Cue(r){return r}function Pue(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)}function kue(r,e){r.squareTo(e),this.reduce(e)}function Due(r,e,t){r.multiplyTo(e,t),this.reduce(t)}qd.prototype.convert=Rue;qd.prototype.revert=Cue;qd.prototype.reduce=Pue;qd.prototype.mulTo=Due;qd.prototype.sqrTo=kue;function Nue(r,e){var t=r.bitLength(),n,i=qc(1),s;if(t<=0)return i;t<18?n=1:t<48?n=3:t<144?n=4:t<768?n=5:n=6,t<8?s=new El(e):e.isEven()?s=new qd(e):s=new vl(e);var o=new Array,a=3,c=n-1,u=(1<<n)-1;if(o[1]=s.convert(this),n>1){var l=At();for(s.sqrTo(o[1],l);a<=u;)o[a]=At(),s.mulTo(l,o[a-2],o[a]),a+=2}var f=r.t-1,h,d=!0,m=At(),w;for(t=z3(r.data[f])-1;f>=0;){for(t>=c?h=r.data[f]>>t-c&u:(h=(r.data[f]&(1<<t+1)-1)<<c-t,f>0&&(h|=r.data[f-1]>>this.DB+t-c)),a=n;!(h&1);)h>>=1,--a;if((t-=a)<0&&(t+=this.DB,--f),d)o[h].copyTo(i),d=!1;else{for(;a>1;)s.sqrTo(i,m),s.sqrTo(m,i),a-=2;a>0?s.sqrTo(i,m):(w=i,i=m,m=w),s.mulTo(m,o[h],i)}for(;f>=0&&!(r.data[f]&1<<t);)s.sqrTo(i,m),w=i,i=m,m=w,--t<0&&(t=this.DB-1,--f)}return s.revert(i)}function Oue(r){var e=this.s<0?this.negate():this.clone(),t=r.s<0?r.negate():r.clone();if(e.compareTo(t)<0){var n=e;e=t,t=n}var i=e.getLowestSetBit(),s=t.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),t.rShiftTo(s,t));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return s>0&&t.lShiftTo(s,t),t}function Lue(r){if(r<=0)return 0;var e=this.DV%r,t=this.s<0?r-1:0;if(this.t>0)if(e==0)t=this.data[0]%r;else for(var n=this.t-1;n>=0;--n)t=(e*t+this.data[n])%r;return t}function Bue(r){var e=r.isEven();if(this.isEven()&&e||r.signum()==0)return ee.ZERO;for(var t=r.clone(),n=this.clone(),i=qc(1),s=qc(0),o=qc(0),a=qc(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!i.isEven()||!s.isEven())&&(i.addTo(this,i),s.subTo(r,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(r,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(r,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(r,a),a.rShiftTo(1,a);t.compareTo(n)>=0?(t.subTo(n,t),e&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(t,n),e&&o.subTo(i,o),a.subTo(s,a))}if(n.compareTo(ee.ONE)!=0)return ee.ZERO;if(a.compareTo(r)>=0)return a.subtract(r);if(a.signum()<0)a.addTo(r,a);else return a;return a.signum()<0?a.add(r):a}var Us=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],Mue=(1<<26)/Us[Us.length-1];function Uue(r){var e,t=this.abs();if(t.t==1&&t.data[0]<=Us[Us.length-1]){for(e=0;e<Us.length;++e)if(t.data[0]==Us[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<Us.length;){for(var n=Us[e],i=e+1;i<Us.length&&n<Mue;)n*=Us[i++];for(n=t.modInt(n);e<i;)if(n%Us[e++]==0)return!1}return t.millerRabin(r)}function Fue(r){var e=this.subtract(ee.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var n=e.shiftRight(t),i=Vue(),s,o=0;o<r;++o){do s=new ee(this.bitLength(),i);while(s.compareTo(ee.ONE)<=0||s.compareTo(e)>=0);var a=s.modPow(n,this);if(a.compareTo(ee.ONE)!=0&&a.compareTo(e)!=0){for(var c=1;c++<t&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(ee.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function Vue(){return{nextBytes:function(r){for(var e=0;e<r.length;++e)r[e]=Math.floor(Math.random()*256)}}}ee.prototype.chunkSize=zce;ee.prototype.toRadix=Hce;ee.prototype.fromRadix=$ce;ee.prototype.fromNumber=qce;ee.prototype.bitwiseTo=Qce;ee.prototype.changeBit=lue;ee.prototype.addTo=pue;ee.prototype.dMultiply=Eue;ee.prototype.dAddOffset=vue;ee.prototype.multiplyLowerTo=Aue;ee.prototype.multiplyUpperTo=Iue;ee.prototype.modInt=Lue;ee.prototype.millerRabin=Fue;ee.prototype.clone=Mce;ee.prototype.intValue=Uce;ee.prototype.byteValue=Fce;ee.prototype.shortValue=Vce;ee.prototype.signum=Kce;ee.prototype.toByteArray=Gce;ee.prototype.equals=jce;ee.prototype.min=Wce;ee.prototype.max=Yce;ee.prototype.and=Zce;ee.prototype.or=Jce;ee.prototype.xor=eue;ee.prototype.andNot=tue;ee.prototype.not=rue;ee.prototype.shiftLeft=nue;ee.prototype.shiftRight=iue;ee.prototype.getLowestSetBit=oue;ee.prototype.bitCount=cue;ee.prototype.testBit=uue;ee.prototype.setBit=fue;ee.prototype.clearBit=due;ee.prototype.flipBit=hue;ee.prototype.add=mue;ee.prototype.subtract=gue;ee.prototype.multiply=yue;ee.prototype.divide=wue;ee.prototype.remainder=bue;ee.prototype.divideAndRemainder=_ue;ee.prototype.modPow=Nue;ee.prototype.modInverse=Bue;ee.prototype.pow=Tue;ee.prototype.gcd=Oue;ee.prototype.isProbablePrime=Uue});var vN=B((kAe,EN)=>{var Eo=it();Hc();Jt();var bN=EN.exports=Eo.sha1=Eo.sha1||{};Eo.md.sha1=Eo.md.algorithms.sha1=bN;bN.create=function(){_N||zue();var r=null,e=Eo.util.createBuffer(),t=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Eo.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Eo.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),wN(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Eo.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(x_.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,l=0;l<n.fullMessageLength.length-1;++l)a=n.fullMessageLength[l+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4};wN(f,t,i);var h=Eo.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h},n};var x_=null,_N=!1;function zue(){x_=String.fromCharCode(128),x_+=Eo.util.fillString(String.fromCharCode(0),64),_N=!0}function wN(r,e,t){for(var n,i,s,o,a,c,u,l,f=t.length();f>=64;){for(i=r.h0,s=r.h1,o=r.h2,a=r.h3,c=r.h4,l=0;l<16;++l)n=t.getInt32(),e[l]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<20;++l)n=e[l-3]^e[l-8]^e[l-14]^e[l-16],n=n<<1|n>>>31,e[l]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<32;++l)n=e[l-3]^e[l-8]^e[l-14]^e[l-16],n=n<<1|n>>>31,e[l]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<40;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<60;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=s&o|a&(s^o),n=(i<<5|i>>>27)+u+c+2400959708+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<80;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+3395469782+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;r.h0=r.h0+i|0,r.h1=r.h1+s|0,r.h2=r.h2+o|0,r.h3=r.h3+a|0,r.h4=r.h4+c|0,f-=64}}});var TN=B((DAe,xN)=>{var vo=it();Jt();_l();vN();var SN=xN.exports=vo.pkcs1=vo.pkcs1||{};SN.encode_rsa_oaep=function(r,e,t){var n,i,s,o;typeof t=="string"?(n=t,i=arguments[3]||void 0,s=arguments[4]||void 0):t&&(n=t.label||void 0,i=t.seed||void 0,s=t.md||void 0,t.mgf1&&t.mgf1.md&&(o=t.mgf1.md)),s?s.start():s=vo.md.sha1.create(),o||(o=s);var a=Math.ceil(r.n.bitLength()/8),c=a-2*s.digestLength-2;if(e.length>c){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=c,u}n||(n=""),s.update(n,"raw");for(var l=s.digest(),f="",h=c-e.length,d=0;d<h;d++)f+="\0";var m=l.getBytes()+f+""+e;if(!i)i=vo.random.getBytes(s.digestLength);else if(i.length!==s.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=i.length,u.digestLength=s.digestLength,u}var w=H3(i,a-s.digestLength-1,o),b=vo.util.xorBytes(m,w,m.length),v=H3(b,s.digestLength,o),T=vo.util.xorBytes(i,v,i.length);return"\0"+T+b};SN.decode_rsa_oaep=function(r,e,t){var n,i,s;typeof t=="string"?(n=t,i=arguments[3]||void 0):t&&(n=t.label||void 0,i=t.md||void 0,t.mgf1&&t.mgf1.md&&(s=t.mgf1.md));var o=Math.ceil(r.n.bitLength()/8);if(e.length!==o){var b=new Error("RSAES-OAEP encoded message length is invalid.");throw b.length=e.length,b.expectedLength=o,b}if(i===void 0?i=vo.md.sha1.create():i.start(),s||(s=i),o<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),c=e.charAt(0),u=e.substring(1,i.digestLength+1),l=e.substring(1+i.digestLength),f=H3(l,i.digestLength,s),h=vo.util.xorBytes(u,f,u.length),d=H3(h,o-i.digestLength-1,s),m=vo.util.xorBytes(l,d,l.length),w=m.substring(0,i.digestLength),b=c!=="\0",v=0;v<i.digestLength;++v)b|=a.charAt(v)!==w.charAt(v);for(var T=1,p=i.digestLength,g=i.digestLength;g<m.length;g++){var y=m.charCodeAt(g),E=y&1^1,_=T?65534:0;b|=y&_,T=T&E,p+=T}if(b||m.charCodeAt(p)!==1)throw new Error("Invalid RSAES-OAEP padding.");return m.substring(p+1)};function H3(r,e,t){t||(t=vo.md.sha1.create());for(var n="",i=Math.ceil(e/t.digestLength),s=0;s<i;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);t.start(),t.update(r+o),n+=t.digest().getBytes()}return n.substring(0,e)}});var AN=B((NAe,T_)=>{var Gc=it();Jt();K3();_l();(function(){if(Gc.prime){T_.exports=Gc.prime;return}var r=T_.exports=Gc.prime=Gc.prime||{},e=Gc.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(f,h){return f|h};r.generateProbablePrime=function(f,h,d){typeof h=="function"&&(d=h,h={}),h=h||{};var m=h.algorithm||"PRIMEINC";typeof m=="string"&&(m={name:m}),m.options=m.options||{};var w=h.prng||Gc.random,b={nextBytes:function(v){for(var T=w.getBytesSync(v.length),p=0;p<v.length;++p)v[p]=T.charCodeAt(p)}};if(m.name==="PRIMEINC")return s(f,b,m.options,d);throw new Error("Invalid prime generation algorithm: "+m.name)};function s(f,h,d,m){return"workers"in d?c(f,h,d,m):o(f,h,d,m)}function o(f,h,d,m){var w=u(f,h),b=0,v=l(w.bitLength());"millerRabinTests"in d&&(v=d.millerRabinTests);var T=10;"maxBlockTime"in d&&(T=d.maxBlockTime),a(w,f,h,b,v,T,m)}function a(f,h,d,m,w,b,v){var T=+new Date;do{if(f.bitLength()>h&&(f=u(h,d)),f.isProbablePrime(w))return v(null,f);f.dAddOffset(t[m++%8],0)}while(b<0||+new Date-T<b);Gc.util.setImmediate(function(){a(f,h,d,m,w,b,v)})}function c(f,h,d,m){if(typeof Worker>"u")return o(f,h,d,m);var w=u(f,h),b=d.workers,v=d.workLoad||100,T=v*30/8,p=d.workerScript||"forge/prime.worker.js";if(b===-1)return Gc.util.estimateCores(function(y,E){y&&(E=2),b=E-1,g()});g();function g(){b=Math.max(1,b);for(var y=[],E=0;E<b;++E)y[E]=new Worker(p);for(var _=b,E=0;E<b;++E)y[E].addEventListener("message",S);var x=!1;function S(I){if(!x){--_;var k=I.data;if(k.found){for(var N=0;N<y.length;++N)y[N].terminate();return x=!0,m(null,new e(k.prime,16))}w.bitLength()>f&&(w=u(f,h));var L=w.toString(16);I.target.postMessage({hex:L,workLoad:v}),w.dAddOffset(T,0)}}}}function u(f,h){var d=new e(f,h),m=f-1;return d.testBit(m)||d.bitwiseTo(e.ONE.shiftLeft(m),i,d),d.dAddOffset(31-d.mod(n).byteValue(),0),d}function l(f){return f<=100?27:f<=150?18:f<=200?15:f<=250?12:f<=300?9:f<=350?8:f<=400?7:f<=500?6:f<=600?5:f<=800?4:f<=1250?3:2}})()});var Wp=B((OAe,NN)=>{var Ae=it();Kc();K3();Vd();TN();AN();_l();Jt();typeof bt>"u"&&(bt=Ae.jsbn.BigInteger);var bt,A_=Ae.util.isNodejs?$c():null,q=Ae.asn1,Ji=Ae.util;Ae.pki=Ae.pki||{};NN.exports=Ae.pki.rsa=Ae.rsa=Ae.rsa||{};var $e=Ae.pki,Kue=[6,4,2,4,2,4,6,2],Hue={name:"PrivateKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},$ue={name:"RSAPrivateKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},que={name:"RSAPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:q.Class.UNIVERSAL,type:q.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},Gue=Ae.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},jue={name:"DigestInfo",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:q.Class.UNIVERSAL,type:q.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:q.Class.UNIVERSAL,type:q.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:q.Class.UNIVERSAL,type:q.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:q.Class.UNIVERSAL,type:q.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},Wue=function(r){var e;if(r.algorithm in $e.oids)e=$e.oids[r.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=r.algorithm,t}var n=q.oidToDer(e).getBytes(),i=q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[]),s=q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[]);s.value.push(q.create(q.Class.UNIVERSAL,q.Type.OID,!1,n)),s.value.push(q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,""));var o=q.create(q.Class.UNIVERSAL,q.Type.OCTETSTRING,!1,r.digest().getBytes());return i.value.push(s),i.value.push(o),q.toDer(i).getBytes()},kN=function(r,e,t){if(t)return r.modPow(e.e,e.n);if(!e.p||!e.q)return r.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(bt.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(bt.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new bt(Ae.util.bytesToHex(Ae.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(bt.ONE));r=r.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var i=r.mod(e.p).modPow(e.dP,e.p),s=r.mod(e.q).modPow(e.dQ,e.q);i.compareTo(s)<0;)i=i.add(e.p);var o=i.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};$e.rsa.encrypt=function(r,e,t){var n=t,i,s=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(n=t===2,i=DN(r,e,t)):(i=Ae.util.createBuffer(),i.putBytes(r));for(var o=new bt(i.toHex(),16),a=kN(o,e,n),c=a.toString(16),u=Ae.util.createBuffer(),l=s-Math.ceil(c.length/2);l>0;)u.putByte(0),--l;return u.putBytes(Ae.util.hexToBytes(c)),u.getBytes()};$e.rsa.decrypt=function(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8);if(r.length!==i){var s=new Error("Encrypted message length is invalid.");throw s.length=r.length,s.expected=i,s}var o=new bt(Ae.util.createBuffer(r).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=kN(o,e,t),c=a.toString(16),u=Ae.util.createBuffer(),l=i-Math.ceil(c.length/2);l>0;)u.putByte(0),--l;return u.putBytes(Ae.util.hexToBytes(c)),n!==!1?$3(u.getBytes(),e,t):u.getBytes()};$e.rsa.createKeyPairGenerationState=function(r,e,t){typeof r=="string"&&(r=parseInt(r,10)),r=r||2048,t=t||{};var n=t.prng||Ae.random,i={nextBytes:function(a){for(var c=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=c.charCodeAt(u)}},s=t.algorithm||"PRIMEINC",o;if(s==="PRIMEINC")o={algorithm:s,state:0,bits:r,rng:i,eInt:e||65537,e:new bt(null),p:null,q:null,qBits:r>>1,pBits:r-(r>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+s);return o};$e.rsa.stepKeyPairGenerationState=function(r,e){"algorithm"in r||(r.algorithm="PRIMEINC");var t=new bt(null);t.fromInt(30);for(var n=0,i=function(f,h){return f|h},s=+new Date,o,a=0;r.keys===null&&(e<=0||a<e);){if(r.state===0){var c=r.p===null?r.pBits:r.qBits,u=c-1;r.pqState===0?(r.num=new bt(c,r.rng),r.num.testBit(u)||r.num.bitwiseTo(bt.ONE.shiftLeft(u),i,r.num),r.num.dAddOffset(31-r.num.mod(t).byteValue(),0),n=0,++r.pqState):r.pqState===1?r.num.bitLength()>c?r.pqState=0:r.num.isProbablePrime(Que(r.num.bitLength()))?++r.pqState:r.num.dAddOffset(Kue[n++%8],0):r.pqState===2?r.pqState=r.num.subtract(bt.ONE).gcd(r.e).compareTo(bt.ONE)===0?3:0:r.pqState===3&&(r.pqState=0,r.p===null?r.p=r.num:r.q=r.num,r.p!==null&&r.q!==null&&++r.state,r.num=null)}else if(r.state===1)r.p.compareTo(r.q)<0&&(r.num=r.p,r.p=r.q,r.q=r.num),++r.state;else if(r.state===2)r.p1=r.p.subtract(bt.ONE),r.q1=r.q.subtract(bt.ONE),r.phi=r.p1.multiply(r.q1),++r.state;else if(r.state===3)r.phi.gcd(r.e).compareTo(bt.ONE)===0?++r.state:(r.p=null,r.q=null,r.state=0);else if(r.state===4)r.n=r.p.multiply(r.q),r.n.bitLength()===r.bits?++r.state:(r.q=null,r.state=0);else if(r.state===5){var l=r.e.modInverse(r.phi);r.keys={privateKey:$e.rsa.setPrivateKey(r.n,r.e,l,r.p,r.q,l.mod(r.p1),l.mod(r.q1),r.q.modInverse(r.p)),publicKey:$e.rsa.setPublicKey(r.n,r.e)}}o=+new Date,a+=o-s,s=o}return r.keys!==null};$e.rsa.generateKeyPair=function(r,e,t,n){if(arguments.length===1?typeof r=="object"?(t=r,r=void 0):typeof r=="function"&&(n=r,r=void 0):arguments.length===2?typeof r=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=r,n=e,r=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(n=t,t=void 0):(n=t,t=e,e=void 0)),t=t||{},r===void 0&&(r=t.bits||2048),e===void 0&&(e=t.e||65537),!Ae.options.usePureJavaScript&&!t.prng&&r>=256&&r<=16384&&(e===65537||e===3)){if(n){if(IN("generateKeyPair"))return A_.generateKeyPair("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,c,u){if(a)return n(a);n(null,{privateKey:$e.privateKeyFromPem(u),publicKey:$e.publicKeyFromPem(c)})});if(RN("generateKey")&&RN("exportKey"))return Ji.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:PN(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return Ji.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var c=$e.privateKeyFromAsn1(q.fromDer(Ae.util.createBuffer(a)));n(null,{privateKey:c,publicKey:$e.setRsaPublicKey(c.n,c.e)})}});if(CN("generateKey")&&CN("exportKey")){var i=Ji.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:PN(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);i.oncomplete=function(a){var c=a.target.result,u=Ji.globalScope.msCrypto.subtle.exportKey("pkcs8",c.privateKey);u.oncomplete=function(l){var f=l.target.result,h=$e.privateKeyFromAsn1(q.fromDer(Ae.util.createBuffer(f)));n(null,{privateKey:h,publicKey:$e.setRsaPublicKey(h.n,h.e)})},u.onerror=function(l){n(l)}},i.onerror=function(a){n(a)};return}}else if(IN("generateKeyPairSync")){var s=A_.generateKeyPairSync("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:$e.privateKeyFromPem(s.privateKey),publicKey:$e.publicKeyFromPem(s.publicKey)}}}var o=$e.rsa.createKeyPairGenerationState(r,e,t);if(!n)return $e.rsa.stepKeyPairGenerationState(o,0),o.keys;Yue(o,t,n)};$e.setRsaPublicKey=$e.rsa.setPublicKey=function(r,e){var t={n:r,e};return t.encrypt=function(n,i,s){if(typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSAES-PKCS1-V1_5"),i==="RSAES-PKCS1-V1_5")i={encode:function(a,c,u){return DN(a,c,2).getBytes()}};else if(i==="RSA-OAEP"||i==="RSAES-OAEP")i={encode:function(a,c){return Ae.pkcs1.encode_rsa_oaep(c,a,s)}};else if(["RAW","NONE","NULL",null].indexOf(i)!==-1)i={encode:function(a){return a}};else if(typeof i=="string")throw new Error('Unsupported encryption scheme: "'+i+'".');var o=i.encode(n,t,!0);return $e.rsa.encrypt(o,t,!0)},t.verify=function(n,i,s,o){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(c,u){u=$3(u,t,!0);var l=q.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),f={},h=[];if(!q.validate(l,jue,f,h)){var d=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw d.errors=h,d}var m=q.derToOid(f.algorithmIdentifier);if(!(m===Ae.oids.md2||m===Ae.oids.md5||m===Ae.oids.sha1||m===Ae.oids.sha224||m===Ae.oids.sha256||m===Ae.oids.sha384||m===Ae.oids.sha512||m===Ae.oids["sha512-224"]||m===Ae.oids["sha512-256"])){var d=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw d.oid=m,d}if((m===Ae.oids.md2||m===Ae.oids.md5)&&!("parameters"in f))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return c===f.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(c,u){return u=$3(u,t,!0),c===u}});var a=$e.rsa.decrypt(i,t,!0,!1);return s.verify(n,a,t.n.bitLength())},t};$e.setRsaPrivateKey=$e.rsa.setPrivateKey=function(r,e,t,n,i,s,o,a){var c={n:r,e,d:t,p:n,q:i,dP:s,dQ:o,qInv:a};return c.decrypt=function(u,l,f){typeof l=="string"?l=l.toUpperCase():l===void 0&&(l="RSAES-PKCS1-V1_5");var h=$e.rsa.decrypt(u,c,!1,!1);if(l==="RSAES-PKCS1-V1_5")l={decode:$3};else if(l==="RSA-OAEP"||l==="RSAES-OAEP")l={decode:function(d,m){return Ae.pkcs1.decode_rsa_oaep(m,d,f)}};else if(["RAW","NONE","NULL",null].indexOf(l)!==-1)l={decode:function(d){return d}};else throw new Error('Unsupported encryption scheme: "'+l+'".');return l.decode(h,c,!1)},c.sign=function(u,l){var f=!1;typeof l=="string"&&(l=l.toUpperCase()),l===void 0||l==="RSASSA-PKCS1-V1_5"?(l={encode:Wue},f=1):(l==="NONE"||l==="NULL"||l===null)&&(l={encode:function(){return u}},f=1);var h=l.encode(u,c.n.bitLength());return $e.rsa.encrypt(h,c,f)},c};$e.wrapRsaPrivateKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,q.integerToDer(0).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.OID,!1,q.oidToDer($e.oids.rsaEncryption).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,"")]),q.create(q.Class.UNIVERSAL,q.Type.OCTETSTRING,!1,q.toDer(r).getBytes())])};$e.privateKeyFromAsn1=function(r){var e={},t=[];if(q.validate(r,Hue,e,t)&&(r=q.fromDer(Ae.util.createBuffer(e.privateKey))),e={},t=[],!q.validate(r,$ue,e,t)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=t,n}var i,s,o,a,c,u,l,f;return i=Ae.util.createBuffer(e.privateKeyModulus).toHex(),s=Ae.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=Ae.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=Ae.util.createBuffer(e.privateKeyPrime1).toHex(),c=Ae.util.createBuffer(e.privateKeyPrime2).toHex(),u=Ae.util.createBuffer(e.privateKeyExponent1).toHex(),l=Ae.util.createBuffer(e.privateKeyExponent2).toHex(),f=Ae.util.createBuffer(e.privateKeyCoefficient).toHex(),$e.setRsaPrivateKey(new bt(i,16),new bt(s,16),new bt(o,16),new bt(a,16),new bt(c,16),new bt(u,16),new bt(l,16),new bt(f,16))};$e.privateKeyToAsn1=$e.privateKeyToRSAPrivateKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,q.integerToDer(0).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.n)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.e)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.d)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.p)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.q)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.dP)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.dQ)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.qInv))])};$e.publicKeyFromAsn1=function(r){var e={},t=[];if(q.validate(r,Gue,e,t)){var n=q.derToOid(e.publicKeyOid);if(n!==$e.oids.rsaEncryption){var i=new Error("Cannot read public key. Unknown OID.");throw i.oid=n,i}r=e.rsaPublicKey}if(t=[],!q.validate(r,que,e,t)){var i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw i.errors=t,i}var s=Ae.util.createBuffer(e.publicKeyModulus).toHex(),o=Ae.util.createBuffer(e.publicKeyExponent).toHex();return $e.setRsaPublicKey(new bt(s,16),new bt(o,16))};$e.publicKeyToAsn1=$e.publicKeyToSubjectPublicKeyInfo=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.OID,!1,q.oidToDer($e.oids.rsaEncryption).getBytes()),q.create(q.Class.UNIVERSAL,q.Type.NULL,!1,"")]),q.create(q.Class.UNIVERSAL,q.Type.BITSTRING,!1,[$e.publicKeyToRSAPublicKey(r)])])};$e.publicKeyToRSAPublicKey=function(r){return q.create(q.Class.UNIVERSAL,q.Type.SEQUENCE,!0,[q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.n)),q.create(q.Class.UNIVERSAL,q.Type.INTEGER,!1,So(r.e))])};function DN(r,e,t){var n=Ae.util.createBuffer(),i=Math.ceil(e.n.bitLength()/8);if(r.length>i-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=r.length,s.max=i-11,s}n.putByte(0),n.putByte(t);var o=i-3-r.length,a;if(t===0||t===1){a=t===0?0:255;for(var c=0;c<o;++c)n.putByte(a)}else for(;o>0;){for(var u=0,l=Ae.random.getBytes(o),c=0;c<o;++c)a=l.charCodeAt(c),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(r),n}function $3(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8),s=Ae.util.createBuffer(r),o=s.getByte(),a=s.getByte();if(o!==0||t&&a!==0&&a!==1||!t&&a!=2||t&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var c=0;if(a===0){c=i-3-n;for(var u=0;u<c;++u)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(c=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++c}else if(a===2)for(c=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++c}var l=s.getByte();if(l!==0||c!==i-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function Yue(r,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),i();function i(){s(r.pBits,function(a,c){if(a)return t(a);if(r.p=c,r.q!==null)return o(a,r.q);s(r.qBits,o)})}function s(a,c){Ae.prime.generateProbablePrime(a,n,c)}function o(a,c){if(a)return t(a);if(r.q=c,r.p.compareTo(r.q)<0){var u=r.p;r.p=r.q,r.q=u}if(r.p.subtract(bt.ONE).gcd(r.e).compareTo(bt.ONE)!==0){r.p=null,i();return}if(r.q.subtract(bt.ONE).gcd(r.e).compareTo(bt.ONE)!==0){r.q=null,s(r.qBits,o);return}if(r.p1=r.p.subtract(bt.ONE),r.q1=r.q.subtract(bt.ONE),r.phi=r.p1.multiply(r.q1),r.phi.gcd(r.e).compareTo(bt.ONE)!==0){r.p=r.q=null,i();return}if(r.n=r.p.multiply(r.q),r.n.bitLength()!==r.bits){r.q=null,s(r.qBits,o);return}var l=r.e.modInverse(r.phi);r.keys={privateKey:$e.rsa.setPrivateKey(r.n,r.e,l,r.p,r.q,l.mod(r.p1),l.mod(r.q1),r.q.modInverse(r.p)),publicKey:$e.rsa.setPublicKey(r.n,r.e)},t(null,r.keys)}}function So(r){var e=r.toString(16);e[0]>="8"&&(e="00"+e);var t=Ae.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&!(t.charCodeAt(1)&128)||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function Que(r){return r<=100?27:r<=150?18:r<=200?15:r<=250?12:r<=300?9:r<=350?8:r<=400?7:r<=500?6:r<=600?5:r<=800?4:r<=1250?3:2}function IN(r){return Ae.util.isNodejs&&typeof A_[r]=="function"}function RN(r){return typeof Ji.globalScope<"u"&&typeof Ji.globalScope.crypto=="object"&&typeof Ji.globalScope.crypto.subtle=="object"&&typeof Ji.globalScope.crypto.subtle[r]=="function"}function CN(r){return typeof Ji.globalScope<"u"&&typeof Ji.globalScope.msCrypto=="object"&&typeof Ji.globalScope.msCrypto.subtle=="object"&&typeof Ji.globalScope.msCrypto.subtle[r]=="function"}function PN(r){for(var e=Ae.util.hexToBytes(r.toString(16)),t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}});var I_=B((LAe,UN)=>{var me=it();Hd();Kc();O3();Hc();Vd();y_();U3();_l();uN();Wp();Jt();typeof ON>"u"&&(ON=me.jsbn.BigInteger);var ON,Q=me.asn1,We=me.pki=me.pki||{};UN.exports=We.pbe=me.pbe=me.pbe||{};var Sl=We.oids,Xue={name:"EncryptedPrivateKeyInfo",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Zue={name:"PBES2Algorithms",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:Q.Class.UNIVERSAL,type:Q.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:Q.Class.UNIVERSAL,type:Q.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},Jue={name:"pkcs-12PbeParams",tagClass:Q.Class.UNIVERSAL,type:Q.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:Q.Class.UNIVERSAL,type:Q.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:Q.Class.UNIVERSAL,type:Q.Type.INTEGER,constructed:!1,capture:"iterations"}]};We.encryptPrivateKeyInfo=function(r,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var n=me.random.getBytesSync(t.saltSize),i=t.count,s=Q.integerToDer(i),o,a,c;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var u,l,f;switch(t.algorithm){case"aes128":o=16,u=16,l=Sl["aes128-CBC"],f=me.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,l=Sl["aes192-CBC"],f=me.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,l=Sl["aes256-CBC"],f=me.aes.createEncryptionCipher;break;case"des":o=8,u=8,l=Sl.desCBC,f=me.des.createEncryptionCipher;break;default:var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var d="hmacWith"+t.prfAlgorithm.toUpperCase(),m=MN(d),w=me.pkcs5.pbkdf2(e,n,i,o,m),b=me.random.getBytesSync(u),v=f(w);v.start(b),v.update(Q.toDer(r)),v.finish(),c=v.output.getBytes();var T=ele(n,s,o,d);a=Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OID,!1,Q.oidToDer(Sl.pkcs5PBES2).getBytes()),Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OID,!1,Q.oidToDer(Sl.pkcs5PBKDF2).getBytes()),T]),Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OID,!1,Q.oidToDer(l).getBytes()),Q.create(Q.Class.UNIVERSAL,Q.Type.OCTETSTRING,!1,b)])])])}else if(t.algorithm==="3des"){o=24;var p=new me.util.ByteBuffer(n),w=We.pbe.generatePkcs12Key(e,p,1,i,o),b=We.pbe.generatePkcs12Key(e,p,2,i,o),v=me.des.createEncryptionCipher(w);v.start(b),v.update(Q.toDer(r)),v.finish(),c=v.output.getBytes(),a=Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OID,!1,Q.oidToDer(Sl["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OCTETSTRING,!1,n),Q.create(Q.Class.UNIVERSAL,Q.Type.INTEGER,!1,s.getBytes())])])}else{var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var g=Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[a,Q.create(Q.Class.UNIVERSAL,Q.Type.OCTETSTRING,!1,c)]);return g};We.decryptPrivateKeyInfo=function(r,e){var t=null,n={},i=[];if(!Q.validate(r,Xue,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=Q.derToOid(n.encryptionOid),a=We.pbe.getCipher(o,n.encryptionParams,e),c=me.util.createBuffer(n.encryptedData);return a.update(c),a.finish()&&(t=Q.fromDer(a.output)),t};We.encryptedPrivateKeyToPem=function(r,e){var t={type:"ENCRYPTED PRIVATE KEY",body:Q.toDer(r).getBytes()};return me.pem.encode(t,{maxline:e})};We.encryptedPrivateKeyFromPem=function(r){var e=me.pem.decode(r)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return Q.fromDer(e.body)};We.encryptRsaPrivateKey=function(r,e,t){if(t=t||{},!t.legacy){var n=We.wrapRsaPrivateKey(We.privateKeyToAsn1(r));return n=We.encryptPrivateKeyInfo(n,e,t),We.encryptedPrivateKeyToPem(n)}var i,s,o,a;switch(t.algorithm){case"aes128":i="AES-128-CBC",o=16,s=me.random.getBytesSync(16),a=me.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",o=24,s=me.random.getBytesSync(16),a=me.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",o=32,s=me.random.getBytesSync(16),a=me.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",o=24,s=me.random.getBytesSync(8),a=me.des.createEncryptionCipher;break;case"des":i="DES-CBC",o=8,s=me.random.getBytesSync(8),a=me.des.createEncryptionCipher;break;default:var c=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw c.algorithm=t.algorithm,c}var u=me.pbe.opensslDeriveBytes(e,s.substr(0,8),o),l=a(u);l.start(s),l.update(Q.toDer(We.privateKeyToAsn1(r))),l.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:me.util.bytesToHex(s).toUpperCase()},body:l.output.getBytes()};return me.pem.encode(f)};We.decryptRsaPrivateKey=function(r,e){var t=null,n=me.pem.decode(r)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(n.procType&&n.procType.type==="ENCRYPTED"){var s,o;switch(n.dekInfo.algorithm){case"DES-CBC":s=8,o=me.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,o=me.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,o=me.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,o=me.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,o=me.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,o=function(f){return me.rc2.createDecryptionCipher(f,40)};break;case"RC2-64-CBC":s=8,o=function(f){return me.rc2.createDecryptionCipher(f,64)};break;case"RC2-128-CBC":s=16,o=function(f){return me.rc2.createDecryptionCipher(f,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw i.algorithm=n.dekInfo.algorithm,i}var a=me.util.hexToBytes(n.dekInfo.parameters),c=me.pbe.opensslDeriveBytes(e,a.substr(0,8),s),u=o(c);if(u.start(a),u.update(me.util.createBuffer(n.body)),u.finish())t=u.output.getBytes();else return t}else t=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?t=We.decryptPrivateKeyInfo(Q.fromDer(t),e):t=Q.fromDer(t),t!==null&&(t=We.privateKeyFromAsn1(t)),t};We.pbe.generatePkcs12Key=function(r,e,t,n,i,s){var o,a;if(typeof s>"u"||s===null){if(!("sha1"in me.md))throw new Error('"sha1" hash algorithm unavailable.');s=me.md.sha1.create()}var c=s.digestLength,u=s.blockLength,l=new me.util.ByteBuffer,f=new me.util.ByteBuffer;if(r!=null){for(a=0;a<r.length;a++)f.putInt16(r.charCodeAt(a));f.putInt16(0)}var h=f.length(),d=e.length(),m=new me.util.ByteBuffer;m.fillWithByte(t,u);var w=u*Math.ceil(d/u),b=new me.util.ByteBuffer;for(a=0;a<w;a++)b.putByte(e.at(a%d));var v=u*Math.ceil(h/u),T=new me.util.ByteBuffer;for(a=0;a<v;a++)T.putByte(f.at(a%h));var p=b;p.putBuffer(T);for(var g=Math.ceil(i/c),y=1;y<=g;y++){var E=new me.util.ByteBuffer;E.putBytes(m.bytes()),E.putBytes(p.bytes());for(var _=0;_<n;_++)s.start(),s.update(E.getBytes()),E=s.digest();var x=new me.util.ByteBuffer;for(a=0;a<u;a++)x.putByte(E.at(a%c));var S=Math.ceil(d/u)+Math.ceil(h/u),I=new me.util.ByteBuffer;for(o=0;o<S;o++){var k=new me.util.ByteBuffer(p.getBytes(u)),N=511;for(a=x.length()-1;a>=0;a--)N=N>>8,N+=x.at(a)+k.at(a),k.setAt(a,N&255);I.putBuffer(k)}p=I,l.putBuffer(E)}return l.truncate(l.length()-i),l};We.pbe.getCipher=function(r,e,t){switch(r){case We.oids.pkcs5PBES2:return We.pbe.getCipherForPBES2(r,e,t);case We.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case We.oids["pbewithSHAAnd40BitRC2-CBC"]:return We.pbe.getCipherForPKCS12PBE(r,e,t);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=r,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};We.pbe.getCipherForPBES2=function(r,e,t){var n={},i=[];if(!Q.validate(e,Zue,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}if(r=Q.derToOid(n.kdfOid),r!==We.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=r,s.supportedOids=["pkcs5PBKDF2"],s}if(r=Q.derToOid(n.encOid),r!==We.oids["aes128-CBC"]&&r!==We.oids["aes192-CBC"]&&r!==We.oids["aes256-CBC"]&&r!==We.oids["des-EDE3-CBC"]&&r!==We.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=r,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var o=n.kdfSalt,a=me.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var c,u;switch(We.oids[r]){case"aes128-CBC":c=16,u=me.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,u=me.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,u=me.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,u=me.des.createDecryptionCipher;break;case"desCBC":c=8,u=me.des.createDecryptionCipher;break}var l=BN(n.prfOid),f=me.pkcs5.pbkdf2(t,o,a,c,l),h=n.encIv,d=u(f);return d.start(h),d};We.pbe.getCipherForPKCS12PBE=function(r,e,t){var n={},i=[];if(!Q.validate(e,Jue,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=me.util.createBuffer(n.salt),a=me.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var c,u,l;switch(r){case We.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,u=8,l=me.des.startDecrypting;break;case We.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,u=8,l=function(w,b){var v=me.rc2.createDecryptionCipher(w,40);return v.start(b,null),v};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=r,s}var f=BN(n.prfOid),h=We.pbe.generatePkcs12Key(t,o,1,a,c,f);f.start();var d=We.pbe.generatePkcs12Key(t,o,2,a,u,f);return l(h,d)};We.pbe.opensslDeriveBytes=function(r,e,t,n){if(typeof n>"u"||n===null){if(!("md5"in me.md))throw new Error('"md5" hash algorithm unavailable.');n=me.md.md5.create()}e===null&&(e="");for(var i=[LN(n,r+e)],s=16,o=1;s<t;++o,s+=16)i.push(LN(n,i[o-1]+r+e));return i.join("").substr(0,t)};function LN(r,e){return r.start().update(e).digest().getBytes()}function BN(r){var e;if(!r)e="hmacWithSHA1";else if(e=We.oids[Q.derToOid(r)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return MN(e)}function MN(r){var e=me.md;switch(r){case"hmacWithSHA224":e=me.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":r=r.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(r in e))throw new Error("Unknown hash algorithm: "+r);return e[r].create()}function ele(r,e,t,n){var i=Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OCTETSTRING,!1,r),Q.create(Q.Class.UNIVERSAL,Q.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&i.value.push(Q.create(Q.Class.UNIVERSAL,Q.Type.INTEGER,!1,me.util.hexToBytes(t.toString(16))),Q.create(Q.Class.UNIVERSAL,Q.Type.SEQUENCE,!0,[Q.create(Q.Class.UNIVERSAL,Q.Type.OID,!1,Q.oidToDer(We.oids[n]).getBytes()),Q.create(Q.Class.UNIVERSAL,Q.Type.NULL,!1,"")])),i}});var rO=B((lIe,tO)=>{var sr=it();Hc();Jt();var Yp=tO.exports=sr.sha512=sr.sha512||{};sr.md.sha512=sr.md.algorithms.sha512=Yp;var JN=sr.sha384=sr.sha512.sha384=sr.sha512.sha384||{};JN.create=function(){return Yp.create("SHA-384")};sr.md.sha384=sr.md.algorithms.sha384=JN;sr.sha512.sha256=sr.sha512.sha256||{create:function(){return Yp.create("SHA-512/256")}};sr.md["sha512/256"]=sr.md.algorithms["sha512/256"]=sr.sha512.sha256;sr.sha512.sha224=sr.sha512.sha224||{create:function(){return Yp.create("SHA-512/224")}};sr.md["sha512/224"]=sr.md.algorithms["sha512/224"]=sr.sha512.sha224;Yp.create=function(r){if(eO||ole(),typeof r>"u"&&(r="SHA-512"),!(r in xl))throw new Error("Invalid SHA-512 algorithm: "+r);for(var e=xl[r],t=null,n=sr.util.createBuffer(),i=new Array(80),s=0;s<80;++s)i[s]=new Array(2);var o=64;switch(r){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:r.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var c=a.messageLengthSize/4,u=0;u<c;++u)a.fullMessageLength.push(0);n=sr.util.createBuffer(),t=new Array(e.length);for(var u=0;u<e.length;++u)t[u]=e[u].slice(0);return a},a.start(),a.update=function(c,u){u==="utf8"&&(c=sr.util.encodeUtf8(c));var l=c.length;a.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var f=a.fullMessageLength.length-1;f>=0;--f)a.fullMessageLength[f]+=l[1],l[1]=l[0]+(a.fullMessageLength[f]/4294967296>>>0),a.fullMessageLength[f]=a.fullMessageLength[f]>>>0,l[0]=l[1]/4294967296>>>0;return n.putBytes(c),ZN(t,i,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var c=sr.util.createBuffer();c.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,l=u&a.blockLength-1;c.putBytes(C_.substr(0,a.blockLength-l));for(var f,h,d=a.fullMessageLength[0]*8,m=0;m<a.fullMessageLength.length-1;++m)f=a.fullMessageLength[m+1]*8,h=f/4294967296>>>0,d+=h,c.putInt32(d>>>0),d=f>>>0;c.putInt32(d);for(var w=new Array(t.length),m=0;m<t.length;++m)w[m]=t[m].slice(0);ZN(w,i,c);var b=sr.util.createBuffer(),v;r==="SHA-512"?v=w.length:r==="SHA-384"?v=w.length-2:v=w.length-4;for(var m=0;m<v;++m)b.putInt32(w[m][0]),(m!==v-1||r!=="SHA-512/224")&&b.putInt32(w[m][1]);return b},a};var C_=null,eO=!1,P_=null,xl=null;function ole(){C_=String.fromCharCode(128),C_+=sr.util.fillString(String.fromCharCode(0),128),P_=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],xl={},xl["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],xl["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],xl["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],xl["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],eO=!0}function ZN(r,e,t){for(var n,i,s,o,a,c,u,l,f,h,d,m,w,b,v,T,p,g,y,E,_,x,S,I,k,N,L,G,R,K,F,J,ye,se,Re,De=t.length();De>=128;){for(R=0;R<16;++R)e[R][0]=t.getInt32()>>>0,e[R][1]=t.getInt32()>>>0;for(;R<80;++R)J=e[R-2],K=J[0],F=J[1],n=((K>>>19|F<<13)^(F>>>29|K<<3)^K>>>6)>>>0,i=((K<<13|F>>>19)^(F<<3|K>>>29)^(K<<26|F>>>6))>>>0,se=e[R-15],K=se[0],F=se[1],s=((K>>>1|F<<31)^(K>>>8|F<<24)^K>>>7)>>>0,o=((K<<31|F>>>1)^(K<<24|F>>>8)^(K<<25|F>>>7))>>>0,ye=e[R-7],Re=e[R-16],F=i+ye[1]+o+Re[1],e[R][0]=n+ye[0]+s+Re[0]+(F/4294967296>>>0)>>>0,e[R][1]=F>>>0;for(w=r[0][0],b=r[0][1],v=r[1][0],T=r[1][1],p=r[2][0],g=r[2][1],y=r[3][0],E=r[3][1],_=r[4][0],x=r[4][1],S=r[5][0],I=r[5][1],k=r[6][0],N=r[6][1],L=r[7][0],G=r[7][1],R=0;R<80;++R)u=((_>>>14|x<<18)^(_>>>18|x<<14)^(x>>>9|_<<23))>>>0,l=((_<<18|x>>>14)^(_<<14|x>>>18)^(x<<23|_>>>9))>>>0,f=(k^_&(S^k))>>>0,h=(N^x&(I^N))>>>0,a=((w>>>28|b<<4)^(b>>>2|w<<30)^(b>>>7|w<<25))>>>0,c=((w<<4|b>>>28)^(b<<30|w>>>2)^(b<<25|w>>>7))>>>0,d=(w&v|p&(w^v))>>>0,m=(b&T|g&(b^T))>>>0,F=G+l+h+P_[R][1]+e[R][1],n=L+u+f+P_[R][0]+e[R][0]+(F/4294967296>>>0)>>>0,i=F>>>0,F=c+m,s=a+d+(F/4294967296>>>0)>>>0,o=F>>>0,L=k,G=N,k=S,N=I,S=_,I=x,F=E+i,_=y+n+(F/4294967296>>>0)>>>0,x=F>>>0,y=p,E=g,p=v,g=T,v=w,T=b,F=i+o,w=n+s+(F/4294967296>>>0)>>>0,b=F>>>0;F=r[0][1]+b,r[0][0]=r[0][0]+w+(F/4294967296>>>0)>>>0,r[0][1]=F>>>0,F=r[1][1]+T,r[1][0]=r[1][0]+v+(F/4294967296>>>0)>>>0,r[1][1]=F>>>0,F=r[2][1]+g,r[2][0]=r[2][0]+p+(F/4294967296>>>0)>>>0,r[2][1]=F>>>0,F=r[3][1]+E,r[3][0]=r[3][0]+y+(F/4294967296>>>0)>>>0,r[3][1]=F>>>0,F=r[4][1]+x,r[4][0]=r[4][0]+_+(F/4294967296>>>0)>>>0,r[4][1]=F>>>0,F=r[5][1]+I,r[5][0]=r[5][0]+S+(F/4294967296>>>0)>>>0,r[5][1]=F>>>0,F=r[6][1]+N,r[6][0]=r[6][0]+k+(F/4294967296>>>0)>>>0,r[6][1]=F>>>0,F=r[7][1]+G,r[7][0]=r[7][0]+L+(F/4294967296>>>0)>>>0,r[7][1]=F>>>0,De-=128}}});var my=B((cE,uE)=>{(function(r,e){typeof cE=="object"&&typeof uE<"u"?uE.exports=function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}:typeof define=="function"&&define.amd?define(function(){return function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}}):r.dlv=function(t,n,i,s,o){for(n=n.split?n.split("."):n,s=0;s<n.length;s++)t=t?t[n[s]]:o;return t===o?i:t}})(cE)});var PL=B((Ake,CL)=>{"use strict";var Efe=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;CL.exports=function(e,t){if(t==null&&(t=!1),e.length<2||e.length>255)return!1;var n=e[e.length-1];if(t){if(n!==".")return!1}else if(n===".")return!1;return Efe.test(e)}});var nB=B((S1,My)=>{(function(r,e){"use strict";var t={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(d){if(!Array.isArray(d)&&!ArrayBuffer.isView(d))return!1;for(var m=0;m<d.length;m++)if(!Number.isInteger(d[m])||d[m]<0||d[m]>255)return!1;return!0}function i(d,m){return(d&65535)*m+(((d>>>16)*m&65535)<<16)}function s(d,m){return d<<m|d>>>32-m}function o(d){return d^=d>>>16,d=i(d,2246822507),d^=d>>>13,d=i(d,3266489909),d^=d>>>16,d}function a(d,m){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var w=[0,0,0,0];return w[3]+=d[3]+m[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=d[2]+m[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=d[1]+m[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=d[0]+m[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function c(d,m){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var w=[0,0,0,0];return w[3]+=d[3]*m[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=d[2]*m[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=d[3]*m[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=d[1]*m[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=d[2]*m[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=d[3]*m[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=d[0]*m[3]+d[1]*m[2]+d[2]*m[1]+d[3]*m[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function u(d,m){return m%=64,m===32?[d[1],d[0]]:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m|d[0]>>>32-m]:(m-=32,[d[1]<<m|d[0]>>>32-m,d[0]<<m|d[1]>>>32-m])}function l(d,m){return m%=64,m===0?d:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m]:[d[1]<<m-32,0]}function f(d,m){return[d[0]^m[0],d[1]^m[1]]}function h(d){return d=f(d,[0,d[0]>>>1]),d=c(d,[4283543511,3981806797]),d=f(d,[0,d[0]>>>1]),d=c(d,[3301882366,444984403]),d=f(d,[0,d[0]>>>1]),d}t.x86.hash32=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var w=d.length%4,b=d.length-w,v=m,T=0,p=3432918353,g=461845907,y=0;y<b;y=y+4)T=d[y]|d[y+1]<<8|d[y+2]<<16|d[y+3]<<24,T=i(T,p),T=s(T,15),T=i(T,g),v^=T,v=s(v,13),v=i(v,5)+3864292196;switch(T=0,w){case 3:T^=d[y+2]<<16;case 2:T^=d[y+1]<<8;case 1:T^=d[y],T=i(T,p),T=s(T,15),T=i(T,g),v^=T}return v^=d.length,v=o(v),v>>>0},t.x86.hash128=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var w=d.length%16,b=d.length-w,v=m,T=m,p=m,g=m,y=0,E=0,_=0,x=0,S=597399067,I=2869860233,k=951274213,N=2716044179,L=0;L<b;L=L+16)y=d[L]|d[L+1]<<8|d[L+2]<<16|d[L+3]<<24,E=d[L+4]|d[L+5]<<8|d[L+6]<<16|d[L+7]<<24,_=d[L+8]|d[L+9]<<8|d[L+10]<<16|d[L+11]<<24,x=d[L+12]|d[L+13]<<8|d[L+14]<<16|d[L+15]<<24,y=i(y,S),y=s(y,15),y=i(y,I),v^=y,v=s(v,19),v+=T,v=i(v,5)+1444728091,E=i(E,I),E=s(E,16),E=i(E,k),T^=E,T=s(T,17),T+=p,T=i(T,5)+197830471,_=i(_,k),_=s(_,17),_=i(_,N),p^=_,p=s(p,15),p+=g,p=i(p,5)+2530024501,x=i(x,N),x=s(x,18),x=i(x,S),g^=x,g=s(g,13),g+=v,g=i(g,5)+850148119;switch(y=0,E=0,_=0,x=0,w){case 15:x^=d[L+14]<<16;case 14:x^=d[L+13]<<8;case 13:x^=d[L+12],x=i(x,N),x=s(x,18),x=i(x,S),g^=x;case 12:_^=d[L+11]<<24;case 11:_^=d[L+10]<<16;case 10:_^=d[L+9]<<8;case 9:_^=d[L+8],_=i(_,k),_=s(_,17),_=i(_,N),p^=_;case 8:E^=d[L+7]<<24;case 7:E^=d[L+6]<<16;case 6:E^=d[L+5]<<8;case 5:E^=d[L+4],E=i(E,I),E=s(E,16),E=i(E,k),T^=E;case 4:y^=d[L+3]<<24;case 3:y^=d[L+2]<<16;case 2:y^=d[L+1]<<8;case 1:y^=d[L],y=i(y,S),y=s(y,15),y=i(y,I),v^=y}return v^=d.length,T^=d.length,p^=d.length,g^=d.length,v+=T,v+=p,v+=g,T+=v,p+=v,g+=v,v=o(v),T=o(T),p=o(p),g=o(g),v+=T,v+=p,v+=g,T+=v,p+=v,g+=v,("00000000"+(v>>>0).toString(16)).slice(-8)+("00000000"+(T>>>0).toString(16)).slice(-8)+("00000000"+(p>>>0).toString(16)).slice(-8)+("00000000"+(g>>>0).toString(16)).slice(-8)},t.x64.hash128=function(d,m){if(t.inputValidation&&!n(d))return e;m=m||0;for(var w=d.length%16,b=d.length-w,v=[0,m],T=[0,m],p=[0,0],g=[0,0],y=[2277735313,289559509],E=[1291169091,658871167],_=0;_<b;_=_+16)p=[d[_+4]|d[_+5]<<8|d[_+6]<<16|d[_+7]<<24,d[_]|d[_+1]<<8|d[_+2]<<16|d[_+3]<<24],g=[d[_+12]|d[_+13]<<8|d[_+14]<<16|d[_+15]<<24,d[_+8]|d[_+9]<<8|d[_+10]<<16|d[_+11]<<24],p=c(p,y),p=u(p,31),p=c(p,E),v=f(v,p),v=u(v,27),v=a(v,T),v=a(c(v,[0,5]),[0,1390208809]),g=c(g,E),g=u(g,33),g=c(g,y),T=f(T,g),T=u(T,31),T=a(T,v),T=a(c(T,[0,5]),[0,944331445]);switch(p=[0,0],g=[0,0],w){case 15:g=f(g,l([0,d[_+14]],48));case 14:g=f(g,l([0,d[_+13]],40));case 13:g=f(g,l([0,d[_+12]],32));case 12:g=f(g,l([0,d[_+11]],24));case 11:g=f(g,l([0,d[_+10]],16));case 10:g=f(g,l([0,d[_+9]],8));case 9:g=f(g,[0,d[_+8]]),g=c(g,E),g=u(g,33),g=c(g,y),T=f(T,g);case 8:p=f(p,l([0,d[_+7]],56));case 7:p=f(p,l([0,d[_+6]],48));case 6:p=f(p,l([0,d[_+5]],40));case 5:p=f(p,l([0,d[_+4]],32));case 4:p=f(p,l([0,d[_+3]],24));case 3:p=f(p,l([0,d[_+2]],16));case 2:p=f(p,l([0,d[_+1]],8));case 1:p=f(p,[0,d[_]]),p=c(p,y),p=u(p,31),p=c(p,E),v=f(v,p)}return v=f(v,[0,d.length]),T=f(T,[0,d.length]),v=a(v,T),T=a(T,v),v=h(v),T=h(T),v=a(v,T),T=a(T,v),("00000000"+(v[0]>>>0).toString(16)).slice(-8)+("00000000"+(v[1]>>>0).toString(16)).slice(-8)+("00000000"+(T[0]>>>0).toString(16)).slice(-8)+("00000000"+(T[1]>>>0).toString(16)).slice(-8)},typeof S1<"u"?(typeof My<"u"&&My.exports&&(S1=My.exports=t),S1.murmurHash3=t):typeof define=="function"&&define.amd?define([],function(){return t}):(t._murmurHash3=r.murmurHash3,t.noConflict=function(){return r.murmurHash3=t._murmurHash3,t._murmurHash3=e,t.noConflict=e,t},r.murmurHash3=t)})(S1)});var sB=B((HNe,iB)=>{iB.exports=nB()});var wB=B((ROe,yB)=>{var vE=class{constructor(e,t=12,n=8*1024,i=32*1024,s=64,o){this.bits=t,this.min=n,this.max=i,this.asModule=e,this.rabin=new e.Rabin(t,n,i,s,o),this.polynomial=o}fingerprint(e){let{__retain:t,__release:n,__allocArray:i,__getInt32Array:s,Int32Array_ID:o,Uint8Array_ID:a}=this.asModule,c=new Int32Array(Math.ceil(e.length/this.min)),u=t(i(o,c)),l=t(i(a,e)),f=this.rabin.fingerprint(l,u),h=s(f);n(l),n(u);let d=h.indexOf(0);return d>=0?h.subarray(0,d):h}};yB.exports=vE});var xB=B(A1=>{"use strict";var $fe=typeof BigUint64Array<"u",x1=Symbol(),T1=1024;function bB(r,e){let t=new Uint32Array(r),n=new Uint16Array(r);var i=t[e+-4>>>2]>>>1,s=e>>>1;if(i<=T1)return String.fromCharCode.apply(String,n.subarray(s,s+i));let o=[];do{let a=n[s+T1-1],c=a>=55296&&a<56320?T1-1:T1;o.push(String.fromCharCode.apply(String,n.subarray(s,s+=c))),i-=c}while(i>T1);return o.join("")+String.fromCharCode.apply(String,n.subarray(s,s+i))}function SE(r){let e={};function t(i,s){return i?bB(i.buffer,s):"<yet unknown>"}let n=r.env=r.env||{};return n.abort=n.abort||function(s,o,a,c){let u=e.memory||n.memory;throw Error("abort: "+t(u,s)+" at "+t(u,o)+":"+a+":"+c)},n.trace=n.trace||function(s,o){let a=e.memory||n.memory;console.log("trace: "+t(a,s)+(o?" ":"")+Array.prototype.slice.call(arguments,2,2+o).join(", "))},r.Math=r.Math||Math,r.Date=r.Date||Date,e}function xE(r,e){let t=e.exports,n=t.memory,i=t.table,s=t.__alloc,o=t.__retain,a=t.__rtti_base||-1;function c(E){let _=new Uint32Array(n.buffer),x=_[a>>>2];if((E>>>=0)>=x)throw Error("invalid id: "+E);return _[(a+4>>>2)+E*2]}function u(E){let _=new Uint32Array(n.buffer),x=_[a>>>2];if((E>>>=0)>=x)throw Error("invalid id: "+E);return _[(a+4>>>2)+E*2+1]}function l(E){return 31-Math.clz32(E>>>5&31)}function f(E){return 31-Math.clz32(E>>>14&31)}function h(E){let _=E.length,x=s(_<<1,1),S=new Uint16Array(n.buffer);for(var I=0,k=x>>>1;I<_;++I)S[k+I]=E.charCodeAt(I);return x}r.__allocString=h;function d(E){let _=n.buffer;if(new Uint32Array(_)[E+-8>>>2]!==1)throw Error("not a string: "+E);return bB(_,E)}r.__getString=d;function m(E,_,x){let S=n.buffer;if(x)switch(E){case 2:return new Float32Array(S);case 3:return new Float64Array(S)}else switch(E){case 0:return new(_?Int8Array:Uint8Array)(S);case 1:return new(_?Int16Array:Uint16Array)(S);case 2:return new(_?Int32Array:Uint32Array)(S);case 3:return new(_?BigInt64Array:BigUint64Array)(S)}throw Error("unsupported align: "+E)}function w(E,_){let x=c(E);if(!(x&3))throw Error("not an array: "+E+" @ "+x);let S=l(x),I=_.length,k=s(I<<S,0),N=s(x&2?16:12,E),L=new Uint32Array(n.buffer);L[N+0>>>2]=o(k),L[N+4>>>2]=k,L[N+8>>>2]=I<<S,x&2&&(L[N+12>>>2]=I);let G=m(S,x&1024,x&2048);if(x&8192)for(let R=0;R<I;++R)G[(k>>>S)+R]=o(_[R]);else G.set(_,k>>>S);return N}r.__allocArray=w;function b(E){let _=new Uint32Array(n.buffer),x=_[E+-8>>>2],S=c(x);if(!(S&1))throw Error("not an array: "+x);let I=l(S);var k=_[E+4>>>2];let N=S&2?_[E+12>>>2]:_[k+-4>>>2]>>>I;return m(I,S&1024,S&2048).subarray(k>>>=I,k+N)}r.__getArrayView=b;function v(E){let _=b(E),x=_.length,S=new Array(x);for(let I=0;I<x;I++)S[I]=_[I];return S}r.__getArray=v;function T(E){let _=n.buffer,x=new Uint32Array(_)[E+-4>>>2];return _.slice(E,E+x)}r.__getArrayBuffer=T;function p(E,_,x){return new E(g(E,_,x))}function g(E,_,x){let S=n.buffer,I=new Uint32Array(S),k=I[x+4>>>2];return new E(S,k,I[k+-4>>>2]>>>_)}r.__getInt8Array=p.bind(null,Int8Array,0),r.__getInt8ArrayView=g.bind(null,Int8Array,0),r.__getUint8Array=p.bind(null,Uint8Array,0),r.__getUint8ArrayView=g.bind(null,Uint8Array,0),r.__getUint8ClampedArray=p.bind(null,Uint8ClampedArray,0),r.__getUint8ClampedArrayView=g.bind(null,Uint8ClampedArray,0),r.__getInt16Array=p.bind(null,Int16Array,1),r.__getInt16ArrayView=g.bind(null,Int16Array,1),r.__getUint16Array=p.bind(null,Uint16Array,1),r.__getUint16ArrayView=g.bind(null,Uint16Array,1),r.__getInt32Array=p.bind(null,Int32Array,2),r.__getInt32ArrayView=g.bind(null,Int32Array,2),r.__getUint32Array=p.bind(null,Uint32Array,2),r.__getUint32ArrayView=g.bind(null,Uint32Array,2),$fe&&(r.__getInt64Array=p.bind(null,BigInt64Array,3),r.__getInt64ArrayView=g.bind(null,BigInt64Array,3),r.__getUint64Array=p.bind(null,BigUint64Array,3),r.__getUint64ArrayView=g.bind(null,BigUint64Array,3)),r.__getFloat32Array=p.bind(null,Float32Array,2),r.__getFloat32ArrayView=g.bind(null,Float32Array,2),r.__getFloat64Array=p.bind(null,Float64Array,3),r.__getFloat64ArrayView=g.bind(null,Float64Array,3);function y(E,_){let x=new Uint32Array(n.buffer);var S=x[E+-8>>>2];if(S<=x[a>>>2])do if(S==_)return!0;while(S=u(S));return!1}return r.__instanceof=y,r.memory=r.memory||n,r.table=r.table||i,SB(t,r)}function _B(r){return typeof Response<"u"&&r instanceof Response}async function EB(r,e){return _B(r=await r)?vB(r,e):xE(SE(e||(e={})),await WebAssembly.instantiate(r instanceof WebAssembly.Module?r:await WebAssembly.compile(r),e))}A1.instantiate=EB;function qfe(r,e){return xE(SE(e||(e={})),new WebAssembly.Instance(r instanceof WebAssembly.Module?r:new WebAssembly.Module(r),e))}A1.instantiateSync=qfe;async function vB(r,e){return WebAssembly.instantiateStreaming?xE(SE(e||(e={})),(await WebAssembly.instantiateStreaming(r,e)).instance):EB(_B(r=await r)?r.arrayBuffer():r,e)}A1.instantiateStreaming=vB;function SB(r,e){var t=e?Object.create(e):{},n=r.__argumentsLength?function(i){r.__argumentsLength.value=i}:r.__setArgumentsLength||r.__setargc||function(){};for(let i in r){if(!Object.prototype.hasOwnProperty.call(r,i))continue;let s=r[i],o=i.split("."),a=t;for(;o.length>1;){let l=o.shift();Object.prototype.hasOwnProperty.call(a,l)||(a[l]={}),a=a[l]}let c=o[0],u=c.indexOf("#");if(u>=0){let l=c.substring(0,u),f=a[l];if(typeof f>"u"||!f.prototype){let h=function(...d){return h.wrap(h.prototype.constructor(0,...d))};h.prototype={valueOf:function(){return this[x1]}},h.wrap=function(d){return Object.create(h.prototype,{[x1]:{value:d,writable:!1}})},f&&Object.getOwnPropertyNames(f).forEach(d=>Object.defineProperty(h,d,Object.getOwnPropertyDescriptor(f,d))),a[l]=h}if(c=c.substring(u+1),a=a[l].prototype,/^(get|set):/.test(c)){if(!Object.prototype.hasOwnProperty.call(a,c=c.substring(4))){let h=r[i.replace("set:","get:")],d=r[i.replace("get:","set:")];Object.defineProperty(a,c,{get:function(){return h(this[x1])},set:function(m){d(this[x1],m)},enumerable:!0})}}else c==="constructor"?(a[c]=(...h)=>(n(h.length),s(...h))).original=s:(a[c]=function(...h){return n(h.length),s(this[x1],...h)}).original=s}else/^(get|set):/.test(c)?Object.prototype.hasOwnProperty.call(a,c=c.substring(4))||Object.defineProperty(a,c,{get:r[i.replace("set:","get:")],set:r[i.replace("get:","set:")],enumerable:!0}):typeof s=="function"&&s!==n?(a[c]=(...l)=>(n(l.length),s(...l))).original=s:a[c]=s}return t}A1.demangle=SB});var AB=B((POe,TB)=>{var{instantiate:Gfe}=xB();TE.supported=typeof WebAssembly<"u";function TE(r={}){if(!TE.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return Gfe(new Response(new Blob([e],{type:"application/wasm"})),r)}TB.exports=TE});var CB=B((kOe,RB)=>{var IB=wB(),jfe=AB(),Wfe=async(r,e,t,n,i)=>{let s=await jfe();return new IB(s,r,e,t,n,i)};RB.exports={Rabin:IB,create:Wfe}});var MB=B((XOe,BB)=>{"use strict";BB.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):i=!0,this._setInternalPos(n,e,t,i),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,i=t;for(;n<this.length;){let s=this.get(n);i=e(i,s,n),n++}return i}find(e){let t=0,n,i;for(;t<this.length&&!n;)i=this.get(t),n=e(i),t++;return n?i:void 0}_internalPositionFor(e,t){let n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;let i=this._bitArrays[n],s=e-n*7;if(!((i&1<<s)>0))return-1;let a=this._bitArrays.slice(0,n).reduce(nde,0),c=~(4294967295<<s+1),u=LB(i&c);return a+u-1}_bytePosFor(e,t){let n=Math.floor(e/7),i=n+1;for(;!t&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*7}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*7)}_setInternalPos(e,t,n,i){let s=this._data,o=[t,n];if(i)this._sortData(),s[e]=o;else{if(s.length)if(s[s.length-1][0]>=t)s.push(o);else if(s[0][0]<=t)s.unshift(o);else{let a=Math.round(s.length/2);this._data=s.slice(0,a).concat(o).concat(s.slice(a))}else this._data.push(o);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(ide),this._changedData=!1}bitField(){let e=[],t=8,n=0,i=0,s,o=this._bitArrays.slice();for(;o.length||n;){n===0&&(s=o.shift(),n=7);let c=Math.min(n,t),u=~(255<<c),l=s&u;i|=l<<8-t,s=s>>>c,n-=c,t-=c,(!t||!n&&!o.length)&&(e.push(i),i=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(sde)}};function nde(r,e){return r+LB(e)}function LB(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function ide(r,e){return r[0]-e[0]}function sde(r){return r[1]}});var gM=B((sMe,mM)=>{"use strict";mM.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:8,RTLD_LOCAL:4,E2BIG:7,EACCES:13,EADDRINUSE:48,EADDRNOTAVAIL:49,EAFNOSUPPORT:47,EAGAIN:35,EALREADY:37,EBADF:9,EBADMSG:94,EBUSY:16,ECANCELED:89,ECHILD:10,ECONNABORTED:53,ECONNREFUSED:61,ECONNRESET:54,EDEADLK:11,EDESTADDRREQ:39,EDOM:33,EDQUOT:69,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:65,EIDRM:90,EILSEQ:92,EINPROGRESS:36,EINTR:4,EINVAL:22,EIO:5,EISCONN:56,EISDIR:21,ELOOP:62,EMFILE:24,EMLINK:31,EMSGSIZE:40,EMULTIHOP:95,ENAMETOOLONG:63,ENETDOWN:50,ENETRESET:52,ENETUNREACH:51,ENFILE:23,ENOBUFS:55,ENODATA:96,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:77,ENOLINK:97,ENOMEM:12,ENOMSG:91,ENOPROTOOPT:42,ENOSPC:28,ENOSR:98,ENOSTR:99,ENOSYS:78,ENOTCONN:57,ENOTDIR:20,ENOTEMPTY:66,ENOTSOCK:38,ENOTSUP:45,ENOTTY:25,ENXIO:6,EOPNOTSUPP:102,EOVERFLOW:84,EPERM:1,EPIPE:32,EPROTO:100,EPROTONOSUPPORT:43,EPROTOTYPE:41,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:70,ETIME:101,ETIMEDOUT:60,ETXTBSY:26,EWOULDBLOCK:35,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:10,SIGFPE:8,SIGKILL:9,SIGUSR1:30,SIGSEGV:11,SIGUSR2:31,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:20,SIGCONT:19,SIGSTOP:17,SIGTSTP:18,SIGTTIN:21,SIGTTOU:22,SIGURG:16,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:23,SIGINFO:29,SIGSYS:12,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,UV_FS_O_FILEMAP:0,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306480,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}});var DV=B((K9,kV)=>{"use strict";Object.defineProperty(K9,"__esModule",{value:!0});L5.BASE=2166136261;function L5(r,e=L5.BASE){let t=r.length;for(let n=0;n<t;n++)e^=r.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}K9.default=L5;kV.exports=L5});var iz=B((zqe,H5)=>{"use strict";H5.exports=e2e;H5.exports.format=rz;H5.exports.parse=nz;var Xme=/\B(?=(\d{3})+(?!\d))/g,Zme=/(?:\.0*|(\.[^0]+)0+)$/,vu={b:1,kb:1<<10,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},Jme=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function e2e(r,e){return typeof r=="string"?nz(r):typeof r=="number"?rz(r,e):null}function rz(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",i=e&&e.unitSeparator||"",s=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,o=Boolean(e&&e.fixedDecimals),a=e&&e.unit||"";(!a||!vu[a.toLowerCase()])&&(t>=vu.pb?a="PB":t>=vu.tb?a="TB":t>=vu.gb?a="GB":t>=vu.mb?a="MB":t>=vu.kb?a="KB":a="B");var c=r/vu[a.toLowerCase()],u=c.toFixed(s);return o||(u=u.replace(Zme,"$1")),n&&(u=u.split(".").map(function(l,f){return f===0?l.replace(Xme,n):l}).join(".")),u+i+a}function nz(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=Jme.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(vu[n]*t)}});var Nz=B(Dz=>{"use strict";Dz.supports=function(...e){let t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}});var js=B((bje,Oz)=>{"use strict";Oz.exports=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var Mz=B(Y5=>{"use strict";Y5.byteLength=b2e;Y5.toByteArray=E2e;Y5.fromByteArray=x2e;var Vo=[],us=[],w2e=typeof Uint8Array<"u"?Uint8Array:Array,fv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(uf=0,Lz=fv.length;uf<Lz;++uf)Vo[uf]=fv[uf],us[fv.charCodeAt(uf)]=uf;var uf,Lz;us["-".charCodeAt(0)]=62;us["_".charCodeAt(0)]=63;function Bz(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function b2e(r){var e=Bz(r),t=e[0],n=e[1];return(t+n)*3/4-n}function _2e(r,e,t){return(e+t)*3/4-t}function E2e(r){var e,t=Bz(r),n=t[0],i=t[1],s=new w2e(_2e(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=us[r.charCodeAt(c)]<<18|us[r.charCodeAt(c+1)]<<12|us[r.charCodeAt(c+2)]<<6|us[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=us[r.charCodeAt(c)]<<2|us[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=us[r.charCodeAt(c)]<<10|us[r.charCodeAt(c+1)]<<4|us[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function v2e(r){return Vo[r>>18&63]+Vo[r>>12&63]+Vo[r>>6&63]+Vo[r&63]}function S2e(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(v2e(n));return i.join("")}function x2e(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(S2e(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(Vo[e>>2]+Vo[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Vo[e>>10]+Vo[e>>4&63]+Vo[e<<2&63]+"=")),i.join("")}});var Uz=B(dv=>{dv.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,l=-7,f=t?i-1:0,h=t?-1:1,d=r[e+f];for(f+=h,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+r[e+f],f+=h,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=o*256+r[e+f],f+=h,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(d?-1:1)*o*Math.pow(2,s-n)};dv.write=function(r,e,t,n,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,f=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,m=n?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=h/c:e+=h*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=l?(a=0,o=l):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;r[t+d]=a&255,d+=m,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;r[t+d]=o&255,d+=m,o/=256,u-=8);r[t+d-m]|=w*128}});var mm=B(Hh=>{"use strict";var hv=Mz(),zh=Uz(),Fz=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Hh.Buffer=X;Hh.SlowBuffer=P2e;Hh.INSPECT_MAX_BYTES=50;var Q5=2147483647;Hh.kMaxLength=Q5;X.TYPED_ARRAY_SUPPORT=T2e();!X.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function T2e(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(X.prototype,"parent",{enumerable:!0,get:function(){if(X.isBuffer(this))return this.buffer}});Object.defineProperty(X.prototype,"offset",{enumerable:!0,get:function(){if(X.isBuffer(this))return this.byteOffset}});function $a(r){if(r>Q5)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,X.prototype),e}function X(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return yv(r)}return Hz(r,e,t)}X.poolSize=8192;function Hz(r,e,t){if(typeof r=="string")return I2e(r,e);if(ArrayBuffer.isView(r))return R2e(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(zo(r,ArrayBuffer)||r&&zo(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(zo(r,SharedArrayBuffer)||r&&zo(r.buffer,SharedArrayBuffer)))return mv(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return X.from(n,e,t);let i=C2e(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return X.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}X.from=function(r,e,t){return Hz(r,e,t)};Object.setPrototypeOf(X.prototype,Uint8Array.prototype);Object.setPrototypeOf(X,Uint8Array);function $z(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function A2e(r,e,t){return $z(r),r<=0?$a(r):e!==void 0?typeof t=="string"?$a(r).fill(e,t):$a(r).fill(e):$a(r)}X.alloc=function(r,e,t){return A2e(r,e,t)};function yv(r){return $z(r),$a(r<0?0:wv(r)|0)}X.allocUnsafe=function(r){return yv(r)};X.allocUnsafeSlow=function(r){return yv(r)};function I2e(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!X.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=qz(r,e)|0,n=$a(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function pv(r){let e=r.length<0?0:wv(r.length)|0,t=$a(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function R2e(r){if(zo(r,Uint8Array)){let e=new Uint8Array(r);return mv(e.buffer,e.byteOffset,e.byteLength)}return pv(r)}function mv(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,X.prototype),n}function C2e(r){if(X.isBuffer(r)){let e=wv(r.length)|0,t=$a(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||_v(r.length)?$a(0):pv(r);if(r.type==="Buffer"&&Array.isArray(r.data))return pv(r.data)}function wv(r){if(r>=Q5)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Q5.toString(16)+" bytes");return r|0}function P2e(r){return+r!=r&&(r=0),X.alloc(+r)}X.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==X.prototype};X.compare=function(e,t){if(zo(e,Uint8Array)&&(e=X.from(e,e.offset,e.byteLength)),zo(t,Uint8Array)&&(t=X.from(t,t.offset,t.byteLength)),!X.isBuffer(e)||!X.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};X.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};X.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return X.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=X.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(zo(o,Uint8Array))s+o.length>i.length?(X.isBuffer(o)||(o=X.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(X.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function qz(r,e){if(X.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||zo(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return gv(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return eK(r).length;default:if(i)return n?-1:gv(r).length;e=(""+e).toLowerCase(),i=!0}}X.byteLength=qz;function k2e(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return z2e(this,e,t);case"utf8":case"utf-8":return jz(this,e,t);case"ascii":return F2e(this,e,t);case"latin1":case"binary":return V2e(this,e,t);case"base64":return M2e(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K2e(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}X.prototype._isBuffer=!0;function lf(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}X.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)lf(this,t,t+1);return this};X.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)lf(this,t,t+3),lf(this,t+1,t+2);return this};X.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)lf(this,t,t+7),lf(this,t+1,t+6),lf(this,t+2,t+5),lf(this,t+3,t+4);return this};X.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?jz(this,0,e):k2e.apply(this,arguments)};X.prototype.toLocaleString=X.prototype.toString;X.prototype.equals=function(e){if(!X.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:X.compare(this,e)===0};X.prototype.inspect=function(){let e="",t=Hh.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Fz&&(X.prototype[Fz]=X.prototype.inspect);X.prototype.compare=function(e,t,n,i,s){if(zo(e,Uint8Array)&&(e=X.from(e,e.offset,e.byteLength)),!X.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,c=Math.min(o,a),u=this.slice(i,s),l=e.slice(t,n);for(let f=0;f<c;++f)if(u[f]!==l[f]){o=u[f],a=l[f];break}return o<a?-1:a<o?1:0};function Gz(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,_v(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=X.from(e,n)),X.isBuffer(e))return e.length===0?-1:Vz(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Vz(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function Vz(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function c(l,f){return s===1?l[f]:l.readUInt16BE(f*s)}let u;if(i){let l=-1;for(u=t;u<o;u++)if(c(r,u)===c(e,l===-1?0:u-l)){if(l===-1&&(l=u),u-l+1===a)return l*s}else l!==-1&&(u-=u-l),l=-1}else for(t+a>o&&(t=o-a),u=t;u>=0;u--){let l=!0;for(let f=0;f<a;f++)if(c(r,u+f)!==c(e,f)){l=!1;break}if(l)return u}return-1}X.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};X.prototype.indexOf=function(e,t,n){return Gz(this,e,t,n,!0)};X.prototype.lastIndexOf=function(e,t,n){return Gz(this,e,t,n,!1)};function D2e(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(_v(a))return o;r[t+o]=a}return o}function N2e(r,e,t,n){return X5(gv(e,r.length-t),r,t,n)}function O2e(r,e,t,n){return X5(G2e(e),r,t,n)}function L2e(r,e,t,n){return X5(eK(e),r,t,n)}function B2e(r,e,t,n){return X5(j2e(e,r.length-t),r,t,n)}X.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return D2e(this,e,t,n);case"utf8":case"utf-8":return N2e(this,e,t,n);case"ascii":case"latin1":case"binary":return O2e(this,e,t,n);case"base64":return L2e(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B2e(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};X.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M2e(r,e,t){return e===0&&t===r.length?hv.fromByteArray(r):hv.fromByteArray(r.slice(e,t))}function jz(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let c,u,l,f;switch(a){case 1:s<128&&(o=s);break;case 2:c=r[i+1],(c&192)===128&&(f=(s&31)<<6|c&63,f>127&&(o=f));break;case 3:c=r[i+1],u=r[i+2],(c&192)===128&&(u&192)===128&&(f=(s&15)<<12|(c&63)<<6|u&63,f>2047&&(f<55296||f>57343)&&(o=f));break;case 4:c=r[i+1],u=r[i+2],l=r[i+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(f=(s&15)<<18|(c&63)<<12|(u&63)<<6|l&63,f>65535&&f<1114112&&(o=f))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return U2e(n)}var zz=4096;function U2e(r){let e=r.length;if(e<=zz)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=zz));return t}function F2e(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function V2e(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function z2e(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=W2e[r[s]];return i}function K2e(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}X.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,X.prototype),i};function gn(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}X.prototype.readUintLE=X.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||gn(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};X.prototype.readUintBE=X.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||gn(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};X.prototype.readUint8=X.prototype.readUInt8=function(e,t){return e=e>>>0,t||gn(e,1,this.length),this[e]};X.prototype.readUint16LE=X.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||gn(e,2,this.length),this[e]|this[e+1]<<8};X.prototype.readUint16BE=X.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||gn(e,2,this.length),this[e]<<8|this[e+1]};X.prototype.readUint32LE=X.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};X.prototype.readUint32BE=X.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};X.prototype.readBigUInt64LE=Tu(function(e){e=e>>>0,Kh(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});X.prototype.readBigUInt64BE=Tu(function(e){e=e>>>0,Kh(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});X.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||gn(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};X.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||gn(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};X.prototype.readInt8=function(e,t){return e=e>>>0,t||gn(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};X.prototype.readInt16LE=function(e,t){e=e>>>0,t||gn(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};X.prototype.readInt16BE=function(e,t){e=e>>>0,t||gn(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};X.prototype.readInt32LE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};X.prototype.readInt32BE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};X.prototype.readBigInt64LE=Tu(function(e){e=e>>>0,Kh(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});X.prototype.readBigInt64BE=Tu(function(e){e=e>>>0,Kh(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pm(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});X.prototype.readFloatLE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),zh.read(this,e,!0,23,4)};X.prototype.readFloatBE=function(e,t){return e=e>>>0,t||gn(e,4,this.length),zh.read(this,e,!1,23,4)};X.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||gn(e,8,this.length),zh.read(this,e,!0,52,8)};X.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||gn(e,8,this.length),zh.read(this,e,!1,52,8)};function fi(r,e,t,n,i,s){if(!X.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}X.prototype.writeUintLE=X.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;fi(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};X.prototype.writeUintBE=X.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;fi(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};X.prototype.writeUint8=X.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,1,255,0),this[t]=e&255,t+1};X.prototype.writeUint16LE=X.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};X.prototype.writeUint16BE=X.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};X.prototype.writeUint32LE=X.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};X.prototype.writeUint32BE=X.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Wz(r,e,t,n,i){Jz(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function Yz(r,e,t,n,i){Jz(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}X.prototype.writeBigUInt64LE=Tu(function(e,t=0){return Wz(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});X.prototype.writeBigUInt64BE=Tu(function(e,t=0){return Yz(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});X.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);fi(this,e,t,n,c-1,-c)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};X.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);fi(this,e,t,n,c-1,-c)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};X.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};X.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};X.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};X.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};X.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||fi(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};X.prototype.writeBigInt64LE=Tu(function(e,t=0){return Wz(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});X.prototype.writeBigInt64BE=Tu(function(e,t=0){return Yz(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Qz(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Xz(r,e,t,n,i){return e=+e,t=t>>>0,i||Qz(r,e,t,4,34028234663852886e22,-34028234663852886e22),zh.write(r,e,t,n,23,4),t+4}X.prototype.writeFloatLE=function(e,t,n){return Xz(this,e,t,!0,n)};X.prototype.writeFloatBE=function(e,t,n){return Xz(this,e,t,!1,n)};function Zz(r,e,t,n,i){return e=+e,t=t>>>0,i||Qz(r,e,t,8,17976931348623157e292,-17976931348623157e292),zh.write(r,e,t,n,52,8),t+8}X.prototype.writeDoubleLE=function(e,t,n){return Zz(this,e,t,!0,n)};X.prototype.writeDoubleBE=function(e,t,n){return Zz(this,e,t,!1,n)};X.prototype.copy=function(e,t,n,i){if(!X.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};X.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!X.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=X.isBuffer(e)?e:X.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var Vh={};function bv(r,e,t){Vh[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}bv("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);bv("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);bv("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=Kz(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=Kz(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function Kz(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function H2e(r,e,t){Kh(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&pm(e,r.length-(t+1))}function Jz(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new Vh.ERR_OUT_OF_RANGE("value",a,r)}H2e(n,i,s)}function Kh(r,e){if(typeof r!="number")throw new Vh.ERR_INVALID_ARG_TYPE(e,"number",r)}function pm(r,e,t){throw Math.floor(r)!==r?(Kh(r,t),new Vh.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Vh.ERR_BUFFER_OUT_OF_BOUNDS:new Vh.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var $2e=/[^+/0-9A-Za-z-_]/g;function q2e(r){if(r=r.split("=")[0],r=r.trim().replace($2e,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function gv(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function G2e(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function j2e(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function eK(r){return hv.toByteArray(q2e(r))}function X5(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function zo(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function _v(r){return r!==r}var W2e=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function Tu(r){return typeof BigInt>"u"?Y2e:r}function Y2e(){throw new Error("BigInt not supported")}});var vv=B((xje,tK)=>{"use strict";var Ev=null;tK.exports=function(){return Ev===null&&(Ev={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),Ev}});var Tv=B(rK=>{"use strict";var Sv=js(),Q2e=new Set(["buffer","view","utf8"]),xv=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!Q2e.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new Sv(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new Sv(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new Sv(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};rK.Encoding=xv});var Cv=B(Z5=>{"use strict";var{Buffer:Iv}=mm()||{},{Encoding:Rv}=Tv(),X2e=vv(),gm=class extends Rv{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new ym({encode:this.encode,decode:e=>this.decode(Iv.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},ym=class extends Rv{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new gm({encode:e=>{let t=this.encode(e);return Iv.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},Av=class extends Rv{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new gm({encode:e=>Iv.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:e,textDecoder:t}=X2e();return new ym({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Z5.BufferFormat=gm;Z5.ViewFormat=ym;Z5.UTF8Format=Av});var oK=B(ff=>{"use strict";var{Buffer:Ln}=mm()||{Buffer:{isBuffer:()=>!1}},{textEncoder:iK,textDecoder:nK}=vv()(),{BufferFormat:wm,ViewFormat:Pv,UTF8Format:sK}=Cv(),J5=r=>r;ff.utf8=new sK({encode:function(r){return Ln.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?nK.decode(r):String(r)},decode:J5,name:"utf8",createViewTranscoder(){return new Pv({encode:function(r){return ArrayBuffer.isView(r)?r:iK.encode(r)},decode:function(r){return nK.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new wm({encode:function(r){return Ln.isBuffer(r)?r:ArrayBuffer.isView(r)?Ln.from(r.buffer,r.byteOffset,r.byteLength):Ln.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});ff.json=new sK({encode:JSON.stringify,decode:JSON.parse,name:"json"});ff.buffer=new wm({encode:function(r){return Ln.isBuffer(r)?r:ArrayBuffer.isView(r)?Ln.from(r.buffer,r.byteOffset,r.byteLength):Ln.from(String(r),"utf8")},decode:J5,name:"buffer",createViewTranscoder(){return new Pv({encode:function(r){return ArrayBuffer.isView(r)?r:Ln.from(String(r),"utf8")},decode:function(r){return Ln.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});ff.view=new Pv({encode:function(r){return ArrayBuffer.isView(r)?r:iK.encode(r)},decode:J5,name:"view",createBufferTranscoder(){return new wm({encode:function(r){return Ln.isBuffer(r)?r:ArrayBuffer.isView(r)?Ln.from(r.buffer,r.byteOffset,r.byteLength):Ln.from(String(r),"utf8")},decode:J5,name:`${this.name}+buffer`})}});ff.hex=new wm({encode:function(r){return Ln.isBuffer(r)?r:Ln.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});ff.base64=new wm({encode:function(r){return Ln.isBuffer(r)?r:Ln.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"})});var uK=B(cK=>{"use strict";var aK=js(),t4=oK(),{Encoding:Z2e}=Tv(),{BufferFormat:J2e,ViewFormat:ege,UTF8Format:tge}=Cv(),bm=Symbol("formats"),e4=Symbol("encodings"),rge=new Set(["buffer","view","utf8"]),kv=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>rge.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[e4]=new Map,this[bm]=new Set(e);for(let t in t4)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[e4].values()))}encoding(e){let t=this[e4].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=oge[e],!t)throw new aK(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=nge(e)}let{name:n,format:i}=t;if(!this[bm].has(i))if(this[bm].has("view"))t=t.createViewTranscoder();else if(this[bm].has("buffer"))t=t.createBufferTranscoder();else if(this[bm].has("utf8"))t=t.createUTF8Transcoder();else throw new aK(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let s of[e,n,t.name,t.commonName])this[e4].set(s,t)}return t}};cK.Transcoder=kv;function nge(r){if(r instanceof Z2e)return r;let e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${age++}`;switch(ige(r)){case"view":return new ege({...r,name:t});case"utf8":return new tge({...r,name:t});case"buffer":return new J2e({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function ige(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}var sge={binary:t4.buffer,"utf-8":t4.utf8},oge={...t4,...sge},age=0});var Tn=B((Cje,Dv)=>{"use strict";var $h=typeof Reflect=="object"?Reflect:null,lK=$h&&typeof $h.apply=="function"?$h.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},r4;$h&&typeof $h.ownKeys=="function"?r4=$h.ownKeys:Object.getOwnPropertySymbols?r4=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:r4=function(e){return Object.getOwnPropertyNames(e)};function cge(r){console&&console.warn&&console.warn(r)}var dK=Number.isNaN||function(e){return e!==e};function $t(){$t.init.call(this)}Dv.exports=$t;Dv.exports.once=dge;$t.EventEmitter=$t;$t.prototype._events=void 0;$t.prototype._eventsCount=0;$t.prototype._maxListeners=void 0;var fK=10;function n4(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty($t,"defaultMaxListeners",{enumerable:!0,get:function(){return fK},set:function(r){if(typeof r!="number"||r<0||dK(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");fK=r}});$t.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};$t.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||dK(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function hK(r){return r._maxListeners===void 0?$t.defaultMaxListeners:r._maxListeners}$t.prototype.getMaxListeners=function(){return hK(this)};$t.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")lK(c,this,t);else for(var u=c.length,l=wK(c,u),n=0;n<u;++n)lK(l[n],this,t);return!0};function pK(r,e,t,n){var i,s,o;if(n4(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=hK(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,cge(a)}return r}$t.prototype.addListener=function(e,t){return pK(this,e,t,!1)};$t.prototype.on=$t.prototype.addListener;$t.prototype.prependListener=function(e,t){return pK(this,e,t,!0)};function uge(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mK(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=uge.bind(n);return i.listener=t,n.wrapFn=i,i}$t.prototype.once=function(e,t){return n4(t),this.on(e,mK(this,e,t)),this};$t.prototype.prependOnceListener=function(e,t){return n4(t),this.prependListener(e,mK(this,e,t)),this};$t.prototype.removeListener=function(e,t){var n,i,s,o,a;if(n4(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():lge(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};$t.prototype.off=$t.prototype.removeListener;$t.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function gK(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?fge(i):wK(i,i.length)}$t.prototype.listeners=function(e){return gK(this,e,!0)};$t.prototype.rawListeners=function(e){return gK(this,e,!1)};$t.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):yK.call(r,e)};$t.prototype.listenerCount=yK;function yK(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}$t.prototype.eventNames=function(){return this._eventsCount>0?r4(this._events):[]};function wK(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function lge(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function fge(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function dge(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}bK(r,e,s,{once:!0}),e!=="error"&&hge(r,i,{once:!0})})}function hge(r,e,t){typeof r.on=="function"&&bK(r,"error",e,t)}function bK(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var EK=B((Pje,_K)=>{_K.exports=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r)});var _m=B(Nv=>{"use strict";var vK=EK();Nv.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};Nv.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){vK(()=>e(null,t))}).catch(function(t){vK(()=>e(t))})}});var i4=B(Ov=>{"use strict";Ov.getCallback=function(r,e){return typeof r=="function"?r:e};Ov.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}}});var ku=B(c4=>{"use strict";var{fromCallback:Lv}=_m(),Di=js(),{getOptions:Bv,getCallback:SK}=i4(),df=Symbol("promise"),qh=Symbol("callback"),Ko=Symbol("working"),hf=Symbol("handleOne"),qa=Symbol("handleMany"),Mv=Symbol("autoClose"),Cu=Symbol("finishWork"),Ho=Symbol("returnMany"),Au=Symbol("closing"),Em=Symbol("handleClose"),s4=Symbol("closed"),vm=Symbol("closeCallbacks"),Ru=Symbol("keyEncoding"),pf=Symbol("valueEncoding"),Uv=Symbol("abortOnClose"),o4=Symbol("legacy"),Fv=Symbol("keys"),Vv=Symbol("values"),Iu=Symbol("limit"),ls=Symbol("count"),a4=Object.freeze({}),pge=()=>{},xK=!1,Sm=class{constructor(e,t,n){if(typeof e!="object"||e===null){let i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[s4]=!1,this[vm]=[],this[Ko]=!1,this[Au]=!1,this[Mv]=!1,this[qh]=null,this[hf]=this[hf].bind(this),this[qa]=this[qa].bind(this),this[Em]=this[Em].bind(this),this[Ru]=t[Ru],this[pf]=t[pf],this[o4]=n,this[Iu]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[ls]=0,this[Uv]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[ls]}get limit(){return this[Iu]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[o4]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[Au]?this.nextTick(e,new Di("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ko]?this.nextTick(e,new Di("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ko]=!0,this[qh]=e,this[ls]>=this[Iu]?this.nextTick(this[hf],null):this._next(this[hf])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=SK(t,n),n=Lv(n,df),t=Bv(t,a4),Number.isInteger(e)?(this[Au]?this.nextTick(n,new Di("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ko]?this.nextTick(n,new Di("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[Iu]<1/0&&(e=Math.min(e,this[Iu]-this[ls])),this[Ko]=!0,this[qh]=n,e<=0?this.nextTick(this[qa],null,[]):this._nextv(e,t,this[qa])),n[df]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[df])}_nextv(e,t,n){let i=[],s=(o,a,c)=>{if(o)return n(o);if(this[o4]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[o4]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=SK(e,t),t=Lv(t,df),e=Bv(e,a4),this[Au]?this.nextTick(t,new Di("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ko]?this.nextTick(t,new Di("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ko]=!0,this[qh]=t,this[Mv]=!0,this[ls]>=this[Iu]?this.nextTick(this[qa],null,[]):this._all(e,this[qa])),t[df]}_all(e,t){let n=this[ls],i=[],s=()=>{let a=this[Iu]<1/0?Math.min(1e3,this[Iu]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,a4,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[Cu](){let e=this[qh];return this[Uv]&&e===null?pge:(this[Ko]=!1,this[qh]=null,this[Au]&&this._close(this[Em]),e)}[Ho](e,t,n){this[Mv]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=Bv(t,a4),!this[Au]){if(this[Ko])throw new Di("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let n=this.db.keyEncoding(t.keyEncoding||this[Ru]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});let s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Di("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=Lv(e,df),this[s4]?this.nextTick(e):this[Au]?this[vm].push(e):(this[Au]=!0,this[vm].push(e),this[Ko]?this[Uv]&&this[Cu]()(new Di("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Em])),e[df]}_close(e){this.nextTick(e)}[Em](){this[s4]=!0,this.db.detachResource(this);let e=this[vm];this[vm]=[];for(let t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[s4]||await this.close()}}},Gh=class extends Sm{constructor(e,t){super(e,t,!0),this[Fv]=t.keys!==!1,this[Vv]=t.values!==!1}[hf](e,t,n){let i=this[Cu]();if(e)return i(e);try{t=this[Fv]&&t!==void 0?this[Ru].decode(t):void 0,n=this[Vv]&&n!==void 0?this[pf].decode(n):void 0}catch(s){return i(new Pu("entry",s))}t===void 0&&n===void 0||this[ls]++,i(null,t,n)}[qa](e,t){let n=this[Cu]();if(e)return this[Ho](n,e);try{for(let i of t){let s=i[0],o=i[1];i[0]=this[Fv]&&s!==void 0?this[Ru].decode(s):void 0,i[1]=this[Vv]&&o!==void 0?this[pf].decode(o):void 0}}catch(i){return this[Ho](n,new Pu("entries",i))}this[ls]+=t.length,this[Ho](n,null,t)}end(e){return!xK&&typeof console<"u"&&(xK=!0,console.warn(new Di("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},zv=class extends Sm{constructor(e,t){super(e,t,!1)}[hf](e,t){let n=this[Cu]();if(e)return n(e);try{t=t!==void 0?this[Ru].decode(t):void 0}catch(i){return n(new Pu("key",i))}t!==void 0&&this[ls]++,n(null,t)}[qa](e,t){let n=this[Cu]();if(e)return this[Ho](n,e);try{for(let i=0;i<t.length;i++){let s=t[i];t[i]=s!==void 0?this[Ru].decode(s):void 0}}catch(i){return this[Ho](n,new Pu("keys",i))}this[ls]+=t.length,this[Ho](n,null,t)}},Kv=class extends Sm{constructor(e,t){super(e,t,!1)}[hf](e,t){let n=this[Cu]();if(e)return n(e);try{t=t!==void 0?this[pf].decode(t):void 0}catch(i){return n(new Pu("value",i))}t!==void 0&&this[ls]++,n(null,t)}[qa](e,t){let n=this[Cu]();if(e)return this[Ho](n,e);try{for(let i=0;i<t.length;i++){let s=t[i];t[i]=s!==void 0?this[pf].decode(s):void 0}}catch(i){return this[Ho](n,new Pu("values",i))}this[ls]+=t.length,this[Ho](n,null,t)}},Pu=class extends Di{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}};for(let r of["_ended property","_nexting property","_end method"])Object.defineProperty(Gh.prototype,r.split(" ")[0],{get(){throw new Di(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Di(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});Gh.keyEncoding=Ru;Gh.valueEncoding=pf;c4.AbstractIterator=Gh;c4.AbstractKeyIterator=zv;c4.AbstractValueIterator=Kv});var TK=B(Hv=>{"use strict";var{AbstractKeyIterator:mge,AbstractValueIterator:gge}=ku(),mf=Symbol("iterator"),xm=Symbol("callback"),jh=Symbol("handleOne"),gf=Symbol("handleMany"),Tm=class extends mge{constructor(e,t){super(e,t),this[mf]=e.iterator({...t,keys:!0,values:!1}),this[jh]=this[jh].bind(this),this[gf]=this[gf].bind(this)}},u4=class extends gge{constructor(e,t){super(e,t),this[mf]=e.iterator({...t,keys:!1,values:!0}),this[jh]=this[jh].bind(this),this[gf]=this[gf].bind(this)}};for(let r of[Tm,u4]){let e=r===Tm,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[xm]=n,this[mf].next(this[jh])},r.prototype[jh]=function(n,i,s){let o=this[xm];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[xm]=s,this[mf].nextv(n,i,this[gf])},r.prototype._all=function(n,i){this[xm]=i,this[mf].all(n,this[gf])},r.prototype[gf]=function(n,i){let s=this[xm];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[mf].seek(n,i)},r.prototype._close=function(n){this[mf].close(n)}}Hv.DefaultKeyIterator=Tm;Hv.DefaultValueIterator=u4});var AK=B(m4=>{"use strict";var{AbstractIterator:yge,AbstractKeyIterator:wge,AbstractValueIterator:bge}=ku(),$v=js(),di=Symbol("nut"),h4=Symbol("undefer"),p4=Symbol("factory"),l4=class extends yge{constructor(e,t){super(e,t),this[di]=null,this[p4]=()=>e.iterator(t),this.db.defer(()=>this[h4]())}},f4=class extends wge{constructor(e,t){super(e,t),this[di]=null,this[p4]=()=>e.keys(t),this.db.defer(()=>this[h4]())}},d4=class extends bge{constructor(e,t){super(e,t),this[di]=null,this[p4]=()=>e.values(t),this.db.defer(()=>this[h4]())}};for(let r of[l4,f4,d4])r.prototype[h4]=function(){this.db.status==="open"&&(this[di]=this[p4]())},r.prototype._next=function(e){this[di]!==null?this[di].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new $v("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[di]!==null?this[di].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new $v("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[di]!==null?this[di].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new $v("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[di]!==null?this[di]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[di]!==null?this[di].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};m4.DeferredIterator=l4;m4.DeferredKeyIterator=f4;m4.DeferredValueIterator=d4});var Gv=B(RK=>{"use strict";var{fromCallback:IK}=_m(),g4=js(),{getCallback:_ge,getOptions:Ege}=i4(),y4=Symbol("promise"),fs=Symbol("status"),Wh=Symbol("operations"),Am=Symbol("finishClose"),Yh=Symbol("closeCallbacks"),qv=class{constructor(e){if(typeof e!="object"||e===null){let t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[Wh]=[],this[Yh]=[],this[fs]="open",this[Am]=this[Am].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[Wh].length}put(e,t,n){if(this[fs]!=="open")throw new g4("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;let s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),u=a.format;n={...n,keyEncoding:u,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);let l=s.prefixKey(a.encode(e),u),f=c.encode(t);return this._put(l,f,n),this[Wh].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[fs]!=="open")throw new g4("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(e);if(n)throw n;let i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[Wh].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[fs]!=="open")throw new g4("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[Wh]=[],this}_clear(){}write(e,t){return t=_ge(e,t),t=IK(t,y4),e=Ege(e),this[fs]!=="open"?this.nextTick(t,new g4("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[fs]="writing",this._write(e,n=>{this[fs]="closing",this[Yh].push(()=>t(n)),n||this.db.emit("batch",this[Wh]),this._close(this[Am])})),t[y4]}_write(e,t){}close(e){return e=IK(e,y4),this[fs]==="closing"?this[Yh].push(e):this[fs]==="closed"?this.nextTick(e):(this[Yh].push(e),this[fs]!=="writing"&&(this[fs]="closing",this._close(this[Am]))),e[y4]}_close(e){this.nextTick(e)}[Am](){this[fs]="closed",this.db.detachResource(this);let e=this[Yh];this[Yh]=[];for(let t of e)t()}};RK.AbstractChainedBatch=qv});var PK=B(CK=>{"use strict";var{AbstractChainedBatch:vge}=Gv(),Sge=js(),Qh=Symbol("encoded"),jv=class extends vge{constructor(e){super(e),this[Qh]=[]}_put(e,t,n){this[Qh].push({...n,type:"put",key:e,value:t})}_del(e,t){this[Qh].push({...t,type:"del",key:e})}_clear(){this[Qh]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[Qh].length===0?this.nextTick(t):this.db._batch(this[Qh],e,t):this.nextTick(t,new Sge("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};CK.DefaultChainedBatch=jv});var NK=B((Uje,DK)=>{"use strict";var kK=js(),xge=Object.prototype.hasOwnProperty,Tge=new Set(["lt","lte","gt","gte"]);DK.exports=function(r,e){let t={};for(let n in r)if(xge.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new kK(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new kK("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});Tge.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t}});var Wv=B((Fje,LK)=>{var OK;LK.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):r=>(OK||(OK=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0))});var UK=B((Vje,MK)=>{"use strict";var BK=Wv();MK.exports=function(r,...e){e.length===0?BK(r):BK(()=>r(...e))}});var FK=B(w4=>{"use strict";var{AbstractIterator:Age,AbstractKeyIterator:Ige,AbstractValueIterator:Rge}=ku(),Xh=Symbol("unfix"),Ws=Symbol("iterator"),yf=Symbol("handleOne"),Du=Symbol("handleMany"),Ga=Symbol("callback"),Im=class extends Age{constructor(e,t,n,i){super(e,t),this[Ws]=n,this[Xh]=i,this[yf]=this[yf].bind(this),this[Du]=this[Du].bind(this),this[Ga]=null}[yf](e,t,n){let i=this[Ga];if(e)return i(e);t!==void 0&&(t=this[Xh](t)),i(e,t,n)}[Du](e,t){let n=this[Ga];if(e)return n(e);for(let i of t){let s=i[0];s!==void 0&&(i[0]=this[Xh](s))}n(e,t)}},Rm=class extends Ige{constructor(e,t,n,i){super(e,t),this[Ws]=n,this[Xh]=i,this[yf]=this[yf].bind(this),this[Du]=this[Du].bind(this),this[Ga]=null}[yf](e,t){let n=this[Ga];if(e)return n(e);t!==void 0&&(t=this[Xh](t)),n(e,t)}[Du](e,t){let n=this[Ga];if(e)return n(e);for(let i=0;i<t.length;i++){let s=t[i];s!==void 0&&(t[i]=this[Xh](s))}n(e,t)}},Cm=class extends Rge{constructor(e,t,n){super(e,t),this[Ws]=n}};for(let r of[Im,Rm])r.prototype._next=function(e){this[Ga]=e,this[Ws].next(this[yf])},r.prototype._nextv=function(e,t,n){this[Ga]=n,this[Ws].nextv(e,t,this[Du])},r.prototype._all=function(e,t){this[Ga]=t,this[Ws].all(e,this[Du])};for(let r of[Cm])r.prototype._next=function(e){this[Ws].next(e)},r.prototype._nextv=function(e,t,n){this[Ws].nextv(e,t,n)},r.prototype._all=function(e,t){this[Ws].all(e,t)};for(let r of[Im,Rm,Cm])r.prototype._seek=function(e,t){this[Ws].seek(e,t)},r.prototype._close=function(e){this[Ws].close(e)};w4.AbstractSublevelIterator=Im;w4.AbstractSublevelKeyIterator=Rm;w4.AbstractSublevelValueIterator=Cm});var HK=B((Kje,KK)=>{"use strict";var Yv=js(),{Buffer:Zv}=mm()||{},{AbstractSublevelIterator:Cge,AbstractSublevelKeyIterator:Pge,AbstractSublevelValueIterator:kge}=FK(),ja=Symbol("prefix"),VK=Symbol("upperBound"),Pm=Symbol("prefixRange"),Ni=Symbol("parent"),Qv=Symbol("unfix"),zK=new TextEncoder,Dge={separator:"!"};KK.exports=function({AbstractLevel:r}){class e extends r{static defaults(n){if(typeof n=="string")throw new Yv("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(n&&n.open)throw new Yv("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return n==null?Dge:n.separator?n:{...n,separator:"!"}}constructor(n,i,s){let{separator:o,manifest:a,...c}=e.defaults(s);i=Oge(i,o);let u=o.charCodeAt(0)+1,l=n[Ni]||n;if(!zK.encode(i).every(d=>d>u&&d<127))throw new Yv(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(Nge(l,a),c);let f=(n.prefix||"")+o+i+o,h=f.slice(0,-1)+String.fromCharCode(u);this[Ni]=l,this[ja]=new b4(f),this[VK]=new b4(h),this[Qv]=new Jv,this.nextTick=l.nextTick}prefixKey(n,i){if(i==="utf8")return this[ja].utf8+n;if(n.byteLength===0)return this[ja][i];if(i==="view"){let s=this[ja].view,o=new Uint8Array(s.byteLength+n.byteLength);return o.set(s,0),o.set(n,s.byteLength),o}else{let s=this[ja].buffer;return Zv.concat([s,n],s.byteLength+n.byteLength)}}[Pm](n,i){n.gte!==void 0?n.gte=this.prefixKey(n.gte,i):n.gt!==void 0?n.gt=this.prefixKey(n.gt,i):n.gte=this[ja][i],n.lte!==void 0?n.lte=this.prefixKey(n.lte,i):n.lt!==void 0?n.lt=this.prefixKey(n.lt,i):n.lte=this[VK][i]}get prefix(){return this[ja].utf8}get db(){return this[Ni]}_open(n,i){this[Ni].open({passive:!0},i)}_put(n,i,s,o){this[Ni].put(n,i,s,o)}_get(n,i,s){this[Ni].get(n,i,s)}_getMany(n,i,s){this[Ni].getMany(n,i,s)}_del(n,i,s){this[Ni].del(n,i,s)}_batch(n,i,s){this[Ni].batch(n,i,s)}_clear(n,i){this[Pm](n,n.keyEncoding),this[Ni].clear(n,i)}_iterator(n){this[Pm](n,n.keyEncoding);let i=this[Ni].iterator(n),s=this[Qv].get(this[ja].utf8.length,n.keyEncoding);return new Cge(this,n,i,s)}_keys(n){this[Pm](n,n.keyEncoding);let i=this[Ni].keys(n),s=this[Qv].get(this[ja].utf8.length,n.keyEncoding);return new Pge(this,n,i,s)}_values(n){this[Pm](n,n.keyEncoding);let i=this[Ni].values(n);return new kge(this,n,i)}}return{AbstractSublevel:e}};var Nge=function(r,e){return{...r.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...e,encodings:{utf8:Xv(r,"utf8"),buffer:Xv(r,"buffer"),view:Xv(r,"view")}}},Xv=function(r,e){return r.supports.encodings[e]?r.keyEncoding(e).name===e:!1},b4=class{constructor(e){this.utf8=e,this.view=zK.encode(e),this.buffer=Zv?Zv.from(this.view.buffer,0,this.view.byteLength):{}}},Jv=class{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return n===void 0&&(t==="view"?n=function(i,s){return s.subarray(i)}.bind(null,e):n=function(i,s){return s.slice(i)}.bind(null,e),this.cache.set(t,n)),n}},Oge=function(r,e){let t=0,n=r.length;for(;t<n&&r[t]===e;)t++;for(;n>t&&r[n-1]===e;)n--;return r.slice(t,n)}});var iS=B(nS=>{"use strict";var{supports:Lge}=Nz(),{Transcoder:Bge}=uK(),{EventEmitter:Mge}=Tn(),{fromCallback:Nu}=_m(),Ys=js(),{AbstractIterator:wf}=ku(),{DefaultKeyIterator:Uge,DefaultValueIterator:Fge}=TK(),{DeferredIterator:Vge,DeferredKeyIterator:zge,DeferredValueIterator:Kge}=AK(),{DefaultChainedBatch:$K}=PK(),{getCallback:bf,getOptions:Ou}=i4(),_4=NK(),Ye=Symbol("promise"),Wa=Symbol("landed"),_f=Symbol("resources"),eS=Symbol("closeResources"),km=Symbol("operations"),Dm=Symbol("undefer"),E4=Symbol("deferOpen"),qK=Symbol("options"),at=Symbol("status"),Ef=Symbol("defaultOptions"),Zh=Symbol("transcoder"),v4=Symbol("keyEncoding"),tS=Symbol("valueEncoding"),Hge=()=>{},Nm=class extends Mge{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=Ou(t);let{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[_f]=new Set,this[km]=[],this[E4]=!0,this[qK]=o,this[at]="opening",this.supports=Lge(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[Zh]=new Bge($ge(this)),this[v4]=this[Zh].encoding(n||"utf8"),this[tS]=this[Zh].encoding(i||"utf8");for(let a of this[Zh].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Ef]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[v4].commonName,valueEncoding:this[tS].commonName}),key:Object.freeze({keyEncoding:this[v4].commonName})},this.nextTick(()=>{this[E4]&&this.open({passive:!1},Hge)})}get status(){return this[at]}keyEncoding(e){return this[Zh].encoding(e??this[v4])}valueEncoding(e){return this[Zh].encoding(e??this[tS])}open(e,t){t=bf(e,t),t=Nu(t,Ye),e={...this[qK],...Ou(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;let n=i=>{this[at]==="closing"||this[at]==="opening"?this.once(Wa,i?()=>n(i):n):this[at]!=="open"?t(new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[at]==="opening"?this.once(Wa,n):this.nextTick(n):this[at]==="closed"||this[E4]?(this[E4]=!1,this[at]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[at]="closed",this[eS](()=>{this.emit(Wa),n(i)}),this[Dm]();return}this[at]="open",this[Dm](),this.emit(Wa),this[at]==="open"&&this.emit("open"),this[at]==="open"&&this.emit("ready"),n()})):this[at]==="open"?this.nextTick(n):this.once(Wa,()=>this.open(e,t)),t[Ye]}_open(e,t){this.nextTick(t)}close(e){e=Nu(e,Ye);let t=n=>{this[at]==="opening"||this[at]==="closing"?this.once(Wa,n?t(n):t):this[at]!=="closed"?e(new Ys("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[at]==="open"){this[at]="closing",this.emit("closing");let n=i=>{this[at]="open",this[Dm](),this.emit(Wa),t(i)};this[eS](()=>{this._close(i=>{if(i)return n(i);this[at]="closed",this[Dm](),this.emit(Wa),this[at]==="closed"&&this.emit("closed"),t()})})}else this[at]==="closed"?this.nextTick(t):this.once(Wa,()=>this.close(e));return e[Ye]}[eS](e){if(this[_f].size===0)return this.nextTick(e);let t=this[_f].size,n=!0,i=()=>{--t===0&&(n?this.nextTick(e):e())};for(let s of this[_f])s.close(i);n=!1,this[_f].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=bf(t,n),n=Nu(n,Ye),t=Ou(t,this[Ef].entry),this[at]==="opening")return this.defer(()=>this.get(e,t,n)),n[Ye];if(Jh(this,n))return n[Ye];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ye];let s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(u,l)=>{if(u)return(u.code==="LEVEL_NOT_FOUND"||u.notFound||/NotFound/i.test(u))&&(u.code||(u.code="LEVEL_NOT_FOUND"),u.notFound||(u.notFound=!0),u.status||(u.status=404)),n(u);try{l=o.decode(l)}catch(f){return n(new Ys("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:f}))}n(null,l)}),n[Ye]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=bf(t,n),n=Nu(n,Ye),t=Ou(t,this[Ef].entry),this[at]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Ye];if(Jh(this,n))return n[Ye];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Ye];if(e.length===0)return this.nextTick(n,null,[]),n[Ye];let i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));let c=new Array(e.length);for(let u=0;u<e.length;u++){let l=e[u],f=this._checkKey(l);if(f)return this.nextTick(n,f),n[Ye];c[u]=this.prefixKey(i.encode(l),o)}return this._getMany(c,t,(u,l)=>{if(u)return n(u);try{for(let f=0;f<l.length;f++)l[f]!==void 0&&(l[f]=s.decode(l[f]))}catch(f){return n(new Ys(`Could not decode one or more of ${l.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:f}))}n(null,l)}),n[Ye]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=bf(n,i),i=Nu(i,Ye),n=Ou(n,this[Ef].entry),this[at]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[Ye];if(Jh(this,i))return i[Ye];let s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[Ye];let o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,u=a.format;(n.keyEncoding!==c||n.valueEncoding!==u)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:u}));let l=this.prefixKey(o.encode(e),c),f=a.encode(t);return this._put(l,f,n,h=>{if(h)return i(h);this.emit("put",e,t),i()}),i[Ye]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=bf(t,n),n=Nu(n,Ye),t=Ou(t,this[Ef].key),this[at]==="opening")return this.defer(()=>this.del(e,t,n)),n[Ye];if(Jh(this,n))return n[Ye];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ye];let s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Ye]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[at]==="opening")return new $K(this);if(this[at]!=="open")throw new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=bf(t,n),n=Nu(n,Ye),t=Ou(t,this[Ef].empty),this[at]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Ye];if(Jh(this,n))return n[Ye];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Ye];if(e.length===0)return this.nextTick(n),n[Ye];let i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Ye];let u=Object.assign({},e[c]);if(u.type!=="put"&&u.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Ye];let l=this._checkKey(u.key);if(l)return this.nextTick(n,l),n[Ye];let f=u.sublevel!=null?u.sublevel:this,h=f.keyEncoding(u.keyEncoding||s),d=h.format;if(u.key=f.prefixKey(h.encode(u.key),d),u.keyEncoding=d,u.type==="put"){let m=this._checkValue(u.value);if(m)return this.nextTick(n,m),n[Ye];let w=f.valueEncoding(u.valueEncoding||o);u.value=w.encode(u.value),u.valueEncoding=w.format}f!==this&&(u.sublevel=null),i[c]=u}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Ye]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,rS.defaults(t))}_sublevel(e,t){return new rS(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=bf(e,t),t=Nu(t,Ye),e=Ou(e,this[Ef].empty),this[at]==="opening")return this.defer(()=>this.clear(e,t)),t[Ye];if(Jh(this,t))return t[Ye];let n=e,i=this.keyEncoding(e.keyEncoding);return e=_4(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[Ye]}_clear(e,t){this.nextTick(t)}iterator(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=_4(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[wf.keyEncoding]=t,e[wf.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[at]==="opening")return new Vge(this,e);if(this[at]!=="open")throw new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new wf(this,e)}keys(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=_4(e,t),e[wf.keyEncoding]=t,e[wf.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[at]==="opening")return new zge(this,e);if(this[at]!=="open")throw new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new Uge(this,e)}values(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=_4(e,t),e[wf.keyEncoding]=t,e[wf.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[at]==="opening")return new Kge(this,e);if(this[at]!=="open")throw new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new Fge(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[km].push(e)}[Dm](){if(this[km].length===0)return;let e=this[km];this[km]=[];for(let t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[_f].add(e)}detachResource(e){this[_f].delete(e)}_chainedBatch(){return new $K(this)}_checkKey(e){if(e==null)return new Ys("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Ys("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};Nm.prototype.nextTick=UK();var{AbstractSublevel:rS}=HK()({AbstractLevel:Nm});nS.AbstractLevel=Nm;nS.AbstractSublevel=rS;var Jh=function(r,e){return r[at]!=="open"?(r.nextTick(e,new Ys("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},$ge=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])}});var sS=B(vf=>{"use strict";vf.AbstractLevel=iS().AbstractLevel;vf.AbstractSublevel=iS().AbstractSublevel;vf.AbstractIterator=ku().AbstractIterator;vf.AbstractKeyIterator=ku().AbstractKeyIterator;vf.AbstractValueIterator=ku().AbstractValueIterator;vf.AbstractChainedBatch=Gv().AbstractChainedBatch});var jK=B((qje,GK)=>{GK.exports=Gge;var qge=Wv();function Gge(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,u;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function l(h){function d(){t&&t(h,n),t=null}c?qge(d):d()}function f(h,d,m){if(n[h]=m,d&&(a=!0),--s===0||d)l(d);else if(!a&&u<i){let w;o?(w=o[u],u+=1,r[w](function(b,v){f(w,b,v)})):(w=u,u+=1,r[w](function(b,v){f(w,b,v)}))}}u=e,s?o?o.some(function(h,d){return r[h](function(m,w){f(h,m,w)}),d===e-1}):r.some(function(h,d){return h(function(m,w){f(d,m,w)}),d===e-1}):l(null),c=!1}});var oS=B((Gje,WK)=>{"use strict";WK.exports=function(e){let t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null}});var aS=B((jje,YK)=>{"use strict";var jge=new TextEncoder;YK.exports=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):jge.encode(r)}});var eH=B(JK=>{"use strict";var{AbstractIterator:Wge}=sS(),QK=oS(),S4=aS(),$o=Symbol("cache"),Ya=Symbol("finished"),Oi=Symbol("options"),Qa=Symbol("currentOptions"),Sf=Symbol("position"),cS=Symbol("location"),e0=Symbol("first"),XK={},uS=class extends Wge{constructor(e,t,n){super(e,n),this[$o]=[],this[Ya]=this.limit===0,this[Oi]=n,this[Qa]={...n},this[Sf]=void 0,this[cS]=t,this[e0]=!0}_nextv(e,t,n){if(this[e0]=!1,this[Ya])return this.nextTick(n,null,[]);if(this[$o].length>0)return e=Math.min(e,this[$o].length),this.nextTick(n,null,this[$o].splice(0,e));this[Sf]!==void 0&&(this[Oi].reverse?(this[Qa].lt=this[Sf],this[Qa].lte=void 0):(this[Qa].gt=this[Sf],this[Qa].gte=void 0));let i;try{i=QK(this[Qa])}catch{return this[Ya]=!0,this.nextTick(n,null,[])}let s=this.db.db.transaction([this[cS]],"readonly"),o=s.objectStore(this[cS]),a=[];if(this[Oi].reverse){let c=!this[Oi].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=u=>{let l=u.target.result;if(l){let{key:f,value:h}=l;this[Sf]=f,a.push([this[Oi].keys&&f!==void 0?S4(f):void 0,this[Oi].values&&h!==void 0?S4(h):void 0]),a.length<e?l.continue():ZK(s)}else this[Ya]=!0}}else{let c,u,l=()=>{if(c===void 0||u===void 0)return;let f=Math.max(c.length,u.length);f===0||e===1/0?this[Ya]=!0:this[Sf]=c[f-1],a.length=f;for(let h=0;h<f;h++){let d=c[h],m=u[h];a[h]=[this[Oi].keys&&d!==void 0?S4(d):void 0,this[Oi].values&&m!==void 0?S4(m):void 0]}ZK(s)};this[Oi].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=f=>{c=f.target.result,l()}:(c=[],this.nextTick(l)),this[Oi].values?o.getAll(i,e<1/0?e:void 0).onsuccess=f=>{u=f.target.result,l()}:(u=[],this.nextTick(l))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[$o].length>0){let[t,n]=this[$o].shift();this.nextTick(e,null,t,n)}else if(this[Ya])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[e0]&&(this[e0]=!1,t=1),this._nextv(t,XK,(n,i)=>{if(n)return e(n);this[$o]=i,this._next(e)})}}_all(e,t){this[e0]=!1;let n=this[$o].splice(0,this[$o].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,XK,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[e0]=!0,this[$o]=[],this[Ya]=!1,this[Sf]=void 0,this[Qa]={...this[Oi]};let n;try{n=QK(this[Oi])}catch{this[Ya]=!0;return}n!==null&&!n.includes(e)?this[Ya]=!0:this[Oi].reverse?this[Qa].lte=e:this[Qa].gte=e}};JK.Iterator=uS;function ZK(r){typeof r.commit=="function"&&r.commit()}});var rH=B((Yje,tH)=>{"use strict";tH.exports=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);let o=e.db.transaction([t],"readwrite"),a=o.objectStore(t),c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};let u=a.openKeyCursor?"openKeyCursor":"openCursor",l=i.reverse?"prev":"next";a[u](n,l).onsuccess=function(f){let h=f.target.result;h&&(a.delete(h.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&h.continue()})}}});var cH=B(aH=>{"use strict";var{AbstractLevel:Yge}=sS(),nH=js(),Qge=jK(),{fromCallback:Xge}=_m(),{Iterator:Zge}=eH(),iH=aS(),Jge=rH(),e3e=oS(),oH="level-js-",Om=Symbol("idb"),lS=Symbol("namePrefix"),Xa=Symbol("location"),fS=Symbol("version"),xf=Symbol("store"),Lm=Symbol("onComplete"),sH=Symbol("promise"),x4=class extends Yge{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new nH("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[Xa]=e,this[lS]=i??oH,this[fS]=parseInt(s||1,10),this[Om]=null}get location(){return this[Xa]}get namePrefix(){return this[lS]}get version(){return this[fS]}get db(){return this[Om]}get type(){return"browser-level"}_open(e,t){let n=indexedDB.open(this[lS]+this[Xa],this[fS]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[Om]=n.result,t()},n.onupgradeneeded=i=>{let s=i.target.result;s.objectStoreNames.contains(this[Xa])||s.createObjectStore(this[Xa])}}[xf](e){return this[Om].transaction([this[Xa]],e).objectStore(this[Xa])}[Lm](e,t){let n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){let i=this[xf]("readonly"),s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[Lm](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new nH("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,iH(a))})}_getMany(e,t,n){let i=this[xf]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(u){return a(u)}c.onsuccess=()=>{let u=c.result;a(null,u===void 0?u:iH(u))},c.onerror=u=>{u.stopPropagation(),a(c.error)}});Qge(s,16,n)}_del(e,t,n){let i=this[xf]("readwrite"),s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[Lm](s,n)}_put(e,t,n,i){let s=this[xf]("readwrite"),o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[Lm](o,i)}_iterator(e){return new Zge(this,this[Xa],e)}_batch(e,t,n){let i=this[xf]("readwrite"),s=i.transaction,o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){let u=e[o++],l=u.key,f;try{f=u.type==="del"?i.delete(l):i.put(u.value,l)}catch(h){a=h,s.abort();return}o<e.length?f.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=e3e(e)}catch{return this.nextTick(t)}if(e.limit>=0)return Jge(this,this[Xa],n,e,t);try{let s=this[xf]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[Lm](i,t)}_close(e){this[Om].close(),this.nextTick(e)}};x4.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=oH),t=Xge(t,sH);let n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[sH]};aH.BrowserLevel=x4});var lH=B(uH=>{uH.Level=cH().BrowserLevel});var TH=B((sYe,xH)=>{"use strict";xH.exports=yn;var Um=Uu();function yn(r,e){this.lo=r>>>0,this.hi=e>>>0}var Af=yn.zero=new yn(0,0);Af.toNumber=function(){return 0};Af.zzEncode=Af.zzDecode=function(){return this};Af.length=function(){return 1};var m3e=yn.zeroHash="\0\0\0\0\0\0\0\0";yn.fromNumber=function(e){if(e===0)return Af;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new yn(n,i)};yn.from=function(e){if(typeof e=="number")return yn.fromNumber(e);if(Um.isString(e))if(Um.Long)e=Um.Long.fromString(e);else return yn.fromNumber(parseInt(e,10));return e.low||e.high?new yn(e.low>>>0,e.high>>>0):Af};yn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};yn.prototype.toLong=function(e){return Um.Long?new Um.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var Mu=String.prototype.charCodeAt;yn.fromHash=function(e){return e===m3e?Af:new yn((Mu.call(e,0)|Mu.call(e,1)<<8|Mu.call(e,2)<<16|Mu.call(e,3)<<24)>>>0,(Mu.call(e,4)|Mu.call(e,5)<<8|Mu.call(e,6)<<16|Mu.call(e,7)<<24)>>>0)};yn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};yn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};yn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};yn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Uu=B(mS=>{"use strict";var Se=mS;Se.asPromise=w7();Se.base64=b7();Se.EventEmitter=_7();Se.float=E7();Se.inquire=v7();Se.utf8=x7();Se.pool=T7();Se.LongBits=TH();Se.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Se.global=Se.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||mS;Se.emptyArray=Object.freeze?Object.freeze([]):[];Se.emptyObject=Object.freeze?Object.freeze({}):{};Se.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Se.isString=function(e){return typeof e=="string"||e instanceof String};Se.isObject=function(e){return e&&typeof e=="object"};Se.isset=Se.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Se.Buffer=function(){try{var r=Se.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Se._Buffer_from=null;Se._Buffer_allocUnsafe=null;Se.newBuffer=function(e){return typeof e=="number"?Se.Buffer?Se._Buffer_allocUnsafe(e):new Se.Array(e):Se.Buffer?Se._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Se.Array=typeof Uint8Array<"u"?Uint8Array:Array;Se.Long=Se.global.dcodeIO&&Se.global.dcodeIO.Long||Se.global.Long||Se.inquire("long");Se.key2Re=/^true|false|0|1$/;Se.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Se.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Se.longToHash=function(e){return e?Se.LongBits.from(e).toHash():Se.LongBits.zeroHash};Se.longFromHash=function(e,t){var n=Se.LongBits.fromHash(e);return Se.Long?Se.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function AH(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Se.merge=AH;Se.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function IH(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&AH(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}Se.newError=IH;Se.ProtocolError=IH("ProtocolError");Se.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Se.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Se.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Se._configure=function(){var r=Se.Buffer;if(!r){Se._Buffer_from=Se._Buffer_allocUnsafe=null;return}Se._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Se._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var vS=B((aYe,kH)=>{"use strict";kH.exports=Ct;var ds=Uu(),gS,C4=ds.LongBits,RH=ds.base64,CH=ds.utf8;function Fm(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function wS(){}function g3e(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Ct(){this.len=0,this.head=new Fm(wS,0,0),this.tail=this.head,this.states=null}var PH=function(){return ds.Buffer?function(){return(Ct.create=function(){return new gS})()}:function(){return new Ct}};Ct.create=PH();Ct.alloc=function(e){return new ds.Array(e)};ds.Array!==Array&&(Ct.alloc=ds.pool(Ct.alloc,ds.Array.prototype.subarray));Ct.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Fm(e,t,n),this.len+=t,this};function bS(r,e,t){e[t]=r&255}function y3e(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function _S(r,e){this.len=r,this.next=void 0,this.val=e}_S.prototype=Object.create(Fm.prototype);_S.prototype.fn=y3e;Ct.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new _S((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Ct.prototype.int32=function(e){return e<0?this._push(ES,10,C4.fromNumber(e)):this.uint32(e)};Ct.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function ES(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Ct.prototype.uint64=function(e){var t=C4.from(e);return this._push(ES,t.length(),t)};Ct.prototype.int64=Ct.prototype.uint64;Ct.prototype.sint64=function(e){var t=C4.from(e).zzEncode();return this._push(ES,t.length(),t)};Ct.prototype.bool=function(e){return this._push(bS,1,e?1:0)};function yS(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Ct.prototype.fixed32=function(e){return this._push(yS,4,e>>>0)};Ct.prototype.sfixed32=Ct.prototype.fixed32;Ct.prototype.fixed64=function(e){var t=C4.from(e);return this._push(yS,4,t.lo)._push(yS,4,t.hi)};Ct.prototype.sfixed64=Ct.prototype.fixed64;Ct.prototype.float=function(e){return this._push(ds.float.writeFloatLE,4,e)};Ct.prototype.double=function(e){return this._push(ds.float.writeDoubleLE,8,e)};var w3e=ds.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Ct.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(bS,1,0);if(ds.isString(e)){var n=Ct.alloc(t=RH.length(e));RH.decode(e,n,0),e=n}return this.uint32(t)._push(w3e,t,e)};Ct.prototype.string=function(e){var t=CH.length(e);return t?this.uint32(t)._push(CH.write,t,e):this._push(bS,1,0)};Ct.prototype.fork=function(){return this.states=new g3e(this),this.head=this.tail=new Fm(wS,0,0),this.len=0,this};Ct.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Fm(wS,0,0),this.len=0),this};Ct.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Ct.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Ct._configure=function(r){gS=r,Ct.create=PH(),gS._configure()}});var OH=B((cYe,NH)=>{"use strict";NH.exports=Go;var DH=vS();(Go.prototype=Object.create(DH.prototype)).constructor=Go;var Fu=Uu();function Go(){DH.call(this)}Go._configure=function(){Go.alloc=Fu._Buffer_allocUnsafe,Go.writeBytesBuffer=Fu.Buffer&&Fu.Buffer.prototype instanceof Uint8Array&&Fu.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};Go.prototype.bytes=function(e){Fu.isString(e)&&(e=Fu._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Go.writeBytesBuffer,t,e),this};function b3e(r,e,t){r.length<40?Fu.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Go.prototype.string=function(e){var t=Fu.Buffer.byteLength(e);return this.uint32(t),t&&this._push(b3e,t,e),this};Go._configure()});var TS=B((uYe,FH)=>{"use strict";FH.exports=Ur;var jo=Uu(),xS,MH=jo.LongBits,_3e=jo.utf8;function Xs(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function Ur(r){this.buf=r,this.pos=0,this.len=r.length}var LH=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ur(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ur(e);throw Error("illegal buffer")},UH=function(){return jo.Buffer?function(t){return(Ur.create=function(i){return jo.Buffer.isBuffer(i)?new xS(i):LH(i)})(t)}:LH};Ur.create=UH();Ur.prototype._slice=jo.Array.prototype.subarray||jo.Array.prototype.slice;Ur.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Xs(this,10);return e}}();Ur.prototype.int32=function(){return this.uint32()|0};Ur.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function SS(){var r=new MH(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Xs(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Xs(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Ur.prototype.bool=function(){return this.uint32()!==0};function P4(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}Ur.prototype.fixed32=function(){if(this.pos+4>this.len)throw Xs(this,4);return P4(this.buf,this.pos+=4)};Ur.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Xs(this,4);return P4(this.buf,this.pos+=4)|0};function BH(){if(this.pos+8>this.len)throw Xs(this,8);return new MH(P4(this.buf,this.pos+=4),P4(this.buf,this.pos+=4))}Ur.prototype.float=function(){if(this.pos+4>this.len)throw Xs(this,4);var e=jo.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ur.prototype.double=function(){if(this.pos+8>this.len)throw Xs(this,4);var e=jo.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ur.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Xs(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Ur.prototype.string=function(){var e=this.bytes();return _3e.read(e,0,e.length)};Ur.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Xs(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Xs(this);while(this.buf[this.pos++]&128);return this};Ur.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Ur._configure=function(r){xS=r,Ur.create=UH(),xS._configure();var e=jo.Long?"toLong":"toNumber";jo.merge(Ur.prototype,{int64:function(){return SS.call(this)[e](!1)},uint64:function(){return SS.call(this)[e](!0)},sint64:function(){return SS.call(this).zzDecode()[e](!1)},fixed64:function(){return BH.call(this)[e](!0)},sfixed64:function(){return BH.call(this)[e](!1)}})}});var HH=B((lYe,KH)=>{"use strict";KH.exports=If;var zH=TS();(If.prototype=Object.create(zH.prototype)).constructor=If;var VH=Uu();function If(r){zH.call(this,r)}If._configure=function(){VH.Buffer&&(If.prototype._slice=VH.Buffer.prototype.slice)};If.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};If._configure()});var qH=B((fYe,$H)=>{"use strict";$H.exports=Vm;var AS=Uu();(Vm.prototype=Object.create(AS.EventEmitter.prototype)).constructor=Vm;function Vm(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");AS.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}Vm.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return AS.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return o.emit("error",c,e),s(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,e),s(l)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Vm.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var jH=B(GH=>{"use strict";var E3e=GH;E3e.Service=qH()});var YH=B((hYe,WH)=>{"use strict";WH.exports={}});var ZH=B(XH=>{"use strict";var hi=XH;hi.build="minimal";hi.Writer=vS();hi.BufferWriter=OH();hi.Reader=TS();hi.BufferReader=HH();hi.util=Uu();hi.rpc=jH();hi.roots=YH();hi.configure=QH;function QH(){hi.util._configure(),hi.Writer._configure(hi.BufferWriter),hi.Reader._configure(hi.BufferReader)}QH()});var IS=B((mYe,JH)=>{"use strict";JH.exports=ZH()});var t$=B((e$,zm)=>{(function(r,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof ed=="function"&&typeof zm=="object"&&zm&&zm.exports&&(zm.exports=e(IS()))})(e$,function(r){"use strict";var e=r.Reader,t=r.Writer,n=r.util,i=r.roots.default||(r.roots.default={});return i.RPC=function(){function s(a){if(this.subscriptions=[],this.messages=[],a)for(var c=Object.keys(a),u=0;u<c.length;++u)a[c[u]]!=null&&(this[c[u]]=a[c[u]])}s.prototype.subscriptions=n.emptyArray,s.prototype.messages=n.emptyArray,s.prototype.control=null;var o;return Object.defineProperty(s.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),s.encode=function(c,u){if(u||(u=t.create()),c.subscriptions!=null&&c.subscriptions.length)for(var l=0;l<c.subscriptions.length;++l)i.RPC.SubOpts.encode(c.subscriptions[l],u.uint32(10).fork()).ldelim();if(c.messages!=null&&c.messages.length)for(var l=0;l<c.messages.length;++l)i.RPC.Message.encode(c.messages[l],u.uint32(18).fork()).ldelim();return c.control!=null&&Object.hasOwnProperty.call(c,"control")&&i.RPC.ControlMessage.encode(c.control,u.uint32(26).fork()).ldelim(),u},s.decode=function(c,u){c instanceof e||(c=e.create(c));for(var l=u===void 0?c.len:c.pos+u,f=new i.RPC;c.pos<l;){var h=c.uint32();switch(h>>>3){case 1:f.subscriptions&&f.subscriptions.length||(f.subscriptions=[]),f.subscriptions.push(i.RPC.SubOpts.decode(c,c.uint32()));break;case 2:f.messages&&f.messages.length||(f.messages=[]),f.messages.push(i.RPC.Message.decode(c,c.uint32()));break;case 3:f.control=i.RPC.ControlMessage.decode(c,c.uint32());break;default:c.skipType(h&7);break}}return f},s.fromObject=function(c){if(c instanceof i.RPC)return c;var u=new i.RPC;if(c.subscriptions){if(!Array.isArray(c.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var l=0;l<c.subscriptions.length;++l){if(typeof c.subscriptions[l]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[l]=i.RPC.SubOpts.fromObject(c.subscriptions[l])}}if(c.messages){if(!Array.isArray(c.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var l=0;l<c.messages.length;++l){if(typeof c.messages[l]!="object")throw TypeError(".RPC.messages: object expected");u.messages[l]=i.RPC.Message.fromObject(c.messages[l])}}if(c.control!=null){if(typeof c.control!="object")throw TypeError(".RPC.control: object expected");u.control=i.RPC.ControlMessage.fromObject(c.control)}return u},s.toObject=function(c,u){u||(u={});var l={};if((u.arrays||u.defaults)&&(l.subscriptions=[],l.messages=[]),c.subscriptions&&c.subscriptions.length){l.subscriptions=[];for(var f=0;f<c.subscriptions.length;++f)l.subscriptions[f]=i.RPC.SubOpts.toObject(c.subscriptions[f],u)}if(c.messages&&c.messages.length){l.messages=[];for(var f=0;f<c.messages.length;++f)l.messages[f]=i.RPC.Message.toObject(c.messages[f],u)}return c.control!=null&&c.hasOwnProperty("control")&&(l.control=i.RPC.ControlMessage.toObject(c.control,u),u.oneofs&&(l._control="control")),l},s.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},s.SubOpts=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.subscribe=null,a.prototype.topic=null;var c;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(c=["subscribe"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(c=["topic"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.subscribe!=null&&Object.hasOwnProperty.call(l,"subscribe")&&f.uint32(8).bool(l.subscribe),l.topic!=null&&Object.hasOwnProperty.call(l,"topic")&&f.uint32(18).string(l.topic),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.SubOpts;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.subscribe=l.bool();break;case 2:d.topic=l.string();break;default:l.skipType(m&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.SubOpts)return l;var f=new i.RPC.SubOpts;return l.subscribe!=null&&(f.subscribe=Boolean(l.subscribe)),l.topic!=null&&(f.topic=String(l.topic)),f},a.toObject=function(l,f){f||(f={});var h={};return l.subscribe!=null&&l.hasOwnProperty("subscribe")&&(h.subscribe=l.subscribe,f.oneofs&&(h._subscribe="subscribe")),l.topic!=null&&l.hasOwnProperty("topic")&&(h.topic=l.topic,f.oneofs&&(h._topic="topic")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.Message=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var c;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(c=["from"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(c=["data"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(c=["seqno"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(c=["signature"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(c=["key"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.from!=null&&Object.hasOwnProperty.call(l,"from")&&f.uint32(10).bytes(l.from),l.data!=null&&Object.hasOwnProperty.call(l,"data")&&f.uint32(18).bytes(l.data),l.seqno!=null&&Object.hasOwnProperty.call(l,"seqno")&&f.uint32(26).bytes(l.seqno),f.uint32(34).string(l.topic),l.signature!=null&&Object.hasOwnProperty.call(l,"signature")&&f.uint32(42).bytes(l.signature),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&f.uint32(50).bytes(l.key),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.Message;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.from=l.bytes();break;case 2:d.data=l.bytes();break;case 3:d.seqno=l.bytes();break;case 4:d.topic=l.string();break;case 5:d.signature=l.bytes();break;case 6:d.key=l.bytes();break;default:l.skipType(m&7);break}}if(!d.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:d});return d},a.fromObject=function(l){if(l instanceof i.RPC.Message)return l;var f=new i.RPC.Message;return l.from!=null&&(typeof l.from=="string"?n.base64.decode(l.from,f.from=n.newBuffer(n.base64.length(l.from)),0):l.from.length&&(f.from=l.from)),l.data!=null&&(typeof l.data=="string"?n.base64.decode(l.data,f.data=n.newBuffer(n.base64.length(l.data)),0):l.data.length&&(f.data=l.data)),l.seqno!=null&&(typeof l.seqno=="string"?n.base64.decode(l.seqno,f.seqno=n.newBuffer(n.base64.length(l.seqno)),0):l.seqno.length&&(f.seqno=l.seqno)),l.topic!=null&&(f.topic=String(l.topic)),l.signature!=null&&(typeof l.signature=="string"?n.base64.decode(l.signature,f.signature=n.newBuffer(n.base64.length(l.signature)),0):l.signature.length&&(f.signature=l.signature)),l.key!=null&&(typeof l.key=="string"?n.base64.decode(l.key,f.key=n.newBuffer(n.base64.length(l.key)),0):l.key.length&&(f.key=l.key)),f},a.toObject=function(l,f){f||(f={});var h={};return f.defaults&&(h.topic=""),l.from!=null&&l.hasOwnProperty("from")&&(h.from=f.bytes===String?n.base64.encode(l.from,0,l.from.length):f.bytes===Array?Array.prototype.slice.call(l.from):l.from,f.oneofs&&(h._from="from")),l.data!=null&&l.hasOwnProperty("data")&&(h.data=f.bytes===String?n.base64.encode(l.data,0,l.data.length):f.bytes===Array?Array.prototype.slice.call(l.data):l.data,f.oneofs&&(h._data="data")),l.seqno!=null&&l.hasOwnProperty("seqno")&&(h.seqno=f.bytes===String?n.base64.encode(l.seqno,0,l.seqno.length):f.bytes===Array?Array.prototype.slice.call(l.seqno):l.seqno,f.oneofs&&(h._seqno="seqno")),l.topic!=null&&l.hasOwnProperty("topic")&&(h.topic=l.topic),l.signature!=null&&l.hasOwnProperty("signature")&&(h.signature=f.bytes===String?n.base64.encode(l.signature,0,l.signature.length):f.bytes===Array?Array.prototype.slice.call(l.signature):l.signature,f.oneofs&&(h._signature="signature")),l.key!=null&&l.hasOwnProperty("key")&&(h.key=f.bytes===String?n.base64.encode(l.key,0,l.key.length):f.bytes===Array?Array.prototype.slice.call(l.key):l.key,f.oneofs&&(h._key="key")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlMessage=function(){function a(c){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],c)for(var u=Object.keys(c),l=0;l<u.length;++l)c[u[l]]!=null&&(this[u[l]]=c[u[l]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,l){if(l||(l=t.create()),u.ihave!=null&&u.ihave.length)for(var f=0;f<u.ihave.length;++f)i.RPC.ControlIHave.encode(u.ihave[f],l.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var f=0;f<u.iwant.length;++f)i.RPC.ControlIWant.encode(u.iwant[f],l.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var f=0;f<u.graft.length;++f)i.RPC.ControlGraft.encode(u.graft[f],l.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var f=0;f<u.prune.length;++f)i.RPC.ControlPrune.encode(u.prune[f],l.uint32(34).fork()).ldelim();return l},a.decode=function(u,l){u instanceof e||(u=e.create(u));for(var f=l===void 0?u.len:u.pos+l,h=new i.RPC.ControlMessage;u.pos<f;){var d=u.uint32();switch(d>>>3){case 1:h.ihave&&h.ihave.length||(h.ihave=[]),h.ihave.push(i.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:h.iwant&&h.iwant.length||(h.iwant=[]),h.iwant.push(i.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:h.graft&&h.graft.length||(h.graft=[]),h.graft.push(i.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:h.prune&&h.prune.length||(h.prune=[]),h.prune.push(i.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(d&7);break}}return h},a.fromObject=function(u){if(u instanceof i.RPC.ControlMessage)return u;var l=new i.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");l.ihave=[];for(var f=0;f<u.ihave.length;++f){if(typeof u.ihave[f]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");l.ihave[f]=i.RPC.ControlIHave.fromObject(u.ihave[f])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");l.iwant=[];for(var f=0;f<u.iwant.length;++f){if(typeof u.iwant[f]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");l.iwant[f]=i.RPC.ControlIWant.fromObject(u.iwant[f])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");l.graft=[];for(var f=0;f<u.graft.length;++f){if(typeof u.graft[f]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");l.graft[f]=i.RPC.ControlGraft.fromObject(u.graft[f])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");l.prune=[];for(var f=0;f<u.prune.length;++f){if(typeof u.prune[f]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");l.prune[f]=i.RPC.ControlPrune.fromObject(u.prune[f])}}return l},a.toObject=function(u,l){l||(l={});var f={};if((l.arrays||l.defaults)&&(f.ihave=[],f.iwant=[],f.graft=[],f.prune=[]),u.ihave&&u.ihave.length){f.ihave=[];for(var h=0;h<u.ihave.length;++h)f.ihave[h]=i.RPC.ControlIHave.toObject(u.ihave[h],l)}if(u.iwant&&u.iwant.length){f.iwant=[];for(var h=0;h<u.iwant.length;++h)f.iwant[h]=i.RPC.ControlIWant.toObject(u.iwant[h],l)}if(u.graft&&u.graft.length){f.graft=[];for(var h=0;h<u.graft.length;++h)f.graft[h]=i.RPC.ControlGraft.toObject(u.graft[h],l)}if(u.prune&&u.prune.length){f.prune=[];for(var h=0;h<u.prune.length;++h)f.prune[h]=i.RPC.ControlPrune.toObject(u.prune[h],l)}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){if(f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),l.messageIDs!=null&&l.messageIDs.length)for(var h=0;h<l.messageIDs.length;++h)f.uint32(18).bytes(l.messageIDs[h]);return f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlIHave;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.topicID=l.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(l.bytes());break;default:l.skipType(m&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlIHave)return l;var f=new i.RPC.ControlIHave;if(l.topicID!=null&&(f.topicID=String(l.topicID)),l.messageIDs){if(!Array.isArray(l.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");f.messageIDs=[];for(var h=0;h<l.messageIDs.length;++h)typeof l.messageIDs[h]=="string"?n.base64.decode(l.messageIDs[h],f.messageIDs[h]=n.newBuffer(n.base64.length(l.messageIDs[h])),0):l.messageIDs[h].length&&(f.messageIDs[h]=l.messageIDs[h])}return f},a.toObject=function(l,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.messageIDs=[]),l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),l.messageIDs&&l.messageIDs.length){h.messageIDs=[];for(var d=0;d<l.messageIDs.length;++d)h.messageIDs[d]=f.bytes===String?n.base64.encode(l.messageIDs[d],0,l.messageIDs[d].length):f.bytes===Array?Array.prototype.slice.call(l.messageIDs[d]):l.messageIDs[d]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlIWant=function(){function a(c){if(this.messageIDs=[],c)for(var u=Object.keys(c),l=0;l<u.length;++l)c[u[l]]!=null&&(this[u[l]]=c[u[l]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,l){if(l||(l=t.create()),u.messageIDs!=null&&u.messageIDs.length)for(var f=0;f<u.messageIDs.length;++f)l.uint32(10).bytes(u.messageIDs[f]);return l},a.decode=function(u,l){u instanceof e||(u=e.create(u));for(var f=l===void 0?u.len:u.pos+l,h=new i.RPC.ControlIWant;u.pos<f;){var d=u.uint32();switch(d>>>3){case 1:h.messageIDs&&h.messageIDs.length||(h.messageIDs=[]),h.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return h},a.fromObject=function(u){if(u instanceof i.RPC.ControlIWant)return u;var l=new i.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");l.messageIDs=[];for(var f=0;f<u.messageIDs.length;++f)typeof u.messageIDs[f]=="string"?n.base64.decode(u.messageIDs[f],l.messageIDs[f]=n.newBuffer(n.base64.length(u.messageIDs[f])),0):u.messageIDs[f].length&&(l.messageIDs[f]=u.messageIDs[f])}return l},a.toObject=function(u,l){l||(l={});var f={};if((l.arrays||l.defaults)&&(f.messageIDs=[]),u.messageIDs&&u.messageIDs.length){f.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)f.messageIDs[h]=l.bytes===String?n.base64.encode(u.messageIDs[h],0,u.messageIDs[h].length):l.bytes===Array?Array.prototype.slice.call(u.messageIDs[h]):u.messageIDs[h]}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlGraft=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlGraft;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.topicID=l.string();break;default:l.skipType(m&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlGraft)return l;var f=new i.RPC.ControlGraft;return l.topicID!=null&&(f.topicID=String(l.topicID)),f},a.toObject=function(l,f){f||(f={});var h={};return l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(c=["backoff"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){if(f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),l.peers!=null&&l.peers.length)for(var h=0;h<l.peers.length;++h)i.RPC.PeerInfo.encode(l.peers[h],f.uint32(18).fork()).ldelim();return l.backoff!=null&&Object.hasOwnProperty.call(l,"backoff")&&f.uint32(24).uint64(l.backoff),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlPrune;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.topicID=l.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(i.RPC.PeerInfo.decode(l,l.uint32()));break;case 3:d.backoff=l.uint64();break;default:l.skipType(m&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlPrune)return l;var f=new i.RPC.ControlPrune;if(l.topicID!=null&&(f.topicID=String(l.topicID)),l.peers){if(!Array.isArray(l.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");f.peers=[];for(var h=0;h<l.peers.length;++h){if(typeof l.peers[h]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");f.peers[h]=i.RPC.PeerInfo.fromObject(l.peers[h])}}return l.backoff!=null&&(n.Long?(f.backoff=n.Long.fromValue(l.backoff)).unsigned=!0:typeof l.backoff=="string"?f.backoff=parseInt(l.backoff,10):typeof l.backoff=="number"?f.backoff=l.backoff:typeof l.backoff=="object"&&(f.backoff=new n.LongBits(l.backoff.low>>>0,l.backoff.high>>>0).toNumber(!0))),f},a.toObject=function(l,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.peers=[]),l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),l.peers&&l.peers.length){h.peers=[];for(var d=0;d<l.peers.length;++d)h.peers[d]=i.RPC.PeerInfo.toObject(l.peers[d],f)}return l.backoff!=null&&l.hasOwnProperty("backoff")&&(typeof l.backoff=="number"?h.backoff=f.longs===String?String(l.backoff):l.backoff:h.backoff=f.longs===String?n.Long.prototype.toString.call(l.backoff):f.longs===Number?new n.LongBits(l.backoff.low>>>0,l.backoff.high>>>0).toNumber(!0):l.backoff,f.oneofs&&(h._backoff="backoff")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s.PeerInfo=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var c;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(c=["peerID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(c=["signedPeerRecord"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.peerID!=null&&Object.hasOwnProperty.call(l,"peerID")&&f.uint32(10).bytes(l.peerID),l.signedPeerRecord!=null&&Object.hasOwnProperty.call(l,"signedPeerRecord")&&f.uint32(18).bytes(l.signedPeerRecord),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.PeerInfo;l.pos<h;){var m=l.uint32();switch(m>>>3){case 1:d.peerID=l.bytes();break;case 2:d.signedPeerRecord=l.bytes();break;default:l.skipType(m&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.PeerInfo)return l;var f=new i.RPC.PeerInfo;return l.peerID!=null&&(typeof l.peerID=="string"?n.base64.decode(l.peerID,f.peerID=n.newBuffer(n.base64.length(l.peerID)),0):l.peerID.length&&(f.peerID=l.peerID)),l.signedPeerRecord!=null&&(typeof l.signedPeerRecord=="string"?n.base64.decode(l.signedPeerRecord,f.signedPeerRecord=n.newBuffer(n.base64.length(l.signedPeerRecord)),0):l.signedPeerRecord.length&&(f.signedPeerRecord=l.signedPeerRecord)),f},a.toObject=function(l,f){f||(f={});var h={};return l.peerID!=null&&l.hasOwnProperty("peerID")&&(h.peerID=f.bytes===String?n.base64.encode(l.peerID,0,l.peerID.length):f.bytes===Array?Array.prototype.slice.call(l.peerID):l.peerID,f.oneofs&&(h._peerID="peerID")),l.signedPeerRecord!=null&&l.hasOwnProperty("signedPeerRecord")&&(h.signedPeerRecord=f.bytes===String?n.base64.encode(l.signedPeerRecord,0,l.signedPeerRecord.length):f.bytes===Array?Array.prototype.slice.call(l.signedPeerRecord):l.signedPeerRecord,f.oneofs&&(h._signedPeerRecord="signedPeerRecord")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),s}(),i})});var d$=B((zYe,f$)=>{"use strict";function Rr(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}Rr.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};Rr.prototype.get=function(e){return this.peekAt(e)};Rr.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Rr.prototype.peekFront=function(){return this.peek()};Rr.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Rr.prototype,"length",{get:function(){return this.size()}});Rr.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Rr.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Rr.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Rr.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Rr.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};Rr.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Rr.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Rr.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,u=this._list.length,l=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+u&this._capacityMask);c>l;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var f=o.length;for(s=0;s<f;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-f+u&this._capacityMask);l<c;)this.push(arguments[l++]);for(s=0;s<f;s++)this.push(o[s])}return a}else return this.remove(n,t)}};Rr.prototype.clear=function(){this._head=0,this._tail=0};Rr.prototype.isEmpty=function(){return this._head===this._tail};Rr.prototype.toArray=function(){return this._copyArray(!1)};Rr.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};Rr.prototype._copyArray=function(e){var t=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)t.push(n[s]);for(s=0;s<this._tail;s++)t.push(n[s])}else for(s=this._head;s<this._tail;s++)t.push(n[s]);return t};Rr.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Rr.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};f$.exports=Rr});var jq=B((Nrt,Gq)=>{Gq.exports=r=>{if(r[Symbol.asyncIterator])return r;if(r.getReader)return async function*(){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")}});var zS=B((Cut,Lj)=>{"use strict";var Zye=Ld(),Jye=(r,e)=>({path:decodeURIComponent(new URL(r).pathname.split("/").pop()||""),content:e5e(r,e)});async function*e5e(r,e){yield*(await new Zye().get(r,e)).iterator()}Lj.exports=Jye});var f6=B((Xft,aW)=>{"use strict";function A5e(r){let e=new Uint8Array(r),t=0;if(r>0)if(r>65536)for(;t<r;)t+65536>r?(crypto.getRandomValues(e.subarray(t,t+(r-t))),t+=r-t):(crypto.getRandomValues(e.subarray(t,t+65536)),t+=65536);else crypto.getRandomValues(e);return e}aW.exports=A5e});var ex=B((edt,JS)=>{"use strict";var R5e=(r,e)=>Math.floor(Math.random()*(e-r+1)+r),lW=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},fW=({clearTimeout:r,setTimeout:e,willResolve:t})=>(n,{value:i,signal:s}={})=>{if(s&&s.aborted)return Promise.reject(lW());let o,a,c,u=r||clearTimeout,l=()=>{u(o),c(lW())},f=()=>{s&&s.removeEventListener("abort",l)},h=new Promise((d,m)=>{a=()=>{f(),t?d(i):m(i)},c=m,o=(e||setTimeout)(a,n)});return s&&s.addEventListener("abort",l,{once:!0}),h.clear=()=>{u(o),o=null,a()},h},dW=r=>{let e=fW({...r,willResolve:!0});return e.reject=fW({...r,willResolve:!1}),e.range=(t,n,i)=>e(R5e(t,n),i),e},ZS=dW();ZS.createWithTimers=dW;JS.exports=ZS;JS.exports.default=ZS});var cx=B((Tht,RW)=>{"use strict";var E0=new Map,F5e=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function V5e(r,e,t){for(;E0.get(t);){try{await r()}catch(n){setTimeout(()=>{throw n},1);break}if(!E0.get(t))break;await new Promise(n=>{let i=setTimeout(n,e);E0.set(t,i)})}}function z5e(r,e,t){t=t||e;let n=F5e(),i=setTimeout(()=>{V5e(r,e,n)},t);return E0.set(n,i),n}function K5e(r){let e=E0.get(r);e&&(clearTimeout(e),E0.delete(r))}RW.exports={setDelayedInterval:z5e,clearDelayedInterval:K5e}});var u2=B((p0t,OW)=>{OW.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}});var BW=B((g0t,LW)=>{LW.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){let t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();let n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}}});var UW=B((y0t,MW)=>{var G5e=BW();MW.exports=G5e});var Fi=B((b0t,FW)=>{FW.exports=class{constructor(e,t,n,i){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof i>"u"?!1:i}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}});var S0=B((E0t,zW)=>{var lx=u2(),j5e=UW(),VW=Fi();zW.exports=class extends lx{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new j5e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,i,s,o={}){let a=this._getRateLimiterRes(n,i,s);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+i&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,o)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(u=>{t(u)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,i,s,o=!1,a={}){this.insuranceLimiter instanceof lx?this.insuranceLimiter[t](s,o,a).then(c=>{n(c)}).catch(c=>{i(c)}):i(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof lx))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){let i=t*1e3;return this._block(this.getKey(e),this.points+1,i,n)}set(e,t,n,i={}){let s=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,s,i)}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return s(new VW(0,a));this._upsert(o,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(i,s,o,t,c)}).catch(c=>{this._handleError(c,"consume",i,s,e,t,n)})})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise((s,o)=>{this._upsert(i,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{s(this._getRateLimiterRes(i,t,a))}).catch(a=>{this._handleError(a,"penalty",s,o,e,t,n)})})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise((s,o)=>{this._upsert(i,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{s(this._getRateLimiterRes(i,-t,a))}).catch(a=>{this._handleError(a,"reward",s,o,e,t,n)})})}get(e,t={}){let n=this.getKey(e);return new Promise((i,s)=>{this._get(n,t).then(o=>{i(o===null||typeof o>"u"?null:this._getRateLimiterRes(n,0,o))}).catch(o=>{this._handleError(o,"get",i,s,e,t)})})}delete(e,t={}){let n=this.getKey(e);return new Promise((i,s)=>{this._delete(n,t).then(o=>{this._inMemoryBlockedKeys.delete(n),i(o)}).catch(o=>{this._handleError(o,"delete",i,s,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,i={}){return new Promise((s,o)=>{this._upsert(e,t,n,!0,i).then(()=>{s(new VW(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",s,o,this.parseKey(e),n/1e3,i)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,i=!1,s={}){throw new Error("You have to implement the method '_upsert'!")}}});var $W=B((v0t,HW)=>{var W5e=S0(),Y5e=Fi(),KW="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ",fx=class extends W5e{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:KW})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[i,s]=n;Array.isArray(i)&&([,i]=i,[,s]=s);let o=new Y5e;return o.consumedPoints=parseInt(i),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}_upsert(e,t,n,i=!1){return new Promise((s,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));let a=Math.floor(n/1e3),c=this.client.multi();if(i)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((u,l)=>u?o(u):s(l));else if(a>0){let u=function(l,f){return l?o(l):s(f)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,u):this.client.eval(KW,1,e,t,a,u)}else c.incrby(e,t).pttl(e).exec((u,l)=>u?o(u):s(l))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((i,s)=>{if(i)n(i);else{let[o]=s;if(o===null)return t(null);t(s)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,s)=>{i?n(i):t(s>0)})})}};HW.exports=fx});var jW=B((S0t,GW)=>{var Q5e=S0(),X5e=Fi();function qW(r){try{let e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(i=>parseInt(i));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}var l2=class extends Q5e{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=qW(this.client)}):(this._initCollection(),this._driverVersion=qW(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?l2.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){let t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){let i=new X5e,s;return typeof n.value>"u"?s=n:s=n.value,i.isFirstInDuration=s.points===t,i.consumedPoints=s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire!==null?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,i}_upsert(e,t,n,i=!1,s={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let o=s.attrs||{},a,c;i?(a={key:e},a=Object.assign(a,o),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,o)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,o),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,o));let u={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?u.returnDocument="after":u.returnOriginal=!1,new Promise((l,f)=>{this._collection.findOneAndUpdate(a,c,u).then(h=>{l(h)}).catch(h=>{if(h&&h.code===11e3){let d=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},o),m={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},o)};this._collection.findOneAndUpdate(d,m,u).then(w=>{l(w)}).catch(w=>{w&&w.code===11e3?this._upsert(e,t,n,i).then(b=>l(b)).catch(b=>f(b)):f(w)})}else f(h)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(i)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e},n);return this._collection.deleteOne(i).then(s=>s.deletedCount>0)}};GW.exports=l2});var YW=B((x0t,WW)=>{var Z5e=S0(),J5e=Fi(),dx=class extends Z5e{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,i)=>{if(n)return t(n);e(i)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,i=>{if(i)return this._releaseConnection(n),t(i);n.query(this._getCreateTableStmt(),s=>{if(s)return this._releaseConnection(n),t(s);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:Boolean(e)}_getRateLimiterRes(e,t,n){let i=new J5e,[s]=n;return i.isFirstInDuration=t===s.points,i.consumedPoints=i.isFirstInDuration?t:s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,i}_upsertTransaction(e,t,n,i,s){return new Promise((o,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);let u=Date.now(),l=i>0?u+i:null,f,h;s?(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,h=[this.dbName,this.tableName,t,n,l,n,l]):(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,h=[this.dbName,this.tableName,t,n,l,u,n,n,u,l]),e.query(f,h,d=>{if(d)return e.rollback(),a(d);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(m,w)=>{if(m)return e.rollback(),a(m);e.query("COMMIT",b=>{if(b)return e.rollback(),a(b);o(w)})})})})})}_upsert(e,t,n,i=!1){return this.tableCreated?new Promise((s,o)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,i).then(c=>{s(c),this._releaseConnection(a)}).catch(c=>{o(c),this._releaseConnection(a)})}).catch(a=>{o(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(s,o)=>{s?n(s):o.length===0?t(null):t(o),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(s,o)=>{s?n(s):t(o.affectedRows>0),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}};WW.exports=dx});var XW=B((T0t,QW)=>{var e4e=S0(),t4e=Fi(),hx=class extends e4e{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{let n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){let t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:Boolean(e)}_getRateLimiterRes(e,t,n){let i=new t4e,s=n.rows[0];return i.isFirstInDuration=t===s.points,i.consumedPoints=i.isFirstInDuration?t:s.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,i}_query(e){let n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((i,s)=>{this._getConnection().then(o=>{o.query(n).then(a=>{i(a),this._releaseConnection(o)}).catch(a=>{s(a),this._releaseConnection(o)})}).catch(o=>{s(o)})})}_upsert(e,t,n,i=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let s=n>0?Date.now()+n:null,o=i?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:i?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${i?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${o}
            RETURNING points, expire;`,values:[e,t,s,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(i=>{i.rowCount===0&&(i=null),t(i)}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};QW.exports=hx});var ZW=B(()=>{});var eY=B((C0t,JW)=>{JW.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}});var rY=B((k0t,tY)=>{var r4e=eY(),px=Fi();tY.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){let i=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return i!==0?(this._storage[e].value=this._storage[e].value+t,new px(0,i,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let i=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new r4e(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new px(0,i===0?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){let t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new px(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}}});var gx=B((D0t,iY)=>{var n4e=u2(),i4e=rY(),nY=Fi(),mx=class extends n4e{constructor(e={}){super(e),this._memoryStorage=new i4e}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=this.getKey(e),a=this._getKeySecDuration(n),c=this._memoryStorage.incrby(o,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(o,c.consumedPoints,this.blockDuration)),s(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(i,u,c)}else i(c)})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise(s=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),s(a)})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise(s=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,-t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),s(a)})}block(e,t){let n=t*1e3,i=this.points+1;return this._memoryStorage.set(this.getKey(e),i,t),Promise.resolve(new nY(0,n===0?-1:n,i))}set(e,t,n){let i=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new nY(0,i===0?-1:i,t))}get(e){let t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};iY.exports=mx});var fY=B((N0t,lY)=>{var sY=ZW(),s4e=$c(),o4e=u2(),aY=gx(),a4e=Fi(),gs="rate_limiter_flexible",A0=null,oY=function(r,e,t,n){let i;n===null||n===!0||n===!1?i=n:i={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:gs,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:i})},cY=function(r){setTimeout(()=>{this._initiated?process.send(r):typeof this._promises[r.promiseId]<"u"&&cY.call(this,r)},30)},x0=function(r,e,t,n,i){let s={channel:gs,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:i}};this._initiated?process.send(s):cY.call(this,s)},uY=function(r,e){if(!e||e.channel!==gs||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{oY(r,e,"resolve",n)}).catch(n=>{oY(r,e,"reject",n)})},c4e=function(r){if(!r||r.channel!==gs||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new a4e(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},u4e=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},T0=function(r,e){let t=process.hrtime(),n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=s4e.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n},yx=class{constructor(){if(A0)return A0;this._rateLimiters={},sY.setMaxListeners(0),sY.on("message",(e,t)=>{t&&t.channel===gs&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new aY(t.opts)),e.send({channel:gs,type:"init",keyPrefix:t.opts.keyPrefix})):uY.call(this,e,t)}),A0=this}},wx=class{constructor(e){if(A0)return A0;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",i=>{let s=i.raw;if(s&&s.channel===gs&&s.type==="init")typeof this._rateLimiters[s.opts.keyPrefix]>"u"&&(this._rateLimiters[s.opts.keyPrefix]=new aY(s.opts)),e.sendDataToProcessId(i.process.pm_id,{data:{},topic:gs,channel:gs,type:"init",keyPrefix:s.opts.keyPrefix},(o,a)=>{o&&console.log(o,a)});else{let o={send:a=>{let c=a;c.topic=gs,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(i.process.pm_id,c,(u,l)=>{u&&console.log(u,l)})}};uY.call(this,o,s)}})}),A0=this}},bx=class extends o4e{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",t=>{t&&t.channel===gs&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:c4e.call(this,t)}),process.send({channel:gs,type:"init",opts:u4e.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((i,s)=>{let o=T0.call(this,i,s);x0.call(this,"consume",o,e,t,n)})}penalty(e,t=1,n={}){return new Promise((i,s)=>{let o=T0.call(this,i,s);x0.call(this,"penalty",o,e,t,n)})}reward(e,t=1,n={}){return new Promise((i,s)=>{let o=T0.call(this,i,s);x0.call(this,"reward",o,e,t,n)})}block(e,t,n={}){return new Promise((i,s)=>{let o=T0.call(this,i,s);x0.call(this,"block",o,e,t,n)})}get(e,t={}){return new Promise((n,i)=>{let s=T0.call(this,n,i);x0.call(this,"get",s,e,t)})}delete(e,t={}){return new Promise((n,i)=>{let s=T0.call(this,n,i);x0.call(this,"delete",s,e,t)})}};lY.exports={RateLimiterClusterMaster:yx,RateLimiterClusterMasterPM2:wx,RateLimiterCluster:bx}});var hY=B((O0t,dY)=>{var l4e=S0(),f4e=Fi(),_x=class extends l4e{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){let i=new f4e;return i.consumedPoints=parseInt(n.consumedPoints),i.isFirstInDuration=n.consumedPoints===t,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=n.msBeforeNext,i}_upsert(e,t,n,i=!1,s={}){return new Promise((o,a)=>{let c=Date.now(),u=Math.floor(n/1e3);i?this.client.set(e,t,u,l=>{l?a(l):this.client.set(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let f={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(f)})}):this.client.incr(e,t,(l,f)=>{l||f===!1?this.client.add(e,t,u,(h,d)=>{if(h||!d)if(typeof s.attemptNumber>"u"||s.attemptNumber<3){let m=Object.assign({},s);m.attemptNumber=m.attemptNumber?m.attemptNumber+1:1,this._upsert(e,t,n,i,m).then(w=>o(w)).catch(w=>a(w))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let m={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(m)})}):this.client.get(`${e}_expire`,(h,d)=>{if(h)a(h);else{let m=d===!1?0:d,w={consumedPoints:f,msBeforeNext:m>=0?Math.max(m-c,0):-1};o(w)}})})})}_get(e){return new Promise((t,n)=>{let i=Date.now();this.client.get(e,(s,o)=>{o?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{let u=c===!1?0:c,l={consumedPoints:o,msBeforeNext:u>=0?Math.max(u-i,0):-1};t(l)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,s)=>{i?n(i):s===!1?t(s):this.client.del(`${e}_expire`,o=>{o?n(o):t(s)})})})}};dY.exports=_x});var gY=B((B0t,mY)=>{var pY=Fi();mY.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new pY(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new pY(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}});var wY=B((U0t,yY)=>{var d4e=u2();yY.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof d4e))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,i)=>{let s=[];this._limiters.forEach(o=>{s.push(o.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(s).then(o=>{let a={},c=!1;o.forEach(u=>{u.rejected===!0&&(c=!0)});for(let u=0;u<o.length;u++)c&&o[u].rejected===!0?a[this._limiters[u].keyPrefix]=o[u].rej:c||(a[this._limiters[u].keyPrefix]=o[u]);c?i(a):n(a)})})}}});var _Y=B((V0t,bY)=>{bY.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}});var xY=B((K0t,SY)=>{var EY=_Y(),vY=4294967295,Ex="limiter";SY.exports=class{constructor(e,t={maxQueueSize:vY}){this._queueLimiters={KEY_DEFAULT:new A6(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=Ex){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=Ex){return this._queueLimiters[t]||(this._queueLimiters[t]=new A6(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};var A6=class{constructor(e,t={maxQueueSize:vY,key:Ex}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){let t=this;return new Promise((n,i)=>{if(e>t._limiterFlexible.points){i(new EY(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,i,e):t._limiterFlexible.consume(t._key,e).then(s=>{n(s.remainingPoints)}).catch(s=>{s instanceof Error?i(s):(t._queueRequest.call(t,n,i,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),s.msBeforeNext)))})})}_queueRequest(e,t,n){let i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:n}):t(new EY(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){let e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;let t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}});var AY=B(($0t,TY)=>{var vx=Fi();TY.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new vx(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(i=>i instanceof vx?this._burstLimiter.consume(e,t,n).then(s=>Promise.resolve(this._combineRes(i,s))).catch(s=>s instanceof vx?Promise.reject(this._combineRes(i,s)):Promise.reject(s)):Promise.reject(i))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}}});var Sx=B((q0t,IY)=>{var h4e=$W(),p4e=jW(),m4e=YW(),g4e=XW(),{RateLimiterClusterMaster:y4e,RateLimiterClusterMasterPM2:w4e,RateLimiterCluster:b4e}=fY(),_4e=gx(),E4e=hY(),v4e=gY(),S4e=wY(),x4e=xY(),T4e=AY(),A4e=Fi();IY.exports={RateLimiterRedis:h4e,RateLimiterMongo:p4e,RateLimiterMySQL:m4e,RateLimiterPostgres:g4e,RateLimiterMemory:_4e,RateLimiterMemcache:E4e,RateLimiterClusterMaster:y4e,RateLimiterClusterMasterPM2:w4e,RateLimiterCluster:b4e,RLWrapperBlackAndWhite:v4e,RateLimiterUnion:S4e,RateLimiterQueue:x4e,BurstyRateLimiter:T4e,RateLimiterRes:A4e}});var zY=B(h2=>{(function(){var r,e,t,n,i,s,o,a;a=function(c){var u,l,f,h;return u=(c&255<<24)>>>24,l=(c&255<<16)>>>16,f=(c&255<<8)>>>8,h=c&255,[u,l,f,h].join(".")},o=function(c){var u,l,f,h,d,m;for(u=[],f=h=0;h<=3&&c.length!==0;f=++h){if(f>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}m=e(c),d=m[0],l=m[1],c=c.substring(l),u.push(d)}if(c.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var u,l,f,h,d;for(h=0,u=10,l="9",f=0,c.length>1&&c[f]==="0"&&(c[f+1]==="x"||c[f+1]==="X"?(f+=2,u=16):"0"<=c[f+1]&&c[f+1]<="9"&&(f++,u=8,l="7")),d=f;f<c.length;){if("0"<=c[f]&&c[f]<=l)h=h*u+(t(c[f])-n)>>>0;else if(u===16)if("a"<=c[f]&&c[f]<="f")h=h*u+(10+t(c[f])-s)>>>0;else if("A"<=c[f]&&c[f]<="F")h=h*u+(10+t(c[f])-i)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");f++}if(f===d)throw new Error("empty octet");return[h,f]},r=function(){function c(u,l){var f,h,d,m;if(typeof u!="string")throw new Error("Missing `net' parameter");if(l||(m=u.split("/",2),u=m[0],l=m[1]),l||(l=32),typeof l=="string"&&l.indexOf(".")>-1){try{this.maskLong=o(l)}catch(w){throw f=w,new Error("Invalid mask: "+l)}for(h=d=32;d>=0;h=--d)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(l||l===0)this.bitmask=parseInt(l,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(u)&this.maskLong)>>>0}catch(w){throw f=w,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+l);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new c(u)),u instanceof c?this.contains(u.base)&&this.contains(u.broadcast||u.last):(o(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(u){return u==null&&(u=1),new c(a(this.netLong+this.size*u),this.mask)},c.prototype.forEach=function(u){var l,f,h;for(h=o(this.first),f=o(this.last),l=0;h<=f;)u(a(h),h,l),l++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),h2.ip2long=o,h2.long2ip=a,h2.Netmask=r}).call(h2)});var qY=B(($Y,M6)=>{(function(r){"use strict";let e="(0?\\d+|0x[a-f0-9]+)",t={fourOctet:new RegExp(`^${e}\\.${e}\\.${e}\\.${e}$`,"i"),threeOctet:new RegExp(`^${e}\\.${e}\\.${e}$`,"i"),twoOctet:new RegExp(`^${e}\\.${e}$`,"i"),longValue:new RegExp(`^${e}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),s="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(s,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${s})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${e}\\.${e}\\.${e}\\.${e}(${s})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${e}\\.${e}\\.${e}\\.${e}(${s})?$`,"i")};function c(d,m){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let w=0,b=-1,v=(d.match(a.zoneIndex)||[])[0],T,p;for(v&&(v=v.substring(1),d=d.replace(/%.+$/,""));(b=d.indexOf(":",b+1))>=0;)w++;if(d.substr(0,2)==="::"&&w--,d.substr(-2,2)==="::"&&w--,w>m)return null;for(p=m-w,T=":";p--;)T+="0:";return d=d.replace("::",T),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),m=function(){let g=d.split(":"),y=[];for(let E=0;E<g.length;E++)y.push(parseInt(g[E],16));return y}(),{parts:m,zoneId:v}}function u(d,m,w,b){if(d.length!==m.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let v=0,T;for(;b>0;){if(T=w-b,T<0&&(T=0),d[v]>>T!==m[v]>>T)return!1;b-=w,v+=1}return!0}function l(d){if(i.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(n.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function f(d,m){for(;d.length<m;)d=`0${d}`;return d}let h={};h.IPv4=function(){function d(m){if(m.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let w,b;for(w=0;w<m.length;w++)if(b=m[w],!(0<=b&&b<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=m}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(m,w){let b;if(w===void 0&&(b=m,m=b[0],w=b[1]),m.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,m.octets,8,w)},d.prototype.prefixLengthFromSubnetMask=function(){let m=0,w=!1,b={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},v,T,p;for(v=3;v>=0;v-=1)if(T=this.octets[v],T in b){if(p=b[T],w&&p!==0)return null;p!==8&&(w=!0),m+=p}else return null;return 32-m},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),h.IPv4.broadcastAddressFromCIDR=function(d){try{let m=this.parseCIDR(d),w=m[0].toByteArray(),b=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),v=[],T=0;for(;T<4;)v.push(parseInt(w[T],10)|parseInt(b[T],10)^255),T++;return new this(v)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(d){return this.parser(d)!==null},h.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},h.IPv4.isValidFourPartDecimal=function(d){return!!(h.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(d){let m,w,b,v,T;try{for(m=this.parseCIDR(d),b=m[0].toByteArray(),T=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),v=[],w=0;w<4;)v.push(parseInt(b[w],10)&parseInt(T[w],10)),w++;return new this(v)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(d){let m=this.parser(d);if(m===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(m)},h.IPv4.parseCIDR=function(d){let m;if(m=d.match(/^(.+)\/(\d+)$/)){let w=parseInt(m[2]);if(w>=0&&w<=32){let b=[this.parse(m[1]),w];return Object.defineProperty(b,"toString",{value:function(){return this.join("/")}}),b}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(d){let m,w,b;if(m=d.match(t.fourOctet))return function(){let v=m.slice(1,6),T=[];for(let p=0;p<v.length;p++)w=v[p],T.push(l(w));return T}();if(m=d.match(t.longValue)){if(b=l(m[1]),b>4294967295||b<0)throw new Error("ipaddr: address outside defined range");return function(){let v=[],T;for(T=0;T<=24;T+=8)v.push(b>>T&255);return v}().reverse()}else return(m=d.match(t.twoOctet))?function(){let v=m.slice(1,4),T=[];if(b=l(v[1]),b>16777215||b<0)throw new Error("ipaddr: address outside defined range");return T.push(l(v[0])),T.push(b>>16&255),T.push(b>>8&255),T.push(b&255),T}():(m=d.match(t.threeOctet))?function(){let v=m.slice(1,5),T=[];if(b=l(v[2]),b>65535||b<0)throw new Error("ipaddr: address outside defined range");return T.push(l(v[0])),T.push(l(v[1])),T.push(b>>8&255),T.push(b&255),T}():null},h.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");let m=[0,0,0,0],w=0,b=Math.floor(d/8);for(;w<b;)m[w]=255,w++;return b<4&&(m[b]=Math.pow(2,d%8)-1<<8-d%8),new this(m)},h.IPv6=function(){function d(m,w){let b,v;if(m.length===16)for(this.parts=[],b=0;b<=14;b+=2)this.parts.push(m[b]<<8|m[b+1]);else if(m.length===8)this.parts=m;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(b=0;b<this.parts.length;b++)if(v=this.parts[b],!(0<=v&&v<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");w&&(this.zoneId=w)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],reserved:[[new d([8193,3512,0,0,0,0,0,0]),32]]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(m,w){let b;if(w===void 0&&(b=m,m=b[0],w=b[1]),m.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,m.parts,16,w)},d.prototype.prefixLengthFromSubnetMask=function(){let m=0,w=!1,b={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},v,T;for(let p=7;p>=0;p-=1)if(v=this.parts[p],v in b){if(T=b[v],w&&T!==0)return null;T!==16&&(w=!0),m+=T}else return null;return 128-m},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let m,w=[],b=this.parts;for(let v=0;v<b.length;v++)m=b[v],w.push(m>>8),w.push(m&255);return w},d.prototype.toFixedLengthString=function(){let m=function(){let b=[];for(let v=0;v<this.parts.length;v++)b.push(f(this.parts[v].toString(16),4));return b}.call(this).join(":"),w="";return this.zoneId&&(w=`%${this.zoneId}`),m+w},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let m=this.parts.slice(-2),w=m[0],b=m[1];return new h.IPv4([w>>8,w&255,b>>8,b&255])},d.prototype.toNormalizedString=function(){let m=function(){let b=[];for(let v=0;v<this.parts.length;v++)b.push(this.parts[v].toString(16));return b}.call(this).join(":"),w="";return this.zoneId&&(w=`%${this.zoneId}`),m+w},d.prototype.toRFC5952String=function(){let m=/((^|:)(0(:|$)){2,})/g,w=this.toNormalizedString(),b=0,v=-1,T;for(;T=m.exec(w);)T[0].length>v&&(b=T.index,v=T[0].length);return v<0?w:`${w.substring(0,b)}::${w.substring(b+v)}`},d.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},d}(),h.IPv6.broadcastAddressFromCIDR=function(d){try{let m=this.parseCIDR(d),w=m[0].toByteArray(),b=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),v=[],T=0;for(;T<16;)v.push(parseInt(w[T],10)|parseInt(b[T],10)^255),T++;return new this(v)}catch(m){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${m})`)}},h.IPv6.isIPv6=function(d){return this.parser(d)!==null},h.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{let m=this.parser(d);return new this(m.parts,m.zoneId),!0}catch{return!1}},h.IPv6.networkAddressFromCIDR=function(d){let m,w,b,v,T;try{for(m=this.parseCIDR(d),b=m[0].toByteArray(),T=this.subnetMaskFromPrefixLength(m[1]).toByteArray(),v=[],w=0;w<16;)v.push(parseInt(b[w],10)&parseInt(T[w],10)),w++;return new this(v)}catch(p){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${p})`)}},h.IPv6.parse=function(d){let m=this.parser(d);if(m.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(m.parts,m.zoneId)},h.IPv6.parseCIDR=function(d){let m,w,b;if((w=d.match(/^(.+)\/(\d+)$/))&&(m=parseInt(w[2]),m>=0&&m<=128))return b=[this.parse(w[1]),m],Object.defineProperty(b,"toString",{value:function(){return this.join("/")}}),b;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(d){let m,w,b,v,T,p;if(b=d.match(a.deprecatedTransitional))return this.parser(`::ffff:${b[1]}`);if(a.native.test(d))return c(d,8);if((b=d.match(a.transitional))&&(p=b[6]||"",m=c(b[1].slice(0,-1)+p,6),m.parts)){for(T=[parseInt(b[2]),parseInt(b[3]),parseInt(b[4]),parseInt(b[5])],w=0;w<T.length;w++)if(v=T[w],!(0<=v&&v<=255))return null;return m.parts.push(T[0]<<8|T[1]),m.parts.push(T[2]<<8|T[3]),{parts:m.parts,zoneId:m.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");let m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=0,b=Math.floor(d/8);for(;w<b;)m[w]=255,w++;return b<16&&(m[b]=Math.pow(2,d%8)-1<<8-d%8),new this(m)},h.fromByteArray=function(d){let m=d.length;if(m===4)return new h.IPv4(d);if(m===16)return new h.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(d){return h.IPv6.isValid(d)||h.IPv4.isValid(d)},h.parse=function(d){if(h.IPv6.isValid(d))return h.IPv6.parse(d);if(h.IPv4.isValid(d))return h.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(d){try{return h.IPv6.parseCIDR(d)}catch{try{return h.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(d){let m=this.parse(d);return m.kind()==="ipv6"&&m.isIPv4MappedAddress()?m.toIPv4Address():m},h.subnetMatch=function(d,m,w){let b,v,T,p;w==null&&(w="unicast");for(v in m)if(Object.prototype.hasOwnProperty.call(m,v)){for(T=m[v],T[0]&&!(T[0]instanceof Array)&&(T=[T]),b=0;b<T.length;b++)if(p=T[b],d.kind()===p[0].kind()&&d.match.apply(d,p))return v}return w},typeof M6<"u"&&M6.exports?M6.exports=h:r.ipaddr=h})($Y)});var ZY=B(($1t,XY)=>{"use strict";function K4e(r){return r>=55296&&r<=56319}function H4e(r){return r>=56320&&r<=57343}XY.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],K4e(o)&&H4e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t}});var eQ=B((q1t,JY)=>{"use strict";function $4e(r){return r>=55296&&r<=56319}function q4e(r){return r>=56320&&r<=57343}JY.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),q4e(i)?s!=null&&$4e(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n}});var rQ=B((G1t,tQ)=>{"use strict";var G4e=ZY(),j4e=eQ();tQ.exports=G4e.bind(null,j4e)});var sQ=B((j1t,iQ)=>{"use strict";var W4e=rQ(),Y4e=/[\/\?<>\\:\*\|"]/g,Q4e=/[\x00-\x1f\x80-\x9f]/g,X4e=/^\.+$/,Z4e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,J4e=/[\. ]+$/;function nQ(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(Y4e,e).replace(Q4e,e).replace(X4e,e).replace(Z4e,e).replace(J4e,e);return W4e(t,255)}iQ.exports=function(r,e){var t=e&&e.replacement||"",n=nQ(r,t);return t===""?n:nQ(n,"")}});var uQ=B((W1t,cQ)=>{var R0=it();Kc();Jt();var pe=R0.asn1,C0=cQ.exports=R0.pkcs7asn1=R0.pkcs7asn1||{};R0.pkcs7=R0.pkcs7||{};R0.pkcs7.asn1=C0;var oQ={name:"ContentInfo",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:pe.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};C0.contentInfoValidator=oQ;var aQ={name:"EncryptedContentInfo",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:pe.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:pe.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};C0.envelopedDataValidator={name:"EnvelopedData",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(aQ)};C0.encryptedDataValidator={name:"EncryptedData",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"version"}].concat(aQ)};var e6e={name:"SignerInfo",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:pe.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:pe.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:pe.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};C0.signedDataValidator={name:"SignedData",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},oQ,{name:"SignedData.Certificates",tagClass:pe.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:pe.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SET,capture:"signerInfos",optional:!0,value:[e6e]}]};C0.recipientInfoValidator={name:"RecipientInfo",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:pe.Class.UNIVERSAL,type:pe.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:pe.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:pe.Class.UNIVERSAL,type:pe.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}});var fQ=B((Y1t,lQ)=>{var Uf=it();Jt();Uf.mgf=Uf.mgf||{};var t6e=lQ.exports=Uf.mgf.mgf1=Uf.mgf1=Uf.mgf1||{};t6e.create=function(r){var e={generate:function(t,n){for(var i=new Uf.util.ByteBuffer,s=Math.ceil(n/r.digestLength),o=0;o<s;o++){var a=new Uf.util.ByteBuffer;a.putInt32(o),r.start(),r.update(t+a.getBytes()),i.putBuffer(r.digest())}return i.truncate(i.length()-n),i.getBytes()}};return e}});var hQ=B((Q1t,dQ)=>{var z6=it();fQ();dQ.exports=z6.mgf=z6.mgf||{};z6.mgf.mgf1=z6.mgf1});var mQ=B((X1t,pQ)=>{var Ff=it();_l();Jt();var r6e=pQ.exports=Ff.pss=Ff.pss||{};r6e.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=r.md,t=r.mgf,n=e.digestLength,i=r.salt||null;typeof i=="string"&&(i=Ff.util.createBuffer(i));var s;if("saltLength"in r)s=r.saltLength;else if(i!==null)s=i.length();else throw new Error("Salt length not specified or specific salt not given.");if(i!==null&&i.length()!==s)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||Ff.random,a={};return a.encode=function(c,u){var l,f=u-1,h=Math.ceil(f/8),d=c.digest().getBytes();if(h<n+s+2)throw new Error("Message is too long to encrypt.");var m;i===null?m=o.getBytesSync(s):m=i.bytes();var w=new Ff.util.ByteBuffer;w.fillWithByte(0,8),w.putBytes(d),w.putBytes(m),e.start(),e.update(w.getBytes());var b=e.digest().getBytes(),v=new Ff.util.ByteBuffer;v.fillWithByte(0,h-s-n-2),v.putByte(1),v.putBytes(m);var T=v.getBytes(),p=h-n-1,g=t.generate(b,p),y="";for(l=0;l<p;l++)y+=String.fromCharCode(T.charCodeAt(l)^g.charCodeAt(l));var E=65280>>8*h-f&255;return y=String.fromCharCode(y.charCodeAt(0)&~E)+y.substr(1),y+b+String.fromCharCode(188)},a.verify=function(c,u,l){var f,h=l-1,d=Math.ceil(h/8);if(u=u.substr(-d),d<n+s+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(d-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var m=d-n-1,w=u.substr(0,m),b=u.substr(m,n),v=65280>>8*d-h&255;if(w.charCodeAt(0)&v)throw new Error("Bits beyond keysize not zero as expected.");var T=t.generate(b,m),p="";for(f=0;f<m;f++)p+=String.fromCharCode(w.charCodeAt(f)^T.charCodeAt(f));p=String.fromCharCode(p.charCodeAt(0)&~v)+p.substr(1);var g=d-n-s-2;for(f=0;f<g;f++)if(p.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(p.charCodeAt(g)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var y=p.substr(-s),E=new Ff.util.ByteBuffer;E.fillWithByte(0,8),E.putBytes(c),E.putBytes(y),e.start(),e.update(E.getBytes());var _=e.digest().getBytes();return b===_},a}});var Nx=B((Z1t,_Q)=>{var Ie=it();Hd();Kc();O3();Hc();hQ();Vd();U3();mQ();Wp();Jt();var A=Ie.asn1,ce=_Q.exports=Ie.pki=Ie.pki||{},St=ce.oids,Pr={};Pr.CN=St.commonName;Pr.commonName="CN";Pr.C=St.countryName;Pr.countryName="C";Pr.L=St.localityName;Pr.localityName="L";Pr.ST=St.stateOrProvinceName;Pr.stateOrProvinceName="ST";Pr.O=St.organizationName;Pr.organizationName="O";Pr.OU=St.organizationalUnitName;Pr.organizationalUnitName="OU";Pr.E=St.emailAddress;Pr.emailAddress="E";var yQ=Ie.pki.rsa.publicKeyValidator,n6e={name:"Certificate",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:A.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:A.Class.UNIVERSAL,type:A.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:A.Class.UNIVERSAL,type:A.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:A.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:A.Class.UNIVERSAL,type:A.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:A.Class.UNIVERSAL,type:A.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:A.Class.UNIVERSAL,type:A.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:A.Class.UNIVERSAL,type:A.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},yQ,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:A.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:A.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:A.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:A.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},i6e={name:"rsapss",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:A.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:A.Class.UNIVERSAL,type:A.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:A.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:A.Class.UNIVERSAL,type:A.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:A.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:A.Class.UNIVERSAL,type:A.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:A.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:A.Class.UNIVERSAL,type:A.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},s6e={name:"CertificationRequestInfo",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:A.Class.UNIVERSAL,type:A.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},yQ,{name:"CertificationRequestInfo.attributes",tagClass:A.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:A.Class.UNIVERSAL,type:A.Type.SET,constructed:!0}]}]}]},o6e={name:"CertificationRequest",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[s6e,{name:"CertificationRequest.signatureAlgorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:A.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};ce.RDNAttributesAsArray=function(r,e){for(var t=[],n,i,s,o=0;o<r.value.length;++o){n=r.value[o];for(var a=0;a<n.value.length;++a)s={},i=n.value[a],s.type=A.derToOid(i.value[0].value),s.value=i.value[1].value,s.valueTagClass=i.value[1].type,s.type in St&&(s.name=St[s.type],s.name in Pr&&(s.shortName=Pr[s.name])),e&&(e.update(s.type),e.update(s.value)),t.push(s)}return t};ce.CRIAttributesAsArray=function(r){for(var e=[],t=0;t<r.length;++t)for(var n=r[t],i=A.derToOid(n.value[0].value),s=n.value[1].value,o=0;o<s.length;++o){var a={};if(a.type=i,a.value=s[o].value,a.valueTagClass=s[o].type,a.type in St&&(a.name=St[a.type],a.name in Pr&&(a.shortName=Pr[a.name])),a.type===St.extensionRequest){a.extensions=[];for(var c=0;c<a.value.length;++c)a.extensions.push(ce.certificateExtensionFromAsn1(a.value[c]))}e.push(a)}return e};function Yu(r,e){typeof e=="string"&&(e={shortName:e});for(var t=null,n,i=0;t===null&&i<r.attributes.length;++i)n=r.attributes[i],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(t=n);return t}var K6=function(r,e,t){var n={};if(r!==St["RSASSA-PSS"])return n;t&&(n={hash:{algorithmOid:St.sha1},mgf:{algorithmOid:St.mgf1,hash:{algorithmOid:St.sha1}},saltLength:20});var i={},s=[];if(!A.validate(e,i6e,i,s)){var o=new Error("Cannot read RSASSA-PSS parameter block.");throw o.errors=s,o}return i.hashOid!==void 0&&(n.hash=n.hash||{},n.hash.algorithmOid=A.derToOid(i.hashOid)),i.maskGenOid!==void 0&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=A.derToOid(i.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=A.derToOid(i.maskGenHashOid)),i.saltLength!==void 0&&(n.saltLength=i.saltLength.charCodeAt(0)),n},H6=function(r){switch(St[r.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Ie.md.sha1.create();case"md5WithRSAEncryption":return Ie.md.md5.create();case"sha256WithRSAEncryption":return Ie.md.sha256.create();case"sha384WithRSAEncryption":return Ie.md.sha384.create();case"sha512WithRSAEncryption":return Ie.md.sha512.create();case"RSASSA-PSS":return Ie.md.sha256.create();default:var e=new Error("Could not compute "+r.type+" digest. Unknown signature OID.");throw e.signatureOid=r.signatureOid,e}},wQ=function(r){var e=r.certificate,t;switch(e.signatureOid){case St.sha1WithRSAEncryption:case St.sha1WithRSASignature:break;case St["RSASSA-PSS"]:var n,i;if(n=St[e.signatureParameters.mgf.hash.algorithmOid],n===void 0||Ie.md[n]===void 0){var s=new Error("Unsupported MGF hash function.");throw s.oid=e.signatureParameters.mgf.hash.algorithmOid,s.name=n,s}if(i=St[e.signatureParameters.mgf.algorithmOid],i===void 0||Ie.mgf[i]===void 0){var s=new Error("Unsupported MGF function.");throw s.oid=e.signatureParameters.mgf.algorithmOid,s.name=i,s}if(i=Ie.mgf[i].create(Ie.md[n].create()),n=St[e.signatureParameters.hash.algorithmOid],n===void 0||Ie.md[n]===void 0){var s=new Error("Unsupported RSASSA-PSS hash function.");throw s.oid=e.signatureParameters.hash.algorithmOid,s.name=n,s}t=Ie.pss.create(Ie.md[n].create(),i,e.signatureParameters.saltLength);break}return e.publicKey.verify(r.md.digest().getBytes(),r.signature,t)};ce.certificateFromPem=function(r,e,t){var n=Ie.pem.decode(r)[0];if(n.type!=="CERTIFICATE"&&n.type!=="X509 CERTIFICATE"&&n.type!=="TRUSTED CERTIFICATE"){var i=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var s=A.fromDer(n.body,t);return ce.certificateFromAsn1(s,e)};ce.certificateToPem=function(r,e){var t={type:"CERTIFICATE",body:A.toDer(ce.certificateToAsn1(r)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ce.publicKeyFromPem=function(r){var e=Ie.pem.decode(r)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=A.fromDer(e.body);return ce.publicKeyFromAsn1(n)};ce.publicKeyToPem=function(r,e){var t={type:"PUBLIC KEY",body:A.toDer(ce.publicKeyToAsn1(r)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ce.publicKeyToRSAPublicKeyPem=function(r,e){var t={type:"RSA PUBLIC KEY",body:A.toDer(ce.publicKeyToRSAPublicKey(r)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ce.getPublicKeyFingerprint=function(r,e){e=e||{};var t=e.md||Ie.md.sha1.create(),n=e.type||"RSAPublicKey",i;switch(n){case"RSAPublicKey":i=A.toDer(ce.publicKeyToRSAPublicKey(r)).getBytes();break;case"SubjectPublicKeyInfo":i=A.toDer(ce.publicKeyToAsn1(r)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(i);var s=t.digest();if(e.encoding==="hex"){var o=s.toHex();return e.delimiter?o.match(/.{2}/g).join(e.delimiter):o}else{if(e.encoding==="binary")return s.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return s};ce.certificationRequestFromPem=function(r,e,t){var n=Ie.pem.decode(r)[0];if(n.type!=="CERTIFICATE REQUEST"){var i=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var s=A.fromDer(n.body,t);return ce.certificationRequestFromAsn1(s,e)};ce.certificationRequestToPem=function(r,e){var t={type:"CERTIFICATE REQUEST",body:A.toDer(ce.certificationRequestToAsn1(r)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ce.createCertificate=function(){var r={};return r.version=2,r.serialNumber="00",r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.validity={},r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.issuer={},r.issuer.getField=function(e){return Yu(r.issuer,e)},r.issuer.addField=function(e){bs([e]),r.issuer.attributes.push(e)},r.issuer.attributes=[],r.issuer.hash=null,r.subject={},r.subject.getField=function(e){return Yu(r.subject,e)},r.subject.addField=function(e){bs([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.extensions=[],r.publicKey=null,r.md=null,r.setSubject=function(e,t){bs(e),r.subject.attributes=e,delete r.subject.uniqueId,t&&(r.subject.uniqueId=t),r.subject.hash=null},r.setIssuer=function(e,t){bs(e),r.issuer.attributes=e,delete r.issuer.uniqueId,t&&(r.issuer.uniqueId=t),r.issuer.hash=null},r.setExtensions=function(e){for(var t=0;t<e.length;++t)bQ(e[t],{cert:r});r.extensions=e},r.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,n,i=0;t===null&&i<r.extensions.length;++i)n=r.extensions[i],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(t=n);return t},r.sign=function(e,t){r.md=t||Ie.md.sha1.create();var n=St[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.tbsCertificate=ce.getTBSCertificate(r);var s=A.toDer(r.tbsCertificate);r.md.update(s.getBytes()),r.signature=e.sign(r.md)},r.verify=function(e){var t=!1;if(!r.issued(e)){var n=e.issuer,i=r.subject,s=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw s.expectedIssuer=i.attributes,s.actualIssuer=n.attributes,s}var o=e.md;if(o===null){o=H6({signatureOid:e.signatureOid,type:"certificate"});var a=e.tbsCertificate||ce.getTBSCertificate(e),c=A.toDer(a);o.update(c.getBytes())}return o!==null&&(t=wQ({certificate:r,md:o,signature:e.signature})),t},r.isIssuer=function(e){var t=!1,n=r.issuer,i=e.subject;if(n.hash&&i.hash)t=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){t=!0;for(var s,o,a=0;t&&a<n.attributes.length;++a)s=n.attributes[a],o=i.attributes[a],(s.type!==o.type||s.value!==o.value)&&(t=!1)}return t},r.issued=function(e){return e.isIssuer(r)},r.generateSubjectKeyIdentifier=function(){return ce.getPublicKeyFingerprint(r.publicKey,{type:"RSAPublicKey"})},r.verifySubjectKeyIdentifier=function(){for(var e=St.subjectKeyIdentifier,t=0;t<r.extensions.length;++t){var n=r.extensions[t];if(n.id===e){var i=r.generateSubjectKeyIdentifier().getBytes();return Ie.util.hexToBytes(n.subjectKeyIdentifier)===i}}return!1},r};ce.certificateFromAsn1=function(r,e){var t={},n=[];if(!A.validate(r,n6e,t,n)){var i=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw i.errors=n,i}var s=A.derToOid(t.publicKeyOid);if(s!==ce.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=ce.createCertificate();o.version=t.certVersion?t.certVersion.charCodeAt(0):0;var a=Ie.util.createBuffer(t.certSerialNumber);o.serialNumber=a.toHex(),o.signatureOid=Ie.asn1.derToOid(t.certSignatureOid),o.signatureParameters=K6(o.signatureOid,t.certSignatureParams,!0),o.siginfo.algorithmOid=Ie.asn1.derToOid(t.certinfoSignatureOid),o.siginfo.parameters=K6(o.siginfo.algorithmOid,t.certinfoSignatureParams,!1),o.signature=t.certSignature;var c=[];if(t.certValidity1UTCTime!==void 0&&c.push(A.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&c.push(A.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&c.push(A.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&c.push(A.generalizedTimeToDate(t.certValidity4GeneralizedTime)),c.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(c.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(o.validity.notBefore=c[0],o.validity.notAfter=c[1],o.tbsCertificate=t.tbsCertificate,e){o.md=H6({signatureOid:o.signatureOid,type:"certificate"});var u=A.toDer(o.tbsCertificate);o.md.update(u.getBytes())}var l=Ie.md.sha1.create(),f=A.toDer(t.certIssuer);l.update(f.getBytes()),o.issuer.getField=function(m){return Yu(o.issuer,m)},o.issuer.addField=function(m){bs([m]),o.issuer.attributes.push(m)},o.issuer.attributes=ce.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(o.issuer.uniqueId=t.certIssuerUniqueId),o.issuer.hash=l.digest().toHex();var h=Ie.md.sha1.create(),d=A.toDer(t.certSubject);return h.update(d.getBytes()),o.subject.getField=function(m){return Yu(o.subject,m)},o.subject.addField=function(m){bs([m]),o.subject.attributes.push(m)},o.subject.attributes=ce.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(o.subject.uniqueId=t.certSubjectUniqueId),o.subject.hash=h.digest().toHex(),t.certExtensions?o.extensions=ce.certificateExtensionsFromAsn1(t.certExtensions):o.extensions=[],o.publicKey=ce.publicKeyFromAsn1(t.subjectPublicKeyInfo),o};ce.certificateExtensionsFromAsn1=function(r){for(var e=[],t=0;t<r.value.length;++t)for(var n=r.value[t],i=0;i<n.value.length;++i)e.push(ce.certificateExtensionFromAsn1(n.value[i]));return e};ce.certificateExtensionFromAsn1=function(r){var e={};if(e.id=A.derToOid(r.value[0].value),e.critical=!1,r.value[1].type===A.Type.BOOLEAN?(e.critical=r.value[1].value.charCodeAt(0)!==0,e.value=r.value[2].value):e.value=r.value[1].value,e.id in St){if(e.name=St[e.id],e.name==="keyUsage"){var t=A.fromDer(e.value),n=0,i=0;t.value.length>1&&(n=t.value.charCodeAt(1),i=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(n&128)===128,e.nonRepudiation=(n&64)===64,e.keyEncipherment=(n&32)===32,e.dataEncipherment=(n&16)===16,e.keyAgreement=(n&8)===8,e.keyCertSign=(n&4)===4,e.cRLSign=(n&2)===2,e.encipherOnly=(n&1)===1,e.decipherOnly=(i&128)===128}else if(e.name==="basicConstraints"){var t=A.fromDer(e.value);t.value.length>0&&t.value[0].type===A.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var s=null;t.value.length>0&&t.value[0].type===A.Type.INTEGER?s=t.value[0].value:t.value.length>1&&(s=t.value[1].value),s!==null&&(e.pathLenConstraint=A.derToInteger(s))}else if(e.name==="extKeyUsage")for(var t=A.fromDer(e.value),o=0;o<t.value.length;++o){var a=A.derToOid(t.value[o].value);a in St?e[St[a]]=!0:e[a]=!0}else if(e.name==="nsCertType"){var t=A.fromDer(e.value),n=0;t.value.length>1&&(n=t.value.charCodeAt(1)),e.client=(n&128)===128,e.server=(n&64)===64,e.email=(n&32)===32,e.objsign=(n&16)===16,e.reserved=(n&8)===8,e.sslCA=(n&4)===4,e.emailCA=(n&2)===2,e.objCA=(n&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var c,t=A.fromDer(e.value),u=0;u<t.value.length;++u){c=t.value[u];var l={type:c.type,value:c.value};switch(e.altNames.push(l),c.type){case 1:case 2:case 6:break;case 7:l.ip=Ie.util.bytesToIP(c.value);break;case 8:l.oid=A.derToOid(c.value);break;default:}}}else if(e.name==="subjectKeyIdentifier"){var t=A.fromDer(e.value);e.subjectKeyIdentifier=Ie.util.bytesToHex(t.value)}}return e};ce.certificationRequestFromAsn1=function(r,e){var t={},n=[];if(!A.validate(r,o6e,t,n)){var i=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw i.errors=n,i}var s=A.derToOid(t.publicKeyOid);if(s!==ce.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=ce.createCertificationRequest();if(o.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,o.signatureOid=Ie.asn1.derToOid(t.csrSignatureOid),o.signatureParameters=K6(o.signatureOid,t.csrSignatureParams,!0),o.siginfo.algorithmOid=Ie.asn1.derToOid(t.csrSignatureOid),o.siginfo.parameters=K6(o.siginfo.algorithmOid,t.csrSignatureParams,!1),o.signature=t.csrSignature,o.certificationRequestInfo=t.certificationRequestInfo,e){o.md=H6({signatureOid:o.signatureOid,type:"certification request"});var a=A.toDer(o.certificationRequestInfo);o.md.update(a.getBytes())}var c=Ie.md.sha1.create();return o.subject.getField=function(u){return Yu(o.subject,u)},o.subject.addField=function(u){bs([u]),o.subject.attributes.push(u)},o.subject.attributes=ce.RDNAttributesAsArray(t.certificationRequestInfoSubject,c),o.subject.hash=c.digest().toHex(),o.publicKey=ce.publicKeyFromAsn1(t.subjectPublicKeyInfo),o.getAttribute=function(u){return Yu(o,u)},o.addAttribute=function(u){bs([u]),o.attributes.push(u)},o.attributes=ce.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),o};ce.createCertificationRequest=function(){var r={};return r.version=0,r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.subject={},r.subject.getField=function(e){return Yu(r.subject,e)},r.subject.addField=function(e){bs([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.publicKey=null,r.attributes=[],r.getAttribute=function(e){return Yu(r,e)},r.addAttribute=function(e){bs([e]),r.attributes.push(e)},r.md=null,r.setSubject=function(e){bs(e),r.subject.attributes=e,r.subject.hash=null},r.setAttributes=function(e){bs(e),r.attributes=e},r.sign=function(e,t){r.md=t||Ie.md.sha1.create();var n=St[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.certificationRequestInfo=ce.getCertificationRequestInfo(r);var s=A.toDer(r.certificationRequestInfo);r.md.update(s.getBytes()),r.signature=e.sign(r.md)},r.verify=function(){var e=!1,t=r.md;if(t===null){t=H6({signatureOid:r.signatureOid,type:"certification request"});var n=r.certificationRequestInfo||ce.getCertificationRequestInfo(r),i=A.toDer(n);t.update(i.getBytes())}return t!==null&&(e=wQ({certificate:r,md:t,signature:r.signature})),e},r};function P0(r){for(var e=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]),t,n,i=r.attributes,s=0;s<i.length;++s){t=i[s];var o=t.value,a=A.Type.PRINTABLESTRING;"valueTagClass"in t&&(a=t.valueTagClass,a===A.Type.UTF8&&(o=Ie.util.encodeUtf8(o))),n=A.create(A.Class.UNIVERSAL,A.Type.SET,!0,[A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(t.type).getBytes()),A.create(A.Class.UNIVERSAL,a,!1,o)])]),e.value.push(n)}return e}function bs(r){for(var e,t=0;t<r.length;++t){if(e=r[t],typeof e.name>"u"&&(e.type&&e.type in ce.oids?e.name=ce.oids[e.type]:e.shortName&&e.shortName in Pr&&(e.name=ce.oids[Pr[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in ce.oids)e.type=ce.oids[e.name];else{var n=new Error("Attribute type not specified.");throw n.attribute=e,n}if(typeof e.shortName>"u"&&e.name&&e.name in Pr&&(e.shortName=Pr[e.name]),e.type===St.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=A.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var i=0;i<e.extensions.length;++i)e.value.push(ce.certificateExtensionToAsn1(bQ(e.extensions[i])))}if(typeof e.value>"u"){var n=new Error("Attribute value not specified.");throw n.attribute=e,n}}}function bQ(r,e){if(e=e||{},typeof r.name>"u"&&r.id&&r.id in ce.oids&&(r.name=ce.oids[r.id]),typeof r.id>"u")if(r.name&&r.name in ce.oids)r.id=ce.oids[r.name];else{var t=new Error("Extension ID not specified.");throw t.extension=r,t}if(typeof r.value<"u")return r;if(r.name==="keyUsage"){var n=0,i=0,s=0;r.digitalSignature&&(i|=128,n=7),r.nonRepudiation&&(i|=64,n=6),r.keyEncipherment&&(i|=32,n=5),r.dataEncipherment&&(i|=16,n=4),r.keyAgreement&&(i|=8,n=3),r.keyCertSign&&(i|=4,n=2),r.cRLSign&&(i|=2,n=1),r.encipherOnly&&(i|=1,n=0),r.decipherOnly&&(s|=128,n=7);var o=String.fromCharCode(n);s!==0?o+=String.fromCharCode(i)+String.fromCharCode(s):i!==0&&(o+=String.fromCharCode(i)),r.value=A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,o)}else if(r.name==="basicConstraints")r.value=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]),r.cA&&r.value.value.push(A.create(A.Class.UNIVERSAL,A.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in r&&r.value.value.push(A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,A.integerToDer(r.pathLenConstraint).getBytes()));else if(r.name==="extKeyUsage"){r.value=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);var a=r.value.value;for(var c in r)r[c]===!0&&(c in St?a.push(A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(St[c]).getBytes())):c.indexOf(".")!==-1&&a.push(A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(c).getBytes())))}else if(r.name==="nsCertType"){var n=0,i=0;r.client&&(i|=128,n=7),r.server&&(i|=64,n=6),r.email&&(i|=32,n=5),r.objsign&&(i|=16,n=4),r.reserved&&(i|=8,n=3),r.sslCA&&(i|=4,n=2),r.emailCA&&(i|=2,n=1),r.objCA&&(i|=1,n=0);var o=String.fromCharCode(n);i!==0&&(o+=String.fromCharCode(i)),r.value=A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,o)}else if(r.name==="subjectAltName"||r.name==="issuerAltName"){r.value=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);for(var u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var o=u.value;if(u.type===7&&u.ip){if(o=Ie.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=A.oidToDer(A.oidToDer(u.oid)):o=A.oidToDer(o));r.value.value.push(A.create(A.Class.CONTEXT_SPECIFIC,u.type,!1,o))}}else if(r.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(r.comment)||r.comment.length<1||r.comment.length>128)throw new Error('Invalid "nsComment" content.');r.value=A.create(A.Class.UNIVERSAL,A.Type.IA5STRING,!1,r.comment)}else if(r.name==="subjectKeyIdentifier"&&e.cert){var f=e.cert.generateSubjectKeyIdentifier();r.subjectKeyIdentifier=f.toHex(),r.value=A.create(A.Class.UNIVERSAL,A.Type.OCTETSTRING,!1,f.getBytes())}else if(r.name==="authorityKeyIdentifier"&&e.cert){r.value=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);var a=r.value.value;if(r.keyIdentifier){var h=r.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():r.keyIdentifier;a.push(A.create(A.Class.CONTEXT_SPECIFIC,0,!1,h))}if(r.authorityCertIssuer){var d=[A.create(A.Class.CONTEXT_SPECIFIC,4,!0,[P0(r.authorityCertIssuer===!0?e.cert.issuer:r.authorityCertIssuer)])];a.push(A.create(A.Class.CONTEXT_SPECIFIC,1,!0,d))}if(r.serialNumber){var m=Ie.util.hexToBytes(r.serialNumber===!0?e.cert.serialNumber:r.serialNumber);a.push(A.create(A.Class.CONTEXT_SPECIFIC,2,!1,m))}}else if(r.name==="cRLDistributionPoints"){r.value=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);for(var a=r.value.value,w=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]),b=A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[]),u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var o=u.value;if(u.type===7&&u.ip){if(o=Ie.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=A.oidToDer(A.oidToDer(u.oid)):o=A.oidToDer(o));b.value.push(A.create(A.Class.CONTEXT_SPECIFIC,u.type,!1,o))}w.value.push(A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[b])),a.push(w)}if(typeof r.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=r,t}return r}function Dx(r,e){switch(r){case St["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(e.hash.algorithmOid).getBytes()),A.create(A.Class.UNIVERSAL,A.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(A.create(A.Class.CONTEXT_SPECIFIC,1,!0,[A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(e.mgf.algorithmOid).getBytes()),A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(e.mgf.hash.algorithmOid).getBytes()),A.create(A.Class.UNIVERSAL,A.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(A.create(A.Class.CONTEXT_SPECIFIC,2,!0,[A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,A.integerToDer(e.saltLength).getBytes())])),A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,t);default:return A.create(A.Class.UNIVERSAL,A.Type.NULL,!1,"")}}function a6e(r){var e=A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[]);if(r.attributes.length===0)return e;for(var t=r.attributes,n=0;n<t.length;++n){var i=t[n],s=i.value,o=A.Type.UTF8;"valueTagClass"in i&&(o=i.valueTagClass),o===A.Type.UTF8&&(s=Ie.util.encodeUtf8(s));var a=!1;"valueConstructed"in i&&(a=i.valueConstructed);var c=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(i.type).getBytes()),A.create(A.Class.UNIVERSAL,A.Type.SET,!0,[A.create(A.Class.UNIVERSAL,o,a,s)])]);e.value.push(c)}return e}var c6e=new Date("1950-01-01T00:00:00Z"),u6e=new Date("2050-01-01T00:00:00Z");function gQ(r){return r>=c6e&&r<u6e?A.create(A.Class.UNIVERSAL,A.Type.UTCTIME,!1,A.dateToUtcTime(r)):A.create(A.Class.UNIVERSAL,A.Type.GENERALIZEDTIME,!1,A.dateToGeneralizedTime(r))}ce.getTBSCertificate=function(r){var e=gQ(r.validity.notBefore),t=gQ(r.validity.notAfter),n=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,A.integerToDer(r.version).getBytes())]),A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,Ie.util.hexToBytes(r.serialNumber)),A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(r.siginfo.algorithmOid).getBytes()),Dx(r.siginfo.algorithmOid,r.siginfo.parameters)]),P0(r.issuer),A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[e,t]),P0(r.subject),ce.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&n.value.push(A.create(A.Class.CONTEXT_SPECIFIC,1,!0,[A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&n.value.push(A.create(A.Class.CONTEXT_SPECIFIC,2,!0,[A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&n.value.push(ce.certificateExtensionsToAsn1(r.extensions)),n};ce.getCertificationRequestInfo=function(r){var e=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,A.integerToDer(r.version).getBytes()),P0(r.subject),ce.publicKeyToAsn1(r.publicKey),a6e(r)]);return e};ce.distinguishedNameToAsn1=function(r){return P0(r)};ce.certificateToAsn1=function(r){var e=r.tbsCertificate||ce.getTBSCertificate(r);return A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[e,A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(r.signatureOid).getBytes()),Dx(r.signatureOid,r.signatureParameters)]),A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};ce.certificateExtensionsToAsn1=function(r){var e=A.create(A.Class.CONTEXT_SPECIFIC,3,!0,[]),t=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);e.value.push(t);for(var n=0;n<r.length;++n)t.value.push(ce.certificateExtensionToAsn1(r[n]));return e};ce.certificateExtensionToAsn1=function(r){var e=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[]);e.value.push(A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(r.id).getBytes())),r.critical&&e.value.push(A.create(A.Class.UNIVERSAL,A.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=r.value;return typeof r.value!="string"&&(t=A.toDer(t).getBytes()),e.value.push(A.create(A.Class.UNIVERSAL,A.Type.OCTETSTRING,!1,t)),e};ce.certificationRequestToAsn1=function(r){var e=r.certificationRequestInfo||ce.getCertificationRequestInfo(r);return A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[e,A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(r.signatureOid).getBytes()),Dx(r.signatureOid,r.signatureParameters)]),A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};ce.createCaStore=function(r){var e={certs:{}};e.getIssuer=function(o){var a=t(o.issuer);return a},e.addCertificate=function(o){if(typeof o=="string"&&(o=Ie.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))if(o.subject.hash in e.certs){var a=e.certs[o.subject.hash];Ie.util.isArray(a)||(a=[a]),a.push(o),e.certs[o.subject.hash]=a}else e.certs[o.subject.hash]=o},e.hasCertificate=function(o){typeof o=="string"&&(o=Ie.pki.certificateFromPem(o));var a=t(o.subject);if(!a)return!1;Ie.util.isArray(a)||(a=[a]);for(var c=A.toDer(ce.certificateToAsn1(o)).getBytes(),u=0;u<a.length;++u){var l=A.toDer(ce.certificateToAsn1(a[u])).getBytes();if(c===l)return!0}return!1},e.listAllCertificates=function(){var o=[];for(var a in e.certs)if(e.certs.hasOwnProperty(a)){var c=e.certs[a];if(!Ie.util.isArray(c))o.push(c);else for(var u=0;u<c.length;++u)o.push(c[u])}return o},e.removeCertificate=function(o){var a;if(typeof o=="string"&&(o=Ie.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))return null;var c=t(o.subject);if(!Ie.util.isArray(c))return a=e.certs[o.subject.hash],delete e.certs[o.subject.hash],a;for(var u=A.toDer(ce.certificateToAsn1(o)).getBytes(),l=0;l<c.length;++l){var f=A.toDer(ce.certificateToAsn1(c[l])).getBytes();u===f&&(a=c[l],c.splice(l,1))}return c.length===0&&delete e.certs[o.subject.hash],a};function t(o){return n(o),e.certs[o.hash]||null}function n(o){if(!o.hash){var a=Ie.md.sha1.create();o.attributes=ce.RDNAttributesAsArray(P0(o),a),o.hash=a.digest().toHex()}}if(r)for(var i=0;i<r.length;++i){var s=r[i];e.addCertificate(s)}return e};ce.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};ce.verifyCertificateChain=function(r,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var n=e.slice(0),i=t.validityCheckDate;typeof i>"u"&&(i=new Date);var s=!0,o=null,a=0;do{var c=e.shift(),u=null,l=!1;if(i&&(i<c.validity.notBefore||i>c.validity.notAfter)&&(o={message:"Certificate is not valid yet or has expired.",error:ce.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:i}),o===null){if(u=e[0]||r.getIssuer(c),u===null&&c.isIssuer(c)&&(l=!0,u=c),u){var f=u;Ie.util.isArray(f)||(f=[f]);for(var h=!1;!h&&f.length>0;){u=f.shift();try{h=u.verify(c)}catch{}}h||(o={message:"Certificate signature is invalid.",error:ce.certificateError.bad_certificate})}o===null&&(!u||l)&&!r.hasCertificate(c)&&(o={message:"Certificate is not trusted.",error:ce.certificateError.unknown_ca})}if(o===null&&u&&!c.isIssuer(u)&&(o={message:"Certificate issuer is invalid.",error:ce.certificateError.bad_certificate}),o===null)for(var d={keyUsage:!0,basicConstraints:!0},m=0;o===null&&m<c.extensions.length;++m){var w=c.extensions[m];w.critical&&!(w.name in d)&&(o={message:"Certificate has an unsupported critical extension.",error:ce.certificateError.unsupported_certificate})}if(o===null&&(!s||e.length===0&&(!u||l))){var b=c.getExtension("basicConstraints"),v=c.getExtension("keyUsage");if(v!==null&&(!v.keyCertSign||b===null)&&(o={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:ce.certificateError.bad_certificate}),o===null&&b!==null&&!b.cA&&(o={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:ce.certificateError.bad_certificate}),o===null&&v!==null&&"pathLenConstraint"in b){var T=a-1;T>b.pathLenConstraint&&(o={message:"Certificate basicConstraints pathLenConstraint violated.",error:ce.certificateError.bad_certificate})}}var p=o===null?!0:o.error,g=t.verify?t.verify(p,a,n):p;if(g===!0)o=null;else throw p===!0&&(o={message:"The application rejected the certificate.",error:ce.certificateError.bad_certificate}),(g||g===0)&&(typeof g=="object"&&!Ie.util.isArray(g)?(g.message&&(o.message=g.message),g.error&&(o.error=g.error)):typeof g=="string"&&(o.error=g)),o;s=!1,++a}while(e.length>0);return!0}});var SQ=B((J1t,vQ)=>{var de=it();Hd();Kc();O3();Vd();U3();uQ();_l();Jt();Nx();var M=de.asn1,Xn=vQ.exports=de.pkcs7=de.pkcs7||{};Xn.messageFromPem=function(r){var e=de.pem.decode(r)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=M.fromDer(e.body);return Xn.messageFromAsn1(n)};Xn.messageToPem=function(r,e){var t={type:"PKCS7",body:M.toDer(r.toAsn1()).getBytes()};return de.pem.encode(t,{maxline:e})};Xn.messageFromAsn1=function(r){var e={},t=[];if(!M.validate(r,Xn.asn1.contentInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=t,n}var i=M.derToOid(e.contentType),s;switch(i){case de.pki.oids.envelopedData:s=Xn.createEnvelopedData();break;case de.pki.oids.encryptedData:s=Xn.createEncryptedData();break;case de.pki.oids.signedData:s=Xn.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return s.fromAsn1(e.content.value[0]),s};Xn.createSignedData=function(){var r=null;return r={type:de.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(n){if(Lx(r,n,Xn.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[],r.rawCapture.certificates)for(var i=r.rawCapture.certificates.value,s=0;s<i.length;++s)r.certificates.push(de.pki.certificateFromAsn1(i[s]))},toAsn1:function(){r.contentInfo||r.sign();for(var n=[],i=0;i<r.certificates.length;++i)n.push(de.pki.certificateToAsn1(r.certificates[i]));var s=[],o=M.create(M.Class.CONTEXT_SPECIFIC,0,!0,[M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,M.integerToDer(r.version).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo])]);return n.length>0&&o.value[0].value.push(M.create(M.Class.CONTEXT_SPECIFIC,0,!0,n)),s.length>0&&o.value[0].value.push(M.create(M.Class.CONTEXT_SPECIFIC,1,!0,s)),o.value[0].value.push(M.create(M.Class.UNIVERSAL,M.Type.SET,!0,r.signerInfos)),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.type).getBytes()),o])},addSigner:function(n){var i=n.issuer,s=n.serialNumber;if(n.certificate){var o=n.certificate;typeof o=="string"&&(o=de.pki.certificateFromPem(o)),i=o.issuer.attributes,s=o.serialNumber}var a=n.key;if(!a)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof a=="string"&&(a=de.pki.privateKeyFromPem(a));var c=n.digestAlgorithm||de.pki.oids.sha1;switch(c){case de.pki.oids.sha1:case de.pki.oids.sha256:case de.pki.oids.sha384:case de.pki.oids.sha512:case de.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+c)}var u=n.authenticatedAttributes||[];if(u.length>0){for(var l=!1,f=!1,h=0;h<u.length;++h){var d=u[h];if(!l&&d.type===de.pki.oids.contentType){if(l=!0,f)break;continue}if(!f&&d.type===de.pki.oids.messageDigest){if(f=!0,l)break;continue}}if(!l||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}r.signers.push({key:a,version:1,issuer:i,serialNumber:s,digestAlgorithm:c,signatureAlgorithm:de.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(n){if(n=n||{},(typeof r.content!="object"||r.contentInfo===null)&&(r.contentInfo=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(de.pki.oids.data).getBytes())]),"content"in r)){var i;r.content instanceof de.util.ByteBuffer?i=r.content.bytes():typeof r.content=="string"&&(i=de.util.encodeUtf8(r.content)),n.detached?r.detachedContent=M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,i):r.contentInfo.value.push(M.create(M.Class.CONTEXT_SPECIFIC,0,!0,[M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,i)]))}if(r.signers.length!==0){var s=e();t(s)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(n){typeof n=="string"&&(n=de.pki.certificateFromPem(n)),r.certificates.push(n)},addCertificateRevokationList:function(n){throw new Error("PKCS#7 CRL support not yet implemented.")}},r;function e(){for(var n={},i=0;i<r.signers.length;++i){var s=r.signers[i],o=s.digestAlgorithm;o in n||(n[o]=de.md[de.pki.oids[o]].create()),s.authenticatedAttributes.length===0?s.md=n[o]:s.md=de.md[de.pki.oids[o]].create()}r.digestAlgorithmIdentifiers=[];for(var o in n)r.digestAlgorithmIdentifiers.push(M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(o).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.NULL,!1,"")]));return n}function t(n){var i;if(r.detachedContent?i=r.detachedContent:(i=r.contentInfo.value[1],i=i.value[0]),!i)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var s=M.derToOid(r.contentInfo.value[0].value),o=M.toDer(i);o.getByte(),M.getBerValueLength(o),o=o.getBytes();for(var a in n)n[a].start().update(o);for(var c=new Date,u=0;u<r.signers.length;++u){var l=r.signers[u];if(l.authenticatedAttributes.length===0){if(s!==de.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{l.authenticatedAttributesAsn1=M.create(M.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=M.create(M.Class.UNIVERSAL,M.Type.SET,!0,[]),h=0;h<l.authenticatedAttributes.length;++h){var d=l.authenticatedAttributes[h];d.type===de.pki.oids.messageDigest?d.value=n[l.digestAlgorithm].digest():d.type===de.pki.oids.signingTime&&(d.value||(d.value=c)),f.value.push(Ox(d)),l.authenticatedAttributesAsn1.value.push(Ox(d))}o=M.toDer(f).getBytes(),l.md.start().update(o)}l.signature=l.key.sign(l.md,"RSASSA-PKCS1-V1_5")}r.signerInfos=m6e(r.signers)}};Xn.createEncryptedData=function(){var r=null;return r={type:de.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:de.pki.oids["aes256-CBC"]},fromAsn1:function(e){Lx(r,e,Xn.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(r.encryptedContent.key=e),EQ(r)}},r};Xn.createEnvelopedData=function(){var r=null;return r={type:de.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:de.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=Lx(r,e,Xn.asn1.envelopedDataValidator);r.recipients=d6e(t.recipientInfos.value)},toAsn1:function(){return M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.type).getBytes()),M.create(M.Class.CONTEXT_SPECIFIC,0,!0,[M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,M.integerToDer(r.version).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SET,!0,h6e(r.recipients)),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,g6e(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var i=r.recipients[n],s=i.issuer;if(i.serialNumber===e.serialNumber&&s.length===t.length){for(var o=!0,a=0;a<t.length;++a)if(s[a].type!==t[a].type||s[a].value!==t[a].value){o=!1;break}if(o)return i}}return null},decrypt:function(e,t){if(r.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case de.pki.oids.rsaEncryption:case de.pki.oids.desCBC:var n=t.decrypt(e.encryptedContent.content);r.encryptedContent.key=de.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}EQ(r)},addRecipient:function(e){r.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:de.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(r.encryptedContent.content===void 0){t=t||r.encryptedContent.algorithm,e=e||r.encryptedContent.key;var n,i,s;switch(t){case de.pki.oids["aes128-CBC"]:n=16,i=16,s=de.aes.createEncryptionCipher;break;case de.pki.oids["aes192-CBC"]:n=24,i=16,s=de.aes.createEncryptionCipher;break;case de.pki.oids["aes256-CBC"]:n=32,i=16,s=de.aes.createEncryptionCipher;break;case de.pki.oids["des-EDE3-CBC"]:n=24,i=8,s=de.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=de.util.createBuffer(de.random.getBytes(n));else if(e.length()!=n)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+n+".");r.encryptedContent.algorithm=t,r.encryptedContent.key=e,r.encryptedContent.parameter=de.util.createBuffer(de.random.getBytes(i));var o=s(e);if(o.start(r.encryptedContent.parameter.copy()),o.update(r.content),!o.finish())throw new Error("Symmetric encryption failed.");r.encryptedContent.content=o.output}for(var a=0;a<r.recipients.length;++a){var c=r.recipients[a];if(c.encryptedContent.content===void 0)switch(c.encryptedContent.algorithm){case de.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm)}}}},r};function l6e(r){var e={},t=[];if(!M.validate(r,Xn.asn1.recipientInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=t,n}return{version:e.version.charCodeAt(0),issuer:de.pki.RDNAttributesAsArray(e.issuer),serialNumber:de.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:M.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function f6e(r){return M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,M.integerToDer(r.version).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[de.pki.distinguishedNameToAsn1({attributes:r.issuer}),M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,de.util.hexToBytes(r.serialNumber))]),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.encryptedContent.algorithm).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.NULL,!1,"")]),M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r.encryptedContent.content)])}function d6e(r){for(var e=[],t=0;t<r.length;++t)e.push(l6e(r[t]));return e}function h6e(r){for(var e=[],t=0;t<r.length;++t)e.push(f6e(r[t]));return e}function p6e(r){var e=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,M.integerToDer(r.version).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[de.pki.distinguishedNameToAsn1({attributes:r.issuer}),M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,de.util.hexToBytes(r.serialNumber))]),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.digestAlgorithm).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.NULL,!1,"")])]);if(r.authenticatedAttributesAsn1&&e.value.push(r.authenticatedAttributesAsn1),e.value.push(M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.signatureAlgorithm).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.NULL,!1,"")])),e.value.push(M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r.signature)),r.unauthenticatedAttributes.length>0){for(var t=M.create(M.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<r.unauthenticatedAttributes.length;++n){var i=r.unauthenticatedAttributes[n];t.values.push(Ox(i))}e.value.push(t)}return e}function m6e(r){for(var e=[],t=0;t<r.length;++t)e.push(p6e(r[t]));return e}function Ox(r){var e;if(r.type===de.pki.oids.contentType)e=M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.value).getBytes());else if(r.type===de.pki.oids.messageDigest)e=M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r.value.bytes());else if(r.type===de.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),i=r.value;if(typeof i=="string"){var s=Date.parse(i);isNaN(s)?i.length===13?i=M.utcTimeToDate(i):i=M.generalizedTimeToDate(i):i=new Date(s)}i>=t&&i<n?e=M.create(M.Class.UNIVERSAL,M.Type.UTCTIME,!1,M.dateToUtcTime(i)):e=M.create(M.Class.UNIVERSAL,M.Type.GENERALIZEDTIME,!1,M.dateToGeneralizedTime(i))}return M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.type).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SET,!0,[e])])}function g6e(r){return[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(de.pki.oids.data).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(r.algorithm).getBytes()),r.parameter?M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r.parameter.getBytes()):void 0]),M.create(M.Class.CONTEXT_SPECIFIC,0,!0,[M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r.content.getBytes())])]}function Lx(r,e,t){var n={},i=[];if(!M.validate(e,t,n,i)){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s}var o=M.derToOid(n.contentType);if(o!==de.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var a="";if(de.util.isArray(n.encryptedContent))for(var c=0;c<n.encryptedContent.length;++c){if(n.encryptedContent[c].type!==M.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=n.encryptedContent[c].value}else a=n.encryptedContent;r.encryptedContent={algorithm:M.derToOid(n.encAlgorithm),parameter:de.util.createBuffer(n.encParameter.value),content:de.util.createBuffer(a)}}if(n.content){var a="";if(de.util.isArray(n.content))for(var c=0;c<n.content.length;++c){if(n.content[c].type!==M.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=n.content[c].value}else a=n.content;r.content=de.util.createBuffer(a)}return r.version=n.version.charCodeAt(0),r.rawCapture=n,n}function EQ(r){if(r.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(r.content===void 0){var e;switch(r.encryptedContent.algorithm){case de.pki.oids["aes128-CBC"]:case de.pki.oids["aes192-CBC"]:case de.pki.oids["aes256-CBC"]:e=de.aes.createDecryptionCipher(r.encryptedContent.key);break;case de.pki.oids.desCBC:case de.pki.oids["des-EDE3-CBC"]:e=de.des.createDecryptionCipher(r.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+r.encryptedContent.algorithm)}if(e.start(r.encryptedContent.parameter),e.update(r.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");r.content=e.output}}});var gX=B((V3t,mX)=>{var L0=1e3,B0=L0*60,M0=B0*60,Yf=M0*24,k6e=Yf*7,D6e=Yf*365.25;mX.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return N6e(r);if(t==="number"&&isFinite(r))return e.long?L6e(r):O6e(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function N6e(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*D6e;case"weeks":case"week":case"w":return t*k6e;case"days":case"day":case"d":return t*Yf;case"hours":case"hour":case"hrs":case"hr":case"h":return t*M0;case"minutes":case"minute":case"mins":case"min":case"m":return t*B0;case"seconds":case"second":case"secs":case"sec":case"s":return t*L0;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function O6e(r){var e=Math.abs(r);return e>=Yf?Math.round(r/Yf)+"d":e>=M0?Math.round(r/M0)+"h":e>=B0?Math.round(r/B0)+"m":e>=L0?Math.round(r/L0)+"s":r+"ms"}function L6e(r){var e=Math.abs(r);return e>=Yf?_8(r,e,Yf,"day"):e>=M0?_8(r,e,M0,"hour"):e>=B0?_8(r,e,B0,"minute"):e>=L0?_8(r,e,L0,"second"):r+" ms"}function _8(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var bX=B((z3t,wX)=>{"use strict";wX.exports=yX;var B6e=gX(),Xu=yX.prototype,M6e=new Date%1e9;function U6e(){return(Math.random()*1e9>>>0)+M6e++}function yX(r){r=r||{},this.id=r.id||U6e(),this.max=r.max||1/0,this.items=r.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(r.lastModified||new Date);for(var e,t,n=this.items.length;n--;)e=this.items[n],t=new Date(e.expires)-new Date,this._lookup[e.key]=e,t>0?this.expire(e.key,t):t<=0&&this.delete(e.key)}Xu.has=function(r){return r in this._lookup};Xu.get=function(r){if(!this.has(r))return null;var e=this._lookup[r];return e.refresh&&this.expire(r,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value};Xu.meta=function(r){if(!this.has(r))return null;var e=this._lookup[r];return"meta"in e?e.meta:null};Xu.set=function(r,e,t){var n=this._lookup[r],i=this._lookup[r]={key:r,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),t&&("ttl"in t&&this.expire(r,t.ttl),"meta"in t&&(i.meta=t.meta),t.refresh&&(i.refresh=t.ttl)),this};Xu.delete=function(r){var e=this._lookup[r];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[r],this.size--,this):!1};Xu.expire=function(r,e){var t=e||0,n=this._lookup[r];if(!n)return this;if(typeof t=="string"&&(t=B6e(e)),typeof t!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),t),n.expires=Number(new Date)+t,this};Xu.clear=function(){for(var r=this.items.length;r--;)this.delete(this.items[r].key);return this};Xu.toJSON=function(){for(var r=new Array(this.items.length),e,t=r.length;t--;)e=this.items[t],r[t]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:r}}});var PX=B((Eyt,CX)=>{CX.exports=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var NX=B((Syt,DX)=>{var kX=PX();DX.exports=class{constructor(e){this.hwm=e||16,this.head=new kX(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let t=this.head;this.head=t.next=new kX(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var LX=B((xyt,OX)=>{"use strict";var G6e=()=>{let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r};OX.exports=G6e});var FX=B((Ayt,UX)=>{var BX=NX(),MX=LX();UX.exports=class{constructor(){this._buffer=new BX,this._waitingConsumers=new BX}push(e){let{promise:t,resolve:n}=MX();return this._buffer.push({chunk:e,resolve:n}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){let e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){let{promise:e,resolve:t}=MX();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}});var QX=B((gT,YX)=>{var R8=mm(),na=R8.Buffer;function WX(r,e){for(var t in r)e[t]=r[t]}na.from&&na.alloc&&na.allocUnsafe&&na.allocUnsafeSlow?YX.exports=R8:(WX(R8,gT),gT.Buffer=Xf);function Xf(r,e,t){return na(r,e,t)}Xf.prototype=Object.create(na.prototype);WX(na,Xf);Xf.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return na(r,e,t)};Xf.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=na(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};Xf.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return na(r)};Xf.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return R8.SlowBuffer(r)}});var XX=B((T5t,wT)=>{"use strict";var yT=65536,Y6e=4294967295;function Q6e(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var X6e=QX().Buffer,C8=globalThis.crypto||globalThis.msCrypto;C8&&C8.getRandomValues?wT.exports=Z6e:wT.exports=Q6e;function Z6e(r,e){if(r>Y6e)throw new RangeError("requested too many random bytes");var t=X6e.allocUnsafe(r);if(r>0)if(r>yT)for(var n=0;n<r;n+=yT)C8.getRandomValues(t.slice(n,n+yT));else C8.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}});var eZ=B((A5t,JX)=>{"use strict";var J6e=XX(),{EventEmitter:e8e}=Tn();function ZX(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;++t)if(r[t]!==e[t])return!1;return!0}function bT(){return{contacts:[],dontSplit:!1,left:null,right:null}}function R2(r,e){if(!(e instanceof Uint8Array))throw new TypeError(r+" is not a Uint8Array")}var F0=class extends e8e{constructor(e={}){super(),this.localNodeId=e.localNodeId||J6e(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||F0.distance,this.arbiter=e.arbiter||F0.arbiter,this.metadata=Object.assign({},e.metadata),R2("option.localNodeId as parameter 1",this.localNodeId),this.root=bT()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let n=0,i=0,s=Math.min(e.length,t.length),o=Math.max(e.length,t.length);for(;i<s;++i)n=n*256+(e[i]^t[i]);for(;i<o;++i)n=n*256+255;return n}add(e){R2("contact.id",(e||{}).id);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e.id,t++);let i=this._indexOf(n,e.id);return i>=0?(this._update(n,i,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.emit("added",e),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(R2("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let i=[this.root],s=0;i.length>0&&n.length<t;){let o=i.pop();if(o.contacts===null){let a=this._determineNode(o,e,s++);i.push(o.left===a?o.right:o.left),i.push(a)}else n=n.concat(o.contacts)}return n.map(i=>[this.distance(i.id,e),i]).sort((i,s)=>i[0]-s[0]).slice(0,t).map(i=>i[1])}count(){let e=0;for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e+=n.contacts.length}return e}_determineNode(e,t,n){let i=n>>3,s=n%8;return t.length<=i&&s!==0?e.left:t[i]&1<<7-s?e.right:e.left}get(e){R2("id",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);return i>=0?n.contacts[i]:null}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(ZX(e.contacts[n].id,t))return n;return-1}remove(e){R2("the id as parameter 1",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);if(i>=0){let s=n.contacts.splice(i,1)[0];this.emit("removed",s)}return this}_split(e,t){e.left=bT(),e.right=bT();for(let s of e.contacts)this._determineNode(e,s.id,t).contacts.push(s);e.contacts=null;let n=this._determineNode(e,this.localNodeId,t),i=e.left===n?e.right:e.left;i.dontSplit=!0}toArray(){let e=[];for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e=e.concat(n.contacts)}return e}*toIterable(){for(let e=[this.root];e.length>0;){let t=e.pop();t.contacts===null?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,n){if(!ZX(e.contacts[t].id,n.id))throw new Error("wrong index for _update");let i=e.contacts[t],s=this.arbiter(i,n);s===i&&i!==n||(e.contacts.splice(t,1),e.contacts.push(s),this.emit("updated",i,s))}};JX.exports=F0});var qZ=B(nw=>{"use strict";Object.defineProperty(nw,"__esModule",{value:!0});var PT=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},rw=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let i=new PT;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};nw.EventIterator=rw;nw.default=rw});var GZ=B(B2=>{"use strict";Object.defineProperty(B2,"__esModule",{value:!0});var kT=qZ();B2.EventIterator=kT.EventIterator;function T8e(r,e,t){return new kT.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}B2.subscribe=T8e;B2.default=kT.EventIterator});var IJ=B(HT=>{"use strict";Object.defineProperty(HT,"__esModule",{value:!0});function H8e(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}HT.isSerializableHash=H8e});var aw=B(W0=>{"use strict";Object.defineProperty(W0,"__esModule",{value:!0});function $8e(r,e,t){return~(r-1)&e|r-1&t}W0.select=$8e;function q8e(r,e){return(r|0)-(e|0)-1>>>31&1}W0.lessOrEqual=q8e;function RJ(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}W0.compare=RJ;function G8e(r,e){return r.length===0||e.length===0?!1:RJ(r,e)!==0}W0.equal=G8e});var sa=B($T=>{"use strict";Object.defineProperty($T,"__esModule",{value:!0});function j8e(r){for(var e=0;e<r.length;e++)r[e]=0;return r}$T.wipe=j8e});var PJ=B(U2=>{"use strict";Object.defineProperty(U2,"__esModule",{value:!0});var oa=IJ(),W8e=aw(),Y8e=sa(),CJ=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),oa.isSerializableHash(this._inner)&&oa.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Y8e.wipe(n)}return r.prototype.reset=function(){if(!oa.isSerializableHash(this._inner)||!oa.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){oa.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),oa.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!oa.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!oa.isSerializableHash(this._inner)||!oa.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!oa.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();U2.HMAC=CJ;function Q8e(r,e,t){var n=new CJ(r,e);n.update(t);var i=n.digest();return n.clean(),i}U2.hmac=Q8e;U2.equal=W8e.equal});var NJ=B(qT=>{"use strict";Object.defineProperty(qT,"__esModule",{value:!0});var kJ=PJ(),DJ=sa(),X8e=function(){function r(e,t,n,i){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var s=kJ.hmac(this._hash,n,t);this._hmac=new kJ.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),n=0;n<t.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[n]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),DJ.wipe(this._buffer),DJ.wipe(this._counter),this._bufpos=0},r}();qT.HKDF=X8e});var LJ=B(cw=>{"use strict";Object.defineProperty(cw,"__esModule",{value:!0});cw.BrowserRandomSource=void 0;var OJ=65536,GT=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;let e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");let t=new Uint8Array(e);for(let n=0;n<t.length;n+=OJ)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,OJ)));return t}};cw.BrowserRandomSource=GT});var BJ=B(uw=>{"use strict";Object.defineProperty(uw,"__esModule",{value:!0});uw.NodeRandomSource=void 0;var Z8e=sa(),jT=class{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof ed<"u"){let e=$c();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");let n=new Uint8Array(e);for(let i=0;i<n.length;i++)n[i]=t[i];return(0,Z8e.wipe)(t),n}};uw.NodeRandomSource=jT});var MJ=B(lw=>{"use strict";Object.defineProperty(lw,"__esModule",{value:!0});lw.SystemRandomSource=void 0;var J8e=LJ(),ewe=BJ(),WT=class{constructor(){if(this.isAvailable=!1,this.name="",this._source=new J8e.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new ewe.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}};lw.SystemRandomSource=WT});var UJ=B(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});function twe(r,e){var t=r>>>16&65535,n=r&65535,i=e>>>16&65535,s=e&65535;return n*s+(t*s+n*i<<16>>>0)|0}Hi.mul=Math.imul||twe;function rwe(r,e){return r+e|0}Hi.add=rwe;function nwe(r,e){return r-e|0}Hi.sub=nwe;function iwe(r,e){return r<<e|r>>>32-e}Hi.rotl=iwe;function swe(r,e){return r<<32-e|r>>>e}Hi.rotr=swe;function owe(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r}Hi.isInteger=Number.isInteger||owe;Hi.MAX_SAFE_INTEGER=9007199254740991;Hi.isSafeInteger=function(r){return Hi.isInteger(r)&&r>=-Hi.MAX_SAFE_INTEGER&&r<=Hi.MAX_SAFE_INTEGER}});var F2=B(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});var FJ=UJ();function awe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}et.readInt16BE=awe;function cwe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}et.readUint16BE=cwe;function uwe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}et.readInt16LE=uwe;function lwe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}et.readUint16LE=lwe;function VJ(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}et.writeUint16BE=VJ;et.writeInt16BE=VJ;function zJ(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}et.writeUint16LE=zJ;et.writeInt16LE=zJ;function YT(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}et.readInt32BE=YT;function QT(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}et.readUint32BE=QT;function XT(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}et.readInt32LE=XT;function ZT(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}et.readUint32LE=ZT;function fw(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}et.writeUint32BE=fw;et.writeInt32BE=fw;function dw(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}et.writeUint32LE=dw;et.writeInt32LE=dw;function fwe(r,e){e===void 0&&(e=0);var t=YT(r,e),n=YT(r,e+4);return t*4294967296+n-(n>>31)*4294967296}et.readInt64BE=fwe;function dwe(r,e){e===void 0&&(e=0);var t=QT(r,e),n=QT(r,e+4);return t*4294967296+n}et.readUint64BE=dwe;function hwe(r,e){e===void 0&&(e=0);var t=XT(r,e),n=XT(r,e+4);return n*4294967296+t-(t>>31)*4294967296}et.readInt64LE=hwe;function pwe(r,e){e===void 0&&(e=0);var t=ZT(r,e),n=ZT(r,e+4);return n*4294967296+t}et.readUint64LE=pwe;function KJ(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),fw(r/4294967296>>>0,e,t),fw(r>>>0,e,t+4),e}et.writeUint64BE=KJ;et.writeInt64BE=KJ;function HJ(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),dw(r>>>0,e,t),dw(r/4294967296>>>0,e,t+4),e}et.writeUint64LE=HJ;et.writeInt64LE=HJ;function mwe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=r/8+t-1;s>=t;s--)n+=e[s]*i,i*=256;return n}et.readUintBE=mwe;function gwe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=t;s<t+r/8;s++)n+=e[s]*i,i*=256;return n}et.readUintLE=gwe;function ywe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!FJ.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,s=r/8+n-1;s>=n;s--)t[s]=e/i&255,i*=256;return t}et.writeUintBE=ywe;function wwe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!FJ.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+r/8;s++)t[s]=e/i&255,i*=256;return t}et.writeUintLE=wwe;function bwe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}et.readFloat32BE=bwe;function _we(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}et.readFloat32LE=_we;function Ewe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}et.readFloat64BE=Ewe;function vwe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}et.readFloat64LE=vwe;function Swe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}et.writeFloat32BE=Swe;function xwe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}et.writeFloat32LE=xwe;function Twe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}et.writeFloat64BE=Twe;function Awe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}et.writeFloat64LE=Awe});var jJ=B(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.randomStringForEntropy=Vn.randomString=Vn.randomUint32=Vn.randomBytes=Vn.defaultRandomSource=void 0;var Iwe=MJ(),Rwe=F2(),$J=sa();Vn.defaultRandomSource=new Iwe.SystemRandomSource;function JT(r,e=Vn.defaultRandomSource){return e.randomBytes(r)}Vn.randomBytes=JT;function Cwe(r=Vn.defaultRandomSource){let e=JT(4,r),t=(0,Rwe.readUint32LE)(e);return(0,$J.wipe)(e),t}Vn.randomUint32=Cwe;var qJ="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function GJ(r,e=qJ,t=Vn.defaultRandomSource){if(e.length<2)throw new Error("randomString charset is too short");if(e.length>256)throw new Error("randomString charset is too long");let n="",i=e.length,s=256-256%i;for(;r>0;){let o=JT(Math.ceil(r*256/s),t);for(let a=0;a<o.length&&r>0;a++){let c=o[a];c<s&&(n+=e.charAt(c%i),r--)}(0,$J.wipe)(o)}return n}Vn.randomString=GJ;function Pwe(r,e=qJ,t=Vn.defaultRandomSource){let n=Math.ceil(r/(Math.log(e.length)/Math.LN2));return GJ(n,e,t)}Vn.randomStringForEntropy=Pwe});var XJ=B(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.sharedKey=kr.generateKeyPair=kr.generateKeyPairFromSeed=kr.scalarMultBase=kr.scalarMult=kr.SHARED_KEY_LENGTH=kr.SECRET_KEY_LENGTH=kr.PUBLIC_KEY_LENGTH=void 0;var kwe=jJ(),Dwe=sa();kr.PUBLIC_KEY_LENGTH=32;kr.SECRET_KEY_LENGTH=32;kr.SHARED_KEY_LENGTH=32;function aa(r){let e=new Float64Array(16);if(r)for(let t=0;t<r.length;t++)e[t]=r[t];return e}var WJ=new Uint8Array(32);WJ[0]=9;var Nwe=aa([56129,1]);function eA(r){let e=1;for(let t=0;t<16;t++){let n=r[t]+e+65535;e=Math.floor(n/65536),r[t]=n-e*65536}r[0]+=e-1+37*(e-1)}function V2(r,e,t){let n=~(t-1);for(let i=0;i<16;i++){let s=n&(r[i]^e[i]);r[i]^=s,e[i]^=s}}function Owe(r,e){let t=aa(),n=aa();for(let i=0;i<16;i++)n[i]=e[i];eA(n),eA(n),eA(n);for(let i=0;i<2;i++){t[0]=n[0]-65517;for(let o=1;o<15;o++)t[o]=n[o]-65535-(t[o-1]>>16&1),t[o-1]&=65535;t[15]=n[15]-32767-(t[14]>>16&1);let s=t[15]>>16&1;t[14]&=65535,V2(n,t,1-s)}for(let i=0;i<16;i++)r[2*i]=n[i]&255,r[2*i+1]=n[i]>>8}function Lwe(r,e){for(let t=0;t<16;t++)r[t]=e[2*t]+(e[2*t+1]<<8);r[15]&=32767}function hw(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]+t[n]}function pw(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]-t[n]}function gc(r,e,t){let n,i,s=0,o=0,a=0,c=0,u=0,l=0,f=0,h=0,d=0,m=0,w=0,b=0,v=0,T=0,p=0,g=0,y=0,E=0,_=0,x=0,S=0,I=0,k=0,N=0,L=0,G=0,R=0,K=0,F=0,J=0,ye=0,se=t[0],Re=t[1],De=t[2],Ke=t[3],Ne=t[4],Be=t[5],Me=t[6],Fe=t[7],Vr=t[8],zr=t[9],Zr=t[10],Kr=t[11],Jr=t[12],An=t[13],In=t[14],Rn=t[15];n=e[0],s+=n*se,o+=n*Re,a+=n*De,c+=n*Ke,u+=n*Ne,l+=n*Be,f+=n*Me,h+=n*Fe,d+=n*Vr,m+=n*zr,w+=n*Zr,b+=n*Kr,v+=n*Jr,T+=n*An,p+=n*In,g+=n*Rn,n=e[1],o+=n*se,a+=n*Re,c+=n*De,u+=n*Ke,l+=n*Ne,f+=n*Be,h+=n*Me,d+=n*Fe,m+=n*Vr,w+=n*zr,b+=n*Zr,v+=n*Kr,T+=n*Jr,p+=n*An,g+=n*In,y+=n*Rn,n=e[2],a+=n*se,c+=n*Re,u+=n*De,l+=n*Ke,f+=n*Ne,h+=n*Be,d+=n*Me,m+=n*Fe,w+=n*Vr,b+=n*zr,v+=n*Zr,T+=n*Kr,p+=n*Jr,g+=n*An,y+=n*In,E+=n*Rn,n=e[3],c+=n*se,u+=n*Re,l+=n*De,f+=n*Ke,h+=n*Ne,d+=n*Be,m+=n*Me,w+=n*Fe,b+=n*Vr,v+=n*zr,T+=n*Zr,p+=n*Kr,g+=n*Jr,y+=n*An,E+=n*In,_+=n*Rn,n=e[4],u+=n*se,l+=n*Re,f+=n*De,h+=n*Ke,d+=n*Ne,m+=n*Be,w+=n*Me,b+=n*Fe,v+=n*Vr,T+=n*zr,p+=n*Zr,g+=n*Kr,y+=n*Jr,E+=n*An,_+=n*In,x+=n*Rn,n=e[5],l+=n*se,f+=n*Re,h+=n*De,d+=n*Ke,m+=n*Ne,w+=n*Be,b+=n*Me,v+=n*Fe,T+=n*Vr,p+=n*zr,g+=n*Zr,y+=n*Kr,E+=n*Jr,_+=n*An,x+=n*In,S+=n*Rn,n=e[6],f+=n*se,h+=n*Re,d+=n*De,m+=n*Ke,w+=n*Ne,b+=n*Be,v+=n*Me,T+=n*Fe,p+=n*Vr,g+=n*zr,y+=n*Zr,E+=n*Kr,_+=n*Jr,x+=n*An,S+=n*In,I+=n*Rn,n=e[7],h+=n*se,d+=n*Re,m+=n*De,w+=n*Ke,b+=n*Ne,v+=n*Be,T+=n*Me,p+=n*Fe,g+=n*Vr,y+=n*zr,E+=n*Zr,_+=n*Kr,x+=n*Jr,S+=n*An,I+=n*In,k+=n*Rn,n=e[8],d+=n*se,m+=n*Re,w+=n*De,b+=n*Ke,v+=n*Ne,T+=n*Be,p+=n*Me,g+=n*Fe,y+=n*Vr,E+=n*zr,_+=n*Zr,x+=n*Kr,S+=n*Jr,I+=n*An,k+=n*In,N+=n*Rn,n=e[9],m+=n*se,w+=n*Re,b+=n*De,v+=n*Ke,T+=n*Ne,p+=n*Be,g+=n*Me,y+=n*Fe,E+=n*Vr,_+=n*zr,x+=n*Zr,S+=n*Kr,I+=n*Jr,k+=n*An,N+=n*In,L+=n*Rn,n=e[10],w+=n*se,b+=n*Re,v+=n*De,T+=n*Ke,p+=n*Ne,g+=n*Be,y+=n*Me,E+=n*Fe,_+=n*Vr,x+=n*zr,S+=n*Zr,I+=n*Kr,k+=n*Jr,N+=n*An,L+=n*In,G+=n*Rn,n=e[11],b+=n*se,v+=n*Re,T+=n*De,p+=n*Ke,g+=n*Ne,y+=n*Be,E+=n*Me,_+=n*Fe,x+=n*Vr,S+=n*zr,I+=n*Zr,k+=n*Kr,N+=n*Jr,L+=n*An,G+=n*In,R+=n*Rn,n=e[12],v+=n*se,T+=n*Re,p+=n*De,g+=n*Ke,y+=n*Ne,E+=n*Be,_+=n*Me,x+=n*Fe,S+=n*Vr,I+=n*zr,k+=n*Zr,N+=n*Kr,L+=n*Jr,G+=n*An,R+=n*In,K+=n*Rn,n=e[13],T+=n*se,p+=n*Re,g+=n*De,y+=n*Ke,E+=n*Ne,_+=n*Be,x+=n*Me,S+=n*Fe,I+=n*Vr,k+=n*zr,N+=n*Zr,L+=n*Kr,G+=n*Jr,R+=n*An,K+=n*In,F+=n*Rn,n=e[14],p+=n*se,g+=n*Re,y+=n*De,E+=n*Ke,_+=n*Ne,x+=n*Be,S+=n*Me,I+=n*Fe,k+=n*Vr,N+=n*zr,L+=n*Zr,G+=n*Kr,R+=n*Jr,K+=n*An,F+=n*In,J+=n*Rn,n=e[15],g+=n*se,y+=n*Re,E+=n*De,_+=n*Ke,x+=n*Ne,S+=n*Be,I+=n*Me,k+=n*Fe,N+=n*Vr,L+=n*zr,G+=n*Zr,R+=n*Kr,K+=n*Jr,F+=n*An,J+=n*In,ye+=n*Rn,s+=38*y,o+=38*E,a+=38*_,c+=38*x,u+=38*S,l+=38*I,f+=38*k,h+=38*N,d+=38*L,m+=38*G,w+=38*R,b+=38*K,v+=38*F,T+=38*J,p+=38*ye,i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=l+i+65535,i=Math.floor(n/65536),l=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=b+i+65535,i=Math.floor(n/65536),b=n-i*65536,n=v+i+65535,i=Math.floor(n/65536),v=n-i*65536,n=T+i+65535,i=Math.floor(n/65536),T=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,s+=i-1+37*(i-1),i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=l+i+65535,i=Math.floor(n/65536),l=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=b+i+65535,i=Math.floor(n/65536),b=n-i*65536,n=v+i+65535,i=Math.floor(n/65536),v=n-i*65536,n=T+i+65535,i=Math.floor(n/65536),T=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,s+=i-1+37*(i-1),r[0]=s,r[1]=o,r[2]=a,r[3]=c,r[4]=u,r[5]=l,r[6]=f,r[7]=h,r[8]=d,r[9]=m,r[10]=w,r[11]=b,r[12]=v,r[13]=T,r[14]=p,r[15]=g}function z2(r,e){gc(r,e,e)}function Bwe(r,e){let t=aa();for(let n=0;n<16;n++)t[n]=e[n];for(let n=253;n>=0;n--)z2(t,t),n!==2&&n!==4&&gc(t,t,e);for(let n=0;n<16;n++)r[n]=t[n]}function tA(r,e){let t=new Uint8Array(32),n=new Float64Array(80),i=aa(),s=aa(),o=aa(),a=aa(),c=aa(),u=aa();for(let d=0;d<31;d++)t[d]=r[d];t[31]=r[31]&127|64,t[0]&=248,Lwe(n,e);for(let d=0;d<16;d++)s[d]=n[d];i[0]=a[0]=1;for(let d=254;d>=0;--d){let m=t[d>>>3]>>>(d&7)&1;V2(i,s,m),V2(o,a,m),hw(c,i,o),pw(i,i,o),hw(o,s,a),pw(s,s,a),z2(a,c),z2(u,i),gc(i,o,i),gc(o,s,c),hw(c,i,o),pw(i,i,o),z2(s,i),pw(o,a,u),gc(i,o,Nwe),hw(i,i,a),gc(o,o,i),gc(i,a,u),gc(a,s,n),z2(s,c),V2(i,s,m),V2(o,a,m)}for(let d=0;d<16;d++)n[d+16]=i[d],n[d+32]=o[d],n[d+48]=s[d],n[d+64]=a[d];let l=n.subarray(32),f=n.subarray(16);Bwe(l,l),gc(f,f,l);let h=new Uint8Array(32);return Owe(h,f),h}kr.scalarMult=tA;function YJ(r){return tA(r,WJ)}kr.scalarMultBase=YJ;function QJ(r){if(r.length!==kr.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${kr.SECRET_KEY_LENGTH} bytes`);let e=new Uint8Array(r);return{publicKey:YJ(e),secretKey:e}}kr.generateKeyPairFromSeed=QJ;function Mwe(r){let e=(0,kwe.randomBytes)(32,r),t=QJ(e);return(0,Dwe.wipe)(e),t}kr.generateKeyPair=Mwe;function Uwe(r,e,t=!1){if(r.length!==kr.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(e.length!==kr.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");let n=tA(r,e);if(t){let i=0;for(let s=0;s<n.length;s++)i|=n[s];if(i===0)throw new Error("X25519: invalid shared key")}return n}kr.sharedKey=Uwe});var JJ=B(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});var gw=F2(),mw=sa();el.DIGEST_LENGTH=32;el.BLOCK_SIZE=64;var ZJ=function(){function r(){this.digestLength=el.DIGEST_LENGTH,this.blockSize=el.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return r.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},r.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},r.prototype.clean=function(){mw.wipe(this._buffer),mw.wipe(this._temp),this.reset()},r.prototype.update=function(e,t){if(t===void 0&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(rA(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(n=rA(this._temp,this._state,e,n,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[n++],t--;return this},r.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,i=t/536870912|0,s=t<<3,o=t%64<56?64:128;this._buffer[n]=128;for(var a=n+1;a<o-8;a++)this._buffer[a]=0;gw.writeUint32BE(i,this._buffer,o-8),gw.writeUint32BE(s,this._buffer,o-4),rA(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(var a=0;a<this.digestLength/4;a++)gw.writeUint32BE(this._state[a],e,a*4);return this},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},r.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},r.prototype.cleanSavedState=function(e){mw.wipe(e.state),e.buffer&&mw.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},r}();el.SHA256=ZJ;var Fwe=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function rA(r,e,t,n,i){for(;i>=64;){for(var s=e[0],o=e[1],a=e[2],c=e[3],u=e[4],l=e[5],f=e[6],h=e[7],d=0;d<16;d++){var m=n+d*4;r[d]=gw.readUint32BE(t,m)}for(var d=16;d<64;d++){var w=r[d-2],b=(w>>>17|w<<32-17)^(w>>>19|w<<32-19)^w>>>10;w=r[d-15];var v=(w>>>7|w<<32-7)^(w>>>18|w<<32-18)^w>>>3;r[d]=(b+r[d-7]|0)+(v+r[d-16]|0)}for(var d=0;d<64;d++){var b=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&l^~u&f)|0)+(h+(Fwe[d]+r[d]|0)|0)|0,v=((s>>>2|s<<32-2)^(s>>>13|s<<32-13)^(s>>>22|s<<32-22))+(s&o^s&a^o&a)|0;h=f,f=l,l=u,u=c+b|0,c=a,a=o,o=s,s=b+v|0}e[0]+=s,e[1]+=o,e[2]+=a,e[3]+=c,e[4]+=u,e[5]+=l,e[6]+=f,e[7]+=h,n+=64,i-=64}return n}function Vwe(r){var e=new ZJ;e.update(r);var t=e.digest();return e.clean(),t}el.hash=Vwe});var tee=B(yw=>{"use strict";Object.defineProperty(yw,"__esModule",{value:!0});var zn=F2(),nA=sa(),zwe=20;function Kwe(r,e,t){for(var n=1634760805,i=857760878,s=2036477234,o=1797285236,a=t[3]<<24|t[2]<<16|t[1]<<8|t[0],c=t[7]<<24|t[6]<<16|t[5]<<8|t[4],u=t[11]<<24|t[10]<<16|t[9]<<8|t[8],l=t[15]<<24|t[14]<<16|t[13]<<8|t[12],f=t[19]<<24|t[18]<<16|t[17]<<8|t[16],h=t[23]<<24|t[22]<<16|t[21]<<8|t[20],d=t[27]<<24|t[26]<<16|t[25]<<8|t[24],m=t[31]<<24|t[30]<<16|t[29]<<8|t[28],w=e[3]<<24|e[2]<<16|e[1]<<8|e[0],b=e[7]<<24|e[6]<<16|e[5]<<8|e[4],v=e[11]<<24|e[10]<<16|e[9]<<8|e[8],T=e[15]<<24|e[14]<<16|e[13]<<8|e[12],p=n,g=i,y=s,E=o,_=a,x=c,S=u,I=l,k=f,N=h,L=d,G=m,R=w,K=b,F=v,J=T,ye=0;ye<zwe;ye+=2)p=p+_|0,R^=p,R=R>>>32-16|R<<16,k=k+R|0,_^=k,_=_>>>32-12|_<<12,g=g+x|0,K^=g,K=K>>>32-16|K<<16,N=N+K|0,x^=N,x=x>>>32-12|x<<12,y=y+S|0,F^=y,F=F>>>32-16|F<<16,L=L+F|0,S^=L,S=S>>>32-12|S<<12,E=E+I|0,J^=E,J=J>>>32-16|J<<16,G=G+J|0,I^=G,I=I>>>32-12|I<<12,y=y+S|0,F^=y,F=F>>>32-8|F<<8,L=L+F|0,S^=L,S=S>>>32-7|S<<7,E=E+I|0,J^=E,J=J>>>32-8|J<<8,G=G+J|0,I^=G,I=I>>>32-7|I<<7,g=g+x|0,K^=g,K=K>>>32-8|K<<8,N=N+K|0,x^=N,x=x>>>32-7|x<<7,p=p+_|0,R^=p,R=R>>>32-8|R<<8,k=k+R|0,_^=k,_=_>>>32-7|_<<7,p=p+x|0,J^=p,J=J>>>32-16|J<<16,L=L+J|0,x^=L,x=x>>>32-12|x<<12,g=g+S|0,R^=g,R=R>>>32-16|R<<16,G=G+R|0,S^=G,S=S>>>32-12|S<<12,y=y+I|0,K^=y,K=K>>>32-16|K<<16,k=k+K|0,I^=k,I=I>>>32-12|I<<12,E=E+_|0,F^=E,F=F>>>32-16|F<<16,N=N+F|0,_^=N,_=_>>>32-12|_<<12,y=y+I|0,K^=y,K=K>>>32-8|K<<8,k=k+K|0,I^=k,I=I>>>32-7|I<<7,E=E+_|0,F^=E,F=F>>>32-8|F<<8,N=N+F|0,_^=N,_=_>>>32-7|_<<7,g=g+S|0,R^=g,R=R>>>32-8|R<<8,G=G+R|0,S^=G,S=S>>>32-7|S<<7,p=p+x|0,J^=p,J=J>>>32-8|J<<8,L=L+J|0,x^=L,x=x>>>32-7|x<<7;zn.writeUint32LE(p+n|0,r,0),zn.writeUint32LE(g+i|0,r,4),zn.writeUint32LE(y+s|0,r,8),zn.writeUint32LE(E+o|0,r,12),zn.writeUint32LE(_+a|0,r,16),zn.writeUint32LE(x+c|0,r,20),zn.writeUint32LE(S+u|0,r,24),zn.writeUint32LE(I+l|0,r,28),zn.writeUint32LE(k+f|0,r,32),zn.writeUint32LE(N+h|0,r,36),zn.writeUint32LE(L+d|0,r,40),zn.writeUint32LE(G+m|0,r,44),zn.writeUint32LE(R+w|0,r,48),zn.writeUint32LE(K+b|0,r,52),zn.writeUint32LE(F+v|0,r,56),zn.writeUint32LE(J+T|0,r,60)}function eee(r,e,t,n,i){if(i===void 0&&(i=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-e.length,s.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,o=i}for(var a=new Uint8Array(64),c=0;c<t.length;c+=64){Kwe(a,s,r);for(var u=c;u<c+64&&u<t.length;u++)n[u]=t[u]^a[u-c];$we(s,0,o)}return nA.wipe(a),i===0&&nA.wipe(s),n}yw.streamXOR=eee;function Hwe(r,e,t,n){return n===void 0&&(n=0),nA.wipe(t),eee(r,e,t,t,n)}yw.stream=Hwe;function $we(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}});var nee=B(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});var qwe=aw(),ww=sa();yc.DIGEST_LENGTH=16;var ree=function(){function r(e){this.digestLength=yc.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var t=e[0]|e[1]<<8;this._r[0]=t&8191;var n=e[2]|e[3]<<8;this._r[1]=(t>>>13|n<<3)&8191;var i=e[4]|e[5]<<8;this._r[2]=(n>>>10|i<<6)&7939;var s=e[6]|e[7]<<8;this._r[3]=(i>>>7|s<<9)&8191;var o=e[8]|e[9]<<8;this._r[4]=(s>>>4|o<<12)&255,this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=(o>>>14|a<<2)&8191;var c=e[12]|e[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var u=e[14]|e[15]<<8;this._r[8]=(c>>>8|u<<8)&8191,this._r[9]=u>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return r.prototype._blocks=function(e,t,n){for(var i=this._fin?0:2048,s=this._h[0],o=this._h[1],a=this._h[2],c=this._h[3],u=this._h[4],l=this._h[5],f=this._h[6],h=this._h[7],d=this._h[8],m=this._h[9],w=this._r[0],b=this._r[1],v=this._r[2],T=this._r[3],p=this._r[4],g=this._r[5],y=this._r[6],E=this._r[7],_=this._r[8],x=this._r[9];n>=16;){var S=e[t+0]|e[t+1]<<8;s+=S&8191;var I=e[t+2]|e[t+3]<<8;o+=(S>>>13|I<<3)&8191;var k=e[t+4]|e[t+5]<<8;a+=(I>>>10|k<<6)&8191;var N=e[t+6]|e[t+7]<<8;c+=(k>>>7|N<<9)&8191;var L=e[t+8]|e[t+9]<<8;u+=(N>>>4|L<<12)&8191,l+=L>>>1&8191;var G=e[t+10]|e[t+11]<<8;f+=(L>>>14|G<<2)&8191;var R=e[t+12]|e[t+13]<<8;h+=(G>>>11|R<<5)&8191;var K=e[t+14]|e[t+15]<<8;d+=(R>>>8|K<<8)&8191,m+=K>>>5|i;var F=0,J=F;J+=s*w,J+=o*(5*x),J+=a*(5*_),J+=c*(5*E),J+=u*(5*y),F=J>>>13,J&=8191,J+=l*(5*g),J+=f*(5*p),J+=h*(5*T),J+=d*(5*v),J+=m*(5*b),F+=J>>>13,J&=8191;var ye=F;ye+=s*b,ye+=o*w,ye+=a*(5*x),ye+=c*(5*_),ye+=u*(5*E),F=ye>>>13,ye&=8191,ye+=l*(5*y),ye+=f*(5*g),ye+=h*(5*p),ye+=d*(5*T),ye+=m*(5*v),F+=ye>>>13,ye&=8191;var se=F;se+=s*v,se+=o*b,se+=a*w,se+=c*(5*x),se+=u*(5*_),F=se>>>13,se&=8191,se+=l*(5*E),se+=f*(5*y),se+=h*(5*g),se+=d*(5*p),se+=m*(5*T),F+=se>>>13,se&=8191;var Re=F;Re+=s*T,Re+=o*v,Re+=a*b,Re+=c*w,Re+=u*(5*x),F=Re>>>13,Re&=8191,Re+=l*(5*_),Re+=f*(5*E),Re+=h*(5*y),Re+=d*(5*g),Re+=m*(5*p),F+=Re>>>13,Re&=8191;var De=F;De+=s*p,De+=o*T,De+=a*v,De+=c*b,De+=u*w,F=De>>>13,De&=8191,De+=l*(5*x),De+=f*(5*_),De+=h*(5*E),De+=d*(5*y),De+=m*(5*g),F+=De>>>13,De&=8191;var Ke=F;Ke+=s*g,Ke+=o*p,Ke+=a*T,Ke+=c*v,Ke+=u*b,F=Ke>>>13,Ke&=8191,Ke+=l*w,Ke+=f*(5*x),Ke+=h*(5*_),Ke+=d*(5*E),Ke+=m*(5*y),F+=Ke>>>13,Ke&=8191;var Ne=F;Ne+=s*y,Ne+=o*g,Ne+=a*p,Ne+=c*T,Ne+=u*v,F=Ne>>>13,Ne&=8191,Ne+=l*b,Ne+=f*w,Ne+=h*(5*x),Ne+=d*(5*_),Ne+=m*(5*E),F+=Ne>>>13,Ne&=8191;var Be=F;Be+=s*E,Be+=o*y,Be+=a*g,Be+=c*p,Be+=u*T,F=Be>>>13,Be&=8191,Be+=l*v,Be+=f*b,Be+=h*w,Be+=d*(5*x),Be+=m*(5*_),F+=Be>>>13,Be&=8191;var Me=F;Me+=s*_,Me+=o*E,Me+=a*y,Me+=c*g,Me+=u*p,F=Me>>>13,Me&=8191,Me+=l*T,Me+=f*v,Me+=h*b,Me+=d*w,Me+=m*(5*x),F+=Me>>>13,Me&=8191;var Fe=F;Fe+=s*x,Fe+=o*_,Fe+=a*E,Fe+=c*y,Fe+=u*g,F=Fe>>>13,Fe&=8191,Fe+=l*p,Fe+=f*T,Fe+=h*v,Fe+=d*b,Fe+=m*w,F+=Fe>>>13,Fe&=8191,F=(F<<2)+F|0,F=F+J|0,J=F&8191,F=F>>>13,ye+=F,s=J,o=ye,a=se,c=Re,u=De,l=Ke,f=Ne,h=Be,d=Me,m=Fe,t+=16,n-=16}this._h[0]=s,this._h[1]=o,this._h[2]=a,this._h[3]=c,this._h[4]=u,this._h[5]=l,this._h[6]=f,this._h[7]=h,this._h[8]=d,this._h[9]=m},r.prototype.finish=function(e,t){t===void 0&&(t=0);var n=new Uint16Array(10),i,s,o,a;if(this._leftover){for(a=this._leftover,this._buffer[a++]=1;a<16;a++)this._buffer[a]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(i=this._h[1]>>>13,this._h[1]&=8191,a=2;a<10;a++)this._h[a]+=i,i=this._h[a]>>>13,this._h[a]&=8191;for(this._h[0]+=i*5,i=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=i,i=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=i,n[0]=this._h[0]+5,i=n[0]>>>13,n[0]&=8191,a=1;a<10;a++)n[a]=this._h[a]+i,i=n[a]>>>13,n[a]&=8191;for(n[9]-=1<<13,s=(i^1)-1,a=0;a<10;a++)n[a]&=s;for(s=~s,a=0;a<10;a++)this._h[a]=this._h[a]&s|n[a];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,o=this._h[0]+this._pad[0],this._h[0]=o&65535,a=1;a<8;a++)o=(this._h[a]+this._pad[a]|0)+(o>>>16)|0,this._h[a]=o&65535;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},r.prototype.update=function(e){var t=0,n=e.length,i;if(this._leftover){i=16-this._leftover,i>n&&(i=n);for(var s=0;s<i;s++)this._buffer[this._leftover+s]=e[t+s];if(n-=i,t+=i,this._leftover+=i,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(i=n-n%16,this._blocks(e,t,i),t+=i,n-=i),n){for(var s=0;s<n;s++)this._buffer[this._leftover+s]=e[t+s];this._leftover+=n}return this},r.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},r.prototype.clean=function(){return ww.wipe(this._buffer),ww.wipe(this._r),ww.wipe(this._h),ww.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},r}();yc.Poly1305=ree;function Gwe(r,e){var t=new ree(r);t.update(e);var n=t.digest();return t.clean(),n}yc.oneTimeAuth=Gwe;function jwe(r,e){return r.length!==yc.DIGEST_LENGTH||e.length!==yc.DIGEST_LENGTH?!1:qwe.equal(r,e)}yc.equal=jwe});var iA=B(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var bw=tee(),Wwe=nee(),K2=sa(),iee=F2(),Ywe=aw();wc.KEY_LENGTH=32;wc.NONCE_LENGTH=12;wc.TAG_LENGTH=16;var see=new Uint8Array(16),Qwe=function(){function r(e){if(this.nonceLength=wc.NONCE_LENGTH,this.tagLength=wc.TAG_LENGTH,e.length!==wc.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return r.prototype.seal=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);bw.stream(this._key,s,o,4);var a=t.length+this.tagLength,c;if(i){if(i.length!==a)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(a);return bw.streamXOR(this._key,s,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),o,c.subarray(0,c.length-this.tagLength),n),K2.wipe(s),c},r.prototype.open=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);bw.stream(this._key,s,o,4);var a=new Uint8Array(this.tagLength);if(this._authenticate(a,o,t.subarray(0,t.length-this.tagLength),n),!Ywe.equal(a,t.subarray(t.length-this.tagLength,t.length)))return null;var c=t.length-this.tagLength,u;if(i){if(i.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");u=i}else u=new Uint8Array(c);return bw.streamXOR(this._key,s,t.subarray(0,t.length-this.tagLength),u,4),K2.wipe(s),u},r.prototype.clean=function(){return K2.wipe(this._key),this},r.prototype._authenticate=function(e,t,n,i){var s=new Wwe.Poly1305(t);i&&(s.update(i),i.length%16>0&&s.update(see.subarray(i.length%16))),s.update(n),n.length%16>0&&s.update(see.subarray(n.length%16));var o=new Uint8Array(8);i&&iee.writeUint64LE(i.length,o),s.update(o),iee.writeUint64LE(n.length,o),s.update(o);for(var a=s.digest(),c=0;c<a.length;c++)e[c]=a[c];s.clean(),K2.wipe(a),K2.wipe(o)},r}();wc.ChaCha20Poly1305=Qwe});var kee=B((f_t,Pee)=>{Pee.exports=Cee;var Ree=128,u7e=127,l7e=~u7e,f7e=Math.pow(2,31);function Cee(r,e,t){e=e||[],t=t||0;for(var n=t;r>=f7e;)e[t++]=r&255|Ree,r/=128;for(;r&l7e;)e[t++]=r&255|Ree,r>>>=7;return e[t]=r|0,Cee.bytes=t-n+1,e}});var Oee=B((d_t,Nee)=>{Nee.exports=hA;var d7e=128,Dee=127;function hA(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw hA.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Dee)<<i:(o&Dee)*Math.pow(2,i),i+=7}while(o>=d7e);return hA.bytes=s-n,t}});var Bee=B((h_t,Lee)=>{var h7e=Math.pow(2,7),p7e=Math.pow(2,14),m7e=Math.pow(2,21),g7e=Math.pow(2,28),y7e=Math.pow(2,35),w7e=Math.pow(2,42),b7e=Math.pow(2,49),_7e=Math.pow(2,56),E7e=Math.pow(2,63);Lee.exports=function(r){return r<h7e?1:r<p7e?2:r<m7e?3:r<g7e?4:r<y7e?5:r<w7e?6:r<b7e?7:r<_7e?8:r<E7e?9:10}});var Uee=B((p_t,Mee)=>{Mee.exports={encode:kee(),decode:Oee(),encodingLength:Bee()}});var zee=B((m_t,Vee)=>{"use strict";var Fee=Uee();Vee.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=Fee.decode(r);e.push(t),r=r.slice(Fee.decode.bytes)}return e}});var nte=B((tte,rte)=>{"use strict";var O7e=Math.exp;tte=rte.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,s=0,o,a={};function c(u,l){return 1-O7e(-(u-l)/e)}return a.push=function(l,f){if(o){let h=c(l,o),d=f-t,m=h*d;t=h*f+(1-h)*t,n=(1-h)*(n+d*m),i=Math.sqrt(n),s=t+h*d}else t=f;o=l},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return s},a}});var Bte=B((HSt,Hw)=>{(function(){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],e=typeof window<"u",t=e&&window.mozInnerScreenX!=null;function n(i,s,o){if(!e)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var a=o&&o.debug||!1;if(a){var c=document.querySelector("#input-textarea-caret-position-mirror-div");c&&c.parentNode.removeChild(c)}var u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);var l=u.style,f=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,h=i.nodeName==="INPUT";l.whiteSpace="pre-wrap",h||(l.wordWrap="break-word"),l.position="absolute",a||(l.visibility="hidden"),r.forEach(function(w){h&&w==="lineHeight"?l.lineHeight=f.height:l[w]=f[w]}),t?i.scrollHeight>parseInt(f.height)&&(l.overflowY="scroll"):l.overflow="hidden",u.textContent=i.value.substring(0,s),h&&(u.textContent=u.textContent.replace(/\s/g,"\xA0"));var d=document.createElement("span");d.textContent=i.value.substring(s)||".",u.appendChild(d);var m={top:d.offsetTop+parseInt(f.borderTopWidth),left:d.offsetLeft+parseInt(f.borderLeftWidth),height:parseInt(f.lineHeight)};return a?d.style.backgroundColor="#aaa":document.body.removeChild(u),m}typeof Hw<"u"&&typeof Hw.exports<"u"?Hw.exports=n:e&&(window.getCaretCoordinates=n)})()});var rd=r=>Array.isArray(r);var Zte=r=>({el:document.querySelector(r),elements:document.querySelectorAll(r),placeholder(e){return this.el.placeholder=e,this},getValue(){return this.el.value},insertAtCaret(e){return this.el.setRangeText(e,this.el.selectionStart,this.el.selectionEnd,"end"),this},setValue(e){this.el.value=e;let t=new Event("input",{bubbles:!0,cancelable:!0});return this.el.dispatchEvent(t),this},innerHTML(e){return this.el.innerHTML=e,this},html(e){return this.el.innerHTML="",this.append(e),this},append(e){return(rd(e)?e:[e]).forEach(n=>{let i=nd(n)?n:document.createTextNode(n);this.el.appendChild(i)}),this},appendListElement(e){let t=document.createElement("LI");return t.appendChild(document.createTextNode(e)),this.el.appendChild(t),this},removeClass(e){return this.el.classList.remove(e),this},removeClasses(e=[]){return e.map(t=>this.removeClass(t)),this},addClass(e){return this.el.classList.add(e),this},hasClass(e){return(" "+this.el.className+" ").indexOf(" "+e+" ")>-1},show(e=!0){return e?this.removeClass("hidden"):this.hide(),this},hide(){return this.addClass("hidden"),this},toggle(e="hidden"){return this.hasClass(e)?this.removeClass(e):this.addClass(e),this},focus(){return this.el.focus(),this},listenAll(e,t){return Array.prototype.slice.call(this.elements).map(i=>{i.addEventListener(e,s=>t(s.srcElement))}),this},listen(e,t){return this.el.addEventListener(e,n=>t(n,this)),this},click(){this.el&&this.el.click()},checked(e){return this.el.checked=!!e,this},disable(e=!0){return this.el.disabled=e,this}}),nd=r=>{try{return r instanceof HTMLElement}catch{return typeof r=="object"&&r.nodeType===1&&typeof r.style=="object"&&typeof r.ownerDocument=="object"}},Z=Zte;var jw={info:"info",success:"success",error:"error",warning:"warning"},Ww=Z("#notification"),Gw=()=>Ww.removeClasses(Object.values(jw));Ww.el.onclick=()=>Gw();var Jte=()=>Object.values(jw).reduce((r,e)=>({...r,[e](t){this.showNotification(t,e)}}),{}),ere=(r=5)=>({autohideDuration:r,timer:void 0,removeAfter(){this.timer=setTimeout(()=>{Gw()},this.autohideDuration*1e3)},showNotification(e,t=jw.info){Gw(),Ww.innerHTML(e).addClass(t),clearTimeout(this.timer),this.removeAfter()},...Jte()}),tre=ere(),Ce=tre;var rre=()=>{let r=localStorage.getItem("miropad.user");r?Ce.info(`\u{1F917} Happy to see you again from ${r}`):Ce.info(`<h1>Welcome \u{1F44B} \u{1F603} </h1>
       <p>Use  Ctrl+S:  to save your note<p/>
       <p>& Ctrl+P: to format a JSON doc<p/>
      `,100),localStorage.setItem("miropad.user",new Date().toLocaleDateString())},RA=rre;var nre=(()=>({set:function(r,e){return localStorage.setItem(r,e),this},update:function(r,e){let t=JSON.parse(this.get(r));return localStorage.setItem(r,JSON.stringify({...t,...e})),this},remove:function(r){return localStorage.removeItem(r),this},get:function(r){return rd(r)?r.reduce((e,t)=>({...e,[t]:this.get(t)}),{}):localStorage.getItem(r)},getDictionary:function(){let r=localStorage.getItem("__dictionary__");return r?JSON.parse(r):[]},removeFromDictionary:function(r){let t=this.getDictionary().filter(n=>n!==r);localStorage.setItem("__dictionary__",JSON.stringify(t))},saveToDictionary:async function(r){if(r.length)try{let e=r.toLowerCase().replace(/[^a-zA-Zά-ώΑ-Ω]/g," "),t=await this.getDictionary(),n=[...e.split(" ").filter(s=>s.length>3),...t],i=[...new Set(n)];localStorage.setItem("__dictionary__",JSON.stringify(i))}catch(e){Ce.error(`\u{1F631} Something went wrong while trying to save to local storage ${e}`)}else Ce.warning("\u{1F615} Nothing to save!");return this}}))(),xe=nre;var vc={github:{client_id:"70c1955dfe4914c52c10",request_state:"miro-pad"},auth_service:"https://vercel-api-phi.vercel.app/api/auth",mail_service:{api:"https://vercel-api-phi.vercel.app/api/mail",signature:`Theo Mironidis <br/>
    Software Engineer <br/>
    https://teomrd.github.io`}};var sg=(r,e=xe.get("authToken"))=>fetch(`https://api.github.com/gists/${r}`,{headers:{Authorization:`token ${e}`}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}),CA=(r=xe.get("authToken"))=>fetch("https://api.github.com/gists",{headers:{Authorization:`token ${r}`}}).then(e=>{if(!e.ok)throw Error(e.statusText);return e.json()}),PA=async(r,e=xe.get("gistId"),t=xe.get("authToken"))=>fetch(`https://api.github.com/gists/${e}`,{method:"PATCH",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[r]:null},description:"MiroPad Gist",public:!1})}).then(n=>{if(!n.ok)throw new Error(n.statusText);return n.json()}).then(n=>(Ce.info(`${r} deleted on Gist!`),n)),Yw=async(r=la(),e=xe.get("gistId"),t=xe.get("authToken"))=>{if(e&&t){let n=r.reduce((i,{id:s,text:o,deleted:a})=>({...i,[s]:a?null:{content:o}}),{});return fetch(`https://api.github.com/gists/${e}`,{method:"PATCH",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:n,description:"MiroPad Gist",public:!1})}).then(i=>{if(!i.ok)throw new Error(i.statusText);return i.json()}).then(i=>(r.map(({id:s,deleted:o})=>{o&&localStorage.removeItem(s)}),i))}},kA=(r=xe.get("authToken"))=>{let t=la().reduce((n,i)=>({...n,[i.id]:{content:i.text}}),{});return fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${r}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:t,description:"MiroPad Gist",public:!1})}).then(n=>{if(!n.ok)throw Error(n.statusText);return n.json()}).then(n=>n)},DA=(r,e)=>fetch(`${vc.auth_service}?state=${e}&code=${r}`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}).then(t=>t),NA=({note:r,token:e=xe.get("authToken")}={})=>fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${e}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[r.id]:{content:r.text}},description:"MiroPad Gist",public:!0})}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}).then(t=>t);var ire=BA,OA=128,sre=127,ore=~sre,are=Math.pow(2,31);function BA(r,e,t){e=e||[],t=t||0;for(var n=t;r>=are;)e[t++]=r&255|OA,r/=128;for(;r&ore;)e[t++]=r&255|OA,r>>>=7;return e[t]=r|0,BA.bytes=t-n+1,e}var cre=Qw,ure=128,LA=127;function Qw(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Qw.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&LA)<<i:(o&LA)*Math.pow(2,i),i+=7}while(o>=ure);return Qw.bytes=s-n,t}var lre=Math.pow(2,7),fre=Math.pow(2,14),dre=Math.pow(2,21),hre=Math.pow(2,28),pre=Math.pow(2,35),mre=Math.pow(2,42),gre=Math.pow(2,49),yre=Math.pow(2,56),wre=Math.pow(2,63),bre=function(r){return r<lre?1:r<fre?2:r<dre?3:r<hre?4:r<pre?5:r<mre?6:r<gre?7:r<yre?8:r<wre?9:10},_re={encode:ire,decode:cre,encodingLength:bre},Ere=_re,ep=Ere;var tp=(r,e=0)=>[ep.decode(r,e),ep.decode.bytes],id=(r,e,t=0)=>(ep.encode(r,e,t),e),sd=r=>ep.encodingLength(r);var nl={};zt(nl,{coerce:()=>qi,empty:()=>MA,equals:()=>Xw,fromHex:()=>Sre,fromString:()=>Zw,isBinary:()=>xre,toHex:()=>vre,toString:()=>Jw});var MA=new Uint8Array(0),vre=r=>r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),Sre=r=>{let e=r.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):MA},Xw=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},qi=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},xre=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),Zw=r=>new TextEncoder().encode(r),Jw=r=>new TextDecoder().decode(r);var oo=(r,e)=>{let t=e.byteLength,n=sd(r),i=n+sd(t),s=new Uint8Array(i+t);return id(r,s,0),id(t,s,n),s.set(e,i),new od(r,t,e,s)},Xt=r=>{let e=qi(r),[t,n]=tp(e),[i,s]=tp(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new od(t,i,o,e)},UA=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Xw(r.bytes,t.bytes)}},od=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var i7={};zt(i7,{base58btc:()=>Te,base58flickr:()=>Pre});function Tre(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var w=0,b=0,v=0,T=m.length;v!==T&&m[v]===0;)v++,w++;for(var p=(T-v)*l+1>>>0,g=new Uint8Array(p);v!==T;){for(var y=m[v],E=0,_=p-1;(y!==0||E<b)&&_!==-1;_--,E++)y+=256*g[_]>>>0,g[_]=y%a>>>0,y=y/a>>>0;if(y!==0)throw new Error("Non-zero carry");b=E,v++}for(var x=p-b;x!==p&&g[x]===0;)x++;for(var S=c.repeat(w);x<p;++x)S+=r.charAt(g[x]);return S}function h(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var w=0;if(m[w]!==" "){for(var b=0,v=0;m[w]===c;)b++,w++;for(var T=(m.length-w)*u+1>>>0,p=new Uint8Array(T);m[w];){var g=t[m.charCodeAt(w)];if(g===255)return;for(var y=0,E=T-1;(g!==0||y<v)&&E!==-1;E--,y++)g+=a*p[E]>>>0,p[E]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");v=y,w++}if(m[w]!==" "){for(var _=T-v;_!==T&&p[_]===0;)_++;for(var x=new Uint8Array(b+(T-_)),S=b;_!==T;)x[S++]=p[_++];return x}}}function d(m){var w=h(m);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:d}}var Are=Tre,Ire=Are,FA=Ire;var e7=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},t7=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return VA(this,e)}},r7=class{constructor(e){this.decoders=e}or(e){return VA(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},VA=(r,e)=>new r7({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),n7=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new e7(e,t,n),this.decoder=new t7(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},ad=({name:r,prefix:e,encode:t,decode:n})=>new n7(r,e,t,n),Sc=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=FA(t,e);return ad({prefix:r,name:e,encode:n,decode:s=>qi(i(s))})},Rre=(r,e,t,n)=>{let i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,u=0;for(let l=0;l<s;++l){let f=i[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Cre=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},Sr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>ad({prefix:e,name:r,encode(i){return Cre(i,n,t)},decode(i){return Rre(i,n,t,r)}});var Te=Sc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Pre=Sc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var a7={};zt(a7,{base32:()=>ut,base32hex:()=>Dre,base32hexpad:()=>Ore,base32hexpadupper:()=>Lre,base32hexupper:()=>Nre,base32pad:()=>o7,base32padupper:()=>kre,base32upper:()=>s7,base32z:()=>Bre});var ut=Sr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),s7=Sr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o7=Sr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kre=Sr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dre=Sr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Nre=Sr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ore=Sr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Lre=Sr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bre=Sr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var zA=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return Ure(t,c7(r),e||Te.encoder);default:return Fre(t,c7(r),e||ut.encoder)}};var KA=new WeakMap,c7=r=>{let e=KA.get(r);if(e==null){let t=new Map;return KA.set(r,t),t}return e},P=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==rp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Vre)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return P.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=oo(e,t);return P.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return P.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&UA(e.multihash,n.multihash)}toString(e){return zA(this,e)}toJSON(){return{"/":zA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof P)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:s,bytes:o}=t;return new P(n,i,s,o||HA(n,i,s.bytes))}else if(t[zre]===!0){let{version:n,multihash:i,code:s}=t,o=Xt(i);return P.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==rp)throw new Error(`Version 0 CID must use dag-pb (code: ${rp}) block encoding`);return new P(e,t,n,n.bytes)}case 1:{let i=HA(e,t,n.bytes);return new P(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return P.create(0,rp,e)}static createV1(e,t){return P.create(1,e,t)}static decode(e){let[t,n]=P.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=P.inspectBytes(e),n=t.size-t.multihashSize,i=qi(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),o=new od(t.multihashCode,t.digestSize,s,i);return[t.version===0?P.createV0(o):P.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=tp(e.subarray(t));return t+=h,f},i=n(),s=rp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[n,i]=Mre(e,t),s=P.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return c7(s).set(n,e),s}},Mre=(r,e)=>{switch(r[0]){case"Q":{let t=e||Te;return[Te.prefix,t.decode(`${Te.prefix}${r}`)]}case Te.prefix:{let t=e||Te;return[Te.prefix,t.decode(r)]}case ut.prefix:{let t=e||ut;return[ut.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Ure=(r,e,t)=>{let{prefix:n}=t;if(n!==Te.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return i},Fre=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let s=t.encode(r);return e.set(n,s),s}else return i},rp=112,Vre=18,HA=(r,e,t)=>{let n=sd(r),i=n+sd(e),s=new Uint8Array(i+t.byteLength);return id(r,s,0),id(e,s,n),s.set(t,i),s},zre=Symbol.for("@ipld/js-cid/CID");var ip={};zt(ip,{code:()=>np,decode:()=>qre,encode:()=>u7,name:()=>$re});var Kre=new TextEncoder,Hre=new TextDecoder,$re="json",np=512,u7=r=>Kre.encode(JSON.stringify(r)),qre=r=>JSON.parse(Hre.decode(r));var f7={};zt(f7,{sha256:()=>Pe,sha512:()=>Gre});var il=({name:r,code:e,encode:t})=>new l7(r,e,t),l7=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?oo(this.code,t):t.then(n=>oo(this.code,n))}else throw Error("Unknown type, must be binary type")}};var qA=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Pe=il({name:"sha2-256",code:18,encode:qA("SHA-256")}),Gre=il({name:"sha2-512",code:19,encode:qA("SHA-512")});var jre=async r=>{let e=u7(r),t=await Pe.digest(e);return P.create(1,np,t).toString()},ag=jre;var Wre=r=>{try{JSON.parse(r)}catch{return!1}return!0},cg=Wre;var GA=()=>document.title.split("|")[0],d7=r=>{let e=GA();document.title=e.trim()+" | "+r.trim(),Z(".title h3").html(r.trim())},ug=()=>{let r=GA();document.title=r,Z("title").innerHTML("\u270D\uFE0F MiroPad v2.13.24"),Z(".title h3").innerHTML('\u270D\uFE0F MiroPad <span class="version">v2.13.24</span>')};var je={baseUrl:`${window.location.origin}${window.location.pathname}`,get:function(){return window.location.href},getPageId:function(r=window.location.href){return new URL(r).hash.substr(1).split("?")[0]||null},getSearchParams:function(r=window.location.href){let n=new URL(r).href.split("?")[1]||"";return new URLSearchParams(n)},getParamsObject:function(r=window.location.href){let e=this.getSearchParams(r),t={};for(let n of e.keys())t={...t,[n]:this.getSearchParam(n,r)};return t},getSearchParam(r,e=window.location.href){return this.getSearchParams(e).get(r)},deleteParam:function(r){let e=this.getSearchParams();typeof r=="object"&&r.length>0?r.forEach(i=>{e.delete(i)}):e.delete(r);let{pathname:t}=window.location,n=this.getPageId();return window.location.assign(`${n?`#${n}`:t}${e.toString()?`?${e.toString()}`:""}`)},set:function(r=this.getPageId(),e=this.getParamsObject()){let t={...this.getParamsObject(),...e},n=new URLSearchParams(t);return window.location.assign(`#${r}?${n.toString()}`)}};var fa=(r=!0)=>{r?(Z("#save").removeClass("unsaved"),Z("#logo").removeClass("unsaved")):(Z("#save").addClass("unsaved"),Z("#logo").addClass("unsaved"))};var jA=r=>{let e=encodeURIComponent(r);if(e.length===0)throw new Error("You need to start with a valid title for your note!");return e},lg=r=>{let e=YA(r),t=Dr(e),{dateCreated:n}=t||{};return n},Yre=r=>{let e=Dr(r);localStorage.setItem(r,JSON.stringify({title:e.title,deleted:!0,revisions:e.revisions}))},Dr=(r=je.getPageId(),e)=>{let t;try{if(t=JSON.parse(xe.get(r)),!t.revisions)throw new Error("This is not a note!")}catch{return null}let n=t?Object.values(t.revisions).reduce((s,o)=>o.dateCreated>s.dateCreated?o:s,{dateCreated:0}):{},i=e?t.revisions[e]:n;return r?{...t,id:r,...i||{},numberOfRevisions:t&&t.revisions?Object.keys(t.revisions).length:void 0,title:t.title}:null},WA=r=>{let{id:e,title:t}=Dr();xe.update(e,{disableSync:r}),Ce.info(`"${t}" cloud sync ${r?"disabled \u{1F636}":"enabled \u26A1\uFE0F"}`)},fg=async(r=je.getPageId())=>{if(r){let e=je.getSearchParam("v"),t=Dr(void 0,e);t&&(Z("#revisions").html(`${t.numberOfRevisions} revision${t.numberOfRevisions>1?"s":""}`),d7(t.title),Z(".terminal").setValue(t.text)),t||Ce.error("404 Note not found \u{1F937}\u200D\u2642\uFE0F")}},dg=()=>{location.hash="",ug(),Z("#revisions").html(""),Z(".terminal").setValue("").focus(),fa()},cd=(r="")=>r.split(`
`)[0].trim().replace("#","").trim(),YA=r=>{let e=cd(r);return jA(e)},QA=async r=>{if(r.length){let e=YA(r),t=cd(r),n=Dr(e);if(n===null)return sp(r);let{text:i}=n,s=await ag(r),o=await ag(i);if(s===o)return;let a=xe.get(e),c=JSON.parse(a);xe.set(e,JSON.stringify({...c,title:t,revisions:{...c&&c.revisions||{},[s]:{dateCreated:Date.now(),text:r}}}))}},sp=async(r=Z(".terminal").getValue(),e)=>{if(await xe.saveToDictionary(r),r.length){let t=await ag(r);try{let n=r.split(`
`)[0].trim().replace("#","").trim();d7(n);let i=jA(n),s=xe.get(i),o=JSON.parse(s);xe.set(i,JSON.stringify({...o,title:n,lines:r.split(`
`),revisions:{...o&&o.revisions||{},[t]:{dateCreated:Date.now(),text:r,...e?{cid:e}:{}}}})),je.set(i,{v:t,...e?{cid:e}:{}}),e||je.deleteParam("cid"),xe.set("lastLocalUpdate",new Date),Ce.success("\u{1F44C} Note saved!"),fa()}catch(n){Ce.error(`\u{1F631} Something went wrong while trying to save to local storage ${n}`)}}else Ce.warning("\u{1F615} Nothing to save!")},la=({includeDeleted:r}={})=>Object.entries(localStorage).filter(([,e])=>typeof e=="string").filter(([e,t])=>!e.startsWith("__")&&cg(t)).map(([e,t])=>[e,JSON.parse(t)]).filter(([,e])=>!!e.title).reduce((e,[t])=>[...e,Dr(t)],[]).filter(({deleted:e})=>r?!0:!e),XA=r=>r?la().map(({id:t})=>Dr(t)).filter(({text:t})=>t.toLowerCase().includes(r.toLowerCase()))[0]:void 0,hg=()=>{if(confirm("Are you sure you want do that?")){let e=Dr();dg(),e&&e.id&&(PA(e.id),Yre(e.id))}lt.hide()};var ZA=()=>!!xe.get("authToken");var xc=({title:r,secondary:e,onclick:t,onSecondaryClick:n,icon:i},s=!1)=>{let o=document.createElement("LI");if(o.className=s?"selected":"",i){let u=i.cloneNode(!0);o.appendChild(u)}let a=nd(r)?r:document.createTextNode(r);a.onclick=t,o.appendChild(a);let c=document.createElement("span");if(e){c.className="secondary";let u=nd(e)?e:document.createTextNode(e);u.onclick=n,c.appendChild(u)}return o.appendChild(c),o};var JA=(r,e)=>r.map((t,n)=>xc(t,n===e));var eI=(r,e)=>{let t=r.toLowerCase().split(e),n=0;return t.reduce((i,s,o)=>[...i,...o===0?[s]:[e,s]],[]).filter(i=>i!=="").map(i=>{n=n+i.length;let s=n-i.length,o=s+i.length;return r.slice(s,o)})};var tI=r=>{let e=document.createElement("mark");return e.appendChild(document.createTextNode(r)),e},da=({content:r="",highlight:e=""})=>{let t=document.createElement("div"),n=r.split(" "),i=e.toLowerCase().split(" ");return e.trim()===""?(t.appendChild(document.createTextNode(r)),t):(n.map(s=>{let o=i.map(a=>s.toLocaleLowerCase().includes(a)?a:void 0).filter(a=>a!==void 0);return{word:s,matches:o}}).forEach(({word:s,matches:o})=>{if(o.length>0){let a=o[0];if(s===a)t.appendChild(tI(` ${s}`));else{let u=eI(s,a).map(l=>l.toLowerCase()===a?tI(l):document.createTextNode(l));t.appendChild(document.createTextNode(" ")),u.forEach(l=>{t.appendChild(l)})}}else t.appendChild(document.createTextNode(` ${s} `))}),t)};var rI=async()=>(Ce.info("You need to be authenticated!"),lt.hide(),window.location.replace(`https://github.com/login/oauth/authorize?client_id=${vc.github.client_id}&scope=gist&state=${vc.github.request_state}`)),nI=async r=>{Ce.info("Downloading my Gists!");let e=await CA(r);lt.setState({mode:lt.getModes().gists}),Ce.info("Select Gist to sync with");let t=e.sort((i,s)=>new Date(s.updated_at).getTime()-new Date(i.updated_at).getTime()).map(({description:i,updated_at:s,id:o})=>({title:da({content:`${i}(${o})`}),secondary:s,onclick:async()=>{await xe.set("gistId",o),Ce.success(`${i}(${o}) selected for synchronization!`),op(),lt.hide()}})),n=JA([{title:"Create a new Gist",onclick:async()=>{Ce.info("Syncing your MiroPads to a new Gist");try{let{id:i}=await kA();xe.set("gistId",i),Ce.success("MiroPads synced to a new Gist \u{1F389}")}catch(i){Ce.error(i.message)}lt.hide()}},...t]);Z("#commands").html(""),Z("#commands").append(n)},op=async(r=xe.get("gistId"))=>{if(xe.get("authToken")&&r){Z("#logo").addClass("loading");let{files:t}=await sg(r);Object.values(t).forEach(({content:n})=>{QA(n)}),xe.set("lastSync",new Date),Ce.success("\u2B07 MiroPad synced \u2705"),Z("#logo").removeClass("loading")}},iI=async()=>{let r=je.getSearchParam("code"),e=je.getSearchParam("state");if(r&&e){Z("#logo").addClass("loading"),Ce.info("\u{1F510} Authenticating...");try{let{token:t}=await DA(r,e);xe.set("authToken",t),Ce.info("\u26F3 You have been authenticated!"),je.deleteParam(["code","state"])}catch(t){Ce.error(t.message)}Z("#logo").removeClass("loading")}};var Qre=async(r="no-titled")=>{let e={suggestedName:`${r}`,types:[{description:"MiroPad text notes",accept:{"text/plain":[".miropad"]}}]};return await window.showSaveFilePicker(e)},Xre=async(r,e)=>{let t=await r.createWritable();await t.write(e),await t.close()},sI=async(r,e)=>{try{let t=await Qre(e);await Xre(t,r)}catch{let n="An error occurred trying to save the file.";Ce.error(n);return}},oI=(()=>{let r=document.createElement("a");return document.body.appendChild(r),r.style="display: none",(e,t=`MiroPad-${new Date().toISOString()}.json`)=>{let n=JSON.stringify(e),i=new Blob([n],{type:"octet/stream"}),s=window.URL.createObjectURL(i);r.href=s,r.download=t,r.click(),window.URL.revokeObjectURL(s)}})();var uI=C(cI()),lI=new uI.default.Converter({tasklists:!0,emoji:!0,simplifiedAutoLink:!0,tables:!0,openLinksInNewWindow:!0});lI.setFlavor("github");var mg=r=>lI.makeHtml(r);var Zre=r=>{if(r.status.toString().slice(0,1)==="2")return r;throw new Error(r)},Jre=(r="")=>`<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
    </head>
    <table style="width:100%;background-color:#ffffff" align="center" border="0" cellPadding="0" cellSpacing="0" role="presentation">
      <tbody>
        <tr>
          <td>
            <div><!--[if mso | IE]>
              <table role="presentation" width="100%" align="center" style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px;"><tr><td></td><td style="width:37.5em;background:#ffffff">
            <![endif]--></div>

            <div style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px"><img alt="Theo Mironidis Logo" src="https://teomrd.github.io/miroFavicon.f0c5b85b.png" width="42" height="42" style="display:block;outline:none;border:none;text-decoration:none;wwwwidth:42px;height:42px" />
              ${r}
              <hr style="width:100%;border:none;border-top:1px solid #eaeaea;border-color:#dfe1e4;margin:42px 0 26px" />
              <a target="_blank" style="color:#b4becc;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen-Sans,Ubuntu,Cantarell,&quot;Helvetica Neue&quot;,sans-serif;font-size:14px" href="https://teomrd.github.io">
              ${vc.mail_service.signature}
              </a>
            </div>
            <div><!--[if mso | IE]>
            </td><td></td></tr></table>
            <![endif]--></div>
          </td>
        </tr>
      </tbody>
    </table>
  </html>`,ene=async(r,e,t="MiroPad note")=>{if(!r){Ce.error("\u{1F47B} No message to send, type something and try again! \u{1F913}");return}try{await fetch(`${vc.mail_service.api}`,{method:"POST",headers:{"x-secret-token":xe.get("MIROPAD_SECRET_TOKEN"),accept:"application/json","content-type":"application/json"},body:JSON.stringify({to:e,subject:t,html:Jre(r)})}).then(Zre).then(n=>n.json()),Ce.success("Email sent \u{1F680}")}catch{Ce.error("Error not went through \u{1F4A5}! Check your credentials and try again!")}},tne=()=>{let r=xe.get("mail");if(r){let n=window.prompt(`Mail ${r} again? (y)es/(no)`,"yeap");if(n===null)return n;if(n.slice(0,1).toLowerCase()==="y")return r}let e=window.prompt("Where do you wanna send the mail to?"),t=window.prompt("Do you wanna save that to your preferences for later on? (y)es/(no)","yeap");return t&&t.slice(0,1).toLowerCase()==="y"&&xe.set("mail",e),e},fI=r=>{let e=tne();if(e===null){Ce.info("Sending mail cancelled \u{1F636}");return}Ce.info("Sending mail... \u{1F680}");let t=cd(r),n=mg(r);ene(n,e,t)};var ha=async(r,e="\u{1F4CB} Copied to clipboard")=>{try{await navigator.clipboard.writeText(r),Ce.success(e)}catch(t){Ce.error(t.message)}};var gg=(r,e,t)=>{let n=rd(r)?r:[r],i=document.createElement("button");return i.setAttribute("type","button"),t&&i.setAttribute("id",t),n.forEach(s=>{typeof s=="string"?i.appendChild(document.createTextNode(s)):i.appendChild(s)}),i.onclick=s=>e(s),i};var rne=(()=>({view:Z(".preview"),init:function(){return this.update(),Z(".terminal").listen("input",()=>this.update()),Boolean(je.getSearchParam("md"))?this.view.show():this.view.hide(),this},update:async function(){let md=Z(".terminal").getValue();this.view.innerHTML(mg(md));let{elements}=Z("pre");Array.prototype.slice.call(elements).forEach(r=>{let e=gg("\u{1F4CB} Copy",async t=>{t.stopPropagation();let n=t.srcElement.previousSibling.innerHTML;await ha(n,"\u{1F4CB} Code copied to clipboard")});r.appendChild(e)}),Z("code").listenAll("click",async({innerHTML})=>{let result=eval(innerHTML);Z(".console").show().innerHTML(result)}),Z(".console").listen("click",async r=>{r.srcElement.classList.add("hidden");let e=r.srcElement.innerHTML;await ha(e,"\u{1F4CB} Code copied to clipboard")})},show:function(r=!0){this.view.show(),je.set(void 0,{md:r})},hide:function(){this.view.hide(),je.deleteParam("md")},toggle:function(r="true"){return je.getSearchParam("md")===r?this.hide():this.show(r),this}}))(),ud=rne;var nne=r=>{let e=document.querySelector(r);if(cg(e.value)){let t=JSON.stringify(JSON.parse(e.value),null,2);e.value=t,Ce.success("\u{1F44D} JSON value prettified")}else Ce.error("\u{1F627} Value is not in valid JSON format")},dI=nne;var hI=(r=1e3)=>new Promise(e=>{setTimeout(e,r)});var Zt=(r,e,t)=>{let n=document.createElement("IMG");return t&&n.classList.add(t),e&&n.setAttribute("alt",e),n.setAttribute("src",r),n};var pI="./list-LK7OCHR7.svg";var ap="./trash-RDL437QG.svg";var mI="./checkmark-circle-JQ7ADSUI.svg";var gI="./cloud-sync-F3RLGHML.svg";var yI="./lighter-UBEI67LL.svg";var wI="./enter-down-6TVO6OFR.svg";var bI="./download-FVXMIYZ4.svg";var _I="./envelope-Z2VRVSLR.svg";var EI="./bug-36UGMUXT.svg";var vI="./picture-3TDOSVS3.svg";var SI="./printer-B7RMPYZC.svg";var xI="./page-break-BLVP5QBQ.svg";var TI="./frame-expand-CX6CNP53.svg";var AI="./arrow-right-circle-2Q6EHM2H.svg";var II="./magic-wand-JQJ6EKRO.svg";var RI="./rocket-AIY2RJJS.svg";var CI="./earth-DJLABK7O.svg";var PI="./spell-check-V6QYTGNT.svg";var kI="./pencil-X3ZMY3QU.svg";var h7="./exit-up-GH6BPN2X.svg";var DI="./leaf-CGBE7XAJ.svg";var NI=async()=>{try{let r=Dr(),e=je.get();await navigator.share({title:r?r.title:"\u270D\uFE0F MiroPad",text:r?r.text:"Temporary note keeping app for the browser",url:e})}catch(r){Ce.info(`${r.message}`)}};var zI=C(m7(),1),Ve=zI.default;var vte=C(_g(),1);var co=C(Gi(),1);var y7={};zt(y7,{base64:()=>ao,base64pad:()=>Xne,base64url:()=>Tc,base64urlpad:()=>Zne});var ao=Sr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Xne=Sr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Tc=Sr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Zne=Sr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});co.default.formatters.b=r=>r==null?"undefined":Te.baseEncode(r);co.default.formatters.t=r=>r==null?"undefined":ut.baseEncode(r);co.default.formatters.m=r=>r==null?"undefined":ao.baseEncode(r);co.default.formatters.p=r=>r==null?"undefined":r.toString();co.default.formatters.c=r=>r==null?"undefined":r.toString();co.default.formatters.k=r=>r==null?"undefined":r.toString();function D(r){return Object.assign((0,co.default)(r),{error:(0,co.default)(`${r}:error`),trace:(0,co.default)(`${r}:trace`)})}var zw=C(Y(),1);var Cg=C(Y(),1);var ma=C(fo(),1),yd=ma.default.Reader,U7=ma.default.Writer,Oe=ma.default.util,_n=ma.default.roots["ipfs-unixfs"]||(ma.default.roots["ipfs-unixfs"]={}),MR=_n.Data=(()=>{function r(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Type=0,r.prototype.Data=Oe.newBuffer([]),r.prototype.filesize=Oe.Long?Oe.Long.fromBits(0,0,!0):0,r.prototype.blocksizes=Oe.emptyArray,r.prototype.hashType=Oe.Long?Oe.Long.fromBits(0,0,!0):0,r.prototype.fanout=Oe.Long?Oe.Long.fromBits(0,0,!0):0,r.prototype.mode=0,r.prototype.mtime=null,r.encode=function(t,n){if(n||(n=U7.create()),n.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&n.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&n.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var i=0;i<t.blocksizes.length;++i)n.uint32(32).uint64(t.blocksizes[i]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&n.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&n.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&n.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&_n.UnixTime.encode(t.mtime,n.uint32(66).fork()).ldelim(),n},r.decode=function(t,n){t instanceof yd||(t=yd.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new _n.Data;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.Type=t.int32();break;case 2:s.Data=t.bytes();break;case 3:s.filesize=t.uint64();break;case 4:if(s.blocksizes&&s.blocksizes.length||(s.blocksizes=[]),(o&7)===2)for(var a=t.uint32()+t.pos;t.pos<a;)s.blocksizes.push(t.uint64());else s.blocksizes.push(t.uint64());break;case 5:s.hashType=t.uint64();break;case 6:s.fanout=t.uint64();break;case 7:s.mode=t.uint32();break;case 8:s.mtime=_n.UnixTime.decode(t,t.uint32());break;default:t.skipType(o&7);break}}if(!s.hasOwnProperty("Type"))throw Oe.ProtocolError("missing required 'Type'",{instance:s});return s},r.fromObject=function(t){if(t instanceof _n.Data)return t;var n=new _n.Data;switch(t.Type){case"Raw":case 0:n.Type=0;break;case"Directory":case 1:n.Type=1;break;case"File":case 2:n.Type=2;break;case"Metadata":case 3:n.Type=3;break;case"Symlink":case 4:n.Type=4;break;case"HAMTShard":case 5:n.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?Oe.base64.decode(t.Data,n.Data=Oe.newBuffer(Oe.base64.length(t.Data)),0):t.Data.length&&(n.Data=t.Data)),t.filesize!=null&&(Oe.Long?(n.filesize=Oe.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?n.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?n.filesize=t.filesize:typeof t.filesize=="object"&&(n.filesize=new Oe.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");n.blocksizes=[];for(var i=0;i<t.blocksizes.length;++i)Oe.Long?(n.blocksizes[i]=Oe.Long.fromValue(t.blocksizes[i])).unsigned=!0:typeof t.blocksizes[i]=="string"?n.blocksizes[i]=parseInt(t.blocksizes[i],10):typeof t.blocksizes[i]=="number"?n.blocksizes[i]=t.blocksizes[i]:typeof t.blocksizes[i]=="object"&&(n.blocksizes[i]=new Oe.LongBits(t.blocksizes[i].low>>>0,t.blocksizes[i].high>>>0).toNumber(!0))}if(t.hashType!=null&&(Oe.Long?(n.hashType=Oe.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?n.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?n.hashType=t.hashType:typeof t.hashType=="object"&&(n.hashType=new Oe.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(Oe.Long?(n.fanout=Oe.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?n.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?n.fanout=t.fanout:typeof t.fanout=="object"&&(n.fanout=new Oe.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(n.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");n.mtime=_n.UnixTime.fromObject(t.mtime)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocksizes=[]),n.defaults){if(i.Type=n.enums===String?"Raw":0,n.bytes===String?i.Data="":(i.Data=[],n.bytes!==Array&&(i.Data=Oe.newBuffer(i.Data))),Oe.Long){var s=new Oe.Long(0,0,!0);i.filesize=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.filesize=n.longs===String?"0":0;if(Oe.Long){var s=new Oe.Long(0,0,!0);i.hashType=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.hashType=n.longs===String?"0":0;if(Oe.Long){var s=new Oe.Long(0,0,!0);i.fanout=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.fanout=n.longs===String?"0":0;i.mode=0,i.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(i.Type=n.enums===String?_n.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(i.Data=n.bytes===String?Oe.base64.encode(t.Data,0,t.Data.length):n.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?i.filesize=n.longs===String?String(t.filesize):t.filesize:i.filesize=n.longs===String?Oe.Long.prototype.toString.call(t.filesize):n.longs===Number?new Oe.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){i.blocksizes=[];for(var o=0;o<t.blocksizes.length;++o)typeof t.blocksizes[o]=="number"?i.blocksizes[o]=n.longs===String?String(t.blocksizes[o]):t.blocksizes[o]:i.blocksizes[o]=n.longs===String?Oe.Long.prototype.toString.call(t.blocksizes[o]):n.longs===Number?new Oe.LongBits(t.blocksizes[o].low>>>0,t.blocksizes[o].high>>>0).toNumber(!0):t.blocksizes[o]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?i.hashType=n.longs===String?String(t.hashType):t.hashType:i.hashType=n.longs===String?Oe.Long.prototype.toString.call(t.hashType):n.longs===Number?new Oe.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?i.fanout=n.longs===String?String(t.fanout):t.fanout:i.fanout=n.longs===String?Oe.Long.prototype.toString.call(t.fanout):n.longs===Number?new Oe.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(i.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(i.mtime=_n.UnixTime.toObject(t.mtime,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,ma.default.util.toJSONOptions)},r.DataType=function(){let e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),r})(),s9e=_n.UnixTime=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Seconds=Oe.Long?Oe.Long.fromBits(0,0,!1):0,r.prototype.FractionalNanoseconds=0,r.encode=function(t,n){return n||(n=U7.create()),n.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&n.uint32(21).fixed32(t.FractionalNanoseconds),n},r.decode=function(t,n){t instanceof yd||(t=yd.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new _n.UnixTime;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.Seconds=t.int64();break;case 2:s.FractionalNanoseconds=t.fixed32();break;default:t.skipType(o&7);break}}if(!s.hasOwnProperty("Seconds"))throw Oe.ProtocolError("missing required 'Seconds'",{instance:s});return s},r.fromObject=function(t){if(t instanceof _n.UnixTime)return t;var n=new _n.UnixTime;return t.Seconds!=null&&(Oe.Long?(n.Seconds=Oe.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?n.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?n.Seconds=t.Seconds:typeof t.Seconds=="object"&&(n.Seconds=new Oe.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(n.FractionalNanoseconds=t.FractionalNanoseconds>>>0),n},r.toObject=function(t,n){n||(n={});var i={};if(n.defaults){if(Oe.Long){var s=new Oe.Long(0,0,!1);i.Seconds=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.Seconds=n.longs===String?"0":0;i.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?i.Seconds=n.longs===String?String(t.Seconds):t.Seconds:i.Seconds=n.longs===String?Oe.Long.prototype.toString.call(t.Seconds):n.longs===Number?new Oe.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(i.FractionalNanoseconds=t.FractionalNanoseconds),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,ma.default.util.toJSONOptions)},r})(),o9e=_n.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.MimeType="",r.encode=function(t,n){return n||(n=U7.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&n.uint32(10).string(t.MimeType),n},r.decode=function(t,n){t instanceof yd||(t=yd.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new _n.Metadata;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.MimeType=t.string();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof _n.Metadata)return t;var n=new _n.Metadata;return t.MimeType!=null&&(n.MimeType=String(t.MimeType)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(i.MimeType=t.MimeType),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,ma.default.util.toJSONOptions)},r})();var ga=MR,UR=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],lie=["directory","hamt-sharded-directory"],FR=parseInt("0644",8),VR=parseInt("0755",8);function ya(r){if(r!=null)return typeof r=="number"?r&4095:(r=r.toString(),r.substring(0,1)==="0"?parseInt(r,8)&4095:parseInt(r,10)&4095)}function Rc(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,Cg.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}var He=class{static unmarshal(e){let t=ga.decode(e),n=ga.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),i=new He({type:UR[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return i._originalMode=n.mode||0,i}constructor(e={type:"file"}){let{type:t,data:n,blockSizes:i,hashType:s,fanout:o,mtime:a,mode:c}=e;if(t&&!UR.includes(t))throw(0,Cg.default)(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=o,this.blockSizes=i||[],this._originalMode=0,this.mode=ya(c),a&&(this.mtime=Rc(a),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?VR:FR;let t=ya(e);t!==void 0&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&lie.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach(t=>{e+=t}),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=ga.DataType.Raw;break;case"directory":e=ga.DataType.Directory;break;case"file":e=ga.DataType.File;break;case"metadata":e=ga.DataType.Metadata;break;case"symlink":e=ga.DataType.Symlink;break;case"hamt-sharded-directory":e=ga.DataType.HAMTShard;break;default:throw(0,Cg.default)(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t=this.data;(!this.data||!this.data.length)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(ya(this.mode)||0),n===FR&&!this.isDirectory()&&(n=void 0),n===VR&&this.isDirectory()&&(n=void 0));let i;if(this.mtime!=null){let o=Rc(this.mtime);o&&(i={Seconds:o.secs,FractionalNanoseconds:o.nsecs},i.FractionalNanoseconds===0&&delete i.FractionalNanoseconds)}let s={Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i};return ga.encode(s).finish()}};var mt={};zt(mt,{code:()=>Xe,createLink:()=>QR,createNode:()=>YR,decode:()=>pt,encode:()=>ze,name:()=>Eie,prepare:()=>on,validate:()=>z7});var fie=new TextDecoder;function F7(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function Pg(r,e){let t;[t,e]=F7(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function zR(r,e){let t;return[t,e]=F7(r,e),[t&7,t>>3,e]}function die(r){let e={},t=r.length,n=0;for(;n<t;){let i,s;if([i,s,n]=zR(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Pg(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=Pg(r,n),e.Name=fie.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=F7(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function KR(r){let e=r.length,t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=zR(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=Pg(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,t]=Pg(r,t),n.push(die(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return s&&(o.Data=s),o.Links=n||[],o}var $R=new TextEncoder,HR=2**32,hie=2**31;function pie(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=dp(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=$R.encode(r.Name);t-=n.length,e.set(n,t),t=dp(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=dp(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function qR(r){let e=gie(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=dp(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){let s=pie(r.Links[i],t.subarray(0,n));n-=s,n=dp(t,n,s)-1,t[n]=18}return t}function mie(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+wd(t)}if(typeof r.Name=="string"){let t=$R.encode(r.Name).length;e+=1+t+wd(t)}return typeof r.Tsize=="number"&&(e+=1+wd(r.Tsize)),e}function gie(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+wd(t)}if(r.Links)for(let t of r.Links){let n=mie(t);e+=1+n+wd(n)}return e}function dp(r,e,t){e-=wd(t);let n=e;for(;t>=hie;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function wd(r){return r%2===0&&r++,Math.floor((yie(r)+6)/7)}function yie(r){let e=0;return r>=HR&&(r=Math.floor(r/HR),e=32),r>=1<<16&&(r>>>=16,e+=16),r>=1<<8&&(r>>>=8,e+=8),e+wie[r]}var wie=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var bie=["Data","Links"],_ie=["Hash","Name","Tsize"],V7=new TextEncoder;function jR(r,e){if(r===e)return 0;let t=r.Name?V7.encode(r.Name):[],n=e.Name?V7.encode(e.Name):[],i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function GR(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function WR(r){if(typeof r.asCID=="object"){let t=P.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Hash){let t=P.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=P.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=P.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function on(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=V7.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(WR),e.Links.sort(jR);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function z7(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!GR(r,bie))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!GR(t,_ie))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&jR(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function YR(r,e=[]){return on({Data:r,Links:e})}function QR(r,e,t){return WR({Hash:t,Name:r,Tsize:e})}var Eie="dag-pb",Xe=112;function ze(r){z7(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),qR(e)}function pt(r){let e=KR(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{let i={};try{i.Hash=P.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),t}var _a={};zt(_a,{code:()=>_p,decode:()=>ul,encode:()=>Ep,name:()=>ese});var vie=["string","number","bigint","symbol"],Sie=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function XR(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(vie.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(xie(r))return"Buffer";let t=Tie(r);return t||"Object"}function xie(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function Tie(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(Sie.includes(e))return e}var z=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};z.uint=new z(0,"uint",!0);z.negint=new z(1,"negint",!0);z.bytes=new z(2,"bytes",!0);z.string=new z(3,"string",!0);z.array=new z(4,"array",!1);z.map=new z(5,"map",!1);z.tag=new z(6,"tag",!1);z.float=new z(7,"float",!0);z.false=new z(7,"false",!0);z.true=new z(7,"true",!0);z.null=new z(7,"null",!0);z.undefined=new z(7,"undefined",!0);z.break=new z(7,"break",!0);var re=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var bd=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Aie=new TextDecoder,Iie=new TextEncoder;function kg(r){return bd&&globalThis.Buffer.isBuffer(r)}function hp(r){return r instanceof Uint8Array?kg(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var tC=bd?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):JR(r,e,t):(r,e,t)=>t-e>64?Aie.decode(r.subarray(e,t)):JR(r,e,t),Dg=bd?r=>r.length>64?globalThis.Buffer.from(r):ZR(r):r=>r.length>64?Iie.encode(r):ZR(r),ho=r=>Uint8Array.from(r),_d=bd?(r,e,t)=>kg(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),rC=bd?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),hp(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},nC=bd?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function iC(r,e){if(kg(r)&&kg(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function ZR(r,e=1/0){let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function JR(r,e,t){let n=[];for(;e<t;){let i=r[e],s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,u,l;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(l=(i&31)<<6|a&63,l>127&&(s=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(i&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(i&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(s=l))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return K7(n)}var eC=4096;function K7(r){let e=r.length;if(e<=eC)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=eC));return t}var Rie=256,pp=class{constructor(e=Rie){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){let i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=nC(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=_d(n,0,this.cursor)}else t=rC(this.chunks,this.cursor);return e&&this.reset(),t}};var we="CBOR decode error:",wa="CBOR encode error:",mp=[];mp[23]=1;mp[24]=2;mp[25]=3;mp[26]=5;mp[27]=9;function ba(r,e,t){if(r.length-e<t)throw new Error(`${we} not enough data for type`)}var an=[24,256,65536,4294967296,BigInt("18446744073709551616")];function gi(r,e,t){ba(r,e,1);let n=r[e];if(t.strict===!0&&n<an[0])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function yi(r,e,t){ba(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<an[1])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function wi(r,e,t){ba(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<an[2])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);return n}function bi(r,e,t){ba(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<an[3])throw new Error(`${we} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${we} integers outside of the safe integer range are not supported`)}function sC(r,e,t,n){return new re(z.uint,gi(r,e+1,n),2)}function oC(r,e,t,n){return new re(z.uint,yi(r,e+1,n),3)}function aC(r,e,t,n){return new re(z.uint,wi(r,e+1,n),5)}function cC(r,e,t,n){return new re(z.uint,bi(r,e+1,n),9)}function Wi(r,e){return En(r,0,e.value)}function En(r,e,t){if(t<an[0]){let n=Number(t);r.push([e|n])}else if(t<an[1]){let n=Number(t);r.push([e|24,n])}else if(t<an[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<an[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<an[4]){let i=[e|27,0,0,0,0,0,0,0],s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${we} encountered BigInt larger than allowable range`)}}Wi.encodedSize=function(e){return En.encodedSize(e.value)};En.encodedSize=function(e){return e<an[0]?1:e<an[1]?2:e<an[2]?3:e<an[3]?5:9};Wi.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function uC(r,e,t,n){return new re(z.negint,-1-gi(r,e+1,n),2)}function lC(r,e,t,n){return new re(z.negint,-1-yi(r,e+1,n),3)}function fC(r,e,t,n){return new re(z.negint,-1-wi(r,e+1,n),5)}var H7=BigInt(-1),dC=BigInt(1);function hC(r,e,t,n){let i=bi(r,e+1,n);if(typeof i!="bigint"){let s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new re(z.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${we} integers outside of the safe integer range are not supported`);return new re(z.negint,H7-BigInt(i),9)}function Ng(r,e){let t=e.value,n=typeof t=="bigint"?t*H7-dC:t*-1-1;En(r,e.type.majorEncoded,n)}Ng.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*H7-dC:t*-1-1;return n<an[0]?1:n<an[1]?2:n<an[2]?3:n<an[3]?5:9};Ng.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function gp(r,e,t,n){ba(r,e,t+n);let i=_d(r,e+t,e+t+n);return new re(z.bytes,i,t+n)}function pC(r,e,t,n){return gp(r,e,1,t)}function mC(r,e,t,n){return gp(r,e,2,gi(r,e+1,n))}function gC(r,e,t,n){return gp(r,e,3,yi(r,e+1,n))}function yC(r,e,t,n){return gp(r,e,5,wi(r,e+1,n))}function wC(r,e,t,n){let i=bi(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer bytes lengths not supported`);return gp(r,e,9,i)}function Og(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===z.string?Dg(r.value):r.value),r.encodedBytes}function Ed(r,e){let t=Og(e);En(r,e.type.majorEncoded,t.length),r.push(t)}Ed.encodedSize=function(e){let t=Og(e);return En.encodedSize(t.length)+t.length};Ed.compareTokens=function(e,t){return Pie(Og(e),Og(t))};function Pie(r,e){return r.length<e.length?-1:r.length>e.length?1:iC(r,e)}function yp(r,e,t,n,i){let s=t+n;ba(r,e,s);let o=new re(z.string,tC(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=_d(r,e+t,e+s)),o}function bC(r,e,t,n){return yp(r,e,1,t,n)}function _C(r,e,t,n){return yp(r,e,2,gi(r,e+1,n),n)}function EC(r,e,t,n){return yp(r,e,3,yi(r,e+1,n),n)}function vC(r,e,t,n){return yp(r,e,5,wi(r,e+1,n),n)}function SC(r,e,t,n){let i=bi(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer string lengths not supported`);return yp(r,e,9,i,n)}var xC=Ed;function vd(r,e,t,n){return new re(z.array,n,t)}function TC(r,e,t,n){return vd(r,e,1,t)}function AC(r,e,t,n){return vd(r,e,2,gi(r,e+1,n))}function IC(r,e,t,n){return vd(r,e,3,yi(r,e+1,n))}function RC(r,e,t,n){return vd(r,e,5,wi(r,e+1,n))}function CC(r,e,t,n){let i=bi(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer array lengths not supported`);return vd(r,e,9,i)}function PC(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return vd(r,e,1,1/0)}function Lg(r,e){En(r,z.array.majorEncoded,e.value)}Lg.compareTokens=Wi.compareTokens;Lg.encodedSize=function(e){return En.encodedSize(e.value)};function Sd(r,e,t,n){return new re(z.map,n,t)}function kC(r,e,t,n){return Sd(r,e,1,t)}function DC(r,e,t,n){return Sd(r,e,2,gi(r,e+1,n))}function NC(r,e,t,n){return Sd(r,e,3,yi(r,e+1,n))}function OC(r,e,t,n){return Sd(r,e,5,wi(r,e+1,n))}function LC(r,e,t,n){let i=bi(r,e+1,n);if(typeof i=="bigint")throw new Error(`${we} 64-bit integer map lengths not supported`);return Sd(r,e,9,i)}function BC(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return Sd(r,e,1,1/0)}function Bg(r,e){En(r,z.map.majorEncoded,e.value)}Bg.compareTokens=Wi.compareTokens;Bg.encodedSize=function(e){return En.encodedSize(e.value)};function MC(r,e,t,n){return new re(z.tag,t,1)}function UC(r,e,t,n){return new re(z.tag,gi(r,e+1,n),2)}function FC(r,e,t,n){return new re(z.tag,yi(r,e+1,n),3)}function VC(r,e,t,n){return new re(z.tag,wi(r,e+1,n),5)}function zC(r,e,t,n){return new re(z.tag,bi(r,e+1,n),9)}function Mg(r,e){En(r,z.tag.majorEncoded,e.value)}Mg.compareTokens=Wi.compareTokens;Mg.encodedSize=function(e){return En.encodedSize(e.value)};var Bie=20,Mie=21,Uie=22,Fie=23;function KC(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${we} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new re(z.null,null,1):new re(z.undefined,void 0,1)}function HC(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${we} indefinite length items not allowed`);return new re(z.break,void 0,1)}function $7(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${we} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${we} Infinity values are not supported`)}return new re(z.float,r,e)}function $C(r,e,t,n){return $7(q7(r,e+1),3,n)}function qC(r,e,t,n){return $7(G7(r,e+1),5,n)}function GC(r,e,t,n){return $7(QC(r,e+1),9,n)}function Ug(r,e,t){let n=e.value;if(n===!1)r.push([z.float.majorEncoded|Bie]);else if(n===!0)r.push([z.float.majorEncoded|Mie]);else if(n===null)r.push([z.float.majorEncoded|Uie]);else if(n===void 0)r.push([z.float.majorEncoded|Fie]);else{let i,s=!1;(!t||t.float64!==!0)&&(WC(n),i=q7(Is,1),n===i||Number.isNaN(n)?(Is[0]=249,r.push(Is.slice(0,3)),s=!0):(YC(n),i=G7(Is,1),n===i&&(Is[0]=250,r.push(Is.slice(0,5)),s=!0))),s||(Vie(n),i=QC(Is,1),Is[0]=251,r.push(Is.slice(0,9)))}}Ug.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){WC(n);let i=q7(Is,1);if(n===i||Number.isNaN(n))return 3;if(YC(n),i=G7(Is,1),n===i)return 5}return 9};var jC=new ArrayBuffer(9),Yi=new DataView(jC,1),Is=new Uint8Array(jC,0);function WC(r){if(r===1/0)Yi.setUint16(0,31744,!1);else if(r===-1/0)Yi.setUint16(0,64512,!1);else if(Number.isNaN(r))Yi.setUint16(0,32256,!1);else{Yi.setFloat32(0,r);let e=Yi.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Yi.setUint16(0,31744,!1);else if(t===0)Yi.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let i=t-127;i<-24?Yi.setUint16(0,0):i<-14?Yi.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Yi.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function q7(r,e){if(r.length-e<2)throw new Error(`${we} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,i=t&1023,s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function YC(r){Yi.setFloat32(0,r,!1)}function G7(r,e){if(r.length-e<4)throw new Error(`${we} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Vie(r){Yi.setFloat64(0,r,!1)}function QC(r,e){if(r.length-e<8)throw new Error(`${we} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}Ug.compareTokens=Wi.compareTokens;function Pt(r,e,t){throw new Error(`${we} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Fg(r){return()=>{throw new Error(`${we} ${r}`)}}var ue=[];for(let r=0;r<=23;r++)ue[r]=Pt;ue[24]=sC;ue[25]=oC;ue[26]=aC;ue[27]=cC;ue[28]=Pt;ue[29]=Pt;ue[30]=Pt;ue[31]=Pt;for(let r=32;r<=55;r++)ue[r]=Pt;ue[56]=uC;ue[57]=lC;ue[58]=fC;ue[59]=hC;ue[60]=Pt;ue[61]=Pt;ue[62]=Pt;ue[63]=Pt;for(let r=64;r<=87;r++)ue[r]=pC;ue[88]=mC;ue[89]=gC;ue[90]=yC;ue[91]=wC;ue[92]=Pt;ue[93]=Pt;ue[94]=Pt;ue[95]=Fg("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ue[r]=bC;ue[120]=_C;ue[121]=EC;ue[122]=vC;ue[123]=SC;ue[124]=Pt;ue[125]=Pt;ue[126]=Pt;ue[127]=Fg("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ue[r]=TC;ue[152]=AC;ue[153]=IC;ue[154]=RC;ue[155]=CC;ue[156]=Pt;ue[157]=Pt;ue[158]=Pt;ue[159]=PC;for(let r=160;r<=183;r++)ue[r]=kC;ue[184]=DC;ue[185]=NC;ue[186]=OC;ue[187]=LC;ue[188]=Pt;ue[189]=Pt;ue[190]=Pt;ue[191]=BC;for(let r=192;r<=215;r++)ue[r]=MC;ue[216]=UC;ue[217]=FC;ue[218]=VC;ue[219]=zC;ue[220]=Pt;ue[221]=Pt;ue[222]=Pt;ue[223]=Pt;for(let r=224;r<=243;r++)ue[r]=Fg("simple values are not supported");ue[244]=Pt;ue[245]=Pt;ue[246]=Pt;ue[247]=KC;ue[248]=Fg("simple values are not supported");ue[249]=$C;ue[250]=qC;ue[251]=GC;ue[252]=Pt;ue[253]=Pt;ue[254]=Pt;ue[255]=HC;var Rs=[];for(let r=0;r<24;r++)Rs[r]=new re(z.uint,r,1);for(let r=-1;r>=-24;r--)Rs[31-r]=new re(z.negint,r,1);Rs[64]=new re(z.bytes,new Uint8Array(0),1);Rs[96]=new re(z.string,"",1);Rs[128]=new re(z.array,0,1);Rs[160]=new re(z.map,0,1);Rs[244]=new re(z.false,!1,1);Rs[245]=new re(z.true,!0,1);Rs[246]=new re(z.null,null,1);function XC(r){switch(r.type){case z.false:return ho([244]);case z.true:return ho([245]);case z.null:return ho([246]);case z.bytes:return r.value.length?void 0:ho([64]);case z.string:return r.value===""?ho([96]):void 0;case z.array:return r.value===0?ho([128]):void 0;case z.map:return r.value===0?ho([160]):void 0;case z.uint:return r.value<24?ho([Number(r.value)]):void 0;case z.negint:if(r.value>=-24)return ho([31-Number(r.value)])}}var Kie={float64:!1,mapSorter:qie,quickEncodeToken:XC};function Hie(){let r=[];return r[z.uint.major]=Wi,r[z.negint.major]=Ng,r[z.bytes.major]=Ed,r[z.string.major]=xC,r[z.array.major]=Lg,r[z.map.major]=Bg,r[z.tag.major]=Mg,r[z.float.major]=Ug,r}var ZC=Hie(),j7=new pp,xd=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${wa} object contains circular references`);return new xd(t,e)}},Cc={null:new re(z.null,null),undefined:new re(z.undefined,void 0),true:new re(z.true,!0),false:new re(z.false,!1),emptyArray:new re(z.array,0),emptyMap:new re(z.map,0)},Pc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new re(z.float,r):r>=0?new re(z.uint,r):new re(z.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new re(z.uint,r):new re(z.negint,r)},Uint8Array(r,e,t,n){return new re(z.bytes,r)},string(r,e,t,n){return new re(z.string,r)},boolean(r,e,t,n){return r?Cc.true:Cc.false},null(r,e,t,n){return Cc.null},undefined(r,e,t,n){return Cc.undefined},ArrayBuffer(r,e,t,n){return new re(z.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new re(z.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[Cc.emptyArray,new re(z.break)]:Cc.emptyArray;n=xd.createCheck(n,r);let i=[],s=0;for(let o of r)i[s++]=Vg(o,t,n);return t.addBreakTokens?[new re(z.array,r.length),i,new re(z.break)]:[new re(z.array,r.length),i]},Object(r,e,t,n){let i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[Cc.emptyMap,new re(z.break)]:Cc.emptyMap;n=xd.createCheck(n,r);let a=[],c=0;for(let u of s)a[c++]=[Vg(u,t,n),Vg(i?r.get(u):r[u],t,n)];return $ie(a,t),t.addBreakTokens?[new re(z.map,o),a,new re(z.break)]:[new re(z.map,o),a]}};Pc.Map=Pc.Object;Pc.Buffer=Pc.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Pc[`${r}Array`]=Pc.DataView;function Vg(r,e={},t){let n=XR(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||Pc[n];if(typeof i=="function"){let o=i(r,n,e,t);if(o!=null)return o}let s=Pc[n];if(!s)throw new Error(`${wa} unsupported type: ${n}`);return s(r,n,e,t)}function $ie(r,e){e.mapSorter&&r.sort(e.mapSorter)}function qie(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let i=t.type.major,s=ZC[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function JC(r,e,t,n){if(Array.isArray(e))for(let i of e)JC(r,i,t,n);else t[e.type.major](r,e,n)}function W7(r,e,t){let n=Vg(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let i=t.quickEncodeToken(n);if(i)return i;let s=e[n.type.major];if(s.encodedSize){let o=s.encodedSize(n,t),a=new pp(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return hp(a.chunks[0])}}return j7.reset(),JC(j7,n,e,t),j7.toBytes(!0)}function Cs(r,e){return e=Object.assign({},Kie,e),W7(r,ZC,e)}var Gie={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Y7=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Rs[e];if(t===void 0){let n=ue[e];if(!n)throw new Error(`${we} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}},wp=Symbol.for("DONE"),zg=Symbol.for("BREAK");function jie(r,e,t){let n=[];for(let i=0;i<r.value;i++){let s=bp(e,t);if(s===zg){if(r.value===1/0)break;throw new Error(`${we} got unexpected break to lengthed array`)}if(s===wp)throw new Error(`${we} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function Wie(r,e,t){let n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){let a=bp(e,t);if(a===zg){if(r.value===1/0)break;throw new Error(`${we} got unexpected break to lengthed map`)}if(a===wp)throw new Error(`${we} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${we} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${we} found repeat map key "${a}"`);let c=bp(e,t);if(c===wp)throw new Error(`${we} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function bp(r,e){if(r.done())return wp;let t=r.next();if(t.type===z.break)return zg;if(t.type.terminal)return t.value;if(t.type===z.array)return jie(t,r,e);if(t.type===z.map)return Wie(t,r,e);if(t.type===z.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=bp(r,e);return e.tags[t.value](n)}throw new Error(`${we} tag not supported (${t.value})`)}throw new Error("unsupported")}function Cn(r,e){if(!(r instanceof Uint8Array))throw new Error(`${we} data to decode must be a Uint8Array`);e=Object.assign({},Gie,e);let t=e.tokenizer||new Y7(r,e),n=bp(t,e);if(n===wp)throw new Error(`${we} did not find any content to decode`);if(n===zg)throw new Error(`${we} got unexpected break`);if(!t.done())throw new Error(`${we} too many terminals, data makes no sense`);return n}var eP=42;function Yie(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=P.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new re(z.tag,eP),new re(z.bytes,t)]}function Qie(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Xie(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Zie={float64:!0,typeEncoders:{Object:Yie,undefined:Qie,number:Xie}};function Jie(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return P.decode(r.subarray(1))}var tP={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};tP.tags[eP]=Jie;var ese="dag-cbor",_p=113,Ep=r=>Cs(r,Zie),ul=r=>Cn(r,tP);var Ad={};zt(Ad,{code:()=>tb,decode:()=>iP,encode:()=>nP,format:()=>use,name:()=>cse,parse:()=>fse,stringify:()=>use});var Q7=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===z.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===z.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[z.uint.major](e,t){this.prefix(e);let n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[z.negint.major](e,t){this[z.uint.major](e,t)}[z.bytes.major](e,t){throw new Error(`${wa} unsupported type: Uint8Array`)}[z.string.major](e,t){this.prefix(e);let n=Dg(JSON.stringify(t.value));e.push(n.length>32?hp(n):n)}[z.array.major](e,t){this.prefix(e),this.inRecursive.push({type:z.array,elements:0}),e.push([91])}[z.map.major](e,t){this.prefix(e),this.inRecursive.push({type:z.map,elements:0}),e.push([123])}[z.tag.major](e,t){}[z.float.major](e,t){if(t.type.name==="break"){let o=this.inRecursive.pop();if(o){if(o.type===z.array)e.push([93]);else if(o.type===z.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${wa} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),i=[],s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}};function tse(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${wa} complex map keys are not supported`);let t=r[0],n=e[0];if(t.type!==z.string||n.type!==z.string)throw new Error(`${wa} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${wa} unexpected duplicate map keys, this is not supported`)}var rse={addBreakTokens:!0,mapSorter:tse};function X7(r,e){return e=Object.assign({},rse,e),W7(r,new Q7,e)}var Td=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${we} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${we} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this.pos,t=!1,n=!1,i=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,n=!0;else return new re(z.uint,0,this.pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${we} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${we} unexpected token at position ${this.pos}`);n=!0,this.pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,i([48,49,50,51,52,53,54,55,56,57]));let s=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),o=parseFloat(s);return n?new re(z.float,o,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new re(o>=0?z.uint:z.negint,o,this.pos-e):new re(o>=0?z.uint:z.negint,BigInt(s),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${we} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let s=this.pos,o=0;s<this.data.length&&o<65536;s++,o++){let a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this.pos,s));return this.pos=s+1,new re(z.string,c,o)}}let e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${we} unexpected end of unicode escape sequence at position ${this.pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${we} unexpected unicode escape character at position ${this.pos}`);s=s*16+a,this.pos++}return s},i=()=>{let s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${we} unexpected unicode sequence at position ${this.pos}`);let c,u,l,f;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this.pos+1],(c&192)===128&&(f=(s&31)<<6|c&63,f>127&&(o=f));break;case 3:c=this.data[this.pos+1],u=this.data[this.pos+2],(c&192)===128&&(u&192)===128&&(f=(s&15)<<12|(c&63)<<6|u&63,f>2047&&(f<55296||f>57343)&&(o=f));break;case 4:c=this.data[this.pos+1],u=this.data[this.pos+2],l=this.data[this.pos+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(f=(s&15)<<18|(c&63)<<12|(u&63)<<6|l&63,f>65535&&f<1114112&&(o=f))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this.pos+=a};for(;!this.done();){let s=this.ch(),o;switch(s){case 92:if(this.pos++,this.done())throw new Error(`${we} unexpected string termination at position ${this.pos}`);switch(o=this.ch(),this.pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${we} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new re(z.string,K7(t),this.pos-e);default:if(s<32)throw new Error(`${we} invalid control character at position ${this.pos}`);s<128?(t.push(s),this.pos++):i()}}throw new Error(`${we} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new re(z.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new re(z.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new re(z.null,null,4);case 102:return this.expect([102,97,108,115,101]),new re(z.false,!1,5);case 116:return this.expect([116,114,117,101]),new re(z.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${we} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new re(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new re(z.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new re(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new re(z.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${we} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${we} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function Z7(r,e){return e=Object.assign({tokenizer:new Td(r,e)},e),Cn(r,e)}function ise(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=P.asCID(r);if(!e)return null;let t=e.toString();return[new re(z.map,1/0,1),new re(z.string,"/",1),new re(z.string,t,t.length),new re(z.break,void 0,1)]}function rP(r){let e=ao.encode(r).slice(1);return[new re(z.map,1/0,1),new re(z.string,"/",1),new re(z.map,1/0,1),new re(z.string,"bytes",5),new re(z.string,e,e.length),new re(z.break,void 0,1),new re(z.break,void 0,1)]}function sse(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function ose(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var ase={typeEncoders:{Object:ise,Uint8Array:rP,Buffer:rP,undefined:sse,number:ose}},J7=class extends Td{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===z.map){let t=this._next();if(t.type===z.string&&t.value==="/"){let n=this._next();if(n.type===z.string){if(this._next().type!==z.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new re(z.tag,42,0)}if(n.type===z.map){let i=this._next();if(i.type===z.string&&i.value==="bytes"){let s=this._next();if(s.type===z.string){for(let a=0;a<2;a++)if(this._next().type!==z.break)throw new Error("Invalid encoded Bytes form");let o=ao.decode(`m${s.value}`);return new re(z.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},eb={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};eb.tags[42]=P.parse;var cse="dag-json",tb=297,nP=r=>X7(r,ase),iP=r=>{let e=Object.assign(eb,{tokenizer:new J7(r,eb)});return Z7(r,e)},use=r=>lse.decode(nP(r));var lse=new TextDecoder,fse=r=>iP(dse.encode(r)),dse=new TextEncoder;var vp={};zt(vp,{code:()=>_se,decode:()=>xse,encode:()=>Sse,name:()=>bse,toGeneral:()=>hP});function Ps(r){return Tc.encode(r).slice(1)}function Qi(r){return Tc.decode(`u${r}`)}function sP(r){let[e,t,n]=r;return{payload:t,signatures:[{protected:e,signature:n}],link:P.decode(Qi(t))}}function hse(r){let e={signature:Qi(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=Qi(r.protected)),e}function oP(r){let e=Qi(r.payload);try{P.decode(e)}catch{throw new Error("Not a valid DagJWS")}return{payload:e,signatures:r.signatures.map(hse)}}function pse(r){let e={signature:Ps(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=Ps(r.protected)),e}function aP(r){let e={payload:Ps(r.payload),signatures:r.signatures.map(pse)};return e.link=P.decode(new Uint8Array(r.payload)),e}function cP(r){let[e,t,n,i,s]=r,o={ciphertext:i,iv:n,protected:e,tag:s};return t&&(o.recipients=[{encrypted_key:t}]),o}function gse(r){let e={};return r.encrypted_key&&(e.encrypted_key=Qi(r.encrypted_key)),r.header&&(e.header=r.header),e}function uP(r){let e={ciphertext:Qi(r.ciphertext),protected:Qi(r.protected),iv:Qi(r.iv),tag:Qi(r.tag)};return r.aad&&(e.aad=Qi(r.aad)),r.recipients&&(e.recipients=r.recipients.map(gse)),r.unprotected&&(e.unprotected=r.unprotected),e}function yse(r){let e={};return r.encrypted_key&&(e.encrypted_key=Ps(r.encrypted_key)),r.header&&(e.header=r.header),e}function lP(r){let e={ciphertext:Ps(r.ciphertext),protected:Ps(r.protected),iv:Ps(r.iv),tag:Ps(r.tag)};return r.aad&&(e.aad=Ps(r.aad)),r.recipients&&(e.recipients=r.recipients.map(yse)),r.unprotected&&(e.unprotected=r.unprotected),e}var bse="dag-jose",_se=133;function fP(r){return"payload"in r&&typeof r.payload=="string"&&"signatures"in r&&Array.isArray(r.signatures)}function Ese(r){return"payload"in r&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures)}function vse(r){return"ciphertext"in r&&r.ciphertext instanceof Uint8Array&&"iv"in r&&r.iv instanceof Uint8Array&&"protected"in r&&r.protected instanceof Uint8Array&&"tag"in r&&r.tag instanceof Uint8Array}function dP(r){return"ciphertext"in r&&typeof r.ciphertext=="string"&&"iv"in r&&typeof r.iv=="string"&&"protected"in r&&typeof r.protected=="string"&&"tag"in r&&typeof r.tag=="string"}function hP(r){if(typeof r=="string"){let e=r.split(".");if(e.length===3)return sP(e);if(e.length===5)return cP(e);throw new Error("Not a valid JOSE string")}if(fP(r)||dP(r))return r;throw new Error("Not a valid unencoded JOSE object")}function Sse(r){typeof r=="string"&&(r=hP(r));let e;if(fP(r))e=oP(r);else if(dP(r))e=uP(r);else throw new Error("Not a valid JOSE object");return new Uint8Array(Ep(e))}function xse(r){let e;try{e=ul(r)}catch{throw new Error("Not a valid DAG-JOSE object")}if(Ese(e))return aP(e);if(vse(e))return lP(e);throw new Error("Not a valid DAG-JOSE object")}var rb={};zt(rb,{identity:()=>Hr});var pP=0,Tse="identity",mP=qi,Ase=r=>oo(pP,mP(r)),Hr={code:pP,name:Tse,encode:mP,digest:Ase};var nb={};zt(nb,{identity:()=>Ise});var Ise=ad({prefix:"\0",name:"identity",encode:r=>Jw(r),decode:r=>Zw(r)});var ib={};zt(ib,{base2:()=>Rse});var Rse=Sr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var sb={};zt(sb,{base8:()=>Cse});var Cse=Sr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ob={};zt(ob,{base10:()=>Pse});var Pse=Sc({prefix:"9",name:"base10",alphabet:"0123456789"});var ab={};zt(ab,{base16:()=>kse,base16upper:()=>Dse});var kse=Sr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Dse=Sr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cb={};zt(cb,{base36:()=>Id,base36upper:()=>Nse});var Id=Sc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nse=Sc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ub={};zt(ub,{base256emoji:()=>Use});var gP=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ose=gP.reduce((r,e,t)=>(r[t]=e,r),[]),Lse=gP.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Bse(r){return r.reduce((e,t)=>(e+=Ose[t],e),"")}function Mse(r){let e=[];for(let t of r){let n=Lse[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var Use=ad({prefix:"\u{1F680}",name:"base256emoji",encode:Bse,decode:Mse});var ei={};zt(ei,{code:()=>cn,decode:()=>zse,encode:()=>Vse,name:()=>Fse});var Fse="raw",cn=85,Vse=r=>qi(r),zse=r=>qi(r);var Xi={...nb,...ib,...sb,...ob,...ab,...a7,...cb,...i7,...y7,...ub},Hg={...f7,...rb},$g={raw:ei,json:ip};var Ea=class extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=Ea.code}};Ea.code="ERR_NOT_INITIALIZED";var lb=class extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=ks.code}};lb.code="ERR_ALREADY_INITIALIZING";var ks=class extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=ks.code}};ks.code="ERR_ALREADY_INITIALIZED";var va=class extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=va.code}};va.code="ERR_NOT_STARTED";var ll=class extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=ll.code}};ll.code="ERR_ALREADY_STARTING";var fl=class extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=fl.code}};fl.code="ERR_ALREADY_STARTED";var Ds=class extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=Ds.code}};Ds.code="ERR_NOT_ENABLED";function Sa(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function xa(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.alloc)!=null?Sa(globalThis.Buffer.alloc(r)):new Uint8Array(r)}function Ns(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?Sa(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function wP(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var yP=wP("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),fb=wP("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Ns(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Kse={utf8:yP,"utf-8":yP,hex:Xi.base16,latin1:fb,ascii:fb,binary:fb,...Xi},qg=Kse;function W(r,e="utf8"){let t=qg[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Sa(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var Ste=C(en(),1);var jg=class{constructor(){td(this,"index",0);td(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*i)-1;for(;;){let l=this.readAtomically(()=>{let f=this.readChar();if(f===void 0)return;let h=Number.parseInt(f,e);if(!Number.isNaN(h))return h});if(l===void 0)break;if(s*=e,s+=l,s>u||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let i=n*2;if(n<t.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var xP=45,qse=15,Rd=new jg;function TP(r){if(!(r.length>qse))return Rd.new(r).parseWith(()=>Rd.readIPv4Addr())}function AP(r){if(!(r.length>xP))return Rd.new(r).parseWith(()=>Rd.readIPv6Addr())}function IP(r){if(!(r.length>xP))return Rd.new(r).parseWith(()=>Rd.readIPAddr())}function RP(r){return Boolean(TP(r))}function CP(r){return Boolean(AP(r))}function Cd(r){return Boolean(IP(r))}function j(r,e="utf8"){let t=qg[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var PP=RP,Gse=CP,pb=function(r){let e=0;if(r=r.toString().trim(),PP(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Gse(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let s=PP(t[n]),o;s&&(o=pb(t[n]),t[n]=j(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,j(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},kP=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){let i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var xp={},mb={},Wse=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Wse.forEach(r=>{let e=Yse(...r);mb[e.code]=e,xp[e.name]=e});function Yse(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(i)}}function Nt(r){if(typeof r=="number"){if(mb[r]!=null)return mb[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(xp[r]!=null)return xp[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var mo=C(po(),1);function ve(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));let t=Ns(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return Sa(t)}function Wg(r,e){switch(Nt(r).code){case 4:case 41:return loe(e);case 42:return HP(e);case 6:case 273:case 33:case 132:return GP(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return HP(e);case 421:return poe(e);case 444:return $P(e);case 445:return $P(e);case 466:return hoe(e);default:return j(e,"base16")}}function qP(r,e){switch(Nt(r).code){case 4:return zP(e);case 41:return zP(e);case 42:return KP(e);case 6:case 273:case 33:case 132:return bb(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return KP(e);case 421:return foe(e);case 444:return moe(e);case 445:return goe(e);case 466:return doe(e);default:return W(e,"base16")}}var wb=Object.values(Xi).map(r=>r.decoder),uoe=function(){let r=wb[0].or(wb[1]);return wb.slice(2).forEach(e=>r=r.or(e)),r}();function zP(r){if(!Cd(r))throw new Error("invalid ip address");return pb(r)}function loe(r){let e=kP(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Cd(e))throw new Error("invalid ip address");return e}function bb(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function GP(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function KP(r){let e=W(r),t=Uint8Array.from(mo.default.encode(e.length));return ve([t,e],t.length+e.length)}function HP(r){let e=mo.default.decode(r);if(r=r.slice(mo.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return j(r)}function foe(r){let e;r[0]==="Q"||r[0]==="1"?e=Xt(Te.decode(`z${r}`)).bytes:e=P.parse(r).multihash.bytes;let t=Uint8Array.from(mo.default.encode(e.length));return ve([t,e],t.length+e.length)}function doe(r){let e=uoe.decode(r),t=Uint8Array.from(mo.default.encode(e.length));return ve([t,e],t.length+e.length)}function hoe(r){let e=mo.default.decode(r),t=r.slice(mo.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+j(t,"base64url")}function poe(r){let e=mo.default.decode(r),t=r.slice(mo.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return j(t,"base58btc")}function moe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=ut.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=bb(n);return ve([t,i],t.length+i.length)}function goe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=ut.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=bb(n);return ve([t,i],t.length+i.length)}function $P(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=j(e,"base32"),i=GP(t);return`${n}:${i}`}var Pd=C(po(),1);function yoe(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],s=Nt(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw WP("invalid address: "+r);if(s.path===!0){e.push([i,xb(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function woe(r){let e=[];return r.map(t=>{let n=Xg(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),xb(e.join("/"))}function boe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=Xg(e);return e.length>1?[t.code,qP(t.code,e[1])]:[t.code]})}function _b(r){return r.map(e=>{let t=Xg(e);return e[1]!=null?[t.code,Wg(t.code,e[1])]:[t.code]})}function Eb(r){return Qg(ve(r.map(e=>{let t=Xg(e),n=Uint8Array.from(Pd.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=ve([n,e[1]])),n})))}function vb(r,e){return r.size>0?r.size/8:r.size===0?0:Pd.default.decode(e)+(Pd.default.decode.bytes??0)}function Yg(r){let e=[],t=0;for(;t<r.length;){let n=Pd.default.decode(r,t),i=Pd.default.decode.bytes??0,s=Nt(n),o=vb(s,r.slice(t+i));if(o===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+o);if(t+=o+i,t>r.length)throw WP("Invalid address Uint8Array: "+j(r,"base16"));e.push([n,a])}return e}function Sb(r){let e=Yg(r),t=_b(e);return woe(t)}function _oe(r){r=xb(r);let e=yoe(r),t=boe(e);return Eb(t)}function jP(r){return _oe(r)}function Qg(r){let e=Eoe(r);if(e!=null)throw e;return Uint8Array.from(r)}function Eoe(r){try{Yg(r)}catch(e){return e}}function xb(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function WP(r){return new Error("Error parsing address: "+r)}function Xg(r){return Nt(r[0])}var Ab=C(po(),1);var QP=C(Y(),1);function ke(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var kd=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Tb=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Tp,Ap,Ip,YP,Soe=Symbol.for("nodejs.util.inspect.custom"),xoe=[Nt("dns").code,Nt("dns4").code,Nt("dns6").code,Nt("dnsaddr").code],Ib=new Map,XP=Symbol.for("@multiformats/js-multiaddr/multiaddr");function ZP(r,e){if(r==null)throw new Error("requires node address object");if(e==null)throw new Error("requires transport protocol");let t,n=r.address;switch(r.family){case 4:t="ip4";break;case 6:if(t="ip6",n.includes("%")){let i=n.split("%");if(i.length!==2)throw Error("Multiple ip6 zones in multiaddr");n=i[0],t=`/ip6zone/${i[1]}/ip6`}break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new go("/"+[t,n,e,r.port].join("/"))}function JP(r){return Pn(r)?r.protos().some(e=>e.resolvable):!1}function Pn(r){return Boolean(r==null?void 0:r[XP])}var go=class{constructor(e){if(Tp.set(this,void 0),Ap.set(this,void 0),Ip.set(this,void 0),this[YP]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=Qg(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=jP(e)}else if(Pn(e))this.bytes=Qg(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return kd(this,Tp,"f")==null&&Tb(this,Tp,Sb(this.bytes),"f"),kd(this,Tp,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="",o=Nt("tcp"),a=Nt("udp"),c=Nt("ip4"),u=Nt("ip6"),l=Nt("dns6"),f=Nt("ip6zone");for(let[d,m]of this.stringTuples())d===f.code&&(s=`%${m??""}`),xoe.includes(d)&&(t=o.name,i=443,n=`${m??""}${s}`,e=d===l.code?6:4),(d===o.code||d===a.code)&&(t=Nt(d).name,i=parseInt(m??"")),(d===c.code||d===u.code)&&(t=Nt(d).name,n=`${m??""}${s}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},Nt(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=Ab.default.decode(t,n),s=Ab.default.decode.bytes??0,o=Nt(i),a=vb(o,t.slice(n+s));n+=a+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return kd(this,Ap,"f")==null&&Tb(this,Ap,Yg(this.bytes),"f"),kd(this,Ap,"f")}stringTuples(){return kd(this,Ip,"f")==null&&Tb(this,Ip,_b(this.tuples()),"f"),kd(this,Ip,"f")}encapsulate(e){return e=new go(e),new go(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new go(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new go(Eb(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===xp.ipfs.code).pop();if((t==null?void 0:t[1])!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?j(Te.decode(`z${n}`),"base58btc"):j(P.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>Nt(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return ke(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(s=>s.resolvable);if(t==null)return[this];let n=Ib.get(t.name);if(n==null)throw(0,QP.default)(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new go(s))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Tp=new WeakMap,Ap=new WeakMap,Ip=new WeakMap,YP=XP,Soe)](){return`Multiaddr(${Sb(this.bytes)})`}};function oe(r){return new go(r)}var Toe=Le("dns4"),Aoe=Le("dns6"),Ioe=Le("dnsaddr"),Nc=kn(Le("dns"),Ioe,Toe,Aoe),Zg=kn(Le("ip4"),Le("ip6")),Cp=kn(Qe(Zg,Le("tcp")),Qe(Nc,Le("tcp"))),tk=Qe(Zg,Le("udp")),Roe=Qe(tk,Le("utp")),Coe=Qe(tk,Le("quic")),hl=kn(Qe(Cp,Le("ws")),Qe(Nc,Le("ws"))),Dc=kn(Qe(Cp,Le("wss")),Qe(Nc,Le("wss"))),Rb=kn(Qe(Cp,Le("http")),Qe(Zg,Le("http")),Qe(Nc,Le("http"))),Cb=kn(Qe(Cp,Le("https")),Qe(Zg,Le("https")),Qe(Nc,Le("https"))),Jg=kn(Qe(hl,Le("p2p-webrtc-star"),Le("p2p")),Qe(Dc,Le("p2p-webrtc-star"),Le("p2p")),Qe(hl,Le("p2p-webrtc-star")),Qe(Dc,Le("p2p-webrtc-star"))),YSe=kn(Qe(hl,Le("p2p-websocket-star"),Le("p2p")),Qe(Dc,Le("p2p-websocket-star"),Le("p2p")),Qe(hl,Le("p2p-websocket-star")),Qe(Dc,Le("p2p-websocket-star"))),rk=kn(Qe(Rb,Le("p2p-webrtc-direct"),Le("p2p")),Qe(Cb,Le("p2p-webrtc-direct"),Le("p2p")),Qe(Rb,Le("p2p-webrtc-direct")),Qe(Cb,Le("p2p-webrtc-direct"))),Rp=kn(hl,Dc,Rb,Cb,Jg,rk,Cp,Roe,Coe,Nc),QSe=kn(Qe(Rp,Le("p2p-stardust"),Le("p2p")),Qe(Rp,Le("p2p-stardust"))),kc=kn(Qe(Rp,Le("p2p")),Jg,rk,Le("p2p")),ek=kn(Qe(kc,Le("p2p-circuit"),kc),Qe(kc,Le("p2p-circuit")),Qe(Le("p2p-circuit"),kc),Qe(Rp,Le("p2p-circuit")),Qe(Le("p2p-circuit"),Rp),Le("p2p-circuit")),nk=()=>kn(Qe(ek,nk),ek),dl=nk(),e3=kn(Qe(dl,kc,dl),Qe(kc,dl),Qe(dl,kc),dl,kc),ik=e3;function sk(r){function e(t){let n;try{n=oe(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Qe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:sk(e),partialMatch:e}}function kn(...r){function e(n){let i=null;return r.some(s=>{let o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:sk(e),partialMatch:e}}function Le(r){let e=r;function t(i){let s;try{s=oe(i)}catch{return!1}let o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var dk=C(r3(),1);var n3=/^\/(ip[fn]s)\/([^/?#]+)/,hk=1,pk=2,mk=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/;var Foe=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function i3(r){try{return wk(r)?Boolean(P.parse(r)):r instanceof Uint8Array?Boolean(P.decode(r)):Boolean(P.asCID(r))}catch{return!1}}function gk(r,e,t=hk,n=pk){let i=bk(r);if(i===!1)return!1;let s=i.match(e);if(s==null||s[t]!=="ipfs")return!1;let o=s[n];return o!=null&&e===mk&&(o=o.toLowerCase()),i3(o)}function yk(r,e,t=hk,n=pk){let i=bk(r);if(i===!1)return!1;let s=i.match(e);if(s==null||s[t]!=="ipns")return!1;let o=s[n];if(o!=null&&e===mk){if(o=o.toLowerCase(),i3(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));let{hostname:a}=new dk.URL(`http://${o}`);return Foe.test(a)}catch{return!1}}return!0}function wk(r){return typeof r=="string"}function bk(r){return r instanceof Uint8Array?j(r,"base58btc"):wk(r)?r:!1}var s3=r=>gk(r,n3)||yk(r,n3);var _k=r=>gk(r,n3),o3=r=>yk(r,n3);var c3=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");var Ta="/",Ek=new TextEncoder().encode(Ta),u3=Ek[0],le=class{constructor(e,t){if(typeof e=="string")this._buf=W(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==u3)throw new Error("Invalid key")}toString(e="utf8"){return j(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new le(e.join(Ta))}static random(){return new le(c3().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new le(e):typeof e.uint8Array=="function"?new le(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Ek),this._buf[0]!==u3){let e=new Uint8Array(this._buf.byteLength+1);e.fill(u3,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===u3;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return le.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ta).slice(1)}type(){return Voe(this.baseNamespace())}name(){return zoe(this.baseNamespace())}instance(e){return new le(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ta)||(e+=Ta),e+=this.type(),new le(e)}parent(){let e=this.list();return e.length===1?new le(Ta):new le(e.slice(0,-1).join(Ta))}child(e){return this.toString()===Ta?e:e.toString()===Ta?this:new le(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return le.withNamespaces([...this.namespaces(),...Koe(e.map(t=>t.namespaces()))])}};function Voe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function zoe(r){let e=r.split(":");return e[e.length-1]}function Koe(r){return[].concat(...r)}var l3=C(Y(),1);var xk=C(en(),1),Tk=C(Kn(),1);var Hoe=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;Ze.nanosecond=Ze.ns=1/1e6;Ze.\u00B5s=Ze.\u03BCs=Ze.us=Ze.microsecond=1/1e3;Ze.millisecond=Ze.ms=Ze[""]=1;Ze.second=Ze.sec=Ze.s=Ze.ms*1e3;Ze.minute=Ze.min=Ze.m=Ze.s*60;Ze.hour=Ze.hr=Ze.h=Ze.m*60;Ze.day=Ze.d=Ze.h*24;Ze.week=Ze.wk=Ze.w=Ze.d*7;Ze.month=Ze.b=Ze.d*(365.25/12);Ze.year=Ze.yr=Ze.y=Ze.d*365.25;function Ze(r="",e="ms"){var t=null;return r=(r+"").replace(/(\d)[,_](\d)/g,"$1$2"),r.replace(Hoe,function(n,i,s){s=Sk(s),s&&(t=(t||0)+parseFloat(i,10)*s)}),t&&t/(Sk(e)||1)}function Sk(r){return Ze[r]||Ze[r.toLowerCase().replace(/s$/,"")]}var Oc=Ze;var Aa=class extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=Aa.code}};Aa.code="ERR_TIMEOUT";function H(r,e){return(...t)=>{let n=t[e??t.length-1];if(!n||!n.timeout)return r(...t);let i=typeof n.timeout=="string"?Oc(n.timeout):n.timeout,s=new xk.TimeoutController(i);n.signal=(0,Tk.anySignal)([n.signal,s.signal]);let o=r(...t),a=new Promise((l,f)=>{s.signal.addEventListener("abort",()=>{f(new Aa)})}),c=Date.now(),u=()=>{if(s.signal.aborted)throw new Aa;if(Date.now()-c>i)throw s.abort(),new Aa};return o[Symbol.asyncIterator]?async function*(){let l=o[Symbol.asyncIterator]();try{for(;;){let{value:f,done:h}=await Promise.race([l.next(),a]);if(h)break;u(),yield f}}catch(f){throw u(),f}finally{s.clear(),l.return&&l.return()}}():(async()=>{try{let l=await Promise.race([o,a]);return u(),l}catch(l){throw u(),l}finally{s.clear()}})()}}var Nb=C(Y(),1),Ak="/ipfs/";function Ia(r){if(r instanceof Uint8Array)try{r=P.decode(r)}catch(i){throw(0,Nb.default)(i,"ERR_INVALID_CID")}let e=P.asCID(r);if(e)return{cid:e,path:void 0};r=r.toString(),r.startsWith(Ak)&&(r=r.substring(Ak.length));let t=r.split("/"),n;try{e=P.parse(t.shift()||"")}catch(i){throw(0,Nb.default)(i,"ERR_INVALID_CID")}return t.length&&(n=`/${t.join("/")}`),{cid:e,path:n}}var $oe="ERR_BAD_PATH",f3="This command must be run in online mode. Try running 'ipfs daemon' first.",kp=new le("/local/filesroot"),Ik=262144;var Rk=r=>{if(P.asCID(r))return`/ipfs/${r}`;let t=r.toString();try{return`/ipfs/${P.parse(t)}`}catch{}if(s3(t))return t;throw(0,l3.default)(new Error(`invalid path: ${r}`),$oe)},Dd=r=>r instanceof Uint8Array?P.decode(r).toString():(r=r.toString(),r.indexOf("/ipfs/")===0&&(r=r.substring(6)),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1)),r),Lc=async function(r,e,t,n={}){let{cid:i,path:s}=Ia(t);s&&(n.path=s);let o=i,a=n.path||"";if(a.startsWith("/")&&(a=a.substring(1)),n.path)try{for await(let{value:c,remainderPath:u}of Bc(i,n.path,e,r,{signal:n.signal})){if(!P.asCID(c))break;a=u,o=c}}catch(c){throw c.message.startsWith("Object has no property")&&(c.message=`no link named "${a.split("/")[0]}" under ${o}`,c.code="ERR_NO_LINK"),c}return{cid:o,remainderPath:a||""}},Ob=r=>{if(r.type!=="file"&&r.type!=="directory"&&r.type!=="raw")throw new Error(`Unknown node type '${r.type}'`);let e={cid:r.cid,path:r.path,name:r.name,size:r.size,type:"file"};return r.type==="directory"&&(e.type="dir"),r.type==="file"&&(e.size=r.unixfs.fileSize()),(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,r.unixfs.mtime!==void 0&&(e.mtime=r.unixfs.mtime)),e},Ck=H(async(r,e)=>await r),Bc=async function*(r,e,t,n,i){let s=async u=>{let l=await t.getCodec(u.code),f=await n.blocks.get(u,i);return l.decode(f)},o=e.split("/").filter(Boolean),a=await s(r),c=r;for(;o.length;){let u=o.shift();if(!u)throw(0,l3.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(r.code===Xe&&Array.isArray(a.Links)){let l=a.Links.find(f=>f.Name===u);if(l){yield{value:l.Hash,remainderPath:o.join("/")},a=await s(l.Hash),c=l.Hash;continue}}if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw(0,l3.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");P.asCID(a)&&(c=a,a=await s(a))}yield{value:a,remainderPath:""}};var Dn=class{static create({start:e,stop:t}){return new Dn(e,t)}static async start(e,t){let{state:n,activate:i}=e;switch(n.status){case"stopped":try{let s=i(t);e.state={status:"starting",ready:s};let o=await s;return e.state={status:"started",value:o},o}catch(s){throw e.state={status:"stopped"},s}case"starting":throw new ll;case"started":throw new fl;case"stopping":return await n.ready,await Dn.start(e,t);default:return Dn.panic(e)}}static async stop(e){let{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":{try{await t.ready}catch{}return await Dn.stop(e)}case"stopping":return await t.ready;case"started":{n&&await n(t.value),e.state={status:"stopped"};break}default:Dn.panic(t)}}static try({state:e}){switch(e.status){case"started":return e.value;default:return null}}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await Ck(e.ready,t);default:throw new va}}static panic({state:e}){let t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await Dn.use(this,e)}try(){return Dn.try(this)}};function Pk({network:r,preload:e,peerId:t,keychain:n,repo:i,ipns:s,mfsPreload:o,print:a,hashers:c,options:u}){return async()=>{let{libp2p:f}=await Dn.start(r,{peerId:t,repo:i,print:a,hashers:c,options:u});await Promise.all([s.startOnline({keychain:n,libp2p:f,peerId:t,repo:i}),e.start(),o.start()])}}function kk({network:r,preload:e,ipns:t,repo:n,mfsPreload:i}){return async()=>{await Promise.all([e.stop(),t.stop(),i.stop()]),await Dn.stop(r),await n.close()}}var Nk=C(Dp(),1),d3=class{constructor(e){this.lru=(0,Nk.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var $k=C(Lk(),1);var Nd=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Bb=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Bk=r=>globalThis.DOMException===void 0?new Bb(r):new DOMException(r),Mk=r=>{let e=r.reason===void 0?Bk("This operation was aborted."):r.reason;return e instanceof Error?e:Bk(e)};function Op(r,e,t,n){let i,s=new Promise((o,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){o(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(Mk(c)),c.addEventListener("abort",()=>{a(Mk(c))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{o(t())}catch(l){a(l)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,u=t instanceof Error?t:new Nd(c);typeof r.cancel=="function"&&r.cancel(),a(u)},e),(async()=>{try{o(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return s.clear=()=>{clearTimeout(i),i=void 0},s}function Mb(r,e,t){let n=0,i=r.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var pl=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ra,Lp=class{constructor(){Ra.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&pl(this,Ra,"f")[this.size-1].priority>=t.priority){pl(this,Ra,"f").push(n);return}let i=Mb(pl(this,Ra,"f"),n,(s,o)=>o.priority-s.priority);pl(this,Ra,"f").splice(i,0,n)}dequeue(){let e=pl(this,Ra,"f").shift();return e==null?void 0:e.run}filter(e){return pl(this,Ra,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return pl(this,Ra,"f").length}};Ra=new WeakMap;var yr=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},be=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Or,Mp,Up,Uc,b3,Fp,p3,Os,Bp,_i,m3,Ei,Vp,Mc,g3,Uk,Fk,Kk,Vk,zk,y3,Ub,Fb,_3,Hk,w3,E3=class extends Error{},Ot=class extends $k.default{constructor(e){var t,n,i,s;if(super(),Or.add(this),Mp.set(this,void 0),Up.set(this,void 0),Uc.set(this,0),b3.set(this,void 0),Fp.set(this,void 0),p3.set(this,0),Os.set(this,void 0),Bp.set(this,void 0),_i.set(this,void 0),m3.set(this,void 0),Ei.set(this,0),Vp.set(this,void 0),Mc.set(this,void 0),g3.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Lp,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);yr(this,Mp,e.carryoverConcurrencyCount,"f"),yr(this,Up,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),yr(this,b3,e.intervalCap,"f"),yr(this,Fp,e.interval,"f"),yr(this,_i,new e.queueClass,"f"),yr(this,m3,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,yr(this,g3,e.throwOnTimeout===!0,"f"),yr(this,Mc,e.autoStart===!1,"f")}get concurrency(){return be(this,Vp,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);yr(this,Vp,e,"f"),be(this,Or,"m",_3).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:be(this,g3,"f"),...t},new Promise((n,i)=>{be(this,_i,"f").enqueue(async()=>{var s,o,a;yr(this,Ei,(o=be(this,Ei,"f"),o++,o),"f"),yr(this,Uc,(a=be(this,Uc,"f"),a++,a),"f");try{if(!((s=t.signal)===null||s===void 0)&&s.aborted)throw new E3("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=Op(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,be(this,Or,"m",Hk).call(this,t.signal)]));let u=await c;n(u),this.emit("completed",u)}catch(c){if(c instanceof Nd&&!t.throwOnTimeout){n();return}i(c),this.emit("error",c)}finally{be(this,Or,"m",Kk).call(this)}},t),this.emit("add"),be(this,Or,"m",y3).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return be(this,Mc,"f")?(yr(this,Mc,!1,"f"),be(this,Or,"m",_3).call(this),this):this}pause(){yr(this,Mc,!0,"f")}clear(){yr(this,_i,new(be(this,m3,"f")),"f")}async onEmpty(){be(this,_i,"f").size!==0&&await be(this,Or,"m",w3).call(this,"empty")}async onSizeLessThan(e){be(this,_i,"f").size<e||await be(this,Or,"m",w3).call(this,"next",()=>be(this,_i,"f").size<e)}async onIdle(){be(this,Ei,"f")===0&&be(this,_i,"f").size===0||await be(this,Or,"m",w3).call(this,"idle")}get size(){return be(this,_i,"f").size}sizeBy(e){return be(this,_i,"f").filter(e).length}get pending(){return be(this,Ei,"f")}get isPaused(){return be(this,Mc,"f")}};Mp=new WeakMap,Up=new WeakMap,Uc=new WeakMap,b3=new WeakMap,Fp=new WeakMap,p3=new WeakMap,Os=new WeakMap,Bp=new WeakMap,_i=new WeakMap,m3=new WeakMap,Ei=new WeakMap,Vp=new WeakMap,Mc=new WeakMap,g3=new WeakMap,Or=new WeakSet,Uk=function(){return be(this,Up,"f")||be(this,Uc,"f")<be(this,b3,"f")},Fk=function(){return be(this,Ei,"f")<be(this,Vp,"f")},Kk=function(){var e;yr(this,Ei,(e=be(this,Ei,"f"),e--,e),"f"),be(this,Or,"m",y3).call(this),this.emit("next")},Vk=function(){be(this,Or,"m",Fb).call(this),be(this,Or,"m",Ub).call(this),yr(this,Bp,void 0,"f")},zk=function(){let e=Date.now();if(be(this,Os,"f")===void 0){let t=be(this,p3,"f")-e;if(t<0)yr(this,Uc,be(this,Mp,"f")?be(this,Ei,"f"):0,"f");else return be(this,Bp,"f")===void 0&&yr(this,Bp,setTimeout(()=>{be(this,Or,"m",Vk).call(this)},t),"f"),!0}return!1},y3=function(){if(be(this,_i,"f").size===0)return be(this,Os,"f")&&clearInterval(be(this,Os,"f")),yr(this,Os,void 0,"f"),this.emit("empty"),be(this,Ei,"f")===0&&this.emit("idle"),!1;if(!be(this,Mc,"f")){let e=!be(this,Or,"a",zk);if(be(this,Or,"a",Uk)&&be(this,Or,"a",Fk)){let t=be(this,_i,"f").dequeue();return t?(this.emit("active"),t(),e&&be(this,Or,"m",Ub).call(this),!0):!1}}return!1},Ub=function(){be(this,Up,"f")||be(this,Os,"f")!==void 0||(yr(this,Os,setInterval(()=>{be(this,Or,"m",Fb).call(this)},be(this,Fp,"f")),"f"),yr(this,p3,Date.now()+be(this,Fp,"f"),"f"))},Fb=function(){be(this,Uc,"f")===0&&be(this,Ei,"f")===0&&be(this,Os,"f")&&(clearInterval(be(this,Os,"f")),yr(this,Os,void 0,"f")),yr(this,Uc,be(this,Mp,"f")?be(this,Ei,"f"):0,"f"),be(this,Or,"m",_3).call(this)},_3=function(){for(;be(this,Or,"m",y3).call(this););},Hk=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new E3("The task was aborted."))},{once:!0})})},w3=async function(e,t){return new Promise(n=>{let i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};var uD=C(Ld(),1),Wb=new d3(1e3),wae=60*1e3,bae=Ot.default?Ot.default:Ot,_ae=new bae({concurrency:4}),cD=r=>{if(r.Path)return r.Path;throw new Error(r.Message)};async function lD(r,e){return(async(n,i={})=>{let s=new URLSearchParams(i);s.set("arg",n);let o=s.toString();if(!i.nocache&&Wb.has(o)){let c=Wb.get(o);return cD(c)}let a=await _ae.add(async()=>{let c=await uD.default.get("https://ipfs.io/api/v0/dns",{searchParams:s}),u=new URL(c.url).search.slice(1),l=await c.json();return Wb.set(u,l,wae),l});return cD(a)})(r,e)}function Eae(r){return r.endsWith(".eth")&&(r=r.replace(/.eth$/,".eth.link")),r}function fD(){return H(async(e,t={recursive:!0})=>{if(typeof e!="string")throw new Error("Invalid arguments, domain must be a string");return e=Eae(e),lD(e,t)})}function dD({network:r}){return()=>{let e=r.try();return e!=null&&Boolean(e.libp2p.isStarted())}}var Fc=class extends Error{constructor(e="The operation was aborted"){super(e),this.code=Fc.code,this.type=Fc.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}},ae=class extends Error{constructor(e,t,n){super(e),this.code=t,this.name=(n==null?void 0:n.name)??"CodeError",this.props=n??{}}};var Yb=Symbol.for("@libp2p/peer-id");function $n(r){return r!=null&&Boolean(r[Yb])}var vae=Symbol.for("nodejs.util.inspect.custom"),hD=Object.values(Xi).map(r=>r.decoder).reduce((r,e)=>r.or(e),Xi.identity.decoder),pD=114,Qb=36,Xb=37,Kp=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[Yb](){return!0}toString(){return this.string==null&&(this.string=Te.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return P.createV1(pD,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return ke(this.multihash.bytes,e);if(typeof e=="string")return fe(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return ke(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[vae](){return`PeerId(${this.toString()})`}},gl=class extends Kp{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},yl=class extends Kp{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},wl=class extends Kp{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function Lr(r){if(r.type==="RSA")return new gl(r);if(r.type==="Ed25519")return new yl(r);if(r.type==="secp256k1")return new wl(r);throw new ae("Not a PeerId","ERR_INVALID_PARAMETERS")}function fe(r,e){if(e=e??hD,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=Xt(Te.decode(`z${r}`));return r.startsWith("12D")?new yl({multihash:t}):r.startsWith("16U")?new wl({multihash:t}):new gl({multihash:t})}return wr(hD.decode(r))}function wr(r){try{let e=Xt(r);if(e.code===Hr.code){if(e.digest.length===Qb)return new yl({multihash:e});if(e.digest.length===Xb)return new wl({multihash:e})}if(e.code===Pe.code)return new gl({multihash:e})}catch{return Sae(P.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function Sae(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==pD)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===Pe.code)return new gl({multihash:r.multihash});if(e.code===Hr.code){if(e.digest.length===Qb)return new yl({multihash:r.multihash});if(e.digest.length===Xb)return new wl({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function br(r,e){return r.length===Qb?new yl({multihash:oo(Hr.code,r),privateKey:e}):r.length===Xb?new wl({multihash:oo(Hr.code,r),privateKey:e}):new gl({multihash:await Pe.digest(r),publicKey:r,privateKey:e})}function mD({repo:r,codecs:e,bases:t,name:n}){async function i(s,o={}){if(!s3(s))throw new Error("invalid argument "+s);if(o3(s))for await(let b of n.resolve(s,o))s=b;let[,a,c,...u]=s.split("/"),l=o.cidBase?await t.getBase(o.cidBase):void 0,f=xae(c);if(u.length===0){let b=l?l.encoder.encode(f):c;return`/${a}/${b}`}let h=P.decode(f);s=u.join("/");let d=Bc(h,s,e,r,o),m=h,w=s;for await(let b of d)P.asCID(b.value)&&(m=b.value,w=b.remainderPath);return`/ipfs/${m.toString(l&&l.encoder)}${w?"/"+w:""}`}return H(i)}function xae(r){try{return fe(r).toBytes()}catch{return P.parse(r).bytes}}async function Wt(r){let e;for await(let t of r)e=t;return e}function gD({addAll:r}){return(e,t={})=>{let n,i=P.asCID(e);return i?n=r([{cid:i,...t}],t):n=r([{path:e.toString(),...t}],t),Wt(n)}}var Bd=C(Y(),1);function Tae(r){return Symbol.iterator in r}function Aae(r){return Symbol.asyncIterator in r}function yD(r){return P.asCID(r)!=null}async function*yo(r){if(r==null)throw(0,Bd.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");let e=P.asCID(r);if(e){yield qn({cid:e});return}if(r instanceof String||typeof r=="string"){yield qn({path:r});return}if(r.cid!=null||r.path!=null)return yield qn(r);if(Tae(r)){let t=r[Symbol.iterator](),n=t.next();if(n.done)return t;if(yD(n.value)){yield qn({cid:n.value});for(let i of t)yield qn({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield qn({path:n.value});for(let i of t)yield qn({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield qn(n.value);for(let i of t)yield qn(i);return}throw(0,Bd.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}if(Aae(r)){let t=r[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(yD(n.value)){yield qn({cid:n.value});for await(let i of t)yield qn({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield qn({path:n.value});for await(let i of t)yield qn({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield qn(n.value);for await(let i of t)yield qn(i);return}throw(0,Bd.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}throw(0,Bd.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}function qn(r){let e=r.cid||`${r.path}`;if(!e)throw(0,Bd.default)(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");let t={path:e,recursive:r.recursive!==!1};return r.metadata!=null&&(t.metadata=r.metadata),t}var ft={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function wD({repo:r,codecs:e}){async function*t(n,i={}){let s=async function*(){for await(let{path:c,recursive:u,metadata:l}of yo(n)){let{cid:f}=await Lc(r,e,c),{reason:h}=await r.pins.isPinnedWithType(f,[ft.recursive,ft.direct]);if(h==="recursive"&&!u)throw new Error(`${f} already pinned recursively`);u?await r.pins.pinRecursively(f,{metadata:l}):await r.pins.pinDirectly(f,{metadata:l}),yield f}};if(!Boolean(i.lock)){yield*s();return}let a=await r.gcLock.readLock();try{yield*s()}finally{a()}}return H(t)}var Zb=C(Y(),1);function Hp(r,e,t){let n={type:r,cid:e};return t&&(n.metadata=t),n}function bD({repo:r,codecs:e}){async function*t(n={}){let i=ft.all;if(n.type&&(i=n.type,!Object.keys(ft).includes(i)))throw(0,Zb.default)(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let s=!1;for await(let{path:o}of yo(n.paths)){let{cid:a}=await Lc(r,e,o),{reason:c,pinned:u,parent:l,metadata:f}=await r.pins.isPinnedWithType(a,i);if(!u)throw(0,Zb.default)(new Error(`path '${o}' is not pinned`),"ERR_NOT_PINNED");switch(c){case ft.direct:case ft.recursive:s=!0,yield Hp(c,a,f);break;default:s=!0,yield Hp(`${ft.indirect} through ${l}`,a,f)}}if(!s)throw new Error("No match found");return}if(i===ft.recursive||i===ft.all)for await(let{cid:s,metadata:o}of r.pins.recursiveKeys())yield Hp(ft.recursive,s,o);if(i===ft.indirect||i===ft.all)for await(let s of r.pins.indirectKeys(n))yield Hp(ft.indirect,s);if(i===ft.direct||i===ft.all)for await(let{cid:s,metadata:o}of r.pins.directKeys())yield Hp(ft.direct,s,o)}return H(t)}function _D({rmAll:r}){async function e(t,n={}){let i=await Wt(r([{path:t,...n}],n));if(!i)throw new Error("CID expected");return i}return e}function ED({repo:r,codecs:e}){async function*t(n,i={}){let s=await r.gcLock.readLock();try{for await(let{path:o,recursive:a}of yo(n)){let{cid:c}=await Lc(r,e,o),{pinned:u,reason:l}=await r.pins.isPinnedWithType(c,ft.all);if(!u)throw new Error(`${c} is not pinned`);switch(l){case ft.recursive:if(!a)throw new Error(`${c} is pinned recursively`);await r.pins.unpin(c),yield c;break;case ft.direct:await r.pins.unpin(c),yield c;break;default:throw new Error(`${c} is pinned indirectly under ${l}`)}}}finally{s()}}return H(t)}var S3=class{constructor({codecs:e,repo:t}){let n=wD({codecs:e,repo:t});this.addAll=n,this.add=gD({addAll:n});let i=ED({codecs:e,repo:t});this.rmAll=i,this.rm=_D({rmAll:i}),this.ls=bD({codecs:e,repo:t}),this.remote={add:(s,o={})=>Promise.reject(new Error("Not implemented")),ls:async function*(s,o={}){return Promise.reject(new Error("Not implemented"))},rm:(s,o={})=>Promise.reject(new Error("Not implemented")),rmAll:(s,o={})=>Promise.reject(new Error("Not implemented")),service:{add:(s,o)=>Promise.reject(new Error("Not implemented")),rm:(s,o={})=>Promise.reject(new Error("Not implemented")),ls:(s={})=>Promise.reject(new Error("Not implemented"))}}}};var gL=C(Y(),1);var vi={};zt(vi,{abortedError:()=>Iae,dbDeleteFailedError:()=>T3,dbOpenFailedError:()=>x3,dbWriteFailedError:()=>A3,notFoundError:()=>tn});var Md=C(Y(),1);function x3(r){return r=r||new Error("Cannot open database"),(0,Md.default)(r,"ERR_DB_OPEN_FAILED")}function T3(r){return r=r||new Error("Delete failed"),(0,Md.default)(r,"ERR_DB_DELETE_FAILED")}function A3(r){return r=r||new Error("Write failed"),(0,Md.default)(r,"ERR_DB_WRITE_FAILED")}function tn(r){return r=r||new Error("Not Found"),(0,Md.default)(r,"ERR_NOT_FOUND")}function Iae(r){return r=r||new Error("Aborted"),(0,Md.default)(r,"ERR_ABORTED")}var rs=C(Y(),1);var sL=C(vD(),1);var oy={};zt(oy,{generateEphemeralKeyPair:()=>YN,generateKeyPair:()=>rh,generateKeyPairFromSeed:()=>nfe,importKey:()=>Io,keyStretcher:()=>HN,keysPBM:()=>Fd,marshalPrivateKey:()=>eE,marshalPublicKey:()=>u1,supportedKeys:()=>Ao,unmarshalPrivateKey:()=>hn,unmarshalPublicKey:()=>ii});var Fd={};zt(Fd,{KeyType:()=>nr,PrivateKey:()=>Bs,PublicKey:()=>Ls});var e_=C(Rg(),1),SD=C(B7(),1),t_=C(Ag(),1),xD=C(N7(),1),TD=C(pa(),1);function Rae(){TD.default._configure(),e_.default._configure(SD.default),t_.default._configure(xD.default)}Rae();var AD=["uint64","int64","sint64","fixed64","sfixed64"];function Cae(r){for(let e of AD){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function r_(r){return Cae(new e_.default(r))}function Pae(r){for(let e of AD){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function n_(){return Pae(t_.default.create())}function tt(r,e){let t=r_(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function rt(r,e){let t=n_();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Ud;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Ud||(Ud={}));function I3(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Si(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(s,o){let a=e(s);o.int32(a)},n=function(s){let o=s.int32();return e(o)};return I3("enum",Ud.VARINT,t,n)}function nt(r,e){return I3("message",Ud.LENGTH_DELIMITED,r,e)}var nr;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(nr||(nr={}));var i_;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(i_||(i_={}));(function(r){r.codec=()=>Si(i_)})(nr||(nr={}));var Ls;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),nr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.Type=nr.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(Ls||(Ls={}));var Bs;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),nr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.Type=nr.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(Bs||(Bs={}));var XIe=C(Kc(),1),ZIe=C(I_(),1),sy=C(it(),1);var Br={get(r=globalThis){let e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var FN={SHA1:20,SHA256:32,SHA512:64};var tle={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},rle=async(r,e)=>{let t=await Br.get().subtle.sign({name:"HMAC"},r,e);return new Uint8Array(t,0,t.byteLength)};async function VN(r,e){let t=tle[r],n=await Br.get().subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!1,["sign"]);return{async digest(i){return await rle(n,i)},length:FN[r]}}var KN={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function HN(r,e,t){let n=KN[r];if(n==null){let T=Object.keys(KN).join(" / ");throw new ae(`unknown cipher type '${r}'. Must be ${T}`,"ERR_INVALID_CIPHER_TYPE")}if(e==null)throw new ae("missing hash type","ERR_MISSING_HASH_TYPE");let i=n.keySize,s=n.ivSize,o=20,a=W("key expansion"),c=2*(s+i+o),u=await VN(e,t),l=await u.digest(a),f=[],h=0;for(;h<c;){let T=await u.digest(ve([l,a])),p=T.length;h+p>c&&(p=c-h),f.push(T),h+=p,l=await u.digest(l)}let d=c/2,m=ve(f),w=m.subarray(0,d),b=m.subarray(d,c),v=T=>({iv:T.subarray(0,s),cipherKey:T.subarray(s,s+i),macKey:T.subarray(s+i)});return{k1:v(w),k2:v(b)}}var $Ae=C(Jt(),1),qAe=C(K3(),1),$N=C(it(),1);function Fs(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=ve([new Uint8Array(e-t.length),t])}return j(t,"base64url")}function xi(r){let e=q3(r);return new $N.default.jsbn.BigInteger(j(e,"base16"),16)}function q3(r,e){let t=W(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=ve([new Uint8Array(e-t.length),t])}return t}var qN={"P-256":256,"P-384":384,"P-521":521},nle=Object.keys(qN),R_=nle.join(" / ");async function GN(r){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new ae(`Unknown curve: ${r}. Must be ${R_}`,"ERR_INVALID_CURVE");let e=await Br.get().subtle.generateKey({name:"ECDH",namedCurve:r},!0,["deriveBits"]),t=async(s,o)=>{let a;o!=null?a=await Br.get().subtle.importKey("jwk",sle(r,o),{name:"ECDH",namedCurve:r},!1,["deriveBits"]):a=e.privateKey;let c=await Br.get().subtle.importKey("jwk",WN(r,s),{name:"ECDH",namedCurve:r},!1,[]),u=await Br.get().subtle.deriveBits({name:"ECDH",namedCurve:r,public:c},a,qN[r]);return new Uint8Array(u,0,u.byteLength)},n=await Br.get().subtle.exportKey("jwk",e.publicKey);return{key:ile(n),genSharedKey:t}}var jN={"P-256":32,"P-384":48,"P-521":66};function ile(r){if(r.crv==null||r.x==null||r.y==null)throw new ae("JWK was missing components","ERR_INVALID_PARAMETERS");if(r.crv!=="P-256"&&r.crv!=="P-384"&&r.crv!=="P-521")throw new ae(`Unknown curve: ${r.crv}. Must be ${R_}`,"ERR_INVALID_CURVE");let e=jN[r.crv];return ve([Uint8Array.from([4]),q3(r.x,e),q3(r.y,e)],1+e*2)}function WN(r,e){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new ae(`Unknown curve: ${r}. Must be ${R_}`,"ERR_INVALID_CURVE");let t=jN[r];if(!ke(e.subarray(0,1),Uint8Array.from([4])))throw new ae("Cannot unmarshal public key - invalid key format","ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:r,x:j(e.subarray(1,t+1),"base64url"),y:j(e.subarray(1+t),"base64url"),ext:!0}}var sle=(r,e)=>({...WN(r,e.public),d:j(e.private,"base64url")});var YN=GN;function G3(r){let e=(r==null?void 0:r.algorithm)??"AES-GCM",t=(r==null?void 0:r.keyLength)??16,n=(r==null?void 0:r.nonceLength)??12,i=(r==null?void 0:r.digest)??"SHA-256",s=(r==null?void 0:r.saltLength)??16,o=(r==null?void 0:r.iterations)??32767,a=Br.get();t*=8;async function c(f,h){let d=a.getRandomValues(new Uint8Array(s)),m=a.getRandomValues(new Uint8Array(n)),w={name:e,iv:m};typeof h=="string"&&(h=W(h));let b={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},v=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),T=await a.subtle.deriveKey(b,v,{name:e,length:t},!0,["encrypt"]),p=await a.subtle.encrypt(w,T,f);return ve([d,w.iv,new Uint8Array(p)])}async function u(f,h){let d=f.subarray(0,s),m=f.subarray(s,s+n),w=f.subarray(s+n),b={name:e,iv:m};typeof h=="string"&&(h=W(h));let v={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},T=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await a.subtle.deriveKey(v,T,{name:e,length:t},!0,["decrypt"]),g=await a.subtle.decrypt(b,p,w);return new Uint8Array(g)}return{encrypt:c,decrypt:u}}async function XN(r,e){let t=ao.decode(r);return await G3().decrypt(t,e)}var F_={};zt(F_,{RsaPrivateKey:()=>Jd,RsaPublicKey:()=>t1,fromJwk:()=>Ple,generateKeyPair:()=>kle,unmarshalRsaPrivateKey:()=>Rle,unmarshalRsaPublicKey:()=>Cle});var LIe=C(rO(),1),e1=C(it(),1);var ale=C($c(),1);var _t=BigInt(0),or=BigInt(1),Wc=BigInt(2),Xp=BigInt(3),nO=BigInt(8),xr=Object.freeze({a:_t,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:or,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),iO=(r,e)=>(r+e/Wc)/e,j3={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=xr,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-or*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=iO(s*r,e),c=iO(-n*r,e),u=ge(r-a*t-c*i,e),l=ge(-a*n-c*s,e),f=u>o,h=l>o;if(f&&(u=e-u),h&&(l=e-l),u>o||l>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:f,k1:u,k2neg:h,k2:l}}},Vs=32,Wd=32,cle=32,sO=Vs+1,oO=2*Vs+1;function aO(r){let{a:e,b:t}=xr,n=ge(r*r),i=ge(n*r);return ge(i+e*r+t)}var W3=xr.a===_t,X3=class extends Error{constructor(e){super(e)}};function cO(r){if(!(r instanceof It))throw new TypeError("JacobianPoint expected")}var It=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof Lt))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(Lt.ZERO)?It.ZERO:new It(e.x,e.y,or)}static toAffineBatch(e){let t=hle(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return It.toAffineBatch(e).map(It.fromAffine)}equals(e){cO(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=ge(i*i),u=ge(a*a),l=ge(t*u),f=ge(s*c),h=ge(ge(n*a)*u),d=ge(ge(o*i)*c);return l===f&&h===d}negate(){return new It(this.x,ge(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,i=ge(e*e),s=ge(t*t),o=ge(s*s),a=e+s,c=ge(Wc*(ge(a*a)-i-o)),u=ge(Xp*i),l=ge(u*u),f=ge(l-Wc*c),h=ge(u*(c-f)-nO*o),d=ge(Wc*t*n);return new It(f,h,d)}add(e){cO(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e;if(s===_t||o===_t)return this;if(t===_t||n===_t)return e;let c=ge(i*i),u=ge(a*a),l=ge(t*u),f=ge(s*c),h=ge(ge(n*a)*u),d=ge(ge(o*i)*c),m=ge(f-l),w=ge(d-h);if(m===_t)return w===_t?this.double():It.ZERO;let b=ge(m*m),v=ge(m*b),T=ge(l*b),p=ge(w*w-v-Wc*T),g=ge(w*(T-p)-h*v),y=ge(i*a*m);return new It(p,g,y)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=It.ZERO;if(typeof e=="bigint"&&e===_t)return t;let n=fO(e);if(n===or)return this;if(!W3){let f=t,h=this;for(;n>_t;)n&or&&(f=f.add(h)),h=h.double(),n>>=or;return f}let{k1neg:i,k1:s,k2neg:o,k2:a}=j3.splitScalar(n),c=t,u=t,l=this;for(;s>_t||a>_t;)s&or&&(c=c.add(l)),a&or&&(u=u.add(l)),l=l.double(),s>>=or,a>>=or;return i&&(c=c.negate()),o&&(u=u.negate()),u=new It(ge(u.x*j3.beta),u.y,u.z),c.add(u)}precomputeWindow(e){let t=W3?128/e+1:256/e+1,n=[],i=this,s=i;for(let o=0;o<t;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals(It.BASE)&&(t=Lt.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&D_.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=It.normalizeZ(i),D_.set(t,i)));let s=It.ZERO,o=It.BASE,a=1+(W3?128/n:256/n),c=2**(n-1),u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<a;h++){let d=h*c,m=Number(e&u);e>>=f,m>c&&(m-=l,e+=or);let w=d,b=d+Math.abs(m)-1,v=h%2!==0,T=m<0;m===0?o=o.add(Y3(v,i[w])):s=s.add(Y3(T,i[b]))}return{p:s,f:o}}multiply(e,t){let n=fO(e),i,s;if(W3){let{k1neg:o,k1:a,k2neg:c,k2:u}=j3.splitScalar(n),{p:l,f}=this.wNAF(a,t),{p:h,f:d}=this.wNAF(u,t);l=Y3(o,l),h=Y3(c,h),h=new It(ge(h.x*j3.beta),h.y,h.z),i=l.add(h),s=f.add(d)}else{let{p:o,f:a}=this.wNAF(n,t);i=o,s=a}return It.normalizeZ([i,s])[0]}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals(It.ZERO);e==null&&(e=s?nO:Xd(i));let o=e,a=ge(o*o),c=ge(a*o),u=ge(t*a),l=ge(n*c),f=ge(i*o);if(s)return Lt.ZERO;if(f!==or)throw new Error("invZ was invalid");return new Lt(u,l)}};It.BASE=new It(xr.Gx,xr.Gy,or);It.ZERO=new It(_t,or,_t);function Y3(r,e){let t=e.negate();return r?t:e}var D_=new WeakMap,Lt=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,D_.delete(this)}hasEvenY(){return this.y%Wc===_t}static fromCompressedHex(e){let t=e.length===32,n=Yc(t?e:e.subarray(1));if(!k_(n))throw new Error("Point is not on curve");let i=aO(n),s=dle(i),o=(s&or)===or;t?o&&(s=ge(-s)):(e[0]&1)===1!==o&&(s=ge(-s));let a=new Lt(n,s);return a.assertValidity(),a}static fromUncompressedHex(e){let t=Yc(e.subarray(1,Vs+1)),n=Yc(e.subarray(Vs+1,Vs*2+1)),i=new Lt(t,n);return i.assertValidity(),i}static fromHex(e){let t=Qd(e),n=t.length,i=t[0];if(n===Vs)return this.fromCompressedHex(t);if(n===sO&&(i===2||i===3))return this.fromCompressedHex(t);if(n===oO&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${sO} compressed bytes or ${oO} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return Lt.BASE.multiply(J3(e))}static fromSignature(e,t,n){let{r:i,s}=dO(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let o=L_(Qd(e)),{n:a}=xr,c=n===2||n===3?i+a:i,u=Xd(c,a),l=ge(-o*u,a),f=ge(s*u,a),h=n&1?"03":"02",d=Lt.fromHex(h+Gd(c)),m=Lt.BASE.multiplyAndAddUnsafe(d,l,f);if(!m)throw new Error("Cannot recover signature: point at infinify");return m.assertValidity(),m}toRawBytes(e=!1){return Tl(this.toHex(e))}toHex(e=!1){let t=Gd(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Gd(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!k_(t)||!k_(n))throw new Error(e);let i=ge(n*n),s=aO(t);if(ge(i-s)!==_t)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Lt(this.x,ge(-this.y))}double(){return It.fromAffine(this).double().toAffine()}add(e){return It.fromAffine(this).add(It.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return It.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let i=It.fromAffine(this),s=t===_t||t===or||this!==Lt.BASE?i.multiplyUnsafe(t):i.multiply(t),o=It.fromAffine(e).multiplyUnsafe(n),a=s.add(o);return a.equals(It.ZERO)?void 0:a.toAffine()}};Lt.BASE=new Lt(xr.Gx,xr.Gy);Lt.ZERO=new Lt(_t,_t);function uO(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function lO(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${Yd(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Yc(t),left:r.subarray(e+2)}}function ule(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${Yd(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=lO(r.subarray(2)),{data:n,left:i}=lO(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${Yd(i)}`);return{r:e,s:n}}var xo=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=t?Yd(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new xo(Z3(i.slice(0,64)),Z3(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=ule(t?e:Tl(e));return new xo(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!Jp(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Jp(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=xr.n>>or;return this.s>e}normalizeS(){return this.hasHighS()?new xo(this.r,ge(-this.s,xr.n)):this}toDERRawBytes(){return Tl(this.toDERHex())}toDERHex(){let e=uO(Qp(this.s)),t=uO(Qp(this.r)),n=e.length/2,i=t.length/2,s=Qp(n),o=Qp(i);return`30${Qp(i+n+4)}02${o}${t}02${s}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Tl(this.toCompactHex())}toCompactHex(){return Gd(this.r)+Gd(this.s)}};function jc(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var lle=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Yd(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=lle[r[t]];return e}var fle=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Gd(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(_t<=r&&r<fle))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function N_(r){let e=Tl(Gd(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Qp(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function Z3(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function Tl(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function Yc(r){return Z3(Yd(r))}function Qd(r){return r instanceof Uint8Array?Uint8Array.from(r):Tl(r)}function fO(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&Jp(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function ge(r,e=xr.P){let t=r%e;return t>=_t?t:e+t}function es(r,e){let{P:t}=xr,n=r;for(;e-- >_t;)n*=n,n%=t;return n}function dle(r){let{P:e}=xr,t=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=r*r*r%e,u=c*c*r%e,l=es(u,Xp)*u%e,f=es(l,Xp)*u%e,h=es(f,Wc)*c%e,d=es(h,n)*h%e,m=es(d,i)*d%e,w=es(m,o)*m%e,b=es(w,a)*w%e,v=es(b,o)*m%e,T=es(v,Xp)*u%e,p=es(T,s)*d%e,g=es(p,t)*c%e,y=es(g,Wc);if(y*y%e!==r)throw new Error("Cannot find square root");return y}function Xd(r,e=xr.P){if(r===_t||e<=_t)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=ge(r,e),n=e,i=_t,s=or,o=or,a=_t;for(;t!==_t;){let u=n/t,l=n%t,f=i-o*u,h=s-a*u;n=t,t=l,i=o,s=a,o=f,a=h}if(n!==or)throw new Error("invert: does not exist");return ge(i,e)}function hle(r,e=xr.P){let t=new Array(r.length),n=r.reduce((s,o,a)=>o===_t?s:(t[a]=s,ge(s*o,e)),or),i=Xd(n,e);return r.reduceRight((s,o,a)=>o===_t?s:(t[a]=ge(s*t[a],e),ge(s*o,e)),i),t}function ple(r){let e=r.length*8-Wd*8,t=Yc(r);return e>0?t>>BigInt(e):t}function L_(r,e=!1){let t=ple(r);if(e)return t;let{n}=xr;return t>=n?t-n:t}var jd,Zp,O_=class{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return zs.hmacSha256(this.k,...e)}hmacSync(...e){return Zp(this.k,...e)}checkSync(){if(typeof Zp!="function")throw new X3("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return jc(...t)}generateSync(){this.checkSync(),this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return jc(...t)}};function Jp(r){return _t<r&&r<xr.n}function k_(r){return _t<r&&r<xr.P}function mle(r,e,t,n=!0){let{n:i}=xr,s=L_(r,!0);if(!Jp(s))return;let o=Xd(s,i),a=Lt.BASE.multiply(s),c=ge(a.x,i);if(c===_t)return;let u=ge(o*ge(e+t*c,i),i);if(u===_t)return;let l=new xo(c,u),f=(a.x===l.r?0:2)|Number(a.y&or);return n&&l.hasHighS()&&(l=l.normalizeS(),f^=1),{sig:l,recovery:f}}function J3(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*Wd)throw new Error("Expected 32 bytes of private key");e=Z3(r)}else if(r instanceof Uint8Array){if(r.length!==Wd)throw new Error("Expected 32 bytes of private key");e=Yc(r)}else throw new TypeError("Expected valid private key");if(!Jp(e))throw new Error("Expected private key: 0 < key < n");return e}function gle(r){return r instanceof Lt?(r.assertValidity(),r):Lt.fromHex(r)}function dO(r){if(r instanceof xo)return r.assertValidity(),r;try{return xo.fromDER(r)}catch{return xo.fromCompact(r)}}function B_(r,e=!1){return Lt.fromPrivateKey(r).toRawBytes(e)}function hO(r){let e=r.length>Vs?r.slice(0,Vs):r;return Yc(e)}function yle(r){let e=hO(r),t=ge(e,xr.n);return pO(t<_t?e:t)}function pO(r){return N_(r)}function wle(r,e,t){if(r==null)throw new Error(`sign: expected valid message hash, not "${r}"`);let n=Qd(r),i=J3(e),s=[pO(i),yle(n)];if(t!=null){t===!0&&(t=zs.randomBytes(Vs));let c=Qd(t);if(c.length!==Vs)throw new Error(`sign: Expected ${Vs} bytes of extra data`);s.push(c)}let o=jc(...s),a=hO(n);return{seed:o,m:a,d:i}}function ble(r,e){let{sig:t,recovery:n}=r,{der:i,recovered:s}=Object.assign({canonical:!0,der:!0},e),o=i?t.toDERRawBytes():t.toCompactRawBytes();return s?[o,n]:o}async function mO(r,e,t={}){let{seed:n,m:i,d:s}=wle(r,e,t.extraEntropy),o=new O_(cle,Wd);await o.reseed(n);let a;for(;!(a=mle(await o.generate(),i,s,t.canonical));)await o.reseed();return ble(a,t)}var _le={strict:!0};function gO(r,e,t,n=_le){let i;try{i=dO(r),e=Qd(e)}catch{return!1}let{r:s,s:o}=i;if(n.strict&&i.hasHighS())return!1;let a=L_(e),c;try{c=gle(t)}catch{return!1}let{n:u}=xr,l=Xd(o,u),f=ge(a*l,u),h=ge(s*l,u),d=Lt.BASE.multiplyAndAddUnsafe(c,f,h);return d?ge(d.x,u)===s:!1}Lt.BASE._setWindowSize(8);var Ti={node:ale,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Q3={},zs={bytesToHex:Yd,hexToBytes:Tl,concatBytes:jc,mod:ge,invert:Xd,isValidPrivateKey(r){try{return J3(r),!0}catch{return!1}},_bigintTo32Bytes:N_,_normalizePrivateKey:J3,hashToPrivateKey:r=>{r=Qd(r);let e=Wd+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=ge(Yc(r),xr.n-or)+or;return N_(t)},randomBytes:(r=32)=>{if(Ti.web)return Ti.web.getRandomValues(new Uint8Array(r));if(Ti.node){let{randomBytes:e}=Ti.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>zs.hashToPrivateKey(zs.randomBytes(Wd+8)),precompute(r=8,e=Lt.BASE){let t=e===Lt.BASE?e:new Lt(e.x,e.y);return t._setWindowSize(r),t.multiply(Xp),t},sha256:async(...r)=>{if(Ti.web){let e=await Ti.web.subtle.digest("SHA-256",jc(...r));return new Uint8Array(e)}else if(Ti.node){let{createHash:e}=Ti.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(Ti.web){let t=await Ti.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=jc(...e),i=await Ti.web.subtle.sign("HMAC",t,n);return new Uint8Array(i)}else if(Ti.node){let{createHmac:t}=Ti.node,n=t("sha256",r);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=Q3[r];if(t===void 0){let n=await zs.sha256(Uint8Array.from(r,i=>i.charCodeAt(0)));t=jc(n,n),Q3[r]=t}return zs.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof jd!="function")throw new X3("sha256Sync is undefined, you need to set it");let t=Q3[r];if(t===void 0){let n=jd(Uint8Array.from(r,i=>i.charCodeAt(0)));t=jc(n,n),Q3[r]=t}return jd(t,...e)},_JacobianPoint:It};Object.defineProperties(zs,{sha256Sync:{configurable:!1,get(){return jd},set(r){jd||(jd=r)}},hmacSha256Sync:{configurable:!1,get(){return Zp},set(r){Zp||(Zp=r)}}});function ri(r){if(isNaN(r)||r<=0)throw new ae("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return zs.randomBytes(r)}var Al={};zt(Al,{jwkToPkcs1:()=>Sle,jwkToPkix:()=>Tle,pkcs1ToJwk:()=>vle,pkixToJwk:()=>xle});var pIe=C(Kc(),1),mIe=C(Wp(),1),Da=C(it(),1);function vle(r){let e=Da.default.asn1.fromDer(j(r,"ascii")),t=Da.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:Fs(t.n),e:Fs(t.e),d:Fs(t.d),p:Fs(t.p),q:Fs(t.q),dp:Fs(t.dP),dq:Fs(t.dQ),qi:Fs(t.qInv),alg:"RS256"}}function Sle(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ae("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Da.default.pki.privateKeyToAsn1({n:xi(r.n),e:xi(r.e),d:xi(r.d),p:xi(r.p),q:xi(r.q),dP:xi(r.dp),dQ:xi(r.dq),qInv:xi(r.qi)});return W(Da.default.asn1.toDer(e).getBytes(),"ascii")}function xle(r){let e=Da.default.asn1.fromDer(j(r,"ascii")),t=Da.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:Fs(t.n),e:Fs(t.e)}}function Tle(r){if(r.n==null||r.e==null)throw new ae("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Da.default.pki.publicKeyToAsn1({n:xi(r.n),e:xi(r.e)});return W(Da.default.asn1.toDer(e).getBytes(),"ascii")}var _Ie=C(Wp(),1),M_=C(it(),1);function yO(r,e){return e.map(t=>xi(r[t]))}function wO(r){return M_.default.pki.setRsaPrivateKey(...yO(r,["n","e","d","p","q","dp","dq","qi"]))}function bO(r){return M_.default.pki.setRsaPublicKey(...yO(r,["n","e"]))}async function _O(r){let e=await Br.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await SO(e);return{privateKey:t[0],publicKey:t[1]}}async function U_(r){let t=[await Br.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Ale(r)],n=await SO({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function EO(r,e){let t=await Br.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Br.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function vO(r,e,t){let n=await Br.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Br.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function SO(r){if(r.privateKey==null||r.publicKey==null)throw new ae("Private and public key are required","ERR_INVALID_PARAMETERS");return await Promise.all([Br.get().subtle.exportKey("jwk",r.privateKey),Br.get().subtle.exportKey("jwk",r.publicKey)])}async function Ale(r){return await Br.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xO(r,e,t,n){let i=e?bO(r):wO(r),s=j(Uint8Array.from(t),"ascii"),o=n(s,i);return W(o,"ascii")}function TO(r,e){return xO(r,!0,e,(t,n)=>n.encrypt(t))}function AO(r,e){return xO(r,!1,e,(t,n)=>n.decrypt(t))}async function Zd(r,e){let n=await G3().encrypt(r,e);return ao.encode(n)}var t1=class{constructor(e){this._key=e}async verify(e,t){return await vO(this._key,t,e)}marshal(){return Al.jwkToPkix(this._key)}get bytes(){return Ls.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}encrypt(e){return TO(this._key,e)}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}},Jd=class{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return ri(16)}async sign(e){return await EO(this._key,e)}get public(){if(this._publicKey==null)throw new ae("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new t1(this._publicKey)}decrypt(e){return AO(this._key,e)}marshal(){return Al.jwkToPkcs1(this._key)}get bytes(){return Bs.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}async id(){let e=await this.public.hash();return j(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){let n=new e1.default.util.ByteBuffer(this.marshal()),i=e1.default.asn1.fromDer(n),s=e1.default.pki.privateKeyFromAsn1(i),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return e1.default.pki.encryptRsaPrivateKey(s,e,o)}else{if(t==="libp2p-key")return await Zd(this.bytes,e);throw new ae(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function Rle(r){let e=Al.pkcs1ToJwk(r),t=await U_(e);return new Jd(t.privateKey,t.publicKey)}function Cle(r){let e=Al.pkixToJwk(r);return new t1(e)}async function Ple(r){let e=await U_(r);return new Jd(e.privateKey,e.publicKey)}async function kle(r){let e=await _O(r);return new Jd(e.privateKey,e.publicKey)}var Y_={};zt(Y_,{Ed25519PrivateKey:()=>Rl,Ed25519PublicKey:()=>o1,generateKeyPair:()=>Zle,generateKeyPairFromSeed:()=>W_,unmarshalEd25519PrivateKey:()=>Qle,unmarshalEd25519PublicKey:()=>Xle});var Dle=C($c(),1);var dn=BigInt(0),Et=BigInt(1),Zc=BigInt(2),Nle=BigInt(8),IO=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),ar=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:IO,n:IO,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var DO=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),r1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),MIe=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),Ole=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Lle=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Ble=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Mle=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),gt=class{constructor(e,t,n,i){this.x=e,this.y=t,this.z=n,this.t=i}static fromAffine(e){if(!(e instanceof lr))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(lr.ZERO)?gt.ZERO:new gt(e.x,e.y,Et,te(e.x*e.y))}static toAffineBatch(e){let t=Vle(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){CO(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=te(t*a),u=te(s*i),l=te(n*a),f=te(o*i);return c===u&&l===f}negate(){return new gt(te(-this.x),this.y,this.z,te(-this.t))}double(){let{x:e,y:t,z:n}=this,{a:i}=ar,s=te(e*e),o=te(t*t),a=te(Zc*te(n*n)),c=te(i*s),u=e+t,l=te(te(u*u)-s-o),f=c+o,h=f-a,d=c-o,m=te(l*h),w=te(f*d),b=te(l*d),v=te(h*f);return new gt(m,w,v,b)}add(e){CO(e);let{x:t,y:n,z:i,t:s}=this,{x:o,y:a,z:c,t:u}=e,l=te((n-t)*(a+o)),f=te((n+t)*(a-o)),h=te(f-l);if(h===dn)return this.double();let d=te(i*Zc*u),m=te(s*Zc*c),w=m+d,b=f+l,v=m-d,T=te(w*h),p=te(b*v),g=te(w*v),y=te(h*b);return new gt(T,p,y,g)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let t=1+256/e,n=[],i=this,s=i;for(let o=0;o<t;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals(gt.BASE)&&(t=lr.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&$_.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=gt.normalizeZ(i),$_.set(t,i)));let s=gt.ZERO,o=gt.BASE,a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<a;h++){let d=h*c,m=Number(e&u);e>>=f,m>c&&(m-=l,e+=Et);let w=d,b=d+Math.abs(m)-1,v=h%2!==0,T=m<0;m===0?o=o.add(RO(v,i[w])):s=s.add(RO(T,i[b]))}return gt.normalizeZ([s,o])[0]}multiply(e,t){return this.wNAF(ty(e,ar.l),t)}multiplyUnsafe(e){let t=ty(e,ar.l,!1),n=gt.BASE,i=gt.ZERO;if(t===dn)return i;if(this.equals(i)||t===Et)return this;if(this.equals(n))return this.wNAF(t);let s=i,o=this;for(;t>dn;)t&Et&&(s=s.add(o)),o=o.double(),t>>=Et;return s}isSmallOrder(){return this.multiplyUnsafe(ar.h).equals(gt.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(ar.l/Zc).double();return ar.l%Zc&&(e=e.add(this)),e.equals(gt.ZERO)}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals(gt.ZERO);e==null&&(e=s?Nle:ry(i));let o=te(t*e),a=te(n*e),c=te(i*e);if(s)return lr.ZERO;if(c!==Et)throw new Error("invZ was invalid");return new lr(o,a)}fromRistrettoBytes(){z_()}toRistrettoBytes(){z_()}fromRistrettoHash(){z_()}};gt.BASE=new gt(ar.Gx,ar.Gy,Et,te(ar.Gx*ar.Gy));gt.ZERO=new gt(dn,Et,Et,dn);function RO(r,e){let t=e.negate();return r?t:e}function CO(r){if(!(r instanceof gt))throw new TypeError("ExtendedPoint expected")}function V_(r){if(!(r instanceof ni))throw new TypeError("RistrettoPoint expected")}function z_(){throw new Error("Legacy method: switch to RistrettoPoint")}var ni=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:t}=ar,n=te(r1*e*e),i=te((n+Et)*Ble),s=BigInt(-1),o=te((s-t*n)*te(n+t)),{isValid:a,value:c}=G_(i,o),u=te(c*e);Xc(u)||(u=te(-u)),a||(c=u),a||(s=n);let l=te(s*(n-Et)*Mle-o),f=c*c,h=te((c+c)*o),d=te(l*Ole),m=te(Et-f),w=te(Et+f);return new gt(te(h*w),te(m*d),te(d*w),te(h*m))}static hashToCurve(e){e=Jc(e,64);let t=K_(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),i=K_(e.slice(32,64)),s=this.calcElligatorRistrettoMap(i);return new ni(n.add(s))}static fromHex(e){e=Jc(e,32);let{a:t,d:n}=ar,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=K_(e);if(!Kle(n1(s),e)||Xc(s))throw new Error(i);let o=te(s*s),a=te(Et+t*o),c=te(Et-t*o),u=te(a*a),l=te(c*c),f=te(t*n*u-l),{isValid:h,value:d}=kO(te(f*l)),m=te(d*c),w=te(d*m*f),b=te((s+s)*m);Xc(b)&&(b=te(-b));let v=te(a*w),T=te(b*v);if(!h||Xc(T)||v===dn)throw new Error(i);return new ni(new gt(b,v,Et,T))}toRawBytes(){let{x:e,y:t,z:n,t:i}=this.ep,s=te(te(n+t)*te(n-t)),o=te(e*t),a=te(o*o),{value:c}=kO(te(s*a)),u=te(c*s),l=te(c*o),f=te(u*l*i),h;if(Xc(i*f)){let m=te(t*r1),w=te(e*r1);e=m,t=w,h=te(u*Lle)}else h=l;Xc(e*f)&&(t=te(-t));let d=te((n-t)*h);return Xc(d)&&(d=te(-d)),n1(d)}toHex(){return i1(this.toRawBytes())}toString(){return this.toHex()}equals(e){V_(e);let t=this.ep,n=e.ep,i=te(t.x*n.y)===te(t.y*n.x),s=te(t.y*n.y)===te(t.x*n.x);return i||s}add(e){return V_(e),new ni(this.ep.add(e.ep))}subtract(e){return V_(e),new ni(this.ep.subtract(e.ep))}multiply(e){return new ni(this.ep.multiply(e))}multiplyUnsafe(e){return new ni(this.ep.multiplyUnsafe(e))}};ni.BASE=new ni(gt.BASE);ni.ZERO=new ni(gt.ZERO);var $_=new WeakMap,lr=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,$_.delete(this)}static fromHex(e,t=!0){let{d:n,P:i}=ar;e=Jc(e,32);let s=e.slice();s[31]=e[31]&-129;let o=s1(s);if(t&&o>=i)throw new Error("Expected 0 < hex < P");if(!t&&o>=DO)throw new Error("Expected 0 < hex < 2**256");let a=te(o*o),c=te(a-Et),u=te(n*a+Et),{isValid:l,value:f}=G_(c,u);if(!l)throw new Error("Point.fromHex: invalid y coordinate");let h=(f&Et)===Et;return(e[31]&128)!==0!==h&&(f=te(-f)),new lr(f,o)}static async fromPrivateKey(e){return(await ny(e)).point}toRawBytes(){let e=n1(this.y);return e[31]|=this.x&Et?128:0,e}toHex(){return i1(this.toRawBytes())}toX25519(){let{y:e}=this,t=te((Et+e)*ry(Et-e));return n1(t)}isTorsionFree(){return gt.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new lr(te(-this.x),this.y)}add(e){return gt.fromAffine(this).add(gt.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return gt.fromAffine(this).multiply(e,this).toAffine()}};lr.BASE=new lr(ar.Gx,ar.Gy);lr.ZERO=new lr(dn,Et);var Il=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){let t=Jc(e,64),n=lr.fromHex(t.slice(0,32),!1),i=s1(t.slice(32,64));return new Il(n,i)}assertValidity(){let{r:e,s:t}=this;if(!(e instanceof lr))throw new Error("Expected Point instance");return ty(t,ar.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(n1(this.s),32),e}toHex(){return i1(this.toRawBytes())}};function PO(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var Ule=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function i1(r){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=Ule[r[t]];return e}function q_(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function NO(r){let t=r.toString(16).padStart(64,"0");return q_(t)}function n1(r){return NO(r).reverse()}function Xc(r){return(te(r)&Et)===Et}function s1(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+i1(Uint8Array.from(r).reverse()))}var Fle=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function K_(r){return te(s1(r)&Fle)}function te(r,e=ar.P){let t=r%e;return t>=dn?t:e+t}function ry(r,e=ar.P){if(r===dn||e<=dn)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=te(r,e),n=e,i=dn,s=Et,o=Et,a=dn;for(;t!==dn;){let u=n/t,l=n%t,f=i-o*u,h=s-a*u;n=t,t=l,i=o,s=a,o=f,a=h}if(n!==Et)throw new Error("invert: does not exist");return te(i,e)}function Vle(r,e=ar.P){let t=new Array(r.length),n=r.reduce((s,o,a)=>o===dn?s:(t[a]=s,te(s*o,e)),Et),i=ry(n,e);return r.reduceRight((s,o,a)=>o===dn?s:(t[a]=te(s*t[a],e),te(s*o,e)),i),t}function To(r,e){let{P:t}=ar,n=r;for(;e-- >dn;)n*=n,n%=t;return n}function zle(r){let{P:e}=ar,t=BigInt(5),n=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),c=r*r%e*r%e,u=To(c,Zc)*c%e,l=To(u,Et)*r%e,f=To(l,t)*l%e,h=To(f,n)*f%e,d=To(h,i)*h%e,m=To(d,s)*d%e,w=To(m,o)*m%e,b=To(w,o)*m%e,v=To(b,n)*f%e;return{pow_p_5_8:To(v,Zc)*r%e,b2:c}}function G_(r,e){let t=te(e*e*e),n=te(t*t*e),i=zle(r*n).pow_p_5_8,s=te(r*t*i),o=te(e*s*s),a=s,c=te(s*r1),u=o===r,l=o===te(-r),f=o===te(-r*r1);return u&&(s=a),(l||f)&&(s=c),Xc(s)&&(s=te(-s)),{isValid:u||l,value:s}}function kO(r){return G_(Et,r)}function ey(r){return te(s1(r),ar.l)}function Kle(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Jc(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):q_(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function ty(r,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof r=="number"&&Number.isSafeInteger(r)&&(r=BigInt(r)),typeof r=="bigint"&&r<e){if(t){if(dn<r)return r}else if(dn<=r)return r}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Hle(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function $le(r){if(r=typeof r=="bigint"||typeof r=="number"?NO(ty(r,DO)):Jc(r),r.length!==32)throw new Error("Expected 32 bytes");return r}function qle(r){let e=Hle(r.slice(0,32)),t=r.slice(32,64),n=ey(e),i=lr.BASE.multiply(n),s=i.toRawBytes();return{head:e,prefix:t,scalar:n,point:i,pointBytes:s}}var H_;async function ny(r){return qle(await eu.sha512($le(r)))}async function j_(r){return(await ny(r)).pointBytes}async function OO(r,e){r=Jc(r);let{prefix:t,scalar:n,pointBytes:i}=await ny(e),s=ey(await eu.sha512(t,r)),o=lr.BASE.multiply(s),a=ey(await eu.sha512(o.toRawBytes(),i,r)),c=te(s+a*n,ar.l);return new Il(o,c).toRawBytes()}function Gle(r,e,t){e=Jc(e),t instanceof lr||(t=lr.fromHex(t,!1));let{r:n,s:i}=r instanceof Il?r.assertValidity():Il.fromHex(r),s=gt.BASE.multiplyUnsafe(i);return{r:n,s:i,SB:s,pub:t,msg:e}}function jle(r,e,t,n){let i=ey(n),s=gt.fromAffine(r).multiplyUnsafe(i);return gt.fromAffine(e).add(s).subtract(t).multiplyUnsafe(ar.h).equals(gt.ZERO)}async function LO(r,e,t){let{r:n,SB:i,msg:s,pub:o}=Gle(r,e,t),a=await eu.sha512(n.toRawBytes(),o.toRawBytes(),s);return jle(o,n,i,a)}lr.BASE._setWindowSize(8);var Qc={node:Dle,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},eu={bytesToHex:i1,hexToBytes:q_,concatBytes:PO,getExtendedPublicKey:ny,mod:te,invert:ry,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:r=>{if(r=Jc(r),r.length<40||r.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return te(s1(r),ar.l-Et)+Et},randomBytes:(r=32)=>{if(Qc.web)return Qc.web.getRandomValues(new Uint8Array(r));if(Qc.node){let{randomBytes:e}=Qc.node;return new Uint8Array(e(r).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>eu.randomBytes(32),sha512:async(...r)=>{let e=PO(...r);if(Qc.web){let t=await Qc.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}else{if(Qc.node)return Uint8Array.from(Qc.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(r=8,e=lr.BASE){let t=e.equals(lr.BASE)?e:new lr(e.x,e.y);return t._setWindowSize(r),t.multiply(Zc),t},sha512Sync:void 0};Object.defineProperties(eu,{sha512Sync:{configurable:!1,get(){return H_},set(r){H_||(H_=r)}}});var eh=32,Na=64,iy=32;async function BO(){let r=eu.randomPrivateKey(),e=await j_(r);return{privateKey:VO(r,e),publicKey:e}}async function MO(r){if(r.length!==iy)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=r,t=await j_(e);return{privateKey:VO(e,t),publicKey:t}}async function UO(r,e){let t=r.subarray(0,iy);return await OO(e,t)}async function FO(r,e,t){return await LO(e,t,r)}function VO(r,e){let t=new Uint8Array(Na);for(let n=0;n<iy;n++)t[n]=r[n],t[iy+n]=e[n];return t}var o1=class{constructor(e){this._key=th(e,eh)}async verify(e,t){return await FO(this._key,t,e)}marshal(){return this._key}get bytes(){return Ls.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}},Rl=class{constructor(e,t){this._key=th(e,Na),this._publicKey=th(t,eh)}async sign(e){return await UO(this._key,e)}get public(){return new o1(this._publicKey)}marshal(){return this._key}get bytes(){return Bs.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}async id(){let e=await Hr.digest(this.public.bytes);return Te.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return await Zd(this.bytes,e);throw new ae(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Qle(r){if(r.length>Na){r=th(r,Na+eh);let n=r.subarray(0,Na),i=r.subarray(Na,r.length);return new Rl(n,i)}r=th(r,Na);let e=r.subarray(0,Na),t=r.subarray(eh);return new Rl(e,t)}function Xle(r){return r=th(r,eh),new o1(r)}async function Zle(){let{privateKey:r,publicKey:e}=await BO();return new Rl(r,e)}async function W_(r){let{privateKey:e,publicKey:t}=await MO(r);return new Rl(e,t)}function th(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ae(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}var X_={};zt(X_,{Secp256k1PrivateKey:()=>c1,Secp256k1PublicKey:()=>a1,generateKeyPair:()=>rfe,unmarshalSecp256k1PrivateKey:()=>efe,unmarshalSecp256k1PublicKey:()=>tfe});function zO(){return zs.randomPrivateKey()}async function KO(r,e){let{digest:t}=await Pe.digest(e);try{return await mO(t,r)}catch(n){throw new ae(String(n),"ERR_INVALID_INPUT")}}async function HO(r,e,t){try{let{digest:n}=await Pe.digest(t);return gO(e,n,r)}catch(n){throw new ae(String(n),"ERR_INVALID_INPUT")}}function $O(r){return Lt.fromHex(r).toRawBytes(!0)}function qO(r){try{B_(r,!0)}catch(e){throw new ae(String(e),"ERR_INVALID_PRIVATE_KEY")}}function Q_(r){try{Lt.fromHex(r)}catch(e){throw new ae(String(e),"ERR_INVALID_PUBLIC_KEY")}}function GO(r){try{return B_(r,!0)}catch(e){throw new ae(String(e),"ERR_INVALID_PRIVATE_KEY")}}var a1=class{constructor(e){Q_(e),this._key=e}async verify(e,t){return await HO(this._key,t,e)}marshal(){return $O(this._key)}get bytes(){return Ls.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}},c1=class{constructor(e,t){this._key=e,this._publicKey=t??GO(e),qO(this._key),Q_(this._publicKey)}async sign(e){return await KO(this._key,e)}get public(){return new a1(this._publicKey)}marshal(){return this._key}get bytes(){return Bs.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return ke(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Pe.digest(this.bytes);return e}async id(){let e=await this.public.hash();return j(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return await Zd(this.bytes,e);throw new ae(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function efe(r){return new c1(r)}function tfe(r){return new a1(r)}async function rfe(){let r=await zO();return new c1(r)}var Ao={rsa:F_,ed25519:Y_,secp256k1:X_};function Z_(r){let e=Object.keys(Ao).join(" / ");return new ae(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function J_(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return Ao[r];throw Z_(r)}async function rh(r,e){return await J_(r).generateKeyPair(e??2048)}async function nfe(r,e,t){if(r.toLowerCase()!=="ed25519")throw new ae("Seed key derivation is unimplemented for RSA or secp256k1","ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return await W_(e)}function ii(r){let e=Ls.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case nr.RSA:return Ao.rsa.unmarshalRsaPublicKey(t);case nr.Ed25519:return Ao.ed25519.unmarshalEd25519PublicKey(t);case nr.Secp256k1:return Ao.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw Z_(e.Type??"RSA")}}function u1(r,e){return e=(e??"rsa").toLowerCase(),J_(e),r.bytes}async function hn(r){let e=Bs.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case nr.RSA:return await Ao.rsa.unmarshalRsaPrivateKey(t);case nr.Ed25519:return Ao.ed25519.unmarshalEd25519PrivateKey(t);case nr.Secp256k1:return Ao.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw Z_(e.Type??"RSA")}}function eE(r,e){return e=(e??"rsa").toLowerCase(),J_(e),r.bytes}async function Io(r,e){try{let i=await XN(r,e);return await hn(i)}catch{}let t=sy.default.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new ae("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=sy.default.asn1.toDer(sy.default.pki.privateKeyToAsn1(t));return n=W(n.getBytes(),"ascii"),await Ao.rsa.unmarshalRsaPrivateKey(n)}var sE=C(Y(),1);var nh=C(Y(),1);var jO="ERR_IPNS_EXPIRED_RECORD",l1="ERR_UNRECOGNIZED_VALIDITY",WO="ERR_SIGNATURE_CREATION",tu="ERR_SIGNATURE_VERIFICATION",YO="ERR_UNRECOGNIZED_FORMAT";var tE="ERR_UNDEFINED_PARAMETER",QO="ERR_INVALID_RECORD_DATA",XO="ERR_INVALID_EMBEDDED_KEY",ZO="ERR_MISSING_PRIVATE_KEY";var si;(function(r){let e;(function(i){i.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(i){i[i.EOL=0]="EOL"})(t||(t={})),function(i){i.codec=()=>Si(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=nt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.value!=null&&(s.uint32(10),s.bytes(i.value)),i.signature!=null&&(s.uint32(18),s.bytes(i.signature)),i.validityType!=null&&(s.uint32(24),r.ValidityType.codec().encode(i.validityType,s)),i.validity!=null&&(s.uint32(34),s.bytes(i.validity)),i.sequence!=null&&(s.uint32(40),s.uint64(i.sequence)),i.ttl!=null&&(s.uint32(48),s.uint64(i.ttl)),i.pubKey!=null&&(s.uint32(58),s.bytes(i.pubKey)),i.signatureV2!=null&&(s.uint32(66),s.bytes(i.signatureV2)),i.data!=null&&(s.uint32(74),s.bytes(i.data)),o.lengthDelimited!==!1&&s.ldelim()},(i,s)=>{let o={},a=s==null?i.len:i.pos+s;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:o.value=i.bytes();break;case 2:o.signature=i.bytes();break;case 3:o.validityType=r.ValidityType.codec().decode(i);break;case 4:o.validity=i.bytes();break;case 5:o.sequence=i.uint64();break;case 6:o.ttl=i.uint64();break;case 7:o.pubKey=i.bytes();break;case 8:o.signatureV2=i.bytes();break;case 9:o.data=i.bytes();break;default:i.skipType(c&7);break}}return o})),n),r.encode=i=>rt(i,r.codec()),r.decode=i=>tt(i,r.codec())})(si||(si={}));var JO=D("ipns:utils"),eL=W("/ipns/");function f1(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}var tL=async(r,e)=>{if(e==null||r==null){let n=new Error("one or more of the provided parameters are not defined");throw JO.error(n),(0,nh.default)(n,tE)}let t;if(e.pubKey!=null){try{t=ii(e.pubKey)}catch(i){throw JO.error(i),i}if(!(await br(e.pubKey)).equals(r))throw(0,nh.default)(new Error("Embedded public key did not match PeerID"),XO)}else r.publicKey!=null&&(t=ii(r.publicKey));if(t!=null)return t;throw(0,nh.default)(new Error("no public key is available"),tE)},rL=(r,e,t)=>{let n=W(e);return ve([r,t,n])},ay=r=>{let e=W("ipns-signature:");return ve([e,r])},nE=r=>si.encode(r),Oa=r=>{let e=si.decode(r);return e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??si.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}},ru=r=>ve([eL,r.toBytes()]),iE=r=>wr(r.slice(eL.length)),nL=(r,e,t,n,i)=>{let s;if(t===si.ValidityType.EOL)s=0;else throw(0,nh.default)(new Error("Unknown validity type"),l1);return Cs({Value:r,Validity:e,ValidityType:s,Sequence:n,TTL:i})},iL=r=>{let e=Cn(r);if(e.ValidityType===0)e.ValidityType=si.ValidityType.EOL;else throw(0,nh.default)(new Error("Unknown validity type"),l1);return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e};var oL=D("ipns"),ife=Hr.code,d1="/ipns/",cy=d1.length,aL=async(r,e,t,n)=>{let i=new sL.default(Date.now()+Number(n)),s=si.ValidityType.EOL,[o,a]=n.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await sfe(r,e,t,s,i,c)};var sfe=async(r,e,t,n,i,s)=>{t=BigInt(t);let o=W(i.toString());if(r.privateKey==null)throw(0,sE.default)(new Error("Missing private key"),ZO);let a=await hn(r.privateKey),c=await afe(a,e,n,o),u=nL(e,o,n,t,s),l=ay(u),f=await a.sign(l),h={value:e,signature:c,validityType:n,validity:o,sequence:t,ttl:s,signatureV2:f,data:u};if(r.publicKey!=null){let d=Xt(r.toBytes());(d.code!==ife||!ke(r.publicKey,d.digest))&&(h.pubKey=r.publicKey)}return oL("ipns entry for %b created",e),h},ofe=r=>s7.encode(r).slice(1),h1=r=>new le(`/ipns/${ofe(r)}`),afe=async(r,e,t,n)=>{try{let i=rL(e,t,n);return await r.sign(i)}catch(i){throw oL.error("record signature creation failed",i),(0,sE.default)(new Error("record signature creation failed"),WO)}};var ts=D("ipfs:ipns:publisher"),cL=tn().code,uL=60*60*1e3,Cl=class{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,i){let s=await this._updateOrCreateRecord(e,t,n,i);return this._putRecordToRouting(s,e,i)}publish(e,t,n){return this.publishWithEOL(e,t,uL,n)}async _putRecordToRouting(e,t,n){if(!$n(t)){let s="peerId received is not valid";throw ts.error(s),(0,rs.default)(new Error(s),"ERR_INVALID_PEER_ID")}if(t.publicKey==null)throw(0,rs.default)(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");let i=ru(t);return await this._publishEntry(i,e,n),e}async _publishEntry(e,t,n){try{let i=await this._routing.put(e,t,n);return ts(`ipns record for ${j(e,"base32")} was stored in the routing`),i}catch(i){let s=`ipns record for ${j(e,"base32")} could not be stored in the routing - ${i.stack}`;throw ts.error(s),ts.error(i),(0,rs.default)(new Error(s),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!$n(e)){let i="peerId received is not valid";throw ts.error(i),(0,rs.default)(new Error(i),"ERR_INVALID_PEER_ID")}let n=t.checkRouting!==!1;try{let i=await this._datastore.get(h1(e.toBytes()));return this._unmarshalData(i)}catch(i){if(i.code!==cL){let s=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw ts.error(s),(0,rs.default)(new Error(s),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw(0,rs.default)(i,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{let s=ru(e),o=await this._routing.get(s);return this._unmarshalData(o)}catch(s){throw ts.error(s),s}}}_unmarshalData(e){try{return Oa(e)}catch(t){throw(0,rs.default)(t,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,i){if(!$n(e)){let u="peerId received is not valid";throw ts.error(u),(0,rs.default)(new Error(u),"ERR_INVALID_PEER_ID")}let s={checkRouting:!0},o;try{o=await this._getPublished(e,s)}catch(u){if(u.code!==cL){let l=`unexpected error when determining the last published IPNS record for ${e.toString()} ${u.stack}`;throw ts.error(l),(0,rs.default)(new Error(l),"ERR_DETERMINING_PUBLISHED_RECORD")}}let a=0n;o&&o.sequence!==void 0&&(a=ke(o.value,t)?o.sequence:o.sequence+BigInt(1));let c;try{c=await aL(e,t,a,n)}catch(u){let l=`ipns record for ${t} could not be created`;throw ts.error(u),(0,rs.default)(new Error(l),"ERR_CREATING_IPNS_RECORD")}try{let u=nE(c);return await this._datastore.put(h1(e.toBytes()),u,i),ts(`ipns record for ${j(t,"base32")} was stored in the datastore`),u}catch{let l=`ipns record for ${t} could not be stored in the datastore`;throw ts.error(l),(0,rs.default)(new Error(l),"ERR_STORING_IN_DATASTORE")}}};Cl.defaultRecordLifetime=uL;var Pl=C(Y(),1);var lL=C(en(),1),uy=D("ipfs:ipns:republisher"),fL=60*1e3,dL=60*fL,cfe=4*dL,ufe=24*dL,ly=class{constructor(e,t,n,i,s={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=i,this._options=s,this._republishHandle=null}async start(){if(this._republishHandle)throw(0,Pl.default)(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");let e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:i=>{e._timeoutId=setTimeout(async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(i)}catch(s){uy.error(s)}},i())},cancel:async()=>{e._timeoutId!=null&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options,n=!0;e._task=async()=>{let i=new lL.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:i.signal})}finally{i.clear()}},e.runPeriodically(()=>n?(n=!1,this._options.initialBroadcastInterval||fL):this._options.broadcastInterval||cfe),this._republishHandle=e}async stop(){let e=this._republishHandle;if(!e)throw(0,Pl.default)(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch{let s="cannot republish entry for the node's private key";uy.error(s);return}if(t)try{let i=await this._keychain.listKeys();for(let s of i){if(s.name==="self")continue;let o=await this._keychain.exportKey(s.name,t),a=await Io(o,t),c=await br(a.public.bytes,a.bytes);await this._republishEntry(c,n)}}catch(i){uy.error(i)}}async _republishEntry(e,t){try{let n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,ufe,t)}catch(n){if(n.code==="ERR_NO_ENTRY_FOUND")return;throw n}}async _getPreviousValue(e){if(!$n(e))throw(0,Pl.default)(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{let t=await this._datastore.get(h1(e.toBytes()));if(!(t instanceof Uint8Array))throw(0,Pl.default)(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return Oa(t).value}catch(n){throw uy.error(n),(0,Pl.default)(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){throw t&&t.notFound?(0,Pl.default)(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND"):t}}};var sh=C(Y(),1);var ns=C(Y(),1);var p1=D("ipns:validator"),lfe=async(r,e)=>{let{value:t,validityType:n,validity:i}=e,s,o;if(e.signatureV2!=null&&e.data!=null)o=e.signatureV2,s=ay(e.data),ffe(e);else throw(0,ns.default)(new Error("missing data or signatureV2"),tu);let a;try{a=await r.verify(s,o)}catch{a=!1}if(!a)throw p1.error("record signature verification failed"),(0,ns.default)(new Error("record signature verification failed"),tu);if(i!=null&&n===si.ValidityType.EOL){let c;try{c=f1(j(i))}catch{throw p1.error("unrecognized validity format (not an rfc3339 format)"),(0,ns.default)(new Error("unrecognized validity format (not an rfc3339 format)"),YO)}if(c.getTime()<Date.now())throw p1.error("record has expired"),(0,ns.default)(new Error("record has expired"),jO)}else if(n!=null)throw p1.error("unrecognized validity type"),(0,ns.default)(new Error("unrecognized validity type"),l1);p1("ipns entry for %b is valid",t)},ffe=r=>{if(r.data==null)throw(0,ns.default)(new Error("Record data is missing"),QO);let e=iL(r.data);if(!ke(e.Value,r.value))throw(0,ns.default)(new Error('Field "value" did not match between protobuf and CBOR'),tu);if(!ke(e.Validity,r.validity))throw(0,ns.default)(new Error('Field "validity" did not match between protobuf and CBOR'),tu);if(e.ValidityType!==r.validityType)throw(0,ns.default)(new Error('Field "validityType" did not match between protobuf and CBOR'),tu);if(e.Sequence!==r.sequence)throw(0,ns.default)(new Error('Field "sequence" did not match between protobuf and CBOR'),tu);if(e.TTL!==r.ttl)throw(0,ns.default)(new Error('Field "ttl" did not match between protobuf and CBOR'),tu)},ih=async(r,e)=>{let t=iE(r),n=Oa(e),i=await tL(t,n);await lfe(i,n)};var aE=D("ipfs:ipns:resolver"),dfe=tn().code,hL=32,fy=class{constructor(e){this._routing=e}async resolve(e,t={}){if(typeof e!="string")throw(0,sh.default)(new Error("invalid name"),"ERR_INVALID_NAME");let n=t.recursive&&t.recursive.toString()==="true",i=e.split("/");if(i.length!==3||i[0]!=="")throw(0,sh.default)(new Error("invalid name"),"ERR_INVALID_NAME");let s=i[2],o=1/0;n&&(o=hL);let a=await this.resolver(s,o,t);return aE(`${e} was locally resolved correctly`),a}async resolver(e,t,n){if(t===0){let o=`could not resolve name (recursion limit of ${hL} exceeded)`;throw aE.error(o),(0,sh.default)(new Error(o),"ERR_RESOLVE_RECURSION_LIMIT")}let i=await this._resolveName(e,n),s=i.split("/");return s[1]==="ipfs"||!t?i:this.resolver(s[2],t-1,n)}async _resolveName(e,t){let n=fe(e),i=ru(n),s;try{s=await this._routing.get(i,t)}catch(o){throw aE.error("could not get record from routing",o),o.code===dfe?(0,sh.default)(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND"):(0,sh.default)(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,s)}async _validateRecord(e,t){await ih(ve([W("/ipns/"),e.toBytes()]),t);let n=Oa(t);return j(n.value)}};var pL=C(Dp(),1),dy=class{constructor(e){this.lru=(0,pL.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var m1=D("ipfs:ipns"),mL=60*1e3,g1=class{constructor(e,t,n,i,s){this.publisher=new Cl(e,t),this.republisher=new ly(this.publisher,t,n,i,s),this.resolver=new fy(e),this.cache=new dy(1e3),this.routing=e}async publish(e,t,n=Cl.defaultRecordLifetime,i){try{await this.publisher.publishWithEOL(e,t,n,i),m1(`IPNS value ${j(t,"base32")} was published correctly`);let s=e.toString(),o=parseFloat(n),a=o<mL?o:mL;return this.cache.set(s,t,a),m1(`IPNS value ${j(t,"base32")} was cached correctly`),{name:s,value:t}}catch(s){throw m1.error(s),s}}async resolve(e,t={}){if(typeof e!="string")throw(0,gL.default)(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){let n=e.split("/")[2],i=this.cache.get(n);if(i)return i}try{let n=await this.resolver.resolve(e,t);return m1(`IPNS record from ${e} was resolved correctly`),n}catch(n){throw m1.error(n),n}}async initializeKeyspace(e,t,n){return this.publish(e,t,Cl.defaultRecordLifetime,n)}};async function rn(r){let e=[];for await(let t of r)e.push(t);return e}var hy=(r,e)=>async function*(){yield*(await rn(r)).sort(e)}();async function Rt(r){for await(let e of r);}async function*ot(r,e){for await(let t of r)await e(t)&&(yield t)}async function*Ai(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}}var oi=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Rt(this.putMany(e,n)),e=[],await Rt(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=ot(n,i=>i.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ot(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>hy(i,s),n)),e.offset!=null){let i=0;n=ot(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ai(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=ot(n,i=>i.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ot(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>hy(i,s),n)),e.offset!=null){let i=0;n=ot(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ai(n,e.limit)),n}};var py=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},oh=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new py(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new py(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function Kt(r={}){return wL(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function yL(r={}){return wL(t=>{let n,i=[];for(;!t.isEmpty()&&(n=t.shift(),n!=null);){if(n.error!=null)throw n.error;n.done===!1&&i.push(n.value)}return n==null?{done:!0}:{done:n.done===!0,value:i}},r)}function wL(r,e){e=e??{};let t=e.onEnd,n=new oh,i,s,o,a=async()=>n.isEmpty()?o?{done:!0}:await new Promise((w,b)=>{s=v=>{s=null,n.push(v);try{w(r(n))}catch(T){b(T)}return i}}):r(n),c=w=>s!=null?s(w):(n.push(w),i),u=w=>(n=new oh,s!=null?s({error:w}):(n.push({error:w}),i)),l=w=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(w==null?void 0:w.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:w})},f=w=>o?i:(o=!0,w!=null?u(w):c({done:!0})),h=()=>(n=new oh,f(),{done:!0}),d=w=>(f(w),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:h,throw:d,push:l,end:f,get readableLength(){return n.size}},t==null)return i;let m=i;return i={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(w){return m.throw(w),t!=null&&(t(w),t=void 0),{done:!0}},return(){return m.return(),t!=null&&(t(),t=void 0),{done:!0}},push:l,end(w){return m.end(w),t!=null&&(t(w),t=void 0),i},get readableLength(){return m.readableLength}},i}var hfe=D("datastore:core:tiered"),y1=class extends oi{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map(e=>e.open()))}catch(e){throw x3(e)}}async put(e,t,n){try{await Promise.all(this.stores.map(i=>i.put(e,t,n)))}catch(i){throw A3(i)}}async get(e,t){for(let n of this.stores)try{let i=await n.get(e,t);if(i)return i}catch(i){hfe.error(i)}throw tn()}async has(e,t){for(let n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map(n=>n.delete(e,t)))}catch(n){throw T3(n)}}async*putMany(e,t={}){let n,i=this.stores.map(s=>{let o=Kt({objectMode:!0});return Rt(s.putMany(o,t)).catch(a=>{n=a}),o});try{for await(let s of e){if(n)throw n;i.forEach(o=>o.push(s)),yield s}}finally{i.forEach(s=>s.end())}}async*deleteMany(e,t={}){let n,i=this.stores.map(s=>{let o=Kt({objectMode:!0});return Rt(s.deleteMany(o,t)).catch(a=>{n=a}),o});try{for await(let s of e){if(n)throw n;i.forEach(o=>o.push(s)),yield s}}finally{i.forEach(s=>s.end())}}async close(){await Promise.all(this.stores.map(e=>e.close()))}batch(){let e=this.stores.map(t=>t.batch());return{put:(t,n)=>{e.forEach(i=>i.put(t,n))},delete:t=>{e.forEach(n=>n.delete(t))},commit:async t=>{for(let n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}};var E1=C(my(),1);var gy=(r,e)=>{let t=e.map((n,i)=>({entry:si.decode(n),index:i}));return t.sort((n,i)=>{if(n.entry.signatureV2!=null&&i.entry.signatureV2==null)return-1;if(n.entry.signatureV2==null&&i.entry.signatureV2!=null)return 1;let s=n.entry.sequence??0n,o=i.entry.sequence??0n;if(s>o)return-1;if(s<o)return 1;let a=n.entry.validity??new Uint8Array(0),c=i.entry.validity??new Uint8Array(0),u=f1(j(a)),l=f1(j(c));return u.getTime()>l.getTime()?-1:u.getTime()<l.getTime()?1:0}),t[0].index};var bL="SHARDING",_L="_README";var w1=class extends oi{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw tn();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new le(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new le(e))}};async function*Bt(r,e){for await(let t of r)yield e(t)}async function*fr(...r){let e=Kt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}var gfe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},EL=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),lE=r=>r!=null&&typeof r.sink=="function"&&EL(r.source),yfe=r=>e=>{let t=r.sink(e);if(t.then!=null){let n=Kt({objectMode:!0});return t.then(()=>{n.end()},s=>{n.end(s)}),fr(n,async function*(){yield*r.source,n.end()}())}return r.source};function _e(r,...e){if(lE(r)){let n=r;r=()=>n.source}else if(EL(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&lE(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)lE(t[n])&&(t[n]=yfe(t[n]));return gfe(...t)}var ZCe=new le(bL),JCe=new le(_L);var yy="/record/";function fE(r){return j(r,"base32")}function b1(r){(typeof r=="string"||r instanceof String)&&(r=W(r.toString()));let e=j(r,"base64url");return`${yy}${e}`}function SL(r){if(r.substring(0,yy.length)!==yy)throw new ae("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");let e=r.substring(yy.length);return W(e,"base64url")}var vn=D("datastore-pubsub:publisher"),wy=class extends oi{constructor(e,t,n,i,s,o){if(super(),!i)throw new ae("missing validator","ERR_INVALID_PARAMETERS");if(typeof i!="function")throw new ae("missing validate function","ERR_INVALID_PARAMETERS");if(typeof s!="function")throw new ae("missing select function","ERR_INVALID_PARAMETERS");if(o&&typeof o!="function")throw new ae("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=i,this._selector=s,this._handleSubscriptionKeyFn=o,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){let s="datastore key does not have a valid format";throw vn.error(s),new ae(s,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){let s="received value is not a Uint8Array";throw vn.error(s),new ae(s,"ERR_INVALID_VALUE_RECEIVED")}let i=b1(e);vn(`publish value for topic ${i}`),await this._pubsub.publish(i,t)}async get(e,t){if(!(e instanceof Uint8Array)){let s="datastore key does not have a valid format";throw vn.error(s),new ae(s,"ERR_INVALID_DATASTORE_KEY")}let n=b1(e),i=await this._pubsub.getTopics();if(i&&Array.isArray(i)&&i.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch{let o=`cannot subscribe topic ${n}`;throw vn.error(o),new ae(o,"ERR_SUBSCRIBING_TOPIC")}return vn(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){let t=b1(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){let n=new le("/"+fE(e),!1),i;try{i=await this._datastore.get(n,t)}catch(s){if(s.code!=="ERR_NOT_FOUND"){let a=`unexpected error getting the ipns record for ${n.toString()}`;throw vn.error(a),new ae(a,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}let o=`local record requested was not found for ${n.toString()}`;throw vn.error(o),new ae(o,"ERR_NOT_FOUND")}if(!(i instanceof Uint8Array)){let s="found record that we couldn't convert to a value";throw vn.error(s),new ae(s,"ERR_INVALID_RECORD_RECEIVED")}return i}async _onMessage(e){let t=e.detail;if(t.type!=="signed"){vn.error("unsigned message received, this module can only work with signed messages");return}let{data:n,from:i,topic:s}=t,o;try{o=SL(s)}catch(a){vn.error(a);return}if(vn(`message received for topic ${s}`),this._peerId.equals(i)){vn("message discarded as it is from the same peer");return}if(this._handleSubscriptionKeyFn){let a;try{a=await this._handleSubscriptionKeyFn(o)}catch{vn.error("message discarded by the subscriptionKeyFn");return}o=a}try{await this._storeIfSubscriptionIsBetter(o,n)}catch(a){vn.error(a)}}async _storeIfSubscriptionIsBetter(e,t,n){let i=!1;try{i=await this._isBetter(e,t)}catch(s){if(s.code!=="ERR_NOT_VALID_RECORD")throw s}i&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return await this._selector(e,t)===0}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch{let o="record received through pubsub is not valid";throw vn.error(o),new ae(o,"ERR_NOT_VALID_RECORD")}let n=new le(e),i;try{i=await this._getLocal(n.uint8Array())}catch{return!0}return ke(i,t)?!1:this._selectRecord(e,[i,t])}async _storeRecord(e,t,n){let i=new le("/"+fE(e),!1);await this._datastore.put(i,t,n),vn(`record for ${b1(e)} was stored in the datastore`)}};var dE=C(Y(),1);var by=D("ipfs:ipns:pubsub"),kl=class{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new wy(e,t,n,ih,gy,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(i){throw by.error(i),i}}async get(e,t){let n,i;try{n=await this._pubsubDs.get(e,t)}catch(o){i=o}let s=e.slice(0,cy);if(j(s)===d1){let o=Te.encode(e).substring(1),a=Te.encode(e.slice(cy)).substring(1);this._subscriptions[o]=a,by(`subscribed to pubsub topic ${o}, id ${a}`)}if(i)throw i;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=j(e,"base58btc"));let t=this._subscriptions[e];if(!t)throw(0,dE.default)(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return ru(fe(t))}catch(n){throw by.error(n),n}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map(t=>`${d1}${t}`)}async cancel(e){if(typeof e!="string")throw(0,dE.default)(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(d1)&&(e=e.substring(cy));let t=Object.keys(this._subscriptions).find(i=>this._subscriptions[i]===e);if(!t)return{canceled:!1};let n=W(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],by(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}};var _1;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.key!=null&&t.key.byteLength>0)&&(n.uint32(10),n.bytes(t.key)),(i.writeDefaults===!0||t.value!=null&&t.value.byteLength>0)&&(n.uint32(18),n.bytes(t.value)),(i.writeDefaults===!0||t.timeReceived!=="")&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(_1||(_1={}));function xL(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function TL(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}var _r=class{constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return _1.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:xL(this.timeReceived)}}static deserialize(e){let t=_1.decode(e);return new _r(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=TL(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new _r(e.key,e.value,t)}};var ah=C(Y(),1);var hE=D("ipfs:ipns:offline-datastore"),ch=class{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw(0,ah.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw(0,ah.default)(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let i;try{i=this._routingKey(e)}catch(o){throw hE.error(o),(0,ah.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let s=new _r(e,t,new Date);await this._datastore.put(i,s.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw(0,ah.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(o){throw hE.error(o),(0,ah.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let i=await this._datastore.get(n,t),s;try{s=_r.deserialize(i)}catch(o){throw hE.error(o),o}return s.value}_routingKey(e){return new le("/dht/record/"+j(e,"base32"),!1)}};var bfe=D("ipfs:ipns:dht-datastore"),_y=class{constructor(e){this._dht=e}async put(e,t,n){try{await Rt(this._dht.put(e,t,n))}catch(i){throw bfe.error(i),i}}async get(e,t){for await(let n of this._dht.get(e,t))if(n.name==="VALUE")return n.value;throw tn()}};function AL({libp2p:r,repo:e,peerId:t,options:n}){let i=[],s;if((0,E1.default)(n,"EXPERIMENTAL.ipnsPubsub",!1)&&(s=new kl(r.pubsub,e.datastore,t),i.push(s)),(0,E1.default)(n,"offline",!1)!==!0&&["dht","dhtclient","dhtserver"].includes((0,E1.default)(n,"config.Routing.Type","none"))&&i.push(new _y(r.dht)),(0,E1.default)(n,"offline",!1)||i.length===0){let o=new ch(e.datastore);i.push(o)}return new y1(i)}var _fe=D("ipfs:components:ipns"),Ey=class{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){let e=this.online||this.offline;if(e)return e;throw new Ea}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(this.offline!=null)throw new ks;_fe("initializing IPNS keyspace (offline)");let i=new ch(e.datastore),s=new g1(i,e.datastore,t,n,this.options);this.offline=s}async startOnline({libp2p:e,repo:t,peerId:n,keychain:i}){if(this.online!=null)throw new ks;let s=AL({libp2p:e,repo:t,peerId:n,options:this.options}),o=new g1(s,t.datastore,n,i,this.options);await o.republisher.start(),this.online=o}async stop(){let e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,i){return this.getIPNS().publish(e,t,n,i)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}};var mE=C(Y(),1);async function IL({ipns:r,repo:e,codecs:t},n,i){if(o3(n))return r.resolve(n);let{cid:s,path:o}=Ia(n);await Rt(Bc(s,o||"",t,e,i))}var pE=D("ipfs:name:publish");function RL({ipns:r,repo:e,codecs:t,peerId:n,isOnline:i,keychain:s}){let o=async c=>{let u;if(c==="self"&&n.privateKey!=null)u=await hn(n.privateKey);else try{let l=await s.exportKey(c,"temp");u=await Io(l,"temp")}catch(l){throw pE.error(l),(0,mE.default)(l,"ERR_CANNOT_GET_KEY")}return br(u.public.bytes,u.bytes)};async function a(c,u={}){let l=u.resolve!==!1,f=u.lifetime||"24h",h=u.key||"self";if(!i())throw(0,mE.default)(new Error(f3),"OFFLINE_ERROR");try{c=Rk(c)}catch(v){throw pE.error(v),v}let d=0;try{d=Oc(f)||0,d=parseFloat(d.toFixed(6))}catch(v){throw pE.error(v),v}let m=await Promise.all([o(h),l?IL({ipns:r,repo:e,codecs:t},c):Promise.resolve()]),w=W(c),b=await r.publish(m[0],w,d,u);return{name:b.name,value:j(b.value)}}return H(a)}var vy=C(Y(),1);var DL=C(PL(),1);var vfe=Ve.bind({ignoreUndefined:!0}),Sfe=D("ipfs:name:resolve"),kL=(r,e)=>e.length>0?r+"/"+e.join("/"):r;function NL({dns:r,ipns:e,isOnline:t,options:{offline:n}}){async function*i(s,o={}){if(o=vfe({nocache:!1,recursive:!0},o),n&&o&&o.nocache)throw(0,vy.default)(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!t()&&!n)throw(0,vy.default)(new Error(f3),"OFFLINE_ERROR");let a=s.toString();a.startsWith("/ipns/")||(a=`/ipns/${a}`);let[c,u,...l]=a.slice(1).split("/");try{if(u.substring(0,1)==="1"){let h=fe(u),d=Xt(h.toBytes());u=P.createV1(114,d).toString(Id)}else{let h=P.parse(u);h.version===1&&(u=h.toString(Id))}}catch(h){if((0,DL.default)(u)){yield kL(await r(u,o),l);return}throw Sfe.error(h),(0,vy.default)(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}let f=await e.resolve(`/${c}/${u}`,o);yield kL(f instanceof Uint8Array?j(f):f,l)}return H(i)}var gE=C(Y(),1);function uh(r,e){if(!r||!(e&&e.ipnsPubsub))throw(0,gE.default)(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(r.routing instanceof kl)return r.routing;let t=(r.routing.stores||[]).find(n=>n instanceof kl);if(!t)throw(0,gE.default)(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return t}function OL({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i,s={}){return uh(r,t).cancel(i,s)}return H(n)}function LL({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){try{return{enabled:Boolean(uh(r,t))}}catch{return{enabled:!1}}}return H(n)}function BL({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){return uh(r,t).getSubscriptions(i)}return H(n)}var Sy=class{constructor({ipns:e,options:t}){this.cancel=OL({ipns:e,options:t}),this.state=LL({ipns:e,options:t}),this.subs=BL({ipns:e,options:t})}};var xy=class{constructor({dns:e,ipns:t,repo:n,codecs:i,peerId:s,isOnline:o,keychain:a,options:c}){this.publish=RL({ipns:t,repo:n,codecs:i,peerId:s,isOnline:o,keychain:a}),this.resolve=NL({dns:e,ipns:t,isOnline:o,options:c}),this.pubsub=new Sy({ipns:t,options:c})}};var ML=C(en(),1),UL=C(Kn(),1),xfe=tn().code,yE={default:"<dst>",edges:"<src> -> <dst>"};function FL({repo:r,codecs:e,resolve:t,preload:n}){async function*i(s,o={}){if(o.maxDepth===0)return;if(o.edges&&o.format&&o.format!==yE.default)throw new Error("Cannot set edges to true and also specify format");if(o.format=o.edges?yE.edges:o.format,typeof o.maxDepth!="number"&&(o.maxDepth=o.recursive?1/0:1),o.timeout){let l=[new ML.TimeoutController(o.timeout).signal];o.signal&&l.push(o.signal),o.signal=(0,UL.anySignal)(l)}let c=(Array.isArray(s)?s:[s]).map(u=>Tfe(n,u,o));for(let u of c)try{yield*Afe(t,r,e,u,o)}catch(l){yield{ref:"",err:l.message}}}return i}function Tfe(r,e,t){let{cid:n,path:i}=Ia(e);return t.preload!==!1&&r(n),`/ipfs/${n}${i||""}`}async function*Afe(r,e,t,n,i){let s=await r(n,i),{cid:o}=Ia(s),a=i.maxDepth!=null?i.maxDepth:1/0,c=i.unique||!1;for await(let u of Rfe(e,t,o,a,c,i))u.parent&&(u.isDuplicate||(yield{ref:Ife(u.parent.cid,u.node.cid,u.node.name,i.format)}))}function Ife(r,e,t="",n=yE.default){let i=n.replace(/<src>/g,r.toString());return i=i.replace(/<dst>/g,e.toString()),i=i.replace(/<linkname>/g,t),i}async function*Rfe(r,e,t,n,i,s){let o=new Set;async function*a(c,u){let l=u+1;if(!(l>n))try{for await(let f of Cfe(r,e,c.cid,s))yield{parent:c,node:f,isDuplicate:i&&o.has(f.cid.toString())},i&&o.add(f.cid.toString()),yield*a(f,l)}catch(f){throw f.code===xfe&&(f.message=`Could not find object with CID: ${c.cid}`),f}}yield*a({cid:t},0)}async function*Cfe(r,e,t,n){let i=await r.blocks.get(t,n),o=(await e.getCodec(t.code)).decode(i),a=t.code===Xe,c=[];for(let[u,l]of wE(o,c)){if(a){let f=u.match(/^Links\/(\d+)\/Hash$/);if(f){let h=Number(f[1]);if(h<o.Links.length){yield{name:o.Links[h].Name,cid:l};continue}}}yield{name:u,cid:l}}}var wE=function*(r,e){if(r!=null&&!(r instanceof Uint8Array)){for(let[t,n]of Object.entries(r)){let i=[...e,t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let[s,o]of n.entries()){let a=[...i,s],c=P.asCID(o);c?yield[a.join("/"),c]:typeof o=="object"&&(yield*wE(o,a))}else{let s=P.asCID(n);s?yield[i.join("/"),s]:yield*wE(n,i)}}return[]}};function VL({repo:r}){async function*e(t={}){for await(let n of r.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}return H(e)}function zL({network:r}){async function e(t={}){let{bitswap:n}=await r.use(t),i=n.getWantlist();return Array.from(i).map(s=>s[1].cid)}return H(e)}function KL({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n),s=i.wantlistForPeer(t);return Array.from(s).map(o=>o[1].cid)}return H(e)}function HL({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n);return Array.isArray(t)||(t=[t]),i.unwant(t)}return H(e)}function Ty({network:r}){async function e(t={}){let n=(await r.use(t)).bitswap,i=n.stat().snapshot;return{provideBufLen:parseInt(i.providesBufferLength.toString()),blocksReceived:BigInt(i.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map(s=>s[1].cid),peers:n.peers(),dupBlksReceived:BigInt(i.dupBlksReceived.toString()),dupDataReceived:BigInt(i.dupDataReceived.toString()),dataReceived:BigInt(i.dataReceived.toString()),blocksSent:BigInt(i.blocksSent.toString()),dataSent:BigInt(i.dataSent.toString())}}return H(e)}var Ay=class{constructor({network:e}){this.wantlist=zL({network:e}),this.wantlistForPeer=KL({network:e}),this.unwant=HL({network:e}),this.stat=Ty({network:e})}};function Iy(r){try{return ik.matches(r)}catch{return!1}}function $L({repo:r}){async function e(t,n={}){if(!Iy(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n),s=i.Bootstrap||[];return s.push(t.toString()),i.Bootstrap=Array.from(new Set(s)).sort((o,a)=>o.localeCompare(a)),await r.config.replace(i),{Peers:[t]}}return H(e)}function qL({repo:r}){async function e(t={}){let n=await r.config.getAll(t),i=n.Bootstrap||[];return n.Bootstrap=[],await r.config.replace(n),{Peers:i.map(s=>oe(s))}}return H(e)}function GL({repo:r}){async function e(t={}){return{Peers:(await r.config.get("Bootstrap",t)||[]).map(i=>oe(i))}}return H(e)}var La=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function jL({repo:r}){async function e(t={}){let n=await r.config.getAll(t);return n.Bootstrap=La().Bootstrap,await r.config.replace(n),{Peers:La().Bootstrap.map(i=>oe(i))}}return H(e)}function WL({repo:r}){async function e(t,n={}){if(!Iy(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n);return i.Bootstrap=(i.Bootstrap||[]).filter(s=>s.toString()!==t.toString()),await r.config.replace(i),{Peers:[t]}}return H(e)}var Ry=class{constructor({repo:e}){this.add=$L({repo:e}),this.list=GL({repo:e}),this.rm=WL({repo:e}),this.clear=qL({repo:e}),this.reset=jL({repo:e})}};function YL({preload:r,repo:e}){async function t(n,i={}){return i.preload!==!1&&r(n),e.blocks.get(n,i)}return H(t)}function QL({codecs:r,hashers:e,repo:t,preload:n}){async function i(s,o={}){let a=o.pin?await t.gcLock.readLock():null;try{let c=o.version!=null?o.version:0,u=o.format||(c===0?"dag-pb":"raw"),f=await(await e.getHasher(o.mhtype||"sha2-256")).digest(s),h=await r.getCodec(u),d=P.create(c,h.code,f);return await t.blocks.put(d,s,{signal:o.signal}),o.preload!==!1&&n(d),o.pin===!0&&await t.pins.pinRecursively(d,{signal:o.signal}),d}finally{a&&a()}}return H(i)}var XL=C(Y(),1);function vt(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var Cy=globalThis.CustomEvent??Event;async function*Ba(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);let n=e.ordered==null?!1:e.ordered,i=new EventTarget,s=[],o=vt(),a=vt(),c=!1,u,l=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let m of r){if(s.length===t&&(o=vt(),await o.promise),l)break;let w={done:!1};s.push(w),m().then(b=>{w.done=!0,w.ok=!0,w.value=b,i.dispatchEvent(new Cy("task-complete"))},b=>{w.done=!0,w.err=b,i.dispatchEvent(new Cy("task-complete"))})}c=!0,i.dispatchEvent(new Cy("task-complete"))}catch(m){u=m,i.dispatchEvent(new Cy("task-complete"))}});function f(){var m;return n?(m=s[0])==null?void 0:m.done:Boolean(s.find(w=>w.done))}function*h(){for(;s.length>0&&s[0].done;){let m=s[0];if(s.shift(),m.ok)yield m.value;else throw l=!0,o.resolve(),m.err;o.resolve()}}function*d(){for(;f();)for(let m=0;m<s.length;m++)if(s[m].done){let w=s[m];if(s.splice(m,1),m--,w.ok)yield w.value;else throw l=!0,o.resolve(),w.err;o.resolve()}}for(;;){if(f()||(a=vt(),await a.promise),u!=null)throw u;if(n?yield*h():yield*d(),c&&s.length===0)break}}function Py(r){return r instanceof Uint8Array?P.decode(r):P.parse(r.toString())}var Pfe=8;function ZL({repo:r}){async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.gcLock.writeLock();try{yield*_e(t,s=>Bt(s,o=>async()=>{o=Py(o);let a={cid:o};try{if(!await r.blocks.has(o))throw(0,XL.default)(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await r.blocks.delete(o)}catch(c){n.force||(c.message=`cannot remove ${o}: ${c.message}`,a.error=c)}return a}),s=>Ba(s,{concurrency:Pfe}),s=>ot(s,()=>!n.quiet))}finally{i()}}return H(e)}function JL({repo:r,preload:e}){async function t(n,i={}){n=Py(n),i.preload!==!1&&e(n);let s=await r.blocks.get(n);return{cid:n,size:s.length}}return H(t)}var ky=class{constructor({codecs:e,hashers:t,preload:n,repo:i}){this.get=YL({preload:n,repo:i}),this.put=QL({codecs:e,hashers:t,preload:n,repo:i}),this.rm=ZL({repo:i}),this.stat=JL({preload:n,repo:i})}};var eB=C(Y(),1);async function*ai(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}function bE(r){return typeof r.stream=="function"?ai(r.stream()):ai(new Response(r).body)}function Ks(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function is(r){return ArrayBuffer.isView(r)||r instanceof ArrayBuffer}function Ma(r){return r.constructor&&(r.constructor.name==="Blob"||r.constructor.name==="File")&&typeof r.stream=="function"}function v1(r){return typeof r=="object"&&(r.path||r.content)}var Ua=r=>r&&typeof r.getReader=="function";async function*Dy(r){yield r}async function Ny(r){if(is(r))return Dy(_E(r));if(typeof r=="string"||r instanceof String)return Dy(_E(r.toString()));if(Ma(r))return bE(r);if(Ua(r)&&(r=ai(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=Ks(r),{value:t,done:n}=await e.peek();if(n)return Dy(new Uint8Array(0));if(e.push(t),Number.isInteger(t))return Dy(Uint8Array.from(await rn(e)));if(is(t)||typeof t=="string"||t instanceof String)return Bt(e,_E)}throw(0,eB.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}function _E(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Array.isArray(r)?Uint8Array.from(r):W(r.toString())}var Ly=C(Y(),1);async function*tB(r,e){if(r==null)throw(0,Ly.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");if(typeof r=="string"||r instanceof String){yield Oy(r.toString(),e);return}if(is(r)||Ma(r)){yield Oy(r,e);return}if(Ua(r)&&(r=ai(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=Ks(r),{value:n,done:i}=await t.peek();if(i){yield{content:[]};return}if(t.push(n),Number.isInteger(n)||is(n)||typeof n=="string"||n instanceof String){yield Oy(t,e);return}throw(0,Ly.default)(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(v1(r)){yield Oy(r,e);return}throw(0,Ly.default)(new Error('Unexpected input: cannot convert "'+typeof r+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT")}async function Oy(r,e){let{path:t,mode:n,mtime:i,content:s}=r,o={path:t||"",mode:ya(n),mtime:Rc(i)};return s?o.content=await e(s):t||(o.content=await e(r)),o}function By(r){return tB(r,Ny)}function rB({addAll:r}){async function e(t,n={}){let i=await Wt(r(By(t),n));if(i==null)throw Error("Failed to add a file, if you see this please report a bug");return i}return e}async function*Dl(r,e=1){let t=[];e<1&&(e=1);for await(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*Nl(r,e=1){for await(let t of Dl(r,e)){let n=t.map(async i=>await i().then(s=>({ok:!0,value:s}),s=>({ok:!1,err:s})));for(let i=0;i<n.length;i++){let s=await n[i];if(s.ok)yield s.value;else throw s.err}}}var Uy=C(sB(),1);function kfe(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var GNe=il({name:"murmur3-32",code:35,encode:r=>kfe(Uy.default.x86.hash32(r))}),Ol=il({name:"murmur3-128",code:34,encode:r=>nl.fromHex(Uy.default.x64.hash128(r))}),jNe=il({name:"murmur3-x64-64",code:34,encode:r=>nl.fromHex(Uy.default.x64.hash128(r)).subarray(0,8)});async function Dfe(r){return(await Ol.encode(r)).slice(0,8).reverse()}var Nfe={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:Pe,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:Dfe,hamtHashCode:34,hamtBucketBits:8},oB=(r={})=>Ve.bind({ignoreUndefined:!0})(Nfe,r);var Ofe=async(r,e,t)=>{t.codec||(t.codec=mt),t.hasher||(t.hasher=Pe),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===mt&&t.hasher!==Pe&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=P.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i},Hs=Ofe;var Lfe=async(r,e,t)=>{let n=new He({type:"directory",mtime:r.mtime,mode:r.mode}),i=ze(on({Data:n.marshal()})),s=await Hs(i,e,t),o=r.path;return{cid:s,path:o,unixfs:n,size:i.length}},aB=Lfe;var hB=C(Y(),1);async function Bfe(r,e){return e(await rn(r))}var cB=Bfe;function Mfe(r,e,t){return uB(r,e,t)}async function uB(r,e,t){let n=[];for await(let i of Dl(r,t.maxChildrenPerNode))n.push(await e(i));return n.length>1?uB(n,e,t):n[0]}var lB=Mfe;async function Ufe(r,e,t){let n=new EE(t.layerRepeat),i=0,s=1,o=n;for await(let a of Dl(r,t.maxChildrenPerNode))o.isFull()&&(o!==n&&n.addChild(await o.reduce(e)),i&&i%t.layerRepeat===0&&s++,o=new Fy(s,t.layerRepeat,i),i++),o.append(a);return o&&o!==n&&n.addChild(await o.reduce(e)),n.reduce(e)}var fB=Ufe,Fy=class{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;let e=this._findParent(this.node,this.currentDepth);return e?(this._addNextNodeToParent(e),!1):!0}_addNextNodeToParent(e){this.parent=e;let t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter(i=>i.data).map(i=>this._reduce(i,t)))),t((e.data||[]).concat(n))}_findParent(e,t){let n=e.parent;if(!(!n||n.depth===0))return n.children.length===n.maxChildren||!n.maxChildren?this._findParent(n,t):n}},EE=class extends Fy{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}};async function*Ffe(r,e,t){for await(let n of r.content)yield async()=>{t.progress(n.length,r.path);let i,s={codec:mt,cidVersion:t.cidVersion,hasher:t.hasher,onlyHash:t.onlyHash};return t.rawLeaves?(s.codec=ei,s.cidVersion=1):(i=new He({type:t.leafType,data:n}),n=ze({Data:i.marshal(),Links:[]})),{cid:await Hs(n,e,s),unixfs:i,size:n.length}}}var dB=Ffe;var Vfe={flat:cB,balanced:lB,trickle:fB};async function*zfe(r,e,t){let n=-1,i,s;typeof t.bufferImporter=="function"?s=t.bufferImporter:s=dB;for await(let o of Nl(s(r,e,t),t.blockWriteConcurrency)){if(n++,n===0){i=o;continue}else n===1&&i&&(yield i,i=null);yield o}i&&(i.single=!0,yield i)}var Kfe=(r,e,t)=>{async function n(i){if(i.length===1&&i[0].single&&t.reduceSingleLeafToSelf){let l=i[0];if(r.mtime!==void 0||r.mode!==void 0){let f=await e.get(l.cid);l.unixfs=new He({type:"file",mtime:r.mtime,mode:r.mode,data:f}),f=ze(on({Data:l.unixfs.marshal()})),l.cid=await Hs(f,e,{...t,codec:mt,hasher:t.hasher,cidVersion:t.cidVersion}),l.size=f.length}return{cid:l.cid,path:r.path,unixfs:l.unixfs,size:l.size}}let s=new He({type:"file",mtime:r.mtime,mode:r.mode}),o=i.filter(l=>l.cid.code===cn&&l.size||l.unixfs&&!l.unixfs.data&&l.unixfs.fileSize()?!0:Boolean(l.unixfs&&l.unixfs.data&&l.unixfs.data.length)).map(l=>l.cid.code===cn?(s.addBlockSize(l.size),{Name:"",Tsize:l.size,Hash:l.cid}):(!l.unixfs||!l.unixfs.data?s.addBlockSize(l.unixfs&&l.unixfs.fileSize()||0):s.addBlockSize(l.unixfs.data.length),{Name:"",Tsize:l.size,Hash:l.cid})),a={Data:s.marshal(),Links:o},c=ze(on(a));return{cid:await Hs(c,e,t),path:r.path,unixfs:s,size:c.length+a.Links.reduce((l,f)=>l+f.Tsize,0)}}return n};function Hfe(r,e,t){let n=Vfe[t.strategy];if(!n)throw(0,hB.default)(new Error(`Unknown importer build strategy name: ${t.strategy}`),"ERR_BAD_STRATEGY");return n(zfe(r,e,t),Kfe(r,e,t),t)}var pB=Hfe;var RE=C(Y(),1);var gB=Symbol.for("@achingbrain/uint8arraylist");function mB(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function Ro(r){return Boolean(r==null?void 0:r[gB])}var qe=class{constructor(...e){Object.defineProperty(this,gB,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Ro(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Ro(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=mB(this.bufs,e);return t.buf[t.index]}set(e,t){let n=mB(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Ro(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:i}=this._subList(e,t);return ve(n,i)}subarray(e,t){let{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:ve(n,i)}sublist(e,t){let{bufs:n,length:i}=this._subList(e,t),s=new qe;return s.length=i,s.bufs=n,s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],i=0;for(let s=0;s<this.bufs.length;s++){let o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;let u=e>=a&&e<c,l=t>a&&t<=c;if(u&&l){if(e===a&&t===c){n.push(o);break}let f=e-a;n.push(o.subarray(f,f+(t-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(l){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Ro(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");let s=256,o=new Int32Array(s);for(let f=0;f<s;f++)o[f]=-1;for(let f=0;f<i;f++)o[n[f]]=f;let a=o,c=this.byteLength-n.byteLength,u=n.byteLength-1,l;for(let f=t;f<=c;f+=l){l=0;for(let h=u;h>=0;h--){let d=this.get(f+h);if(n[h]!==d){l=Math.max(1,h-a[d]);break}}if(l===0)return f}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=Ns(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let i=xa(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let i=xa(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let i=xa(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=Ns(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let i=xa(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let i=xa(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let i=xa(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let i=xa(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let i=xa(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof qe)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!ke(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new qe;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}};var PB=C(CB(),1),AE=C(Y(),1);async function*Yfe(r,e){let t,n,i;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)i=e.avgChunkSize,t=e.minChunkSize,n=e.maxChunkSize;else if(e.avgChunkSize)i=e.avgChunkSize,t=i/3,n=i+i/2;else throw(0,AE.default)(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");if(t<16)throw(0,AE.default)(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<t&&(n=t),i<t&&(i=t);let s=Math.floor(Math.log2(i));for await(let o of Qfe(r,{min:t,max:n,bits:s,window:e.window,polynomial:e.polynomial}))yield o}var kB=Yfe;async function*Qfe(r,e){let t=await(0,PB.create)(e.bits,e.min,e.max,e.window),n=new qe;for await(let i of r){n.append(i);let s=t.fingerprint(i);for(let o=0;o<s.length;o++){let a=s[o],c=n.slice(0,a);n.consume(a),yield c}}n.length&&(yield n.subarray(0))}async function*Xfe(r,e){let t=new qe,n=0,i=!1,s=e.maxChunkSize;for await(let o of r)for(t.append(o),n+=o.length;n>=s;)if(yield t.slice(0,s),i=!0,s===t.length)t=new qe,n=0;else{let a=new qe;a.append(t.sublist(s)),t=a,n-=s}(!i||n)&&(yield t.subarray(0,n))}var DB=Xfe;var IE=C(Y(),1);async function*Zfe(r){for await(let e of r){if(e.length===void 0)throw(0,IE.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof e=="string"||e instanceof String)yield W(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else if(e instanceof Uint8Array)yield e;else throw(0,IE.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}}var NB=Zfe;function Jfe(r){return Symbol.iterator in r}function ede(r){return Symbol.asyncIterator in r}function tde(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(Jfe(r))return async function*(){yield*r}();if(ede(r))return r}catch{throw(0,RE.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw(0,RE.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*rde(r,e,t){for await(let n of r)if(n.path&&(n.path.substring(0,2)==="./"&&(t.wrapWithDirectory=!0),n.path=n.path.split("/").filter(i=>i&&i!==".").join("/")),n.content){let i;typeof t.chunker=="function"?i=t.chunker:t.chunker==="rabin"?i=kB:i=DB;let s;typeof t.chunkValidator=="function"?s=t.chunkValidator:s=NB;let o={path:n.path,mtime:n.mtime,mode:n.mode,content:i(s(tde(n.content),t),t)};yield()=>pB(o,e,t)}else if(n.path){let i={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>aB(i,e,t)}else throw new Error("Import candidate must have content or path or both")}var OB=rde;var CE=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},nu=CE;var PE=class extends nu{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){let e=Object.keys(this._children);for(let t=0;t<e.length;t++){let n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){let t=Object.keys(this._children),n=[];for(let u=0;u<t.length;u++){let l=this._children[t[u]];if(l instanceof nu)for await(let f of l.flush(e))l=f,yield l;l.size!=null&&l.cid&&n.push({Name:t[u],Tsize:l.size,Hash:l.cid})}let i=new He({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:i.marshal(),Links:n},o=ze(on(s)),a=await Hs(o,e,this.options),c=o.length+s.Links.reduce((u,l)=>u+(l.Tsize==null?0:l.Tsize),0);this.cid=a,this.size=c,yield{cid:a,unixfs:i,path:this.path,size:c}}},I1=PE;var UB=C(MB(),1);var Er=class{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new UB.default,this.key=null}async put(e,t){let n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){let t=await this._findChild(e);if(t!=null)return t.value}async del(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof Er?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof Er?yield*t.eachLeafSeries():yield t}serialize(e,t){let n=[];return t(this._children.reduce((i,s,o)=>(s!=null&&(s instanceof Er?i.push(s.serialize(e,t)):i.push(e(s,o))),i),n))}async asyncTransform(e,t){return await FB(this,e,t)}toJSON(){return this.serialize(ade,cde)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof Er)&&n!=null&&n.key===e)return n}async _findPlace(e){let t=this._options.hash(typeof e=="string"?W(e):e),n=await t.take(this._options.bits),i=this._children.get(n);return i instanceof Er?await i._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:i}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new Er(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let i=await n._findPlace(t.existingChild.hash);return i.bucket._putAt(i,t.existingChild.key,t.existingChild.value),await n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(ode);if(e!=null&&!(e instanceof Er)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function ode(r){return Boolean(r)}function ade(r,e){return r.key}function cde(r){return r}async function FB(r,e,t){let n=[];for(let i of r._children.compactArray())if(i instanceof Er)await FB(i,e,t);else{let s=await e(i);n.push({bitField:r._children.bitField(),children:s})}return await t(n)}var ude=[255,254,252,248,240,224,192,128],lde=[1,3,7,15,31,63,127,255],Vy=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let i=this._value[this._currentBytePos],s=this._currentBitPos+1,o=Math.min(s,t),a=fde(i,s-o,o);n=(n<<o)+a,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function fde(r,e,t){let n=dde(e,t);return(r&n)>>>e}function dde(r,e){return ude[r]&lde[Math.min(e+r-1,7)]}function VB(r){function e(t){return t instanceof zy?t:new zy(t,r)}return e}var zy=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let i=this._buffers[this._currentBufferIndex],s=Math.min(i.availableBits(),t),o=i.take(s);n=(n<<s)+o,t-=s,this._availableBits-=s,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),t);n.untake(i),t-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?ve([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Vy(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function iu(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:VB(r.hashFn)};return new Er(e)}var kE=class extends nu{constructor(e,t){super(e,t),this._bucket=iu({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(let t of KB(this._bucket,e,this,this.options))yield{...t,path:this.path}}},zB=kE;async function*KB(r,e,t,n){let i=r._children,s=[],o=0;for(let d=0;d<i.length;d++){let m=i.get(d);if(!m)continue;let w=d.toString(16).toUpperCase().padStart(2,"0");if(m instanceof Er){let b;for await(let v of await KB(m,e,null,n))b=v;if(!b)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:w,Tsize:b.size,Hash:b.cid}),o+=b.size}else if(typeof m.value.flush=="function"){let b=m.value,v;for await(let p of b.flush(e))v=p,yield v;let T=w+m.key;s.push({Name:T,Tsize:v.size,Hash:v.cid}),o+=v.size}else{let b=m.value;if(!b.cid)continue;let v=w+m.key,T=b.size;s.push({Name:v,Tsize:T,Hash:b.cid}),o+=T}}let a=Uint8Array.from(i.bitField().reverse()),c=new He({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:n.hamtHashCode,mtime:t&&t.mtime,mode:t&&t.mode}),u={Data:c.marshal(),Links:s},l=ze(on(u)),f=await Hs(l,e,n),h=l.length+o;yield{cid:f,unixfs:c,size:h}}async function HB(r,e,t,n){let i=e;e instanceof I1&&e.directChildrenCount()>=t&&(i=await hde(e,n));let s=i.parent;if(s){if(i!==e){if(r&&(r.parent=i),!i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return HB(i,s,t,n)}return i}async function hde(r,e){let t=new zB({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for await(let{key:n,child:i}of r.eachChildSeries())await t.put(n,i);return t}var $B=HB;var pde=(r="")=>(r.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean),qB=pde;async function mde(r,e,t){let n=qB(r.path||""),i=n.length-1,s=e,o="";for(let a=0;a<n.length;a++){let c=n[a];o+=`${o?"/":""}${c}`;let u=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,u)await s.put(c,r),e=await $B(null,s,t.shardSplitThreshold,t);else{let l=await s.get(c);(!l||!(l instanceof nu))&&(l=new I1({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:l&&l.unixfs&&l.unixfs.mtime,mode:l&&l.unixfs&&l.unixfs.mode},t)),await s.put(c,l),s=l}}return e}async function*GB(r,e){if(!(r instanceof nu)){r&&r.unixfs&&r.unixfs.isDirectory()&&(yield r);return}yield*r.flush(e)}async function*gde(r,e,t){let n=new I1({root:!0,dir:!0,path:"",dirty:!0,flat:!0},t);for await(let i of r)i&&(n=await mde(i,n,t),(!i.unixfs||!i.unixfs.isDirectory())&&(yield i));if(t.wrapWithDirectory)yield*GB(n,e);else for await(let i of n.eachChildSeries())i&&(yield*GB(i.child,e))}var jB=gde;async function*lh(r,e,t={}){let n=oB(t),i;typeof t.dagBuilder=="function"?i=t.dagBuilder:i=OB;let s;typeof t.treeBuilder=="function"?s=t.treeBuilder:s=jB;let o;Symbol.asyncIterator in r||Symbol.iterator in r?o=r:o=[r];for await(let a of s(Nl(i(o,e,n),n.fileImportConcurrency),e,n))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}var R1=C(Y(),1);async function*Ky(r,e){if(typeof r=="string"||r instanceof String||is(r)||Ma(r)||r._readableState)throw(0,R1.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(Ua(r)&&(r=ai(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=Ks(r),{value:n,done:i}=await t.peek();if(i){yield*[];return}if(t.push(n),Number.isInteger(n))throw(0,R1.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState){yield*Bt(t,s=>DE({content:s},e));return}if(is(n)){yield DE({content:t},e);return}if(v1(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||Ua(n)||Ma(n)){yield*Bt(t,s=>DE(s,e));return}}throw v1(r)?(0,R1.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT"):(0,R1.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}async function DE(r,e){let{path:t,mode:n,mtime:i,content:s}=r,o={path:t||"",mode:ya(n),mtime:Rc(i)};return s?o.content=await e(s):t||(o.content=await e(r)),o}function WB(r){return Ky(r,Ny)}var YB=r=>{if(r)if(r.startsWith("size-")){let e=r.split("-")[1],t=parseInt(e);if(isNaN(t))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:t}}else{if(r.startsWith("rabin"))return{chunker:"rabin",...yde(r)};throw new Error(`Unrecognized chunker option: ${r}`)}else return{chunker:"fixed"}},yde=r=>{let e={},t=r.split("-");switch(t.length){case 1:e.avgChunkSize=262144;break;case 2:e.avgChunkSize=Hy(t[1],"avg");break;case 4:e.minChunkSize=Hy(t[1],"min"),e.avgChunkSize=Hy(t[2],"avg"),e.maxChunkSize=Hy(t[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return e},Hy=(r,e)=>{let t=parseInt(r);if(isNaN(t))throw new Error(`Chunker parameter ${e} must be an integer`);return t};var wde=Ve.bind({ignoreUndefined:!0});function QB({repo:r,preload:e,hashers:t,options:n}){let i=n&&n.sharding;async function*s(o,a={}){let c=wde({shardSplitThreshold:i?1e3:1/0,strategy:"balanced"},a,{...YB(a.chunker)});c.hashAlg&&c.hashAlg!=="sha2-256"&&c.cidVersion!==1&&(c.cidVersion=1),c.trickle&&(c.strategy="trickle"),c.strategy==="trickle"&&(c.leafType="raw",c.reduceSingleLeafToSelf=!1),c.cidVersion>0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),c.hashAlg!==void 0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),delete c.trickle;let u={};if(c.progress){let d=c.progress;c.progress=(m,w)=>{u[w]||(u[w]=0),u[w]+=m,d(u[w],w)}}let l;c.hashAlg!=null&&(l=await t.getHasher(c.hashAlg));let f=_e(WB(o),d=>lh(d,r.blocks,{...c,hasher:l,pin:!1}),bde(c),_de(e,c),Ede(r,c)),h=await r.gcLock.readLock();try{for await(let d of f){let m=d.path??d.cid.toString();delete u[m],yield{...d,path:m}}}finally{h()}}return H(s)}function bde(r){async function*e(t){for await(let n of t){let i=n.cid;r.cidVersion===1&&(i=i.toV1());let s=n.path?n.path:i.toString();r.wrapWithDirectory&&!n.path&&(s=""),yield{path:s,cid:i,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return e}function _de(r,e){async function*t(n){for await(let i of n)(!i.path||e.wrapWithDirectory?i.path==="":!i.path.includes("/"))&&!e.onlyHash&&e.preload!==!1&&r(i.cid),yield i}return t}function Ede(r,e){async function*t(n){for await(let i of n){let s=!(i.path&&i.path.includes("/"));(e.pin==null?!0:e.pin)&&s&&!e.onlyHash&&await r.pins.pinRecursively(i.cid),yield i}}return t}var jy=C(Y(),1);var fM=C(Y(),1);var Gy=C(Y(),1);var vde=async function(r){return(await Ol.encode(r)).slice(0,8).reverse()},Sde=(r,e,t)=>Promise.all(r.map(n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);return e._putObjectAt(i,new Er({hash:t._options.hash,bits:t._options.bits},e,i))}return t.put(n.Name.substring(2),!0)})),XB=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),xde=r=>{let e=r.bucket,t=[];for(;e._parent;)t.push(e),e=e._parent;return t.push(e),t.reverse()},ZB=async(r,e,t,n,i)=>{if(!n){let l=iu({hashFn:vde});n={rootBucket:l,hamtDepth:1,lastBucket:l}}await Sde(r.Links,n.lastBucket,n.rootBucket);let s=await n.rootBucket._findNewBucketAndPos(e),o=XB(s.pos),a=xde(s);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],o=XB(n.lastBucket._posAtParent));let c=r.Links.find(l=>{if(l.Name==null)return!1;let f=l.Name.substring(0,2),h=l.Name.substring(2);return!(f!==o||h&&h!==e)});if(!c)return null;if(c.Name!=null&&c.Name.substring(2)===e)return c.Hash;n.hamtDepth++;let u=await t.get(c.Hash,i);return r=pt(u),ZB(r,e,t,n,i)},JB=ZB;function Tde(r,e,t,n){let i=r.length,s=e+i;return t>=s||n<e?new Uint8Array(0):(n>=e&&n<s&&(r=r.subarray(0,n-e)),t>=e&&t<s&&(r=r.subarray(t-e)),r)}var Ll=Tde;var $y=C(Y(),1),Ade=(r,e,t)=>{if(e||(e=0),e<0)throw(0,$y.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>r)throw(0,$y.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(!t&&t!==0&&(t=r-e),t<0)throw(0,$y.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+t>r&&(t=r-e),{offset:e,length:t}},fh=Ade;var qy=C(Y(),1);async function eM(r,e,t,n,i,s,o,a){if(e instanceof Uint8Array){t.push(Ll(e,n,i,s));return}if(e.Data==null)throw(0,qy.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=He.unmarshal(e.Data)}catch(l){throw(0,qy.default)(l,"ERR_NOT_UNIXFS")}if(c.data!=null){let l=c.data,f=Ll(l,n,i,s);t.push(f),n+=f.byteLength}let u=[];for(let l=0;l<e.Links.length;l++){let f=e.Links[l],h=n,d=h+c.blockSizes[l];if((i>=h&&i<d||s>=h&&s<=d||i<h&&s>d)&&u.push({link:f,blockStart:n}),n=d,n>s)break}await _e(u,l=>Bt(l,f=>async()=>{let h=await r.get(f.link.Hash,{signal:a.signal});return{...f,block:h}}),l=>Ba(l,{ordered:!0}),async l=>{for await(let{link:f,block:h,blockStart:d}of l){let m;switch(f.Hash.code){case Xe:m=pt(h);break;case cn:m=h;break;default:t.end((0,qy.default)(new Error(`Unsupported codec: ${f.Hash.code}`),"ERR_NOT_UNIXFS"));return}o.add(async()=>{await eM(r,m,t,d,i,s,o,a)})}})}var Ide=(r,e,t,n,i,s,o)=>{async function*a(c={}){let u=t.fileSize();if(u===void 0)throw new Error("File was a directory");let{offset:l,length:f}=fh(u,c.offset,c.length);if(f===0)return;let h=new Ot({concurrency:1}),d=Kt();h.add(async()=>{await eM(o,e,d,0,l,l+f,h,c)}),h.on("error",w=>{d.end(w)});let m=0;for await(let w of d)w!=null&&(m+=w.byteLength,m===f&&d.end(),yield w)}return a},NE=Ide;var Rde=(r,e,t,n,i,s,o)=>{async function*a(c={}){let u=c.offset||0,l=c.length||e.Links.length,f=e.Links.slice(u,l);for(let h of f){let d=await i(h.Hash,h.Name||"",`${n}/${h.Name||""}`,[],s+1,o,c);d.entry&&(yield d.entry)}}return a},tM=Rde;var Cde=(r,e,t,n,i,s,o)=>{function a(c={}){return rM(e,n,i,s,o,c)}return a};async function*rM(r,e,t,n,i,s){let o=r.Links;for(let a of o){let c=a.Name!=null?a.Name.substring(2):null;if(c)yield(await t(a.Hash,c,`${e}/${c}`,[],n+1,i,s)).entry;else{let u=await i.get(a.Hash);r=pt(u);for await(let l of rM(r,e,t,n,i,s))yield l}}}var nM=Cde;var Pde=(r,e)=>{let t=r.Links.find(n=>n.Name===e);return t&&t.Hash},kde={raw:NE,file:NE,directory:tM,"hamt-sharded-directory":nM,metadata:(r,e,t,n,i,s,o)=>()=>[],symlink:(r,e,t,n,i,s,o)=>()=>[]},Dde=async(r,e,t,n,i,s,o,a)=>{let c=await o.get(r,a),u=pt(c),l,f;if(e||(e=r.toString()),u.Data==null)throw(0,Gy.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=He.unmarshal(u.Data)}catch(h){throw(0,Gy.default)(h,"ERR_NOT_UNIXFS")}if(t||(t=e),n.length){let h;if(l&&l.type==="hamt-sharded-directory"?h=await JB(u,n[0],o):h=Pde(u,n[0]),!h)throw(0,Gy.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let d=n.shift(),m=`${t}/${d}`;f={cid:h,toResolve:n,name:d||"",path:m}}return{entry:{type:l.isDirectory()?"directory":"file",name:e,path:t,cid:r,content:kde[l.type](r,u,l,t,i,s,o),unixfs:l,depth:s,node:u,size:l.fileSize()},next:f}},iM=Dde;var sM=C(Y(),1);var Nde=r=>{async function*e(t={}){let{offset:n,length:i}=fh(r.length,t.offset,t.length);yield Ll(r,0,n,n+i)}return e},Ode=async(r,e,t,n,i,s,o,a)=>{if(n.length)throw(0,sM.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await o.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:Nde(c),depth:s,size:c.length,node:c}}},oM=Ode;var aM=C(Y(),1);var Lde=async(r,e,t,n,i,s,o,a)=>{let c=await o.get(r),u=ul(c),l=u,f=t;for(;n.length;){let h=n[0];if(h in l){n.shift(),f=`${f}/${h}`;let d=P.asCID(l[h]);if(d)return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:s,size:c.length,content:async function*(){yield u}},next:{cid:d,name:h,path:f,toResolve:n}};l=l[h]}else throw(0,aM.default)(new Error(`No property named ${h} found in cbor node ${r}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:s,size:c.length,content:async function*(){yield u}}}},cM=Lde;var uM=C(Y(),1);var Bde=r=>{async function*e(t={}){let{offset:n,length:i}=fh(r.length,t.offset,t.length);yield Ll(r,0,n,n+i)}return e},Mde=async(r,e,t,n,i,s,o,a)=>{if(n.length)throw(0,uM.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await Xt(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:Bde(c.digest),depth:s,size:c.digest.length,node:c.digest}}},lM=Mde;var Ude={[Xe]:iM,[cn]:oM,[_p]:cM,[Hr.code]:lM};function dM(r,e,t,n,i,s,o){let a=Ude[r.code];if(!a)throw(0,fM.default)(new Error(`No resolver for code ${r.code}`),"ERR_NO_RESOLVER");return a(r,e,t,n,dM,i,s,o)}var hM=dM;var Fde=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),Vde=r=>{if(r instanceof Uint8Array)return{cid:P.decode(r),toResolve:[]};let e=P.asCID(r);if(e)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));let t=Fde(r);return{cid:P.parse(t[0]),toResolve:t.slice(1)}}throw(0,jy.default)(new Error(`Unknown path type ${r}`),"ERR_BAD_PATH")};async function*OE(r,e,t={}){let{cid:n,toResolve:i}=Vde(r),s=n.toString(),o=s,a=i.length;for(;;){let c=await hM(n,s,o,i,a,e,t);if(!c.entry&&!c.next)throw(0,jy.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;i=c.next.toResolve,n=c.next.cid,s=c.next.name,o=c.next.path}}async function Sn(r,e,t={}){let n=await Wt(OE(r,e,t));if(!n)throw(0,jy.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");return n}async function*Wy(r,e,t={}){let n=await Sn(r,e,t);if(!n)return;if(yield n,n.type==="directory")for await(let s of i(n,t))yield s;async function*i(s,o){for await(let a of s.content(o))yield a,!(a instanceof Uint8Array)&&a.type==="directory"&&(yield*i(a,o))}}function pM({repo:r,preload:e}){async function*t(n,i={}){if(n=Dd(n),i.preload!==!1){let o=n.split("/");e(P.parse(o[0]))}let s=await Sn(n,r.blocks,i);if(s.type==="directory")throw new Error("this dag node is a directory");if(!s.content)throw new Error("this dag node has no content");yield*s.content(i)}return H(t)}var Eh=C(Y(),1);function Bl(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}var HBe="0".charCodeAt(0),$Be=W("ustar\0","binary"),qBe=W("ustar ","binary"),GBe=W(" \0","binary");function Yy(r){let e=async function*(){let t=yield,n=new qe;for await(let i of r){if(t==null){n.append(i),t=yield n,n=new qe;continue}for(n.append(i);n.length>=t;){let s=n.sublist(0,t);if(n.consume(t),t=yield s,t==null){n.length>0&&(t=yield n,n=new qe);break}}}if(t!=null)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}var wM=C(gM(),1);async function dh(r){let e=new Uint8Array(0);for await(let t of r)e=ve([e,t],e.length+t.length);return e}var Kde="0000000000000000000",Hde="7777777777777777777",$de="0".charCodeAt(0),qde=W("ustar\0","binary"),Gde=W("00","binary"),jde=parseInt("7777",8),Wde=257,Yde=263,Qde=function(r){switch(r){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},Xde=function(r){let e=256;for(let t=0;t<148;t++)e+=r[t];for(let t=156;t<512;t++)e+=r[t];return e},su=function(r,e){let t=r.toString(8);return t.length>e?W(Hde.slice(0,e)+" "):W(Kde.slice(0,e-t.length)+t+" ")},LE=function(r){let e=W(r).byteLength,t=Math.floor(Math.log(e)/Math.log(10))+1;return e+t>=Math.pow(10,t)&&t++,`${e+t}${r}`};function yM(r){let e="";r.name!=null&&(e+=LE(" path="+r.name+`
`)),r.linkname!=null&&(e+=LE(" linkpath="+r.linkname+`
`));let t=r.pax;if(t!=null)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e+=LE(" "+n+"="+t[n]+`
`));return W(e)}function Qy(r){let e=new Uint8Array(512),t=r.name,n="";if(r.typeflag===5&&t[t.length-1]!=="/"&&(t+="/"),W(t).byteLength!==t.length)return null;for(;W(t).byteLength>100;){let i=t.indexOf("/");if(i===-1)return null;n+=n!==""?"/"+t.slice(0,i):t.slice(0,i),t=t.slice(i+1)}return W(t).byteLength>100||W(n).byteLength>155||r.linkname!=null&&W(r.linkname).byteLength>100?null:(e.set(W(t),0),e.set(su(r.mode&jde,6),100),e.set(su(r.uid,6),108),e.set(su(r.gid,6),116),e.set(su(r.size,11),124),e.set(su(r.mtime.getTime()/1e3|0,11),136),e[156]=$de+Qde(r.type),r.linkname!=null&&e.set(W(r.linkname),157),e.set(qde,Wde),e.set(Gde,Yde),r.uname!=null&&e.set(W(r.uname),265),r.gname!=null&&e.set(W(r.gname),297),e.set(su(r.devmajor??0,6),329),e.set(su(r.devminor??0,6),337),n!=null&&e.set(W(n),345),e.set(su(Xde(e),6),148),e)}var{S_IFMT:Jde,S_IFBLK:ehe,S_IFCHR:the,S_IFDIR:rhe,S_IFIFO:nhe,S_IFLNK:ihe}=wM.default,she=parseInt("755",8),ohe=parseInt("644",8),bM=new Uint8Array(1024);function ahe(r=0){switch(r&Jde){case ehe:return"block-device";case the:return"character-device";case rhe:return"directory";case nhe:return"fifo";case ihe:return"symlink";default:return"file"}}function ME(r){return r&=511,r!==0?bM.subarray(0,512-r):new Uint8Array(0)}function BE(r){if(r.pax==null){let e=Qy(r);if(e!=null)return e}return che(r)}function che(r){let e=yM(r),t={name:"PaxHeader",mode:r.mode,uid:r.uid,gid:r.gid,size:e.length,mtime:r.mtime,type:"pax-header",linkname:r.linkname,uname:r.uname,gname:r.gname,devmajor:r.devmajor,devminor:r.devminor};return new qe(Qy(t)??new Uint8Array(0),e,ME(e.length),Qy({...t,size:r.size,type:r.type})??new Uint8Array(0)).subarray()}function Xy(){return async function*(r){for await(let{header:e,body:t}of r){let n={...e,size:e.type==="symlink"?0:e.size??0,type:e.type??ahe(e.mode),mode:e.mode??(e.type==="directory"?she:ohe),uid:e.uid??0,gid:e.gid??0,mtime:e.mtime??new Date};if(typeof t=="string"&&(t=W(t)),t instanceof Uint8Array||Ro(t)){n.size=t.length,yield BE(n),yield Ro(t)?t.subarray():t,yield ME(n.size);continue}if(n.type==="symlink"&&n.linkname==null){if(t==null)throw new Error("type was symlink but no linkname or body specified");n.linkname=j(await dh(t)),yield BE(n);continue}if(yield BE(n),n.type!=="file"&&n.type!=="contiguous-file")continue;let i=0;for await(let s of t??[])i+=s.length,yield Ro(s)?s.subarray():s;if(i!==n.size)throw new Error(`size mismatch, wrote ${i} of ${n.size} bytes`);yield ME(n.size)}yield bM}}function wh(r){let e=r.length;for(;--e>=0;)r[e]=0}var uhe=0,iU=1,lhe=2,fhe=3,dhe=258,a9=29,H1=256,L1=H1+1+a9,mh=30,c9=19,sU=2*L1+1,Ml=15,UE=16,hhe=7,u9=256,oU=16,aU=17,cU=18,ZE=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n5=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),phe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mhe=512,Va=new Array((L1+2)*2);wh(Va);var D1=new Array(mh*2);wh(D1);var B1=new Array(mhe);wh(B1);var M1=new Array(dhe-fhe+1);wh(M1);var l9=new Array(a9);wh(l9);var i5=new Array(mh);wh(i5);function FE(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}var lU,fU,dU;function VE(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var hU=r=>r<256?B1[r]:B1[256+(r>>>7)],U1=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},ci=(r,e,t)=>{r.bi_valid>UE-t?(r.bi_buf|=e<<r.bi_valid&65535,U1(r,r.bi_buf),r.bi_buf=e>>UE-r.bi_valid,r.bi_valid+=t-UE):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Po=(r,e,t)=>{ci(r,t[e*2],t[e*2+1])},pU=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},ghe=r=>{r.bi_valid===16?(U1(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},yhe=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length,u,l,f,h,d,m,w=0;for(h=0;h<=Ml;h++)r.bl_count[h]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<sU;u++)l=r.heap[u],h=t[t[l*2+1]*2+1]+1,h>c&&(h=c,w++),t[l*2+1]=h,!(l>n)&&(r.bl_count[h]++,d=0,l>=a&&(d=o[l-a]),m=t[l*2],r.opt_len+=m*(h+d),s&&(r.static_len+=m*(i[l*2+1]+d)));if(w!==0){do{for(h=c-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[c]--,w-=2}while(w>0);for(h=c;h!==0;h--)for(l=r.bl_count[h];l!==0;)f=r.heap[--u],!(f>n)&&(t[f*2+1]!==h&&(r.opt_len+=(h-t[f*2+1])*t[f*2],t[f*2+1]=h),l--)}},mU=(r,e,t)=>{let n=new Array(Ml+1),i=0,s,o;for(s=1;s<=Ml;s++)i=i+t[s-1]<<1,n[s]=i;for(o=0;o<=e;o++){let a=r[o*2+1];a!==0&&(r[o*2]=pU(n[a]++,a))}},whe=()=>{let r,e,t,n,i,s=new Array(Ml+1);for(t=0,n=0;n<a9-1;n++)for(l9[n]=t,r=0;r<1<<ZE[n];r++)M1[t++]=n;for(M1[t-1]=n,i=0,n=0;n<16;n++)for(i5[n]=i,r=0;r<1<<n5[n];r++)B1[i++]=n;for(i>>=7;n<mh;n++)for(i5[n]=i<<7,r=0;r<1<<n5[n]-7;r++)B1[256+i++]=n;for(e=0;e<=Ml;e++)s[e]=0;for(r=0;r<=143;)Va[r*2+1]=8,r++,s[8]++;for(;r<=255;)Va[r*2+1]=9,r++,s[9]++;for(;r<=279;)Va[r*2+1]=7,r++,s[7]++;for(;r<=287;)Va[r*2+1]=8,r++,s[8]++;for(mU(Va,L1+1,s),r=0;r<mh;r++)D1[r*2+1]=5,D1[r*2]=pU(r,5);lU=new FE(Va,ZE,H1+1,L1,Ml),fU=new FE(D1,n5,0,mh,Ml),dU=new FE(new Array(0),phe,0,c9,hhe)},gU=r=>{let e;for(e=0;e<L1;e++)r.dyn_ltree[e*2]=0;for(e=0;e<mh;e++)r.dyn_dtree[e*2]=0;for(e=0;e<c9;e++)r.bl_tree[e*2]=0;r.dyn_ltree[u9*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},yU=r=>{r.bi_valid>8?U1(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},_M=(r,e,t,n)=>{let i=e*2,s=t*2;return r[i]<r[s]||r[i]===r[s]&&n[e]<=n[t]},zE=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&_M(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!_M(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},EM=(r,e,t)=>{let n,i,s=0,o,a;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+s++]&255,n+=(r.pending_buf[r.sym_buf+s++]&255)<<8,i=r.pending_buf[r.sym_buf+s++],n===0?Po(r,i,e):(o=M1[i],Po(r,o+H1+1,e),a=ZE[o],a!==0&&(i-=l9[o],ci(r,i,a)),n--,o=hU(n),Po(r,o,t),a=n5[o],a!==0&&(n-=i5[o],ci(r,n,a)));while(s<r.sym_next);Po(r,u9,e)},JE=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,a,c=-1,u;for(r.heap_len=0,r.heap_max=sU,o=0;o<s;o++)t[o*2]!==0?(r.heap[++r.heap_len]=c=o,r.depth[o]=0):t[o*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=c<2?++c:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,i&&(r.static_len-=n[u*2+1]);for(e.max_code=c,o=r.heap_len>>1;o>=1;o--)zE(r,t,o);u=s;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],zE(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=a,t[u*2]=t[o*2]+t[a*2],r.depth[u]=(r.depth[o]>=r.depth[a]?r.depth[o]:r.depth[a])+1,t[o*2+1]=t[a*2+1]=u,r.heap[1]=u++,zE(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],yhe(r,e),mU(t,c,r.bl_count)},vM=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)s=o,o=e[(n+1)*2+1],!(++a<c&&s===o)&&(a<u?r.bl_tree[s*2]+=a:s!==0?(s!==i&&r.bl_tree[s*2]++,r.bl_tree[oU*2]++):a<=10?r.bl_tree[aU*2]++:r.bl_tree[cU*2]++,a=0,i=s,o===0?(c=138,u=3):s===o?(c=6,u=3):(c=7,u=4))},SM=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),n=0;n<=t;n++)if(s=o,o=e[(n+1)*2+1],!(++a<c&&s===o)){if(a<u)do Po(r,s,r.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Po(r,s,r.bl_tree),a--),Po(r,oU,r.bl_tree),ci(r,a-3,2)):a<=10?(Po(r,aU,r.bl_tree),ci(r,a-3,3)):(Po(r,cU,r.bl_tree),ci(r,a-11,7));a=0,i=s,o===0?(c=138,u=3):s===o?(c=6,u=3):(c=7,u=4)}},bhe=r=>{let e;for(vM(r,r.dyn_ltree,r.l_desc.max_code),vM(r,r.dyn_dtree,r.d_desc.max_code),JE(r,r.bl_desc),e=c9-1;e>=3&&r.bl_tree[uU[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},_he=(r,e,t,n)=>{let i;for(ci(r,e-257,5),ci(r,t-1,5),ci(r,n-4,4),i=0;i<n;i++)ci(r,r.bl_tree[uU[i]*2+1],3);SM(r,r.dyn_ltree,e-1),SM(r,r.dyn_dtree,t-1)},Ehe=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<H1;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},xM=!1,vhe=r=>{xM||(whe(),xM=!0),r.l_desc=new VE(r.dyn_ltree,lU),r.d_desc=new VE(r.dyn_dtree,fU),r.bl_desc=new VE(r.bl_tree,dU),r.bi_buf=0,r.bi_valid=0,gU(r)},wU=(r,e,t,n)=>{ci(r,(uhe<<1)+(n?1:0),3),yU(r),U1(r,t),U1(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},She=r=>{ci(r,iU<<1,3),Po(r,u9,Va),ghe(r)},xhe=(r,e,t,n)=>{let i,s,o=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=Ehe(r)),JE(r,r.l_desc),JE(r,r.d_desc),o=bhe(r),i=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=i&&(i=s)):i=s=t+5,t+4<=i&&e!==-1?wU(r,e,t,n):r.strategy===4||s===i?(ci(r,(iU<<1)+(n?1:0),3),EM(r,Va,D1)):(ci(r,(lhe<<1)+(n?1:0),3),_he(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),EM(r,r.dyn_ltree,r.dyn_dtree)),gU(r),n&&yU(r)},The=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(M1[t]+H1+1)*2]++,r.dyn_dtree[hU(e)*2]++),r.sym_next===r.sym_end),Ahe=vhe,Ihe=wU,Rhe=xhe,Che=The,Phe=She,khe={_tr_init:Ahe,_tr_stored_block:Ihe,_tr_flush_block:Rhe,_tr_tally:Che,_tr_align:Phe},Dhe=(r,e,t,n)=>{let i=r&65535|0,s=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0},F1=Dhe,Nhe=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},Ohe=new Uint32Array(Nhe()),Lhe=(r,e,t,n)=>{let i=Ohe,s=n+t;r^=-1;for(let o=n;o<s;o++)r=r>>>8^i[(r^e[o])&255];return r^-1},pn=Lhe,Vl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Bhe,_tr_stored_block:e9,_tr_flush_block:Mhe,_tr_tally:cu,_tr_align:Uhe}=khe,{Z_NO_FLUSH:uu,Z_PARTIAL_FLUSH:Fhe,Z_FULL_FLUSH:Vhe,Z_FINISH:ss,Z_BLOCK:TM,Z_OK:xn,Z_STREAM_END:AM,Z_STREAM_ERROR:ko,Z_DATA_ERROR:zhe,Z_BUF_ERROR:KE,Z_DEFAULT_COMPRESSION:Khe,Z_FILTERED:Hhe,Z_HUFFMAN_ONLY:Zy,Z_RLE:$he,Z_FIXED:qhe,Z_DEFAULT_STRATEGY:Ghe,Z_UNKNOWN:jhe,Z_DEFLATED:a5}=Hl,Whe=9,Yhe=15,Qhe=8,Xhe=29,Zhe=256,t9=Zhe+1+Xhe,Jhe=30,e0e=19,t0e=2*t9+1,r0e=15,yt=3,au=258,Do=au+yt+1,n0e=32,gh=42,f9=57,r9=69,n9=73,i9=91,s9=103,Ul=113,P1=666,Wn=1,bh=2,zl=3,_h=4,i0e=3,Fl=(r,e)=>(r.msg=Vl[e],e),IM=r=>r*2-(r>4?9:0),ou=r=>{let e=r.length;for(;--e>=0;)r[e]=0},s0e=r=>{let e,t,n,i=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=i?t-i:0;while(--e);e=i,n=e;do t=r.prev[--n],r.prev[n]=t>=i?t-i:0;while(--e)},o0e=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,lu=o0e,Ii=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Ri=(r,e)=>{Mhe(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Ii(r.strm)},Mt=(r,e)=>{r.pending_buf[r.pending++]=e},C1=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},o9=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=F1(r.adler,e,i,t):r.state.wrap===2&&(r.adler=pn(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},bU=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,s,o=r.prev_length,a=r.nice_match,c=r.strstart>r.w_size-Do?r.strstart-(r.w_size-Do):0,u=r.window,l=r.w_mask,f=r.prev,h=r.strstart+au,d=u[n+o-1],m=u[n+o];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(u[i+o]!==m||u[i+o-1]!==d||u[i]!==u[n]||u[++i]!==u[n+1])){n+=2,i++;do;while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<h);if(s=au-(h-n),n=h-au,s>o){if(r.match_start=e,o=s,s>=a)break;d=u[n+o-1],m=u[n+o]}}while((e=f[e&l])>c&&--t!==0);return o<=r.lookahead?o:r.lookahead},yh=r=>{let e=r.w_size,t,n,i;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-Do)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),s0e(r),n+=e),r.strm.avail_in===0)break;if(t=o9(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=yt)for(i=r.strstart-r.insert,r.ins_h=r.window[i],r.ins_h=lu(r,r.ins_h,r.window[i+1]);r.insert&&(r.ins_h=lu(r,r.ins_h,r.window[i+yt-1]),r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,r.insert--,!(r.lookahead+r.insert<yt)););}while(r.lookahead<Do&&r.strm.avail_in!==0)},_U=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,i,s,o=0,a=r.strm.avail_in;do{if(n=65535,s=r.bi_valid+42>>3,r.strm.avail_out<s||(s=r.strm.avail_out-s,i=r.strstart-r.block_start,n>i+r.strm.avail_in&&(n=i+r.strm.avail_in),n>s&&(n=s),n<t&&(n===0&&e!==ss||e===uu||n!==i+r.strm.avail_in)))break;o=e===ss&&n===i+r.strm.avail_in?1:0,e9(r,0,0,o),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,Ii(r.strm),i&&(i>n&&(i=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+i),r.strm.next_out),r.strm.next_out+=i,r.strm.avail_out-=i,r.strm.total_out+=i,r.block_start+=i,n-=i),n&&(o9(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(o===0);return a-=r.strm.avail_in,a&&(a>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=a&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-a,r.strm.next_in),r.strstart),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),o?_h:e!==uu&&e!==ss&&r.strm.avail_in===0&&r.strstart===r.block_start?bh:(s=r.window_size-r.strstart,r.strm.avail_in>s&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,s+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),s>r.strm.avail_in&&(s=r.strm.avail_in),s&&(o9(r.strm,r.window,r.strstart,s),r.strstart+=s,r.insert+=s>r.w_size-r.insert?r.w_size-r.insert:s),r.high_water<r.strstart&&(r.high_water=r.strstart),s=r.bi_valid+42>>3,s=r.pending_buf_size-s>65535?65535:r.pending_buf_size-s,t=s>r.w_size?r.w_size:s,i=r.strstart-r.block_start,(i>=t||(i||e===ss)&&e!==uu&&r.strm.avail_in===0&&i<=s)&&(n=i>s?s:i,o=e===ss&&r.strm.avail_in===0&&n===i?1:0,e9(r,r.block_start,n,o),r.block_start+=n,Ii(r.strm)),o?zl:Wn)},HE=(r,e)=>{let t,n;for(;;){if(r.lookahead<Do){if(yh(r),r.lookahead<Do&&e===uu)return Wn;if(r.lookahead===0)break}if(t=0,r.lookahead>=yt&&(r.ins_h=lu(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-Do&&(r.match_length=bU(r,t)),r.match_length>=yt)if(n=cu(r,r.strstart-r.match_start,r.match_length-yt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=yt){r.match_length--;do r.strstart++,r.ins_h=lu(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=lu(r,r.ins_h,r.window[r.strstart+1]);else n=cu(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Ri(r,!1),r.strm.avail_out===0))return Wn}return r.insert=r.strstart<yt-1?r.strstart:yt-1,e===ss?(Ri(r,!0),r.strm.avail_out===0?zl:_h):r.sym_next&&(Ri(r,!1),r.strm.avail_out===0)?Wn:bh},hh=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<Do){if(yh(r),r.lookahead<Do&&e===uu)return Wn;if(r.lookahead===0)break}if(t=0,r.lookahead>=yt&&(r.ins_h=lu(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=yt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-Do&&(r.match_length=bU(r,t),r.match_length<=5&&(r.strategy===Hhe||r.match_length===yt&&r.strstart-r.match_start>4096)&&(r.match_length=yt-1)),r.prev_length>=yt&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-yt,n=cu(r,r.strstart-1-r.prev_match,r.prev_length-yt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=lu(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=yt-1,r.strstart++,n&&(Ri(r,!1),r.strm.avail_out===0))return Wn}else if(r.match_available){if(n=cu(r,0,r.window[r.strstart-1]),n&&Ri(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Wn}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=cu(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<yt-1?r.strstart:yt-1,e===ss?(Ri(r,!0),r.strm.avail_out===0?zl:_h):r.sym_next&&(Ri(r,!1),r.strm.avail_out===0)?Wn:bh},a0e=(r,e)=>{let t,n,i,s,o=r.window;for(;;){if(r.lookahead<=au){if(yh(r),r.lookahead<=au&&e===uu)return Wn;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=yt&&r.strstart>0&&(i=r.strstart-1,n=o[i],n===o[++i]&&n===o[++i]&&n===o[++i])){s=r.strstart+au;do;while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);r.match_length=au-(s-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=yt?(t=cu(r,1,r.match_length-yt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=cu(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Ri(r,!1),r.strm.avail_out===0))return Wn}return r.insert=0,e===ss?(Ri(r,!0),r.strm.avail_out===0?zl:_h):r.sym_next&&(Ri(r,!1),r.strm.avail_out===0)?Wn:bh},c0e=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(yh(r),r.lookahead===0)){if(e===uu)return Wn;break}if(r.match_length=0,t=cu(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Ri(r,!1),r.strm.avail_out===0))return Wn}return r.insert=0,e===ss?(Ri(r,!0),r.strm.avail_out===0?zl:_h):r.sym_next&&(Ri(r,!1),r.strm.avail_out===0)?Wn:bh};function Co(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var k1=[new Co(0,0,0,0,_U),new Co(4,4,8,4,HE),new Co(4,5,16,8,HE),new Co(4,6,32,32,HE),new Co(4,4,16,16,hh),new Co(8,16,32,32,hh),new Co(8,16,128,128,hh),new Co(8,32,128,256,hh),new Co(32,128,258,1024,hh),new Co(32,258,258,4096,hh)],u0e=r=>{r.window_size=2*r.w_size,ou(r.head),r.max_lazy_match=k1[r.level].max_lazy,r.good_match=k1[r.level].good_length,r.nice_match=k1[r.level].nice_length,r.max_chain_length=k1[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=yt-1,r.match_available=0,r.ins_h=0};function l0e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=a5,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(t0e*2),this.dyn_dtree=new Uint16Array((2*Jhe+1)*2),this.bl_tree=new Uint16Array((2*e0e+1)*2),ou(this.dyn_ltree),ou(this.dyn_dtree),ou(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(r0e+1),this.heap=new Uint16Array(2*t9+1),ou(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*t9+1),ou(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var $1=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.status!==gh&&e.status!==f9&&e.status!==r9&&e.status!==n9&&e.status!==i9&&e.status!==s9&&e.status!==Ul&&e.status!==P1?1:0},EU=r=>{if($1(r))return Fl(r,ko);r.total_in=r.total_out=0,r.data_type=jhe;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?f9:e.wrap?gh:Ul,r.adler=e.wrap===2?0:1,e.last_flush=-2,Bhe(e),xn},vU=r=>{let e=EU(r);return e===xn&&u0e(r.state),e},f0e=(r,e)=>$1(r)||r.state.wrap!==2?ko:(r.state.gzhead=e,xn),SU=(r,e,t,n,i,s)=>{if(!r)return ko;let o=1;if(e===Khe&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>Whe||t!==a5||n<8||n>15||e<0||e>9||s<0||s>qhe||n===8&&o!==1)return Fl(r,ko);n===8&&(n=9);let a=new l0e;return r.state=a,a.strm=r,a.status=gh,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+yt-1)/yt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=t,vU(r)},d0e=(r,e)=>SU(r,e,a5,Yhe,Qhe,Ghe),h0e=(r,e)=>{if($1(r)||e>TM||e<0)return r?Fl(r,ko):ko;let t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===P1&&e!==ss)return Fl(r,r.avail_out===0?KE:ko);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Ii(r),r.avail_out===0)return t.last_flush=-1,xn}else if(r.avail_in===0&&IM(e)<=IM(n)&&e!==ss)return Fl(r,KE);if(t.status===P1&&r.avail_in!==0)return Fl(r,KE);if(t.status===gh&&t.wrap===0&&(t.status=Ul),t.status===gh){let i=a5+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=Zy||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,i|=s<<6,t.strstart!==0&&(i|=n0e),i+=31-i%31,C1(t,i),t.strstart!==0&&(C1(t,r.adler>>>16),C1(t,r.adler&65535)),r.adler=1,t.status=Ul,Ii(r),t.pending!==0)return t.last_flush=-1,xn}if(t.status===f9){if(r.adler=0,Mt(t,31),Mt(t,139),Mt(t,8),t.gzhead)Mt(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Mt(t,t.gzhead.time&255),Mt(t,t.gzhead.time>>8&255),Mt(t,t.gzhead.time>>16&255),Mt(t,t.gzhead.time>>24&255),Mt(t,t.level===9?2:t.strategy>=Zy||t.level<2?4:0),Mt(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(Mt(t,t.gzhead.extra.length&255),Mt(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=pn(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=r9;else if(Mt(t,0),Mt(t,0),Mt(t,0),Mt(t,0),Mt(t,0),Mt(t,t.level===9?2:t.strategy>=Zy||t.level<2?4:0),Mt(t,i0e),t.status=Ul,Ii(r),t.pending!==0)return t.last_flush=-1,xn}if(t.status===r9){if(t.gzhead.extra){let i=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex+=a,Ii(r),t.pending!==0)return t.last_flush=-1,xn;i=0,s-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=n9}if(t.status===n9){if(t.gzhead.name){let i=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i)),Ii(r),t.pending!==0)return t.last_flush=-1,xn;i=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,Mt(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=i9}if(t.status===i9){if(t.gzhead.comment){let i=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i)),Ii(r),t.pending!==0)return t.last_flush=-1,xn;i=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,Mt(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=pn(r.adler,t.pending_buf,t.pending-i,i))}t.status=s9}if(t.status===s9){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Ii(r),t.pending!==0))return t.last_flush=-1,xn;Mt(t,r.adler&255),Mt(t,r.adler>>8&255),r.adler=0}if(t.status=Ul,Ii(r),t.pending!==0)return t.last_flush=-1,xn}if(r.avail_in!==0||t.lookahead!==0||e!==uu&&t.status!==P1){let i=t.level===0?_U(t,e):t.strategy===Zy?c0e(t,e):t.strategy===$he?a0e(t,e):k1[t.level].func(t,e);if((i===zl||i===_h)&&(t.status=P1),i===Wn||i===zl)return r.avail_out===0&&(t.last_flush=-1),xn;if(i===bh&&(e===Fhe?Uhe(t):e!==TM&&(e9(t,0,0,!1),e===Vhe&&(ou(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Ii(r),r.avail_out===0))return t.last_flush=-1,xn}return e!==ss?xn:t.wrap<=0?AM:(t.wrap===2?(Mt(t,r.adler&255),Mt(t,r.adler>>8&255),Mt(t,r.adler>>16&255),Mt(t,r.adler>>24&255),Mt(t,r.total_in&255),Mt(t,r.total_in>>8&255),Mt(t,r.total_in>>16&255),Mt(t,r.total_in>>24&255)):(C1(t,r.adler>>>16),C1(t,r.adler&65535)),Ii(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?xn:AM)},p0e=r=>{if($1(r))return ko;let e=r.state.status;return r.state=null,e===Ul?Fl(r,zhe):xn},m0e=(r,e)=>{let t=e.length;if($1(r))return ko;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==gh||n.lookahead)return ko;if(i===1&&(r.adler=F1(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(ou(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}let s=r.avail_in,o=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,yh(n);n.lookahead>=yt;){let c=n.strstart,u=n.lookahead-(yt-1);do n.ins_h=lu(n,n.ins_h,n.window[c+yt-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--u);n.strstart=c,n.lookahead=yt-1,yh(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=yt-1,n.match_available=0,r.next_in=o,r.input=a,r.avail_in=s,n.wrap=i,xn},g0e=d0e,y0e=SU,w0e=vU,b0e=EU,_0e=f0e,E0e=h0e,v0e=p0e,S0e=m0e,x0e="pako deflate (from Nodeca project)",N1={deflateInit:g0e,deflateInit2:y0e,deflateReset:w0e,deflateResetKeep:b0e,deflateSetHeader:_0e,deflate:E0e,deflateEnd:v0e,deflateSetDictionary:S0e,deflateInfo:x0e},T0e=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),A0e=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)T0e(t,n)&&(r[n]=t[n])}}return r},I0e=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let o=r[n];t.set(o,i),i+=o.length}return t},c5={assign:A0e,flattenChunks:I0e},xU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{xU=!1}var V1=new Uint8Array(256);for(let r=0;r<256;r++)V1[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;V1[254]=V1[254]=1;var R0e=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e},C0e=(r,e)=>{if(e<65534&&r.subarray&&xU)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},P0e=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,s=new Array(t*2);for(i=0,n=0;n<t;){let o=r[n++];if(o<128){s[i++]=o;continue}let a=V1[o];if(a>4){s[i++]=65533,n+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|r[n++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return C0e(s,i)},k0e=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+V1[r[t]]>e?t:e},z1={string2buf:R0e,buf2string:P0e,utf8border:k0e};function D0e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var TU=D0e,AU=Object.prototype.toString,{Z_NO_FLUSH:N0e,Z_SYNC_FLUSH:O0e,Z_FULL_FLUSH:L0e,Z_FINISH:B0e,Z_OK:s5,Z_STREAM_END:M0e,Z_DEFAULT_COMPRESSION:U0e,Z_DEFAULT_STRATEGY:F0e,Z_DEFLATED:V0e}=Hl;function q1(r){this.options=c5.assign({level:U0e,method:V0e,chunkSize:16384,windowBits:15,memLevel:8,strategy:F0e},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new TU,this.strm.avail_out=0;let t=N1.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==s5)throw new Error(Vl[t]);if(e.header&&N1.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=z1.string2buf(e.dictionary):AU.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=N1.deflateSetDictionary(this.strm,n),t!==s5)throw new Error(Vl[t]);this._dict_set=!0}}q1.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?B0e:N0e,typeof r=="string"?t.input=z1.string2buf(r):AU.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===O0e||s===L0e)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(i=N1.deflate(t,s),i===M0e)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=N1.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s5;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};q1.prototype.onData=function(r){this.chunks.push(r)};q1.prototype.onEnd=function(r){r===s5&&(this.result=c5.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function d9(r,e){let t=new q1(e);if(t.push(r,!0),t.err)throw t.msg||Vl[t.err];return t.result}function z0e(r,e){return e=e||{},e.raw=!0,d9(r,e)}function K0e(r,e){return e=e||{},e.gzip=!0,d9(r,e)}var H0e=q1,$0e=d9,q0e=z0e,G0e=K0e,j0e=Hl,W0e={Deflate:H0e,deflate:$0e,deflateRaw:q0e,gzip:G0e,constants:j0e},Jy=16209,Y0e=16191,Q0e=function(e,t){let n,i,s,o,a,c,u,l,f,h,d,m,w,b,v,T,p,g,y,E,_,x,S,I,k=e.state;n=e.next_in,S=e.input,i=n+(e.avail_in-5),s=e.next_out,I=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),c=k.dmax,u=k.wsize,l=k.whave,f=k.wnext,h=k.window,d=k.hold,m=k.bits,w=k.lencode,b=k.distcode,v=(1<<k.lenbits)-1,T=(1<<k.distbits)-1;e:do{m<15&&(d+=S[n++]<<m,m+=8,d+=S[n++]<<m,m+=8),p=w[d&v];t:for(;;){if(g=p>>>24,d>>>=g,m-=g,g=p>>>16&255,g===0)I[s++]=p&65535;else if(g&16){y=p&65535,g&=15,g&&(m<g&&(d+=S[n++]<<m,m+=8),y+=d&(1<<g)-1,d>>>=g,m-=g),m<15&&(d+=S[n++]<<m,m+=8,d+=S[n++]<<m,m+=8),p=b[d&T];r:for(;;){if(g=p>>>24,d>>>=g,m-=g,g=p>>>16&255,g&16){if(E=p&65535,g&=15,m<g&&(d+=S[n++]<<m,m+=8,m<g&&(d+=S[n++]<<m,m+=8)),E+=d&(1<<g)-1,E>c){e.msg="invalid distance too far back",k.mode=Jy;break e}if(d>>>=g,m-=g,g=s-o,E>g){if(g=E-g,g>l&&k.sane){e.msg="invalid distance too far back",k.mode=Jy;break e}if(_=0,x=h,f===0){if(_+=u-g,g<y){y-=g;do I[s++]=h[_++];while(--g);_=s-E,x=I}}else if(f<g){if(_+=u+f-g,g-=f,g<y){y-=g;do I[s++]=h[_++];while(--g);if(_=0,f<y){g=f,y-=g;do I[s++]=h[_++];while(--g);_=s-E,x=I}}}else if(_+=f-g,g<y){y-=g;do I[s++]=h[_++];while(--g);_=s-E,x=I}for(;y>2;)I[s++]=x[_++],I[s++]=x[_++],I[s++]=x[_++],y-=3;y&&(I[s++]=x[_++],y>1&&(I[s++]=x[_++]))}else{_=s-E;do I[s++]=I[_++],I[s++]=I[_++],I[s++]=I[_++],y-=3;while(y>2);y&&(I[s++]=I[_++],y>1&&(I[s++]=I[_++]))}}else if(g&64){e.msg="invalid distance code",k.mode=Jy;break e}else{p=b[(p&65535)+(d&(1<<g)-1)];continue r}break}}else if(g&64)if(g&32){k.mode=Y0e;break e}else{e.msg="invalid literal/length code",k.mode=Jy;break e}else{p=w[(p&65535)+(d&(1<<g)-1)];continue t}break}}while(n<i&&s<a);y=m>>3,n-=y,m-=y<<3,d&=(1<<m)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=s<a?257+(a-s):257-(s-a),k.hold=d,k.bits=m},ph=15,RM=852,CM=592,PM=0,$E=1,kM=2,X0e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Z0e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),J0e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),epe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),tpe=(r,e,t,n,i,s,o,a)=>{let c=a.bits,u=0,l=0,f=0,h=0,d=0,m=0,w=0,b=0,v=0,T=0,p,g,y,E,_,x=null,S,I=new Uint16Array(ph+1),k=new Uint16Array(ph+1),N=null,L,G,R;for(u=0;u<=ph;u++)I[u]=0;for(l=0;l<n;l++)I[e[t+l]]++;for(d=c,h=ph;h>=1&&I[h]===0;h--);if(d>h&&(d=h),h===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<h&&I[f]===0;f++);for(d<f&&(d=f),b=1,u=1;u<=ph;u++)if(b<<=1,b-=I[u],b<0)return-1;if(b>0&&(r===PM||h!==1))return-1;for(k[1]=0,u=1;u<ph;u++)k[u+1]=k[u]+I[u];for(l=0;l<n;l++)e[t+l]!==0&&(o[k[e[t+l]]++]=l);if(r===PM?(x=N=o,S=20):r===$E?(x=X0e,N=Z0e,S=257):(x=J0e,N=epe,S=0),T=0,l=0,u=f,_=s,m=d,w=0,y=-1,v=1<<d,E=v-1,r===$E&&v>RM||r===kM&&v>CM)return 1;for(;;){L=u-w,o[l]+1<S?(G=0,R=o[l]):o[l]>=S?(G=N[o[l]-S],R=x[o[l]-S]):(G=32+64,R=0),p=1<<u-w,g=1<<m,f=g;do g-=p,i[_+(T>>w)+g]=L<<24|G<<16|R|0;while(g!==0);for(p=1<<u-1;T&p;)p>>=1;if(p!==0?(T&=p-1,T+=p):T=0,l++,--I[u]===0){if(u===h)break;u=e[t+o[l]]}if(u>d&&(T&E)!==y){for(w===0&&(w=d),_+=f,m=u-w,b=1<<m;m+w<h&&(b-=I[m+w],!(b<=0));)m++,b<<=1;if(v+=1<<m,r===$E&&v>RM||r===kM&&v>CM)return 1;y=T&E,i[y]=d<<24|m<<16|_-s|0}}return T!==0&&(i[_+T]=u-w<<24|64<<16|0),a.bits=d,0},O1=tpe,rpe=0,IU=1,RU=2,{Z_FINISH:DM,Z_BLOCK:npe,Z_TREES:e5,Z_OK:Kl,Z_STREAM_END:ipe,Z_NEED_DICT:spe,Z_STREAM_ERROR:os,Z_DATA_ERROR:CU,Z_MEM_ERROR:PU,Z_BUF_ERROR:ope,Z_DEFLATED:NM}=Hl,u5=16180,OM=16181,LM=16182,BM=16183,MM=16184,UM=16185,FM=16186,VM=16187,zM=16188,KM=16189,o5=16190,Fa=16191,qE=16192,HM=16193,GE=16194,$M=16195,qM=16196,GM=16197,jM=16198,t5=16199,r5=16200,WM=16201,YM=16202,QM=16203,XM=16204,ZM=16205,jE=16206,JM=16207,eU=16208,dr=16209,kU=16210,DU=16211,ape=852,cpe=592,upe=15,lpe=upe,tU=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function fpe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var $l=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.mode<u5||e.mode>DU?1:0},NU=r=>{if($l(r))return os;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=u5,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ape),e.distcode=e.distdyn=new Int32Array(cpe),e.sane=1,e.back=-1,Kl},OU=r=>{if($l(r))return os;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,NU(r)},LU=(r,e)=>{let t;if($l(r))return os;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?os:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,OU(r))},BU=(r,e)=>{if(!r)return os;let t=new fpe;r.state=t,t.strm=r,t.window=null,t.mode=u5;let n=LU(r,e);return n!==Kl&&(r.state=null),n},dpe=r=>BU(r,lpe),rU=!0,WE,YE,hpe=r=>{if(rU){WE=new Int32Array(512),YE=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(O1(IU,r.lens,0,288,WE,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;O1(RU,r.lens,0,32,YE,0,r.work,{bits:5}),rU=!1}r.lencode=WE,r.lenbits=9,r.distcode=YE,r.distbits=5},MU=(r,e,t,n)=>{let i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),n-=i,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},ppe=(r,e)=>{let t,n,i,s,o,a,c,u,l,f,h,d,m,w,b=0,v,T,p,g,y,E,_,x,S=new Uint8Array(4),I,k,N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($l(r)||!r.output||!r.input&&r.avail_in!==0)return os;t=r.state,t.mode===Fa&&(t.mode=qE),o=r.next_out,i=r.output,c=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,f=a,h=c,x=Kl;e:for(;;)switch(t.mode){case u5:if(t.wrap===0){t.mode=qE;break}for(;l<16;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,S[0]=u&255,S[1]=u>>>8&255,t.check=pn(t.check,S,2,0),u=0,l=0,t.mode=OM;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=dr;break}if((u&15)!==NM){r.msg="unknown compression method",t.mode=dr;break}if(u>>>=4,l-=4,_=(u&15)+8,t.wbits===0&&(t.wbits=_),_>15||_>t.wbits){r.msg="invalid window size",t.mode=dr;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=u&512?KM:Fa,u=0,l=0;break;case OM:for(;l<16;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(t.flags=u,(t.flags&255)!==NM){r.msg="unknown compression method",t.mode=dr;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=dr;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&(S[0]=u&255,S[1]=u>>>8&255,t.check=pn(t.check,S,2,0)),u=0,l=0,t.mode=LM;case LM:for(;l<32;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&(S[0]=u&255,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,t.check=pn(t.check,S,4,0)),u=0,l=0,t.mode=BM;case BM:for(;l<16;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&(S[0]=u&255,S[1]=u>>>8&255,t.check=pn(t.check,S,2,0)),u=0,l=0,t.mode=MM;case MM:if(t.flags&1024){for(;l<16;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&(S[0]=u&255,S[1]=u>>>8&255,t.check=pn(t.check,S,2,0)),u=0,l=0}else t.head&&(t.head.extra=null);t.mode=UM;case UM:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(_=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+d),_)),t.flags&512&&t.wrap&4&&(t.check=pn(t.check,n,d,s)),a-=d,s+=d,t.length-=d),t.length))break e;t.length=0,t.mode=FM;case FM:if(t.flags&2048){if(a===0)break e;d=0;do _=n[s+d++],t.head&&_&&t.length<65536&&(t.head.name+=String.fromCharCode(_));while(_&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=pn(t.check,n,d,s)),a-=d,s+=d,_)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=VM;case VM:if(t.flags&4096){if(a===0)break e;d=0;do _=n[s+d++],t.head&&_&&t.length<65536&&(t.head.comment+=String.fromCharCode(_));while(_&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=pn(t.check,n,d,s)),a-=d,s+=d,_)break e}else t.head&&(t.head.comment=null);t.mode=zM;case zM:if(t.flags&512){for(;l<16;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(t.wrap&4&&u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=dr;break}u=0,l=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Fa;break;case KM:for(;l<32;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}r.adler=t.check=tU(u),u=0,l=0,t.mode=o5;case o5:if(t.havedict===0)return r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=l,spe;r.adler=t.check=1,t.mode=Fa;case Fa:if(e===npe||e===e5)break e;case qE:if(t.last){u>>>=l&7,l-=l&7,t.mode=jE;break}for(;l<3;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}switch(t.last=u&1,u>>>=1,l-=1,u&3){case 0:t.mode=HM;break;case 1:if(hpe(t),t.mode=t5,e===e5){u>>>=2,l-=2;break e}break;case 2:t.mode=qM;break;case 3:r.msg="invalid block type",t.mode=dr}u>>>=2,l-=2;break;case HM:for(u>>>=l&7,l-=l&7;l<32;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=dr;break}if(t.length=u&65535,u=0,l=0,t.mode=GE,e===e5)break e;case GE:t.mode=$M;case $M:if(d=t.length,d){if(d>a&&(d=a),d>c&&(d=c),d===0)break e;i.set(n.subarray(s,s+d),o),a-=d,s+=d,c-=d,o+=d,t.length-=d;break}t.mode=Fa;break;case qM:for(;l<14;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(t.nlen=(u&31)+257,u>>>=5,l-=5,t.ndist=(u&31)+1,u>>>=5,l-=5,t.ncode=(u&15)+4,u>>>=4,l-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=dr;break}t.have=0,t.mode=GM;case GM:for(;t.have<t.ncode;){for(;l<3;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.lens[N[t.have++]]=u&7,u>>>=3,l-=3}for(;t.have<19;)t.lens[N[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,I={bits:t.lenbits},x=O1(rpe,t.lens,0,19,t.lencode,0,t.work,I),t.lenbits=I.bits,x){r.msg="invalid code lengths set",t.mode=dr;break}t.have=0,t.mode=jM;case jM:for(;t.have<t.nlen+t.ndist;){for(;b=t.lencode[u&(1<<t.lenbits)-1],v=b>>>24,T=b>>>16&255,p=b&65535,!(v<=l);){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(p<16)u>>>=v,l-=v,t.lens[t.have++]=p;else{if(p===16){for(k=v+2;l<k;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(u>>>=v,l-=v,t.have===0){r.msg="invalid bit length repeat",t.mode=dr;break}_=t.lens[t.have-1],d=3+(u&3),u>>>=2,l-=2}else if(p===17){for(k=v+3;l<k;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,_=0,d=3+(u&7),u>>>=3,l-=3}else{for(k=v+7;l<k;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,_=0,d=11+(u&127),u>>>=7,l-=7}if(t.have+d>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=dr;break}for(;d--;)t.lens[t.have++]=_}}if(t.mode===dr)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=dr;break}if(t.lenbits=9,I={bits:t.lenbits},x=O1(IU,t.lens,0,t.nlen,t.lencode,0,t.work,I),t.lenbits=I.bits,x){r.msg="invalid literal/lengths set",t.mode=dr;break}if(t.distbits=6,t.distcode=t.distdyn,I={bits:t.distbits},x=O1(RU,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,I),t.distbits=I.bits,x){r.msg="invalid distances set",t.mode=dr;break}if(t.mode=t5,e===e5)break e;case t5:t.mode=r5;case r5:if(a>=6&&c>=258){r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=l,Q0e(r,h),o=r.next_out,i=r.output,c=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,t.mode===Fa&&(t.back=-1);break}for(t.back=0;b=t.lencode[u&(1<<t.lenbits)-1],v=b>>>24,T=b>>>16&255,p=b&65535,!(v<=l);){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(T&&!(T&240)){for(g=v,y=T,E=p;b=t.lencode[E+((u&(1<<g+y)-1)>>g)],v=b>>>24,T=b>>>16&255,p=b&65535,!(g+v<=l);){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}u>>>=g,l-=g,t.back+=g}if(u>>>=v,l-=v,t.back+=v,t.length=p,T===0){t.mode=ZM;break}if(T&32){t.back=-1,t.mode=Fa;break}if(T&64){r.msg="invalid literal/length code",t.mode=dr;break}t.extra=T&15,t.mode=WM;case WM:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=YM;case YM:for(;b=t.distcode[u&(1<<t.distbits)-1],v=b>>>24,T=b>>>16&255,p=b&65535,!(v<=l);){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(!(T&240)){for(g=v,y=T,E=p;b=t.distcode[E+((u&(1<<g+y)-1)>>g)],v=b>>>24,T=b>>>16&255,p=b&65535,!(g+v<=l);){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}u>>>=g,l-=g,t.back+=g}if(u>>>=v,l-=v,t.back+=v,T&64){r.msg="invalid distance code",t.mode=dr;break}t.offset=p,t.extra=T&15,t.mode=QM;case QM:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=dr;break}t.mode=XM;case XM:if(c===0)break e;if(d=h-c,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=dr;break}d>t.wnext?(d-=t.wnext,m=t.wsize-d):m=t.wnext-d,d>t.length&&(d=t.length),w=t.window}else w=i,m=o-t.offset,d=t.length;d>c&&(d=c),c-=d,t.length-=d;do i[o++]=w[m++];while(--d);t.length===0&&(t.mode=r5);break;case ZM:if(c===0)break e;i[o++]=t.length,c--,t.mode=r5;break;case jE:if(t.wrap){for(;l<32;){if(a===0)break e;a--,u|=n[s++]<<l,l+=8}if(h-=c,r.total_out+=h,t.total+=h,t.wrap&4&&h&&(r.adler=t.check=t.flags?pn(t.check,i,h,o-h):F1(t.check,i,h,o-h)),h=c,t.wrap&4&&(t.flags?u:tU(u))!==t.check){r.msg="incorrect data check",t.mode=dr;break}u=0,l=0}t.mode=JM;case JM:if(t.wrap&&t.flags){for(;l<32;){if(a===0)break e;a--,u+=n[s++]<<l,l+=8}if(t.wrap&4&&u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=dr;break}u=0,l=0}t.mode=eU;case eU:x=ipe;break e;case dr:x=CU;break e;case kU:return PU;case DU:default:return os}return r.next_out=o,r.avail_out=c,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=l,(t.wsize||h!==r.avail_out&&t.mode<dr&&(t.mode<jE||e!==DM))&&MU(r,r.output,r.next_out,h-r.avail_out),f-=r.avail_in,h-=r.avail_out,r.total_in+=f,r.total_out+=h,t.total+=h,t.wrap&4&&h&&(r.adler=t.check=t.flags?pn(t.check,i,h,r.next_out-h):F1(t.check,i,h,r.next_out-h)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Fa?128:0)+(t.mode===t5||t.mode===GE?256:0),(f===0&&h===0||e===DM)&&x===Kl&&(x=ope),x},mpe=r=>{if($l(r))return os;let e=r.state;return e.window&&(e.window=null),r.state=null,Kl},gpe=(r,e)=>{if($l(r))return os;let t=r.state;return t.wrap&2?(t.head=e,e.done=!1,Kl):os},ype=(r,e)=>{let t=e.length,n,i,s;return $l(r)||(n=r.state,n.wrap!==0&&n.mode!==o5)?os:n.mode===o5&&(i=1,i=F1(i,e,t,0),i!==n.check)?CU:(s=MU(r,e,t,t),s?(n.mode=kU,PU):(n.havedict=1,Kl))},wpe=OU,bpe=LU,_pe=NU,Epe=dpe,vpe=BU,Spe=ppe,xpe=mpe,Tpe=gpe,Ape=ype,Ipe="pako inflate (from Nodeca project)",za={inflateReset:wpe,inflateReset2:bpe,inflateResetKeep:_pe,inflateInit:Epe,inflateInit2:vpe,inflate:Spe,inflateEnd:xpe,inflateGetHeader:Tpe,inflateSetDictionary:Ape,inflateInfo:Ipe};function Rpe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Cpe=Rpe,UU=Object.prototype.toString,{Z_NO_FLUSH:Ppe,Z_FINISH:kpe,Z_OK:K1,Z_STREAM_END:QE,Z_NEED_DICT:XE,Z_STREAM_ERROR:Dpe,Z_DATA_ERROR:nU,Z_MEM_ERROR:Npe}=Hl;function G1(r){this.options=c5.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new TU,this.strm.avail_out=0;let t=za.inflateInit2(this.strm,e.windowBits);if(t!==K1)throw new Error(Vl[t]);if(this.header=new Cpe,za.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=z1.string2buf(e.dictionary):UU.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=za.inflateSetDictionary(this.strm,e.dictionary),t!==K1)))throw new Error(Vl[t])}G1.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?kpe:Ppe,UU.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=za.inflate(t,o),s===XE&&i&&(s=za.inflateSetDictionary(t,i),s===K1?s=za.inflate(t,o):s===nU&&(s=XE));t.avail_in>0&&s===QE&&t.state.wrap>0&&r[t.next_in]!==0;)za.inflateReset(t),s=za.inflate(t,o);switch(s){case Dpe:case nU:case XE:case Npe:return this.onEnd(s),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||s===QE))if(this.options.to==="string"){let c=z1.utf8border(t.output,t.next_out),u=t.next_out-c,l=z1.buf2string(t.output,c);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(c,c+u),0),this.onData(l)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===K1&&a===0)){if(s===QE)return s=za.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};G1.prototype.onData=function(r){this.chunks.push(r)};G1.prototype.onEnd=function(r){r===K1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c5.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function h9(r,e){let t=new G1(e);if(t.push(r),t.err)throw t.msg||Vl[t.err];return t.result}function Ope(r,e){return e=e||{},e.raw=!0,h9(r,e)}var Lpe=G1,Bpe=h9,Mpe=Ope,Upe=h9,Fpe=Hl,Vpe={Inflate:Lpe,inflate:Bpe,inflateRaw:Mpe,ungzip:Upe,constants:Fpe},{Deflate:zpe,deflate:Kpe,deflateRaw:Hpe,gzip:$pe}=W0e,{Inflate:qpe,inflate:Gpe,inflateRaw:jpe,ungzip:Wpe}=Vpe,Ype=zpe,Qpe=Kpe,Xpe=Hpe,Zpe=$pe,Jpe=qpe,e1e=Gpe,t1e=jpe,r1e=Wpe,n1e=Hl,p9={Deflate:Ype,deflate:Qpe,deflateRaw:Xpe,gzip:Zpe,Inflate:Jpe,inflate:e1e,inflateRaw:t1e,ungzip:r1e,constants:n1e};var FU=6;function VU({repo:r,preload:e}){async function*t(n,i={}){if(i.compressionLevel!=null&&(i.compressionLevel<-1||i.compressionLevel>9))throw(0,Eh.default)(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(i.preload!==!1){let a;try{a=Dd(n).split("/")}catch(c){throw(0,Eh.default)(c,"ERR_INVALID_PATH")}e(P.parse(a[0]))}let s=P.asCID(n)||n,o=await Sn(s,r.blocks,i);if(o.type==="file"||o.type==="raw"){let a=[];!i.compress||i.archive===!0?a.push([{header:{name:o.path,mode:o.type==="file"&&o.unixfs.mode,mtime:o.type==="file"&&o.unixfs.mtime?new Date(o.unixfs.mtime.secs*1e3):void 0,size:o.size,type:"file"},body:o.content()}],Xy()):a.push(o.content),i.compress&&a.push(async function*(c){let u=await dh(c);yield p9.gzip(u,{level:i.compressionLevel||FU})}),yield*_e(...a);return}if(o.type==="directory"){let a=[Wy(s,r.blocks,i),async function*(c){for await(let u of c){let l={header:{name:u.path,size:u.size}};if(u.type==="file")l.header.type="file",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0,l.body=u.content();else if(u.type==="raw")l.header.type="file",l.body=u.content();else if(u.type==="directory")l.header.type="directory",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0;else throw(0,Eh.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");yield l}},Xy()];if(i.compress){if(!i.archive)throw(0,Eh.default)(new Error("file is not regular"),"ERR_INVALID_PATH");i.compress&&a.push(async function*(c){let u=await dh(c);yield p9.gzip(u,{level:i.compressionLevel||FU})})}yield*_e(...a);return}throw(0,Eh.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS")}return H(t)}var zU=C(Y(),1);function KU({repo:r,preload:e}){async function*t(n,i={}){let s=Dd(n),o=s.split("/");i.preload!==!1&&e(P.parse(o[0]));let a=P.asCID(s)||s,c=await Sn(a,r.blocks,i);if(c.type==="file"){yield Ob(c);return}if(c.type==="directory"){for await(let u of c.content())yield Ob(u);return}throw(0,zU.default)(new Error(`Unknown UnixFS type ${c.type}`),"ERR_UNKNOWN_UNIXFS_TYPE")}return H(t)}var l5=class{constructor({preload:e,repo:t,hashers:n,options:i}){let s=QB({preload:e,repo:t,options:i,hashers:n});this.addAll=s,this.add=rB({addAll:s}),this.cat=pM({repo:t,preload:e}),this.get=VU({repo:t,preload:e}),this.ls=KU({repo:t,preload:e})}};var ql="0.18.0",HU="",$U="^0.158.0";function qU({repo:r}){async function e(t={}){let n=await r.version.get();return{version:ql,commit:HU,repo:`${n}`,"ipfs-core":ql,"interface-ipfs-core":$U}}return H(e)}var f5=C(Y(),1);var i1e=D("ipfs:components:id");function GU({peerId:r,network:e}){async function t(n={}){let i=e.try();if(!i){if(n.peerId)throw new va;if(r.publicKey==null)throw(0,f5.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:r,publicKey:j(r.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${ql}`,protocolVersion:"9000",protocols:[]}}let{libp2p:s}=i,o=n.peerId?n.peerId:r,a=await s1e(o,s,n),c=j(a.metadata.get("AgentVersion")||new Uint8Array),u=j(a.metadata.get("ProtocolVersion")||new Uint8Array),l=a.id.toString(),f=a.publicKey?j(a.publicKey,"base64pad"):"";return{id:o,publicKey:f,addresses:(a.addresses||[]).map(h=>{let d=h.toString();return d.endsWith(`/p2p/${l}`)?d:`${d}/p2p/${l}`}).sort().map(h=>oe(h)),agentVersion:c,protocolVersion:u,protocols:(a.protocols||[]).sort()}}return H(t)}async function s1e(r,e,t){let n=await e.peerStore.get(r);n||(n=await o1e(r,e,t));let i=r.publicKey?r.publicKey:await e.peerStore.keyBook.get(r);if(i==null)try{i=await e.getPublicKey(r,t)}catch(s){i1e.error("Could not load public key for",r.toString(),s)}return{...n,publicKey:i,metadata:n.metadata||new Map,addresses:n.addresses.map(s=>s.multiaddr)}}async function o1e(r,e,t){if(e.dht==null)throw(0,f5.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(let i of e.dht.findPeer(r,t))if(i.name==="FINAL_PEER")break;let n=await e.peerStore.get(r);if(!n)throw(0,f5.default)(new Error("Could not find peer"),"ERR_NOT_FOUND");return n}var hr=a1e;function a1e(r,e,t){var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(i=n.pop(),!i)return!1;jU(i);for(var s;s=n.shift();)if(jU(s),typeof r[s]>"u"&&(r[s]={}),r=r[s],!r||typeof r!="object")return!1;return r[i]=t,!0}function jU(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}var vh={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:r=>(hr(r,"Discovery.MDNS.Enabled",!1),hr(r,"Discovery.webRTCStar.Enabled",!1),r.Swarm={...r.Swarm||{},DisableNatPortMap:!0},r)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:r=>(hr(r,"Discovery.MDNS.Enabled",!0),hr(r,"Discovery.webRTCStar.Enabled",!0),hr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:r=>{let e=La();return hr(r,"Addresses.API",e.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),hr(r,"Addresses.Gateway",e.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),hr(r,"Addresses.Swarm",e.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),hr(r,"Addresses.Delegates",[]),hr(r,"Bootstrap",[]),hr(r,"Discovery.MDNS.Enabled",!1),hr(r,"Discovery.webRTCStar.Enabled",!1),hr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!0}),r}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:r=>{let e=La();return hr(r,"Addresses.API",e.Addresses.API),hr(r,"Addresses.Gateway",e.Addresses.Gateway),hr(r,"Addresses.Swarm",e.Addresses.Swarm),hr(r,"Addresses.Delegates",e.Addresses.Delegates),hr(r,"Bootstrap",e.Bootstrap),hr(r,"Discovery.MDNS.Enabled",e.Discovery.MDNS.Enabled),hr(r,"Discovery.webRTCStar.Enabled",e.Discovery.webRTCStar.Enabled),hr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:r=>{let e=r.Swarm||{},t=e.ConnMgr||{};return t.LowWater=20,t.HighWater=40,e.ConnMgr=t,r.Swarm=e,r}},"default-power":{description:'Inverse of "lowpower" profile.',transform:r=>{let e=La();return r.Swarm=e.Swarm,r}}};var c1e=D("ipfs:core:config");function WU({repo:r}){return{getAll:H(e),get:H(t),set:H(n),replace:H(i),profiles:{apply:H(s),list:H(u1e)}};async function e(o={}){return r.config.getAll(o)}async function t(o,a){return o?r.config.get(o,a):Promise.reject(new Error("key argument is required"))}async function n(o,a,c){return r.config.set(o,a,c)}async function i(o,a){return r.config.replace(o,a)}async function s(o,a={dryRun:!1}){let{dryRun:c}=a,u=vh[o];if(!u)throw new Error(`No profile with name '${o}' exists`);try{let l=await r.config.getAll(a),f=JSON.parse(JSON.stringify(l));return f=u.transform(f),c||await r.config.replace(f,a),delete l.Identity.PrivKey,delete f.Identity.PrivKey,{original:l,updated:f}}catch(l){throw c1e(l),new Error(`Could not apply profile '${o}' to config: ${l.message}`)}}}async function u1e(r){return Object.keys(vh).map(e=>({name:e,description:vh[e].description}))}function d5({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*l1e(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t],s=P.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*m9(n,i))}else{let t=P.asCID(e);t?yield[r.join("/"),t]:yield*m9(e,r)}}function*m9(r,e){if(r==null||r instanceof Uint8Array)return;let t=P.asCID(r);t&&(yield[e.join("/"),t]);for(let[n,i]of Object.entries(r)){let s=[...e,n];yield*l1e(s,i)}}function*f1e(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t];yield i.join("/"),typeof n=="object"&&!P.asCID(n)&&(yield*g9(n,i))}else yield*g9(e,r)}function*g9(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!P.asCID(n)&&(yield*f1e(i,n))}}function d1e(r,e){let t=r;for(let[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);let s=P.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}var y9=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:d5(),bytes:d5(),value:d5(),asBlock:d5()})}links(){return m9(this.value,[])}tree(){return g9(this.value,[])}get(e="/"){return d1e(this.value,e.split("/").filter(Boolean))}};function Sh({bytes:r,cid:e,value:t,codec:n}){let i=t!==void 0?t:n&&n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new y9({cid:e,bytes:r,value:i})}var w9=C(po(),1);function b9(r){let e=Ep({version:1,roots:r}),t=w9.default.encode(e.length),n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function YU(r){return{async setRoots(e){let t=b9(e);await r.write(t)},async writeBlock(e){let{cid:t,bytes:n}=e;await r.write(new Uint8Array(w9.default.encode(t.bytes.length+n.length))),await r.write(t.bytes),n.length&&await r.write(n)},async close(){await r.end()}}}function h5(){}function QU(){let r=[],e=null,t=h5,n=!1,i=null,s=h5,o=()=>(e||(e=new Promise(u=>{t=()=>{e=null,t=h5,u()}})),e),a={write(u){r.push(u);let l=o();return s(),l},async end(){n=!0;let u=o();s(),await u}},c={async next(){let u=r.shift();return u?(r.length===0&&t(),{done:!1,value:u}):n?(t(),{done:!0,value:void 0}):(i||(i=new Promise(l=>{s=()=>(i=null,s=h5,l(c.next()))})),i)}};return{writer:a,iterator:c}}var fu={Null:r=>r===null,Int:r=>Number.isInteger(r),Float:r=>typeof r=="number"&&Number.isFinite(r),String:r=>typeof r=="string",Bool:r=>typeof r=="boolean",Bytes:r=>r instanceof Uint8Array,Link:r=>!fu.Null(r)&&typeof r=="object"&&r.asCID===r,List:r=>Array.isArray(r),Map:r=>!fu.Null(r)&&typeof r=="object"&&r.asCID!==r&&!fu.List(r)&&!fu.Bytes(r)},xh={Int:fu.Int,"CarHeader > version":r=>xh.Int(r),"CarHeader > roots (anon) > valueType (anon)":fu.Link,"CarHeader > roots (anon)":r=>fu.List(r)&&Array.prototype.every.call(r,xh["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":r=>xh["CarHeader > roots (anon)"](r),CarHeader:r=>{let e=r&&Object.keys(r);return fu.Map(r)&&["version"].every(t=>e.includes(t))&&Object.entries(r).every(([t,n])=>xh["CarHeader > "+t]&&xh["CarHeader > "+t](n))}},XU=xh.CarHeader;var du=C(po(),1),p5={SHA2_256:18,LENGTH:32,DAG_PB:112},ZU=16+8+8+8;function j1(r,e){if(!r.length)throw new Error("Unexpected end of data");let t=du.default.decode(r);return e.seek(du.default.decode.bytes),t}function JU(r){let e=new DataView(r.buffer,r.byteOffset,r.byteLength),t=0;return{version:2,characteristics:[e.getBigUint64(t,!0),e.getBigUint64(t+=8,!0)],dataOffset:Number(e.getBigUint64(t+=8,!0)),dataSize:Number(e.getBigUint64(t+=8,!0)),indexOffset:Number(e.getBigUint64(t+=8,!0))}}function eF(r){du.default.decode(r);let e=du.default.decode.bytes,t=du.default.decode(r.subarray(du.default.decode.bytes)),n=du.default.decode.bytes;return e+n+t}async function m5(r,e){let t=j1(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR header (zero length)");let n=await r.exactly(t,!0),i=ul(n);if(!XU(i))throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||e!==void 0&&i.version!==e)throw new Error(`Invalid CAR version: ${i.version}${e!==void 0?` (expected ${e})`:""}`);let s=Array.isArray(i.roots);if(i.version===1&&!s||i.version===2&&s)throw new Error("Invalid CAR header format");if(i.version===1)return i;let o=JU(await r.exactly(ZU,!0));r.seek(o.dataOffset-r.pos);let a=await m5(r,1);return Object.assign(a,o)}async function h1e(r){let e=await r.exactly(2,!1);if(e[0]===p5.SHA2_256&&e[1]===p5.LENGTH){let o=await r.exactly(34,!0),a=Xt(o);return P.create(0,p5.DAG_PB,a)}let t=j1(await r.upTo(8),r);if(t!==1)throw new Error(`Unexpected CID version (${t})`);let n=j1(await r.upTo(8),r),i=await r.exactly(eF(await r.upTo(8)),!0),s=Xt(i);return P.create(t,n,s)}async function tF(r){let e=r.pos,t=j1(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=r.pos-e;let n=await h1e(r),i=t-Number(r.pos-e);return{cid:n,length:t,blockLength:i}}async function p1e(r){let{cid:e,blockLength:t}=await tF(r);return{bytes:await r.exactly(t,!0),cid:e}}async function m1e(r){let e=r.pos,{cid:t,length:n,blockLength:i}=await tF(r),s={cid:t,length:n,blockLength:i,offset:e,blockOffset:r.pos};return r.seek(s.blockLength),s}function rF(r){let e=(async()=>{let t=await m5(r);if(t.version===2){let n=r.pos-t.dataOffset;r=y1e(r,t.dataSize-n)}return t})();return{header:()=>e,async*blocks(){for(await e;(await r.upTo(8)).length>0;)yield await p1e(r)},async*blocksIndex(){for(await e;(await r.upTo(8)).length>0;)yield await m1e(r)}}}function g5(r){let e=0;return{async upTo(t){return r.subarray(e,e+Math.min(t,r.length-e))},async exactly(t,n=!1){if(t>r.length-e)throw new Error("Unexpected end of data");let i=r.subarray(e,e+t);return n&&(e+=t),i},seek(t){e+=t},get pos(){return e}}}function g1e(r){let e=0,t=0,n=0,i=new Uint8Array(0),s=async o=>{t=i.length-n;let a=[i.subarray(n)];for(;t<o;){let u=await r();if(u==null)break;t<0?u.length>t&&a.push(u.subarray(-t)):a.push(u),t+=u.length}i=new Uint8Array(a.reduce((u,l)=>u+l.length,0));let c=0;for(let u of a)i.set(u,c),c+=u.length;n=0};return{async upTo(o){return i.length-n<o&&await s(o),i.subarray(n,n+Math.min(i.length-n,o))},async exactly(o,a=!1){if(i.length-n<o&&await s(o),i.length-n<o)throw new Error("Unexpected end of data");let c=i.subarray(n,n+o);return a&&(e+=o,n+=o),c},seek(o){e+=o,n+=o},get pos(){return e}}}function nF(r){let e=r[Symbol.asyncIterator]();async function t(){let n=await e.next();return n.done?null:n.value}return g1e(t)}function y1e(r,e){let t=0;return{async upTo(n){let i=await r.upTo(n);return i.length+t>e&&(i=i.subarray(0,e-t)),i},async exactly(n,i=!1){let s=await r.exactly(n,i);if(s.length+t>e)throw new Error("Unexpected end of data");return i&&(t+=n),s},seek(n){t+=n,r.seek(n)},get pos(){return r.pos}}}var Gl=class{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");let t=P.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=w1e(e);let{encoder:t,iterator:n}=iF(),i=new Gl(e,t),s=new y5(n);return{writer:i,out:s}}static createAppender(){let{encoder:e,iterator:t}=iF();e.setRoots=()=>Promise.resolve();let n=new Gl([],e),i=new y5(t);return{writer:n,out:i}}static async updateRootsInBytes(e,t){let n=g5(e);await m5(n);let i=b9(t);if(Number(n.pos)!==i.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${i.length} bytes)`);return e.set(i,0),e}},y5=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}};function iF(){let r=QU(),{writer:e,iterator:t}=r;return{encoder:YU(e),iterator:t}}function w1e(r){if(r===void 0)return[];if(!Array.isArray(r)){let t=P.asCID(r);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}let e=[];for(let t of r){let n=P.asCID(t);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(n)}return e}var _9=async({cid:r,load:e,seen:t})=>{t=t||new Set;let n=r.toString(Te);if(t.has(n))return;let i=await e(r);if(t.add(n),i!==null)for(let[,s]of i.links())await _9({cid:s,load:e,seen:t})};var sF=D("ipfs:components:dag:import"),b1e=[cn,np];function oF({repo:r,preload:e,codecs:t}){async function*n(i,s={}){s.preload!==!1&&e(i);let o=P.asCID(i);if(!o)throw new Error(`Unexpected error converting CID type: ${i}`);sF(`Exporting ${o} as car`);let{writer:a,out:c}=await Gl.create([o]),u=null;(async()=>{try{let l=_1e(r,a,{signal:s.signal,timeout:s.timeout},t);await _9({cid:o,load:l})}catch(l){u=l}finally{a.close()}})();for await(let l of c){if(u)break;yield l}if(u)throw u}return H(n)}function _1e(r,e,t,n){return async i=>{let s=await n.getCodec(i.code);if(!s)throw new Error(`Can't decode links in block with codec 0x${i.code.toString(16)} to form complete DAG`);let o=await r.blocks.get(i,t);return sF(`Adding block ${i} to car`),await e.put({cid:i,bytes:o}),b1e.includes(i.code)?null:Sh({bytes:o,cid:i,codec:s})}}async function Tr(r){for await(let e of r)return e}var aF=C(Y(),1);function cF({codecs:r,repo:e,preload:t}){return H(async function(s,o={}){if(o.preload!==!1&&t(s),o.path){let f=o.localResolve?await Tr(Bc(s,o.path,r,e,o)):await Wt(Bc(s,o.path,r,e,o));if(!f)throw(0,aF.default)(new Error("Not found"),"ERR_NOT_FOUND");return f}let a=await r.getCodec(s.code),c=await e.blocks.get(s,o);return{value:a.decode(c),remainderPath:""}})}var w5=class{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},jl=class extends w5{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await uF(e);return new jl(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await lF(e);return new jl(t,n,i)}},W1=class extends w5{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;let e=this._iterable[Symbol.asyncIterator]();return{async next(){let t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await uF(e);return new W1(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await lF(e);return new W1(t,n,i)}};async function uF(r){if(!(r instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return fF(g5(r))}async function lF(r){if(!r||typeof r[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return fF(nF(r))}async function fF(r){let e=rF(r),{version:t,roots:n}=await e.header();return{version:t,roots:n,iterator:e.blocks()}}var dF=D("ipfs:components:dag:import");function hF({repo:r}){async function*e(t,n={}){let i=await r.gcLock.readLock();try{let s={signal:n.signal,timeout:n.timeout},o=Ks(t),{value:a,done:c}=await o.peek();if(c)return;a&&o.push(a);let u;a instanceof Uint8Array?u=[o]:u=o;for await(let l of u){let f=await E1e(r,s,l);if(n.pinRoots!==!1)for(let h of f){let d="";try{await r.blocks.has(h)?(dF(`Pinning root ${h}`),await r.pins.pinRecursively(h)):d="blockstore: block not found"}catch(m){d=m.message}yield{root:{cid:h,pinErrorMsg:d}}}}}finally{i()}}return H(e)}async function E1e(r,e,t){let n=await jl.fromIterable(t),i=await n.getRoots();return await Rt(r.blocks.putMany(Bt(n,({cid:s,bytes:o})=>(dF(`Import block ${s}`),{key:s,value:o})),{signal:e.signal})),i}function pF({repo:r,codecs:e,hashers:t,preload:n}){async function i(s,o={}){let a=o.pin?await r.gcLock.readLock():null;try{let c=await e.getCodec(o.storeCodec||"dag-cbor");if(!c)throw new Error(`Unknown storeCodec ${o.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(o.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");let m=await e.getCodec(o.inputCodec);if(!m)throw new Error(`Unknown inputCodec ${o.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);s=m.decode(s)}let u=o.version!=null?o.version:1,l=await t.getHasher(o.hashAlg||"sha2-256");if(!l)throw new Error(`Unknown hash algorithm ${o.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);let f=c.encode(s),h=await l.digest(f),d=P.create(u,c.code,h);return await r.blocks.put(d,f,{signal:o.signal}),o.pin&&await r.pins.pinRecursively(d),o.preload!==!1&&n(d),d}finally{a&&a()}}return H(i)}function mF({repo:r,codecs:e,preload:t}){async function n(i,s={}){let{cid:o}=Ia(i);return s.preload!==!1&&t(o),Lc(r,e,i,s)}return H(n)}var b5=class{constructor({repo:e,codecs:t,hashers:n,preload:i}){this.export=oF({repo:e,preload:i,codecs:t}),this.get=cF({codecs:t,repo:e,preload:i}),this.import=hF({repo:e}),this.resolve=mF({repo:e,codecs:t,preload:i}),this.put=pF({repo:e,codecs:t,hashers:n,preload:i})}};var _5=(r,e)=>e,v1e=(r,e,t,n)=>{if(n!=null&&n.assumeHttp===!1)return`tcp://${r}:${e}`;let i="tcp",s=`:${e}`;return t[t.length-1].protocol==="tcp"&&(i=e==="443"?"https":"http",s=e==="443"||e==="80"?"":s),`${i}://${r}${s}`},S1e={ip4:_5,ip6:(r,e,t,n)=>n.length===1&&n[0].protocol==="ip6"?e:`[${e}]`,tcp:(r,e,t,n,i)=>n.some(s=>["http","https","ws","wss"].includes(s.protocol))?`${r}:${e}`:v1e(r,e,n,i),udp:(r,e)=>`udp://${r}:${e}`,dnsaddr:_5,dns4:_5,dns6:_5,ipfs:(r,e)=>`${r}/ipfs/${e}`,p2p:(r,e)=>`${r}/p2p/${e}`,http:r=>`http://${r}`,https:r=>`https://${r}`,ws:r=>`ws://${r}`,wss:r=>`wss://${r}`,"p2p-websocket-star":r=>`${r}/p2p-websocket-star`,"p2p-webrtc-star":r=>`${r}/p2p-webrtc-star`,"p2p-webrtc-direct":r=>`${r}/p2p-webrtc-direct`};function Th(r,e){let t=oe(r),n=t.toString().split("/").slice(1);return t.tuples().map(i=>({protocol:n.shift()??"",content:i[1]!=null?n.shift()??"":""})).reduce((i,s,o,a)=>{let c=S1e[s.protocol];if(c==null)throw new Error(`Unsupported protocol ${s.protocol}`);return c(i,s.content,o,a,e)},"")}function E9(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);r=[...r];for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}var gF=C(Ld(),1);var x1e=D("ipfs:preload"),T1e=Ot.default?Ot.default:Ot,A1e=new T1e({concurrency:4});function yF(r,e={}){return x1e(r),A1e.add(async()=>{let n=(await gF.default.post(r,{signal:e.signal})).body.getReader();try{for(;;){let{done:i}=await n.read();if(i)return}}finally{n.releaseLock()}})}var wF=C(Dp(),1),Y1=D("ipfs:preload");function bF(r={}){if(r.enabled=Boolean(r.enabled),r.addresses=r.addresses||[],r.cache=r.cache||1e3,!r.enabled||!r.addresses.length)return Y1("preload disabled"),Object.assign(()=>{},{start:()=>{},stop:()=>{}});let e=!0,t=[],n=r.addresses.map(o=>Th(o)),i=(0,wF.default)(r.cache),s=async o=>{try{if(e)throw new Error(`preload ${o} but preloader is not started`);let a=o.toString();if(i.has(a))return;i.set(a,!0);let c=E9(n),u=!1,l=Date.now();for(let f of c){if(e)throw new Error(`preload aborted for ${a}`);let h;try{h=new AbortController,t=t.concat(h),await yF(`${f}/api/v0/refs?r=true&arg=${encodeURIComponent(a)}`,{signal:h.signal}),u=!0}catch(d){d.type!=="aborted"&&Y1.error(d)}finally{t=t.filter(d=>d!==h)}if(u)break}Y1(`${u?"":"un"}successfully preloaded ${a} in ${Date.now()-l}ms`)}catch(a){Y1.error(a)}};return s.start=()=>{e=!1},s.stop=()=>{e=!0,Y1(`aborting ${t.length} pending preload request(s)`),t.forEach(o=>o.abort()),t=[]},s}var E5=D("ipfs:mfs-preload");function _F({preload:r,files:e,options:t={}}){if(t.interval=t.interval||30*1e3,!t.enabled){E5("MFS preload disabled");let o=async()=>{};return{start:o,stop:o}}let n="",i,s=async()=>{try{let o=await e.stat("/"),a=o.cid.toString();n!==a&&(E5(`preloading updated MFS root ${n} -> ${o.cid}`),await r(o.cid),n=a)}catch(o){E5.error("failed to preload MFS root",o)}finally{i=setTimeout(s,t.interval)}};return{async start(){let o=await e.stat("/");n=o.cid.toString(),E5(`monitoring MFS root ${o.cid}`),i=setTimeout(s,t.interval)},stop(){clearTimeout(i)}}}var v9=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},S9=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},EF=r=>globalThis.DOMException===void 0?new S9(r):new DOMException(r),vF=r=>{let e=r.reason===void 0?EF("This operation was aborted."):r.reason;return e instanceof Error?e:EF(e)};function Q1(r,e){let{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e,o,a=new Promise((c,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){c(r);return}if(e.signal){let{signal:f}=e;f.aborted&&u(vF(f)),f.addEventListener("abort",()=>{u(vF(f))})}let l=new v9;o=s.setTimeout.call(void 0,()=>{if(n){try{c(n())}catch(f){u(f)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?c():i instanceof Error?u(i):(l.message=i??`Promise timed out after ${t} milliseconds`,u(l))},t),(async()=>{try{c(await r)}catch(f){u(f)}finally{s.clearTimeout.call(void 0,o)}})()});return a.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},a}var x9="lock:worker:request-read",T9="lock:worker:release-read",A9="lock:master:grant-read",I9="lock:worker:request-write",R9="lock:worker:release-write",C9="lock:master:grant-write";var hu={},Ah=r=>{r.addEventListener("message",e=>{Ah.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Ah.dispatchEvent("message",r,e)})};Ah.addEventListener=(r,e)=>{hu[r]==null&&(hu[r]=[]),hu[r].push(e)};Ah.removeEventListener=(r,e)=>{hu[r]!=null&&(hu[r]=hu[r].filter(t=>t===e))};Ah.dispatchEvent=function(r,e,t){hu[r]!=null&&hu[r].forEach(n=>n(e,t))};var P9=Ah;var SF=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{let u=l=>{if(l==null||l.data==null)return;let f={type:l.data.type,name:l.data.name,identifier:l.data.identifier};f.type===n&&f.identifier===a.identifier&&(s.removeEventListener("message",u),c())};s.addEventListener("message",u)}))}}))},xF=(r,e,t,n)=>async()=>{let i=c3();return globalThis.postMessage({type:e,identifier:i,name:r}),await new Promise(s=>{let o=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},I1e={singleProcess:!1},TF=r=>{if(r=Object.assign({},I1e,r),Boolean(globalThis.document)||r.singleProcess){let t=new EventTarget;return P9.addEventListener("message",SF(t,"requestReadLock",x9,T9,A9)),P9.addEventListener("message",SF(t,"requestWriteLock",I9,R9,C9)),t}return{isWorker:!0,readLock:t=>xF(t,x9,A9,T9),writeLock:t=>xF(t,I9,C9,R9)}};var Wl={},pu;async function k9(r,e){let t,n=new Promise(i=>{t=i});return r.add(async()=>await Q1((async()=>await new Promise(i=>{t(()=>{i()})}))(),{milliseconds:e.timeout})),await n}var R1e=(r,e)=>{if(pu.isWorker===!0)return{readLock:pu.readLock(r,e),writeLock:pu.writeLock(r,e)};let t=new Ot({concurrency:1}),n;return{async readLock(){if(n!=null)return await k9(n,e);n=new Ot({concurrency:e.concurrency,autoStart:!1});let i=n,s=k9(n,e);return t.add(async()=>(i.start(),await i.onIdle().then(()=>{n===i&&(n=null)}))),await s},async writeLock(){return n=null,await k9(t,e)}}},C1e={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Yl(r){let e=Object.assign({},C1e,r);return pu==null&&(pu=TF(e),pu.isWorker!==!0&&(pu.addEventListener("requestReadLock",t=>{Wl[t.data.name]!=null&&Wl[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),pu.addEventListener("requestWriteLock",async t=>{Wl[t.data.name]!=null&&Wl[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),Wl[e.name]==null&&(Wl[e.name]=R1e(e.name,e)),Wl[e.name]}var v5;function X1(r=!1){if(v5)return v5;let e=Yl({singleProcess:r});return v5={readLock:t=>async(...n)=>{let i=await e.readLock();try{return await t.apply(null,n)}finally{i()}},writeLock:t=>async(...n)=>{let i=await e.writeLock();try{return await t.apply(null,n)}finally{i()}}},v5}var D9=C(Y(),1);var AF=D("ipfs:mfs:utils:with-mfs-root");async function Ih(r,e){if(e&&e.signal&&e.signal.aborted)throw(0,D9.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.open();let t;try{let n=await r.repo.datastore.get(kp);t=P.decode(n)}catch(n){if(n.code!=="ERR_NOT_FOUND")throw n;AF("Creating new MFS root");let i=ze({Data:new He({type:"directory"}).marshal(),Links:[]}),s=await Pe.digest(i);if(t=P.createV0(s),await r.repo.blocks.put(t,i),e&&e.signal&&e.signal.aborted)throw(0,D9.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.put(kp,t.bytes)}return AF(`Loaded MFS root /ipfs/${t}`),t}function Rh(r=""){return(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}var O9=C(Y(),1);var N9="ipfs",Ar=async(r,e,t)=>{let n=await Ih(r,t),i={entryType:"file"},s="";if(P.asCID(e)?s=`/ipfs/${e}`:s=e.toString(),s=s.trim(),s=s.replace(/(\/\/+)/g,"/"),s.endsWith("/")&&s.length>1&&(s=s.substring(0,s.length-1)),!s)throw(0,O9.default)(new Error("paths must not be empty"),"ERR_NO_PATH");if(s.substring(0,1)!=="/")throw(0,O9.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");s.substring(s.length-1)==="/"&&(s=s.substring(0,s.length-1));let o=Rh(s);if(o[0]===N9){let c;o.length===2?c=`/${o.join("/")}`:c=`/${o.slice(0,o.length-1).join("/")}`,i={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{let c=`/${N9}/${n}${o.length?"/"+o.join("/"):""}`,u=`/${N9}/${n}/${o.slice(0,o.length-1).join("/")}`;i={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:u,mfsPath:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}let a=i.type==="mfs"?i.mfsPath:i.path;try{let c=await Sn(a,r.repo.blocks,t);i.cid=c.cid,i.mfsPath=`/ipfs/${c.path}`,i.entryType=c.type,i.content=c.content,(i.entryType==="file"||i.entryType==="directory")&&(c.type==="file"||c.type==="directory")&&(i.unixfs=c.unixfs)}catch(c){if(c.code!=="ERR_NOT_FOUND")throw c}return i.exists=Boolean(i.cid),i};var RF=C(Y(),1);var P1e=Ve.bind({ignoreUndefined:!0}),k1e=D("ipfs:mfs:stat"),D1e={withLocal:!1};function mu(r){async function e(t,n={}){n=P1e(D1e,n),k1e(`Fetching stats for ${t}`);let{type:i,cid:s,mfsPath:o}=await Ar(r,t,n),a=i==="ipfs"&&s?s:o,c;try{c=await Sn(a,r.repo.blocks)}catch(u){throw u.code==="ERR_NOT_FOUND"?(0,RF.default)(new Error(`${t} does not exist`),"ERR_NOT_FOUND"):u}if(!IF[c.type])throw new Error(`Cannot stat codec ${c.cid.code}`);return IF[c.type](c)}return H(e)}var IF={raw:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:r=>{let e={cid:r.cid,type:"file",size:r.unixfs.fileSize(),cumulativeSize:ze(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},directory:r=>{let e={cid:r.cid,type:"directory",size:0,cumulativeSize:ze(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},object:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})};var Nh=C(Y(),1);var N1e=D("ipfs:mfs:utils:to-trail");async function No(r,e){N1e(`Creating trail for path ${e}`);let t=[];for await(let n of OE(e,r.repo.blocks))t.push({name:n.name,cid:n.cid,size:n.size,type:n.type});return t}var S5=async(r,e,t)=>{t.codec||(t.codec=mt),t.hasher||(t.hasher=Pe),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===mt&&t.hasher!==Pe&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=P.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i};var x5=Ol.code,T5=8;async function A5(r){return(await Ol.encode(r)).subarray(0,8).reverse()}var L9=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},Ch=class extends L9{constructor(e,t){super(e,t),this._bucket=iu({hashFn:A5,bits:T5})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*CF(this._bucket,e,this,this.options)}};async function*CF(r,e,t,n){let i=r._children,s=[],o=0;for(let d=0;d<i.length;d++){let m=i.get(d);if(!m)continue;let w=d.toString(16).toUpperCase().padStart(2,"0");if(m instanceof Er){let b;for await(let v of await CF(m,e,null,n))b=v;if(!b)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:w,Tsize:b.size,Hash:b.cid}),o+=b.size}else if(typeof m.value.flush=="function"){let b=m.value,v;for await(let p of b.flush(e))v=p,yield v;let T=w+m.key;s.push({Name:T,Tsize:v.size,Hash:v.cid}),o+=v.size}else{let b=m.value;if(!b.cid)continue;let v=w+m.key,T=b.size;s.push({Name:v,Tsize:T,Hash:b.cid}),o+=T}}let a=Uint8Array.from(i.bitField().reverse()),u={Data:new He({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:x5,mtime:t&&t.mtime,mode:t&&t.mode}).marshal(),Links:s},l=ze(on(u)),f=await S5(l,e,n),h=l.length+o;yield{cid:f,node:u,size:h}}var Z1=D("ipfs:mfs:core:utils:hamt-utils"),Ph=async(r,e,t,n)=>{if(!n.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");let i=Uint8Array.from(t._children.bitField().reverse()),s=He.unmarshal(n.parent.Data),o=new He({type:"hamt-sharded-directory",data:i,fanout:t.tableSize(),hashType:x5,mode:s.mode,mtime:s.mtime}),a=await r.hashers.getHasher(n.hashAlg),c={Data:o.marshal(),Links:e.sort((h,d)=>(h.Name||"").localeCompare(d.Name||""))},u=ze(c),l=await a.digest(u),f=P.create(n.cidVersion,Xe,l);return n.flush&&await r.repo.blocks.put(f,u),{node:c,cid:f,size:e.reduce((h,d)=>h+(d.Tsize||0),u.length)}},B9=async(r,e,t,n,i)=>{let s=new Er({hash:t._options.hash,bits:t._options.bits},n,i);return n._putObjectAt(i,s),await J1(r,e,s,t),s},M9=async r=>{let e=iu({hashFn:A5,bits:T5});return await Promise.all(r.map(async t=>{let n=t.Name||"";if(n.length===2){let i=parseInt(n,16),s=new Er({hash:e._options.hash,bits:e._options.bits},e,i);return e._putObjectAt(i,s),Promise.resolve()}return e.put(n.substring(2),{size:t.Tsize,cid:t.Hash})})),e},J1=async(r,e,t,n)=>{await Promise.all(e.map(async i=>{let s=i.Name||"";if(s.length===2){Z1("Populating sub bucket",s);let o=parseInt(s,16),a=await r.repo.blocks.get(i.Hash),c=pt(a),u=new Er({hash:n._options.hash,bits:n._options.bits},t,o);return t._putObjectAt(o,u),await J1(r,c.Links,u,n),Promise.resolve()}return n.put(s.substring(2),{size:i.Tsize,cid:i.Hash})}))},Ql=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),PF=async(r,e,t)=>{let n=await M9(t.Links),i=await n._findNewBucketAndPos(e),s=[{bucket:i.bucket,prefix:Ql(i.pos)}],o=i.bucket;for(;o!==n;)s.push({bucket:o,prefix:Ql(o._posAtParent)}),o=o._parent;s.reverse(),s[0].node=t;for(let a=0;a<s.length;a++){let c=s[a];if(!c.node)throw new Error("Could not generate HAMT path");let u=c.node.Links.filter(d=>(d.Name||"").substring(0,2)===c.prefix).pop();if(!u){Z1(`Link ${c.prefix}${e} will be added`);continue}if(u.Name===`${c.prefix}${e}`){Z1(`Link ${c.prefix}${e} will be replaced`);continue}Z1(`Found subshard ${c.prefix}`);let l=await r.repo.blocks.get(u.Hash),f=pt(l);if(!s[a+1]){Z1(`Loaded new subshard ${c.prefix}`),await B9(r,f.Links,n,c.bucket,parseInt(c.prefix,16));let d=await n._findNewBucketAndPos(e);s.push({bucket:d.bucket,prefix:Ql(d.pos),node:f});continue}let h=s[a+1];await J1(r,f.Links,h.bucket,n),h.node=f}return await n.put(e,!0),s.reverse(),{rootBucket:n,path:s}},kF=async(r,e,t={})=>{let n=new Ch({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let s=0;s<e.length;s++)await n._bucket.put(e[s].name,{size:e[s].size,cid:e[s].cid});let i=await Wt(n.flush(r.repo.blocks));if(!i)throw new Error("Flushing shard yielded no result");return i};var Oo=C(Y(),1);var Lo=D("ipfs:mfs:core:utils:add-link");async function as(r,e){let t=e.parent;if(e.parentCid){let i=P.asCID(e.parentCid);if(i===null)throw(0,Oo.default)(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(i.code!==Xe)throw(0,Oo.default)(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");Lo(`Loading parent node ${i}`);let s=await r.repo.blocks.get(i);t=pt(s)}if(!t)throw(0,Oo.default)(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!e.cid)throw(0,Oo.default)(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!e.name)throw(0,Oo.default)(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!e.size&&e.size!==0)throw(0,Oo.default)(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!t.Data)throw(0,Oo.default)(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");let n=He.unmarshal(t.Data);return n.type==="hamt-sharded-directory"?(Lo("Adding link to sharded directory"),B1e(r,{...e,parent:t})):t.Links.length>=e.shardSplitThreshold?(Lo("Converting directory to sharded directory"),O1e(r,{...e,parent:t,mtime:n.mtime,mode:n.mode})):(Lo(`Adding ${e.name} (${e.cid}) to regular directory`),L1e(r,{...e,parent:t}))}var O1e=async(r,e)=>{let t=await kF(r,e.parent.Links.map(n=>({name:n.Name||"",size:n.Tsize||0,cid:n.Hash})).concat({name:e.name,size:e.size,cid:e.cid}),e);return Lo(`Converted directory to sharded directory ${t.cid}`),t},L1e=async(r,e)=>{let t=e.parent.Links.filter(u=>u.Name!==e.name);if(t.push({Name:e.name,Tsize:e.size,Hash:e.cid}),!e.parent.Data)throw(0,Oo.default)(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");let n=He.unmarshal(e.parent.Data),i;if(n.mtime){let u=Date.now(),l=Math.floor(u/1e3);n.mtime={secs:l,nsecs:(u-l*1e3)*1e3},i=n.marshal()}else i=e.parent.Data;e.parent=on({Data:i,Links:t});let s=await r.hashers.getHasher(e.hashAlg),o=ze(e.parent),a=await s.digest(o),c=P.create(e.cidVersion,Xe,a);return e.flush&&await r.repo.blocks.put(c,o),{node:e.parent,cid:c,size:o.length}},B1e=async(r,e)=>{let{shard:t,path:n}=await M1e(r,e),i=await Wt(t.flush(r.repo.blocks));if(!i)throw new Error("No result from flushing shard");let s=await r.repo.blocks.get(i.cid),o=pt(s),a=e.parent.Links.filter(u=>(u.Name||"").substring(0,2)!==n[0].prefix),c=o.Links.find(u=>(u.Name||"").substring(0,2)===n[0].prefix);if(!c)throw new Error(`No link found with prefix ${n[0].prefix}`);return a.push(c),Ph(r,a,n[0].bucket,e)},M1e=async(r,e)=>{let t={name:e.name,cid:e.cid,size:e.size};if(!e.parent.Data)throw(0,Oo.default)(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");let n=await M9(e.parent.Links),i=He.unmarshal(e.parent.Data),s=new Ch({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:i.mode},e);s._bucket=n,i.mtime&&(s.mtime={secs:Math.round(Date.now()/1e3)});let o=await n._findNewBucketAndPos(t.name),a=U1e(o);a[0].node=e.parent;let c=0;for(;c<a.length;){let u=a[c];c++;let l=u.node;if(!l)throw new Error("Segment had no node");let f=l.Links.find(w=>(w.Name||"").substring(0,2)===u.prefix);if(!f){Lo(`Link ${u.prefix}${t.name} will be added`),c=a.length;break}if(f.Name===`${u.prefix}${t.name}`){Lo(`Link ${u.prefix}${t.name} will be replaced`),c=a.length;break}if((f.Name||"").length>2){Lo(`Link ${f.Name} ${f.Hash} will be replaced with a subshard`),c=a.length;break}Lo(`Found subshard ${u.prefix}`);let h=await r.repo.blocks.get(f.Hash),d=pt(h);if(!a[c]){Lo(`Loaded new subshard ${u.prefix}`),await B9(r,d.Links,n,u.bucket,parseInt(u.prefix,16));let w=await n._findNewBucketAndPos(t.name);a.push({bucket:w.bucket,prefix:Ql(w.pos),node:d});break}let m=a[c];await J1(r,d.Links,m.bucket,n),m.node=d}return await s._bucket.put(t.name,{size:t.size,cid:t.cid}),{shard:s,path:a}},U1e=r=>{let e=[{bucket:r.bucket,prefix:Ql(r.pos)}],t=r.bucket._parent,n=r.bucket._posAtParent;for(;t;)e.push({bucket:t,prefix:Ql(n)}),n=t._posAtParent,t=t._parent;return e.reverse(),e};var DF=D("ipfs:mfs:utils:update-tree"),F1e={shardSplitThreshold:1e3};async function Ci(r,e,t){t=Object.assign({},F1e,t),DF("Trail",e),e=e.slice().reverse();let n=0,i;for await(let o of r.repo.blocks.getMany(e.map(a=>a.cid))){let a=pt(o),c=e[n].cid,u=e[n].name;if(n++,!i){i={cid:c,name:u,size:o.length};continue}let l=await as(r,{parent:a,name:i.name,cid:i.cid,size:i.size,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold,hashAlg:t.hashAlg,cidVersion:t.cidVersion});i={cid:l.cid,name:u,size:l.size}}let{cid:s}=i;return DF(`Final CID ${s}`),s}var NF=C(Y(),1),V1e=D("ipfs:mfs:utils:update-mfs-root");async function Pi(r,e,t){if(t&&t.signal&&t.signal.aborted)throw(0,NF.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return V1e(`New MFS root will be ${e}`),await r.repo.datastore.put(kp,e.bytes),e}var Xl=C(Y(),1);async function OF(r,e,t){let n=new He({type:e,mode:t.mode,mtime:t.mtime}),i=await r.hashers.getHasher(t.hashAlg),s={Data:n.marshal(),Links:[]},o=ze(s),a=await i.digest(o),c=P.create(t.cidVersion,Xe,a);return t.flush&&await r.repo.blocks.put(c,o),{cid:c,node:s}}var z1e=Ve.bind({ignoreUndefined:!0}),LF=D("ipfs:mfs:mkdir"),K1e={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function Zl(r){async function e(t,n={}){let i=z1e(K1e,n);if(!t)throw new Error("no path given to Mkdir");if(t=t.trim(),t==="/"){if(i.parents)return;throw(0,Xl.default)(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if(t.substring(0,1)!=="/")throw(0,Xl.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");LF(`Creating ${t}`);let s=Rh(t);if(s[0]==="ipfs")throw(0,Xl.default)(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");let o=await Ih(r,i),a,c=[],u=await OF(r,"directory",i);for(let f=0;f<=s.length;f++){let h=s.slice(0,f),d=`/ipfs/${o}/${h.join("/")}`;try{if(a=await Sn(d,r.repo.blocks),a.type!=="file"&&a.type!=="directory")throw(0,Xl.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(f===s.length){if(i.parents)return;throw(0,Xl.default)(new Error("file already exists"),"ERR_ALREADY_EXISTS")}c.push({name:a.name,cid:a.cid})}catch(m){if(m.code==="ERR_NOT_FOUND"){if(f<s.length&&!i.parents)throw(0,Xl.default)(new Error(`Intermediate directory path ${d} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await H1e(r,h[h.length-1],u,c[c.length-1],c,i)}else throw m}}let l=await Ci(r,c,i);await Pi(r,l,i)}return H(e)}var H1e=async(r,e,t,n,i,s)=>{LF(`Adding empty dir called ${e} to ${n.cid}`);let o=await as(r,{parent:n.node,parentCid:n.cid,size:0,cid:t.cid,name:e,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});i[i.length-1].cid=o.cid,i.push({name:e,cid:t.cid})};var gu=C(Y(),1);var $1e=Ve.bind({ignoreUndefined:!0}),I5=D("ipfs:mfs:cp"),q1e={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function kh(r){async function e(t,n,i={}){let s=$1e(q1e,i);Array.isArray(t)||(t=[t]);let o=await Promise.all(t.map(h=>Ar(r,h,s))),a=await Ar(r,n,s);if(!o.length||!a)throw(0,gu.default)(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");let c=o.find(h=>!h.exists);if(c)throw(0,gu.default)(new Error(`${c.path} does not exist`),"ERR_INVALID_PARAMS");let u=BF(a);if(a.exists){if(I5("Destination exists"),o.length===1&&!u)throw(0,gu.default)(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(I5("Destination does not exist"),o.length>1){if(!s.parents)throw(0,gu.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Zl(r)(a.path,s),a=await Ar(r,a.path,s)}else if(a.parts.length>1){let h=`/${a.parts.slice(0,-1).join("/")}`;try{await mu(r)(h,s)}catch(d){if(d.code!=="ERR_NOT_FOUND")throw d;if(!s.parents)throw(0,gu.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Zl(r)(h,s),a=await Ar(r,a.path,s)}}let l=BF(a)?a.mfsPath:a.mfsDirectory,f=await No(r,l);if(o.length===1){let h=o.pop();if(!h)throw(0,gu.default)(new Error("could not find source"),"ERR_INVALID_PARAMS");let d=u?h.name:a.name;return I5(`Only one source, copying to destination ${u?"directory":"file"} ${d}`),G1e(r,h,d,f,s)}return I5("Multiple sources, wrapping in a directory"),j1e(r,o,a,f,s)}return H(e)}var BF=r=>r.unixfs&&r.unixfs.type&&r.unixfs.type.includes("directory"),G1e=async(r,e,t,n,i)=>{let s=n.pop();if(!s)throw(0,gu.default)(new Error("destination had no parent"),"ERR_INVALID_PARAMS");s=await MF(r,e,t,s,i),n.push(s);let o=await Ci(r,n,i);await Pi(r,o,i)},j1e=async(r,e,t,n,i)=>{for(let o=0;o<e.length;o++){let a=e[o];t=await MF(r,a,a.name,t,i)}n[n.length-1]=t;let s=await Ci(r,n,i);await Pi(r,s,i)},MF=async(r,e,t,n,i)=>{let s=await r.repo.blocks.get(e.cid),{node:o,cid:a,size:c}=await as(r,{parentCid:n.cid,size:s.length,cid:e.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});return n.node=o,n.cid=a,n.size=c,n};var em=C(Y(),1);var yu=C(Y(),1),wu=D("ipfs:mfs:core:utils:remove-link");async function UF(r,e){let t=e.parent;if(e.parentCid){let i=P.asCID(e.parentCid);if(i===null)throw(0,yu.default)(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");wu(`Loading parent node ${i}`);let s=await r.repo.blocks.get(i);t=pt(s)}if(!t)throw(0,yu.default)(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!e.name)throw(0,yu.default)(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!t.Data)throw(0,yu.default)(new Error("Parent node had no data"),"ERR_INVALID_NODE");return He.unmarshal(t.Data).type==="hamt-sharded-directory"?(wu(`Removing ${e.name} from sharded directory`),Y1e(r,{...e,parent:t})):(wu(`Removing link ${e.name} regular directory`),W1e(r,{...e,parent:t}))}var W1e=async(r,e)=>{e.parent.Links=e.parent.Links.filter(o=>o.Name!==e.name);let t=await ze(e.parent),i=await(await r.hashers.getHasher(e.hashAlg)).digest(t),s=P.create(e.cidVersion,Xe,i);return await r.repo.blocks.put(s,t),wu(`Updated regular directory ${s}`),{node:e.parent,cid:s}},Y1e=async(r,e)=>{let{rootBucket:t,path:n}=await PF(r,e.name,e.parent);await t.del(e.name);let{node:i}=await FF(r,n,e.name,e);return Ph(r,i.Links,t,e)},FF=async(r,e,t,n)=>{let i=e.pop();if(!i)throw(0,yu.default)(new Error("Could not find parent"),"EINVALIDPARENT");let{bucket:s,prefix:o,node:a}=i;if(!a)throw(0,yu.default)(new Error("Could not find parent"),"EINVALIDPARENT");let c=a.Links.find(d=>(d.Name||"").substring(0,2)===o);if(!c)throw(0,yu.default)(new Error(`No link found with prefix ${o} for file ${t}`),"ERR_NOT_FOUND");if(c.Name===`${o}${t}`){wu(`Removing existing link ${c.Name}`);let d=a.Links.filter(m=>m.Name!==c.Name);return await s.del(t),Ph(r,d,s,n)}wu(`Descending into sub-shard ${c.Name} for ${o}${t}`);let u=await FF(r,e,t,n),l=u.cid,f=u.size,h=o;if(u.node.Links.length===1){wu(`Removing subshard for ${o}`);let d=u.node.Links[0];h=`${o}${(d.Name||"").substring(2)}`,l=d.Hash,f=d.Tsize||0}return wu(`Updating shard ${o} with name ${h}`),Q1e(r,s,a,o,h,f,l,n)},Q1e=(r,e,t,n,i,s,o,a)=>{let c=t.Links.filter(u=>u.Name!==n);return c.push({Name:i,Tsize:s,Hash:o}),Ph(r,c,e,a)};var X1e=Ve.bind({ignoreUndefined:!0}),Z1e={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function Dh(r){async function e(t,n={}){let i=X1e(Z1e,n);Array.isArray(t)||(t=[t]);let s=await Promise.all(t.map(o=>Ar(r,o,i)));if(!s.length)throw(0,em.default)(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");s.forEach(o=>{if(o.path==="/")throw(0,em.default)(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")});for(let o of s)await J1e(r,o.path,i)}return H(e)}var J1e=async(r,e,t)=>{let n=await Ar(r,e,t),i=await No(r,n.mfsPath),s=i[i.length-1];i.pop();let o=i[i.length-1];if(!o)throw(0,em.default)(new Error(`${e} does not exist`),"ERR_NOT_FOUND");if(s.type==="directory"&&!t.recursive)throw(0,em.default)(new Error(`${e} is a directory, use -r to remove directories`),"ERR_WAS_DIR");let{cid:a}=await UF(r,{parentCid:o.cid,name:s.name,hashAlg:t.hashAlg,cidVersion:t.cidVersion,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold});o.cid=a;let c=await Ci(r,i,t);await Pi(r,c,t)};var eme=Ve.bind({ignoreUndefined:!0}),tme=D("ipfs:mfs:touch"),VF={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function rme(r,e,t){let n=0;return(r.includes("x")||r.includes("X")&&(t||e&1||e&8||e&64))&&(n+=1),r.includes("w")&&(n+=2),r.includes("r")&&(n+=4),n}function nme(r,e){let t=0;return r.includes("u")&&(t+=e<<6),r.includes("g")&&(t+=e<<3),r.includes("o")&&(t+=e),t}function ime(r,e,t){return e.includes("t")&&(t+=parseInt("1000",8)),e.includes("s")&&(r.includes("u")&&(t+=parseInt("4000",8)),r.includes("g")&&(t+=parseInt("2000",8))),t}function sme(r,e,t){e||(e=0);let n=r.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error(`Invalid file mode: ${r}`);let[,i,s,o]=n;(i==="a"||!i)&&(i="ugo");let a=rme(o,e,t);return a=nme(i,a),a=ime(i,o,a),s==="="?(i.includes("u")&&(e=e&parseInt("7077",8),e=e|a),i.includes("g")&&(e=e&parseInt("7707",8),e=e|a),i.includes("o")&&(e=e&parseInt("7770",8),e=e|a),e):s==="+"?a|e:s==="-"?a^e:e}function zF(r,e){if(r instanceof String||typeof r=="string"){let t=`${r}`;t.match(/^\d+$/g)?r=parseInt(t,8):r=0+t.split(",").reduce((n,i)=>sme(i,n,e.isDirectory()),e.mode||0)}return r}function KF(r){async function e(t,n,i={}){let s=eme(VF,i);tme(`Fetching stats for ${t}`);let{cid:o,mfsDirectory:a,name:c}=await Ar(r,t,s);if(o.code!==Xe)throw(0,Nh.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(s.recursive){let x=await _e(async function*(){for await(let S of Wy(o,r.repo.blocks)){if(S.type!=="file"&&S.type!=="directory")throw(0,Nh.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");S.unixfs.mode=zF(n,S.unixfs);let I=on({Data:S.unixfs.marshal(),Links:S.node.Links});yield{path:S.path,content:I}}},S=>lh(S,r.repo.blocks,{...s,pin:!1,dagBuilder:async function*(I,k,N){for await(let L of I)yield async function(){let G=L.content,R=ze(G),K=await S5(R,k,N);if(!G.Data)throw(0,Nh.default)(new Error(`${K} had no data`),"ERR_INVALID_NODE");let F=He.unmarshal(G.Data);return{cid:K,size:R.length,path:L.path,unixfs:F}}}}),S=>Wt(S));if(!x)throw(0,Nh.default)(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");await Dh(r)(t,s),await kh(r)(`/ipfs/${x.cid}`,t,s);return}let u=await r.repo.blocks.get(o),l=pt(u);if(!l.Data)throw(0,Nh.default)(new Error(`${o} had no data`),"ERR_INVALID_NODE");let f=He.unmarshal(l.Data);f.mode=zF(n,f);let h=ze({Data:f.marshal(),Links:l.Links}),d=s.hashAlg||VF.hashAlg,w=await(await r.hashers.getHasher(d)).digest(h),b=P.create(s.cidVersion,Xe,w);s.flush&&await r.repo.blocks.put(b,h);let v=await No(r,a),T=v[v.length-1],p=P.decode(T.cid.bytes),g=await r.repo.blocks.get(p),y=pt(g),E=await as(r,{parent:y,name:c,cid:b,size:h.length,flush:s.flush,hashAlg:d,cidVersion:o.version,shardSplitThreshold:1/0});T.cid=E.cid;let _=await Ci(r,v,s);await Pi(r,_,s)}return H(e)}var ome=Ve.bind({ignoreUndefined:!0}),ame={};function HF(r){async function e(t,n={}){n=ome(ame,n);let{cid:i}=await mu(r)(t,n);return i}return H(e)}var cme=Ve.bind({ignoreUndefined:!0}),ume={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function $F(r){async function e(t,n,i={}){let s=cme(ume,i);await kh(r)(t,n,s),await Dh(r)(t,{...s,recursive:!0})}return H(e)}var U9=C(Y(),1);var lme=Ve.bind({ignoreUndefined:!0}),fme=D("ipfs:mfs:touch"),qF={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function GF(r){async function e(t,n={}){let i=lme(qF,n);i.mtime=i.mtime||new Date,fme(`Touching ${t} mtime: ${i.mtime}`);let{cid:s,mfsDirectory:o,name:a,exists:c}=await Ar(r,t,i),u=n.hashAlg||qF.hashAlg,l=await r.hashers.getHasher(u),f,h,d=i.cidVersion;if(c){if(s.code!==Xe)throw(0,U9.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=s.version;let y=await r.repo.blocks.get(s),E=pt(y);if(!E.Data)throw(0,U9.default)(new Error(`${t} had no data`),"ERR_INVALID_NODE");let _=He.unmarshal(E.Data);_.mtime=i.mtime,f=ze({Data:_.marshal(),Links:E.Links});let x=await l.digest(f);h=P.create(i.cidVersion,Xe,x),i.flush&&await r.repo.blocks.put(h,f)}else{let y=new He({type:"file",mtime:i.mtime});f=ze({Data:y.marshal(),Links:[]});let E=await l.digest(f);h=P.create(i.cidVersion,Xe,E),i.flush&&await r.repo.blocks.put(h,f)}let m=await No(r,o),w=m[m.length-1],b=w.cid,v=await r.repo.blocks.get(b),T=pt(v),p=await as(r,{parent:T,name:a,cid:h,size:f.length,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:d});w.cid=p.cid;let g=await Ci(r,m,i);await Pi(r,g,i)}return H(e)}var F9=C(Y(),1);var dme=Ve.bind({ignoreUndefined:!0}),hme={offset:0,length:1/0};function jF(r){function e(t,n={}){return n=dme(hme,n),{[Symbol.asyncIterator]:async function*(){let s=await Ar(r,t,n),o=await Sn(s.mfsPath,r.repo.blocks);if(o.type!=="file"&&o.type!=="raw")throw(0,F9.default)(new Error(`${t} was not a file or raw bytes`),"ERR_NOT_FILE");if(!o.content)throw(0,F9.default)(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(let a of o.content({offset:n.offset,length:n.length}))yield a}}}return H(e)}var V9=C(Y(),1);var tm=D("ipfs:mfs:utils:to-async-iterator");function WF(r){if(!r)throw(0,V9.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if((typeof r=="string"||r instanceof String)&&(tm("Content was a string"),r=W(r.toString())),r.length)return tm("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield r}};if(r[Symbol.asyncIterator])return tm("Content was an async iterator"),r;if(r[Symbol.iterator])return tm("Content was an iterator"),r;if(globalThis.Blob&&r instanceof globalThis.Blob)return tm("Content was an HTML5 Blob"),ai(r.stream());throw(0,V9.default)(new Error(`Don't know how to convert ${r} into an async iterator`),"ERR_INVALID_PARAMS")}var Mo=C(Y(),1);var pme=Ve.bind({ignoreUndefined:!0}),Bo=D("ipfs:mfs:write"),mme={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(r,e)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function QF(r){async function e(t,n,i={}){let s=pme(mme,i),o,a,c;if(Bo("Reading source, destination and parent"),await X1().readLock(async()=>{o=await WF(n),a=await Ar(r,t,s),c=await Ar(r,a.mfsDirectory,s)})(),Bo("Read source, destination and parent"),!s.parents&&!c.exists)throw(0,Mo.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(o==null)throw(0,Mo.default)(new Error("could not create source"),"ERR_NO_SOURCE");if(a==null)throw(0,Mo.default)(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!s.create&&!a.exists)throw(0,Mo.default)(new Error("file does not exist"),"ERR_NO_EXIST");if(a.entryType!=="file")throw(0,Mo.default)(new Error("not a file"),"ERR_NOT_A_FILE");return gme(r,t,o,a,s)}return H(e)}var gme=async(r,e,t,n,i)=>{let s=await yme(r,t,n,i);await X1().writeLock(async()=>{let o=Rh(e),a=o.pop();if(a==null)throw(0,Mo.default)(new Error("source does not exist"),"ERR_NO_EXIST");let c=!1;try{await mu(r)(`/${o.join("/")}`,i),c=!0}catch(b){if(b.code!=="ERR_NOT_FOUND")throw b}c||await Zl(r)(`/${o.join("/")}`,i);let u=await Ar(r,e,i),l=await No(r,u.mfsDirectory),f=l[l.length-1];if(!f)throw(0,Mo.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(!f.type||!f.type.includes("directory"))throw(0,Mo.default)(new Error(`cannot write to ${f.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");let h=await r.repo.blocks.get(f.cid),d=pt(h),m=await as(r,{parent:d,name:a,cid:s.cid,size:s.size,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:i.cidVersion});f.cid=m.cid;let w=await Ci(r,l,i);await Pi(r,w,i)})()},yme=async(r,e,t,n)=>{t.exists?Bo(`Overwriting file ${t.cid} offset ${n.offset} length ${n.length}`):Bo(`Writing file offset ${n.offset} length ${n.length}`);let i=[];if(n.offset>0)if(t.unixfs){if(Bo(`Writing first ${n.offset} bytes of original file`),i.push(()=>t.content({offset:0,length:n.offset})),t.unixfs.fileSize()<n.offset){let l=n.offset-t.unixfs.fileSize();Bo(`Writing zeros for extra ${l} bytes`),i.push(YF(l))}}else Bo(`Writing zeros for first ${n.offset} bytes`),i.push(YF(n.offset));i.push(XF(e,n.length));let s=bme(wme(i),l=>{if(t.unixfs&&!n.truncate){let f=t.unixfs.fileSize();if(f>l)return Bo(`Writing last ${f-l} of ${f} bytes from original file starting at offset ${l}`),t.content({offset:l});Bo("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}),o;n.mode!==void 0&&n.mode!==null?o=ya(n.mode):t&&t.unixfs&&(o=t.unixfs.mode);let a;n.mtime!=null?a=Rc(n.mtime):t&&t.unixfs&&(a=t.unixfs.mtime);let c=await r.hashers.getHasher(n.hashAlg),u=await Wt(lh([{content:s,mode:o,mtime:a}],r.repo.blocks,{progress:n.progress,hasher:c,cidVersion:n.cidVersion,strategy:n.strategy,rawLeaves:n.rawLeaves,reduceSingleLeafToSelf:n.reduceSingleLeafToSelf,leafType:n.leafType}));if(!u)throw(0,Mo.default)(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return Bo(`Wrote ${u.cid}`),{cid:u.cid,size:u.size}},XF=(r,e)=>async function*(){let n=0;for await(let i of r){if(n+=i.length,n>e){yield i.subarray(0,e-n);return}yield i}},YF=(r,e=Ik)=>{let t=new Uint8Array(e);async function*n(){for(;;)yield t}return XF(n(),r)},wme=async function*(r){for(let e=0;e<r.length;e++)yield*r[e]()},bme=async function*(r,e){let t=0;for await(let n of r)t+=n.length,yield n;for await(let n of e(t))t+=n.length,yield n};var ZF=r=>{let e={cid:r.cid,name:r.name,type:r.type==="directory"?"directory":"file",size:r.size};return(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,e.mtime=r.unixfs.mtime),e};function JF(r){async function*e(t,n={}){let i=await Ar(r,t,n),s=await Sn(i.mfsPath,r.repo.blocks);if(s.type==="directory"){yield*Bt(s.content(n),ZF);return}yield ZF(s)}return H(e)}var _me={stat:mu},Eme={chmod:KF,cp:kh,flush:HF,mkdir:Zl,mv:$F,rm:Dh,touch:GF},eV={write:QF,read:jF,ls:JF},tV=({options:r,mfs:e,operations:t,lock:n})=>{Object.keys(t).forEach(i=>{e[i]=n(t[i](r))})},vme={repoOwner:!0,repo:null};function Sme(r){let{repoOwner:e}=Object.assign({},vme||{},r),t=X1(e),n=o=>t.readLock(o),i=o=>t.writeLock(o),s={};return tV({options:r,mfs:s,operations:_me,lock:n}),tV({options:r,mfs:s,operations:Eme,lock:i}),Object.keys(eV).forEach(o=>{s[o]=eV[o](r)}),s}function rV({repo:r,preload:e,hashers:t,options:n}){let i=Sme({repo:r,repoOwner:n.repoOwner!==!1,hashers:t}),s=o=>(...c)=>{let u=c.filter(l=>_k(l)||i3(l));if(u.length){let l=c[c.length-1];l&&l.preload!==!1&&u.forEach(f=>e(f))}return o(...c)};return{...i,chmod:i.chmod,cp:s(i.cp),mkdir:i.mkdir,stat:s(i.stat),rm:i.rm,read:s(i.read),touch:i.touch,write:i.write,mv:s(i.mv),flush:i.flush,ls:s(async function*(...o){for await(let a of i.ls(...o))yield{...a,size:a.size||0}})}}function nV({keychain:r}){return H((t,n)=>r.exportKey(t,n))}var iV="Ed25519",sV=2048;function oV({keychain:r}){return H((t,n={type:iV,size:sV})=>r.createKey(t,n.type||iV,n.size||sV))}function aV({keychain:r}){return H((t,n,i)=>r.importKey(t,n,i))}function cV({keychain:r}){return H(t=>r.findKeyByName(t))}function uV({keychain:r}){return H(()=>r.listKeys())}function lV({keychain:r}){return H(async(t,n)=>{let i=await r.renameKey(t,n);return{was:t,now:i.name,id:i.id,overwrite:!1}})}function fV({keychain:r}){return H(t=>r.removeKey(t))}var R5=class{constructor({keychain:e}){this.gen=oV({keychain:e}),this.list=uV({keychain:e}),this.rm=fV({keychain:e}),this.rename=lV({keychain:e}),this.export=nV({keychain:e}),this.import=aV({keychain:e}),this.info=cV({keychain:e})}};function ui({repo:r,preload:e}){async function t(n,i={}){i.preload!==!1&&e(n);let s=await r.blocks.get(n,i);return pt(s)}return H(t)}function dV({repo:r,preload:e}){let t=ui({repo:r,preload:e});async function n(i,s={}){return(await t(i,s)).Data||new Uint8Array(0)}return H(n)}function z9(r,e=[]){for(let t in r){let n=r[t];if(t==="/"&&Object.keys(r).length===1)try{e.push({Name:"",Tsize:0,Hash:P.parse(n)});continue}catch{}let i=P.asCID(n);if(i){e.push({Name:"",Tsize:0,Hash:i});continue}Array.isArray(n)&&z9(n,e),n&&typeof n=="object"&&z9(n,e)}return e}function hV({repo:r,codecs:e}){async function t(n,i={}){let s=await e.getCodec(n.code),o=await r.blocks.get(n,i),a=s.decode(o);switch(n.code){case cn:return[];case Xe:return a.Links;case _p:case tb:return z9(a);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return H(t)}function pV({repo:r,preload:e}){async function t(n={}){let i;if(n.template)if(n.template==="unixfs-dir")i=new He({type:"directory"}).marshal();else throw new Error("unknown template");let s=ze({Data:i,Links:[]}),o=await Pe.digest(s),a=P.createV0(o);return await r.blocks.put(a,s,{signal:n.signal}),n.preload!==!1&&e(a),a}return H(t)}function Uo({repo:r,preload:e}){async function t(n,i={}){let s=await r.gcLock.readLock();try{let o=ze(n),a=await Pe.digest(o),c=P.createV1(Xe,a);return await r.blocks.put(c,o,{signal:i.signal}),i.preload!==!1&&e(c),i.pin&&await r.pins.pinRecursively(c,{signal:i.signal}),c}finally{s()}}return H(t)}function mV({repo:r,preload:e}){let t=ui({repo:r,preload:e});async function n(i,s={}){let o=await t(i,s),c=ze(o).length,u=o.Links.reduce((l,f)=>l+(f.Tsize||0),0);return{Hash:i,NumLinks:o.Links.length,BlockSize:c,LinksSize:c-(o.Data||[]).length,DataSize:(o.Data||[]).length,CumulativeSize:c+u}}return H(n)}function gV({repo:r,preload:e}){let t=ui({repo:r,preload:e}),n=Uo({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a);return n({...c,Links:c.Links.concat([o])},a)}return H(i)}function yV({repo:r,preload:e}){let t=ui({repo:r,preload:e}),n=Uo({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a),u=ve([c.Data||[],o]);return n({...c,Data:u},a)}return H(i)}function wV({repo:r,preload:e}){let t=ui({repo:r,preload:e}),n=Uo({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a),u=(typeof o=="string"?o:o.Name)||"";return c.Links=c.Links.filter(l=>l.Name!==u),n(c,a)}return H(i)}function bV({repo:r,preload:e}){let t=ui({repo:r,preload:e}),n=Uo({repo:r,preload:e});async function i(s,o,a={}){let c=await t(s,a);return n({...c,Data:o},a)}return H(i)}var C5=class{constructor({repo:e,preload:t}){this.addLink=gV({repo:e,preload:t}),this.appendData=yV({repo:e,preload:t}),this.rmLink=wV({repo:e,preload:t}),this.setData=bV({repo:e,preload:t})}};var P5=class{constructor({repo:e,codecs:t,preload:n}){this.data=dV({repo:e,preload:n}),this.get=ui({repo:e,preload:n}),this.links=hV({repo:e,codecs:t}),this.new=pV({repo:e,preload:n}),this.put=Uo({repo:e,preload:n}),this.stat=mV({repo:e,preload:n}),this.patch=new C5({repo:e,preload:n})}};var xme=D("ipfs:repo:gc");function _V({repo:r,hashers:e}){async function*t(n={}){let i=Date.now(),s;try{s=await Ih({repo:r,hashers:e},n),await r.pins.pinRecursively(s),yield*r.gc()}finally{s&&await r.pins.unpin(s)}xme(`Complete (${Date.now()-i}ms)`)}return H(t)}function k5({repo:r}){async function e(t={}){let n=await r.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return H(e)}function EV({repo:r}){async function e(t={}){try{await r._checkInitialized(t)}catch(n){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some(s=>s.test(n.message)))return 12;throw n}return r.version.get()}return H(e)}var D5=class{constructor({repo:e,hashers:t}){this.gc=_V({repo:e,hashers:t}),this.stat=k5({repo:e}),this.version=EV({repo:e}),this.setApiAddr=n=>e.apiAddr.set(n)}};var SV=C(Y(),1);function vV(r,e){return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0}}function xV({network:r}){return H(async function*(t={}){let{libp2p:n}=await r.use(t);if(!t.poll){yield vV(n,t);return}let i=t.interval||1e3,s=-1;try{if(s=typeof i=="string"?Oc(i)||-1:i,!s||s<0)throw new Error("invalid duration")}catch(a){throw(0,SV.default)(a,"ERR_INVALID_POLL_INTERVAL")}let o;try{for(;;)yield vV(n,t),await new Promise(a=>{o=setTimeout(a,s)})}finally{clearTimeout(o)}})}var N5=class{constructor({repo:e,network:t}){this.repo=k5({repo:e}),this.bw=xV({network:t}),this.bitswap=Ty({network:t})}};var nm=Ame;function Ame(r,e,t){if(!r)return t;var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(i=n.shift(),!r||(r=r[i],r===void 0))return t;return r}var Cz=C(Gi(),1),cf=C(Y(),1);var AV=C(Gi(),1);async function $s(r){let e=0;for await(let t of r)e++;return e}var Ime=(0,AV.default)("ipfs:repo:migrator:migration-8");function IV(r){return r.child?IV(r.child):r}function Rme(r){try{let e=ut.decode(`b${r.toString().toLowerCase().slice(1)}`),t=P.decode(e).multihash.bytes,n=ut.encode(t).slice(1).toUpperCase();return new le(`/${n}`,!1)}catch{return r}}function Cme(r){try{let e=ut.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Xt(e),n=ut.encode(P.createV1(cn,t).bytes).slice(1);return new le(`/${n.toUpperCase()}`,!1)}catch{return r}}async function TV(r,e,t){let n=r.blocks;await n.open();let i=IV(n),s=await $s(i.queryKeys({filters:[o=>t(o).toString()!==o.toString()]}));try{let o=0;for await(let a of i.query({})){let c=t(a.key);c.toString()!==a.key.toString()&&(o+=1,Ime(`Migrating Block from ${a.key} to ${c}`,await i.has(a.key)),await i.delete(a.key),await i.put(c,a.value),e(o/s*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}var RV={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>TV(r,e,Rme),revert:(r,e=()=>{})=>TV(r,e,Cme)};var Jl=C(fo(),1),CV=Jl.default.Reader,Pme=Jl.default.Writer,L$e=Jl.default.util,O5=Jl.default.roots.default||(Jl.default.roots.default={}),PV=O5.ipfs=(()=>{let r={};return r.pin=function(){let e={};return e.Set=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(i,s){return s||(s=Pme.create()),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&s.uint32(8).uint32(i.version),i.fanout!=null&&Object.hasOwnProperty.call(i,"fanout")&&s.uint32(16).uint32(i.fanout),i.seed!=null&&Object.hasOwnProperty.call(i,"seed")&&s.uint32(29).fixed32(i.seed),s},t.decode=function(i,s){i instanceof CV||(i=CV.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new O5.ipfs.pin.Set;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.version=i.uint32();break;case 2:a.fanout=i.uint32();break;case 3:a.seed=i.fixed32();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof O5.ipfs.pin.Set)return i;var s=new O5.ipfs.pin.Set;return i.version!=null&&(s.version=i.version>>>0),i.fanout!=null&&(s.fanout=i.fanout>>>0),i.seed!=null&&(s.seed=i.seed>>>0),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(o.version=0,o.fanout=0,o.seed=0),i.version!=null&&i.hasOwnProperty("version")&&(o.version=i.version),i.fanout!=null&&i.hasOwnProperty("fanout")&&(o.fanout=i.fanout),i.seed!=null&&i.hasOwnProperty("seed")&&(o.seed=i.seed),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,Jl.default.util.toJSONOptions)},t}(),e}(),r})();var OV=C(DV(),1),M5=C(po(),1);var im=new le("/local/pins"),B5=256,NV=8192,H9=P.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),ef={direct:"direct",recursive:"recursive"};function $9(r){return new le(`/${ut.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}var q9=PV.pin.Set;function kme(r){let e=r.Data;if(!e)throw new Error("No data present");let t=M5.default.decode(e),n=M5.default.decode.bytes??0;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");let i=e.slice(n,t+n),s=q9.toObject(q9.decode(i),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(s.version!==1)throw new Error(`Unsupported Set version: ${s.version}`);if(s.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:s,data:e.slice(t+n)}}function Dme(r,e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);let i=W(e.toString()),s=ve([t,i],t.byteLength+i.byteLength);return(0,OV.default)(j(s))}async function*LV(r,e){let t=kme(e),n=0;for(let i of e.Links){if(n<t.header.fanout){let s=i.Hash;if(!H9.equals(s)){let o=await r.get(s),a=pt(o);yield*LV(r,a)}}else yield i.Hash;n++}}async function*sm(r,e,t){let n=e.Links.find(o=>o.Name===t);if(!n)throw new Error("No link found with name "+t);let i=await r.get(n.Hash),s=pt(i);yield*LV(r,s)}function Nme(r,e){return t(e,0);async function t(n,i){let s=q9.encode({version:1,fanout:B5,seed:i}).finish(),o=M5.default.encode(s.length),a=ve([o,s]),c=[];for(let l=0;l<B5;l++)c.push({Name:"",Tsize:1,Hash:H9});if(n.length<=NV){let l=n.map(d=>({link:{Name:"",Tsize:1,Hash:d.key},data:d.data||new Uint8Array})).sort((d,m)=>Bl(d.link.Hash.bytes,m.link.Hash.bytes)),f=c.concat(l.map(d=>d.link));return{Data:ve([a,...l.map(d=>d.data)]),Links:f}}else{let l=n.reduce((h,d)=>{let m=Dme(i,d.key)%B5;return h[m]=m in h?h[m].concat([d]):[d],h},[]),f=0;for(let h of l){let d=await t(h,i+1);await u(d,f),f++}return{Data:a,Links:c}}async function u(l,f){let h=ze(l),d=await Pe.digest(h),m=P.createV0(d);await r.put(m,h);let w=l.Links.reduce((b,v)=>b+(v.Tsize||0),0)+h.length;c[f]={Name:"",Tsize:w,Hash:m}}}}async function G9(r,e,t){let n=await Nme(r,t.map(c=>({key:c}))),i=ze(n),s=await Pe.digest(i),o=P.createV0(s);await r.put(o,i);let a=n.Links.reduce((c,u)=>c+u.Tsize,0)+i.length;return{Name:e,Tsize:a,Hash:o}}async function Lme(r,e,t,n){if(!await e.has(im))return;let i=await e.get(im),s=P.decode(i),o=await r.get(s),a=pt(o),c=0,u=await $s(sm(r,a,ef.recursive))+await $s(sm(r,a,ef.direct));for await(let l of sm(r,a,ef.recursive)){c++;let f={depth:1/0};l.version!==0&&(f.version=l.version),l.code!==Xe&&(f.codec=l.code),await t.put($9(l),Cs(f)),n(c/u*100,`Migrated recursive pin ${l}`)}for await(let l of sm(r,a,ef.direct)){c++;let f={depth:0};l.version!==0&&(f.version=l.version),l.code!==Xe&&(f.codec=l.code),await t.put($9(l),Cs(f)),n(c/u*100,`Migrated direct pin ${l}`)}await r.delete(s),await e.delete(im)}async function Bme(r,e,t,n){let i=[],s=[],o=0,a=await $s(t.queryKeys({}));for await(let{key:h,value:d}of t.query({})){o++;let m=Cn(d),w=P.create(m.version||0,m.codec||Xe,Xt(ut.decode("b"+h.toString().toLowerCase().split("/").pop())));m.depth===0?(n(o/a*100,`Reverted direct pin ${w}`),s.push(w)):(n(o/a*100,`Reverted recursive pin ${w}`),i.push(w))}n(100,"Updating pin root");let c={Links:[await G9(r,ef.direct,s),await G9(r,ef.recursive,i)]},u=ze(c),l=await Pe.digest(u),f=P.createV0(l);await r.put(f,u),await e.put(im,f.bytes)}async function BV(r,e,t){let n=r.blocks,i=r.datastore,s=r.pins;await n.open(),await i.open(),await s.open();try{await t(n,i,s,e)}finally{await s.close(),await i.close(),await n.close()}}var MV={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>BV(r,e,Lme),revert:(r,e=()=>{})=>BV(r,e,Bme)};var UV=new le("/config"),om=new le("/version");function am(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function Mme(r,e,t){let n=await e(r);if(n)return n;let i=am(t);return i?new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{s(Boolean(a.result))}}):!1}async function Ume(r,e,t,n){if(await t(r))return e(r);let i=am(n);if(!i)throw tn();return new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return s(a.result);o(tn())}})}function U5(r){let e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>Ume(n,e,t,r),r.has=n=>Mme(n,t,r),r}function j9(r){return{...r,root:U5(r.root),datastore:U5(r.datastore),pins:U5(r.pins),keys:U5(r.keys)}}async function Fme(r,e,t=()=>{}){let n=am(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await KV(n,(s,o)=>[{type:"del",key:s},{type:"put",key:W(s),value:o}])}async function Vme(r,e,t=()=>{}){let n=am(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await KV(n,(s,o)=>[{type:"del",key:s},{type:"put",key:j(s),value:o}])}function VV(r){return r.child?VV(r.child):r}async function FV(r,e,t){let n=Object.entries(r).map(([o,a])=>({key:o,backend:VV(a)})).filter(({key:o,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:o,backend:a})=>({name:o,store:a}));e(0,`Migrating ${n.length} dbs`);let i=0,s=o=>{e(Math.round(i/n.length*100),o)};for(let{name:o,store:a}of n){await a.open();try{await t(o,a,s)}finally{i++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}var zV={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>FV(r,e,Fme),revert:(r,e=()=>{})=>FV(r,e,Vme)};function KV(r,e){function t(n,i){let s=r.store("readwrite"),o=s.transaction,a=0,c;o.onabort=()=>i(c||o.error||new Error("aborted by user")),o.oncomplete=()=>i();function u(){let l=n[a++],f=l.key,h;try{h=l.type==="del"?s.delete(f):s.put(l.value,f)}catch(d){c=d,o.abort();return}a<n.length&&(h.onsuccess=u)}u()}return new Promise((n,i)=>{let s=r.iterator(),o=c=>c;s._deserializeKey=s._deserializeValue=o,a();function a(){let c=(u,l,f)=>{if(u||l===void 0){let h=d=>{if(d){i(d);return}n()};s.end(h);return}t(e(l,f),a)};s.next(c)}})}var bu=new le("/local/filesroot");async function zme(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(bu)){let t=await r.root.get(bu);await r.datastore.put(bu,t),await r.root.delete(bu)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function Kme(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(bu)){let t=await r.datastore.get(bu);await r.root.put(bu,t),await r.datastore.delete(bu)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}var HV={version:11,description:"Store mfs root in the datastore",migrate:zme,revert:Kme};var J9=C(fo(),1);var tf=C(fo(),1),$V=tf.default.Reader,Hme=tf.default.Writer,$me=tf.default.util,F5=tf.default.roots.default||(tf.default.roots.default={}),W9=F5.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=$me.emptyArray,r.encode=function(t,n){if(n||(n=Hme.create()),t.protocols!=null&&t.protocols.length)for(var i=0;i<t.protocols.length;++i)n.uint32(10).string(t.protocols[i]);return n},r.decode=function(t,n){t instanceof $V||(t=$V.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new F5.Protocols;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(t.string());break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof F5.Protocols)return t;var n=new F5.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var i=0;i<t.protocols.length;++i)n.protocols[i]=String(t.protocols[i])}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.protocols=[]),t.protocols&&t.protocols.length){i.protocols=[];for(var s=0;s<t.protocols.length;++s)i.protocols[s]=t.protocols[s]}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,tf.default.util.toJSONOptions)},r})();var Ka=C(fo(),1),Oh=Ka.default.Reader,Y9=Ka.default.Writer,pr=Ka.default.util,mn=Ka.default.roots.default||(Ka.default.roots.default={}),Q9=mn.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=pr.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=Y9.create()),t.addrs!=null&&t.addrs.length)for(var i=0;i<t.addrs.length;++i)mn.Addresses.Address.encode(t.addrs[i],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&mn.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof Oh||(t=Oh.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new mn.Addresses;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.addrs&&s.addrs.length||(s.addrs=[]),s.addrs.push(mn.Addresses.Address.decode(t,t.uint32()));break;case 2:s.certifiedRecord=mn.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof mn.Addresses)return t;var n=new mn.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var i=0;i<t.addrs.length;++i){if(typeof t.addrs[i]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[i]=mn.Addresses.Address.fromObject(t.addrs[i])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=mn.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addrs=[]),n.defaults&&(i.certifiedRecord=null),t.addrs&&t.addrs.length){i.addrs=[];for(var s=0;s<t.addrs.length;++s)i.addrs[s]=mn.Addresses.Address.toObject(t.addrs[s],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(i.certifiedRecord=mn.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ka.default.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}e.prototype.multiaddr=pr.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:pr.oneOfGetter(t=["isCertified"]),set:pr.oneOfSetter(t)}),e.encode=function(i,s){return s||(s=Y9.create()),i.multiaddr!=null&&Object.hasOwnProperty.call(i,"multiaddr")&&s.uint32(10).bytes(i.multiaddr),i.isCertified!=null&&Object.hasOwnProperty.call(i,"isCertified")&&s.uint32(16).bool(i.isCertified),s},e.decode=function(i,s){i instanceof Oh||(i=Oh.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new mn.Addresses.Address;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.multiaddr=i.bytes();break;case 2:a.isCertified=i.bool();break;default:i.skipType(c&7);break}}return a},e.fromObject=function(i){if(i instanceof mn.Addresses.Address)return i;var s=new mn.Addresses.Address;return i.multiaddr!=null&&(typeof i.multiaddr=="string"?pr.base64.decode(i.multiaddr,s.multiaddr=pr.newBuffer(pr.base64.length(i.multiaddr)),0):i.multiaddr.length&&(s.multiaddr=i.multiaddr)),i.isCertified!=null&&(s.isCertified=Boolean(i.isCertified)),s},e.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.multiaddr="":(o.multiaddr=[],s.bytes!==Array&&(o.multiaddr=pr.newBuffer(o.multiaddr)))),i.multiaddr!=null&&i.hasOwnProperty("multiaddr")&&(o.multiaddr=s.bytes===String?pr.base64.encode(i.multiaddr,0,i.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(i.multiaddr):i.multiaddr),i.isCertified!=null&&i.hasOwnProperty("isCertified")&&(o.isCertified=i.isCertified,s.oneofs&&(o._isCertified="isCertified")),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ka.default.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.seq=pr.Long?pr.Long.fromBits(0,0,!0):0,e.prototype.raw=pr.newBuffer([]),e.encode=function(n,i){return i||(i=Y9.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&i.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&i.uint32(18).bytes(n.raw),i},e.decode=function(n,i){n instanceof Oh||(n=Oh.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new mn.Addresses.CertifiedRecord;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.seq=n.uint64();break;case 2:o.raw=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof mn.Addresses.CertifiedRecord)return n;var i=new mn.Addresses.CertifiedRecord;return n.seq!=null&&(pr.Long?(i.seq=pr.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?i.seq=parseInt(n.seq,10):typeof n.seq=="number"?i.seq=n.seq:typeof n.seq=="object"&&(i.seq=new pr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?pr.base64.decode(n.raw,i.raw=pr.newBuffer(pr.base64.length(n.raw)),0):n.raw.length&&(i.raw=n.raw)),i},e.toObject=function(n,i){i||(i={});var s={};if(i.defaults){if(pr.Long){var o=new pr.Long(0,0,!0);s.seq=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else s.seq=i.longs===String?"0":0;i.bytes===String?s.raw="":(s.raw=[],i.bytes!==Array&&(s.raw=pr.newBuffer(s.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?s.seq=i.longs===String?String(n.seq):n.seq:s.seq=i.longs===String?pr.Long.prototype.toString.call(n.seq):i.longs===Number?new pr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(s.raw=i.bytes===String?pr.base64.encode(n.raw,0,n.raw.length):i.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ka.default.util.toJSONOptions)},e}(),r})();var Ha=C(fo(),1),Lh=Ha.default.Reader,X9=Ha.default.Writer,Ht=Ha.default.util,$r=Ha.default.roots.default||(Ha.default.roots.default={}),Z9=$r.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.addresses=Ht.emptyArray,r.prototype.protocols=Ht.emptyArray,r.prototype.metadata=Ht.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:Ht.oneOfGetter(e=["pubKey"]),set:Ht.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:Ht.oneOfGetter(e=["peerRecordEnvelope"]),set:Ht.oneOfSetter(e)}),r.encode=function(n,i){if(i||(i=X9.create()),n.addresses!=null&&n.addresses.length)for(var s=0;s<n.addresses.length;++s)$r.Address.encode(n.addresses[s],i.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var s=0;s<n.protocols.length;++s)i.uint32(18).string(n.protocols[s]);if(n.metadata!=null&&n.metadata.length)for(var s=0;s<n.metadata.length;++s)$r.Metadata.encode(n.metadata[s],i.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&i.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&i.uint32(42).bytes(n.peerRecordEnvelope),i},r.decode=function(n,i){n instanceof Lh||(n=Lh.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new $r.Peer;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.addresses&&o.addresses.length||(o.addresses=[]),o.addresses.push($r.Address.decode(n,n.uint32()));break;case 2:o.protocols&&o.protocols.length||(o.protocols=[]),o.protocols.push(n.string());break;case 3:o.metadata&&o.metadata.length||(o.metadata=[]),o.metadata.push($r.Metadata.decode(n,n.uint32()));break;case 4:o.pubKey=n.bytes();break;case 5:o.peerRecordEnvelope=n.bytes();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof $r.Peer)return n;var i=new $r.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");i.addresses=[];for(var s=0;s<n.addresses.length;++s){if(typeof n.addresses[s]!="object")throw TypeError(".Peer.addresses: object expected");i.addresses[s]=$r.Address.fromObject(n.addresses[s])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");i.protocols=[];for(var s=0;s<n.protocols.length;++s)i.protocols[s]=String(n.protocols[s])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");i.metadata=[];for(var s=0;s<n.metadata.length;++s){if(typeof n.metadata[s]!="object")throw TypeError(".Peer.metadata: object expected");i.metadata[s]=$r.Metadata.fromObject(n.metadata[s])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?Ht.base64.decode(n.pubKey,i.pubKey=Ht.newBuffer(Ht.base64.length(n.pubKey)),0):n.pubKey.length&&(i.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?Ht.base64.decode(n.peerRecordEnvelope,i.peerRecordEnvelope=Ht.newBuffer(Ht.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(i.peerRecordEnvelope=n.peerRecordEnvelope)),i},r.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.addresses=[],s.protocols=[],s.metadata=[]),n.addresses&&n.addresses.length){s.addresses=[];for(var o=0;o<n.addresses.length;++o)s.addresses[o]=$r.Address.toObject(n.addresses[o],i)}if(n.protocols&&n.protocols.length){s.protocols=[];for(var o=0;o<n.protocols.length;++o)s.protocols[o]=n.protocols[o]}if(n.metadata&&n.metadata.length){s.metadata=[];for(var o=0;o<n.metadata.length;++o)s.metadata[o]=$r.Metadata.toObject(n.metadata[o],i)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(s.pubKey=i.bytes===String?Ht.base64.encode(n.pubKey,0,n.pubKey.length):i.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,i.oneofs&&(s._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(s.peerRecordEnvelope=i.bytes===String?Ht.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):i.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,i.oneofs&&(s._peerRecordEnvelope="peerRecordEnvelope")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ha.default.util.toJSONOptions)},r})(),dqe=$r.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.multiaddr=Ht.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:Ht.oneOfGetter(e=["isCertified"]),set:Ht.oneOfSetter(e)}),r.encode=function(n,i){return i||(i=X9.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&i.uint32(16).bool(n.isCertified),i},r.decode=function(n,i){n instanceof Lh||(n=Lh.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new $r.Address;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;case 2:o.isCertified=n.bool();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof $r.Address)return n;var i=new $r.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?Ht.base64.decode(n.multiaddr,i.multiaddr=Ht.newBuffer(Ht.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),n.isCertified!=null&&(i.isCertified=Boolean(n.isCertified)),i},r.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=Ht.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?Ht.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(s.isCertified=n.isCertified,i.oneofs&&(s._isCertified="isCertified")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ha.default.util.toJSONOptions)},r})(),hqe=$r.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=Ht.newBuffer([]),r.encode=function(t,n){return n||(n=X9.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof Lh||(t=Lh.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $r.Metadata;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.key=t.string();break;case 2:s.value=t.bytes();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof $r.Metadata)return t;var n=new $r.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?Ht.base64.decode(t.value,n.value=Ht.newBuffer(Ht.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.key="",n.bytes===String?i.value="":(i.value=[],n.bytes!==Array&&(i.value=Ht.newBuffer(i.value)))),t.key!=null&&t.hasOwnProperty("key")&&(i.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(i.value=n.bytes===String?Ht.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ha.default.util.toJSONOptions)},r})();var rf=C(fo(),1),qV=rf.default.Reader,qme=rf.default.Writer,mr=rf.default.util,V5=rf.default.roots.default||(rf.default.roots.default={}),GV=V5.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=mr.newBuffer([]),r.prototype.payloadType=mr.newBuffer([]),r.prototype.payload=mr.newBuffer([]),r.prototype.signature=mr.newBuffer([]),r.encode=function(t,n){return n||(n=qme.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof qV||(t=qV.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new V5.Envelope;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof V5.Envelope)return t;var n=new V5.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?mr.base64.decode(t.publicKey,n.publicKey=mr.newBuffer(mr.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?mr.base64.decode(t.payloadType,n.payloadType=mr.newBuffer(mr.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?mr.base64.decode(t.payload,n.payload=mr.newBuffer(mr.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?mr.base64.decode(t.signature,n.signature=mr.newBuffer(mr.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(n.bytes===String?i.publicKey="":(i.publicKey=[],n.bytes!==Array&&(i.publicKey=mr.newBuffer(i.publicKey))),n.bytes===String?i.payloadType="":(i.payloadType=[],n.bytes!==Array&&(i.payloadType=mr.newBuffer(i.payloadType))),n.bytes===String?i.payload="":(i.payload=[],n.bytes!==Array&&(i.payload=mr.newBuffer(i.payload))),n.bytes===String?i.signature="":(i.signature=[],n.bytes!==Array&&(i.signature=mr.newBuffer(i.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(i.publicKey=n.bytes===String?mr.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(i.payloadType=n.bytes===String?mr.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(i.payload=n.bytes===String?mr.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(i.signature=n.bytes===String?mr.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,rf.default.util.toJSONOptions)},r})();var _u=C(fo(),1),z5=_u.default.Reader,jV=_u.default.Writer,Ir=_u.default.util,qs=_u.default.roots.default||(_u.default.roots.default={}),WV=qs.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=Ir.newBuffer([]),r.prototype.seq=Ir.Long?Ir.Long.fromBits(0,0,!0):0,r.prototype.addresses=Ir.emptyArray,r.encode=function(t,n){if(n||(n=jV.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var i=0;i<t.addresses.length;++i)qs.PeerRecord.AddressInfo.encode(t.addresses[i],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof z5||(t=z5.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new qs.PeerRecord;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push(qs.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof qs.PeerRecord)return t;var n=new qs.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?Ir.base64.decode(t.peerId,n.peerId=Ir.newBuffer(Ir.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&(Ir.Long?(n.seq=Ir.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new Ir.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var i=0;i<t.addresses.length;++i){if(typeof t.addresses[i]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[i]=qs.PeerRecord.AddressInfo.fromObject(t.addresses[i])}}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addresses=[]),n.defaults)if(n.bytes===String?i.peerId="":(i.peerId=[],n.bytes!==Array&&(i.peerId=Ir.newBuffer(i.peerId))),Ir.Long){var s=new Ir.Long(0,0,!0);i.seq=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(i.peerId=n.bytes===String?Ir.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?i.seq=n.longs===String?String(t.seq):t.seq:i.seq=n.longs===String?Ir.Long.prototype.toString.call(t.seq):n.longs===Number?new Ir.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){i.addresses=[];for(var o=0;o<t.addresses.length;++o)i.addresses[o]=qs.PeerRecord.AddressInfo.toObject(t.addresses[o],n)}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,_u.default.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.multiaddr=Ir.newBuffer([]),e.encode=function(n,i){return i||(i=jV.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),i},e.decode=function(n,i){n instanceof z5||(n=z5.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new qs.PeerRecord.AddressInfo;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof qs.PeerRecord.AddressInfo)return n;var i=new qs.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?Ir.base64.decode(n.multiaddr,i.multiaddr=Ir.newBuffer(Ir.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=Ir.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?Ir.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,_u.default.util.toJSONOptions)},e}(),r})();J9.default.util.Long=void 0;J9.default.configure();async function Gme(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);let o=i.toString(),[,a,c,u,l]=o.split("/");if(a==="peers"&&["protos","addrs","metadata","keys"].includes(c)&&u)if(t[u]=t[u]||{addresses:[],protocols:[],metadata:[]},c==="protos"){let f=W9.decode(s);t[u].protocols=f.protocols.sort()}else if(c==="addrs"){let f=Q9.decode(s);t[u].addresses=f.addrs.sort((h,d)=>oe(h.multiaddr).toString().localeCompare(oe(d.multiaddr).toString())),f.certifiedRecord&&f.certifiedRecord.raw&&(t[u].peerRecordEnvelope=f.certifiedRecord.raw)}else c==="metadata"?t[u].metadata.push({key:l,value:s}):c==="keys"&&(t[u].pubKey=s)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let i of Object.keys(t)){let s=t[i];s.metadata=s.metadata.sort((a,c)=>a.key.localeCompare(c.key));let o=Z9.encode(s).finish();await r.datastore.put(new le(`/peers/${i}`),o)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function jme(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);let o=i.toString(),[,,a]=o.split("/");t[a]=Z9.decode(s)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let[i,s]of Object.entries(t)){if(s.protocols&&s.protocols.length>0&&await r.datastore.put(new le(`/peers/protos/${i}`),W9.encode({protocols:s.protocols}).finish()),s.addresses&&s.addresses.length>0){let o=s.peerRecordEnvelope,a;if(o){let c=GV.decode(o),u=WV.decode(c.payload);a={raw:o,seq:u.seq}}await r.datastore.put(new le(`/peers/addrs/${i}`),Q9.encode({addrs:s.addresses,certifiedRecord:a}).finish())}if(s.metadata&&s.metadata.length>0)for(let{key:o,value:a}of s.metadata)await r.datastore.put(new le(`/peers/metadata/${i}/${o}`),a);s.pubKey&&await r.datastore.put(new le(`/peers/keys/${i}`),s.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}var YV={version:12,description:"Store each peerstore peer under a single datastore key",migrate:Gme,revert:jme};var nf={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},K5=[Object.assign({version:1},nf),Object.assign({version:2},nf),Object.assign({version:3},nf),Object.assign({version:4},nf),Object.assign({version:5},nf),Object.assign({version:6},nf),Object.assign({version:7},nf),RV,MV,zV,HV,YV];var QV=C(Gi(),1);var ev={};zt(ev,{InvalidValueError:()=>Uh,MissingRepoOptionsError:()=>Fo,NonReversibleMigrationError:()=>Bh,NotInitializedRepoError:()=>Eu,RequiredParameterError:()=>Mh});var Bh=class extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=Bh.code,this.message=e}};Bh.code="ERR_NON_REVERSIBLE_MIGRATION";var Eu=class extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=Eu.code,this.message=e}};Eu.code="ERR_NOT_INITIALIZED_REPO";var Mh=class extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=Mh.code,this.message=e}};Mh.code="ERR_REQUIRED_PARAMETER";var Uh=class extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=Uh.code,this.message=e}};Uh.code="ERR_INVALID_VALUE";var Fo=class extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=Fo.code,this.message=e}};Fo.code="ERR_MISSING_REPO_OPTIONS";var tv=(0,QV.default)("ipfs:repo:migrator:repo:init");async function XV(r){if(!r)throw new Fo("Please pass repo options when trying to open a repo");let e=r.root;try{await e.open();let t=await e.has(om),n=await e.has(UV);return!t||!n?(tv(`Version entry present: ${t}`),tv(`Config entry present: ${n}`),!1):!0}catch(t){return tv("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function rv(r){if(!await XV(r))throw new Eu("Repo is not initialized!");let e=r.root;await e.open();try{return parseInt(j(await e.get(om)))}finally{await e.close()}}async function cm(r,e){if(!e)throw new Fo("Please pass repo options when trying to open a repo");let t=e.root;await t.open(),await t.put(om,W(String(r))),await t.close()}var ZV=C(Gi(),1),Gs=(0,ZV.default)("ipfs:repo:migrator");function Yme(r){return r=r||K5,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function JV(r,e,t,n,i={}){let s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??K5;if(!r)throw new cs.RequiredParameterError("Path argument is required!");if(!t)throw new cs.RequiredParameterError("repoOptions argument is required!");if(!n)throw new cs.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new cs.InvalidValueError("Version has to be positive integer!");e=j9(e);let u=await rv(e);if(u===n){Gs("Nothing to migrate.");return}if(u>n)throw new cs.InvalidValueError(`Current repo's version (${u}) is higher then toVersion (${n}), you probably wanted to revert it?`);tz(c,u,n);let l;!a&&!s&&(l=await t.repoLock.lock(r));try{for(let f of c){if(n!==void 0&&f.version>n)break;if(!(f.version<=u)){Gs(`Migrating version ${f.version}`);try{if(!a){let h=()=>{};o&&(h=(d,m)=>o(f.version,d.toFixed(2),m)),await f.migrate(e,h)}}catch(h){let d=f.version-1;throw Gs(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${d}`),await cm(d,e),new Error(`During migration to version ${f.version} exception was raised: ${h.stack||h.message||h}`)}Gs(`Migrating to version ${f.version} finished`)}}a||await cm(n||Yme(c),e),Gs("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!a&&!s&&l&&await l.close()}}async function ez(r,e,t,n,i={}){let s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??K5;if(!r)throw new cs.RequiredParameterError("Path argument is required!");if(!t)throw new cs.RequiredParameterError("repoOptions argument is required!");if(!n)throw new cs.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new cs.InvalidValueError("Version has to be positive integer!");e=j9(e);let u=await rv(e);if(u===n){Gs("Nothing to revert.");return}if(u<n)throw new cs.InvalidValueError(`Current repo's version (${u}) is lower then toVersion (${n}), you probably wanted to migrate it?`);tz(c,n,u,!0);let l;!a&&!s&&(l=await t.repoLock.lock(r)),Gs(`Reverting from version ${u} to ${n}`);try{let f=c.slice().reverse();for(let h of f){if(h.version<=n)break;if(!(h.version>u)){Gs(`Reverting migration version ${h.version}`);try{if(!a){let d=()=>{};o&&(d=(m,w)=>o(h.version,m.toFixed(2),w)),await h.revert(e,d)}}catch(d){let m=h.version;throw Gs(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${m}`),await cm(m,e),d.message=`During reversion to version ${h.version} exception was raised: ${d.message}`,d}Gs(`Reverting to version ${h.version} finished`)}}a||await cm(n,e),Gs(`All migrations successfully reverted to version ${n}!`)}finally{!a&&!s&&l&&await l.close()}}function tz(r,e,t,n=!1){let i=0;for(let s of r){if(s.version>t)break;if(s.version>e){if(n&&!s.revert)throw new cs.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${s.version} is not reversible. Cancelling reversion.`);i++}}if(i!==t-e)throw new cs.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}var cs=ev;var Pz=C(iz(),1);var cz=C(Gi(),1);var sf=class extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=sf.code}};sf.code="ERR_LOCK_EXISTS";var ki=class extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=ki.code}};ki.code="ERR_NOT_FOUND";var of=class extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=of.code}};of.code="ERR_INVALID_REPO_VERSION";var af="ERR_REPO_NOT_INITIALIZED",sz="ERR_REPO_ALREADY_OPEN",oz="ERR_REPO_ALREADY_CLOSED";async function $5(r,e,t){let n=await e(r);if(n)return n;let i=az(t);return i?new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{s(Boolean(a.result))}}):!1}async function q5(r,e,t,n){if(await t(r))return e(r);let i=az(n);if(!i)throw new ki;return new Promise((s,o)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return s(a.result);o(new ki)}})}function az(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}var r2e=(0,cz.default)("ipfs:repo:version"),nv=new le("version");function uz(r){return{async exists(){return $5(nv,r.has.bind(r),r)},async get(){let e=await q5(nv,r.get.bind(r),r.has.bind(r),r);return parseInt(j(e),10)},set(e){return r.put(nv,W(String(e)))},async check(e){let t=await this.get();return r2e("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}var G5=C(Y(),1);var n2e=Ot.default?Ot.default:Ot,iv=new le("config");function lz(r){let e=new n2e({concurrency:1}),t={async getAll(s={}){let o=await q5(iv,r.get.bind(r),r.has.bind(r),r);return JSON.parse(j(o))},async get(s,o={}){if(s==null)throw new ki(`Key ${s} does not exist in config`);let a=await this.getAll(o),c=nm(a,s);if(c===void 0)throw new ki(`Key ${s} does not exist in config`);return c},set(s,o,a={}){if(typeof s!="string"&&!(s instanceof String))throw(0,G5.default)(new Error("Invalid key type: "+typeof s),"ERR_INVALID_KEY");if(o===void 0||o instanceof Uint8Array)throw(0,G5.default)(new Error("Invalid value type: "+typeof o),"ERR_INVALID_VALUE");return e.add(()=>n({key:s,value:o},a.signal))},replace(s,o={}){if(!s||s instanceof Uint8Array)throw(0,G5.default)(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:s},o.signal))},async exists(){return $5(iv,r.has.bind(r),r)}};return t;async function n(s,o){if(o&&o.aborted)return;let a=s.key,c=s.value;if(a){let u=await t.getAll();return typeof u=="object"&&u!==null&&hr(u,a,c),i(u)}return i(c)}function i(s){let o=W(JSON.stringify(s,null,2));return r.put(iv,o)}}function um(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function sv(r,e={}){if(!um(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");let{deep:t,compare:n}=e,i=[],s=[],o=c=>{let u=i.indexOf(c);if(u!==-1)return s[u];let l=[];return i.push(c),s.push(l),l.push(...c.map(f=>Array.isArray(f)?o(f):um(f)?a(f):f)),l},a=c=>{let u=i.indexOf(c);if(u!==-1)return s[u];let l={},f=Object.keys(c).sort(n);i.push(c),s.push(l);for(let h of f){let d=c[h],m;t&&Array.isArray(d)?m=o(d):m=t&&um(d)?a(d):d,Object.defineProperty(l,h,{...Object.getOwnPropertyDescriptor(c,h),value:m})}return l};return Array.isArray(r)?t?o(r):r.slice():a(r)}var ov=new le("datastore_spec");function fz(r){return{exists(){return r.has(ov)},async get(){let e=await r.get(ov);return JSON.parse(j(e))},async set(e){return r.put(ov,W(JSON.stringify(sv(e,{deep:!0}))))}}}var av=new le("api");function dz(r){return{async get(){let e=await r.get(av);return e&&e.toString()},set(e){return r.put(av,W(e.toString()))},delete(){return r.delete(av)}}}var hz=C(Y(),1);function pz(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){let n=Su(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(let n of e)yield this.get(n,t)},async put(e,t,n){let{isIdentity:i}=Su(e);i||await r.put(e,t,n)},async*putMany(e,t){let n=Kt({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await Rt(r.putMany(async function*(){for await(let{key:s,value:o}of e)Su(s).isIdentity||(yield{key:s,value:o}),n.push({key:s,value:o})}())),n.end()}catch(s){n.end(s)}}),yield*n},has(e,t){let{isIdentity:n}=Su(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){let{isIdentity:n}=Su(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(ot(e,n=>!Su(n).isIdentity),t)},batch(){let e=r.batch();return{put(t,n){let{isIdentity:i}=Su(t);i||e.put(t,n)},delete(t){let{isIdentity:n}=Su(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function Su(r){let e=P.asCID(r);if(e==null)throw(0,hz.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==Hr.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}var mz=C(Gi(),1),gz=(0,mz.default)("ipfs:repo:lock:memory"),yz="repo.lock",lm={};async function i2e(r){let e=r+"/"+yz;if(gz("locking %s",e),lm[e]===!0)throw new sf(`Lock already being held for file: ${e}`);return lm[e]=!0,{async close(){lm[e]&&delete lm[e]}}}async function s2e(r){let e=r+"/"+yz;return gz(`checking lock: ${e}`),Boolean(lm[e])}var j5={lock:i2e,locked:s2e};var wz={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:j5};var cv={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};var Ez=C(Y(),1),vz=C(Gi(),1);var bz=C(Y(),1);function fm(r){let e=P.asCID(r);if(e==null)throw(0,bz.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");let t=ut.encode(e.multihash.bytes);return new le("/"+t.slice(1).toUpperCase(),!1)}function uv(r){return Xt(ut.decode(`b${r.toString().toLowerCase().substring(1)}`))}var _z=C(Gi(),1);var o2e=(0,_z.default)("ipfs:repo:utils:walk-dag");async function*Fh(r,e,t,n){try{let i=await e.get(r,n),s=await t(r.code),o=Sh({bytes:i,cid:r,codec:s});for(let[,a]of o.links())yield a,yield*Fh(a,e,t,n)}catch(i){throw o2e("Could not walk DAG for CID",r.toString(),i),i}}var dm=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(let[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){let i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};var a2e=2048;function c2e(r){let e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return(0,Ez.default)(new Error(e),"ERR_INVALID_PIN_TYPE")}var W5=class{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=(0,vz.default)("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);let n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==Xe&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(fm(e),Cs(n))}unpin(e,t){return this.pinstore.delete(fm(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);let n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==Xe&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(fm(e),Cs(n))}async*directKeys(e){for await(let t of this.pinstore.query({filters:[n=>Cn(n.value).depth===0]})){let n=Cn(t.value),i=n.version||0,s=n.codec!=null?n.codec:Xe,o=uv(t.key);yield{cid:P.create(i,s,o),metadata:n.metadata}}}async*recursiveKeys(e){for await(let t of this.pinstore.query({filters:[n=>Cn(n.value).depth===1/0]})){let n=Cn(t.value),i=n.version||0,s=n.codec!=null?n.codec:Xe,o=uv(t.key);yield{cid:P.create(i,s,o),metadata:n.metadata}}}async*indirectKeys(e){for await(let{cid:t}of this.recursiveKeys())for await(let n of Fh(t,this.blockstore,this.loadCodec,e)){let i=[ft.recursive];(await this.isPinnedWithType(n,i)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);let i=t.includes(ft.all),s=t.includes(ft.direct),o=t.includes(ft.recursive),a=t.includes(ft.indirect);if(o||s||i){let l=await Tr(this.pinstore.query({prefix:fm(e).toString(),filters:[f=>{if(i)return!0;let h=Cn(f.value);return t.includes(h.depth===0?ft.direct:ft.recursive)}],limit:1}));if(l){let f=Cn(l.value);return{cid:e,pinned:!0,reason:f.depth===0?ft.direct:ft.recursive,metadata:f.metadata}}}let c=this;async function*u(l,f){for await(let{cid:h}of f)for await(let d of Fh(h,c.blockstore,c.loadCodec))if(d.equals(l)){yield h;return}}if(i||a){let l=await Tr(u(e,this.recursiveKeys()));if(l)return{cid:e,pinned:!0,reason:ft.indirect,parent:l}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){let n=new dm({maxSize:t.cidCacheMaxSize??a2e}),i=async(s,o)=>{if(n.has(s.toString()))return;n.set(s.toString(),!0);let a=await this.blockstore.get(s,o),c=await this.loadCodec(s.code),u=Sh({bytes:a,cid:s,codec:c});await Promise.all([...u.links()].map(([,l])=>i(l,o)))};await i(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(ft).includes(e))throw c2e(e);return!0}};var xz=C(Y(),1);function Tz(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,i){await e.put(t,n,i)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await Sz(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(Bt(t,async i=>(await Sz(i,r),i)),n)},batch(){return e.batch()}}}async function Sz(r,e){let{pinned:t,reason:n}=await e.isPinnedWithType(r,ft.all);if(t)throw(0,xz.default)(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}var Az=C(Gi(),1);var hm=(0,Az.default)("ipfs:repo:gc"),u2e=tn().code,l2e=256,f2e=new le("/local/filesroot");function Iz({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:i}){async function*s(){let o=Date.now();hm("Creating set of marked blocks");let a=await r.writeLock();try{let c=await d2e({pins:e,blockstore:t,root:n,loadCodec:i}),u=t.queryKeys({});yield*h2e({blockstore:t},c,u),hm(`Complete (${Date.now()-o}ms)`)}finally{a()}}return s}async function d2e({pins:r,blockstore:e,loadCodec:t,root:n}){let i=async function*(){let a;try{a=await n.get(f2e)}catch(u){if(u.code===u2e){hm("No blocks in MFS");return}throw u}let c=P.decode(a);yield c,yield*Fh(c,e,t)}(),s=fr(Bt(r.recursiveKeys(),({cid:a})=>a),r.indirectKeys(),Bt(r.directKeys(),({cid:a})=>a),i),o=new Set;for await(let a of fr(s,i))o.add(ut.encode(a.multihash.bytes));return o}async function*h2e({blockstore:r},e,t){let n=0,i=0;yield*_e(Nl(Bt(t,async o=>async function(){n++;try{let c=ut.encode(o.multihash.bytes);if(e.has(c))return null;try{await r.delete(o),i++}catch(u){return{err:new Error(`Could not delete block with CID ${o}: ${u.message}`)}}return{cid:o}}catch(c){let u=`Could delete block with CID ${o}`;return hm(u,c),{err:new Error(u+`: ${c.message}`)}}}),l2e),o=>ot(o,Boolean)),hm(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${i} blocks.`)}var li=(0,Cz.default)("ipfs:repo"),p2e=Number.MAX_SAFE_INTEGER,m2e="repoAutoMigrate",lv=class{constructor(e,t,n,i){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=Ve(wz,i),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;let s=n.blocks,o=n.pins;this.pins=new W5({pinstore:o,blockstore:s,loadCodec:t});let a=Tz(this.pins,s);this.blocks=pz(a),this.version=uz(this.root),this.config=lz(this.root),this.spec=fz(this.root),this.apiAddr=dz(this.root),this.gcLock=Yl({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=Iz({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){li("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(g2e(e)),await this.spec.set(y2e(e)),await this.version.set(12)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw(0,cf.default)(new Error("repo is already open"),sz);li("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),li("acquired repo.lock"),!await this.version.check(12))if(await this._isAutoMigrationEnabled())await this._migrate(12,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new of("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");li("creating datastore"),await this.datastore.open(),li("creating blocks"),await this.blocks.open(),li("creating keystore"),await this.keys.open(),li("creating pins"),await this.pins.pinstore.open(),this.closed=!1,li("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){li("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){let e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw(0,cf.default)(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){li("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?(0,cf.default)(new Error("repo is not initialized yet"),af,{path:this.path}):t}if(!e)throw(0,cf.default)(new Error("repo is not initialized yet"),af,{path:this.path})}async close(){if(this.closed)throw(0,cf.default)(new Error("repo is already closed"),oz);li("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==af&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),li("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){let[e,t,n,i,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),Rz(this.datastore),Rz(this.keys)]),o=t.size+i+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:o}}throw(0,cf.default)(new Error("repo is not initialized yet"),af,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(m2e)}catch(t){if(t.code===ki.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(li(`reverting to version ${e}`),ez(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(li(`migrating to version ${e}`),JV(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{let e=await this.config.get("Datastore.StorageMax");return BigInt((0,Pz.default)(e))}catch{return BigInt(p2e)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(let{key:n,value:i}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(i.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}};async function Rz(r){let e=BigInt(0);for await(let t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function kz(r,e,t,n){return new lv(r,e,t,n)}function g2e(r){return r.Datastore=Object.assign({},cv,nm(r,"datastore")),r}function y2e(r){let e={...cv.Spec,...nm(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}async function*xu(r,e){yield*(await rn(r)).sort(e)}var fH=C(lH(),1),Lu=class extends oi{constructor(e,t={}){super(),this.db=typeof e=="string"?new fH.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw vi.dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw vi.dbWriteFailedError(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?vi.notFoundError(n):vi.dbWriteFailedError(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw vi.dbDeleteFailedError(t)}}close(){return this.db&&this.db.close()}batch(){let e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((s,o)=>ot(s,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,o)=>xu(s,o),t));let{offset:n,limit:i}=e;if(n){let s=0;t=ot(t,()=>s++>=n)}return i&&(t=Ai(t,i)),t}queryKeys(e){let t=Bt(this._query({values:!1,prefix:e.prefix}),({key:s})=>s);Array.isArray(e.filters)&&(t=e.filters.reduce((s,o)=>ot(s,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,o)=>xu(s,o),t));let{offset:n,limit:i}=e;if(n){let s=0;t=ot(t,()=>s++>=n)}return i&&(t=Ai(t,i)),t}_query(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){let i=e.prefix.toString();t.gte=i,t.lt=i+"\xFF"}let n=this.db.iterator(t);if(n[Symbol.asyncIterator])return t3e(n);if(n.next!=null&&n.end!=null)return r3e(n);throw new Error("Level returned incompatible iterator")}};async function*t3e(r){for await(let[e,t]of r)yield{key:new le(e,!1),value:t};await r.close()}function r3e(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,i,s)=>{if(n)return t(n);if(i==null)return r.end(o=>{if(o)return t(o);e({done:!0,value:void 0})});e({done:!1,value:{key:new le(i,!1),value:s}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}var hH=C(Y(),1);var dH=(r,e)=>async function*(){yield*(await rn(r)).sort(e)}(),qo=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Rt(this.putMany(e,n)),e=[],await Rt(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=ot(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ot(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>dH(i,s),n)),e.offset!=null){let i=0;n=ot(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=Ai(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=ot(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ot(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>dH(i,s),n)),e.offset!=null){let i=0;n=ot(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ai(n,e.limit)),n}};function t0(r){let e=P.asCID(r);if(!e)throw(0,hH.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return new le("/"+ut.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function Bu(r){return P.createV1(cn,Xt(ut.decode("b"+r.toString().slice(1).toLowerCase())))}function dS(r){let e=r.substring(0,1);if(e==="/")return dS(r.substring(1));let t;e.toLowerCase()==="b"?t=s=>ut.decode(s.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=s=>o7.decode(s.toLowerCase()).subarray(2):e==="z"?t=s=>Te.decode(s).subarray(2):e==="Q"?t=s=>Te.decode("z"+s):t=s=>ut.decode("b"+s.toLowerCase()).subarray(2);let n;for(let s=1;s<r.length;s++)try{n=t(r.substring(0,s))}catch(o){if(o.message!=="Unexpected end of data")throw o}let i="/C";return n&&(i=`/${ut.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}function n3e(r){return{...r,prefix:r.prefix?dS(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:Bu(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:Bu(t.key),value:t.value},{key:Bu(n.key),value:n.value})):void 0}}function i3e(r){return{...r,prefix:r.prefix?dS(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(Bu(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(Bu(t),Bu(n))):void 0}}var T4=class extends qo{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(let{key:n,value:i}of this.child.query(n3e(e),t))yield{key:Bu(n),value:i}}async*queryKeys(e,t){for await(let n of this.child.queryKeys(i3e(e),t))yield Bu(n)}async get(e,t){return this.child.get(t0(e),t)}async*getMany(e,t){for await(let n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(t0(e),t,n)}async*putMany(e,t){let n=Kt({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{let s=this.child;await Rt(this.child.putMany(async function*(){for await(let o of e){let a=t0(o.key);await s.has(a,t)||(yield{key:a,value:o.value}),n.push(o)}}())),n.end()}catch(s){n.end(s)}}),yield*n}has(e,t){return this.child.has(t0(e),t)}delete(e,t){return this.child.delete(t0(e),t)}deleteMany(e,t){let n=Kt({objectMode:!0});return Rt(this.child.deleteMany(async function*(){for await(let i of e)yield t0(i),n.push(i);n.end()}(),t)).catch(i=>{n.end(i)}),n}};function pH(r,e,t){let n=t.path||"ipfs";return kz(n,i=>e.getCodec(i),{root:new Lu(n,{prefix:"",version:2}),blocks:new T4(new Lu(`${n}/blocks`,{prefix:"",version:2})),datastore:new Lu(`${n}/datastore`,{prefix:"",version:2}),keys:new Lu(`${n}/keys`,{prefix:"",version:2}),pins:new Lu(`${n}/pins`,{prefix:"",version:2})},{autoMigrate:t.autoMigrate,onMigrationProgress:t.onMigrationProgress||r,repoLock:j5})}var Ft=C(my(),1);var xee=C(Y(),1);var yH=C(Y(),1);var mH={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Bm;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.publicKey!=null&&t.publicKey.byteLength>0)&&(n.uint32(10),n.bytes(t.publicKey)),(i.writeDefaults===!0||t.payloadType!=null&&t.payloadType.byteLength>0)&&(n.uint32(18),n.bytes(t.payloadType)),(i.writeDefaults===!0||t.payload!=null&&t.payload.byteLength>0)&&(n.uint32(26),n.bytes(t.payload)),(i.writeDefaults===!0||t.signature!=null&&t.signature.byteLength>0)&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(Bm||(Bm={}));function A4(r){return r instanceof Uint8Array?{get(e){return r[e]},set(e,t){r[e]=t}}:{get(e){return r.get(e)},set(e,t){r.set(e,t)}}}var gH=4294967296,Li=class{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Li(n,t)}zzEncode(){let e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Li(t,n)}toBytes(e,t=0){let n=A4(e);for(;this.hi>0;)n.set(t++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(t++,this.lo&127|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(e===0n)return new Li;let t=e<0;t&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return t&&(n=~n>>>0,i=~i>>>0,++i>gH&&(i=0,++n>gH&&(n=0))),new Li(n,i)}static fromNumber(e){if(e===0)return new Li;let t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Li(i,n)}static fromBytes(e,t=0){let n=A4(e),i=new Li,s=0;if(e.length-t>4){for(;s<4;++s)if(i.lo=(i.lo|(n.get(t)&127)<<s*7)>>>0,n.get(t++)<128)return i;if(i.lo=(i.lo|(n.get(t)&127)<<28)>>>0,i.hi=(i.hi|(n.get(t)&127)>>4)>>>0,n.get(t++)<128)return i;s=0}else for(;s<4;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.lo=(i.lo|(n.get(t)&127)<<s*7)>>>0,n.get(t++)<128)return i}if(e.length-t>4){for(;s<5;++s)if(i.hi=(i.hi|(n.get(t)&127)<<s*7+3)>>>0,n.get(t++)<128)return i}else if(t<e.byteLength)for(;s<5;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.hi=(i.hi|(n.get(t)&127)<<s*7+3)>>>0,n.get(t++)<128)return i}throw RangeError("invalid varint encoding")}};var s3e=Math.pow(2,7),o3e=Math.pow(2,14),a3e=Math.pow(2,21),c3e=Math.pow(2,28),u3e=Math.pow(2,35),l3e=Math.pow(2,42),f3e=Math.pow(2,49),d3e=Math.pow(2,56),h3e=Math.pow(2,63),Qs={encodingLength(r){return r<s3e?1:r<o3e?2:r<a3e?3:r<c3e?4:r<u3e?5:r<l3e?6:r<f3e?7:r<d3e?8:r<h3e?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=Ns(Qs.encodingLength(r))),Li.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return Li.fromBytes(r,e).toNumber(!0)}};var p3e,Mr=class{constructor(e){let{peerId:t,payloadType:n,payload:i,signature:s}=e;this.peerId=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=Bm.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return ke(this.marshal(),e.marshal())}async validate(e){let t=wH(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await ii(this.peerId.publicKey).verify(t.subarray(),this.signature)}};p3e=Mr;Mr.createFromProtobuf=async r=>{let e=Bm.decode(r),t=await br(e.publicKey);return new Mr({peerId:t,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};Mr.seal=async(r,e)=>{if(e.privateKey==null)throw new Error("Missing private key");let t=r.domain,n=r.codec,i=r.marshal(),s=wH(t,n,i),a=await(await hn(e.privateKey)).sign(s.subarray());return new Mr({peerId:e,payloadType:n,payload:i,signature:a})};Mr.openAndCertify=async(r,e)=>{let t=await Mr.createFromProtobuf(r);if(!await t.validate(e))throw(0,yH.default)(new Error("envelope signature is not valid for the given domain"),mH.ERR_SIGNATURE_NOT_VALID);return t};var wH=(r,e,t)=>{let n=W(r),i=Qs.encode(n.byteLength),s=Qs.encode(e.length),o=Qs.encode(t.length);return new qe(i,n,s,e,o,t)};function bH(r,e){let t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}var Mm;(function(r){let e;(function(n){let i;n.codec=()=>(i==null&&(i=nt((s,o,a={})=>{a.lengthDelimited!==!1&&o.fork(),(a.writeDefaults===!0||s.multiaddr!=null&&s.multiaddr.byteLength>0)&&(o.uint32(10),o.bytes(s.multiaddr)),a.lengthDelimited!==!1&&o.ldelim()},(s,o)=>{let a={multiaddr:new Uint8Array(0)},c=o==null?s.len:s.pos+o;for(;s.pos<c;){let u=s.uint32();switch(u>>>3){case 1:a.multiaddr=s.bytes();break;default:s.skipType(u&7);break}}return a})),i),n.encode=s=>rt(s,n.codec()),n.decode=s=>tt(s,n.codec())})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=nt((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),(s.writeDefaults===!0||n.peerId!=null&&n.peerId.byteLength>0)&&(i.uint32(10),i.bytes(n.peerId)),(s.writeDefaults===!0||n.seq!==0n)&&(i.uint32(16),i.uint64(n.seq)),n.addresses!=null)for(let o of n.addresses)i.uint32(26),r.AddressInfo.codec().encode(o,i,{writeDefaults:!0});s.lengthDelimited!==!1&&i.ldelim()},(n,i)=>{let s={peerId:new Uint8Array(0),seq:0n,addresses:[]},o=i==null?n.len:n.pos+i;for(;n.pos<o;){let a=n.uint32();switch(a>>>3){case 1:s.peerId=n.bytes();break;case 2:s.seq=n.uint64();break;case 3:s.addresses.push(r.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return s})),t),r.encode=n=>rt(n,r.codec()),r.decode=n=>tt(n,r.codec())})(Mm||(Mm={}));var _H="libp2p-peer-record",EH=Uint8Array.from([3,1]);var qr=class{constructor(e){this.domain=qr.DOMAIN,this.codec=qr.CODEC;let{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Mm.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof qr)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!bH(this.multiaddrs,e.multiaddrs))}};qr.createFromProtobuf=r=>{let e=Mm.decode(r),t=wr(e.peerId),n=(e.addresses??[]).map(s=>oe(s.multiaddr)),i=e.seq;return new qr({peerId:t,multiaddrs:n,seqNumber:i})};qr.DOMAIN=_H;qr.CODEC=EH;var I4=Symbol.for("@libp2p/topology");function vH(r){return r!=null&&Boolean(r[I4])}var SH=()=>{},hS=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??SH,this.onDisconnect=e.onDisconnect??SH}get[Symbol.toStringTag](){return I4.toString()}get[I4](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function r0(r){return new hS(r)}var Tf=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Za,Ue=class extends EventTarget{constructor(){super(...arguments),Za.set(this,new Map)}listenerCount(e){let t=Tf(this,Za,"f").get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let i=Tf(this,Za,"f").get(e);i==null&&(i=[],Tf(this,Za,"f").set(e,i)),i.push({callback:t,once:(n!==!0&&n!==!1&&(n==null?void 0:n.once))??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let i=Tf(this,Za,"f").get(e);i!=null&&(i=i.filter(({callback:s})=>s!==t),Tf(this,Za,"f").set(e,i))}dispatchEvent(e){let t=super.dispatchEvent(e),n=Tf(this,Za,"f").get(e.type);return n==null||(n=n.filter(({once:i})=>!i),Tf(this,Za,"f").set(e.type,n)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new ie(e,t))}};Za=new WeakMap;var pS=class extends Event{constructor(e,t){super(e,t),this.detail=t==null?void 0:t.detail}},ie=globalThis.CustomEvent??pS;var R4=class{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){let{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){let n=this.msgs.get(e);if(!n)return null;let i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){let t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{let s=this.msgs.get(i.msgIdStr);if(s&&s.validated&&e.has(i.topic)){let o=t.get(i.topic);o||(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;let{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{let n=this.msgs.get(t.msgIdStr);n&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}};var r$=C(t$(),1),{RPC:Km}=r$.default;var RS="/floodsub/1.0.0",CS="/meshsub/1.0.0",PS="/meshsub/1.1.0";var n$="ERR_TOPIC_VALIDATOR_REJECT",i$="ERR_TOPIC_VALIDATOR_IGNORE";function Wo(r){if(r.length<=1)return r;let e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){let n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function s$(r){return j(r,"base64")}var Rf="StrictSign",n0="StrictNoSign",Zs;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Zs||(Zs={}));var o$;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(o$||(o$={}));var Vu;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(Vu||(Vu={}));var Yn;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(Yn||(Yn={}));var Bn;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(Bn||(Bn={}));var hs;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(hs||(hs={}));function kS(r){switch(r){case Zs.Ignore:return Yn.Ignore;case Zs.Reject:return Yn.Reject}}async function DS(r,e){switch(r){case Rf:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let t=await hn(e.privateKey);return{type:Vu.Signing,author:e,key:e.publicKey,privateKey:t}}case n0:return{type:Vu.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}var qt="ERR_INVALID_PEER_SCORE_PARAMS";var S3e={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},x3e={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function a$(r={}){return{...S3e,...r,topics:r.topics?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=T3e(n),e),{}):{}}}function T3e(r={}){return{...x3e,...r}}function c$(r){for(let[e,t]of Object.entries(r.topics))try{A3e(t)}catch(n){throw new ae(`invalid score parameters for topic ${e}: ${n.message}`,qt)}if(r.topicScoreCap<0)throw new ae("invalid topic score cap; must be positive (or 0 for no cap)",qt);if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new ae("missing application specific score function",qt);if(r.IPColocationFactorWeight>0)throw new ae("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",qt);if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new ae("invalid IPColocationFactorThreshold; must be at least 1",qt);if(r.behaviourPenaltyWeight>0)throw new ae("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",qt);if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new ae("invalid BehaviourPenaltyDecay; must be between 0 and 1",qt);if(r.decayInterval<1e3)throw new ae("invalid DecayInterval; must be at least 1s",qt);if(r.decayToZero<=0||r.decayToZero>=1)throw new ae("invalid DecayToZero; must be between 0 and 1",qt)}function A3e(r){if(r.topicWeight<0)throw new ae("invalid topic weight; must be >= 0",qt);if(r.timeInMeshQuantum===0)throw new ae("invalid TimeInMeshQuantum; must be non zero",qt);if(r.timeInMeshWeight<0)throw new ae("invalid TimeInMeshWeight; must be positive (or 0 to disable)",qt);if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new ae("invalid TimeInMeshQuantum; must be positive",qt);if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new ae("invalid TimeInMeshCap; must be positive",qt);if(r.firstMessageDeliveriesWeight<0)throw new ae("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",qt);if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new ae("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",qt);if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new ae("invalid FirstMessageDeliveriesCap; must be positive",qt);if(r.meshMessageDeliveriesWeight>0)throw new ae("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",qt);if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new ae("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",qt);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new ae("invalid MeshMessageDeliveriesCap; must be positive",qt);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new ae("invalid MeshMessageDeliveriesThreshold; must be positive",qt);if(r.meshMessageDeliveriesWindow<0)throw new ae("invalid MeshMessageDeliveriesWindow; must be non-negative",qt);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new ae("invalid MeshMessageDeliveriesActivation; must be at least 1s",qt);if(r.meshFailurePenaltyWeight>0)throw new ae("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",qt);if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new ae("invalid MeshFailurePenaltyDecay; must be between 0 and 1",qt);if(r.invalidMessageDeliveriesWeight>0)throw new ae("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",qt);if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new ae("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",qt)}var I3e={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function u$(r={}){return{...I3e,...r}}function l$(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{let c=t.topics[o];if(c===void 0)return;let u=0;if(a.inMesh){let d=a.meshTime/c.timeInMeshQuantum;d>c.timeInMeshCap&&(d=c.timeInMeshCap),u+=d*c.timeInMeshWeight}let l=a.firstMessageDeliveries;if(l>c.firstMessageDeliveriesCap&&(l=c.firstMessageDeliveriesCap),u+=l*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){let d=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,m=d*d;u+=m*c.meshMessageDeliveriesWeight}let f=a.meshFailurePenalty;u+=f*c.meshFailurePenaltyWeight;let h=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=h*c.invalidMessageDeliveriesWeight,i+=u*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);let s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),c=a?a.size:0;if(c>t.IPColocationFactorThreshold){let u=c-t.IPColocationFactorThreshold,l=u*u;i+=l*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){let o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}var h$=C(d$(),1),Qn;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(Qn||(Qn={}));var k4=class{constructor(){this.records=new Map,this.queue=new h$.default}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:Qn.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};function N4(r,e,t=()=>!0){let n=new Set;if(e<=0)return n;for(let i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function p$(r,e){return N4(r,e,()=>!0)}var D4=class extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return t===void 0&&(t=this.getDefault(),this.set(e,t)),t}};var i0=D("libp2p:gossipsub:score"),O4=class{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new D4(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new k4,c$(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??l$}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){i0("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),i0("started")}stop(){if(!this._backgroundInterval){i0("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),i0("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{let a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,u;(a=this.metrics)==null||a.scoreFnCalls.inc();let t=this.peerStats.get(e);if(!t)return 0;let n=Date.now(),i=this.scoreCache.get(e);if(i&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();let s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i?((u=this.metrics)==null||u.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){var s;let i=this.peerStats.get(e);i&&(i.behaviourPenalty+=t,(s=this.metrics)==null||s.onScorePenalty(n))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.delete(t);let i=this.peerIPs.get(t);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;let s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);let i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==Qn.unknown){i0("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeen,Qn[i.status]);return}i.status=Qn.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case Yn.Error:this.markInvalidMessageDelivery(e,n);return;case Yn.Blacklisted:return}let s=this.deliveryRecords.ensureRecord(t);if(s.status!==Qn.unknown){i0("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,Qn[s.status]);return}if(i===Yn.Ignore){s.status=Qn.ignored,s.peers.clear();return}s.status=Qn.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){let i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case Qn.unknown:i.peers.add(e);break;case Qn.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case Qn.invalid:this.markInvalidMessageDelivery(e,n);break;case Qn.ignored:break}}markInvalidMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var s;let i=this.peerStats.get(e);if(i){let o=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a&&a.inMesh){let c=this.params.topics[t];if(n!==void 0){let l=o-n,f=l>c.meshMessageDeliveriesWindow;if((s=this.metrics)==null||s.onDuplicateMsgDelivery(t,l,f),f)return}let u=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(u,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let n of t){let i=this.peerIPs.get(n);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}};var L4=class{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i),o=this.promises.get(s);o||(o=new Map,this.promises.set(s,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){var i;let e=Date.now(),t=new Map,n=0;return this.promises.forEach((s,o)=>{s.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),s.delete(c),n++)}),s.size||this.promises.delete(o)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);let n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case Yn.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[i,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){let t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}};var s0=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}};var m$;(function(r){r.forward="forward",r.publish="publish"})(m$||(m$={}));var Ja;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Ja||(Ja={}));var Cf;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Unsub="unsubscribed",r.Excess="excess"})(Cf||(Cf={}));var a0;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(a0||(a0={}));var c0;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(c0||(c0={}));var o0;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(o0||(o0={}));function g$(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:r.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:r.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:r.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:r.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,1*t.maxMeshMessageDeliveriesWindowSec,2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,1*t.behaviourPenaltyThreshold,2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,1*t.gossipPromiseExpireSec,2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:i},s)},onRemoveFromMesh(n,i,s){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:i},s)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,i){let s=this.toTopic(n);this.asyncValidationResult.inc({topic:s,acceptance:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(let[s,o]of n){let a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){let s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},s*o),this.msgPublishPeers.inc({topic:a},s),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},i.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},i.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},i.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},i.fanout)},onMsgRecvPreValidation(n){let i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvResult(n,i){let s=this.toTopic(n);this.msgReceivedStatus.inc({topic:s,status:i})},onMsgRecvInvalid(n,i){let s=this.toTopic(n),o=i.reason===Yn.Error?i.error:i.reason;this.msgReceivedInvalid.inc({topic:s,error:o},1)},onDuplicateMsgDelivery(n,i,s){if(this.duplicateMsgDeliveryDelay.observe(i/1e3),s){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){let i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var s,o,a,c;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let u=((s=n.control.ihave)==null?void 0:s.length)??0,l=((o=n.control.iwant)==null?void 0:o.length)??0,f=((a=n.control.graft)==null?void 0:a.length)??0,h=((c=n.control.prune)==null?void 0:c.length)??0;u>0&&this.rpcSentIHave.inc(u),l>0&&this.rpcSentIWant.inc(l),f>0&&this.rpcSentGraft.inc(f),h>0&&this.rpcSentPrune.inc(h),(u>0||l>0||f>0||h>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(let u of n)u>=i.graylistThreshold&&s++,u>=i.publishThreshold&&o++,u>=i.gossipThreshold&&a++,u>=0&&c++;this.peersByScoreThreshold.set({threshold:o0.graylist},s),this.peersByScoreThreshold.set({threshold:o0.publish},o),this.peersByScoreThreshold.set({threshold:o0.gossip},a),this.peersByScoreThreshold.set({threshold:o0.mesh},c),this.score.set(n)},registerScoreWeights(n){for(let[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){let s=new Map;n.forEach((o,a)=>{let c=this.topicStrToLabel.get(a)??"unknown",u=s.get(c);u||(u=new Set,s.set(c,u)),o.forEach(l=>u==null?void 0:u.add(l))});for(let[o,a]of s){let c=[];a.forEach(u=>{c.push(i.get(u)??0)}),this.scorePerMesh.set({topic:o},c)}}}}var aQe=C(Hd(),1),C3e=C(it(),1);var w$=C(y_(),1),b$=C(Jt(),1);var y$={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function Hm(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){let a=Object.keys(y$).join(" / ");throw new ae(`Hash '${i}' is unknown or not supported. Must be ${a}`,"ERR_UNSUPPORTED_HASH_TYPE")}let s=y$[i],o=(0,w$.default)(r,e,t,n,s);return b$.default.encode64(o,null)}var _$=W("libp2p-pubsub:");async function E$(r,e,t,n){switch(r.type){case Vu.Signing:{let i={from:r.author.toBytes(),data:n,seqno:ri(8),topic:e,signature:void 0,key:void 0},s=ve([_$,Km.Message.encode(i).finish()]);i.signature=await r.privateKey.sign(s),i.key=r.key;let o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${j(i.seqno,"base16")}`),topic:e,signature:i.signature,key:i.key};return{raw:i,msg:o}}case Vu.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}}}}async function v$(r,e){switch(r){case n0:return e.signature!=null?{valid:!1,error:Bn.SignaturePresent}:e.seqno!=null?{valid:!1,error:Bn.SeqnoPresent}:e.key!=null?{valid:!1,error:Bn.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Rf:{if(e.seqno==null)return{valid:!1,error:Bn.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Bn.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Bn.InvalidSignature};if(e.from==null)return{valid:!1,error:Bn.InvalidPeerId};let t;try{t=wr(e.from)}catch{return{valid:!1,error:Bn.InvalidPeerId}}let n;if(e.key){if(n=ii(e.key),t.publicKey!==void 0&&!ke(n.bytes,t.publicKey))return{valid:!1,error:Bn.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:Bn.InvalidPeerId};n=ii(t.publicKey)}let i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=ve([_$,Km.Message.encode(i).finish()]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${j(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??u1(n)}}:{valid:!1,error:Bn.InvalidSignature}}}}var S$=(r,e)=>{let t=W(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n};function x$(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return S$(r.from.toBytes(),r.sequenceNumber)}async function T$(r){return await Pe.encode(r.data)}function D3e(r,e,t,n,i){let s=0,o=new Map;if(Object.entries(e.topics).forEach(([h,d])=>{let m=i.get(h)??"unknown",w=t.topics[h];if(w===void 0)return;let b=o.get(m);b||(b={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(m,b));let v=0,T=0,p=0,g=0,y=0;if(d.inMesh){let S=Math.max(d.meshTime/w.timeInMeshQuantum,w.timeInMeshCap);v+=S*w.timeInMeshWeight}let E=d.firstMessageDeliveries;if(E>w.firstMessageDeliveriesCap&&(E=w.firstMessageDeliveriesCap),T+=E*w.firstMessageDeliveriesWeight,d.meshMessageDeliveriesActive&&d.meshMessageDeliveries<w.meshMessageDeliveriesThreshold){let S=w.meshMessageDeliveriesThreshold-d.meshMessageDeliveries,I=S*S;p+=I*w.meshMessageDeliveriesWeight}let _=d.meshFailurePenalty;g+=_*w.meshFailurePenaltyWeight;let x=d.invalidMessageDeliveries*d.invalidMessageDeliveries;y+=x*w.invalidMessageDeliveriesWeight,s+=(v+T+p+g+y)*w.topicWeight,b.p1w+=v,b.p2w+=T,b.p3w+=p,b.p3bw+=g,b.p4w+=y}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;let h=t.topicScoreCap/s;for(let d of o.values())d.p1w*=h,d.p2w*=h,d.p3w*=h,d.p3bw*=h,d.p4w*=h}let a=0,c=0,u=0,l=t.appSpecificScore(r);a+=l*t.appSpecificWeight,e.knownIPs.forEach(h=>{if(t.IPColocationFactorWhitelist.has(h))return;let d=n.get(h),m=d?d.size:0;if(m>t.IPColocationFactorThreshold){let w=m-t.IPColocationFactorThreshold,b=w*w;c+=b*t.IPColocationFactorWeight}});let f=e.behaviourPenalty*e.behaviourPenalty;return u+=f*t.behaviourPenaltyWeight,s+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:s}}function A$(r,e,t,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of r){let a=e.get(o);if(a){let c=D3e(o,a,t,n,i);for(let[u,l]of c.byTopic){let f=s.byTopic.get(u);f||(f={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(u,f)),f.p1w.push(l.p1w),f.p2w.push(l.p2w),f.p3w.push(l.p3w),f.p3bw.push(l.p3bw),f.p4w.push(l.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}var zu=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function I$(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function Cr(r,e,t){let n=t??{},i=I$(r);async function*s(){let o,a=()=>{o!=null&&o()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:l,abortCode:f}=n;throw new zu(l,f)}let u=new Promise((l,f)=>{o=()=>{let{abortMessage:h,abortCode:d}=n;f(new zu(h,d))}});c=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof i.return=="function")try{let f=i.return();f instanceof Promise&&f.catch(h=>{n.onReturnError!=null&&n.onReturnError(h)})}catch(f){n.onReturnError!=null&&n.onReturnError(f)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return s()}function N3e(r,e,t){return n=>r(Cr(n,e,t))}function Mn(r,e,t){return{sink:N3e(r.sink,e,{...t,onAbort:void 0}),source:Cr(r.source,e,t)}}function R$(r){var e;return((e=globalThis==null?void 0:globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}var B4=r=>{let e=Qs.encodingLength(r),t=R$(e);return Qs.encode(r,t),B4.bytes=e,t};B4.bytes=0;function vr(r){r=r??{};let e=r.lengthEncoder??B4;return async function*(n){for await(let i of n){let s=e(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}}}vr.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??B4;return new qe(t(r.byteLength),r)};var $m=C(Y(),1),O3e=8,L3e=1024*1024*4,Pf;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Pf||(Pf={}));var NS=r=>{let e=Qs.decode(r);return NS.bytes=Qs.encodingLength(e),e};NS.bytes=0;function cr(r){return async function*(t){let n=new qe,i=Pf.LENGTH,s=-1,o=(r==null?void 0:r.lengthDecoder)??NS,a=(r==null?void 0:r.maxLengthLength)??O3e,c=(r==null?void 0:r.maxDataLength)??L3e;for await(let u of t)for(n.append(u);n.byteLength>0;){if(i===Pf.LENGTH)try{if(s=o(n),s<0)throw(0,$m.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>c)throw(0,$m.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let l=o.bytes;n.consume(l),(r==null?void 0:r.onLength)!=null&&r.onLength(s),i=Pf.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw(0,$m.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(i===Pf.DATA){if(n.byteLength<s)break;let l=n.sublist(0,s);n.consume(s),(r==null?void 0:r.onData)!=null&&r.onData(l),yield l,i=Pf.LENGTH}}if(n.byteLength>0)throw(0,$m.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}cr.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return cr({...e??{},onLength:s=>{t=s}})(n)};var M4=class{constructor(e,t,n){this.rawStream=e,this.pushable=Kt({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,_e(Cr(this.pushable,this.closeController.signal,{returnOnAbort:!0}),vr(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},U4=class{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=Cr(_e(this.rawStream,cr(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};var C$=C(IS(),1),P$={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function k$(r,e){e={...e};let t=C$.default.Reader.create(r),n=r.length,i=n===void 0?t.len:t.pos+n,s={};for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.length<e.maxSubscriptions?s.subscriptions.push(B3e(t,t.uint32())):t.skipType(o&7);break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.length<e.maxMessages?s.messages.push(M3e(t,t.uint32())):t.skipType(o&7);break;case 3:s.control=U3e(t,t.uint32(),e);break;default:t.skipType(o&7);break}}return s}function B3e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.subscribe=r.bool();break;case 2:n.topic=r.string();break;default:r.skipType(i&7);break}}return n}function M3e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.from=r.bytes();break;case 2:n.data=r.bytes();break;case 3:n.seqno=r.bytes();break;case 4:n.topic=r.string();break;case 5:n.signature=r.bytes();break;case 6:n.key=r.bytes();break;default:r.skipType(i&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function U3e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.length<t.maxControlMessages?i.ihave.push(F3e(r,r.uint32(),t)):r.skipType(s&7);break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.length<t.maxControlMessages?i.iwant.push(V3e(r,r.uint32(),t)):r.skipType(s&7);break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.length<t.maxControlMessages?i.graft.push(z3e(r,r.uint32())):r.skipType(s&7);break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.length<t.maxControlMessages?i.prune.push(K3e(r,r.uint32(),t)):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function F3e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.topicID=r.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIhaveMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function V3e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIwantMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(s&7);break;default:r.skipType(s&7);break}}return i}function z3e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.topicID=r.string();break;default:r.skipType(i&7);break}}return n}function K3e(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let s=r.uint32();switch(s>>>3){case 1:i.topicID=r.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),t.maxPeerInfos-- >0?i.peers.push(H3e(r,r.uint32())):r.skipType(s&7);break;case 3:i.backoff=r.uint64();break;default:r.skipType(s&7);break}}return i}function H3e(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.peerID=r.bytes();break;case 2:n.signedPeerRecord=r.bytes();break;default:r.skipType(i&7);break}}return n}var F4;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(F4||(F4={}));function D$(r){for(let e of r.tuples())switch(e[0]){case F4.ip4:case F4.ip6:return Wg(e[0],e[1])}return null}var Bi;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(Bi||(Bi={}));var V4=class extends Ue{constructor(e,t={}){super(),this.multicodecs=[PS,CS],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=Kt({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:Bi.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{var s;let i=(s=this.metrics)==null?void 0:s.heartbeatDuration.startTimer();this.heartbeat().catch(o=>{this.log("Error running heartbeat",o)}).finally(()=>{var o;if(i!=null&&i(),this.status.code===Bi.started){clearTimeout(this.status.heartbeatTimeout);let a=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;a<this.opts.heartbeatInterval*.25&&(a+=this.opts.heartbeatInterval,(o=this.metrics)==null||o.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,a)}})};let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:a$(t.scoreParams),scoreThresholds:u$(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??P$,this.globalSignaturePolicy=n.globalSignaturePolicy??Rf,n.fallbackToFloodsub&&this.multicodecs.push(RS),this.log=D(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(i=>i.id.toString())),this.seenCache=new s0({validityMs:n.seenTTL}),this.publishedMessageIds=new s0({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Rf:this.msgIdFn=x$;break;case n0:this.msgIdFn=T$;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new s0({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??s$,this.mcache=t.messageCache||new R4(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let i=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),1e3),s=g$(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:i/1e3});s.mcacheSize.addCollect(()=>this.onScrapeMetrics(s));for(let o of this.multicodecs)s.protocolsEnabled.set({protocol:o},1);this.metrics=s}else this.metrics=null;this.gossipTracer=new L4(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new O4(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>fe(e))}isStarted(){return this.status.code===Bi.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await DS(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=Kt({objectMode:!0}),_e(this.outboundInflightQueue,async s=>{for await(let{peerId:o,connection:a}of s)await this.createOutboundStream(o,a)}).catch(s=>this.log.error("outbound inflight queue error",s)),await Promise.all(this.opts.directPeers.map(async s=>{await this.components.peerStore.addressBook.add(s.id,s.addrs)}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(s=>e.handle(s,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let t=r0({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(s=>e.register(s,t))),i=setTimeout(this.runHeartbeat,100);this.status={code:Bi.started,registrarTopologyIds:n,heartbeatTimeout:i,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async s=>await this.connect(s)))}).catch(s=>{this.log(s)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Bi.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:Bi.stopped};let t=this.components.registrar;e.forEach(n=>t.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){var n;(n=this.metrics)==null||n.newConnectionCount.inc({status:t.stat.status}),!(!this.isStarted()||t.stat.status!=="OPEN")&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){var i;if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let s=new M4(await t.newStream(this.multicodecs),a=>this.log.error("outbound pipe error",a),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,s);let o=s.protocol;o===RS&&this.floodsubPeers.add(n),(i=this.metrics)==null||i.peersPerProtocol.inc({protocol:o},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}async createInboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let i=this.streamsInbound.get(n);i!==void 0&&(this.log("replacing existing inbound steam %s",n),i.close()),this.log("create inbound stream %s",n);let s=new U4(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,s),this.pipePeerReadStream(e,s.source).catch(o=>this.log(o))}addPeer(e,t,n){let i=e.toString();if(!this.peers.has(i)){this.log("new peer %p",e),this.peers.add(i),this.score.addPeer(i);let s=D$(n);s!==null?this.score.addIP(i,s):this.log("Added peer has no IP in current address %s %s",i,n.toString()),this.outbound.has(i)||this.outbound.set(i,t==="outbound")}}removePeer(e){var s,o;let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let n=this.streamsOutbound.get(t),i=this.streamsInbound.get(t);n&&((s=this.metrics)==null||s.peersPerProtocol.inc({protocol:n.protocol},-1)),n==null||n.close(),i==null||i.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(let a of this.topics.values())a.delete(t);for(let[a,c]of this.mesh)c.delete(t)===!0&&((o=this.metrics)==null||o.onRemoveFromMesh(a,Cf.Dc,1));for(let a of this.fanout.values())a.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Bi.started}getMeshPeers(e){let t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(t?Array.from(t):[]).map(n=>fe(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await _e(t,async n=>{var i;for await(let s of n)try{let o=s.subarray(),a=k$(o,this.decodeRpcLimits);(i=this.metrics)==null||i.onRpcRecv(a,o.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,a):this.handleReceivedRpc(e,a).catch(c=>this.log(c))}catch(o){this.log(o)}})}catch(n){this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){var n;if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),(n=this.metrics)==null||n.rpcRecvNotAccepted.inc();return}if(this.log("rpc from %p",e),t.subscriptions&&t.subscriptions.length>0){let i=[];t.subscriptions.forEach(s=>{let o=s.topic,a=s.subscribe===!0;if(o!=null){if(this.allowedTopics&&!this.allowedTopics.has(o))return;this.handleReceivedSubscription(e,o,a),i.push({topic:o,subscribe:a})}}),this.dispatchEvent(new ie("subscription-change",{detail:{peerId:e,subscriptions:i}}))}if(t.messages)for(let i of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(i.topic))continue;let s=this.handleReceivedMessage(e,i).catch(o=>this.log(o));this.opts.awaitRpcMessageHandler&&await s}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let i=this.topics.get(t);i==null&&(i=new Set,this.topics.set(t,i)),n?i.add(e.toString()):i.delete(e.toString())}async handleReceivedMessage(e,t){var i,s,o;(i=this.metrics)==null||i.onMsgRecvPreValidation(t.topic);let n=await this.validateReceivedMessage(e,t);switch((s=this.metrics)==null||s.onMsgRecvResult(t.topic,n.code),n.code){case hs.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case hs.invalid:if(n.msgIdStr){let a=n.msgIdStr;this.score.rejectMessage(e.toString(),a,t.topic,n.reason),this.gossipTracer.rejectMessage(a,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);(o=this.metrics)==null||o.onMsgRecvInvalid(t.topic,n);return;case hs.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new ie("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new ie("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){var f,h,d;let n=(f=this.fastMsgIdFn)==null?void 0:f.call(this,t),i=n!==void 0?(h=this.fastMsgIdCache)==null?void 0:h.get(n):void 0;if(i)return{code:hs.duplicate,msgIdStr:i};let s=await v$(this.globalSignaturePolicy,t);if(!s.valid)return{code:hs.invalid,reason:Yn.Error,error:s.error};let o=s.message;try{this.dataTransform&&(o.data=this.dataTransform.inboundTransform(t.topic,o.data))}catch(m){return this.log("Invalid message, transform failed",m),{code:hs.invalid,reason:Yn.Error,error:Bn.TransformFailed}}let a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:c};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,c)&&((d=this.metrics)==null||d.fastMsgIdCacheCollision.inc()),this.seenCache.has(c))return{code:hs.duplicate,msgIdStr:c};this.seenCache.put(c);let l=this.topicValidators.get(t.topic);if(l!=null){let m;try{m=await l(e,o)}catch(w){let b=w.code;b===i$&&(m=Zs.Ignore),b===n$?m=Zs.Reject:m=Zs.Ignore}if(m!==Zs.Accept)return{code:hs.invalid,reason:kS(m),msgIdStr:c}}return{code:hs.valid,messageId:u,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map(i=>({topic:i,subscribe:n}))})}async handleControlMessage(e,t){if(t===void 0)return;let n=t.ihave?this.handleIHave(e,t.ihave):[],i=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];t.prune&&await this.handlePrune(e,t.prune),!(!n.length&&!i.length&&!s.length)&&this.sendRpc(e,{messages:i,control:{iwant:n,prune:s}})}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;let i=this.score.score(e);return i>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){var u,l,f;if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),(u=this.metrics)==null||u.ihaveRcvIgnored.inc({reason:c0.LowScore}),[];let i=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,i),(l=this.metrics)==null||l.ihaveRcvIgnored.inc({reason:c0.MaxIhave}),[];let s=this.iasked.get(e)??0;if(s>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),(f=this.metrics)==null||f.ihaveRcvIgnored.inc({reason:c0.MaxIasked}),[];let o=new Map;if(t.forEach(({topicID:h,messageIDs:d})=>{var w;if(!h||!d||!this.mesh.has(h))return;let m=0;d.forEach(b=>{let v=this.msgIdToStrFn(b);this.seenCache.has(v)||(o.set(v,b),m++)}),(w=this.metrics)==null||w.onIhaveRcv(h,d.length,m)}),!o.size)return[];let a=o.size;a+s>5e3&&(a=5e3-s),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let c=Array.from(o.values());return Wo(c),c=c.slice(0,a),this.iasked.set(e,s+a),this.gossipTracer.addPromise(e,c),[{messageIDs:c}]}handleIWant(e,t){var a;if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let i=new Map,s=new Map,o=0;return t.forEach(({messageIDs:c})=>{c&&c.forEach(u=>{let l=this.msgIdToStrFn(u),f=this.mcache.getWithIWantCount(l,e);if(f==null){o++;return}if(s.set(f.msg.topic,1+(s.get(f.msg.topic)??0)),f.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,u);return}i.set(l,f.msg)})}),(a=this.metrics)==null||a.onIwantRcv(s,o),i.size?(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){let n=[],i=this.score.score(e),s=Date.now(),o=this.opts.doPX;return t.forEach(({topicID:a})=>{var l,f;if(!a)return;let c=this.mesh.get(a);if(!c){o=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let u=(l=this.backoff.get(a))==null?void 0:l.get(e);if(typeof u=="number"&&s<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,a0.GraftBackoff),o=!1;let h=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;s<h&&this.score.addPenalty(e,1,a0.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(i<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,i,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),(f=this.metrics)==null||f.onAddToMesh(a,Ja.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,t){var i;let n=this.score.score(e);for(let{topicID:s,backoff:o,peers:a}of t){if(s==null)continue;let c=this.mesh.get(s);if(!c)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,s),this.score.prune(e,s),c.has(e)&&(c.delete(e),(i=this.metrics)==null||i.onRemoveFromMesh(s,Cf.Unsub,1)),typeof o=="number"&&o>0?this.doAddBackoff(e,s,o*1e3):this.addBackoff(e,s),a&&a.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,s);continue}await this.pxConnect(a)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let i=this.backoff.get(t);i||(i=new Map,this.backoff.set(t,i));let s=Date.now()+n;(i.get(e)??0)<s&&i.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,a0.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((t,n)=>{t.forEach((i,s)=>{i<e&&t.delete(s)}),t.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async t=>await this.connect(t)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Wo(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let i=wr(n.peerID).toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){t.push(i);return}try{let s=await Mr.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=s.peerId;if(!s.peerId.equals(i)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,i);return}if(!await this.components.peerStore.addressBook.consumePeerRecord(s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}t.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),t.length&&await Promise.all(t.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let t=fe(e),n=await this.components.connectionManager.openConnection(t);for(let i of this.multicodecs)for(let s of this.components.registrar.getTopologies(i))s.onConnect(t,n)}subscribe(e){if(this.status.code!==Bi.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Bi.started)throw new Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){var i,s,o;if(this.status.code!==Bi.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),(i=this.metrics)==null||i.onJoin(e);let t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(a=>{!this.direct.has(a)&&this.score.score(a)>=0&&t.add(a)}),(s=this.metrics)==null||s.onAddToMesh(e,Ja.Fanout,t.size)),t.size<this.opts.D){let a=t.size;this.getRandomGossipPeers(e,this.opts.D,u=>!t.has(u)&&!this.direct.has(u)&&this.score.score(u)>=0).forEach(u=>{t.add(u)}),(o=this.metrics)==null||o.onAddToMesh(e,Ja.Random,t.size-a)}this.mesh.set(e,t),t.forEach(a=>{this.log("JOIN: Add mesh link to %s in %s",a,e),this.sendGraft(a,e)})}leave(e){var n;if(this.status.code!==Bi.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),(n=this.metrics)==null||n.onLeave(e);let t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map(async i=>(this.log("LEAVE: Remove mesh link to %s in %s",i,e),await this.sendPrune(i,e)))).catch(i=>{this.log("Error sending prunes to mesh peers",i)}),this.mesh.delete(e))}selectPeersToForward(e,t,n){let i=new Set,s=this.topics.get(e);s&&(this.direct.forEach(a=>{s.has(a)&&t!==a&&!(n!=null&&n.has(a))&&i.add(a)}),this.floodsubPeers.forEach(a=>{s.has(a)&&t!==a&&!(n!=null&&n.has(a))&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&i.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{t!==a&&!(n!=null&&n.has(a))&&i.add(a)}),i}selectPeersToPublish(e){let t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(e);if(i)if(this.opts.floodPublish)i.forEach(s=>{this.direct.has(s)?(t.add(s),n.direct++):this.score.score(s)>=this.opts.scoreThresholds.publishThreshold&&(t.add(s),n.floodsub++)});else{this.direct.forEach(o=>{i.has(o)&&(t.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{i.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(t.add(o),n.floodsub++)});let s=this.mesh.get(e);if(s&&s.size>0)s.forEach(o=>{t.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{t.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{t.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,i){var o;n&&this.score.deliverMessage(n,e,t.topic);let s=this.selectPeersToForward(t.topic,n,i);s.forEach(a=>{this.sendRpc(a,{messages:[t]})}),(o=this.metrics)==null||o.onForwardMsg(t.topic,s.size)}async publish(e,t,n){var m,w;let i=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:s,msg:o}=await E$(this.publishConfig,e,t,i),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u=(n==null?void 0:n.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return(m=this.metrics)==null||m.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:l,tosendCount:f}=this.selectPeersToPublish(e),h=this.opts.emitSelf===!0&&this.subscriptions.has(e),d=(n==null?void 0:n.allowPublishToZeroPeers)??this.opts.allowPublishToZeroPeers;if(l.size===0&&!d&&!h)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},s,!0),this.publishedMessageIds.put(c);for(let b of l)this.sendRpc(b,{messages:[s]})||l.delete(b);return(w=this.metrics)==null||w.onPublishMsg(e,f,l.size,s.data!=null?s.data.length:0),h&&(l.add(this.components.peerId.toString()),super.dispatchEvent(new ie("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new ie("message",{detail:o}))),{recipients:Array.from(l.values()).map(b=>fe(b))}}reportMessageValidationResult(e,t,n){var i,s,o,a;if(n===Zs.Accept){let c=this.mcache.validate(e);if((i=this.metrics)==null||i.onReportValidationMcacheHit(c!==null),c!=null){let{message:u,originatingPeers:l}=c;this.score.deliverMessage(t.toString(),e,u.topic),this.forwardMessage(e,c.message,t.toString(),l),(s=this.metrics)==null||s.onReportValidation(u.topic,n)}}else{let c=this.mcache.remove(e);if((o=this.metrics)==null||o.onReportValidationMcacheHit(c!==null),c){let u=kS(n),{message:l,originatingPeers:f}=c;this.score.rejectMessage(t.toString(),e,l.topic,u);for(let h of f)this.score.rejectMessage(h,e,l.topic,u);(a=this.metrics)==null||a.onReportValidation(l.topic,n)}}}sendGraft(e,t){let n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){let n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){var a;let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let i=this.control.get(e);i&&(this.piggybackControl(e,t,i),this.control.delete(e));let s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));let o=Km.encode(t).finish();try{n.push(o)}catch(c){return this.log.error(`Cannot send rpc to ${e}`,c),i&&this.control.set(e,i),s&&this.gossip.set(e,s),!1}return(a=this.metrics)==null||a.onRpcSent(t,o.length),!0}piggybackControl(e,t,n){var i,s;if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(let o of n.graft)o.topicID&&((i=this.mesh.get(o.topicID))!=null&&i.has(e))&&t.control.graft.push(o)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(let o of n.prune)o.topicID&&!((s=this.mesh.get(o.topicID))!=null&&s.has(e))&&t.control.prune.push(o)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){let i=this.opts.doPX;for(let[s,o]of e){let a=o.map(l=>({topicID:l})),c=[],u=t.get(s);u&&(c=await Promise.all(u.map(async l=>await this.makePrune(s,l,i&&!(n.get(s)??!1)))),t.delete(s)),this.sendRpc(s,{control:{graft:a,prune:c}})}for(let[s,o]of t){let a=await Promise.all(o.map(async c=>await this.makePrune(s,c,i&&!(n.get(s)??!1))));this.sendRpc(s,{control:{prune:a}})}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,i]of e)this.doEmitGossip(n,i,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length||(Wo(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size))return;let i=this.opts.Dlazy,s=.25*t.size,o=t;s>i&&(i=s),i>o.size?i=o.size:o=Wo(Array.from(o)).slice(0,i),o.forEach(a=>{let c=n;n.length>5e3&&(c=Wo(c.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(let[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===CS)return{topicID:t,peers:[]};let i=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:i};let s=this.getRandomGossipPeers(t,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(s).map(async a=>{let c=fe(a);return{peerID:c.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(c)}}));return{topicID:t,peers:o,backoff:i}}async heartbeat(){var m,w;let{D:e,Dlo:t,Dhi:n,Dscore:i,Dout:s,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,c=b=>{let v=a.get(b);return v===void 0&&(v=this.score.score(b),a.set(b,v)),v},u=new Map,l=new Map,f=new Map;this.clearBackoff(),this.peerhave.clear(),(m=this.metrics)==null||m.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(w=this.fastMsgIdCache)==null||w.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let h=new Map;this.mesh.forEach((b,v)=>{let T=this.topics.get(v),p=new Set,g=new Set;if(h.set(v,g),T){let _=Wo(Array.from(T)),x=this.backoff.get(v);for(let S of _){let I=this.streamsOutbound.get(S);if(I&&this.multicodecs.includes(I.protocol)&&!b.has(S)&&!this.direct.has(S)){let k=c(S);(!x||!x.has(S))&&k>=0&&p.add(S),k>=this.opts.scoreThresholds.gossipThreshold&&g.add(S)}}}let y=(_,x)=>{var I;this.log("HEARTBEAT: Remove mesh link to %s in %s",_,v),this.addBackoff(_,v),b.delete(_),c(_)>=this.opts.scoreThresholds.gossipThreshold&&g.add(_),(I=this.metrics)==null||I.onRemoveFromMesh(v,x,1);let S=l.get(_);S?S.push(v):l.set(_,[v])},E=(_,x)=>{var I;this.log("HEARTBEAT: Add mesh link to %s in %s",_,v),this.score.graft(_,v),b.add(_),g.delete(_),(I=this.metrics)==null||I.onAddToMesh(v,x,1);let S=u.get(_);S?S.push(v):u.set(_,[v])};if(b.forEach(_=>{let x=c(_);x<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",_,x,v),y(_,Cf.BadScore),f.set(_,!0))}),b.size<t){let _=e-b.size;p$(p,_).forEach(S=>{E(S,Ja.NotEnough)})}if(b.size>n){let _=Array.from(b);_.sort((S,I)=>c(I)-c(S)),_=_.slice(0,i).concat(Wo(_.slice(i)));let x=0;if(_.slice(0,e).forEach(S=>{this.outbound.get(S)&&x++}),x<s){let S=k=>{let N=_[k];for(let L=k;L>0;L--)_[L]=_[L-1];_[0]=N};if(x>0){let k=x;for(let N=1;N<e&&k>0;N++)this.outbound.get(_[N])&&(S(N),k--)}let I=e-x;for(let k=e;k<_.length&&I>0;k++)this.outbound.get(_[k])&&(S(k),I--)}_.slice(e).forEach(S=>{y(S,Cf.Excess)})}if(b.size>=t){let _=0;if(b.forEach(x=>{this.outbound.get(x)&&_++}),_<s){let x=s-_;N4(p,x,I=>this.outbound.get(I)===!0).forEach(I=>{E(I,Ja.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&b.size>1){let _=Array.from(b).sort((I,k)=>c(I)-c(k)),x=Math.floor(b.size/2),S=c(_[x]);if(S<this.opts.scoreThresholds.opportunisticGraftThreshold){let I=this.opts.opportunisticGraftPeers,k=N4(p,I,N=>c(N)>S);for(let N of k)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",N,v),E(N,Ja.Opportunistic)}}});let d=Date.now();this.fanoutLastpub.forEach((b,v)=>{b+o<d&&(this.fanout.delete(v),this.fanoutLastpub.delete(v))}),this.fanout.forEach((b,v)=>{let T=this.topics.get(v);b.forEach(E=>{(!T.has(E)||c(E)<this.opts.scoreThresholds.publishThreshold)&&b.delete(E)});let p=this.topics.get(v),g=[],y=new Set;if(h.set(v,y),p){let E=Wo(Array.from(p));for(let _ of E){let x=this.streamsOutbound.get(_);if(x&&this.multicodecs.includes(x.protocol)&&!b.has(_)&&!this.direct.has(_)){let S=c(_);S>=this.opts.scoreThresholds.publishThreshold&&g.push(_),S>=this.opts.scoreThresholds.gossipThreshold&&y.add(_)}}}if(b.size<e){let E=e-b.size;g.slice(0,E).forEach(_=>{b.add(_),y==null||y.delete(_)})}}),this.emitGossip(h),await this.sendGraftPrune(u,l,f),this.flush(),this.mcache.shift(),this.dispatchEvent(new ie("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=()=>!0){let i=this.topics.get(e);if(!i)return new Set;let s=[];return i.forEach(o=>{let a=this.streamsOutbound.get(o);a&&this.multicodecs.includes(a.protocol)&&n(o)&&s.push(o)}),s=Wo(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){var o,a;e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},((o=this.fastMsgIdCache)==null?void 0:o.size)??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(let c of this.backoff.values())t+=c.size;e.cacheSize.set({cache:"backoff"},t);for(let[c,u]of this.topics)e.topicPeersCount.set({topicStr:c},u.size);for(let[c,u]of this.mesh)e.meshPeerCounts.set({topicStr:c},u.size);let n=[],i=new Map;e.behaviourPenalty.reset();for(let c of this.peers.keys()){let u=this.score.score(c);n.push(u),i.set(c,u),e.behaviourPenalty.observe(((a=this.score.peerStats.get(c))==null?void 0:a.behaviourPenalty)??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let s=A$(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}};V4.multicodec=PS;function O$(r={}){return e=>new V4(e,r)}var L$=()=>({gossipsub:O$({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})});var F$=C(Y(),1),OS=C(Kn(),1);var kf=D("libp2p-delegated-peer-routing"),B$=3e4,yye=4,M$;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(M$||(M$={}));var U$;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(U$||(U$={}));var LS=class{constructor(e){if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Ot({concurrency:yye});let{protocol:t,host:n,port:i}=e.getEndpointConfig();kf(`enabled DelegatedPeerRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){kf("findPeer starts: %p",e),t.timeout=t.timeout??B$,t.signal=(0,OS.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=vt(),i=vt();this.httpQueue.add(async()=>(n.resolve(),await i.promise));try{await n.promise;for await(let s of this.client.dht.findPeer(e,t))if(s.name==="FINAL_PEER")return{id:s.peer.id,multiaddrs:s.peer.multiaddrs,protocols:[]}}catch(s){throw kf.error("findPeer errored: %o",s),s}finally{i.resolve(),kf("findPeer finished: %p",e)}throw(0,F$.default)(new Error("Not found"),"ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){let n,i=P.asCID(e);i!=null?n=i:n=wr(e),kf("getClosestPeers starts: %s",n),t.timeout=t.timeout??B$,t.signal=(0,OS.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let s=vt(),o=vt();this.httpQueue.add(async()=>(s.resolve(),await o.promise));try{await s.promise;for await(let a of this.client.dht.query(n,t))a.name==="PEER_RESPONSE"&&(yield*a.closer.map(c=>({id:c.id,multiaddrs:c.multiaddrs,protocols:[]})))}catch(a){throw kf.error("getClosestPeers errored:",a),a}finally{o.resolve(),kf("getClosestPeers finished: %b",e)}}};function V$(r){return()=>new LS(r)}var BS=C(Y(),1),qm=C(Kn(),1),Yo=D("libp2p:delegated-content-routing"),z4=3e4,wye=4,bye=2,z$;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(z$||(z$={}));var K$;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(K$||(K$={}));var MS=class{constructor(e){if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Ot({concurrency:wye}),this.httpQueueRefs=new Ot({concurrency:bye});let{protocol:t,host:n,port:i}=e.getEndpointConfig();Yo(`enabled DelegatedContentRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){Yo("findProviders starts: %c",e),t.timeout=t.timeout??z4,t.signal=(0,qm.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=vt(),i=vt();this.httpQueue.add(async()=>(n.resolve(),await i.promise));try{await n.promise;for await(let s of this.client.dht.findProvs(e,t))s.name==="PROVIDER"&&(yield*s.providers.map(o=>({id:o.id,protocols:[],multiaddrs:o.multiaddrs})))}catch(s){throw Yo.error("findProviders errored:",s),s}finally{i.resolve(),Yo("findProviders finished: %c",e)}}async provide(e,t={}){Yo("provide starts: %c",e),t.timeout=t.timeout??z4,t.signal=(0,qm.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[])),await this.httpQueueRefs.add(async()=>{await this.client.block.stat(e,t),await Rt(this.client.dht.provide(e,t))}),Yo("provide finished: %c",e)}async put(e,t,n={}){Yo("put value start: %b",e),n.timeout=n.timeout??z4,n.signal=(0,qm.default)([this.abortController.signal].concat(n.signal!=null?[n.signal]:[])),await this.httpQueue.add(async()=>{await Rt(this.client.dht.put(e,t,n))}),Yo("put value finished: %b",e)}async get(e,t={}){Yo("get value start: %b",e),t.timeout=t.timeout??z4,t.signal=(0,qm.default)([this.abortController.signal].concat(t.signal!=null?[t.signal]:[]));let n=await this.httpQueue.add(async()=>{for await(let i of this.client.dht.get(e,t))if(i.name==="VALUE")return Yo("get value finished: %b",e),i.value;throw(0,BS.default)(new Error("Not found"),"ERR_NOT_FOUND")});if(n===void 0)throw(0,BS.default)(new Error("Not found"),"ERR_NOT_FOUND");return n}};function H$(r){return()=>new MS(r)}var _ye=r=>Promise.reject(new Error(`No base found for "${r}"`)),l0=class{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||_ye;for(let t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];let t=await this._loadBase(e);return this._basesByName[t.name]==null&&this._basesByPrefix[t.prefix]==null&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}};var Eye=r=>Promise.reject(new Error(`No codec found for "${r}"`)),f0=class{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||Eye;for(let t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){let t=typeof e=="string"?this._codecsByName:this._codecsByCode;if(t[e])return t[e];let n=await this._loadCodec(e);return t[e]==null&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}};var vye=r=>Promise.reject(new Error(`No hasher found for "${r}"`)),d0=class{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||vye;for(let t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){let t=typeof e=="string"?this._hashersByName:this._hashersByCode;if(t[e])return t[e];let n=await this._loadHasher(e);return t[e]==null&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}};var Qo=C(_g(),1);var Df=C(Ld(),1);function US(r){try{r=Th(oe(r))}catch{}return r=r.toString(),r}var $$=()=>{};var q$=D("ipfs-http-client:lib:error-handler"),Sye=Ve.bind({ignoreUndefined:!0}),xye=Qo.isBrowser||Qo.isWebWorker?location.protocol:"http",Tye=Qo.isBrowser||Qo.isWebWorker?location.hostname:"localhost",Aye=Qo.isBrowser||Qo.isWebWorker?location.port:"5001",Iye=(r={})=>{let e,t={},n;if(typeof r=="string"||Pn(r))e=new URL(US(r));else if(r instanceof URL)e=r;else if(typeof r.url=="string"||Pn(r.url))e=new URL(US(r.url)),t=r;else if(r.url instanceof URL)e=r.url,t=r;else{t=r||{};let i=(t.protocol||xye).replace(":",""),s=(t.host||Tye).split(":")[0],o=t.port||Aye;e=new URL(`${i}://${s}:${o}`)}if(t.apiPath?e.pathname=t.apiPath:(e.pathname==="/"||e.pathname===void 0)&&(e.pathname="api/v0"),Qo.isNode){let i=$$(e);n=t.agent||new i({keepAlive:!0,maxSockets:6})}return{...t,host:e.host,protocol:e.protocol.replace(":",""),port:Number(e.port),apiPath:e.pathname,url:e,agent:n}},Rye=async r=>{let e;try{if((r.headers.get("Content-Type")||"").startsWith("application/json")){let n=await r.json();q$(n),e=n.Message||n.message}else e=await r.text()}catch(n){q$("Failed to parse error response",n),e=n.message}let t=new Df.default.HTTPError(r);throw e&&(e.includes("deadline has elapsed")&&(t=new Df.default.TimeoutError),e&&e.includes("context deadline exceeded")&&(t=new Df.default.TimeoutError)),e&&e.includes("request timed out")&&(t=new Df.default.TimeoutError),e&&(t.message=e),t},Cye=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,G$=r=>r.replace(Cye,function(e){return"-"+e.toLowerCase()}),Pye=r=>typeof r=="string"?Oc(r):r,Hu=class extends Df.default{constructor(e={}){let t=Iye(e);super({timeout:Pye(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:Rye,transformSearchParams:i=>{let s=new URLSearchParams;for(let[o,a]of i)a!=="undefined"&&a!=="null"&&o!=="signal"&&s.append(G$(o),a),o==="timeout"&&!isNaN(a)&&s.append(G$(o),a);return s},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;let n=this.fetch;this.fetch=(i,s={})=>(typeof i=="string"&&!i.startsWith("/")&&(i=`${t.url}/${i}`),n.call(this,i,Sye(s,{method:"POST"})))}},hZe=Df.default.HTTPError;var O=r=>e=>r(new Hu(e),e);function K4(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}var j$=C(Y(),1);function H4(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,j$.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}function U({arg:r,searchParams:e,hashAlg:t,mtime:n,mode:i,...s}={}){e&&(s={...s,...e}),t&&(s.hash=t),n!=null&&(n=H4(n),s.mtime=n.secs,s.mtimeNsecs=n.nsecs),i!=null&&(s.mode=K4(i)),s.timeout&&!isNaN(s.timeout)&&(s.timeout=`${s.timeout}ms`),r==null?r=[]:Array.isArray(r)||(r=[r]);let o=new URLSearchParams(s);return r.forEach(a=>o.append("arg",a)),o}var W$=O(r=>{async function e(t={}){return((await(await r.post("bitswap/wantlist",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).Keys||[]).map(i=>P.parse(i["/"]))}return e});var Y$=O(r=>{async function e(t,n={}){return((await(await r.post("bitswap/wantlist",{signal:n.signal,searchParams:U({...n,peer:t.toString()}),headers:n.headers})).json()).Keys||[]).map(s=>P.parse(s["/"]))}return e});var $4=O(r=>{async function e(t={}){let n=await r.post("bitswap/stat",{searchParams:U(t),signal:t.signal,headers:t.headers});return kye(await n.json())}return e});function kye(r){return{provideBufLen:r.ProvideBufLen,wantlist:(r.Wantlist||[]).map(e=>P.parse(e["/"])),peers:(r.Peers||[]).map(e=>fe(e)),blocksReceived:BigInt(r.BlocksReceived),dataReceived:BigInt(r.DataReceived),blocksSent:BigInt(r.BlocksSent),dataSent:BigInt(r.DataSent),dupBlksReceived:BigInt(r.DupBlksReceived),dupDataReceived:BigInt(r.DupDataReceived)}}var Q$=O(r=>{async function e(t,n={}){return(await r.post("bitswap/unwant",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers})).json()}return e});function X$(r){return{wantlist:W$(r),wantlistForPeer:Y$(r),unwant:Q$(r),stat:$4(r)}}var q4=O(r=>{async function e(t,n={}){let i=await r.post("block/get",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await i.arrayBuffer())}return e});var J$=C(Y(),1);async function eq(r){if(is(r))return new Blob([r]);if(typeof r=="string"||r instanceof String)return new Blob([r.toString()]);if(Ma(r))return r;if(Ua(r)&&(r=ai(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=Ks(r),{value:t,done:n}=await e.peek();if(n)return Z$(e);if(e.push(t),Number.isInteger(t))return new Blob([Uint8Array.from(await rn(e))]);if(is(t)||typeof t=="string"||t instanceof String)return Z$(e)}throw(0,J$.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}async function Z$(r){let e=[];for await(let t of r)e.push(t);return new Blob(e)}function tq(r){return Ky(r,eq,!0)}function rq(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}async function Gr(r,e,t={}){let n=[],i=new FormData,s=0,o=0;for await(let{content:a,path:c,mode:u,mtime:l}of tq(r)){let f="",h=a?"file":"dir";s>0&&(f=`-${s}`);let d=h+f,m=[];if(u!=null&&m.push(`mode=${rq(u)}`),l!=null){let{secs:w,nsecs:b}=l;m.push(`mtime=${w}`),b!=null&&m.push(`mtime-nsecs=${b}`)}if(m.length&&(d=`${d}?${m.join("&")}`),a){i.set(d,a,c!=null?encodeURIComponent(c):void 0);let w=o+a.size;n.push({name:c,start:o,end:w}),o=w}else if(c!=null)i.set(d,new File([""],encodeURIComponent(c),{type:"application/x-directory"}));else throw new Error("path or content or both must be set");s++}return{total:o,parts:n,headers:t,body:i}}var nq=C(Kn(),1);function Dye(r){return r.filter(Boolean)}function jr(...r){return(0,nq.anySignal)(Dye(r))}var iq=O(r=>{async function e(t,n={}){let i=new AbortController,s=jr(i.signal,n.signal),o;try{o=await(await r.post("block/put",{signal:s,searchParams:U(n),...await Gr([t],i,n.headers)})).json()}catch(a){if(n.format==="dag-pb")return e(t,{...n,format:"protobuf"});if(n.format==="dag-cbor")return e(t,{...n,format:"cbor"});throw a}return P.parse(o.Key)}return e});var sq=O(r=>{async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.post("block/rm",{signal:n.signal,searchParams:U({arg:t.map(s=>s.toString()),"stream-channels":!0,...n}),headers:n.headers});for await(let s of i.ndjson())yield Nye(s)}return e});function Nye(r){let e={cid:P.parse(r.Hash)};return r.Error&&(e.error=new Error(r.Error)),e}var oq=O(r=>{async function e(t,n={}){let s=await(await r.post("block/stat",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers})).json();return{cid:P.parse(s.Key),size:s.Size}}return e});function aq(r){return{get:q4(r),put:iq(r),rm:sq(r),stat:oq(r)}}var cq=O(r=>{async function e(t,n={}){let i=await r.post("bootstrap/add",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),{Peers:s}=await i.json();return{Peers:s.map(o=>oe(o))}}return e});var uq=O(r=>{async function e(t={}){let n=await r.post("bootstrap/rm",{signal:t.signal,searchParams:U({...t,all:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>oe(s))}}return e});var lq=O(r=>{async function e(t={}){let n=await r.post("bootstrap/list",{signal:t.signal,searchParams:U(t),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>oe(s))}}return e});var fq=O(r=>{async function e(t={}){let n=await r.post("bootstrap/add",{signal:t.signal,searchParams:U({...t,default:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(s=>oe(s))}}return e});var dq=O(r=>{async function e(t,n={}){let i=await r.post("bootstrap/rm",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),{Peers:s}=await i.json();return{Peers:s.map(o=>oe(o))}}return e});function hq(r){return{add:cq(r),clear:uq(r),list:lq(r),reset:fq(r),rm:dq(r)}}var pq=O(r=>{async function e(t,n={}){let s=await(await r.post("config/profile/apply",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json();return{original:s.OldCfg,updated:s.NewCfg}}return e});function dt(r){if(r==null)return r;let e=/^[A-Z]+$/,t={};return Object.keys(r).reduce((n,i)=>(e.test(i)?n[i.toLowerCase()]=r[i]:e.test(i[0])?n[i[0].toLowerCase()+i.slice(1)]=r[i]:n[i]=r[i],n),t)}var mq=O(r=>{async function e(t={}){return(await(await r.post("config/profile/list",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).map(s=>dt(s))}return e});function gq(r){return{apply:pq(r),list:mq(r)}}var yq=O(r=>async(t,n={})=>{if(!t)throw new Error("key argument is required");return(await(await r.post("config",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json()).Value});var wq=O(r=>async(t={})=>await(await r.post("config/show",{signal:t.signal,searchParams:U({...t}),headers:t.headers})).json());var bq=O(r=>async(t,n={})=>{let i=new AbortController,s=jr(i.signal,n.signal);await(await r.post("config/replace",{signal:s,searchParams:U(n),...await Gr([W(JSON.stringify(t))],i,n.headers)})).text()});var _q=O(r=>async(t,n,i={})=>{if(typeof t!="string")throw new Error("Invalid key type");let s={...i,...Oye(t,n)};await(await r.post("config",{signal:i.signal,searchParams:U(s),headers:i.headers})).text()}),Oye=(r,e)=>{switch(typeof e){case"boolean":return{arg:[r,e.toString()],bool:!0};case"string":return{arg:[r,e]};default:return{arg:[r,JSON.stringify(e)],json:!0}}};function Eq(r){return{getAll:wq(r),get:yq(r),set:_q(r),replace:bq(r),profiles:gq(r)}}var vq=O(r=>{async function*e(t,n={}){yield*(await r.post("dag/export",{signal:n.signal,searchParams:U({arg:t.toString()}),headers:n.headers})).iterator()}return e});var FS=C(Y(),1);async function*VS(r,e,t,n,i){let s=async u=>{let l=await t.getCodec(u.code),f=await n(u,i);return l.decode(f)},o=e.split("/").filter(Boolean),a=await s(r),c=r;for(;o.length;){let u=o.shift();if(!u)throw(0,FS.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw(0,FS.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");let l=P.asCID(a);l&&(c=l,a=await s(a))}yield{value:a,remainderPath:""}}var Sq=C(Y(),1);var xq=(r,e)=>O((n,i)=>{let s=q4(i);return async(a,c={})=>{if(c.path){let d=c.localResolve?await Tr(VS(a,c.path,r,s,c)):await Wt(VS(a,c.path,r,s,c));if(!d)throw(0,Sq.default)(new Error("Not found"),"ERR_NOT_FOUND");return d}let u=await r.getCodec(a.code),l=await s(a,c);return{value:u.decode(l),remainderPath:""}}})(e);var Tq=O(r=>{async function*e(t,n={}){let i=new AbortController,s=jr(i.signal,n.signal),{headers:o,body:a}=await Gr(t,i,n.headers),c=await r.post("dag/import",{signal:s,headers:o,body:a,searchParams:U({"pin-roots":n.pinRoots})});for await(let{Root:u}of c.ndjson())if(u!==void 0){let{Cid:{"/":l},PinErrorMsg:f}=u;yield{root:{cid:P.parse(l),pinErrorMsg:f}}}}return e});var G4=(r,e)=>O(n=>async(s,o={})=>{let a={storeCodec:"dag-cbor",hashAlg:"sha2-256",...o},c;if(a.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");c=s}else c=(await r.getCodec(a.storeCodec)).encode(s),a.inputCodec=a.storeCodec;let u=new AbortController,l=jr(u.signal,a.signal),h=await(await n.post("dag/put",{timeout:a.timeout,signal:l,searchParams:U(a),...await Gr([c],u,a.headers)})).json();return P.parse(h.Cid["/"])})(e);var Aq=O(r=>async(t,n={})=>{let s=await(await r.post("dag/resolve",{signal:n.signal,searchParams:U({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers})).json();return{cid:P.parse(s.Cid["/"]),remainderPath:s.RemPath}});function Iq(r,e){return{export:vq(e),get:xq(r,e),import:Tq(e),put:G4(r,e),resolve:Aq(e)}}var ps=r=>{if(r.Type===0)return{name:"SENDING_QUERY",type:r.Type};if(r.Type===1)return{from:fe(r.ID),name:"PEER_RESPONSE",type:r.Type,messageType:0,messageName:"PUT_VALUE",closer:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:fe(e),multiaddrs:t.map(n=>oe(n)),protocols:[]})),providers:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:fe(e),multiaddrs:t.map(n=>oe(n)),protocols:[]}))};if(r.Type===2){let e={id:r.ID??fe(r.ID),multiaddrs:[],protocols:[]};return r.Responses&&r.Responses.length&&(e={id:fe(r.Responses[0].ID),multiaddrs:r.Responses[0].Addrs.map(t=>oe(t)),protocols:[]}),{name:"FINAL_PEER",type:r.Type,peer:e}}if(r.Type===3)return{name:"QUERY_ERROR",type:r.Type,error:new Error(r.Extra)};if(r.Type===4)return{name:"PROVIDER",type:r.Type,providers:r.Responses.map(({ID:e,Addrs:t})=>({id:fe(e),multiaddrs:t.map(n=>oe(n)),protocols:[]}))};if(r.Type===5)return{name:"VALUE",type:r.Type,value:W(r.Extra,"base64pad")};if(r.Type===6){let e=r.Responses.map(({ID:t})=>fe(t));if(!e.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:r.Type,peer:e[0]}}if(r.Type===7)return{name:"DIALING_PEER",type:r.Type,peer:fe(r.ID)};throw new Error("Unknown DHT event type")};var Rq=O(r=>{async function*e(t,n={}){let i=await r.post("dht/findpeer",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers});for await(let s of i.ndjson())yield ps(s)}return e});var Cq=O(r=>{async function*e(t,n={}){let i=await r.post("dht/findprovs",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield ps(s)}return e});var Pq=O(r=>{async function*e(t,n={}){let i=await r.post("dht/get",{signal:n.signal,searchParams:U({arg:t instanceof Uint8Array?j(t):t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield ps(s)}return e});var kq=O(r=>{async function*e(t,n={recursive:!1}){let i=Array.isArray(t)?t:[t],s=await r.post("dht/provide",{signal:n.signal,searchParams:U({arg:i.map(o=>o.toString()),...n}),headers:n.headers});for await(let o of s.ndjson())yield ps(o)}return e});var Dq=O(r=>{async function*e(t,n,i={}){let s=new AbortController,o=jr(s.signal,i.signal),a=await r.post("dht/put",{signal:o,searchParams:U({arg:t instanceof Uint8Array?j(t):t.toString(),...i}),...await Gr([n],s,i.headers)});for await(let c of a.ndjson())yield ps(c)}return e});var Nq=O(r=>{async function*e(t,n={}){let i=await r.post("dht/query",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers});for await(let s of i.ndjson())yield ps(s)}return e});function Oq(r){return{findPeer:Rq(r),findProvs:Cq(r),get:Pq(r),provide:kq(r),put:Dq(r),query:Nq(r)}}var Lq=O(r=>{async function e(t={}){return(await r.post("diag/cmds",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()}return e});var Bq=O(r=>{async function e(t={}){return(await r.post("diag/net",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()}return e});var Mq=O(r=>{async function e(t={}){return(await r.post("diag/sys",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()}return e});function Uq(r){return{cmds:Lq(r),net:Bq(r),sys:Mq(r)}}var Fq=O(r=>{async function e(t,n,i={}){await(await r.post("files/chmod",{signal:i.signal,searchParams:U({arg:t,mode:n,...i}),headers:i.headers})).text()}return e});var Vq=O(r=>{async function e(t,n,i={}){let s=Array.isArray(t)?t:[t];await(await r.post("files/cp",{signal:i.signal,searchParams:U({arg:s.concat(n).map(a=>P.asCID(a)?`/ipfs/${a}`:a),...i}),headers:i.headers})).text()}return e});var zq=O(r=>{async function e(t,n={}){if(!t||typeof t!="string")throw new Error("ipfs.files.flush requires a path");let s=await(await r.post("files/flush",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json();return P.parse(s.Cid)}return e});function Gm(r){let e=dt(r);return Object.prototype.hasOwnProperty.call(e,"mode")&&(e.mode=parseInt(e.mode,8)),Object.prototype.hasOwnProperty.call(e,"mtime")&&(e.mtime={secs:e.mtime,nsecs:e.mtimeNsecs||0},delete e.mtimeNsecs),e}var Hq=O(r=>{async function*e(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");let i=await r.post("files/ls",{signal:n.signal,searchParams:U({arg:P.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(let s of i.ndjson())if("Entries"in s)for(let o of s.Entries||[])yield Kq(Gm(o));else yield Kq(Gm(s))}return e});function Kq(r){return r.hash&&(r.cid=P.parse(r.hash)),delete r.hash,r.type=r.type===1?"directory":"file",r}var $q=O(r=>{async function e(t,n={}){await(await r.post("files/mkdir",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).text()}return e});var qq=O(r=>{async function e(t,n,i={}){Array.isArray(t)||(t=[t]),await(await r.post("files/mv",{signal:i.signal,searchParams:U({arg:t.concat(n),...i}),headers:i.headers})).text()}return e});var Wq=C(jq(),1),Yq=O(r=>{async function*e(t,n={}){let i=await r.post("files/read",{signal:n.signal,searchParams:U({arg:t,count:n.length,...n}),headers:n.headers});yield*(0,Wq.default)(i.body)}return e});var Qq=C(Ld(),1),Xq=O(r=>{async function e(t,n={}){let i=await r.post("files/rm",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),s=await i.text();if(s!==""){let o=new Qq.default.HTTPError(i);throw o.message=s,o}}return e});var j4=O(r=>{async function e(t,n={}){let s=await(await r.post("files/stat",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json();return s.WithLocality=s.WithLocality||!1,Hye(Gm(s))}return e});function Hye(r){return r.cid=P.parse(r.hash),delete r.hash,r}var Zq=O(r=>{async function e(t,n={}){await(await r.post("files/touch",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).text()}return e});var Jq=O(r=>{async function e(t,n,i={}){let s=new AbortController,o=jr(s.signal,i.signal);await(await r.post("files/write",{signal:o,searchParams:U({arg:t,streamChannels:!0,count:i.length,...i}),...await Gr([{content:n,path:"arg",mode:K4(i.mode),mtime:H4(i.mtime)}],s,i.headers)})).text()}return e});function eG(r){return{chmod:Fq(r),cp:Vq(r),flush:zq(r),ls:Hq(r),mkdir:$q(r),mv:qq(r),read:Yq(r),rm:Xq(r),stat:j4(r),touch:Zq(r),write:Jq(r)}}var tG=C(Y(),1),rG=O(r=>async(t,n,i={})=>{throw(0,tG.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var nG=O(r=>{async function e(t,n){let i=n??{type:"Ed25519"},o=await(await r.post("key/gen",{signal:i.signal,searchParams:U({arg:t,...i}),headers:i.headers})).json();return dt(o)}return e});var iG=O(r=>{async function e(t,n,i,s={}){let a=await(await r.post("key/import",{signal:s.signal,searchParams:U({arg:t,pem:n,password:i,...s}),headers:s.headers})).json();return dt(a)}return e});var sG=C(Y(),1),oG=O(r=>async(t,n={})=>{throw(0,sG.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var aG=O(r=>{async function e(t={}){return((await(await r.post("key/list",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).Keys||[]).map(s=>dt(s))}return e});var cG=O(r=>{async function e(t,n,i={}){let s=await r.post("key/rename",{signal:i.signal,searchParams:U({arg:[t,n],...i}),headers:i.headers});return dt(await s.json())}return e});var uG=O(r=>{async function e(t,n={}){let s=await(await r.post("key/rm",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json();return dt(s.Keys[0])}return e});function lG(r){return{export:rG(r),gen:nG(r),import:iG(r),info:oG(r),list:aG(r),rename:cG(r),rm:uG(r)}}var fG=O(r=>{async function e(t,n,i={}){let s=await r.post("log/level",{signal:i.signal,searchParams:U({arg:[t,n],...i}),headers:i.headers});return dt(await s.json())}return e});var dG=O(r=>{async function e(t={}){return(await(await r.post("log/ls",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).Strings}return e});var hG=O(r=>{async function*e(t={}){yield*(await r.post("log/tail",{signal:t.signal,searchParams:U(t),headers:t.headers})).ndjson()}return e});function pG(r){return{level:fG(r),ls:dG(r),tail:hG(r)}}var mG=O(r=>{async function e(t,n={}){let i=await r.post("name/publish",{signal:n.signal,searchParams:U({arg:`${t}`,...n}),headers:n.headers});return dt(await i.json())}return e});var gG=O(r=>{async function*e(t,n={}){let i=await r.post("name/resolve",{signal:n.signal,searchParams:U({arg:t,stream:!0,...n}),headers:n.headers});for await(let s of i.ndjson())yield s.Path}return e});var yG=O(r=>{async function e(t,n={}){let i=await r.post("name/pubsub/cancel",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers});return dt(await i.json())}return e});var wG=O(r=>{async function e(t={}){let n=await r.post("name/pubsub/state",{signal:t.signal,searchParams:U(t),headers:t.headers});return dt(await n.json())}return e});var bG=O(r=>{async function e(t={}){return(await(await r.post("name/pubsub/subs",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).Strings||[]}return e});function _G(r){return{cancel:yG(r),state:wG(r),subs:bG(r)}}function EG(r){return{publish:mG(r),resolve:gG(r),pubsub:_G(r)}}var vG=O(r=>{async function e(t,n={}){let s=await(await r.post("object/data",{signal:n.signal,searchParams:U({arg:`${t instanceof Uint8Array?P.decode(t):t}`,...n}),headers:n.headers})).arrayBuffer();return new Uint8Array(s,0,s.byteLength)}return e});var SG=O(r=>{async function e(t,n={}){let s=await(await r.post("object/get",{signal:n.signal,searchParams:U({arg:`${t instanceof Uint8Array?P.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers})).json();return{Data:W(s.Data,"base64pad"),Links:(s.Links||[]).map(o=>({Name:o.Name,Hash:P.parse(o.Hash),Tsize:o.Size}))}}return e});var xG=O(r=>{async function e(t,n={}){return((await(await r.post("object/links",{signal:n.signal,searchParams:U({arg:`${t instanceof Uint8Array?P.decode(t):t}`,...n}),headers:n.headers})).json()).Links||[]).map(o=>({Name:o.Name,Tsize:o.Size,Hash:P.parse(o.Hash)}))}return e});var TG=O(r=>{async function e(t={}){let n=await r.post("object/new",{signal:t.signal,searchParams:U({arg:t.template,...t}),headers:t.headers}),{Hash:i}=await n.json();return P.parse(i)}return e});var AG=(r,e)=>O(n=>{let i=G4(r,e);async function s(o,a={}){return i(o,{...a,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return s})(e);var IG=O(r=>{async function e(t,n={}){let s=await(await r.post("object/stat",{signal:n.signal,searchParams:U({arg:`${t}`,...n}),headers:n.headers})).json();return{...s,Hash:P.parse(s.Hash)}}return e});var RG=O(r=>{async function e(t,n,i={}){let s=await r.post("object/patch/add-link",{signal:i.signal,searchParams:U({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...i}),headers:i.headers}),{Hash:o}=await s.json();return P.parse(o)}return e});var CG=O(r=>{async function e(t,n,i={}){let s=new AbortController,o=jr(s.signal,i.signal),a=await r.post("object/patch/append-data",{signal:o,searchParams:U({arg:`${t}`,...i}),...await Gr([n],s,i.headers)}),{Hash:c}=await a.json();return P.parse(c)}return e});var PG=O(r=>{async function e(t,n,i={}){let s=await r.post("object/patch/rm-link",{signal:i.signal,searchParams:U({arg:[`${t}`,n.Name||n.name||null],...i}),headers:i.headers}),{Hash:o}=await s.json();return P.parse(o)}return e});var kG=O(r=>{async function e(t,n,i={}){let s=new AbortController,o=jr(s.signal,i.signal),a=await r.post("object/patch/set-data",{signal:o,searchParams:U({arg:[`${t}`],...i}),...await Gr([n],s,i.headers)}),{Hash:c}=await a.json();return P.parse(c)}return e});function DG(r){return{addLink:RG(r),appendData:CG(r),rmLink:PG(r),setData:kG(r)}}function NG(r,e){return{data:vG(e),get:SG(e),links:xG(e),new:TG(e),put:AG(r,e),stat:IG(e),patch:DG(e)}}var W4=O(r=>{async function*e(t,n={}){for await(let{path:i,recursive:s,metadata:o}of yo(t)){let a=await r.post("pin/add",{signal:n.signal,searchParams:U({...n,arg:i,recursive:s,metadata:o?JSON.stringify(o):void 0,stream:!0}),headers:n.headers});for await(let c of a.ndjson()){if(c.Pins){for(let u of c.Pins)yield P.parse(u);continue}yield P.parse(c)}}}return e});function OG(r){let e=W4(r);return O(()=>{async function t(n,i={}){return Wt(e([{path:n,...i}],i))}return t})(r)}function LG(r,e,t){let n={type:r,cid:P.parse(e)};return t&&(n.metadata=t),n}var BG=O(r=>{async function*e(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);let i=await r.post("pin/ls",{signal:t.signal,searchParams:U({...t,arg:n.map(s=>`${s}`),stream:!0}),headers:t.headers});for await(let s of i.ndjson()){if(s.Keys){for(let o of Object.keys(s.Keys))yield LG(s.Keys[o].Type,o,s.Keys[o].Metadata);return}yield LG(s.Type,s.Cid,s.Metadata)}}return e});var Y4=O(r=>{async function*e(t,n={}){for await(let{path:i,recursive:s}of yo(t)){let o=new URLSearchParams(n.searchParams);o.append("arg",`${i}`),s!=null&&o.set("recursive",String(s));let a=await r.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:U({...n,arg:`${i}`,recursive:s})});for await(let c of a.ndjson()){if(c.Pins){yield*c.Pins.map(u=>P.parse(u));continue}yield P.parse(c)}}}return e});var MG=r=>{let e=Y4(r);return O(()=>{async function t(n,i={}){return Wt(e([{path:n,...i}],i))}return t})(r)};var Q4=({Name:r,Status:e,Cid:t})=>({cid:P.parse(t),name:r,status:e}),UG=r=>{if(typeof r=="string"&&r!=="")return r;throw new TypeError("service name must be passed")},FG=r=>{if(P.asCID(r))return r.toString();throw new TypeError(`CID instance expected instead of ${typeof r}`)},h0=({service:r,cid:e,name:t,status:n,all:i})=>{let s=U({service:UG(r),name:t,force:i?!0:void 0});if(e)for(let o of e)s.append("cid",FG(o));if(n)for(let o of n)s.append("status",o);return s},VG=({cid:r,service:e,background:t,name:n,origins:i})=>{let s=U({arg:FG(r),service:UG(e),name:n,background:t?!0:void 0});if(i)for(let o of i)s.append("origin",o.toString());return s};function zG(r){async function e(t,{timeout:n,signal:i,headers:s,...o}){let a=await r.post("pin/remote/add",{timeout:n,signal:i,headers:s,searchParams:VG({cid:t,...o})});return Q4(await a.json())}return e}function KG(r){async function*e({timeout:t,signal:n,headers:i,...s}){let o=await r.post("pin/remote/ls",{timeout:t,signal:n,headers:i,searchParams:h0(s)});for await(let a of o.ndjson())yield Q4(a)}return e}function HG(r){async function e({timeout:t,signal:n,headers:i,...s}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:h0({...s,all:!1})})}return e}function $G(r){async function e({timeout:t,signal:n,headers:i,...s}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:h0({...s,all:!0})})}return e}function qG(r){let e=String(r);if(e==="undefined")throw Error("endpoint is required");return e[e.length-1]==="/"?e.slice(0,-1):e}function GG(r){return{service:r.Service,endpoint:new URL(r.ApiEndpoint),...r.Stat&&{stat:$ye(r.Stat)}}}function $ye(r){switch(r.Status){case"valid":{let{Pinning:e,Pinned:t,Queued:n,Failed:i}=r.PinCount;return{status:"valid",pinCount:{queued:n,pinning:e,pinned:t,failed:i}}}case"invalid":return{status:"invalid"};default:return{status:r.Status}}}function jG(r){async function e(t,n){let{endpoint:i,key:s,headers:o,timeout:a,signal:c}=n;await r.post("pin/remote/service/add",{timeout:a,signal:c,searchParams:U({arg:[t,qG(i),s]}),headers:o})}return e}function WG(r){async function e(t={}){let{stat:n,headers:i,timeout:s,signal:o}=t,a=await r.post("pin/remote/service/ls",{timeout:s,signal:o,headers:i,searchParams:n===!0?U({stat:n}):void 0}),{RemoteServices:c}=await a.json();return c.map(GG)}return e}function YG(r){async function e(t,n={}){await r.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:U({arg:t})})}return e}function QG(r){let e=new Hu(r);return{add:jG(e),ls:WG(e),rm:YG(e)}}function XG(r){let e=new Hu(r);return{add:zG(e),ls:KG(e),rm:HG(e),rmAll:$G(e),service:QG(r)}}function ZG(r){return{addAll:W4(r),add:OG(r),ls:BG(r),rmAll:Y4(r),rm:MG(r),remote:XG(r)}}var JG=r=>Array.isArray(r)?r.map(X4):r,X4=r=>j(p0(r)),p0=r=>Tc.decode(r),ej=r=>BigInt(`0x${j(Tc.decode(r),"base16")}`),m0=r=>Tc.encode(W(r));var tj=O(r=>{async function e(t={}){let{Strings:n}=await(await r.post("pubsub/ls",{signal:t.signal,searchParams:U(t),headers:t.headers})).json();return JG(n)||[]}return e});var rj=O(r=>{async function e(t,n={}){let i=await r.post("pubsub/peers",{signal:n.signal,searchParams:U({arg:m0(t),...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});var nj=O(r=>{async function e(t,n,i={}){let s=U({arg:m0(t),...i}),o=new AbortController,a=jr(o.signal,i.signal);await(await r.post("pubsub/pub",{signal:a,searchParams:s,...await Gr([n],o,i.headers)})).text()}return e});var qye=D("ipfs-http-client:pubsub:subscribe"),ij=(r,e)=>O(t=>{async function n(i,s,o={}){o.signal=e.subscribe(i,s,o.signal);let a,c,u=new Promise((f,h)=>{a=f,c=h}),l=setTimeout(()=>a(),1e3);return t.post("pubsub/sub",{signal:o.signal,searchParams:U({arg:m0(i),...o}),headers:o.headers}).catch(f=>{e.unsubscribe(i,s),c(f)}).then(f=>{clearTimeout(l),f&&(Gye(f,{onMessage:h=>{if(s){if(typeof s=="function"){s(h);return}typeof s.handleEvent=="function"&&s.handleEvent(h)}},onEnd:()=>e.unsubscribe(i,s),onError:o.onError}),a())}),u}return n})(r);async function Gye(r,{onMessage:e,onEnd:t,onError:n}){n=n||qye;try{for await(let i of r.ndjson())try{if(!i.from)continue;i.from!=null&&i.seqno!=null?e({type:"signed",from:fe(i.from),data:p0(i.data),sequenceNumber:ej(i.seqno),topic:X4(i.topicIDs[0]),key:p0(i.key??"u"),signature:p0(i.signature??"u")}):e({type:"unsigned",data:p0(i.data),topic:X4(i.topicIDs[0])})}catch(s){s.message=`Failed to parse pubsub message: ${s.message}`,n(s,!1,i)}}catch(i){jye(i)||n(i,!0)}finally{t()}}var jye=r=>{switch(r.type){case"aborted":return!0;case"abort":return!0;default:return r.name==="AbortError"}};var sj=(r,e)=>{async function t(n,i){e.unsubscribe(n,i)}return t};var Z4=class{constructor(){this._subs=new Map}subscribe(e,t,n){let i=this._subs.get(e)||[];if(i.find(o=>o.handler===t))throw new Error(`Already subscribed to ${e} with this handler`);let s=new AbortController;return this._subs.set(e,[{handler:t,controller:s}].concat(i)),n&&n.addEventListener("abort",()=>this.unsubscribe(e,t)),s.signal}unsubscribe(e,t){let n=this._subs.get(e)||[],i;t?(this._subs.set(e,n.filter(s=>s.handler!==t)),i=n.filter(s=>s.handler===t)):(this._subs.set(e,[]),i=n),(this._subs.get(e)||[]).length||this._subs.delete(e),i.forEach(s=>s.controller.abort())}};function oj(r){let e=new Z4;return{ls:tj(r),peers:rj(r),publish:nj(r),subscribe:ij(r,e),unsubscribe:sj(r,e)}}var aj=O(r=>{async function*e(t={}){yield*(await r.post("refs/local",{signal:t.signal,transform:dt,searchParams:U(t),headers:t.headers})).ndjson()}return e});var cj=O((r,e)=>Object.assign(async function*(n,i={}){let s=Array.isArray(n)?n:[n];yield*(await r.post("refs",{signal:i.signal,searchParams:U({arg:s.map(a=>`${a instanceof Uint8Array?P.decode(a):a}`),...i}),headers:i.headers,transform:dt})).ndjson()},{local:aj(e)}));var uj=O(r=>{async function*e(t={}){yield*(await r.post("repo/gc",{signal:t.signal,searchParams:U(t),headers:t.headers,transform:i=>({err:i.Error?new Error(i.Error):null,cid:(i.Key||{})["/"]?P.parse(i.Key["/"]):null})})).ndjson()}return e});var J4=O(r=>{async function e(t={}){let i=await(await r.post("repo/stat",{signal:t.signal,searchParams:U(t),headers:t.headers})).json();return{numObjects:BigInt(i.NumObjects),repoSize:BigInt(i.RepoSize),repoPath:i.RepoPath,version:i.Version,storageMax:BigInt(i.StorageMax)}}return e});var lj=O(r=>{async function e(t={}){return(await(await r.post("repo/version",{signal:t.signal,searchParams:U(t),headers:t.headers})).json()).Version}return e});function fj(r){return{gc:uj(r),stat:J4(r),version:lj(r)}}var dj=O(r=>{async function*e(t={}){yield*(await r.post("stats/bw",{signal:t.signal,searchParams:U(t),headers:t.headers,transform:i=>({totalIn:BigInt(i.TotalIn),totalOut:BigInt(i.TotalOut),rateIn:parseFloat(i.RateIn),rateOut:parseFloat(i.RateOut)})})).ndjson()}return e});function hj(r){return{bitswap:$4(r),repo:J4(r),bw:dj(r)}}var pj=O(r=>{async function e(t={}){let n=await r.post("swarm/addrs",{signal:t.signal,searchParams:U(t),headers:t.headers}),{Addrs:i}=await n.json();return Object.keys(i).map(s=>({id:fe(s),addrs:(i[s]||[]).map(o=>oe(o))}))}return e});var mj=O(r=>{async function e(t,n={}){let i=await r.post("swarm/connect",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});var gj=O(r=>{async function e(t,n={}){let i=await r.post("swarm/disconnect",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),{Strings:s}=await i.json();return s||[]}return e});var yj=O(r=>{async function e(t={}){let n=await r.post("swarm/addrs/local",{signal:t.signal,searchParams:U(t),headers:t.headers}),{Strings:i}=await n.json();return(i||[]).map(s=>oe(s))}return e});var wj=O(r=>{async function e(t={}){let n=await r.post("swarm/peers",{signal:t.signal,searchParams:U(t),headers:t.headers}),{Peers:i}=await n.json();return(i||[]).map(s=>({addr:oe(s.Addr),peer:fe(s.Peer),muxer:s.Muxer,latency:s.Latency,streams:s.Streams,direction:s.Direction==null?void 0:s.Direction===0?"inbound":"outbound"}))}return e});function bj(r){return{addrs:pj(r),connect:mj(r),disconnect:gj(r),localAddrs:yj(r),peers:wj(r)}}var e6=O(r=>{async function*e(t,n={}){let i=new AbortController,s=jr(i.signal,n.signal),{headers:o,body:a,total:c,parts:u}=await Gr(t,i,n.headers),[l,f]=typeof n.progress=="function"?Wye(c,u,n.progress):[void 0,void 0],h=await r.post("add",{searchParams:U({"stream-channels":!0,...n,progress:Boolean(l)}),onUploadProgress:f,signal:s,headers:o,body:a});for await(let d of h.ndjson())d=dt(d),d.hash!==void 0?yield Qye(d):l&&l(d.bytes||0,d.name)}return e}),Wye=(r,e,t)=>e?[void 0,Yye(r,e,t)]:[t,void 0],Yye=(r,e,t)=>{let n=0,i=e.length;return({loaded:s,total:o})=>{let a=Math.floor(s/o*r);for(;n<i;){let{start:c,end:u,name:l}=e[n];if(a<u){t(a-c,l);break}else t(u-c,l),n+=1}}};function Qye({name:r,hash:e,size:t,mode:n,mtime:i,mtimeNsecs:s}){let o={path:r,cid:P.parse(e),size:parseInt(t)};return n!=null&&(o.mode=parseInt(n,8)),i!=null&&(o.mtime={secs:i,nsecs:s||0}),o}function _j(r){let e=e6(r);return O(()=>{async function t(n,i={}){return await Wt(e(By(n),i))}return t})(r)}var Ej=O(r=>{async function*e(t,n={}){yield*(await r.post("cat",{signal:n.signal,searchParams:U({arg:t.toString(),...n}),headers:n.headers})).iterator()}return e});var vj=O(r=>async(t={})=>(await r.post("commands",{signal:t.signal,searchParams:U(t),headers:t.headers})).json());var Sj=O(r=>async(t,n={})=>(await(await r.post("dns",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers})).json()).Path);var xj=O(r=>()=>{let e=new URL(r.opts.base||"");return{host:e.hostname,port:e.port,protocol:e.protocol,pathname:e.pathname,"api-path":e.pathname}});var Tj=O(r=>{async function*e(t,n={}){let i={arg:`${t instanceof Uint8Array?P.decode(t):t}`,...n};i.compressionLevel&&(i["compression-level"]=i.compressionLevel,delete i.compressionLevel),yield*(await r.post("get",{signal:n.signal,searchParams:U(i),headers:n.headers})).iterator()}return e});var t6=O(r=>{async function e(t={}){let i=await(await r.post("id",{signal:t.signal,searchParams:U({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers})).json(),s={...dt(i)};return s.id=fe(s.id),s.addresses&&(s.addresses=s.addresses.map(o=>oe(o))),s}return e});var Aj=r=>{let e=t6(r);async function t(n={}){let i=await e(n);return Boolean(i&&i.addresses&&i.addresses.length)}return t};var Ij=O((r,e)=>{async function*t(n,i={}){let s=`${n instanceof Uint8Array?P.decode(n):n}`;async function o(c){let u=c.Hash;if(u.includes("/")){let f=u.startsWith("/ipfs/")?u:`/ipfs/${u}`;u=(await j4(e)(f)).cid}else u=P.parse(u);let l={name:c.Name,path:s+(c.Name?`/${c.Name}`:""),size:c.Size,cid:u,type:Xye(c)};return c.Mode&&(l.mode=parseInt(c.Mode,8)),c.Mtime!==void 0&&c.Mtime!==null&&(l.mtime={secs:c.Mtime},c.MtimeNsecs!==void 0&&c.MtimeNsecs!==null&&(l.mtime.nsecs=c.MtimeNsecs)),l}let a=await r.post("ls",{signal:i.signal,searchParams:U({arg:s,...i}),headers:i.headers});for await(let c of a.ndjson()){if(c=c.Objects,!c)throw new Error("expected .Objects in results");if(c=c[0],!c)throw new Error("expected one array in results.Objects");let u=c.Links;if(!Array.isArray(u))throw new Error("expected one array in results.Objects[0].Links");if(!u.length){yield o(c);return}yield*u.map(o)}}return t});function Xye(r){switch(r.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}var Rj=O(r=>{async function e(t={}){let n=await r.post("dns",{signal:t.signal,searchParams:U(t),headers:t.headers});return dt(await n.json())}return e});var Cj=O(r=>{async function*e(t,n={}){yield*(await r.post("ping",{signal:n.signal,searchParams:U({arg:`${t}`,...n}),headers:n.headers,transform:dt})).ndjson()}return e});var Pj=O(r=>{async function e(t,n={}){let i=await r.post("resolve",{signal:n.signal,searchParams:U({arg:t,...n}),headers:n.headers}),{Path:s}=await i.json();return s}return e});var kj=C(Y(),1),Dj=O(r=>async(t={})=>{throw(0,kj.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var Nj=O(r=>{async function e(t={}){await(await r.post("shutdown",{signal:t.signal,searchParams:U(t),headers:t.headers})).text()}return e});var Oj=O(r=>{async function e(t={}){let n=await r.post("version",{signal:t.signal,searchParams:U(t),headers:t.headers});return{...dt(await n.json()),"ipfs-http-client":"1.0.0"}}return e});var t5e=C(zS(),1);function Bj(r={}){let e={name:Hr.name,code:Hr.code,encode:u=>u,decode:u=>u},t=Object.values(Xi);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach(u=>t.push(u));let n=new l0({bases:t,loadBase:r.ipld&&r.ipld.loadBase}),i=Object.values($g);[mt,_a,Ad,vp,e].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>i.push(u));let s=new f0({codecs:i,loadCodec:r.ipld&&r.ipld.loadCodec}),o=Object.values(Hg);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach(u=>o.push(u));let a=new d0({hashers:o,loadHasher:r.ipld&&r.ipld.loadHasher});return{add:_j(r),addAll:e6(r),bitswap:X$(r),block:aq(r),bootstrap:hq(r),cat:Ej(r),commands:vj(r),config:Eq(r),dag:Iq(s,r),dht:Oq(r),diag:Uq(r),dns:Sj(r),files:eG(r),get:Tj(r),getEndpointConfig:xj(r),id:t6(r),isOnline:Aj(r),key:lG(r),log:pG(r),ls:Ij(r),mount:Rj(r),name:EG(r),object:NG(s,r),pin:ZG(r),ping:Cj(r),pubsub:oj(r),refs:cj(r),repo:fj(r),resolve:Pj(r),start:Dj(r),stats:hj(r),stop:Nj(r),swarm:bj(r),version:Oj(r),bases:n,codecs:s,hashers:a}}var s2=C(Y(),1);var vW=C(Y(),1);var Js=Object.create(null);Js.open="0";Js.close="1";Js.ping="2";Js.pong="3";Js.message="4";Js.upgrade="5";Js.noop="6";var jm=Object.create(null);Object.keys(Js).forEach(r=>{jm[Js[r]]=r});var Mj={type:"error",data:"parser error"};var r5e=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",n5e=typeof ArrayBuffer=="function",i5e=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,s5e=({type:r,data:e},t,n)=>r5e&&e instanceof Blob?t?n(e):Uj(e,n):n5e&&(e instanceof ArrayBuffer||i5e(e))?t?n(e):Uj(new Blob([e]),n):n(Js[r]+(e||"")),Uj=(r,e)=>{let t=new FileReader;return t.onload=function(){let n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},r6=s5e;var Fj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wm=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<Fj.length;r++)Wm[Fj.charCodeAt(r)]=r;var Vj=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);let u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)s=Wm[r.charCodeAt(n)],o=Wm[r.charCodeAt(n+1)],a=Wm[r.charCodeAt(n+2)],c=Wm[r.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u};var o5e=typeof ArrayBuffer=="function",a5e=(r,e)=>{if(typeof r!="string")return{type:"message",data:zj(r,e)};let t=r.charAt(0);return t==="b"?{type:"message",data:c5e(r.substring(1),e)}:jm[t]?r.length>1?{type:jm[t],data:r.substring(1)}:{type:jm[t]}:Mj},c5e=(r,e)=>{if(o5e){let t=Vj(r);return zj(t,e)}else return{base64:!0,data:r}},zj=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},n6=a5e;var Kj=String.fromCharCode(30),Hj=(r,e)=>{let t=r.length,n=new Array(t),i=0;r.forEach((s,o)=>{r6(s,!1,a=>{n[o]=a,++i===t&&e(n.join(Kj))})})},$j=(r,e)=>{let t=r.split(Kj),n=[];for(let i=0;i<t.length;i++){let s=n6(t[i],e);if(n.push(s),s.type==="error")break}return n},KS=4;function tr(r){if(r)return u5e(r)}function u5e(r){for(var e in tr.prototype)r[e]=tr.prototype[e];return r}tr.prototype.on=tr.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};tr.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};tr.prototype.off=tr.prototype.removeListener=tr.prototype.removeAllListeners=tr.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};tr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};tr.prototype.emitReserved=tr.prototype.emit;tr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};tr.prototype.hasListeners=function(r){return!!this.listeners(r).length};var Un=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function i6(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}var l5e=Un.setTimeout,f5e=Un.clearTimeout;function ec(r,e){e.useNativeTimers?(r.setTimeoutFn=l5e.bind(Un),r.clearTimeoutFn=f5e.bind(Un)):(r.setTimeoutFn=Un.setTimeout.bind(Un),r.clearTimeoutFn=Un.clearTimeout.bind(Un))}var d5e=1.33;function qj(r){return typeof r=="string"?h5e(r):Math.ceil((r.byteLength||r.size)*d5e)}function h5e(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}var HS=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}},Nf=class extends tr{constructor(e){super(),this.writable=!1,ec(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new HS(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=n6(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}};var Yj="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),$S=64,p5e={},Gj=0,s6=0,jj;function Wj(r){let e="";do e=Yj[r%$S]+e,r=Math.floor(r/$S);while(r>0);return e}function o6(){let r=Wj(+new Date);return r!==jj?(Gj=0,jj=r):r+"."+Wj(Gj++)}for(;s6<$S;s6++)p5e[Yj[s6]]=s6;function a6(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Qj(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}var Xj=!1;try{Xj=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Zj=Xj;function qS(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Zj))return new XMLHttpRequest}catch{}if(!e)try{return new Un[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function m5e(){}var g5e=function(){return new qS({xdomain:!1}).responseType!=null}(),c6=class extends Nf{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}let t=e&&e.forceBase64;this.supportsBinary=g5e&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};$j(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Hj(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{},t=this.opts.secure?"https":"http",n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=o6()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);let i=a6(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ms(this.uri(),e)}doWrite(e,t){let n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}},ms=class extends tr{constructor(e,t){super(),ec(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){let e=i6(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;let t=this.xhr=new qS(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=ms.requestsCount++,ms.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=m5e,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete ms.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};ms.requestsCount=0;ms.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Jj);else if(typeof addEventListener=="function"){let r="onpagehide"in Un?"pagehide":"unload";addEventListener(r,Jj,!1)}}function Jj(){for(let r in ms.requests)ms.requests.hasOwnProperty(r)&&ms.requests[r].abort()}var Ym=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Qm=Un.WebSocket||Un.MozWebSocket,u6=!0,eW="arraybuffer";var tW=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",l6=class extends Nf{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,n=tW?{}:i6(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=u6&&!tW?t?new Qm(e,t):new Qm(e):new Qm(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||eW,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],i=t===e.length-1;r6(n,this.supportsBinary,s=>{let o={};u6||(n.options&&(o.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof s=="string"?Buffer.byteLength(s):s.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1));try{u6?this.ws.send(s):this.ws.send(s,o)}catch{}i&&Ym(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=o6()),this.supportsBinary||(e.b64=1);let i=a6(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!Qm}};var GS={websocket:l6,polling:c6};var y5e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,w5e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function g0(r){let e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=y5e.exec(r||""),s={},o=14;for(;o--;)s[w5e[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=b5e(s,s.path),s.queryKey=_5e(s,s.query),s}function b5e(r,e){let t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function _5e(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}var Mi=class extends tr{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=g0(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=g0(t.host).host),ec(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Qj(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=KS,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new GS[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Mi.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;Mi.priorWebsocketSuccess=!1;let i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Mi.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function s(){n||(n=!0,l(),t.close(),t=null)}let o=f=>{let h=new Error("probe error: "+f);h.transport=t.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function c(){o("socket closed")}function u(f){t&&f.name!==t.name&&s()}let l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",Mi.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){let i=this.writeBuffer[n].data;if(i&&(t+=qj(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){Mi.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],n=0,i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};Mi.protocol=KS;var bft=Mi.protocol;function rW(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=g0(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}var XS={};zt(XS,{Decoder:()=>Jm,Encoder:()=>YS,PacketType:()=>ht,protocol:()=>oW});var E5e=typeof ArrayBuffer=="function",v5e=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,nW=Object.prototype.toString,S5e=typeof Blob=="function"||typeof Blob<"u"&&nW.call(Blob)==="[object BlobConstructor]",x5e=typeof File=="function"||typeof File<"u"&&nW.call(File)==="[object FileConstructor]";function Zm(r){return E5e&&(r instanceof ArrayBuffer||v5e(r))||S5e&&r instanceof Blob||x5e&&r instanceof File}function Xm(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Xm(r[t]))return!0;return!1}if(Zm(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Xm(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&Xm(r[t]))return!0;return!1}function iW(r){let e=[],t=r.data,n=r;return n.data=jS(t,e),n.attachments=e.length,{packet:n,buffers:e}}function jS(r,e){if(!r)return r;if(Zm(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=jS(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=jS(r[n],e));return t}return r}function sW(r,e){return r.data=WS(r.data,e),delete r.attachments,r}function WS(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=WS(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=WS(r[t],e));return r}var oW=5,ht;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ht||(ht={}));var YS=class{constructor(e){this.replacer=e}encode(e){return(e.type===ht.EVENT||e.type===ht.ACK)&&Xm(e)?this.encodeAsBinary({type:e.type===ht.EVENT?ht.BINARY_EVENT:ht.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ht.BINARY_EVENT||e.type===ht.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=iW(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}},Jm=class extends tr{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let n=t.type===ht.BINARY_EVENT;n||t.type===ht.BINARY_ACK?(t.type=n?ht.EVENT:ht.ACK,this.reconstructor=new QS(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Zm(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,n={type:Number(e.charAt(0))};if(ht[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ht.BINARY_EVENT||n.type===ht.BINARY_ACK){let s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){let s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let s=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){let s=this.tryParse(e.substr(t));if(Jm.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case ht.CONNECT:return typeof t=="object";case ht.DISCONNECT:return t===void 0;case ht.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case ht.EVENT:case ht.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case ht.ACK:case ht.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},QS=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=sW(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Ui(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var T5e=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),y0=class extends tr{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Ui(e,"open",this.onopen.bind(this)),Ui(e,"packet",this.onpacket.bind(this)),Ui(e,"error",this.onerror.bind(this)),Ui(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(T5e.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:ht.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){let n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ht.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ht.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ht.EVENT:case ht.BINARY_EVENT:this.onevent(e);break;case ht.ACK:case ht.BINARY_ACK:this.onack(e);break;case ht.DISCONNECT:this.ondisconnect();break;case ht.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...i){n||(n=!0,t.packet({type:ht.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ht.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function Of(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Of.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};Of.prototype.reset=function(){this.attempts=0};Of.prototype.setMin=function(r){this.ms=r};Of.prototype.setMax=function(r){this.max=r};Of.prototype.setJitter=function(r){this.jitter=r};var w0=class extends tr{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,ec(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Of({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||XS;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Mi(this.uri,this.opts);let t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=Ui(t,"open",function(){n.onopen(),e&&e()}),s=Ui(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){let o=this._timeout;o===0&&i();let a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Ui(e,"ping",this.onping.bind(this)),Ui(e,"data",this.ondata.bind(this)),Ui(e,"error",this.onerror.bind(this)),Ui(e,"close",this.onclose.bind(this)),Ui(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ym(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new y0(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let n of t)if(this.nsps[n].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var e2={};function t2(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=rW(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=e2[i]&&s in e2[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,c;return a?c=new w0(n,e):(e2[i]||(e2[i]=new w0(n,e)),c=e2[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(t2,{Manager:w0,Socket:y0,io:t2,connect:t2});var r2=C(Y(),1),hW=C(f6(),1);var uW=C(Y(),1);var cW=64*1024,I5e=5*1e3,d6=class{constructor(e,t){this.label=e.label,this.open=vt(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,typeof this.channel.bufferedAmountLowThreshold=="number"&&(this.channel.bufferedAmountLowThreshold=cW),e.addEventListener("message",i=>{t.onMessage(i)}),e.addEventListener("bufferedamountlow",()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()}),e.addEventListener("open",()=>{this.open.resolve(),t.onOpen()}),e.addEventListener("close",()=>{t.onClose()}),e.addEventListener("error",i=>{var o,a,c,u,l;if(((o=i.error)==null?void 0:o.message)==="Transport channel closed")return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,(a=i.error)==null?void 0:a.message,(c=i.error)==null?void 0:c.errorDetail);let s=i.error instanceof Error?i.error:new Error(`datachannel error: ${(u=i.error)==null?void 0:u.message} ${(l=i.error)==null?void 0:l.errorDetail}`);t.onError((0,uW.default)(s,"ERR_DATA_CHANNEL"))});let n=!1;this.closingInterval=setInterval(()=>{e.readyState==="closing"?(n&&t.onClose(),n=!0):n=!1},I5e)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>cW&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=vt())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}};var pW=C(ex(),1),C5e={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function P5e(){if(typeof globalThis>"u")throw(0,r2.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");let r={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(r.RTCPeerConnection==null)throw(0,r2.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return r}var Lf=class extends Ue{constructor(e){super(),this.id=e.id??j((0,hW.default)(4),"hex").slice(0,7),this.log=D(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??P5e(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},C5e,e.peerConnectionConfig)),this.closed=!1,this.connected=vt(),this.source=Kt(),this.sink=async t=>{if(await this.connected.promise,this.channel==null)throw(0,r2.default)(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(let n of t)await this.channel.send(n);await this.close()}}handleDataChannelEvent(e){let t=e.channel;if(t==null){this.close((0,r2.default)(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch(n=>{this.log("Error closing after event channel was found to be null",n)});return}this.channel=new d6(t,{log:this.log,onMessage:n=>{this.source.push(new Uint8Array(n.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new ie("ready"))},onClose:()=>{this.close().catch(n=>{this.log("error closing connection after channel close",n)})},onError:n=>{this.close(n).catch(i=>{this.log("error closing connection after channel error",i)})}})}async close(e){var t;if(this.closed=!0,e==null&&this.channel!=null)for(;this.channel.bufferedAmount>0;)await(0,pW.default)(100);(t=this.channel)==null||t.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new ie("close"))}};var mW=C(Y(),1),b0=class extends Ue{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch(t=>{this.log.error("could not renegotiate %o",t)})})}async handleSignal(e){if(this.log('incoming signal "%s"',e.type),e.type==="offer")return await this.handleOffer(e);if(e.type==="answer")return await this.handleAnswer(e);if(e.type==="candidate")return await this.handleCandidate(e);if(e.type==="renegotiate")return await this.handleRenegotiate(e);if(e.type==="goodbye")return await this.handleGoodye(e);this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){let t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(n){if(t.address==null||t.address.endsWith(".local"))this.log("ignoring unsupported ICE candidate.");else throw(0,mW.default)(n,"ERR_ADD_ICE_CANDIDATE")}}};var gW=D("libp2p:webrtc-peer:receiver"),n2=class extends Lf{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new tx({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",t=>this.dispatchEvent(new ie("signal",{detail:t.detail}))),this.peerConnection.addEventListener("datachannel",t=>{this.handleDataChannelEvent(t)})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},tx=class extends b0{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){gW.trace("renegotiate"),this.dispatchEvent(new ie("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(let n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];let t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),gW.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new ie("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){if(this.peerConnection.remoteDescription==null||this.peerConnection.remoteDescription.type==null){this.iceCandidates.push(e);return}await super.handleCandidate(e)}};var wW=C(f6(),1);var k5e=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function D5e(r,e,t){let n,i=new Promise((s,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");let a=[e].flat(),c=[],{addListener:u,removeListener:l}=k5e(r),f=(...d)=>{let m=t.multiArgs?d:d[0];t.filter&&!t.filter(m)||(c.push(m),t.count===c.length&&(n(),s(c)))},h=d=>{n(),o(d)};n=()=>{for(let d of a)l(d,f);for(let d of t.rejectionEvents)l(d,h)};for(let d of a)u(d,f);for(let d of t.rejectionEvents)u(d,h);t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){let s=Op(i,t.timeout);return s.cancel=n,s}return i}function yW(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=D5e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}var bW=C(ex(),1);var rx=D("libp2p:webrtc-peer:initator"),N5e=1e3,i2=class extends Lf{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??j((0,wW.default)(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new nx({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",t=>{this.dispatchEvent(new ie("signal",{detail:t.detail}))})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},nx=class extends b0{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",t=>{if(t.candidate==null)return;let n={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};rx.trace("create candidate",n),this.dispatchEvent(new ie("signal",{detail:n})),this.dispatchEvent(new ie("ice-candidate"))})}async handleRenegotiate(){if(this.status==="negotiating"){this.log("already negotiating, queueing");return}this.status="negotiating";let e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await yW(this,"ice-candidate"),await(0,bW.default)(N5e),rx.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new ie("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){rx.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}};var ix=D("libp2p:webrtc-star:socket");function h6(r,e){let{sink:t,source:n}=r,i={remoteAddr:e.remoteAddr,async sink(s){e.signal!=null&&(s=Cr(s,e.signal));try{await t(s)}catch(o){o.type!=="aborted"&&ix.error(o)}},source:e.signal!=null?Cr(n,e.signal):n,timeline:{open:Date.now()},async close(){if(r.closed)return;let s=Date.now(),o=setTimeout(()=>{if(i.remoteAddr!=null){let{host:a,port:c}=i.remoteAddr.toOptions();ix("timeout closing socket to %s:%s after %dms, destroying it manually",a,c,Date.now()-s)}r.closed||r.close().catch(a=>{ix.error("could not close socket",a)})},2e3);try{await r.close()}finally{clearTimeout(o)}}};return r.addEventListener("close",()=>{i.timeline.close==null&&(i.timeline.close=Date.now())},{once:!0}),i}function p6(r){let e=r.toString().split("/"),t=r.protos()[1].name,n=r.protos()[2].name,i=r.stringTuples()[1][1];if(t!=="tcp"||n!=="ws"&&n!=="wss")throw new Error(`invalid multiaddr: ${r.toString()}`);if(!JP(r))return`http://${e[2]}:${e[4]}`;if(n==="ws")return`http://${e[2]}${i==null||i==="80"?"":`:${i}`}`;if(n==="wss")return`https://${e[2]}${i==null||i==="443"?"":`:${i}`}`;throw new Error("invalid multiaddr: "+r.toString())}function _W(r){let e="/libp2p-webrtc-star";if(r.startsWith(e)){r=r.substring(e.length,r.length);let t=oe(r),n=t.stringTuples().filter(i=>i[0]===421)[0];if(n[1]==null)throw new Error("invalid multiaddr: "+r);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${n[1]}`),r=t.toString()}return r}var Fn=D("libp2p:webrtc-star:listener"),L5e={transports:["websocket"],path:"/socket.io-next/"},sx=class extends Ue{constructor(e,t,n,i,s){super(),this.signallingAddr=t,this.socket=t2(e,L5e),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=i,this.channelOptions=s,this.handleWsHandshake=this.handleWsHandshake.bind(this);let o=!1;this.socket.on("connect_error",a=>{o&&a.type==="TransportError"||this.dispatchEvent(new ie("error",{detail:a}))}),this.socket.on("error",a=>{this.dispatchEvent(new ie("error",{detail:a}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",a=>{this.dispatchEvent(new ie("peer",{detail:a}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),o&&this.dispatchEvent(new ie("reconnect"))}),this.socket.once("connect",()=>{o=!0,this.dispatchEvent(new ie("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new ie("disconnect"))})}_createChannel(e,t,n){let i={...this.channelOptions},s=new n2(i),o=a=>{let c=a.detail;Fn.error("incoming connection errored",c)};return s.addEventListener("error",o),s.addEventListener("close",()=>{s.removeEventListener("error",o)},{once:!0}),s.addEventListener("signal",a=>{let c=a.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:c})}),s.addEventListener("ready",()=>{let a=h6(s,{remoteAddr:this.signallingAddr});Fn("new inbound connection %s",a.remoteAddr);try{this.upgrader.upgradeInbound(a).then(c=>{Fn("inbound connection %s upgraded",a.remoteAddr),this.connections.push(a);let u=()=>{this.connections=this.connections.filter(l=>l!==a),this.channels.delete(e),this.pendingSignals.delete(e)};s.addEventListener("close",u,{once:!0}),this.dispatchEvent(new ie("connection",{detail:c})),this.handler(c)}).catch(c=>{Fn.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Fn.error("inbound connection failed to close after failing to upgrade",u)})})}catch(c){Fn.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Fn.error("inbound connection failed to close after failing to upgrade",u)})}},{once:!0}),s}handleWsHandshake(e){if(Fn('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;let t=e.intentId,n=this.pendingSignals.get(t);n==null&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let i=this.channels.get(t);if(i==null){if(e.signal.type!=="offer"){Fn("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}Fn("creating new channel to handle offer handshake"),i=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,i)}else Fn("channel already exists, using it to handle handshake");for(;n.length>0;){let s=n.shift();(s==null?void 0:s.signal)!=null&&i.handleSignal(s.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>await e.close()),...Array.from(this.channels.values()).map(async e=>await e.close())]),this.dispatchEvent(new ie("close"))}},ox=class extends Ue{constructor(e,t,n,i,s){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=i,this.options=s}async listen(e){if(this.listeningAddr!=null)throw(0,vW.default)(new Error("listener already in use"),"ERR_ALREADY_LISTENING");let t=vt();this.listeningAddr=e;let n;e.protoCodes().includes(421)?n=e:n=e.encapsulate(`/p2p/${this.peerId.toString()}`);let i=this.signallingUrl=p6(e);Fn("connecting to signalling server on: %s",this.signallingUrl);let s=new sx(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return s.addEventListener("error",o=>{let a=o.detail;Fn("error connecting to signalling server %o",a),s.close().catch(c=>{Fn.error("error closing server after error",c)}),t.reject(a)}),s.addEventListener("listening",()=>{Fn("connected to signalling server"),this.dispatchEvent(new ie("listening")),t.resolve()}),s.addEventListener("peer",o=>{this.transport.peerDiscovered(o.detail)}),s.addEventListener("connection",o=>{let a=o.detail;if(a.remoteAddr==null)try{a.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${a.remotePeer.toString()}`)}catch(c){Fn.error("could not determine remote address",c)}this.dispatchEvent(new ie("connection",{detail:a}))}),s.addEventListener("disconnect",()=>{this.transport.sigServers.delete(i)}),s.addEventListener("reconnect",()=>{this.transport.sigServers.set(i,s)}),this.transport.sigServers.set(this.signallingUrl,s),await t.promise}async close(){if(this.signallingUrl!=null){let e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new ie("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}};function SW(r,e,t,n,i){return new ox(r,e,t,n,i)}var xW=C(f6(),1);function tc(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=Ns(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return Sa(t)}var _0=Symbol.for("@libp2p/transport");var $u;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})($u||($u={}));var Xo=Symbol.for("@libp2p/peer-discovery");var M5e="RTCPeerConnection"in globalThis,Bf=D("libp2p:webrtc-star"),U5e=()=>{},ax=class extends Ue{constructor(){super(...arguments),this.started=!1}get[Xo](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}},m6=class{constructor(e){(e==null?void 0:e.wrtc)!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new ax,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[_0](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){let n=await this._connect(e,t),i=h6(n,{remoteAddr:e,signal:t.signal});Bf("new outbound connection %s",i.remoteAddr);let s=await t.upgrader.upgradeOutbound(i);return Bf("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o;if(((o=t.signal)==null?void 0:o.aborted)===!0)throw new zu;let n={...t.channelOptions??{}};this.wrtc!=null&&(n.wrtc=this.wrtc);let i=e.toOptions(),s=j((0,xW.default)(36),"hex");return await new Promise((a,c)=>{var b;let u=this.sigServers.get(p6(e));if((u==null?void 0:u.socket)==null)return c((0,s2.default)(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let l=!1;Bf("dialing %s:%s",i.host,i.port);let f=new i2(n),h=v=>{let T=v.detail;if(!l){let p=`connection error ${i.host}:${i.port}: ${T.message}`;Bf.error(p),w(T)}},d=()=>{l=!0,Bf("connection opened %s:%s",i.host,i.port),w()},m=()=>{Bf.error("connection aborted %s:%s",i.host,i.port),f.close().finally(()=>{w(new zu)})},w=v=>{var T;f.removeEventListener("ready",d),(T=t.signal)==null||T.removeEventListener("abort",m),v==null?a(f):c(v)};f.addEventListener("ready",d,{once:!0}),f.addEventListener("close",()=>{f.removeEventListener("error",h)}),(b=t.signal)==null||b.addEventListener("abort",m),f.addEventListener("signal",v=>{let T=v.detail;u.socket.emit("ss-handshake",{intentId:s,srcMultiaddr:u.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:T})}),u.socket.on("ws-handshake",v=>{v.intentId===s&&v.err!=null&&f.close().finally(()=>{c((0,s2.default)(new Error(v.err),"ERR_SIGNALLING_FAILED"))}),!(v.intentId!==s||v.answer==null||f.closed)&&f.handleSignal(v.signal)})})}createListener(e){if(!M5e&&this.wrtc==null)throw(0,s2.default)(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw(0,s2.default)(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return SW(e.upgrader,e.handler??U5e,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(290)?!1:Jg.matches(t))}peerDiscovered(e){Bf("peer discovered: %s",e),e=_W(e);let t=oe(e),n=t.getPeerId();if(n==null)return;let i=fe(n);this._discovery.dispatchEvent(new ie("peer",{detail:{id:i,multiaddrs:[t],protocols:[]}}))}};function TW(r={}){let e=new m6(r);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}function AW(){let r=TW();return{transports:[r.transport],peerDiscovery:[r.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}function rc(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}var a2=C(Y(),1);var ct;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.DHT_DISABLED="DHT is not available",r.PUBSUB_DISABLED="PubSub is not available",r.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",r.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",r.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",r.NOT_FOUND="Not found"})(ct||(ct={}));var $;(function(r){r.DHT_DISABLED="ERR_DHT_DISABLED",r.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",r.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",r.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",r.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",r.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",r.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",r.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",r.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",r.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",r.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",r.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",r.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",r.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",r.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",r.ERR_DIALED_SELF="ERR_DIALED_SELF",r.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",r.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",r.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",r.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",r.ERR_INVALID_KEY="ERR_INVALID_KEY",r.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_PEER="ERR_INVALID_PEER",r.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",r.ERR_NOT_FOUND="ERR_NOT_FOUND",r.ERR_TIMEOUT="ERR_TIMEOUT",r.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",r.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",r.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",r.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",r.ERR_FIND_SELF="ERR_FIND_SELF",r.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",r.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",r.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",r.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",r.ERR_INVALID_CMS="ERR_INVALID_CMS",r.ERR_MISSING_KEYS="ERR_MISSING_KEYS",r.ERR_NO_KEY="ERR_NO_KEY",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",r.ERR_INVALID_RECORD="ERR_INVALID_RECORD",r.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",r.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED"})($||($={}));var IW=C(Y(),1);async function*o2(r,e){yield*Bt(r,async t=>(await e.addressBook.add(t.id,t.multiaddrs),t))}function g6(r){let e=new Set;return ot(r,t=>e.has(t.id.toString())?!1:(e.add(t.id.toString()),!0))}async function*y6(r,e=1){let t=0;for await(let n of r)t++,yield n;if(t<e)throw(0,IW.default)(new Error("not found"),"NOT_FOUND")}var PW=C(en(),1);var b6=C(cx(),1),kW=C(Tn(),1),CW=D("libp2p:peer-routing"),w6=class{constructor(e,t){this.components=e,this.routers=t.routers??[],this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||this.routers.length===0||this.timeoutId!=null||this.refreshManagerInit.enabled===!1||(this.timeoutId=(0,b6.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){var e,t;if(this.abortController==null)try{this.abortController=new PW.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(e=kW.setMaxListeners)==null||e(1/0,this.abortController.signal)}catch{}await Rt(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(n){CW.error(n)}finally{(t=this.abortController)==null||t.clear(),this.abortController=void 0}}async stop(){var e;(0,b6.clearDelayedInterval)(this.timeoutId),(e=this.abortController)==null||e.abort(),this.started=!1}async findPeer(e,t){if(this.routers.length===0)throw(0,a2.default)(new Error("No peer routers available"),$.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw(0,a2.default)(new Error("Should not try to find self"),$.ERR_FIND_SELF);let n=await _e(fr(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(s){CW.error(s)}}())),i=>ot(i,Boolean),i=>o2(i,this.components.peerStore),async i=>await Tr(i));if(n!=null)return n;throw(0,a2.default)(new Error(ct.NOT_FOUND),$.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(this.routers.length===0)throw(0,a2.default)(new Error("No peer routers available"),$.ERR_NO_ROUTERS_AVAILABLE);yield*_e(fr(...this.routers.map(n=>n.getClosestPeers(e,t))),n=>o2(n,this.components.peerStore),n=>g6(n),n=>y6(n))}};var qu=C(Y(),1);var _6=class{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw(0,qu.default)(new Error("No content this.routers available"),$.ERR_NO_ROUTERS_AVAILABLE);yield*_e(fr(...this.routers.map(n=>n.findProviders(e,t))),n=>o2(n,this.components.peerStore),n=>g6(n),n=>y6(n))}async provide(e,t={}){if(this.routers.length===0)throw(0,qu.default)(new Error("No content routers available"),$.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async n=>await n.provide(e,t)))}async put(e,t,n){if(!this.isStarted())throw(0,qu.default)(new Error(ct.NOT_STARTED_YET),$.DHT_NOT_STARTED);let i=this.components.dht;i!=null&&await Rt(i.put(e,t,n))}async get(e,t){if(!this.isStarted())throw(0,qu.default)(new Error(ct.NOT_STARTED_YET),$.DHT_NOT_STARTED);let n=this.components.dht;if(n!=null){for await(let i of n.get(e,t))if(i.name==="VALUE")return i.value}throw(0,qu.default)(new Error(ct.NOT_FOUND),$.ERR_NOT_FOUND)}async*getMany(e,t,n){if(!this.isStarted())throw(0,qu.default)(new Error(ct.NOT_STARTED_YET),$.DHT_NOT_STARTED);if(t==null||t===0)return;let i=0,s=this.components.dht;if(s!=null){for await(let o of s.get(e,n))if(o.name==="VALUE"&&(yield{from:o.from,val:o.value},i++,i===t))break}if(i===0)throw(0,qu.default)(new Error(ct.NOT_FOUND),$.ERR_NOT_FOUND)}};var H5e=r=>r,E6=class extends Ue{constructor(e,t){super();let{listen:n=[],announce:i=[]}=t;this.components=e,this.listen=n.map(s=>s.toString()),this.announce=new Set(i.map(s=>s.toString())),this.observed=new Set,this.announceFilter=t.announceFilter??H5e}getListenAddrs(){return Array.from(this.listen).map(e=>oe(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>oe(e))}getObservedAddrs(){return Array.from(this.observed).map(e=>oe(e))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=oe(e),n=t.getPeerId();n!=null&&fe(n).equals(this.components.peerId)&&(t=t.decapsulate(oe(`/p2p/${this.components.peerId.toString()}`)));let i=t.toString();this.observed.has(i)||(this.observed.add(i),this.dispatchEvent(new ie("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map(n=>n.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(n=>n.toString())),e=e.concat(this.getObservedAddrs().map(n=>n.toString()));let t=new Set(e);return this.announceFilter(Array.from(t).map(n=>oe(n))).map(n=>{var i;return((i=n.protos().pop())==null?void 0:i.path)===!0||n.getPeerId()===this.components.peerId.toString()?n:n.encapsulate(`/p2p/${this.components.peerId.toString()}`)})}};var R6=C(Y(),1);var DW=D("libp2p:connection-manager:latency-monitor:visibility-change-emitter"),v6=class extends Ue{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",globalThis.document!=null&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";typeof globalThis.document.hidden<"u"?(e="hidden",t="visibilitychange"):typeof globalThis.document.mozHidden<"u"?(e="mozHidden",t="mozvisibilitychange"):typeof globalThis.document.msHidden<"u"?(e="msHidden",t="msvisibilitychange"):typeof globalThis.document.webkitHidden<"u"&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){typeof globalThis.document.addEventListener>"u"||typeof document[this.hidden]>"u"?DW("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(!(this.hidden===void 0||document[this.hidden]===void 0))return document[this.hidden]==null}_handleVisibilityChange(){let e=globalThis.document[this.hidden]===!1;DW(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new ie("visibilityChange",{detail:e}))}};var nc=D("libp2p:connection-manager:latency-monitor"),S6=class extends Ue{constructor(e={}){var o,a;super();let{latencyCheckIntervalMs:t,dataEmitIntervalMs:n,asyncTestFn:i,latencyRandomPercentage:s}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=s??10,this.latencyCheckMultiply=2*(this.latencyRandomPercentage/100)*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=n===null||n===0?void 0:n??5*1e3,nc("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),this.dataEmitIntervalMs!=null?nc("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):nc("Not emitting summaries"),this.asyncTestFn=i,((o=globalThis.process)==null?void 0:o.hrtime)!=null?(nc("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=c=>{let u=this.now(c);return u[0]*1e3+u[1]/1e6}):typeof window<"u"&&((a=window.performance)==null?void 0:a.now)!=null?(nc("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=c=>Math.round(this.now()-c)):(nc("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=c=>this.now()-c),this.latencyData=this.initLatencyData()}start(){var e;$5e()&&(this.visibilityChangeEmitter=new v6,this.visibilityChangeEmitter.addEventListener("visibilityChange",t=>{let{detail:n}=t;n?this._startTimers():(this._emitSummary(),this._stopTimers())})),((e=this.visibilityChangeEmitter)==null?void 0:e.isVisible())===!0&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){this.checkLatencyID==null&&(this.checkLatency(),this.dataEmitIntervalMs!=null&&(this.emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this.emitIntervalID.unref=="function"&&this.emitIntervalID.unref()))}_stopTimers(){this.checkLatencyID!=null&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),this.emitIntervalID!=null&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){let e=this.getSummary();e.events>0&&this.dispatchEvent(new ie("data",{detail:e}))}getSummary(){let e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),nc.trace("Summary: %O",e),e}checkLatency(){let e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},n=()=>{if(this.checkLatencyID==null)return;let i=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,i),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,i),this.latencyData.totalMs+=i,nc.trace("MS: %s Data: %O",i,this.latencyData)};nc.trace("localData: %O",t),this.checkLatencyID=setTimeout(()=>{this.asyncTestFn!=null?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(n)):(t.deltaOffset-=1,n())},t.deltaOffset),typeof this.checkLatencyID.unref=="function"&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}};function $5e(){return typeof globalThis.window<"u"}var C6=C(Tn(),1);var x6="OPEN",ux="CLOSING",T6="CLOSED";function ic(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}var c2=class{constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return ic(this.map.entries(),e=>[fe(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,fe(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return ic(this.map.keys(),e=>fe(e))}values(){return this.map.values()}get size(){return this.map.size}};var pi=class{constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return ic(this.set.entries(),e=>{let t=fe(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=fe(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return ic(this.set.values(),e=>fe(e))}intersection(e){let t=new pi;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new pi;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new pi;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};var v0=class{constructor(e){if(this.list=[],e!=null)for(let t of e)this.list.push(t.toString())}[Symbol.iterator](){return ic(this.list.entries(),e=>fe(e[1]))}concat(e){let t=new v0(this);for(let n of e)t.push(n);return t}entries(){return ic(this.list.entries(),e=>[e[0],fe(e[1])])}every(e){return this.list.every((t,n)=>e(fe(t),n,this))}filter(e){let t=new v0;return this.list.forEach((n,i)=>{let s=fe(n);e(s,i,this)&&t.push(s)}),t}find(e){let t=this.list.find((n,i)=>e(fe(n),i,this));if(t!=null)return fe(t)}findIndex(e){return this.list.findIndex((t,n)=>e(fe(t),n,this))}forEach(e){this.list.forEach((t,n)=>{e(fe(t),n,this)})}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){let e=this.list.pop();if(e!=null)return fe(e)}push(...e){for(let t of e)this.list.push(t.toString())}shift(){let e=this.list.shift();if(e!=null)return fe(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)t=this.list.unshift(e[n].toString());return t}get length(){return this.list.length}};var xx=C(en(),1);var NW="keep-alive";var CY=C(Sx(),1);var RY=C(Y(),1);function I6(r){if($n(r))return{peerId:r};if(Pn(r)){let e=r.getPeerId();return{multiaddr:r,peerId:e==null?void 0:fe(e)}}throw(0,RY.default)(new Error(`${r} is not a PeerId or a Multiaddr`),$.ERR_INVALID_MULTIADDR)}var Wr=D("libp2p:connection-manager"),I4e={maxConnections:1/0,minConnections:0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},R4e=6e4,P6=class extends Ue{constructor(e,t){var n;if(super(),this.opts=Ve.call({ignoreUndefined:!0},I4e,t),this.opts.maxConnections<this.opts.minConnections)throw(0,R6.default)(new Error("Connection Manager maxConnections must be greater than minConnections"),$.ERR_INVALID_PARAMETERS);Wr("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,t.maxEventLoopDelay!=null&&t.maxEventLoopDelay>0&&t.maxEventLoopDelay!==1/0&&(this.latencyMonitor=new S6({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval}));try{(n=C6.setMaxListeners)==null||n(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??R4e,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map(i=>oe(i)),this.deny=(t.deny??[]).map(i=>oe(i)),this.inboundConnectionRateLimiter=new CY.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){var e,t,n,i,s;(e=this.components.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let o={inbound:0,outbound:0};for(let a of this.connections.values())for(let c of a)c.stat.direction==="inbound"?o.inbound++:o.outbound++;return o}}),(t=this.components.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let o={};for(let a of this.connections.values())for(let c of a)for(let u of c.streams){let l=`${u.stat.direction} ${u.stat.protocol??"unnegotiated"}`;o[l]=(o[l]??0)+1}return o}}),(n=this.components.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let o={};for(let c of this.connections.values())for(let u of c){let l={};for(let f of u.streams){let h=`${f.stat.direction} ${f.stat.protocol??"unnegotiated"}`;l[h]=(l[h]??0)+1}for(let[f,h]of Object.entries(l))o[f]=o[f]??[],o[f].push(h)}let a={};for(let[c,u]of Object.entries(o)){u=u.sort((f,h)=>f-h);let l=Math.floor(u.length*.9);a[c]=u[l]}return a}}),(i=this.latencyMonitor)==null||i.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),(s=this.latencyMonitor)==null||s.addEventListener("data",this._onLatencyMeasure),this.started=!0,Wr("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then(async()=>{var t,n;let e=[];for(let i of await this.components.peerStore.all())(await this.components.peerStore.getTags(i.id)).filter(a=>a.name===NW).length>0&&e.push(i.id);(t=this.connectOnStartupController)==null||t.clear(),this.connectOnStartupController=new xx.TimeoutController(this.startupReconnectTimeout);try{(n=C6.setMaxListeners)==null||n(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map(async i=>{var s;await this.openConnection(i,{signal:(s=this.connectOnStartupController)==null?void 0:s.signal}).catch(o=>{Wr.error(o)})}))}).catch(e=>{Wr.error(e)}).finally(()=>{var e;(e=this.connectOnStartupController)==null||e.clear()})}async beforeStop(){var e;(e=this.connectOnStartupController)==null||e.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){var e,t;(e=this.latencyMonitor)==null||e.removeEventListener("data",this._onLatencyMeasure),(t=this.latencyMonitor)==null||t.stop(),this.started=!1,await this._close(),Wr("stopped")}async _close(){let e=[];for(let t of this.connections.values())for(let n of t)e.push((async()=>{try{await n.close()}catch(i){Wr.error(i)}})());Wr("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}onConnect(e){this._onConnect(e).catch(t=>{Wr.error(t)})}async _onConnect(e){let{detail:t}=e;if(!this.started){await t.close();return}let n=t.remotePeer,i=n.toString(),s=this.connections.get(i);s!=null?s.push(t):this.connections.set(i,[t]),n.publicKey!=null&&await this.components.peerStore.keyBook.set(n,n.publicKey);let o=this.getConnections().length,a=o-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",o,a),this.dispatchEvent(new ie("peer:connect",{detail:t}))}onDisconnect(e){let{detail:t}=e;if(!this.started)return;let n=t.remotePeer.toString(),i=this.connections.get(n);i!=null&&i.length>1?(i=i.filter(s=>s.id!==t.id),this.connections.set(n,i)):i!=null&&(this.connections.delete(n),this.dispatchEvent(new ie("peer:disconnect",{detail:t})))}getConnections(e){if(e!=null)return this.connections.get(e.toString())??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}async openConnection(e,t={}){var o;let{peerId:n,multiaddr:i}=I6(e);if(n==null&&i==null)throw(0,R6.default)(new TypeError("Can only open connections to PeerIds or Multiaddrs"),$.ERR_INVALID_PARAMETERS);if(n!=null){Wr("dial to",n);let a=this.getConnections(n);if(a.length>0)return Wr("had an existing connection to %p",n),a[0]}let s;if((t==null?void 0:t.signal)==null){s=new xx.TimeoutController(this.dialTimeout),t.signal=s.signal;try{(o=C6.setMaxListeners)==null||o(1/0,s.signal)}catch{}}try{let a=await this.components.dialer.dial(e,t),c=this.connections.get(a.remotePeer.toString());c==null&&(c=[],this.connections.set(a.remotePeer.toString(),c));let u=!1;for(let l of c)l.id===a.id&&(u=!0);return u||c.push(a),a}finally{s!=null&&s.clear()}}async closeConnections(e){let t=this.connections.get(e.toString())??[];await Promise.all(t.map(async n=>await n.close()))}getAll(e){if(!$n(e))throw(0,R6.default)(new Error("peerId must be an instance of peer-id"),$.ERR_INVALID_PARAMETERS);let t=e.toString(),n=this.connections.get(t);return n!=null?n.filter(i=>i.stat.status===x6):[]}_onLatencyMeasure(e){let{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch(n=>{Wr.error(n)})}async _checkMaxLimit(e,t,n=1){let i=this.opts[e];if(i==null){Wr.trace("limit %s was not set so it cannot be applied",e);return}Wr.trace("checking limit of %s. current value: %d of %d",e,t,i),t>i&&(Wr("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,i,n),await this._pruneConnections(n))}async _pruneConnections(e){let t=this.getConnections(),n=new c2;for(let o of t){let a=o.remotePeer;if(n.has(a))continue;let c=await this.components.peerStore.getTags(a);n.set(a,c.reduce((u,l)=>u+l.value,0))}let i=t.sort((o,a)=>{let c=n.get(o.remotePeer)??0,u=n.get(a.remotePeer)??0;if(c>u)return 1;if(c<u)return-1;let l=o.stat.timeline.open,f=a.stat.timeline.open;return l<f?1:l>f?-1:0}),s=[];for(let o of i)if(Wr("too many connections open - closing a connection to %p",o.remotePeer),s.push(o),s.length===e)break;await Promise.all(s.map(async o=>{try{await o.close()}catch(a){Wr.error(a)}this.onDisconnect(new ie("connectionEnd",{detail:o}))}))}async acceptIncomingConnection(e){if(this.deny.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return Wr("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return Wr("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return Wr("connection from %s refused - inboundConnectionThreshold exceeded by host %s",i,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(Wr("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}};var Tx=C(hb(),1);var Gu=D("libp2p:connection-manager:auto-dialler"),C4e={enabled:!0,minConnections:0,autoDialInterval:1e4},k6=class{constructor(e,t){this.components=e,this.options=Ve.call({ignoreUndefined:!0},C4e,t),this.running=!1,this._autoDial=this._autoDial.bind(this),Gu("options: %j",this.options)}isStarted(){return this.running}async start(){if(!this.options.enabled){Gu("not enabled");return}this.running=!0,this._autoDial().catch(e=>{Gu.error("could start autodial",e)}),Gu("started")}async stop(){if(!this.options.enabled){Gu("not enabled");return}this.running=!1,this.autoDialTimeout!=null&&this.autoDialTimeout.clear(),Gu("stopped")}async _autoDial(){this.autoDialTimeout!=null&&this.autoDialTimeout.clear();let e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e){this.autoDialTimeout=(0,Tx.default)(this._autoDial,this.options.autoDialInterval);return}let t=await this.components.peerStore.all(),n=await _e(t.sort(()=>Math.random()>.5?1:-1),i=>ot(i,s=>!s.id.equals(this.components.peerId)),i=>xu(i,(s,o)=>o.protocols.length>s.protocols.length||o.id.publicKey!=null&&s.id.publicKey==null?1:-1),async i=>await rn(i));for(let i=0;this.running&&i<n.length&&this.components.connectionManager.getConnections().length<e;i++){if(!this.running)return;let s=n[i];if(this.components.connectionManager.getConnections(s.id).length===0){Gu("connecting to a peerStore stored peer %p",s.id);try{await this.components.connectionManager.openConnection(s.id)}catch(o){Gu.error("could not connect to peerStore stored peer",o)}}}this.running&&(this.autoDialTimeout=(0,Tx.default)(this._autoDial,this.options.autoDialInterval))}};var UY=C(Y(),1);var Ge;(function(r){let e;(function(a){a.SUCCESS="SUCCESS",a.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",a.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",a.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",a.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",a.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",a.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",a.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",a.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",a.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",a.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",a.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",a.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",a.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",a.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",a.MALFORMED_MESSAGE="MALFORMED_MESSAGE"})(e=r.Status||(r.Status={}));let t;(function(a){a[a.SUCCESS=100]="SUCCESS",a[a.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",a[a.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",a[a.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",a[a.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",a[a.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",a[a.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",a[a.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",a[a.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",a[a.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",a[a.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",a[a.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",a[a.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",a[a.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",a[a.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",a[a.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"})(t||(t={})),function(a){a.codec=()=>Si(t)}(e=r.Status||(r.Status={}));let n;(function(a){a.HOP="HOP",a.STOP="STOP",a.STATUS="STATUS",a.CAN_HOP="CAN_HOP"})(n=r.Type||(r.Type={}));let i;(function(a){a[a.HOP=1]="HOP",a[a.STOP=2]="STOP",a[a.STATUS=3]="STATUS",a[a.CAN_HOP=4]="CAN_HOP"})(i||(i={})),function(a){a.codec=()=>Si(i)}(n=r.Type||(r.Type={}));let s;(function(a){let c;a.codec=()=>(c==null&&(c=nt((u,l,f={})=>{if(f.lengthDelimited!==!1&&l.fork(),(f.writeDefaults===!0||u.id!=null&&u.id.byteLength>0)&&(l.uint32(10),l.bytes(u.id)),u.addrs!=null)for(let h of u.addrs)l.uint32(18),l.bytes(h);f.lengthDelimited!==!1&&l.ldelim()},(u,l)=>{let f={id:new Uint8Array(0),addrs:[]},h=l==null?u.len:u.pos+l;for(;u.pos<h;){let d=u.uint32();switch(d>>>3){case 1:f.id=u.bytes();break;case 2:f.addrs.push(u.bytes());break;default:u.skipType(d&7);break}}return f})),c),a.encode=u=>rt(u,a.codec()),a.decode=u=>tt(u,a.codec())})(s=r.Peer||(r.Peer={}));let o;r.codec=()=>(o==null&&(o=nt((a,c,u={})=>{u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.Type.codec().encode(a.type,c)),a.srcPeer!=null&&(c.uint32(18),r.Peer.codec().encode(a.srcPeer,c,{writeDefaults:!1})),a.dstPeer!=null&&(c.uint32(26),r.Peer.codec().encode(a.dstPeer,c,{writeDefaults:!1})),a.code!=null&&(c.uint32(32),r.Status.codec().encode(a.code,c)),u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={},l=c==null?a.len:a.pos+c;for(;a.pos<l;){let f=a.uint32();switch(f>>>3){case 1:u.type=r.Type.codec().decode(a);break;case 2:u.srcPeer=r.Peer.codec().decode(a,a.uint32());break;case 3:u.dstPeer=r.Peer.codec().decode(a,a.uint32());break;case 4:u.code=r.Status.codec().decode(a);break;default:a.skipType(f&7);break}}return u})),o),r.encode=a=>rt(a,r.codec()),r.decode=a=>tt(a,r.codec())})(Ge||(Ge={}));var P4e=D("libp2p:stream:converter");function Ax(r,e={}){let{stream:t,remoteAddr:n}=r,{sink:i,source:s}=t,o=async function*(){for await(let u of s)yield*u}(),a={async sink(u){e.signal!=null&&(u=Cr(u,e.signal));try{await i(u),await c()}catch(l){l.type!=="aborted"&&P4e(l)}},source:e.signal!=null?Cr(o,e.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await i(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return a.timeline.close==null&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}var Zo="/libp2p/circuit/relay/0.1.0";function PY(r){let e=new Map;async function t(s){let o=s.toString().split("/p2p-circuit").find(h=>h!==""),a=oe(o),c=a.getPeerId();if(c==null)throw new Error("Could not determine relay peer from multiaddr");let u=fe(c);await r.peerStore.addressBook.add(u,[a]);let l=await r.connectionManager.openConnection(u),f=l.remoteAddr.encapsulate("/p2p-circuit");e.set(l.remotePeer.toString(),f),i.dispatchEvent(new ie("listening"))}function n(){let s=[];for(let o of e.values())s.push(o);return s}let i=Object.assign(new Ue,{close:async()=>await Promise.resolve(),listen:t,getAddrs:n});return r.connectionManager.addEventListener("peer:disconnect",s=>{let{detail:o}=s;e.delete(o.remotePeer.toString())&&i.dispatchEvent(new ie("close"))}),i}var Ix=C(Y(),1);function kY(r,e){r.write({type:Ge.Type.STATUS,code:e})}function D6(r,e){var t,n;try{((t=r.dstPeer)==null?void 0:t.addrs)!=null&&r.dstPeer.addrs.forEach(i=>oe(i))}catch(i){throw kY(e,r.type===Ge.Type.HOP?Ge.Status.HOP_DST_MULTIADDR_INVALID:Ge.Status.STOP_DST_MULTIADDR_INVALID),i}try{((n=r.srcPeer)==null?void 0:n.addrs)!=null&&r.srcPeer.addrs.forEach(i=>oe(i))}catch(i){throw kY(e,r.type===Ge.Type.HOP?Ge.Status.HOP_SRC_MULTIADDR_INVALID:Ge.Status.STOP_SRC_MULTIADDR_INVALID),i}}function ju(r){let e=Kt(),t=Yy(r.source),n=vt(),i,s=r.sink(async function*(){yield*e,yield*await n.promise}());return s.catch(a=>{i=a}),{reader:t,writer:e,stream:{sink:async a=>i!=null?await Promise.reject(i):(n.resolve(a),await s),source:t},rest:()=>e.end(),write:e.push,read:async()=>{let a=await t.next();if(a.value!=null)return a.value}}}var f2=D("libp2p:circuit:stream-handler"),sc=class{constructor(e){let{stream:t,maxLength:n=4096}=e;this.stream=t,this.shake=ju(this.stream),this.decoder=cr.fromReader(this.shake.reader,{maxDataLength:n})}async read(){let e=await this.decoder.next();if(e.value!=null){let t=Ge.decode(e.value);return f2("read message type",t.type),t}f2("read received no value, closing stream"),this.close()}write(e){f2("write message type %s",e.type),this.shake.write(vr.single(Ge.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){f2("closing the stream"),this.rest().sink([]).catch(e=>{f2.error(e)})}};var d2=D("libp2p:circuit:stop");function DY(r){let{connection:e,request:t,streamHandler:n}=r;try{D6(t,n)}catch(i){d2.error("invalid stop request via peer %p %o",e.remotePeer,i);return}return d2("stop request is valid"),n.write({type:Ge.Type.STATUS,code:Ge.Status.SUCCESS}),n.rest()}async function NY(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(Zo,{signal:n});d2("starting stop request to %p",e.remotePeer);let s=new sc({stream:i});s.write(t);let o=await s.read();if(o==null){s.close();return}if(o.code===Ge.Status.SUCCESS)return d2("stop request to %p was successful",e.remotePeer),s.rest();d2("stop request failed with code %d",o.code),s.close()}var ys=D("libp2p:circuit:hop");async function OY(r){let{connection:e,request:t,streamHandler:n,circuit:i,connectionManager:s}=r;if(!i.hopEnabled())return ys("HOP request received but we are not acting as a relay"),n.end({type:Ge.Type.STATUS,code:Ge.Status.HOP_CANT_SPEAK_RELAY});try{D6(t,n)}catch(f){ys.error("invalid hop request via peer %p %o",e.remotePeer,f);return}if(t.dstPeer==null){ys("HOP request received but we do not receive a dstPeer");return}let o=wr(t.dstPeer.id),a=s.getConnections(o);if(a.length===0&&!i.hopActive())return ys("HOP request received but we are not connected to the destination peer"),n.end({type:Ge.Type.STATUS,code:Ge.Status.HOP_NO_CONN_TO_DST});if(a.length===0)return ys("did not have connection to remote peer"),n.end({type:Ge.Type.STATUS,code:Ge.Status.HOP_NO_CONN_TO_DST});let c={type:Ge.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer},u;try{ys("performing STOP request");let f=await NY({connection:a[0],request:c});if(f==null)throw new Error("Could not stop");u=f}catch(f){ys.error(f);return}ys("hop request from %p is valid",e.remotePeer),n.write({type:Ge.Type.STATUS,code:Ge.Status.SUCCESS});let l=n.rest();return ys("creating related connections"),await _e(l,u,l)}async function LY(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(Zo,{signal:n}),s=new sc({stream:i});s.write(t);let o=await s.read();if(o==null)throw(0,Ix.default)(new Error("HOP request had no response"),$.ERR_HOP_REQUEST_FAILED);if(o.code===Ge.Status.SUCCESS)return ys("hop request was successful"),s.rest();throw ys("hop request failed with code %d, closing stream",o.code),s.close(),(0,Ix.default)(new Error(`HOP request failed with code "${o.code??"unknown"}"`),$.ERR_HOP_REQUEST_FAILED)}async function BY(r){let{connection:e,signal:t}=r,n=await e.newStream(Zo,{signal:t}),i=new sc({stream:n});i.write({type:Ge.Type.CAN_HOP});let s=await i.read();return await i.close(),!(s==null||s.code!==Ge.Status.SUCCESS)}function MY(r){let{connection:e,streamHandler:t,circuit:n}=r,i=n.hopEnabled();ys("can hop (%s) request from %p",i,e.remotePeer),t.end({type:Ge.Type.STATUS,code:i?Ge.Status.SUCCESS:Ge.Status.HOP_CANT_SPEAK_RELAY})}var FY=C(en(),1),VY=C(Tn(),1),ws=D("libp2p:circuit"),N6=class{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(Zo,e=>{this._onProtocol(e).catch(t=>{ws.error(t)})},{...this._init}).catch(e=>{ws.error(e)}))}async stop(){await this.components.registrar.unhandle(Zo)}hopEnabled(){return!0}hopActive(){return!0}get[_0](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){var s,o,a;let{connection:t,stream:n}=e,i=new FY.TimeoutController(this._init.hop.timeout);try{(s=VY.setMaxListeners)==null||s(1/0,i.signal)}catch{}try{let c=Mn(n,i.signal),u=new sc({stream:{...n,...c}}),l=await u.read();if(l==null){ws("request was invalid, could not read from stream"),u.write({type:Ge.Type.STATUS,code:Ge.Status.MALFORMED_MESSAGE}),u.close();return}let f;switch(l.type){case Ge.Type.CAN_HOP:{ws("received CAN_HOP request from %p",t.remotePeer),await MY({circuit:this,connection:t,streamHandler:u});break}case Ge.Type.HOP:{ws("received HOP request from %p",t.remotePeer),await OY({connection:t,request:l,streamHandler:u,circuit:this,connectionManager:this.components.connectionManager});break}case Ge.Type.STOP:{ws("received STOP request from %p",t.remotePeer),f=await DY({connection:t,request:l,streamHandler:u});break}default:{ws("Request of type %s not supported",l.type),u.write({type:Ge.Type.STATUS,code:Ge.Status.MALFORMED_MESSAGE}),u.close();return}}if(f!=null){let h=t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(oe((o=l.dstPeer)==null?void 0:o.addrs[0])),d=oe((a=l.srcPeer)==null?void 0:a.addrs[0]),m=Ax({stream:f,remoteAddr:h,localAddr:d}),w=l.type===Ge.Type.HOP?"relay":"inbound";ws("new %s connection %s",w,m.remoteAddr);let b=await this.components.upgrader.upgradeInbound(m);ws("%s connection %s upgraded",w,m.remoteAddr),this.handler!=null&&this.handler(b)}}finally{i.clear()}}async dial(e,t={}){let n=e.toString().split("/p2p-circuit"),i=oe(n[0]),s=oe(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){let d="Circuit relay dial failed as addresses did not have peer id";throw ws.error(d),(0,UY.default)(new Error(d),$.ERR_RELAYED_DIAL)}let c=fe(o),u=fe(a),l=!1,h=this.components.connectionManager.getConnections(c)[0];h==null&&(await this.components.peerStore.addressBook.add(c,[i]),h=await this.components.connectionManager.openConnection(c,t),l=!0);try{let d=await LY({...t,connection:h,request:{type:Ge.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map(b=>b.bytes)},dstPeer:{id:u.toBytes(),addrs:[oe(s).bytes]}}}),m=i.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),w=Ax({stream:d,remoteAddr:e,localAddr:m});return ws("new outbound connection %s",w.remoteAddr),await this.components.upgrader.upgradeOutbound(w)}catch(d){throw ws.error("Circuit relay dial failed",d),l&&await h.close(),d}}createListener(e){return this.handler=e.handler,PY({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>dl.matches(t))}};var V6=C(cx(),1);async function O6(r){let e=new TextEncoder().encode(r),t=await Pe.digest(e);return P.createV0(t)}var Rx="hop_relay",Cx="true",L6="/libp2p/relay";var jY=C(zY(),1);var KY="[a-fA-F\\d:]",Wu=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${KY})|(?<=${KY})(?=\\s|$))`:"",eo="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Yr="[a-fA-F\\d]{1,4}",B6=`
(?:
(?:${Yr}:){7}(?:${Yr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Yr}:){6}(?:${eo}|:${Yr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Yr}:){5}(?::${eo}|(?::${Yr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Yr}:){4}(?:(?::${Yr}){0,1}:${eo}|(?::${Yr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Yr}:){3}(?:(?::${Yr}){0,2}:${eo}|(?::${Yr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Yr}:){2}(?:(?::${Yr}){0,3}:${eo}|(?::${Yr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Yr}:){1}(?:(?::${Yr}){0,4}:${eo}|(?::${Yr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Yr}){0,5}:${eo}|(?::${Yr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),D4e=new RegExp(`(?:^${eo}$)|(?:^${B6}$)`),N4e=new RegExp(`^${eo}$`),O4e=new RegExp(`^${B6}$`),Px=r=>r&&r.exact?D4e:new RegExp(`(?:${Wu(r)}${eo}${Wu(r)})|(?:${Wu(r)}${B6}${Wu(r)})`,"g");Px.v4=r=>r&&r.exact?N4e:new RegExp(`${Wu(r)}${eo}${Wu(r)}`,"g");Px.v6=r=>r&&r.exact?O4e:new RegExp(`${Wu(r)}${B6}${Wu(r)}`,"g");var HY=Px;var WY=C(qY(),1),{isValid:L4e,parse:B4e}=WY.default,M4e=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],U4e=M4e.map(r=>new jY.Netmask(r));function F4e(r){for(let e of U4e)if(e.contains(r))return!0;return!1}function GY(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}var YY=r=>{if(L4e(r)){let e=B4e(r);if(e.kind()==="ipv4")return F4e(e.toNormalizedString());if(e.kind()==="ipv6")return GY(r)}else if(Cd(r)&&HY.v6().test(r))return GY(r)};var Mf=YY;function kx(r){let{address:e}=r.nodeAddress();return Boolean(Mf(e))}function I0(r,e){let t=kx(r.multiaddr),n=kx(e.multiaddr);return t&&!n?1:!t&&n||r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}var p2=D("libp2p:auto-relay"),z4e=()=>{},U6=class{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??I0,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??z4e,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",n=>{this._onProtocolChange(n).catch(i=>{p2.error(i)})}),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){let{peerId:t,protocols:n}=e.detail,i=t.toString();if(n.find(o=>o===Zo)==null){this.listenRelays.has(i)&&await this._removeListenRelay(i);return}if(!this.listenRelays.has(i))try{let o=this.components.connectionManager.getConnections(t);if(o.length===0)return;let a=o[0];if(a.remoteAddr.protoCodes().includes(290)){p2(`relayed connection to ${i} will not be used to hop on`);return}await BY({connection:a})&&(await this.components.peerStore.metadataBook.setValue(t,Rx,W(Cx)),await this._addListenRelay(a,i))}catch(o){this.onError(o)}}_onPeerDisconnected(e){let i=e.detail.remotePeer.toString();this.listenRelays.has(i)&&this._removeListenRelay(i).catch(s=>{p2.error(s)})}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;let n=await _e(await this.components.peerStore.addressBook.get(e.remotePeer),s=>xu(s,this.addressSorter),async s=>await rn(s));(await Promise.all(n.map(async s=>{try{let o=s.multiaddr;return o.getPeerId()==null&&(o=o.encapsulate(`/p2p/${e.remotePeer.toString()}`)),o=o.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([o]),!0}catch(o){p2.error("error listening on circuit address",o),this.onError(o)}return!1}))).includes(!0)&&this.listenRelays.add(t)}catch(n){this.onError(n),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;let t=[],n=await this.components.peerStore.all();for(let{id:i,metadata:s}of n){let o=i.toString();if(this.listenRelays.has(o)||e.includes(o))continue;let a=s.get(Rx);if(a==null||j(a)!==Cx)continue;let c=this.components.connectionManager.getConnections(i);if(c.length===0){t.push(i);continue}if(await this._addListenRelay(c[0],o),this.listenRelays.size>=this.maxListeners)return}for(let i of t)if(await this._tryToListenOnRelay(i),this.listenRelays.size>=this.maxListeners)return;try{let i=await O6(L6);for await(let s of this.components.contentRouting.findProviders(i)){if(s.multiaddrs.length===0)continue;let o=s.id;if(!o.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(o,s.multiaddrs),await this._tryToListenOnRelay(o),this.listenRelays.size>=this.maxListeners))return}}catch(i){this.onError(i)}}async _tryToListenOnRelay(e){try{let t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){p2.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}};var QY=D("libp2p:relay"),F6=class{constructor(e,t){var n;this.components=e,this.autoRelay=((n=t.autoRelay)==null?void 0:n.enabled)!==!1?new U6(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){this.init.hop.enabled!==!1&&this.init.advertise.enabled!==!1&&(this.timeout=(0,V6.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){this.timeout!=null&&(0,V6.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{let e=await O6(L6);await this.components.contentRouting.provide(e)}catch(e){e.code===$.ERR_NO_ROUTERS_AVAILABLE?(QY.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):QY.error(e)}}};var RQ=C(sQ(),1);var rmt=C(SQ(),1),nmt=C(I_(),1),oc=C(it(),1);var emt=C(Nx(),1),TQ=C(it(),1),xQ=TQ.default.pki,AQ=(r,e)=>{let t=xQ.rsa.setPublicKey(e.n,e.e),n=xQ.createCertificate();n.publicKey=t,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);let i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:r.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(e),n};async function IQ(r,e){let t=r.map(e),i=(await Promise.all(t)).findIndex(s=>s);return r[i]}var ac=C(Y(),1);var y6e=D("libp2p:keychain:cms"),Bx=new WeakMap,$6=class{constructor(e,t){if(e==null)throw(0,ac.default)(new Error("keychain is required"),$.ERR_KEYCHAIN_REQUIRED);this.keychain=e,Bx.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw(0,ac.default)(new Error("Plain data must be a Uint8Array"),$.ERR_INVALID_PARAMETERS);let n=await this.keychain.findKeyByName(e),i=await this.keychain.getPrivateKey(e),s=Bx.get(this);if(s==null)throw(0,ac.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let o=s.dek,a=oc.default.pki.decryptRsaPrivateKey(i,o),c=await AQ(n,a),u=oc.default.pkcs7.createEnvelopedData();u.addRecipient(c),u.content=oc.default.util.createBuffer(t),u.encrypt();let l=oc.default.asn1.toDer(u.toAsn1()).getBytes();return W(l,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw(0,ac.default)(new Error("CMS data is required"),$.ERR_INVALID_PARAMETERS);let t;try{let l=oc.default.util.createBuffer(j(e,"ascii")),f=oc.default.asn1.fromDer(l);t=oc.default.pkcs7.messageFromAsn1(f)}catch(l){throw y6e.error(l),(0,ac.default)(new Error("Invalid CMS"),$.ERR_INVALID_CMS)}let n=t.recipients.filter(l=>l.issuer.find(f=>f.shortName==="O"&&f.value==="ipfs")).filter(l=>l.issuer.find(f=>f.shortName==="CN")).map(l=>({recipient:l,keyId:l.issuer.find(f=>f.shortName==="CN").value})),i=await IQ(n,async l=>{try{if(await this.keychain.findKeyById(l.keyId)!=null)return!0}catch{return!1}return!1});if(i==null){let l=n.map(f=>f.keyId);throw(0,ac.default)(new Error(`Decryption needs one of the key(s): ${l.join(", ")}`),$.ERR_MISSING_KEYS,{missingKeys:l})}let s=await this.keychain.findKeyById(i.keyId);if(s==null)throw(0,ac.default)(new Error("No key available to decrypto"),$.ERR_NO_KEY);let o=await this.keychain.getPrivateKey(s.name),a=Bx.get(this);if(a==null)throw(0,ac.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let c=a.dek,u=oc.default.pki.decryptRsaPrivateKey(o,c);return t.decrypt(i.recipient,u),W(t.content.getBytes(),"ascii")}};var kt=C(Y(),1);var q6=D("libp2p:keychain"),w6e="/pkcs8/",CQ="/info/",Qu=new WeakMap,Vf={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},Mx={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function cc(r){return r==null||typeof r!="string"?!1:r===(0,RQ.default)(r.trim())&&r.length>0}async function Gt(){let t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function Jo(r){return new le(w6e+r)}function uc(r){return new le(CQ+r)}var zf=class{constructor(e,t){var i,s,o,a,c,u,l,f,h,d;if(this.components=e,this.init=Ve(Mx,t),this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<Vf.minKeyLength)throw new Error(`dek.keyLength must be least ${Vf.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<Vf.minSaltLength)throw new Error(`dek.saltLength must be least ${Vf.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<Vf.minIterationCount)throw new Error(`dek.iterationCount must be least ${Vf.minIterationCount}`);let n=this.init.pass!=null&&((u=this.init.dek)==null?void 0:u.salt)!=null?Hm(this.init.pass,(l=this.init.dek)==null?void 0:l.salt,(f=this.init.dek)==null?void 0:f.iterationCount,(h=this.init.dek)==null?void 0:h.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";Qu.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){let e=uc("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){let e=Qu.get(this);if(e==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let t=e.dek;return new $6(this,t)}static generateOptions(){let e=Object.assign({},Mx),t=Math.ceil(Vf.minSaltLength/3)*3;return e.dek.salt=j(ri(t),"base64"),e}static get options(){return Mx}async createKey(e,t,n=2048){if(!cc(e)||e==="self")throw await Gt(),(0,kt.default)(new Error("Invalid key name"),$.ERR_INVALID_KEY_NAME);if(typeof t!="string")throw await Gt(),(0,kt.default)(new Error("Invalid key type"),$.ERR_INVALID_KEY_TYPE);let i=Jo(e);if(await this.components.datastore.has(i))throw await Gt(),(0,kt.default)(new Error("Key name already exists"),$.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await Gt(),(0,kt.default)(new Error("Invalid RSA key size"),$.ERR_INVALID_KEY_SIZE);break;default:break}let o;try{let a=await rh(t,n),c=await a.id(),u=Qu.get(this);if(u==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let l=u.dek,f=await a.export(l);o={name:e,id:c};let h=this.components.datastore.batch();h.put(i,W(f)),h.put(uc(e),W(JSON.stringify(o))),await h.commit()}catch(a){throw await Gt(),a}return o}async listKeys(){let e={prefix:CQ},t=[];for await(let n of this.components.datastore.query(e))t.push(JSON.parse(j(n.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find(n=>n.id===e)}catch(t){throw await Gt(),t}}async findKeyByName(e){if(!cc(e))throw await Gt(),(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);let t=uc(e);try{let n=await this.components.datastore.get(t);return JSON.parse(j(n))}catch(n){throw await Gt(),q6.error(n),(0,kt.default)(new Error(`Key '${e}' does not exist.`),$.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!cc(e)||e==="self")throw await Gt(),(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);let t=Jo(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(uc(e)),await i.commit(),n}async renameKey(e,t){if(!cc(e)||e==="self")throw await Gt(),(0,kt.default)(new Error(`Invalid old key name '${e}'`),$.ERR_OLD_KEY_NAME_INVALID);if(!cc(t)||t==="self")throw await Gt(),(0,kt.default)(new Error(`Invalid new key name '${t}'`),$.ERR_NEW_KEY_NAME_INVALID);let n=Jo(e),i=Jo(t),s=uc(e),o=uc(t);if(await this.components.datastore.has(i))throw await Gt(),(0,kt.default)(new Error(`Key '${t}' already exists`),$.ERR_KEY_ALREADY_EXISTS);try{let c=await this.components.datastore.get(n),u=await this.components.datastore.get(s),l=JSON.parse(j(u));l.name=t;let f=this.components.datastore.batch();return f.put(i,c),f.put(o,W(JSON.stringify(l))),f.delete(n),f.delete(s),await f.commit(),l}catch(c){throw await Gt(),c}}async exportKey(e,t){if(!cc(e))throw await Gt(),(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);if(t==null)throw await Gt(),(0,kt.default)(new Error("Password is required"),$.ERR_PASSWORD_REQUIRED);let n=Jo(e);try{let i=await this.components.datastore.get(n),s=j(i),o=Qu.get(this);if(o==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let a=o.dek;return await(await Io(s,a)).export(t)}catch(i){throw await Gt(),i}}async exportPeerId(e){let t="temporary-password",n=await this.exportKey(e,t),i=await Io(n,t);return await br(i.public.bytes,i.bytes)}async importKey(e,t,n){if(!cc(e)||e==="self")throw await Gt(),(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);if(t==null)throw await Gt(),(0,kt.default)(new Error("PEM encoded key is required"),$.ERR_PEM_REQUIRED);let i=Jo(e);if(await this.components.datastore.has(i))throw await Gt(),(0,kt.default)(new Error(`Key '${e}' already exists`),$.ERR_KEY_ALREADY_EXISTS);let o;try{o=await Io(t,n)}catch{throw await Gt(),(0,kt.default)(new Error("Cannot read the key, most likely the password is wrong"),$.ERR_CANNOT_READ_KEY)}let a;try{a=await o.id();let l=Qu.get(this);if(l==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let f=l.dek;t=await o.export(f)}catch(l){throw await Gt(),l}let c={name:e,id:a},u=this.components.datastore.batch();return u.put(i,W(t)),u.put(uc(e),W(JSON.stringify(c))),await u.commit(),c}async importPeer(e,t){try{if(!cc(e))throw(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);if(t==null)throw(0,kt.default)(new Error("PeerId is required"),$.ERR_MISSING_PRIVATE_KEY);if(t.privateKey==null)throw(0,kt.default)(new Error("PeerId.privKey is required"),$.ERR_MISSING_PRIVATE_KEY);let n=await hn(t.privateKey),i=Jo(e);if(await this.components.datastore.has(i))throw await Gt(),(0,kt.default)(new Error(`Key '${e}' already exists`),$.ERR_KEY_ALREADY_EXISTS);let o=Qu.get(this);if(o==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let a=o.dek,c=await n.export(a),u={name:e,id:t.toString()},l=this.components.datastore.batch();return l.put(i,W(c)),l.put(uc(e),W(JSON.stringify(u))),await l.commit(),u}catch(n){throw await Gt(),n}}async getPrivateKey(e){if(!cc(e))throw await Gt(),(0,kt.default)(new Error(`Invalid key name '${e}'`),$.ERR_INVALID_KEY_NAME);try{let t=Jo(e),n=await this.components.datastore.get(t);return j(n)}catch(t){throw await Gt(),q6.error(t),(0,kt.default)(new Error(`Key '${e}' does not exist.`),$.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){var a,c,u,l;if(typeof e!="string")throw await Gt(),(0,kt.default)(new Error(`Invalid old pass type '${typeof e}'`),$.ERR_INVALID_OLD_PASS_TYPE);if(typeof t!="string")throw await Gt(),(0,kt.default)(new Error(`Invalid new pass type '${typeof t}'`),$.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await Gt(),(0,kt.default)(new Error(`Invalid pass length ${t.length}`),$.ERR_INVALID_PASS_LENGTH);q6("recreating keychain");let n=Qu.get(this);if(n==null)throw(0,kt.default)(new Error("dek missing"),$.ERR_INVALID_PARAMETERS);let i=n.dek;this.init.pass=t;let s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?Hm(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(u=this.init.dek)==null?void 0:u.keyLength,(l=this.init.dek)==null?void 0:l.hash):"";Qu.set(this,{dek:s});let o=await this.listKeys();for(let f of o){let h=await this.components.datastore.get(Jo(f.name)),d=j(h),m=await Io(d,i),w=s.toString(),b=await m.export(w),v=this.components.datastore.batch(),T={name:f.name,id:f.id};v.put(Jo(f.name),W(b)),v.put(uc(f.name),W(JSON.stringify(T))),await v.commit()}q6("keychain reconstructed")}};async function m2(r){try{return{status:"fulfilled",value:await r,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}var Ux=class{constructor(e){td(this,"value");td(this,"next");this.value=e}},ea,Kf,Hf,g2=class{constructor(){ig(this,ea,void 0);ig(this,Kf,void 0);ig(this,Hf,void 0);this.clear()}enqueue(e){let t=new Ux(e);Ec(this,ea)?(Ec(this,Kf).next=t,ua(this,Kf,t)):(ua(this,ea,t),ua(this,Kf,t)),qw(this,Hf)._++}dequeue(){let e=Ec(this,ea);if(e)return ua(this,ea,Ec(this,ea).next),qw(this,Hf)._--,e.value}clear(){ua(this,ea,void 0),ua(this,Kf,void 0),ua(this,Hf,0)}get size(){return Ec(this,Hf)}*[Symbol.iterator](){let e=Ec(this,ea);for(;e;)yield e.value,e=e.next}};ea=new WeakMap,Kf=new WeakMap,Hf=new WeakMap;function Fx(r){if(!((Number.isInteger(r)||r===Number.POSITIVE_INFINITY)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new g2,t=0,n=()=>{t--,e.size>0&&e.dequeue()()},i=async(a,c,u)=>{t++;let l=(async()=>a(...u))();c(l);try{await l}catch{}n()},s=(a,c,u)=>{e.enqueue(i.bind(void 0,a,c,u)),(async()=>(await Promise.resolve(),t<r&&e.size>0&&e.dequeue()()))()},o=(a,...c)=>new Promise(u=>{s(a,u,c)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o}async function Vx(r,e={}){let{concurrency:t=Number.POSITIVE_INFINITY}=e,n=Fx(t);return Promise.all(r.map(i=>i&&typeof i.then=="function"?m2(i):typeof i=="function"?m2(n(()=>i())):m2(Promise.resolve(i))))}var k0=C(Y(),1);var zx=class extends Map{constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function Vi(r){let{name:e,metrics:t}=r,n;return t!=null?n=new zx({name:e,metrics:t}):n=new Map,n}var $f=D("libp2p:transports"),G6=class extends Ue{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=Vi({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??$u.FATAL_ALL}add(e){let t=e[Symbol.toStringTag];if(t==null)throw(0,k0.default)(new Error("Transport must have a valid tag"),$.ERR_INVALID_KEY);if(this.transports.has(t))throw(0,k0.default)(new Error("There is already a transport with this tag"),$.ERR_DUPLICATE_TRANSPORT);$f("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){let e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){let e=[];for(let[t,n]of this.listeners)for($f("closing listeners for %s",t);n.length>0;){let i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),$f("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){let n=this.transportForMultiaddr(e);if(n==null)throw(0,k0.default)(new Error(`No transport available for address ${String(e)}`),$.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(i){throw i.code==null&&(i.code=$.ERR_TRANSPORT_DIAL_FAILED),i}}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(let t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(e==null||e.length===0){$f("no addresses were provided for listening, this node is dial only");return}let t=[];for(let[n,i]of this.transports.entries()){let s=i.filter(e),o=[];for(let u of s){$f("creating listener for %s on %s",n,u);let l=i.createListener({upgrader:this.components.upgrader}),f=this.listeners.get(n);f==null&&(f=[],this.listeners.set(n,f)),f.push(l),l.addEventListener("listening",()=>{this.dispatchEvent(new ie("listener:listening",{detail:l}))}),l.addEventListener("close",()=>{this.dispatchEvent(new ie("listener:close",{detail:l}))}),o.push(l.listen(u))}if(o.length===0){t.push(n);continue}if((await Vx(o)).find(u=>u.isFulfilled)==null&&this.faultTolerance!==$u.NO_FATAL)throw(0,k0.default)(new Error(`Transport (${n}) could not listen on any available address`),$.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){let n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===$u.FATAL_ALL)throw(0,k0.default)(new Error(n),$.ERR_NO_VALID_ADDRESSES);$f(`libp2p in dial mode only: ${n}`)}}async remove(e){$f("removing %s",e);for(let t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}};var nn=C(Y(),1);var lc="/multistream/1.0.0";var NQ=C(Y(),1);var Kx=C(Y(),1);var _6e=D("libp2p:mss"),PQ=W(`
`);function y2(r){let e=new qe(r,PQ);return vr.single(e)}function qf(r,e,t={}){let n=y2(e);t.writeBytes===!0?r.push(n.subarray()):r.push(n)}function kQ(r,e,t={}){let n=new qe;for(let i of e)n.append(y2(i));t.writeBytes===!0?r.push(n.subarray()):r.push(n)}async function E6e(r,e){let t=1,n={[Symbol.asyncIterator]:()=>n,next:async()=>await r.next(t)},i=n;(e==null?void 0:e.signal)!=null&&(i=Cr(n,e.signal));let o=await _e(i,cr({onLength:a=>{t=a},maxDataLength:1024}),async a=>await Tr(a));if(o==null||o.length===0)throw(0,Kx.default)(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==PQ[0])throw _6e.error("Invalid mss message - missing newline - %s",o.subarray()),(0,Kx.default)(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function D0(r,e){let t=await E6e(r,e);return j(t.subarray())}var w2=D("libp2p:mss:select");async function b2(r,e,t={}){e=Array.isArray(e)?[...e]:[e];let{reader:n,writer:i,rest:s,stream:o}=ju(r),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");w2('select: write ["%s", "%s"]',lc,a);let c=W(lc),u=W(a);kQ(i,[c,u],t);let l=await D0(n,t);if(w2('select: read "%s"',l),l===lc&&(l=await D0(n,t),w2('select: read "%s"',l)),l===a)return s(),{stream:o,protocol:a};for(let f of e){w2('select: write "%s"',f),qf(i,W(f),t);let h=await D0(n,t);if(w2('select: read "%s" for "%s"',h,f),h===f)return s(),{stream:o,protocol:f}}throw s(),(0,NQ.default)(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}var _2=D("libp2p:mss:handle");async function E2(r,e,t){e=Array.isArray(e)?e:[e];let{writer:n,reader:i,rest:s,stream:o}=ju(r);for(;;){let a=await D0(i,t);if(_2('read "%s"',a),a===lc){_2('respond with "%s" for "%s"',lc,a),qf(n,W(lc),t);continue}if(e.includes(a))return qf(n,W(a),t),_2('respond with "%s" for "%s"',a,a),s(),{stream:o,protocol:a};if(a==="ls"){qf(n,new qe(...e.map(c=>y2(W(c)))),t),_2('respond with "%s" for %s',e,a);continue}qf(n,W("na"),t),_2('respond with "na" for "%s"',a)}}var Hx=C(Y(),1);var OQ=Symbol.for("@libp2p/connection");var S6e=D("libp2p:connection"),$x=class{constructor(e){let{remoteAddr:t,remotePeer:n,newStream:i,close:s,getStreams:o,stat:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...a,status:x6},this._newStream=i,this._close=s,this._getStreams=o,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[OQ](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===ux)throw(0,Hx.default)(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===T6)throw(0,Hx.default)(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);let n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(!(this.stat.status===T6||this._closing)){this.stat.status=ux;try{this.streams.forEach(e=>e.close())}catch(e){S6e.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=T6}}};function LQ(r){return new $x(r)}var j6=C(Y(),1);var qx=D("libp2p:registrar"),Gx=32,jx=64,W6=class{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this._onConnect=this._onConnect.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.connectionManager.addEventListener("peer:connect",this._onConnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw(0,j6.default)(new Error(`No handler registered for protocol ${e}`),$.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw(0,j6.default)(new Error(`Handler already registered for protocol ${e}`),$.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);let i=Ve.bind({ignoreUndefined:!0})({maxInboundStreams:Gx,maxOutboundStreams:jx},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){let t=Array.isArray(e)?e:[e];t.forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(!vH(t))throw qx.error("topology must be an instance of interfaces/topology"),(0,j6.default)(new Error("topology must be an instance of interfaces/topology"),$.ERR_INVALID_PARAMETERS);let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),await t.setRegistrar(this),n}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let s=this.topologies.get(i);if(s!=null)for(let o of s.values())o.onDisconnect(t.remotePeer)}}).catch(n=>{qx.error(n)})}_onConnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let s=this.topologies.get(i);if(s!=null)for(let o of s.values())o.onConnect(t.remotePeer,t)}}).catch(n=>{qx.error(n)})}_onProtocolChange(e){let{peerId:t,protocols:n,oldProtocols:i}=e.detail,s=i.filter(a=>!n.includes(a)),o=n.filter(a=>!i.includes(a));for(let a of s){let c=this.topologies.get(a);if(c!=null)for(let u of c.values())u.onDisconnect(t)}for(let a of o){let c=this.topologies.get(a);if(c!=null)for(let u of c.values()){let l=this.components.connectionManager.getConnections(t)[0];l!=null&&u.onConnect(t,l)}}}};var Wx=C(en(),1);var Yx=C(Tn(),1),rr=D("libp2p:upgrader");function x6e(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.code!==$.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return Gx}function T6e(r,e){try{let{options:t}=e.getHandler(r);return t.maxOutboundStreams}catch(t){if(t.code!==$.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return jx}function BQ(r,e,t){let n=0;return t.streams.forEach(i=>{i.stat.direction===e&&i.stat.protocol===r&&n++}),n}var Y6=class extends Ue{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(n=>{this.connectionEncryption.set(n.protocol,n)}),this.muxers=new Map,t.muxers.forEach(n=>{this.muxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e,t){var l,f;if(!await this.components.connectionManager.acceptIncomingConnection(e))throw(0,nn.default)(new Error("connection denied"),$.ERR_CONNECTION_DENIED);let i,s,o,a,c,u=new Wx.TimeoutController(this.inboundUpgradeTimeout);try{(l=Yx.setMaxListeners)==null||l(1/0,u.signal)}catch{}try{let h=Mn(e,u.signal);if(e.source=h.source,e.sink=h.sink,await this.components.connectionGater.denyInboundConnection(e))throw(0,nn.default)(new Error("The multiaddr connection is blocked by gater.acceptConnection"),$.ERR_CONNECTION_INTERCEPTED);(f=this.components.metrics)==null||f.trackMultiaddrConnection(e),rr("starting the inbound connection upgrade");let d=e;if((t==null?void 0:t.skipProtection)!==!0){let m=this.components.connectionProtector;m!=null&&(rr("protecting the inbound connection"),d=await m.protect(e))}try{if(i=d,(t==null?void 0:t.skipEncryption)!==!0){if({conn:i,remotePeer:s,protocol:c}=await this._encryptInbound(d),await this.components.connectionGater.denyInboundEncryptedConnection(s,{...d,...i}))throw(0,nn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),$.ERR_CONNECTION_INTERCEPTED)}else{let m=e.remoteAddr.getPeerId();if(m==null)throw(0,nn.default)(new Error("inbound connection that skipped encryption must have a peer id"),$.ERR_INVALID_MULTIADDR);let w=fe(m);c="native",s=w}if(o=i,(t==null?void 0:t.muxerFactory)!=null)a=t.muxerFactory;else if(this.muxers.size>0){let m=await this._multiplexInbound({...d,...i},this.muxers);a=m.muxerFactory,o=m.stream}}catch(m){throw rr.error("Failed to upgrade inbound connection",m),m}if(await this.components.connectionGater.denyInboundUpgradedConnection(s,{...d,...i}))throw(0,nn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),$.ERR_CONNECTION_INTERCEPTED);return rr("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:c,direction:"inbound",maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(e,t){var f;let n=e.remoteAddr.getPeerId(),i;if(n!=null&&(i=fe(n),await this.components.connectionGater.denyOutboundConnection(i,e)))throw(0,nn.default)(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),$.ERR_CONNECTION_INTERCEPTED);let s,o,a,c,u;(f=this.components.metrics)==null||f.trackMultiaddrConnection(e),rr("Starting the outbound connection upgrade");let l=e;if((t==null?void 0:t.skipProtection)!==!0){let h=this.components.connectionProtector;h!=null&&(l=await h.protect(e))}try{if(s=l,(t==null?void 0:t.skipEncryption)!==!0){if({conn:s,remotePeer:o,protocol:c}=await this._encryptOutbound(l,i),await this.components.connectionGater.denyOutboundEncryptedConnection(o,{...l,...s}))throw(0,nn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),$.ERR_CONNECTION_INTERCEPTED)}else{if(i==null)throw(0,nn.default)(new Error("Encryption was skipped but no peer id was passed"),$.ERR_INVALID_PEER);c="native",o=i}if(a=s,(t==null?void 0:t.muxerFactory)!=null)u=t.muxerFactory;else if(this.muxers.size>0){let h=await this._multiplexOutbound({...l,...s},this.muxers);u=h.muxerFactory,a=h.stream}}catch(h){throw rr.error("Failed to upgrade outbound connection",h),await e.close(h),h}if(await this.components.connectionGater.denyOutboundUpgradedConnection(o,{...l,...s}))throw(0,nn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),$.ERR_CONNECTION_INTERCEPTED);return rr("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:c,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:u,remotePeer:o})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a}=e,c,u,l;a!=null&&(c=a.createStreamMuxer({direction:n,onIncomingStream:d=>{l!=null&&Promise.resolve().then(async()=>{var p;let m=this.components.registrar.getProtocols(),{stream:w,protocol:b}=await E2(d,m);if(rr("%s: incoming stream opened on %s",n,b),l==null)return;let v=x6e(b,this.components.registrar);if(BQ(b,"inbound",l)===v){d.abort((0,nn.default)(new Error(`Too many inbound protocol streams for protocol "${b}" - limit ${v}`),$.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS));return}d.source=w.source,d.sink=w.sink,d.stat.protocol=b,this.components.peerStore.protoBook.add(o,[b]).catch(g=>rr.error(g)),l.addStream(d),(p=this.components.metrics)==null||p.trackProtocolStream(d,l),this._onStream({connection:l,stream:d,protocol:b})}).catch(m=>{rr.error(m),d.stat.timeline.close==null&&d.close()})},onStreamEnd:d=>{l==null||l.removeStream(d.id)}}),u=async(d,m={})=>{var v,T;if(c==null)throw(0,nn.default)(new Error("Stream is not multiplexed"),$.ERR_MUXER_UNAVAILABLE);rr("%s: starting new stream on %s",n,d);let w=await c.newStream(),b;try{if(m.signal==null){rr("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",d),b=new Wx.TimeoutController(3e4),m.signal=b.signal;try{(v=Yx.setMaxListeners)==null||v(1/0,b.signal)}catch{}}let{stream:p,protocol:g}=await b2(w,d,m),y=T6e(g,this.components.registrar);if(BQ(g,"outbound",l)===y){let _=(0,nn.default)(new Error(`Too many outbound protocol streams for protocol "${g}" - limit ${y}`),$.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw w.abort(_),_}return this.components.peerStore.protoBook.add(o,[g]).catch(_=>rr.error(_)),w.source=p.source,w.sink=p.sink,w.stat.protocol=g,(T=this.components.metrics)==null||T.trackProtocolStream(w,l),w}catch(p){throw rr.error("could not create new stream",p),w.stat.timeline.close==null&&w.close(),p.code!=null?p:(0,nn.default)(p,$.ERR_UNSUPPORTED_PROTOCOL)}finally{b!=null&&b.clear()}},Promise.all([c.sink(s.source),s.sink(c.source)]).catch(d=>{rr.error(d)}));let f=i.timeline;i.timeline=new Proxy(f,{set:(...d)=>(l!=null&&d[1]==="close"&&d[2]!=null&&f.close==null&&(async()=>{try{l.stat.status==="OPEN"&&await l.close()}catch(m){rr.error(m)}finally{this.dispatchEvent(new ie("connectionEnd",{detail:l}))}})().catch(m=>{rr.error(m)}),Reflect.set(...d))}),i.timeline.upgraded=Date.now();let h=()=>{throw(0,nn.default)(new Error("connection is not multiplexed"),$.ERR_CONNECTION_NOT_MULTIPLEXED)};return l=LQ({remoteAddr:i.remoteAddr,remotePeer:o,stat:{status:"OPEN",direction:n,timeline:i.timeline,multiplexer:c==null?void 0:c.protocol,encryption:t},newStream:u??h,getStreams:()=>c!=null?c.streams:h(),close:async()=>{await i.close(),c!=null&&c.close()}}),this.dispatchEvent(new ie("connection",{detail:l})),l}_onStream(e){let{connection:t,stream:n,protocol:i}=e,{handler:s}=this.components.registrar.getHandler(i);s({connection:t,stream:n})}async _encryptInbound(e){let t=Array.from(this.connectionEncryption.keys());rr("handling inbound crypto protocol selection",t);try{let{stream:n,protocol:i}=await E2(e,t,{writeBytes:!0}),s=this.connectionEncryption.get(i);if(s==null)throw new Error(`no crypto module found for ${i}`);return rr("encrypting inbound connection..."),{...await s.secureInbound(this.components.peerId,n),protocol:i}}catch(n){throw(0,nn.default)(n,$.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){let n=Array.from(this.connectionEncryption.keys());rr("selecting outbound crypto protocol",n);try{let{stream:i,protocol:s}=await b2(e,n,{writeBytes:!0}),o=this.connectionEncryption.get(s);if(o==null)throw new Error(`no crypto module found for ${s}`);return rr("encrypting outbound connection to %p",t),{...await o.secureOutbound(this.components.peerId,i,t),protocol:s}}catch(i){throw(0,nn.default)(i,$.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){let n=Array.from(t.keys());rr("outbound selecting muxer %s",n);try{let{stream:i,protocol:s}=await b2(e,n,{writeBytes:!0});rr("%s selected as muxer protocol",s);let o=t.get(s);return{stream:i,muxerFactory:o}}catch(i){throw rr.error("error multiplexing outbound stream",i),(0,nn.default)(i,$.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){let n=Array.from(t.keys());rr("inbound handling muxers %s",n);try{let{stream:i,protocol:s}=await E2(e,n,{writeBytes:!0}),o=t.get(s);return{stream:i,muxerFactory:o}}catch(i){throw rr.error("error multiplexing inbound stream",i),(0,nn.default)(i,$.ERR_MUXER_UNAVAILABLE)}}};var jf=C(Y(),1);var Gf;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={listenAddrs:[],protocols:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 5:i.protocolVersion=t.string();break;case 6:i.agentVersion=t.string();break;case 1:i.publicKey=t.bytes();break;case 2:i.listenAddrs.push(t.bytes());break;case 4:i.observedAddr=t.bytes();break;case 3:i.protocols.push(t.string());break;case 8:i.signedPeerRecord=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(Gf||(Gf={}));var Q6="0.0.0",MQ="libp2p";var Qx=`js-libp2p/${Q6}`;var UQ="0.1.0",FQ="id",VQ="id/push",zQ="1.0.0",KQ="1.0.0";var v2=C(en(),1);var S2=C(Tn(),1),Yt=D("libp2p:identify"),HQ=1024*8,N0=class{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/${FQ}/${zQ}`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/${VQ}/${KQ}`,this.host={protocolVersion:`${t.protocolPrefix}/${UQ}`,...t.host},this.components.connectionManager.addEventListener("peer:connect",n=>{let i=n.detail;this.identify(i).catch(Yt.error)}),this.components.peerStore.addEventListener("change:multiaddrs",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(s=>Yt.error(s))}),this.components.peerStore.addEventListener("change:protocols",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(s=>Yt.error(s))})}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",W(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",W(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(t=>{Yt.error(t)})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(t=>{Yt.error(t)})},{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){let t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map(o=>o.bytes),i=await this.components.peerStore.protoBook.get(this.components.peerId),s=e.map(async o=>{var u;let a,c=new v2.TimeoutController(this.init.timeout);try{(u=S2.setMaxListeners)==null||u(1/0,c.signal)}catch{}try{a=await o.newStream([this.identifyPushProtocolStr],{signal:c.signal}),await Mn(a,c.signal).sink(_e([Gf.encode({listenAddrs:n,signedPeerRecord:t,protocols:i})],vr()))}catch(l){Yt.error("could not push identify update to peer",l)}finally{a!=null&&a.close(),c.clear()}});await Promise.all(s)}async pushToPeerStore(){if(!this.isStarted())return;let e=[];for(let t of this.components.connectionManager.getConnections()){let n=t.remotePeer;(await this.components.peerStore.get(n)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){var o;let n,i=t.signal,s;if(i==null){n=new v2.TimeoutController(this.init.timeout),i=n.signal;try{(o=S2.setMaxListeners)==null||o(1/0,n.signal)}catch{}}try{s=await e.newStream([this.identifyProtocolStr],{signal:i});let a=Mn(s,i),c=await _e([],a,cr({maxDataLength:this.init.maxIdentifyMessageSize??HQ}),async u=>await Tr(u));if(c==null)throw(0,jf.default)(new Error("No data could be retrieved"),$.ERR_CONNECTION_ENDED);try{return Gf.decode(c)}catch(u){throw(0,jf.default)(u,$.ERR_INVALID_MESSAGE)}}finally{n!=null&&n.clear(),s!=null&&s.close()}}async identify(e,t={}){let n=await this._identify(e,t),{publicKey:i,listenAddrs:s,protocols:o,observedAddr:a,signedPeerRecord:c,agentVersion:u,protocolVersion:l}=n;if(i==null)throw(0,jf.default)(new Error("public key was missing from identify message"),$.ERR_MISSING_PUBLIC_KEY);let f=await br(i);if(!e.remotePeer.equals(f))throw(0,jf.default)(new Error("identified peer does not match the expected peer"),$.ERR_INVALID_PEER);if(this.components.peerId.equals(f))throw(0,jf.default)(new Error("identified peer is our own peer id?"),$.ERR_INVALID_PEER);let h=N0.getCleanMultiaddr(a);if(c!=null){Yt("received signed peer record from %p",f);try{let d=await Mr.openAndCertify(c,qr.DOMAIN);if(!d.peerId.equals(f))throw(0,jf.default)(new Error("identified peer does not match the expected peer"),$.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(d)){await this.components.peerStore.protoBook.set(f,o),u!=null&&await this.components.peerStore.metadataBook.setValue(f,"AgentVersion",W(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(f,"ProtocolVersion",W(l)),Yt("identify completed for peer %p and protocols %o",f,o);return}}catch(d){Yt("received invalid envelope, discard it and fallback to listenAddrs is available",d)}}else Yt("no signed peer record received from %p",f);Yt("falling back to legacy addresses from %p",f);try{await this.components.peerStore.addressBook.set(f,s.map(d=>oe(d)))}catch(d){Yt.error("received invalid addrs",d)}await this.components.peerStore.protoBook.set(f,o),u!=null&&await this.components.peerStore.metadataBook.setValue(f,"AgentVersion",W(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(f,"ProtocolVersion",W(l)),Yt("identify completed for peer %p and protocols %o",f,o),Yt("received observed address of %s",h==null?void 0:h.toString())}async _handleIdentify(e){var s;let{connection:t,stream:n}=e,i=new v2.TimeoutController(this.init.timeout);try{(s=S2.setMaxListeners)==null||s(1/0,i.signal)}catch{}try{let o=this.components.peerId.publicKey??new Uint8Array(0),a=await this.components.peerStore.get(this.components.peerId),c=this.components.addressManager.getAddresses().map(d=>d.decapsulateCode(Nt("p2p").code)),u=a.peerRecordEnvelope;if(c.length>0&&u==null){let d=new qr({peerId:this.components.peerId,multiaddrs:c}),m=await Mr.seal(d,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(m),u=m.marshal().subarray()}let l=Gf.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:o,listenAddrs:c.map(d=>d.bytes),signedPeerRecord:u,observedAddr:t.remoteAddr.bytes,protocols:a.protocols}),f=Mn(n,i.signal),h=_e([l],vr());await f.sink(h)}catch(o){Yt.error("could not respond to identify request",o)}finally{n.close(),i.clear()}}async _handlePush(e){var a;let{connection:t,stream:n}=e,i=new v2.TimeoutController(this.init.timeout);try{(a=S2.setMaxListeners)==null||a(1/0,i.signal)}catch{}let s;try{let c=Mn(n,i.signal),u=await _e([],c,cr({maxDataLength:this.init.maxIdentifyMessageSize??HQ}),async l=>await Tr(l));u!=null&&(s=Gf.decode(u))}catch(c){return Yt.error("received invalid message",c)}finally{n.close(),i.clear()}if(s==null)return Yt.error("received invalid message");let o=t.remotePeer;if(this.components.peerId.equals(o)){Yt("received push from ourselves?");return}if(Yt("received push from %p",o),s.signedPeerRecord!=null){Yt("received signedPeerRecord in push");try{let c=await Mr.openAndCertify(s.signedPeerRecord,qr.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(c)){Yt("consumed signedPeerRecord sent in push"),await this.components.peerStore.protoBook.set(o,s.protocols);return}else Yt("failed to consume signedPeerRecord sent in push")}catch(c){Yt("received invalid envelope, discard it and fallback to listenAddrs is available",c)}}else Yt("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(o,s.listenAddrs.map(c=>oe(c)))}catch(c){Yt.error("received invalid addrs",c)}try{await this.components.peerStore.protoBook.set(o,s.protocols)}catch(c){Yt.error("received invalid protocols",c)}Yt("handled push from %p",o)}static getCleanMultiaddr(e){if(e!=null&&e.length>0)try{return oe(e)}catch{}}};var O0=C(Y(),1);var x2;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identifier!=="")&&(n.uint32(10),n.string(t.identifier)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identifier:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.identifier=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(x2||(x2={}));var to;(function(r){let e;(function(i){i.OK="OK",i.NOT_FOUND="NOT_FOUND",i.ERROR="ERROR"})(e=r.StatusCode||(r.StatusCode={}));let t;(function(i){i[i.OK=0]="OK",i[i.NOT_FOUND=1]="NOT_FOUND",i[i.ERROR=2]="ERROR"})(t||(t={})),function(i){i.codec=()=>Si(t)}(e=r.StatusCode||(r.StatusCode={}));let n;r.codec=()=>(n==null&&(n=nt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),(o.writeDefaults===!0||i.status!=null&&t[i.status]!==0)&&(s.uint32(8),r.StatusCode.codec().encode(i.status,s)),(o.writeDefaults===!0||i.data!=null&&i.data.byteLength>0)&&(s.uint32(18),s.bytes(i.data)),o.lengthDelimited!==!1&&s.ldelim()},(i,s)=>{let o={status:e.OK,data:new Uint8Array(0)},a=s==null?i.len:i.pos+s;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:o.status=r.StatusCode.codec().decode(i);break;case 2:o.data=i.bytes();break;default:i.skipType(c&7);break}}return o})),n),r.encode=i=>rt(i,r.codec()),r.decode=i=>tt(i,r.codec())})(to||(to={}));var $Q="0.0.1",qQ="fetch";var GQ=C(en(),1),jQ=C(Tn(),1);var _s=D("libp2p:fetch"),X6=class{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${qQ}/${$Q}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,e=>{this.handleMessage(e).catch(t=>{_s.error(t)}).finally(()=>{e.stream.close()})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,n={}){var c;_s("dialing %s to %p",this.protocol,e);let i=await this.components.connectionManager.openConnection(e,n),s,o=n.signal,a;if(o==null){_s("using default timeout of %d ms",this.init.timeout),s=new GQ.TimeoutController(this.init.timeout),o=s.signal;try{(c=jQ.setMaxListeners)==null||c(1/0,s.signal)}catch{}}try{a=await i.newStream(this.protocol,{signal:o});let u=Mn(a,o);return _s("fetch %s",t),await _e([x2.encode({identifier:t})],vr(),u,cr(),async function(f){let h=await Tr(f);if(h==null)throw(0,O0.default)(new Error("No data received"),$.ERR_INVALID_MESSAGE);let d=to.decode(h);switch(d.status){case to.StatusCode.OK:return _s("received status for %s ok",t),d.data;case to.StatusCode.NOT_FOUND:return _s("received status for %s not found",t),null;case to.StatusCode.ERROR:{_s("received status for %s error",t);let m=j(d.data);throw(0,O0.default)(new Error("Error in fetch protocol response: "+m),$.ERR_INVALID_PARAMETERS)}default:throw _s("received status for %s unknown",t),(0,O0.default)(new Error("Unknown response status"),$.ERR_INVALID_MESSAGE)}})??null}finally{s!=null&&s.clear(),a!=null&&a.close()}}async handleMessage(e){let{stream:t}=e,n=this;await _e(t,cr(),async function*(i){let s=await Tr(i);if(s==null)throw(0,O0.default)(new Error("No data received"),$.ERR_INVALID_MESSAGE);let o=x2.decode(s),a,c=n._getLookupFunction(o.identifier);if(c!=null){_s("look up data with identifier %s",o.identifier);let u=await c(o.identifier);u!=null?(_s("sending status for %s ok",o.identifier),a={status:to.StatusCode.OK,data:u}):(_s("sending status for %s not found",o.identifier),a={status:to.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{_s("sending status for %s error",o.identifier);let u=W(`No lookup function registered for key: ${o.identifier}`);a={status:to.StatusCode.ERROR,data:u}}yield to.encode(a)},vr(),t)}_getLookupFunction(e){for(let t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw(0,O0.default)(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),$.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){t!=null&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}};var XQ=C(Y(),1);var WQ="1.0.0",YQ="ping";var ZQ=C(en(),1),JQ=C(Tn(),1),QQ=D("libp2p:ping"),Z6=class{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/${YQ}/${WQ}`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){let{stream:t}=e;_e(t,t).catch(n=>{QQ.error(n)})}async ping(e,t={}){var u;QQ("dialing %s to %p",this.protocol,e);let n=Date.now(),i=ri(32),s=await this.components.connectionManager.openConnection(e,t),o,a=t.signal,c;if(a==null){o=new ZQ.TimeoutController(this.init.timeout),a=o.signal;try{(u=JQ.setMaxListeners)==null||u(1/0,o.signal)}catch{}}try{c=await s.newStream([this.protocol],{signal:a});let l=Mn(c,a),f=await _e([i],l,async d=>await Tr(d)),h=Date.now();if(f==null||!ke(i,f.subarray()))throw(0,XQ.default)(new Error("Received wrong ping ack"),$.ERR_WRONG_PING_ACK);return h-n}finally{o!=null&&o.clear(),c!=null&&c.close()}}};async function eX(){throw new Error("Not supported in browsers")}var tX=C(g7(),1),Xx=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,J6=(0,tX.default)(),Wf=Xx&&!J6,rX=J6&&!Xx,nX=J6&&Xx,iX=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!J6,e8=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,ygt=typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"]==="test",sX=typeof navigator<"u"&&navigator.product==="ReactNative";var cX=C(Y(),1);function oX(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function aX(r){let{address:e}=r.nodeAddress();return oX(e)}var Zx=D("libp2p:nat"),Jx=7200;function R6e(r=1024,e=65535){return Math.floor(Math.random()*(e-r+1)+r)}var t8=class{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`${MQ}@${Q6} ${this.components.peerId.toString()}`,this.ttl=t.ttl??Jx,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<Jx)throw(0,cX.default)(new Error(`NatManager ttl should be at least ${Jx} seconds`),$.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){Wf||!this.enabled||this.started||(this.started=!0,this._start().catch(e=>{Zx.error(e)}))}async _start(){let e=this.components.transportManager.getAddrs();for(let t of e){let{family:n,host:i,port:s,transport:o}=t.toOptions();if(!t.isThinWaistAddress()||o!=="tcp"||aX(t)||n!==4)continue;let a=await this._getClient(),c=this.externalAddress??await a.externalIp(),u=Mf(c);if(u===!0)throw new Error(`${c} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);if(u==null)throw new Error(`${c} is not an IP address`);let l=R6e();Zx(`opening uPnP connection from ${c}:${l} to ${i}:${s}`),await a.map({publicPort:l,localPort:s,localAddress:this.localAddress,protocol:o.toUpperCase()==="TCP"?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(ZP({family:4,address:c,port:l},o))}}async _getClient(){return this.client!=null?this.client:(this.client=await eX({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway}),this.client)}async stop(){if(!(Wf||this.client==null))try{await this.client.close(),this.client=void 0}catch(e){Zx.error(e)}}};var C6e=D("libp2p:peer-record-updater"),r8=class{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then(async()=>{let e=new qr({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(n=>n.decapsulateCode(Nt("p2p").code))}),t=await Mr.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)}).catch(e=>{C6e.error("Could not update self peer record: %o",e)})}};var uX=C(Y(),1);var n8=class{constructor(e){this.dht=e}async findPeer(e,t={}){for await(let n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw(0,uX.default)(new Error(ct.NOT_FOUND),$.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(let n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}};var s8=C(Y(),1);var Je={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"};async function*eT(r,e){for await(let t of r)await e(t),yield t}var jt=D("libp2p:peer-store:address-book"),i8="change:multiaddrs";async function P6e(){return!0}var o8=class{constructor(e,t,n){this.dispatchEvent=e,this.store=t,this.addressFilter=n??P6e}async consumePeerRecord(e){jt.trace("consumePeerRecord await write lock");let t=await this.store.lock.writeLock();jt.trace("consumePeerRecord got write lock");let n,i,s;try{let o;try{o=qr.createFromProtobuf(e.payload)}catch{return jt.error("invalid peer record received"),!1}n=o.peerId;let a=o.multiaddrs;if(!n.equals(e.peerId))return jt("signing key does not match PeerId in the PeerRecord"),!1;if(a==null||a.length===0)return!1;if(await this.store.has(n)&&(i=await this.store.load(n),i.peerRecordEnvelope!=null)){let u=await Mr.createFromProtobuf(i.peerRecordEnvelope),l=qr.createFromProtobuf(u.payload);if(l.seqNumber>=o.seqNumber)return jt("sequence number was lower or equal to existing sequence number - stored: %d received: %d",l.seqNumber,o.seqNumber),!1}let c=await tT(n,a,this.addressFilter,!0);s=await this.store.patchOrCreate(n,{addresses:c,peerRecordEnvelope:e.marshal().subarray()}),jt("stored provided peer record for %p",o.peerId)}finally{jt.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new ie(i8,{detail:{peerId:n,multiaddrs:s.addresses.map(({multiaddr:o})=>o),oldMultiaddrs:i==null?[]:i.addresses.map(({multiaddr:o})=>o)}})),!0}async getRawEnvelope(e){jt.trace("getRawEnvelope await read lock");let t=await this.store.lock.readLock();jt.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(n){if(n.code!==Je.ERR_NOT_FOUND)throw n}finally{jt.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){let t=await this.getRawEnvelope(e);if(t!=null)return await Mr.createFromProtobuf(t)}async get(e){e=Lr(e),jt.trace("get wait for read lock");let t=await this.store.lock.readLock();jt.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(n){if(n.code!==Je.ERR_NOT_FOUND)throw n}finally{jt.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Lr(e),!Array.isArray(t))throw jt.error("multiaddrs must be an array of Multiaddrs"),(0,s8.default)(new Error("multiaddrs must be an array of Multiaddrs"),Je.ERR_INVALID_PARAMETERS);jt.trace("set await write lock");let n=await this.store.lock.writeLock();jt.trace("set got write lock");let i=!1,s,o;try{let a=await tT(e,t,this.addressFilter);if(a.length===0)return;try{if(s=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...s.addresses.map(({multiaddr:c})=>c.toString())]).size===s.addresses.length&&a.length===s.addresses.length)return}catch(c){if(c.code!==Je.ERR_NOT_FOUND)throw c}o=await this.store.patchOrCreate(e,{addresses:a}),jt("set multiaddrs for %p",e)}finally{jt.trace("set multiaddrs for %p",e),jt("set release write lock"),n()}this.dispatchEvent(new ie(i8,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:s==null?[]:s.addresses.map(({multiaddr:a})=>a)}})),i||this.dispatchEvent(new ie("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async add(e,t){if(e=Lr(e),!Array.isArray(t))throw jt.error("multiaddrs must be an array of Multiaddrs"),(0,s8.default)(new Error("multiaddrs must be an array of Multiaddrs"),Je.ERR_INVALID_PARAMETERS);jt.trace("add await write lock");let n=await this.store.lock.writeLock();jt.trace("add got write lock");let i,s,o;try{let a=await tT(e,t,this.addressFilter);if(a.length===0)return;try{if(s=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...s.addresses.map(({multiaddr:c})=>c.toString())]).size===s.addresses.length)return}catch(c){if(c.code!==Je.ERR_NOT_FOUND)throw c}o=await this.store.mergeOrCreate(e,{addresses:a}),jt("added multiaddrs for %p",e)}finally{jt.trace("set release write lock"),n()}this.dispatchEvent(new ie(i8,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:s==null?[]:s.addresses.map(({multiaddr:a})=>a)}})),i===!0&&this.dispatchEvent(new ie("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async delete(e){e=Lr(e),jt.trace("delete await write lock");let t=await this.store.lock.writeLock();jt.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{addresses:[]})}finally{jt.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ie(i8,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:n==null?[]:n.addresses.map(({multiaddr:i})=>i)}}))}};async function tT(r,e,t,n=!1){return await _e(e,i=>eT(i,s=>{if(!Pn(s))throw jt.error("multiaddr must be an instance of Multiaddr"),(0,s8.default)(new Error("multiaddr must be an instance of Multiaddr"),Je.ERR_INVALID_PARAMETERS)}),i=>ot(i,async s=>await t(r,s)),i=>Bt(i,s=>({multiaddr:s,isCertified:n})),async i=>await rn(i))}var fX=C(Y(),1);var ta=D("libp2p:peer-store:key-book"),lX="change:pubkey",a8=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=Lr(e),!(t instanceof Uint8Array))throw ta.error("publicKey must be an instance of Uint8Array to store data"),(0,fX.default)(new Error("publicKey must be an instance of PublicKey"),Je.ERR_INVALID_PARAMETERS);ta.trace("set await write lock");let n=await this.store.lock.writeLock();ta.trace("set got write lock");let i=!1,s;try{try{if(s=await this.store.load(e),s.pubKey!=null&&ke(s.pubKey,t))return}catch(o){if(o.code!==Je.ERR_NOT_FOUND)throw o}await this.store.patchOrCreate(e,{pubKey:t}),i=!0}finally{ta.trace("set release write lock"),n()}i&&this.dispatchEvent(new ie(lX,{detail:{peerId:e,publicKey:t,oldPublicKey:s==null?void 0:s.pubKey}}))}async get(e){e=Lr(e),ta.trace("get await write lock");let t=await this.store.lock.readLock();ta.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(n){if(n.code!==Je.ERR_NOT_FOUND)throw n}finally{ta("get release write lock"),t()}}async delete(e){e=Lr(e),ta.trace("delete await write lock");let t=await this.store.lock.writeLock();ta.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}finally{ta.trace("delete release write lock"),t()}this.dispatchEvent(new ie(lX,{detail:{peerId:e,publicKey:void 0,oldPublicKey:n==null?void 0:n.pubKey}}))}};var rT=C(Y(),1);var Qr=D("libp2p:peer-store:metadata-book"),c8="change:metadata",u8=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=Lr(e),Qr.trace("get await read lock");let t=await this.store.lock.readLock();Qr.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(n){if(n.code!==Je.ERR_NOT_FOUND)throw n}finally{Qr.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=Lr(e),Qr.trace("getValue await read lock");let n=await this.store.lock.readLock();Qr.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}finally{Qr.trace("getValue release write lock"),n()}}async set(e,t){if(e=Lr(e),!(t instanceof Map))throw Qr.error("valid metadata must be provided to store data"),(0,rT.default)(new Error("valid metadata must be provided"),Je.ERR_INVALID_PARAMETERS);Qr.trace("set await write lock");let n=await this.store.lock.writeLock();Qr.trace("set got write lock");let i;try{try{i=await this.store.load(e)}catch(s){if(s.code!==Je.ERR_NOT_FOUND)throw s}await this.store.mergeOrCreate(e,{metadata:t})}finally{Qr.trace("set release write lock"),n()}this.dispatchEvent(new ie(c8,{detail:{peerId:e,metadata:t,oldMetadata:i==null?new Map:i.metadata}}))}async setValue(e,t,n){if(e=Lr(e),typeof t!="string"||!(n instanceof Uint8Array))throw Qr.error("valid key and value must be provided to store data"),(0,rT.default)(new Error("valid key and value must be provided"),Je.ERR_INVALID_PARAMETERS);Qr.trace("setValue await write lock");let i=await this.store.lock.writeLock();Qr.trace("setValue got write lock");let s,o;try{try{s=await this.store.load(e);let a=s.metadata.get(t);if(a!=null&&ke(n,a))return}catch(a){if(a.code!==Je.ERR_NOT_FOUND)throw a}o=await this.store.mergeOrCreate(e,{metadata:new Map([[t,n]])})}finally{Qr.trace("setValue release write lock"),i()}this.dispatchEvent(new ie(c8,{detail:{peerId:e,metadata:o.metadata,oldMetadata:s==null?new Map:s.metadata}}))}async delete(e){e=Lr(e),Qr.trace("delete await write lock");let t=await this.store.lock.writeLock();Qr.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}n!=null&&await this.store.patch(e,{metadata:new Map})}finally{Qr.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ie(c8,{detail:{peerId:e,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(e,t){e=Lr(e),Qr.trace("deleteValue await write lock");let n=await this.store.lock.writeLock();Qr.trace("deleteValue got write lock");let i,s;try{s=await this.store.load(e),i=s.metadata,i.delete(t),await this.store.patch(e,{metadata:i})}catch(o){if(o.code!==Je.ERR_NOT_FOUND)throw o}finally{Qr.trace("deleteValue release write lock"),n()}i!=null&&this.dispatchEvent(new ie(c8,{detail:{peerId:e,metadata:i,oldMetadata:s==null?new Map:s.metadata}}))}};var f8=C(Y(),1);var Xr=D("libp2p:peer-store:proto-book"),l8="change:protocols",d8=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){Xr.trace("get wait for read lock");let t=await this.store.lock.readLock();Xr.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(n){if(n.code!==Je.ERR_NOT_FOUND)throw n}finally{Xr.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Lr(e),!Array.isArray(t))throw Xr.error("protocols must be provided to store data"),(0,f8.default)(new Error("protocols must be provided"),Je.ERR_INVALID_PARAMETERS);Xr.trace("set await write lock");let n=await this.store.lock.writeLock();Xr.trace("set got write lock");let i,s;try{try{if(i=await this.store.load(e),new Set([...t]).size===i.protocols.length)return}catch(o){if(o.code!==Je.ERR_NOT_FOUND)throw o}s=await this.store.patchOrCreate(e,{protocols:t}),Xr("stored provided protocols for %p",e)}finally{Xr.trace("set release write lock"),n()}this.dispatchEvent(new ie(l8,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async add(e,t){if(e=Lr(e),!Array.isArray(t))throw Xr.error("protocols must be provided to store data"),(0,f8.default)(new Error("protocols must be provided"),Je.ERR_INVALID_PARAMETERS);Xr.trace("add await write lock");let n=await this.store.lock.writeLock();Xr.trace("add got write lock");let i,s;try{try{if(i=await this.store.load(e),new Set([...i.protocols,...t]).size===i.protocols.length)return}catch(o){if(o.code!==Je.ERR_NOT_FOUND)throw o}s=await this.store.mergeOrCreate(e,{protocols:t}),Xr("added provided protocols for %p",e)}finally{Xr.trace("add release write lock"),n()}this.dispatchEvent(new ie(l8,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async remove(e,t){if(e=Lr(e),!Array.isArray(t))throw Xr.error("protocols must be provided to store data"),(0,f8.default)(new Error("protocols must be provided"),Je.ERR_INVALID_PARAMETERS);Xr.trace("remove await write lock");let n=await this.store.lock.writeLock();Xr.trace("remove got write lock");let i,s;try{try{i=await this.store.load(e);let o=new Set(i.protocols);for(let a of t)o.delete(a);if(i.protocols.length===o.size)return;t=Array.from(o)}catch(o){if(o.code!==Je.ERR_NOT_FOUND)throw o}s=await this.store.patchOrCreate(e,{protocols:t})}finally{Xr.trace("remove release write lock"),n()}this.dispatchEvent(new ie(l8,{detail:{peerId:e,protocols:s.protocols,oldProtocols:i==null?[]:i.protocols}}))}async delete(e){e=Lr(e),Xr.trace("delete await write lock");let t=await this.store.lock.writeLock();Xr.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{protocols:[]})}finally{Xr.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ie(l8,{detail:{peerId:e,protocols:[],oldProtocols:n.protocols}}))}};var nT=C(Y(),1);var T2;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(let s of t.addresses)n.uint32(10),h8.codec().encode(s,n,{writeDefaults:!0});if(t.protocols!=null)for(let s of t.protocols)n.uint32(18),n.string(s);if(t.metadata!=null)for(let s of t.metadata)n.uint32(26),p8.codec().encode(s,n,{writeDefaults:!0});t.pubKey!=null&&(n.uint32(34),n.bytes(t.pubKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={addresses:[],protocols:[],metadata:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.addresses.push(h8.codec().decode(t,t.uint32()));break;case 2:i.protocols.push(t.string());break;case 3:i.metadata.push(p8.codec().decode(t,t.uint32()));break;case 4:i.pubKey=t.bytes();break;case 5:i.peerRecordEnvelope=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(T2||(T2={}));var h8;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.multiaddr!=null&&t.multiaddr.byteLength>0)&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={multiaddr:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.multiaddr=t.bytes();break;case 2:i.isCertified=t.bool();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(h8||(h8={}));var p8;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.key!=="")&&(n.uint32(10),n.string(t.key)),(i.writeDefaults===!0||t.value!=null&&t.value.byteLength>0)&&(n.uint32(18),n.bytes(t.value)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:"",value:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(p8||(p8={}));var dX=D("libp2p:peer-store:store"),hX="/peers/",m8=class{constructor(e){this.components=e,this.lock=Yl({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(e.type==null)throw dX.error("peerId must be an instance of peer-id to store data"),(0,nT.default)(new Error("peerId must be an instance of peer-id"),Je.ERR_INVALID_PARAMETERS);let t=e.toCID().toString();return new le(`${hX}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){let t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),n=T2.decode(t),i=new Map;for(let s of n.metadata)i.set(s.key,s.value);return{...n,id:e,addresses:n.addresses.map(({multiaddr:s,isCertified:o})=>({multiaddr:oe(s),isCertified:o??!1})),metadata:i,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(e){if(e.pubKey!=null&&e.id.publicKey!=null&&!ke(e.pubKey,e.id.publicKey))throw dX.error("peer publicKey bytes do not match peer id publicKey bytes"),(0,nT.default)(new Error("publicKey bytes do not match peer id publicKey bytes"),Je.ERR_INVALID_PARAMETERS);let t=new Set,n=e.addresses.filter(o=>t.has(o.multiaddr.toString())?!1:(t.add(o.multiaddr.toString()),!0)).sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({multiaddr:o,isCertified:a})=>({multiaddr:o.bytes,isCertified:a})),i=[];[...e.metadata.keys()].sort().forEach(o=>{let a=e.metadata.get(o);a!=null&&i.push({key:o,value:a})});let s=T2.encode({addresses:n,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:i,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),s.subarray()),await this.load(e.id)}async patch(e,t){let n=await this.load(e);return await this._patch(e,t,n)}async patchOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,n)}async _patch(e,t,n){return await this.save({...n,...t,id:e})}async merge(e,t){let n=await this.load(e);return await this._merge(e,t,n)}async mergeOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==Je.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,n)}async _merge(e,t,n){var s,o;let i=new Map;return n.addresses.forEach(a=>{i.set(a.multiaddr.toString(),a.isCertified)}),(t.addresses??[]).forEach(a=>{let c=a.multiaddr.toString(),l=Boolean(i.get(c))||a.isCertified;i.set(c,l)}),await this.save({id:e,addresses:Array.from(i.entries()).map(([a,c])=>({multiaddr:oe(a),isCertified:c})),protocols:Array.from(new Set([...n.protocols??[],...t.protocols??[]])),metadata:new Map([...((s=n.metadata)==null?void 0:s.entries())??[],...((o=t.metadata)==null?void 0:o.entries())??[]]),pubKey:t.pubKey??(n!=null?n.pubKey:void 0),peerRecordEnvelope:t.peerRecordEnvelope??(n!=null?n.peerRecordEnvelope:void 0)})}async*all(){for await(let e of this.components.datastore.queryKeys({prefix:hX})){let t=e.toString().split("/")[2],n=ut.decode(t);yield this.load(wr(n))}}};var iT=C(Y(),1);var fc;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.tags!=null)for(let s of t.tags)n.uint32(10),g8.codec().encode(s,n,{writeDefaults:!0});i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={tags:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.tags.push(g8.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(fc||(fc={}));var g8;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.name!=="")&&(n.uint32(10),n.string(t.name)),t.value!=null&&(n.uint32(16),n.uint32(t.value)),t.expiry!=null&&(n.uint32(24),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={name:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.name=t.string();break;case 2:i.value=t.uint32();break;case 3:i.expiry=t.uint64();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(g8||(g8={}));var Es=D("libp2p:peer-store"),y8=class extends Ue{constructor(e,t={}){super(),this.components=e,this.store=new m8(e),this.addressBook=new o8(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new a8(this.dispatchEvent.bind(this),this.store),this.metadataBook=new u8(this.dispatchEvent.bind(this),this.store),this.protoBook=new d8(this.dispatchEvent.bind(this),this.store)}async forEach(e){Es.trace("getPeers await read lock");let t=await this.store.lock.readLock();Es.trace("getPeers got read lock");try{for await(let n of this.store.all())n.id.equals(this.components.peerId)||e(n)}finally{Es.trace("getPeers release read lock"),t()}}async all(){let e=[];return await this.forEach(t=>{e.push(t)}),e}async delete(e){Es.trace("delete await write lock");let t=await this.store.lock.writeLock();Es.trace("delete got write lock");try{await this.store.delete(e)}finally{Es.trace("delete release write lock"),t()}}async get(e){Es.trace("get await read lock");let t=await this.store.lock.readLock();Es.trace("get got read lock");try{return await this.store.load(e)}finally{Es.trace("get release read lock"),t()}}async has(e){Es.trace("has await read lock");let t=await this.store.lock.readLock();Es.trace("has got read lock");try{return await this.store.has(e)}finally{Es.trace("has release read lock"),t()}}async tagPeer(e,t,n={}){let i=n.value??0,s=Math.round(i),o=n.ttl??void 0;if(s!==i||s<0||s>100)throw(0,iT.default)(new Error("Tag value must be between 0-100"),"ERR_TAG_VALUE_OUT_OF_BOUNDS");let a=await this.metadataBook.getValue(e,"tags"),c=[];a!=null&&(c=fc.decode(a).tags);for(let u of c)if(u.name===t)throw(0,iT.default)(new Error("Peer already tagged"),"ERR_DUPLICATE_TAG");c.push({name:t,value:s,expiry:o==null?void 0:BigInt(Date.now()+o)}),await this.metadataBook.setValue(e,"tags",fc.encode({tags:c}).subarray())}async unTagPeer(e,t){let n=await this.metadataBook.getValue(e,"tags"),i=[];n!=null&&(i=fc.decode(n).tags),i=i.filter(s=>s.name!==t),await this.metadataBook.setValue(e,"tags",fc.encode({tags:i}).subarray())}async getTags(e){let t=await this.metadataBook.getValue(e,"tags"),n=[];t!=null&&(n=fc.decode(t).tags);let i=BigInt(Date.now()),s=n.filter(o=>o.expiry==null||o.expiry>i);return s.length!==n.length&&await this.metadataBook.setValue(e,"tags",fc.encode({tags:s}).subarray()),s.map(o=>({name:o.name,value:o.value??0}))}};var pX=C(Y(),1),w8=class{constructor(e){this.dht=e}async provide(e){await Rt(this.dht.provide(e))}async*findProviders(e,t={}){for await(let n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Rt(this.dht.put(e,t,n))}async get(e,t){for await(let n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw(0,pX.default)(new Error("Not found"),"ERR_NOT_FOUND")}};var zi=C(Y(),1);var b8=class{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{await e.start()})),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{await e.stop()})),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>rc(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}get peerId(){if(this._peerId==null)throw(0,zi.default)(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(this._addressManager==null)throw(0,zi.default)(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(this._peerStore==null)throw(0,zi.default)(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(this._upgrader==null)throw(0,zi.default)(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(this._registrar==null)throw(0,zi.default)(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(this._connectionManager==null)throw(0,zi.default)(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(this._transportManager==null)throw(0,zi.default)(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(this._connectionGater==null)throw(0,zi.default)(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(this._contentRouting==null)throw(0,zi.default)(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(this._peerRouting==null)throw(0,zi.default)(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(this._datastore==null)throw(0,zi.default)(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(this._dialer==null)throw(0,zi.default)(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}};var oT=C(Gi(),1),aT=C(bX(),1);var _X=globalThis.fetch,EX=globalThis.Headers,K3t=globalThis.Request,H3t=globalThis.Response;function E8(r,e,t){return`${r}?name=${e}&type=${t}`}async function vX(r,e){return await(await _X(r,{headers:new EX({accept:"application/dns-json"}),signal:e})).json()}function Qf(r,e){return`${e}_${r}`}var sT=Object.assign((0,oT.default)("dns-over-http-resolver"),{error:(0,oT.default)("dns-over-http-resolver:error")}),cT=class{constructor(e={}){this._cache=new aT.default({max:(e==null?void 0:e.maxCache)??100}),this._TXTcache=new aT.default({max:(e==null?void 0:e.maxCache)??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??vX,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>e.abort())}getServers(){return this._servers}_getShuffledServers(){let e=[...this._servers];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t),i=e[t];e[t]=e[n],e[n]=i}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){let t="A",n=this._cache.get(Qf(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(E8(s,e,t),o.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(Qf(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),sT.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){let t="AAAA",n=this._cache.get(Qf(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(E8(s,e,t),o.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(Qf(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),sT.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){let t="TXT",n=this._TXTcache.get(Qf(e,t));if(n!=null)return n;let i=!1;for(let s of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(E8(s,e,t),o.signal),c=a.Answer.map(l=>[l.data.replace(/['"]+/g,"")]),u=Math.min(...a.Answer.map(l=>l.TTL));return this._TXTcache.set(Qf(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(i=!0),sT.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}},SX=cT;var xX=SX;var{code:V6e}=Nt("dnsaddr");async function TX(r,e={}){let t=new xX;e.signal!=null&&e.signal.addEventListener("abort",()=>{t.cancel()});let n=r.getPeerId(),[,i]=r.stringTuples().find(([a])=>a===V6e)??[];if(i==null)throw new Error("No hostname found in multiaddr");let o=(await t.resolveTxt(`_dnsaddr.${i}`)).flat().map(a=>a.split("=")[1]);return n!=null&&(o=o.filter(a=>a.includes(n))),o}var v8=C(Y(),1);var q6e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:100,maxDialsPerPeer:4,dialTimeout:3e4,inboundUpgradeTimeout:3e4,resolvers:{dnsaddr:TX},addressSorter:I0},connectionGater:{},transportManager:{faultTolerance:$u.FATAL_ALL},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:9e5,enabled:!1,ttl:18e5},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:Qx},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function AX(r){var t,n;let e=Ve(q6e,r);if(e.transports==null||e.transports.length<1)throw(0,v8.default)(new Error(ct.ERR_TRANSPORTS_REQUIRED),$.ERR_TRANSPORTS_REQUIRED);if(e.connectionEncryption==null||e.connectionEncryption.length===0)throw(0,v8.default)(new Error(ct.CONN_ENCRYPTION_REQUIRED),$.CONN_ENCRYPTION_REQUIRED);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw(0,v8.default)(new Error(ct.ERR_PROTECTOR_REQUIRED),$.ERR_PROTECTOR_REQUIRED);return e.identify.host.agentVersion===Qx&&(iX||rX?e.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(Wf||e8||nX||sX)&&(e.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),e}var dT;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.id!=null&&t.id.byteLength>0)&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={id:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.id=t.bytes();break;case 2:i.pubKey=t.bytes();break;case 3:i.privKey=t.bytes();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(dT||(dT={}));var S8=async()=>{let r=await rh("Ed25519"),e=await RX(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};var IX=async r=>{let e=await rh("RSA",(r==null?void 0:r.bits)??2048),t=await RX(e);if(t.type==="RSA")return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function RX(r){return await br(u1(r.public),eE(r))}var I2=C(Y(),1);var vs=C(Y(),1);var x8=class extends Ue{get[Xo](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}get lan(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}get(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}findProviders(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}findPeer(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}getClosestPeers(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}provide(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}put(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}async getMode(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}async setMode(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}async refreshRoutingTable(){throw(0,vs.default)(new Error(ct.DHT_DISABLED),$.DHT_DISABLED)}};var dc=C(Y(),1);var T8=class extends Ue{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}get multicodecs(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}getPeers(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}getTopics(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}subscribe(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}unsubscribe(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}getSubscribers(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}async publish(){throw(0,dc.default)(new Error(ct.PUBSUB_DISABLED),$.ERR_PUBSUB_DISABLED)}};var U0=C(Y(),1);var $X=C(en(),1),pT=C(Kn(),1),qX=C(Tn(),1);var A2=C(Y(),1),zX=C(Kn(),1),KX=C(FX(),1),hT=C(Tn(),1);var VX=D("libp2p:dialer:dial-request"),A8=class{constructor(e){let{addrs:t,dialAction:n,dialer:i}=e;this.addrs=t,this.dialer=i,this.dialAction=n}async run(e={}){var a;let t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw(0,A2.default)(new Error("No dial tokens available"),$.ERR_NO_DIAL_TOKENS);let n=new KX.default;for(let c of t)n.push(c).catch(u=>{VX.error(u)});let i=this.addrs.map(()=>{var u;let c=new AbortController;try{(u=hT.setMaxListeners)==null||u(1/0,c.signal)}catch{}return c});if(e.signal!=null)try{(a=hT.setMaxListeners)==null||a(1/0,e.signal)}catch{}let s=0,o=!1;try{return await Promise.any(this.addrs.map(async(c,u)=>{let l=await n.shift();if(o)throw this.dialer.releaseToken(t.splice(t.indexOf(l),1)[0]),(0,A2.default)(new Error("dialAction already succeeded"),$.ERR_ALREADY_SUCCEEDED);let f=i[u];if(f==null)throw(0,A2.default)(new Error("dialAction did not come with an AbortController"),$.ERR_INVALID_PARAMETERS);let h;try{let d=f.signal;h=await this.dialAction(c,{...e,signal:e.signal!=null?(0,zX.anySignal)([d,e.signal]):d}),i[u]=void 0}finally{s++,this.addrs.length-s>=t.length?n.push(l).catch(d=>{VX.error(d)}):this.dialer.releaseToken(t.splice(t.indexOf(l),1)[0])}if(h==null)throw(0,A2.default)(new Error("dialAction led to empty object"),$.ERR_TRANSPORT_DIAL_FAILED);return o=!0,h}))}finally{i.forEach(c=>{c!==void 0&&c.abort()}),t.forEach(c=>this.dialer.releaseToken(c))}}};var ra=D("libp2p:dialer"),I8=class{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??I0,this.maxAddrsToDial=t.maxAddrsToDial??25,this.timeout=t.dialTimeout??3e4,this.maxDialsPerPeer=t.maxDialsPerPeer??4,this.tokens=[...new Array(t.maxParallelDials??100)].map((n,i)=>i),this.components=e,this.pendingDials=Vi({name:"libp2p_dialler_pending_dials",metrics:e.metrics}),this.pendingDialTargets=Vi({name:"libp2p_dialler_pending_dial_targets",metrics:e.metrics});for(let[n,i]of Object.entries(t.resolvers??{}))Ib.set(n,i)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(let e of this.pendingDials.values())try{e.controller.abort()}catch(t){ra.error(t)}this.pendingDials.clear();for(let e of this.pendingDialTargets.values())e.abort();this.pendingDialTargets.clear()}async dial(e,t={}){let{peerId:n,multiaddr:i}=I6(e);if(n!=null){if(this.components.peerId.equals(n))throw(0,U0.default)(new Error("Tried to dial self"),$.ERR_DIALED_SELF);if(i!=null&&(ra("storing multiaddrs %p",n,i),await this.components.peerStore.addressBook.add(n,[i])),await this.components.connectionGater.denyDialPeer(n))throw(0,U0.default)(new Error("The dial request is blocked by gater.allowDialPeer"),$.ERR_PEER_DIAL_INTERCEPTED)}ra("creating dial target for %p",n);let s=new AbortController,o=HX();this.pendingDialTargets.set(o,s);let a=s.signal;t.signal!=null&&(a=(0,pT.anySignal)([a,t.signal]));let c;try{c=await this._createDialTarget({peerId:n,multiaddr:i},{...t,signal:a})}finally{this.pendingDialTargets.delete(o)}if(c.addrs.length===0)throw(0,U0.default)(new Error("The dial request has no valid addresses"),$.ERR_NO_VALID_ADDRESSES);let u=this.pendingDials.get(c.id)??this._createPendingDial(c,t);try{let l=await u.promise;return ra("dial succeeded to %s",c.id),l}catch(l){throw ra("dial failed to %s",c.id,l),u.controller.signal.aborted&&(l.code=$.ERR_TIMEOUT),ra.error(l),l}finally{u.destroy()}}async _createDialTarget(e,t){let n=[];if(Pn(e.multiaddr)&&n.push(e.multiaddr),!Pn(e.multiaddr)&&$n(e.peerId)&&n.push(...await this._loadAddresses(e.peerId)),n=(await Promise.all(n.map(async s=>await this._resolve(s,t)))).flat().filter(s=>Boolean(this.components.transportManager.transportForMultiaddr(s))),n=[...new Set(n.map(s=>s.toString()))].map(s=>oe(s)),n.length>this.maxAddrsToDial)throw(0,U0.default)(new Error("dial with more addresses than allowed"),$.ERR_TOO_MANY_ADDRESSES);let i=$n(e.peerId)?e.peerId:void 0;if(i!=null){let s=`/p2p/${i.toString()}`;n=n.map(o=>{let a=o.getPeerId();return a==null||!i.equals(a)?o.encapsulate(s):o})}return{id:i==null?HX():i.toString(),addrs:n}}async _loadAddresses(e){let t=await this.components.peerStore.addressBook.get(e);return(await Promise.all(t.map(async n=>await this.components.connectionGater.denyDialMultiaddr(e,n.multiaddr)?!1:n))).filter(W6e).sort(this.addressSorter).map(n=>n.multiaddr)}_createPendingDial(e,t={}){var u;let n=async(l,f={})=>{var h;if(((h=f.signal)==null?void 0:h.aborted)===!0)throw(0,U0.default)(new Error("already aborted"),$.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(l,f).catch(d=>{throw ra.error("dial to %s failed",l,d),d})},i=new A8({addrs:e.addrs,dialAction:n,dialer:this}),s=new $X.TimeoutController(this.timeout),o=[s.signal];t.signal!=null&&o.push(t.signal);let a=(0,pT.anySignal)(o);try{(u=qX.setMaxListeners)==null||u(1/0,a)}catch{}let c={dialRequest:i,controller:s,promise:i.run({...t,signal:a}),destroy:()=>{s.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,c),c}getTokens(e){let t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,t);return ra("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),n}releaseToken(e){this.tokens.includes(e)||(ra("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];let i=await this._resolveRecord(e,t);return(await Promise.all(i.map(async a=>await this._resolve(a,t)))).flat().reduce((a,c)=>(a.find(u=>u.equals(c))==null&&a.push(c),a),[])}async _resolveRecord(e,t){try{return e=oe(e.toString()),await e.resolve(t)}catch(n){return ra.error(`multiaddr ${e.toString()} could not be resolved`,n),[]}}};function W6e(r){return Boolean(r)}function HX(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var hc=D("libp2p"),mT=class extends Ue{constructor(e){super(),this.started=!1,this.peerId=e.peerId;let t=this.components=new b8({peerId:e.peerId,datastore:e.datastore??new w1,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new y8(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics!=null&&(this.metrics=this.components.metrics=this.configureComponent(e.metrics(this.components))),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",o=>{let{detail:a}=o;this.dispatchEvent(new ie("peer:discovery",{detail:a}))}),e.connectionProtector!=null&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new Y6(this.components,{connectionEncryption:(e.connectionEncryption??[]).map(o=>this.configureComponent(o(this.components))),muxers:(e.streamMuxers??[]).map(o=>this.configureComponent(o(this.components))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new I8(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new P6(this.components,e.connectionManager),this.components.connectionManager.addEventListener("peer:disconnect",o=>{this.dispatchEvent(new ie("peer:disconnect",{detail:o.detail}))}),this.components.connectionManager.addEventListener("peer:connect",o=>{this.dispatchEvent(new ie("peer:connect",{detail:o.detail}))}),this.registrar=this.components.registrar=new W6(this.components),this.components.transportManager=new G6(this.components,e.transportManager),this.components.addressManager=new E6(this.components,e.addresses),this.configureComponent(new r8(this.components)),this.configureComponent(new k6(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));let n=zf.generateOptions();this.keychain=this.configureComponent(new zf(this.components,{...n,...e.keychain})),this.services.push(new t8(this.components,e.nat)),e.transports.forEach(o=>{this.components.transportManager.add(this.configureComponent(o(this.components)))}),this.identifyService=new N0(this.components,{...e.identify}),this.configureComponent(this.identifyService),e.dht!=null?this.dht=this.components.dht=e.dht(this.components):this.dht=new x8,e.pubsub!=null?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new T8;let i=(e.peerRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&(i.push(this.configureComponent(new n8(this.dht))),this.dht.addEventListener("peer",o=>{this.onDiscoveryPeer(o)})),this.peerRouting=this.components.peerRouting=this.configureComponent(new w6(this.components,{...e.peerRouting,routers:i}));let s=(e.contentRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&s.push(this.configureComponent(new w8(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new _6(this.components,{routers:s})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new N6(this.components,e.relay))),this.configureComponent(new F6(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new X6(this.components,{...e.fetch})),this.pingService=this.configureComponent(new Z6(this.components,{...e.ping}));for(let o of e.peerDiscovery??[])this.configureComponent(o(this.components)).addEventListener("peer",c=>{this.onDiscoveryPeer(c)})}configureComponent(e){return rc(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,hc("libp2p is starting");try{await Promise.all(this.services.map(async e=>{e.beforeStart!=null&&await e.beforeStart()})),await Promise.all(this.services.map(e=>e.start())),await Promise.all(this.services.map(async e=>{e.afterStart!=null&&await e.afterStart()})),hc("libp2p has started")}catch(e){throw hc.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(hc("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map(async e=>{e.beforeStop!=null&&await e.beforeStop()})),await Promise.all(this.services.map(e=>e.stop())),await Promise.all(this.services.map(async e=>{e.afterStop!=null&&await e.afterStop()})),hc("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){let e=new pi;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return await this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,n={}){if(t==null)throw(0,I2.default)(new Error("no protocols were provided to open a stream"),$.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],t.length===0)throw(0,I2.default)(new Error("no protocols were provided to open a stream"),$.ERR_INVALID_PROTOCOLS_FOR_STREAM);return await(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){Pn(e)&&(e=fe(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(hc("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;let n=await this.peerStore.get(e);if(n.pubKey!=null)return n.pubKey;if(this.dht==null)throw(0,I2.default)(new Error("Public key was not in the peer store and the DHT is not enabled"),$.ERR_NO_ROUTERS_AVAILABLE);let i=ve([W("/pk/"),e.multihash.digest]);for await(let s of this.dht.get(i,t))if(s.name==="VALUE"){let o=ii(s.value);return await this.peerStore.keyBook.set(e,s.value),o.bytes}throw(0,I2.default)(new Error(`Node not responding with its public key: ${e.toString()}`),$.ERR_INVALID_RECORD)}async fetch(e,t,n={}){if(Pn(e)){let i=fe(e.getPeerId()??"");await this.components.peerStore.addressBook.add(i,[e]),e=i}return await this.fetchService.fetch(e,t,n)}async ping(e,t={}){if(Pn(e)){let n=fe(e.getPeerId()??"");await this.components.peerStore.addressBook.add(n,[e]),e=n}return await this.pingService.ping(e,t)}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async i=>{await this.components.registrar.handle(i,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return await this.registrar.register(e,t)}unregister(e){this.registrar.unregister(e)}onDiscoveryPeer(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){hc.error(new Error($.ERR_DISCOVERED_SELF));return}t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch(n=>hc.error(n)),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch(n=>hc.error(n)),this.dispatchEvent(new ie("peer:discovery",{detail:t}))}};async function GX(r){if(r.peerId==null){let e=r.datastore;if(e!=null)try{let t=new zf({datastore:e},{...zf.generateOptions(),...r.keychain??{}});r.peerId=await t.exportPeerId("self")}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}}return r.peerId==null&&(r.peerId=await S8()),new mT(AX(r))}async function jX(r){let e=await GX(r);return r.start!==!1&&await e.start(),e}var mZ=C(eZ(),1);var tZ="/lan",rZ="/ipfs",nZ="/kad/1.0.0",iZ="/dht/record",_T="/dht/provider";var sZ=Number(3e5),oZ=Number(30*1e3),aZ=Number(5*6e4),cZ=Number(30*1e3),uZ=Number(30*1e3);var t8e=W("/pk/");function V0(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let i=Mf(n);return i==null?!0:!i})}}function z0(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(n==="localhost")return!0;if(t!==4&&t!==6||n==null)return!1;let i=Mf(n);return i??!1})}}async function ia(r){return(await Pe.digest(r)).digest}async function Ki(r){return await ia(r.toBytes())}function pc(r){return new le(`${iZ}/${j(r,"base32")}`,!1)}function lZ(r){return ve([t8e,r.toBytes()])}function fZ(r){return j(r.subarray(0,4))==="/pk/"}function dZ(r){return wr(r.subarray(4))}function ET(r,e){let t=new Date;return new _r(r,e,t).serialize()}function hZ(r,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>r(),e)}}var gZ=C(en(),1);var r8e="kad-close",n8e=50,pZ=20,i8e=1e4,s8e=10,P8=class{constructor(e,t){let{kBucketSize:n,pingTimeout:i,lan:s,pingConcurrency:o,protocol:a,tagName:c,tagValue:u}=t;this.components=e,this.log=D(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table`),this.kBucketSize=n??pZ,this.pingTimeout=i??i8e,this.pingConcurrency=o??s8e,this.lan=s,this.running=!1,this.protocol=a,this.tagName=c??r8e,this.tagValue=u??n8e;let l=()=>{var f,h;(f=this.metrics)==null||f.pingQueueSize.update(this.pingQueue.size),(h=this.metrics)==null||h.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new Ot({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});let e=new mZ.default({localNodeId:await Ki(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new pi,n=hZ(()=>{let i=new pi(e.closest(e.localNodeId,pZ).map(a=>a.peer)),s=i.difference(t),o=t.difference(i);Promise.resolve().then(async()=>{for(let a of s)await this.components.peerStore.tagPeer(a,this.tagName,{value:this.tagValue});for(let a of o)await this.components.peerStore.unTagPeer(a,this.tagName)}).catch(a=>{this.log.error("Could not update peer tags",a)}),t=i});e.on("added",()=>{n()}),e.on("removed",()=>{n()})}_onPing(e,t){this.pingQueue.add(async()=>{if(!this.running)return;let n=0;try{await Promise.all(e.map(async i=>{var o;let s;try{s=new gZ.TimeoutController(this.pingTimeout);let a={signal:s.signal};this.log("pinging old contact %p",i.peer),(await(await this.components.connectionManager.openConnection(i.peer,a)).newStream(this.protocol,a)).close(),n++}catch(a){this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",i.peer,a),this.log("evicting old contact after ping failed %p",i),this.kb.remove(i.id))}finally{s!=null&&s.clear(),(o=this.metrics)==null||o.routingTableSize.update(this.size)}})),this.running&&n<e.length&&this.kb!=null&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(i){this.log.error("could not process k-bucket ping event",i)}}).catch(n=>{this.log.error("could not process k-bucket ping event",n)})}get size(){return this.kb==null?0:this.kb.count()}async find(e){let t=await Ki(e),n=this.closestPeer(t);if(n!=null&&e.equals(n))return n}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:this.kb.closest(e,t).map(i=>i.peer)}async add(e){var n;if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Ki(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),(n=this.metrics)==null||n.routingTableSize.update(this.size)}async remove(e){var n;if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Ki(e);this.kb.remove(t),(n=this.metrics)==null||n.routingTableSize.update(this.size)}};var yZ=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];var wZ=C(en(),1);var k8=15,D8=class{constructor(e){let{peerRouting:t,routingTable:n,refreshInterval:i,refreshQueryTimeout:s,lan:o}=e;this.log=D(`libp2p:kad-dht:${o?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=i??aZ,this.refreshQueryTimeout=s??cZ,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){let o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);let s=new wZ.TimeoutController(this.refreshQueryTimeout);try{let o=await $s(this.peerRouting.getClosestPeers(i.toBytes(),{signal:s.signal}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{s.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>k8&&(e=k8);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");let t=ri(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return wr(i)}async _makePeerId(e,t,n){if(n>k8)throw new Error(`Cannot generate peer ID for common prefix length greater than ${k8}`);let o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,u=yZ[c],l=new ArrayBuffer(34),f=new DataView(l,0,l.byteLength);return f.setUint8(0,Pe.code),f.setUint8(1,32),f.setUint32(2,u,!1),new Uint8Array(f.buffer,f.byteOffset,f.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(let{id:e}of this.routingTable.kb.toIterable()){let t=tc(this.routingTable.kb.localNodeId,e),n=0;for(let i of t)if(i===0)n++;else break;yield n}}};var SZ=C(Y(),1);var bZ;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 3:i.author=t.bytes();break;case 4:i.signature=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(bZ||(bZ={}));var Zu;(function(r){let e;(function(a){a.PUT_VALUE="PUT_VALUE",a.GET_VALUE="GET_VALUE",a.ADD_PROVIDER="ADD_PROVIDER",a.GET_PROVIDERS="GET_PROVIDERS",a.FIND_NODE="FIND_NODE",a.PING="PING"})(e=r.MessageType||(r.MessageType={}));let t;(function(a){a[a.PUT_VALUE=0]="PUT_VALUE",a[a.GET_VALUE=1]="GET_VALUE",a[a.ADD_PROVIDER=2]="ADD_PROVIDER",a[a.GET_PROVIDERS=3]="GET_PROVIDERS",a[a.FIND_NODE=4]="FIND_NODE",a[a.PING=5]="PING"})(t||(t={})),function(a){a.codec=()=>Si(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(a){a.NOT_CONNECTED="NOT_CONNECTED",a.CONNECTED="CONNECTED",a.CAN_CONNECT="CAN_CONNECT",a.CANNOT_CONNECT="CANNOT_CONNECT"})(n=r.ConnectionType||(r.ConnectionType={}));let i;(function(a){a[a.NOT_CONNECTED=0]="NOT_CONNECTED",a[a.CONNECTED=1]="CONNECTED",a[a.CAN_CONNECT=2]="CAN_CONNECT",a[a.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(i||(i={})),function(a){a.codec=()=>Si(i)}(n=r.ConnectionType||(r.ConnectionType={}));let s;(function(a){let c;a.codec=()=>(c==null&&(c=nt((u,l,f={})=>{if(f.lengthDelimited!==!1&&l.fork(),u.id!=null&&(l.uint32(10),l.bytes(u.id)),u.addrs!=null)for(let h of u.addrs)l.uint32(18),l.bytes(h);else throw new Error('Protocol error: required field "addrs" was not found in object');u.connection!=null&&(l.uint32(24),r.ConnectionType.codec().encode(u.connection,l)),f.lengthDelimited!==!1&&l.ldelim()},(u,l)=>{let f={addrs:[]},h=l==null?u.len:u.pos+l;for(;u.pos<h;){let d=u.uint32();switch(d>>>3){case 1:f.id=u.bytes();break;case 2:f.addrs.push(u.bytes());break;case 3:f.connection=r.ConnectionType.codec().decode(u);break;default:u.skipType(d&7);break}}return f})),c),a.encode=u=>rt(u,a.codec()),a.decode=u=>tt(u,a.codec())})(s=r.Peer||(r.Peer={}));let o;r.codec=()=>(o==null&&(o=nt((a,c,u={})=>{if(u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.MessageType.codec().encode(a.type,c)),a.clusterLevelRaw!=null&&(c.uint32(80),c.int32(a.clusterLevelRaw)),a.key!=null&&(c.uint32(18),c.bytes(a.key)),a.record!=null&&(c.uint32(26),c.bytes(a.record)),a.closerPeers!=null)for(let l of a.closerPeers)c.uint32(66),r.Peer.codec().encode(l,c);else throw new Error('Protocol error: required field "closerPeers" was not found in object');if(a.providerPeers!=null)for(let l of a.providerPeers)c.uint32(74),r.Peer.codec().encode(l,c);else throw new Error('Protocol error: required field "providerPeers" was not found in object');u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={closerPeers:[],providerPeers:[]},l=c==null?a.len:a.pos+c;for(;a.pos<l;){let f=a.uint32();switch(f>>>3){case 1:u.type=r.MessageType.codec().decode(a);break;case 10:u.clusterLevelRaw=a.int32();break;case 2:u.key=a.bytes();break;case 3:u.record=a.bytes();break;case 8:u.closerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;case 9:u.providerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;default:a.skipType(f&7);break}}return u})),o),r.encode=a=>rt(a,r.codec()),r.decode=a=>tt(a,r.codec())})(Zu||(Zu={}));var Fr=Zu.MessageType,o8e=Zu.ConnectionType,vZ=Object.keys(Fr),gr=class{constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){let e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return Zu.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(_Z),providerPeers:this.providerPeers.map(_Z),record:this.record==null?void 0:this.record.serialize().subarray()})}static deserialize(e){var i;let t=Zu.decode(e),n=new gr(t.type??Zu.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(EZ),n.providerPeers=t.providerPeers.map(EZ),((i=t.record)==null?void 0:i.length)!=null&&(n.record=_r.deserialize(t.record)),n}};function _Z(r){return{id:r.id.toBytes(),addrs:(r.multiaddrs??[]).map(t=>t.bytes),connection:o8e.CONNECTED}}function EZ(r){if(r.id==null)throw new Error("Invalid peer in message");return{id:wr(r.id),multiaddrs:(r.addrs??[]).map(e=>oe(e)),protocols:[]}}function ST(r){return{...r,name:"SENDING_QUERY",type:0,messageName:r.type,messageType:vZ.indexOf(r.type.toString())}}function C2(r){return{...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer!=null?r.closer:[],providers:r.providers!=null?r.providers:[]}}function P2(r){return{...r,name:"FINAL_PEER",type:2}}function Zn(r){return{...r,name:"QUERY_ERROR",type:3}}function xT(r){return{...r,name:"PROVIDER",type:4}}function k2(r){return{...r,name:"VALUE",type:5}}function TT(r){return{...r,name:"DIALING_PEER",type:7}}var N8=class extends Ue{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=D(`libp2p:kad-dht:${i?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield TT({peer:e}),yield ST({to:e,type:t.type});let i;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),a=await this._writeReadMessage(o,t.serialize(),n);yield C2({from:e,messageType:a.type,closer:a.closerPeers,providers:a.providerPeers,record:a.record})}catch(s){yield Zn({from:e,error:s})}finally{i!=null&&i.close()}}async*sendMessage(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield TT({peer:e}),yield ST({to:e,type:t.type});let i;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);await this._writeMessage(o,t.serialize(),n),yield C2({from:e,messageType:t.type})}catch(s){yield Zn({from:e,error:s})}finally{i!=null&&i.close()}}async _writeMessage(e,t,n){n.signal!=null&&(e=Mn(e,n.signal)),await _e([t],vr(),e,Rt)}async _writeReadMessage(e,t,n){n.signal!=null&&(e=Mn(e,n.signal));let i=await _e([t],vr(),e,cr(),async o=>{let a=await Tr(o);if(a!=null)return a;throw(0,SZ.default)(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED")}),s=gr.deserialize(i);return s.closerPeers.forEach(o=>{this.dispatchEvent(new ie("peer",{detail:o}))}),s.providerPeers.forEach(o=>{this.dispatchEvent(new ie("peer",{detail:o}))}),s}};var L8=C(Y(),1);var K0=C(Y(),1);function H0(r,e){let t=e.key,i=j(t).split("/");if(i.length<3)return;let s=r[i[1].toString()];if(s==null){let o="Invalid record keytype";throw(0,K0.default)(new Error(o),"ERR_INVALID_RECORD_KEY_TYPE")}return s(t,e.value)}var a8e=async(r,e)=>{if(!(r instanceof Uint8Array))throw(0,K0.default)(new Error('"key" must be a Uint8Array'),"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(r.byteLength<5)throw(0,K0.default)(new Error("invalid public key record"),"ERR_INVALID_RECORD_KEY_TOO_SHORT");if(j(r.subarray(0,4))!=="/pk/")throw(0,K0.default)(new Error("key was not prefixed with /pk/"),"ERR_INVALID_RECORD_KEY_BAD_PREFIX");let n=r.slice(4),i=await Pe.digest(e);if(!ke(n,i.bytes))throw(0,K0.default)(new Error("public key does not match passed in key"),"ERR_INVALID_RECORD_HASH_MISMATCH")},xZ={pk:a8e};var O8=C(Y(),1);function TZ(r,e,t){if(t.length===0){let o="No records given";throw(0,O8.default)(new Error(o),"ERR_NO_RECORDS_RECEIVED")}let i=j(e).split("/");if(i.length<3){let o="Record key does not have a selector function";throw(0,O8.default)(new Error(o),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}let s=r[i[1].toString()];if(s==null){let o=`Unrecognized key prefix: ${i[1]}`;throw(0,O8.default)(new Error(o),"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:s(e,t)}function c8e(r,e){return 0}var AZ={pk:c8e};var B8=class{constructor(e,t){let{validators:n,selectors:i,peerRouting:s,queryManager:o,routingTable:a,network:c,lan:u}=t;this.components=e,this.log=D(`libp2p:kad-dht:${u?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.routingTable=a,this.network=c}async putLocal(e,t){let n=pc(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);let t=pc(e);this.log("fetching record for key %k",t);let n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let i=_r.deserialize(n);return await H0(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);let s=await ET(e,n);for(let{value:o,from:a}of t){if(ke(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{let l=pc(e);this.log(`Storing corrected record for key ${l.toString()}`),await this.components.datastore.put(l,s.subarray())}catch(l){this.log.error("Failed error correcting self",l)}continue}let c=!1,u=new gr(Fr.PUT_VALUE,e,0);u.record=_r.deserialize(s);for await(let l of this.network.sendRequest(a,u,i))l.name==="PEER_RESPONSE"&&l.record!=null&&ke(l.record.value,_r.deserialize(s).value)&&(c=!0),yield l;c||(yield Zn({from:a,error:(0,L8.default)(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);let i=await ET(e,t),s=pc(e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*_e(this.peerRouting.getClosestPeers(e,{signal:n.signal}),o=>Bt(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[],u=new gr(Fr.PUT_VALUE,e,0);u.record=_r.deserialize(i),this.log("send put to %p",a.peer.id);for await(let l of this.network.sendRequest(a.peer.id,u,n))c.push(l),l.name==="PEER_RESPONSE"&&(l.record!=null&&ke(l.record.value,_r.deserialize(i).value)||c.push(Zn({from:a.peer.id,error:(0,L8.default)(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})));return c}),o=>Ba(o,{ordered:!1,concurrency:3}),async function*(o){for await(let a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);let n=[];for await(let a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;let i=n.map(a=>a.value),s=0;try{s=TZ(this.selectors,e,i)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}let o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw(0,L8.default)(new Error("best value was not found"),"ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{let a=await this.getLocal(e);yield k2({value:a.value,from:this.components.peerId})}catch(a){this.log("error getting local value for %b",e,a)}let n=await ia(e),i=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",i.length);let s=this,o=async function*({peer:a,signal:c}){for await(let u of s.peerRouting.getValueOrPeers(a,e,{signal:c}))yield u,u.name==="PEER_RESPONSE"&&u.record!=null&&(yield k2({from:a,value:u.record.value}))};yield*this.queryManager.run(e,i,o,t)}};var M8=class{constructor(e,t){let{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,lan:c}=t;this.components=e,this.log=D(`libp2p:kad-dht:${c?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);let i=new gr(Fr.ADD_PROVIDER,e.multihash.bytes,0);i.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let s=0,o=a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[];this.log("putProvider %s to %p",e,a.peer.id);try{this.log("sending provider record for %s to %p",e,a.peer.id);for await(let u of this.network.sendMessage(a.peer.id,i,n))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,a.peer.id),s++),c.push(u)}catch(u){this.log.error("error sending provide record to peer %p",a.peer.id,u),c.push(Zn({from:a.peer.id,error:u}))}return c};yield*_e(this.peerRouting.getClosestPeers(e.multihash.bytes,n),a=>Bt(a,c=>o(c)),a=>Ba(a,{ordered:!1,concurrency:3}),async function*(a){for await(let c of a)yield*c}),this.log("sent provider records to %d peers",s)}async*findProviders(e,t){let n=this.routingTable.kBucketSize,i=e.multihash.bytes,s=await ia(i),o=this;this.log("findProviders %c",e);let a=await this.providers.getProviders(e);if(a.length>0){let l=[];for(let f of a.slice(0,n))l.push({id:f,multiaddrs:(await this.components.peerStore.addressBook.get(f)??[]).map(h=>h.multiaddr),protocols:[]});yield C2({from:this.components.peerId,messageType:Fr.GET_PROVIDERS,providers:l}),yield xT({from:this.components.peerId,providers:l})}if(a.length>=n)return;let c=async function*({peer:l,signal:f}){let h=new gr(Fr.GET_PROVIDERS,i,0);yield*o.network.sendRequest(l,h,{signal:f})},u=new Set(a.map(l=>l.toString()));for await(let l of this.queryManager.run(i,this.routingTable.closestPeers(s),c,t))if(yield l,l.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,e,l.closer.length);let f=[];for(let h of l.providers)u.has(h.id.toString())||(u.add(h.id.toString()),f.push(h));if(f.length>0&&(yield xT({from:l.from,providers:f})),u.size===n)return}}};var Zf=C(Y(),1);var U8=class{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(i=>i.peerId.equals(e))!=null)return;let t=await Ki(e),n={peerId:e,distance:tc(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((i,s)=>Bl(i.distance,s.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(e.length===0)return!1;if(this.length===0)return!0;let t=await Promise.all(e.map(Ki)),n=this.peerDistances[this.peerDistances.length-1].distance;for(let i of t){let s=tc(this.originDhtKey,i);if(Bl(s,n)<0)return!0}return!1}};var F8=class{constructor(e,t){let{routingTable:n,network:i,validators:s,queryManager:o,lan:a}=t;this.components=e,this.routingTable=n,this.network=i,this.validators=s,this.queryManager=o,this.log=D(`libp2p:kad-dht:${a?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t,n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}}if(t==null)try{t=await this.components.peerStore.get(e)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr),protocols:[]}}async*_getValueSingle(e,t,n={}){let i=new gr(Fr.GET_VALUE,t,0);yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){let n=lZ(e);for await(let i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){let s=await br(oy.marshalPublicKey({bytes:i.record.value}));if(!s.equals(e))throw(0,Zf.default)(new Error("public key does not match id"),"ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(s.publicKey==null)throw(0,Zf.default)(new Error("public key missing"),"ERR_PUBLIC_KEY_MISSING");yield k2({from:e,value:s.publicKey})}throw(0,Zf.default)(new Error(`Node not responding with its public key: ${e.toString()}`),"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);let n=await this.findPeerLocal(e);if(n!=null){this.log("found local"),yield P2({from:this.components.peerId,peer:n});return}let i=await Ki(e),s=this.routingTable.closestPeers(i);if(s.find(l=>l.equals(e))!=null)try{let l=await this.components.peerStore.get(e);this.log("found in peerStore"),yield P2({from:this.components.peerId,peer:{id:l.id,multiaddrs:l.addresses.map(f=>f.multiaddr),protocols:[]}});return}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}let a=this,c=async function*({peer:l,signal:f}){let h=new gr(Fr.FIND_NODE,e.toBytes(),0);for await(let d of a.network.sendRequest(l,h,{signal:f}))if(yield d,d.name==="PEER_RESPONSE"){let m=d.closer.find(w=>w.id.equals(e));m!=null&&(yield P2({from:d.from,peer:m}))}},u=!1;for await(let l of this.queryManager.run(e.toBytes(),s,c,t))l.name==="FINAL_PEER"&&(u=!0),yield l;u||(yield Zn({from:this.components.peerId,error:(0,Zf.default)(new Error("Not found"),"ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let n=await ia(e),i=this.routingTable.closestPeers(n),s=this,o=new U8(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>await o.add(c)));let a=async function*({peer:c,signal:u}){s.log("closerPeersSingle %s from %p",j(e,"base32"),c);let l=new gr(Fr.FIND_NODE,e,0);yield*s.network.sendRequest(c,l,{signal:u})};for await(let c of this.queryManager.run(e,i,a,t))yield c,c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async u=>await o.add(u.id)));this.log("found %d peers close to %b",o.length,e);for(let c of o.peers)yield P2({from:this.components.peerId,peer:{id:c,multiaddrs:(await this.components.peerStore.addressBook.get(c)??[]).map(u=>u.multiaddr),protocols:[]}})}async*getValueOrPeers(e,t,n={}){for await(let i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{let o="invalid record received, discarded";this.log(o),yield Zn({from:i.from,error:(0,Zf.default)(new Error(o),"ERR_INVALID_RECORD")});continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw(0,Zf.default)(new Error("invalid record received"),"ERR_INVALID_RECORD");await H0(this.validators,new _r(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let n=await ia(e),i=this.routingTable.closestPeers(n),s=[];for(let o of i)if(!o.equals(t))try{let a=await this.components.peerStore.addressBook.get(o),c=await this.components.peerStore.protoBook.get(o);s.push({id:o,multiaddrs:a.map(u=>u.multiaddr),protocols:c})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return s.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",s.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),s}};var IZ=C(Dp(),1),AT=C(po(),1);var mc=D("libp2p:kad-dht:providers"),V8=class{constructor(e,t={}){let{cacheSize:n,cleanupInterval:i,provideValidity:s}=t;this.components=e,this.cleanupInterval=i??36e5,this.provideValidity=s??864e5,this.cache=(0,IZ.default)(n??256),this.syncQueue=new Ot({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{mc.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){return await this.syncQueue.add(async()=>{let e=Date.now(),t=0,n=0,i=new Map,s=this.components.datastore.batch(),o=this.components.datastore.query({prefix:_T});for await(let a of o)try{let{cid:c,peerId:u}=RZ(a.key),l=CZ(a.value).getTime(),f=Date.now(),h=f-l,d=h>this.provideValidity;if(mc("comparing: %d - %d = %d > %d %s",f,l,h,this.provideValidity,d?"(expired)":""),d){n++,s.delete(a.key);let m=i.get(c)??new Set;m.add(u),i.set(c,m)}t++}catch(c){mc.error(c.message)}i.size>0?(mc("deleting %d / %d entries",n,t),await s.commit()):mc("nothing to delete");for(let[a,c]of i){let u=D2(a),l=this.cache.get(u);if(l!=null){for(let f of c)l.delete(f);l.size===0?this.cache.remove(u):this.cache.set(u,l)}}mc("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){let t=D2(e),n=this.cache.get(t);return n==null&&(n=await h8e(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){return await this.syncQueue.add(async()=>{mc("%p provides %s",t,e);let n=await this._getProvidersMap(e);mc("loaded %s provs",n.size);let i=new Date;n.set(t.toString(),i);let s=D2(e);this.cache.set(s,n),await d8e(this.components.datastore,e,t,i)})}async getProviders(e){return await this.syncQueue.add(async()=>(mc("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(n=>fe(n))))}};function D2(r){let e=typeof r=="string"?r:j(r.multihash.bytes,"base32");return`${_T}/${e}`}async function d8e(r,e,t,n){let i=[D2(e),"/",t.toString()].join(""),s=new le(i),o=Uint8Array.from(AT.default.encode(n.getTime()));return await r.put(s,o)}function RZ(r){let e=r.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:e[3],peerId:e[4]}}async function h8e(r,e){let t=new Map,n=r.query({prefix:D2(e)});for await(let i of n){let{peerId:s}=RZ(i.key);t.set(s,CZ(i.value))}return t}function CZ(r){return new Date(AT.default.decode(r))}var OZ=C(en(),1),LZ=C(Kn(),1);var PZ=C(Y(),1);var kZ=C(en(),1),DZ=C(Kn(),1);var p8e=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*NZ(r){let{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,cleanUp:u,queryFuncTimeout:l,log:f,peersSeen:h}=r,d=new Ot({concurrency:o}),m=await ia(e);function w(b,v){if(b==null)return;h.add(b);let T=BigInt("0x"+j(tc(v,m),"base16"));d.add(async()=>{let p,g=[i];l!=null&&(p=new kZ.TimeoutController(l),g.push(p.signal));let y=(0,DZ.anySignal)(g);try{for await(let E of s({key:e,peer:b,signal:y,pathIndex:a,numPaths:c})){if(y.aborted)return;if(E.name==="PEER_RESPONSE")for(let _ of E.closer){if(h.has(_.id)){f("already seen %p in query",_.id);continue}if(n.equals(_.id)){f("not querying ourselves");continue}let x=await Ki(_.id);if(BigInt("0x"+j(tc(x,m),"base16"))>T){f("skipping %p as they are not closer to %b than %p",_.id,e,b);continue}f("querying closer peer %p",_.id),w(_.id,x)}d.emit("completed",E)}p==null||p.clear()}catch(E){i.aborted?d.emit("error",E):d.emit("completed",Zn({from:b,error:E}))}finally{p==null||p.clear()}},{priority:p8e-T}).catch(p=>{f.error(p)})}w(t,await Ki(t)),yield*m8e(d,i,u,f)}async function*m8e(r,e,t,n){let i=vt(),s=!0,o=[],a=()=>{s&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,r.size,r.pending),s=!1,r.clear(),o.splice(0,o.length))};for(r.on("completed",c=>{o.push(c),i.resolve()}),r.on("error",c=>{n("queue error",c),a(),i.reject(c)}),r.on("idle",()=>{n("queue idle"),s=!1,i.resolve()}),e.addEventListener("abort",()=>{n("abort queue");let c=s;a(),c&&i.reject((0,PZ.default)(new Error("Query aborted"),"ERR_QUERY_ABORTED"))}),t.addEventListener("cleanup",()=>{a(),i.resolve()});s;)for(await i.promise,i=vt();o.length>0;){let c=o.shift();c!=null&&(yield c)}yield*o}var N2=C(Tn(),1);var K8=class{constructor(e,t){let{lan:n=!1,disjointPaths:i=20,alpha:s=3}=t;this.components=e,this.disjointPaths=i??20,this.controllers=new Set,this.running=!1,this.alpha=s??3,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&this.metrics==null&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1;for(let e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,n,i={}){var m,w,b;if(!this.running)throw new Error("QueryManager not started");let s=(m=this.metrics)==null?void 0:m.queryTime.timer(),o;if(i.signal==null){o=new OZ.TimeoutController(uZ),i.signal=o.signal;try{N2.setMaxListeners!=null&&(0,N2.setMaxListeners)(1/0,o.signal)}catch{}}let a=new AbortController;this.controllers.add(a);let c=[a.signal];i.signal!=null&&c.push(i.signal);let u=(0,LZ.anySignal)(c);try{N2.setMaxListeners!=null&&(0,N2.setMaxListeners)(1/0,u)}catch{}let l=D(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+j(e,"base58btc")),f=t.slice(0,Math.min(this.disjointPaths,t.length)),h=Date.now(),d=new Ue;try{if(l("query:start"),this.queries++,(w=this.metrics)==null||w.runningQueries.update(this.queries),t.length===0){l.error("Running query with no peers");return}let v=new pi,T=f.map((p,g)=>NZ({key:e,startingPeer:p,ourPeerId:this.components.peerId,signal:u,query:n,pathIndex:g,numPaths:f.length,alpha:this.alpha,cleanUp:d,queryFuncTimeout:i.queryFuncTimeout,log:l,peersSeen:v}));for await(let p of fr(...T))yield p,p.name==="QUERY_ERROR"&&l("error",p.error)}catch(v){if(!(!this.running&&v.code==="ERR_QUERY_ABORTED"))throw v}finally{this.controllers.delete(a),o!=null&&o.clear(),this.queries--,(b=this.metrics)==null||b.runningQueries.update(this.queries),s!=null&&s(),d.dispatchEvent(new ie("cleanup")),l("query:done in %dms",Date.now()-h)}}};var IT=C(Y(),1);var O2=D("libp2p:kad-dht:rpc:handlers:add-provider"),H8=class{constructor(e){let{providers:t}=e;this.providers=t}async handle(e,t){if(O2("start"),t.key==null||t.key.length===0)throw(0,IT.default)(new Error("Missing key"),"ERR_MISSING_KEY");let n;try{n=P.decode(t.key)}catch{throw(0,IT.default)(new Error("Invalid CID"),"ERR_INVALID_CID")}(t.providerPeers==null||t.providerPeers.length===0)&&O2.error("no providers found in message"),await Promise.all(t.providerPeers.map(async i=>{if(!i.id.equals(e)){O2("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){O2("no valid addresses for provider %p. Ignore",e);return}O2("received provider %p for %s (addrs %s)",e,n,i.multiaddrs.map(s=>s.toString())),await this.providers.addProvider(n,i.id)}))}};var BZ=D("libp2p:kad-dht:rpc:handlers:find-node"),$8=class{constructor(e,t){let{peerRouting:n,lan:i}=t;this.components=e,this.peerRouting=n,this.lan=Boolean(i)}async handle(e,t){BZ("incoming request from %p for peers closer to %b",e,t.key);let n=[];ke(this.components.peerId.toBytes(),t.key)?n=[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(s=>s.decapsulateCode(Nt("p2p").code)),protocols:[]}]:n=await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?z0:V0).filter(({multiaddrs:s})=>s.length);let i=new gr(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?i.closerPeers=n:BZ("could not find any peers closer to %b than %p",t.key,e),i}};var UZ=C(Y(),1);var MZ=D("libp2p:kad-dht:rpc:handlers:get-providers"),q8=class{constructor(e,t){let{peerRouting:n,providers:i,lan:s}=t;this.components=e,this.peerRouting=n,this.providers=i,this.lan=Boolean(s)}async handle(e,t){let n;try{n=P.decode(t.key)}catch{throw(0,UZ.default)(new Error("Invalid CID"),"ERR_INVALID_CID")}MZ("%p asking for providers for %s",e,n);let[i,s]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(i),a=await this._getPeers(s.map(({id:u})=>u)),c=new gr(t.type,t.key,t.clusterLevel);return o.length>0&&(c.providerPeers=o),a.length>0&&(c.closerPeers=a),MZ("got %s providers %s closerPeers",o.length,a.length),c}async _getAddresses(e){return(await this.components.peerStore.addressBook.get(e)).map(n=>n.multiaddr)}async _getPeers(e){let t=[],n=this.lan?z0:V0;for(let i of e){let s=n({id:i,multiaddrs:await this._getAddresses(i),protocols:[]});s.multiaddrs.length>0&&t.push(s)}return t}};var G8=C(Y(),1);var q0=D("libp2p:kad-dht:rpc:handlers:get-value"),j8=class{constructor(e,t){let{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){let n=t.key;if(q0("%p asked for key %b",e,n),n==null||n.length===0)throw(0,G8.default)(new Error("Invalid key"),"ERR_INVALID_KEY");let i=new gr(Fr.GET_VALUE,n,t.clusterLevel);if(fZ(n)){q0("is public key");let a=dZ(n),c;try{let u=await this.components.peerStore.keyBook.get(a);if(u==null)throw(0,G8.default)(new Error("No public key found in key book"),"ERR_NOT_FOUND");c=u}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u}if(c!=null)return q0("returning found public key"),i.record=new _r(n,c,new Date),i}let[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return s!=null&&(q0("had record for %b in local datastore",n),i.record=s),o.length>0&&(q0("had %s closer peers in routing table",o.length),i.closerPeers=o),i}async _checkLocalDatastore(e){q0("checkLocalDatastore looking for %b",e);let t=pc(e),n;try{n=await this.components.datastore.get(t)}catch(s){if(s.code==="ERR_NOT_FOUND")return;throw s}let i=_r.deserialize(n);if(i==null)throw(0,G8.default)(new Error("Invalid record"),"ERR_INVALID_RECORD");if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>1296e5){await this.components.datastore.delete(t);return}return i}};var y8e=D("libp2p:kad-dht:rpc:handlers:ping"),W8=class{async handle(e,t){return y8e("ping from %p",e),t}};var FZ=C(Y(),1);var Y8=class{constructor(e,t){let{validators:n}=t;this.components=e,this.log=D("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){let n=t.key;this.log("%p asked us to store value for key %b",e,n);let i=t.record;if(i==null){let s=`Empty record from: ${e.toString()}`;throw this.log.error(s),(0,FZ.default)(new Error(s),"ERR_EMPTY_RECORD")}try{await H0(this.validators,i),i.timeReceived=new Date;let s=pc(i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(s){this.log("did not put record for key %b into datastore %o",n,s)}return t}};var Q8=class{constructor(e,t){let{providers:n,peerRouting:i,validators:s,lan:o}=t;this.log=D("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[Fr.GET_VALUE]:new j8(e,{peerRouting:i}),[Fr.PUT_VALUE]:new Y8(e,{validators:s}),[Fr.FIND_NODE]:new $8(e,{peerRouting:i,lan:o}),[Fr.ADD_PROVIDER]:new H8({providers:n}),[Fr.GET_PROVIDERS]:new q8(e,{peerRouting:i,providers:n,lan:o}),[Fr.PING]:new W8}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(i){this.log.error("Failed to update the kbucket store",i)}let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}return await n.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{let{stream:t,connection:n}=e,i=n.remotePeer;try{await this.routingTable.add(i)}catch(o){this.log.error(o)}let s=this;await _e(t,cr(),async function*(o){for await(let a of o){let c=gr.deserialize(a);s.log("incoming %s from %p",c.type,i);let u=await s.handleMessage(i,c);u!=null&&(yield u.serialize())}},vr(),t)}).catch(t=>{this.log.error(t)})}};var X8=class extends Ue{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=D(`libp2p:kad-dht:topology-listener:${i?"lan":"wan"}`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;let e=r0({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new ie("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}};var RT=C(Tn(),1);var VZ=C(en(),1),zZ=C(Kn(),1);var Z8=class{constructor(e,t){let{peerRouting:n,lan:i,count:s,interval:o,queryTimeout:a}=t;this.components=e,this.log=D(`libp2p:kad-dht:${i?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=s??20,this.interval=o??sZ,this.queryTimeout=a??oZ}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}_querySelf(){Promise.resolve().then(async()=>{let e=new VZ.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;let t=(0,zZ.anySignal)([this.controller.signal,e.signal]);try{RT.setMaxListeners!=null&&(0,RT.setMaxListeners)(1/0,t)}catch{}let n=await _e(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),i=>Ai(i,this.count),async i=>await $s(i));this.log("query ran successfully - found %d peers",n)}catch(t){this.log("query error",t)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}}).catch(e=>{this.log("query error",e)})}};var w8e=32,b8e=64,L2=class extends Ue{constructor(e,t){super();let{kBucketSize:n,clientMode:i,validators:s,selectors:o,querySelfInterval:a,lan:c,protocolPrefix:u,pingTimeout:l,pingConcurrency:f,maxInboundStreams:h,maxOutboundStreams:d,providers:m}=t;this.running=!1,this.components=e,this.lan=Boolean(c),this.log=D(`libp2p:kad-dht:${c===!0?"lan":"wan"}`),this.protocol=`${u??rZ}${c===!0?tZ:""}${nZ}`,this.kBucketSize=n??20,this.clientMode=i??!0,this.maxInboundStreams=h??w8e,this.maxOutboundStreams=d??b8e,this.routingTable=new P8(e,{kBucketSize:n,lan:this.lan,pingTimeout:l,pingConcurrency:f,protocol:this.protocol}),this.providers=new V8(e,m??{}),this.validators={...xZ,...s},this.selectors={...AZ,...o},this.network=new N8(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new K8(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:c}),this.peerRouting=new F8(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new B8(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new M8(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new D8({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new Q8(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new X8(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new Z8(e,{peerRouting:this.peerRouting,interval:a,lan:this.lan}),this.network.addEventListener("peer",w=>{let b=w.detail;this.onPeerConnect(b).catch(v=>{this.log.error("could not add %p to routing table",b.id,v)}),this.dispatchEvent(new ie("peer",{detail:b}))}),this.topologyListener.addEventListener("peer",w=>{let b=w.detail;Promise.resolve().then(async()=>{let v=await this.components.peerStore.addressBook.get(b),T={id:b,multiaddrs:v.map(p=>p.multiaddr),protocols:[]};await this.onPeerConnect(T)}).catch(v=>{this.log.error("could not add %p to routing table",b,v)})})}get[Xo](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),this.lan?e=z0(e):e=V0(e),e.multiaddrs.length===0){this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),e==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){await this.routingTableRefresh.refreshTable(!0)}};var G0=C(Y(),1);var _8e=D("libp2p:kad-dht"),J8=class extends Ue{constructor(e,t,n){super(),this.components=e,this.wan=t,this.lan=n,this.wan.addEventListener("peer",i=>{this.dispatchEvent(new ie("peer",{detail:i.detail}))}),this.lan.addEventListener("peer",i=>{this.dispatchEvent(new ie("peer",{detail:i.detail}))})}get[Xo](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(let i of fr(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield i}async*get(e,t={}){let n=!1,i=!1;for await(let s of fr(this.lan.get(e,t),this.wan.get(e,t)))yield s,s.name==="DIALING_PEER"&&(n=!0),s.name==="VALUE"&&(n=!0,s.value!=null&&(i=!0)),s.name==="SENDING_QUERY"&&(n=!0);if(!n)throw(0,G0.default)(new Error("No peers found in routing table!"),"ERR_NO_PEERS_IN_ROUTING_TABLE");i||(yield Zn({from:this.components.peerId,error:(0,G0.default)(new Error("Not found"),"ERR_NOT_FOUND")}))}async*provide(e,t={}){let n=0,i=0,s=[],o=[this.lan];await this.wan.getMode()==="server"&&o.push(this.wan);for await(let a of fr(...o.map(c=>c.provide(e,t))))yield a,a.name==="SENDING_QUERY"&&n++,a.name==="QUERY_ERROR"&&s.push(a.error),a.name==="PEER_RESPONSE"&&a.messageName==="ADD_PROVIDER"&&(_8e("sent provider record for %s to %p",e,a.from),i++);if(i===0)throw s.length>0?(0,G0.default)(new Error(`Failed to provide to ${s.length} of ${n} peers`),"ERR_PROVIDES_FAILED",{errors:s}):(0,G0.default)(new Error("Failed to provide - no peers found"),"ERR_PROVIDES_FAILED")}async*findProviders(e,t={}){yield*fr(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(let i of fr(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield i,(i.name==="SENDING_QUERY"||i.name==="FINAL_PEER")&&(n=!0);if(!n)throw(0,G0.default)(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*fr(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}};var CT=class extends J8{constructor(e,t){super(e,new L2(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new L2(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}};function KZ(r){return e=>new CT(e,r)}var ew=D("libp2p:bootstrap"),E8e="bootstrap",v8e=50,S8e=12e4,x8e=1e3,tw=class extends Ue{constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??x8e,this.list=[];for(let n of t.list){if(!e3.matches(n)){ew.error("Invalid multiaddr");continue}let i=oe(n),s=i.getPeerId();if(s==null){ew.error("Invalid bootstrap multiaddr without peer id");continue}let o={id:fe(s),multiaddrs:[i],protocols:[]};this.list.push(o)}this._init=t}get[Xo](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(ew("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{ew.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(let e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??E8e,{value:this._init.tagValue??v8e,ttl:this._init.tagTTL??S8e}),this.timer==null)return;this.dispatchEvent(new ie("peer",{detail:e}))}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}};tw.tag="bootstrap";function HZ(r){return e=>new tw(e,r)}var $Z=WebSocket;var WZ=C(GZ(),1);function jZ(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}var YZ=r=>{r.binaryType="arraybuffer";let e=async()=>await new Promise((s,o)=>{if(n)return s();if(i!=null)return o(i);let a=l=>{r.removeEventListener("open",c),r.removeEventListener("error",u),l()},c=()=>a(s),u=l=>{a(()=>o(l.error??new Error(`connect ECONNREFUSED ${r.url}`)))};r.addEventListener("open",c),r.addEventListener("error",u)}),t=async function*(){let s=new WZ.EventIterator(({push:o,stop:a,fail:c})=>{let u=f=>{let h=null;typeof f.data=="string"&&(h=W(f.data)),jZ(f.data)&&(h=new Uint8Array(f.data)),f.data instanceof Uint8Array&&(h=f.data),h!=null&&o(h)},l=f=>c(f.error??new Error("Socket error"));return r.addEventListener("message",u),r.addEventListener("error",l),r.addEventListener("close",a),()=>{r.removeEventListener("message",u),r.removeEventListener("error",l),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(let o of s)yield jZ(o)?new Uint8Array(o):o}(),n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};var QZ=r=>{if(r.readyState>=2)throw new Error("socket closed");if(r.readyState!==1)return new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})};var XZ=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(let i of n){try{await QZ(r)}catch(s){if(s.message==="socket closed")break;throw s}r.send(i)}if(e.closeOnEnd!=null&&r.readyState<=1)return await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{let a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>r.close())})});var ZZ=(r,e)=>{e=e??{};let t=YZ(r),n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{let o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:XZ(r,e),source:t,connected:async()=>await t.connected(),close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}};var JZ=C(r3(),1),A8e={http:"ws",https:"wss"},I8e="ws",eJ=(r,e)=>(0,JZ.relative)(r,e,A8e,I8e);function tJ(r,e){let t=typeof window>"u"?"":window.location;e=e??{};let n=eJ(r,t.toString()),i=new $Z(n,e.websocket);return ZZ(i,e)}function rJ(){throw new Error("WebSocket Servers can not be created in the browser!")}var nJ=D("libp2p:websockets:socket");function iJ(r,e,t){t=t??{};let n={async sink(i){(t==null?void 0:t.signal)!=null&&(i=Cr(i,t.signal));try{await r.sink(i)}catch(s){s.type!=="aborted"&&nJ.error(s)}},source:t.signal!=null?Cr(r.source,t.signal):r.source,remoteAddr:e,timeline:{open:Date.now()},async close(){let i=Date.now();try{await Q1(r.close(),{milliseconds:2e3})}catch{let{host:o,port:a}=n.remoteAddr.toOptions();nJ("timeout closing stream to %s:%s after %dms, destroying it manually",o,a,Date.now()-i),r.destroy()}finally{n.timeline.close=Date.now()}}};return r.socket.addEventListener("close",()=>{n.timeline.close==null&&(n.timeline.close=Date.now())},{once:!0}),n}function aJ(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return hl.matches(t)||Dc.matches(t)})}function cJ(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return Dc.matches(t)&&Nc.matches(t.decapsulateCode(6).decapsulateCode(478))})}var Ju=D("libp2p:websockets"),DT=class{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[_0](){return!0}async dial(e,t){Ju("dialing %s",e),t=t??{};let n=await this._connect(e,t),i=iJ(n,e);Ju("new outbound connection %s",i.remoteAddr);let s=await t.upgrader.upgradeOutbound(i);return Ju("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var u,l;if(((u=t==null?void 0:t.signal)==null?void 0:u.aborted)===!0)throw new Fc;let n=e.toOptions();Ju("dialing %s:%s",n.host,n.port);let i=vt(),s=f=>{Ju.error("connection error:",f),i.reject(f)},o=tJ(Th(e),this.init);if(o.socket.on!=null?o.socket.on("error",s):o.socket.onerror=s,t.signal==null)return await Promise.race([o.connected(),i.promise]),Ju("connected %s",e),o;let a,c=new Promise((f,h)=>{var d,m;if(a=()=>{h(new Fc),o.close().catch(w=>{Ju.error("error closing raw socket",w)})},((d=t==null?void 0:t.signal)==null?void 0:d.aborted)===!0)return a();(m=t==null?void 0:t.signal)==null||m.addEventListener("abort",a)});try{await Promise.race([c,i.promise,o.connected()])}finally{a!=null&&((l=t==null?void 0:t.signal)==null||l.removeEventListener("abort",a))}return Ju("connected %s",e),o}createListener(e){return rJ({...this.init,...e})}filter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):Wf||e8?cJ(e):aJ(e)}};function uJ(r={}){return()=>new DT(r)}var j0=C(po(),1);function NT(r){return new Uint8Array(r)}var wt;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(wt||(wt={}));var M2=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),OT=Object.freeze({NEW_STREAM:wt.NEW_STREAM,MESSAGE:wt.MESSAGE_INITIATOR,CLOSE:wt.CLOSE_INITIATOR,RESET:wt.RESET_INITIATOR}),lJ=Object.freeze({MESSAGE:wt.MESSAGE_RECEIVER,CLOSE:wt.CLOSE_RECEIVER,RESET:wt.RESET_RECEIVER});var fJ=1024*1024,D8e=(r,e)=>e.append(r);async function*N8e(r,e={}){let t=new qe,n=!1,i=vt(),s=Number(e.size??fJ);(isNaN(s)||s===0||s<0)&&(s=fJ);let o=e.yieldAfter??0,a=e.serialize??D8e;for(Promise.resolve().then(async()=>{try{let c;for await(let u of r){if(a(u,t),t.byteLength>=s){clearTimeout(c),i.resolve();continue}c=setTimeout(()=>{i.resolve()},o)}clearTimeout(c),i.resolve()}catch(c){i.reject(c)}finally{n=!0}});!n;)if(await i.promise,i=vt(),t.byteLength>0){let c=t;t=new qe,yield c.subarray()}}var dJ=N8e;var LT=10*1024,BT=class{constructor(){this._pool=NT(LT),this._poolOffset=0}write(e,t){let n=this._pool,i=this._poolOffset;j0.default.encode(e.id<<3|e.type,n,i),i+=j0.default.encode.bytes??0,(e.type===wt.NEW_STREAM||e.type===wt.MESSAGE_INITIATOR||e.type===wt.MESSAGE_RECEIVER)&&e.data!=null?j0.default.encode(e.data.length,n,i):j0.default.encode(0,n,i),i+=j0.default.encode.bytes??0;let s=n.subarray(this._poolOffset,i);LT-i<100?(this._pool=NT(LT),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===wt.NEW_STREAM||e.type===wt.MESSAGE_INITIATOR||e.type===wt.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},hJ=new BT;async function*pJ(r,e=0){if(e==null||e===0){for await(let t of r){let n=new qe;for(let i of t)hJ.write(i,n);yield n.subarray()}return}yield*dJ(r,{size:e,serialize:(t,n)=>{for(let i of t)hJ.write(i,n)}})}var MT=1<<20,O8e=4<<20,iw=class{constructor(e=MT,t=O8e){this._buffer=new qe,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(u){if(u.code==="ERR_MSG_TOO_BIG")throw u;break}let{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;let c={id:n,type:i};(i===wt.NEW_STREAM||i===wt.MESSAGE_INITIATOR||i===wt.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=gJ(e),{value:i,offset:s}=gJ(e,n),o=t&7;if(M2[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+s,length:i}}},L8e=128,mJ=127;function gJ(r,e=0){let t=0,n=0,i=e,s,o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&mJ)<<n:(s&mJ)*Math.pow(2,n),n+=7}while(s>=L8e);return e=i-e,{value:t,offset:e}}var sw=C(Y(),1);var yJ=C(Kn(),1);var ro=D("libp2p:mplex:stream"),UT="ERR_STREAM_RESET",B8e="ERR_STREAM_ABORT",M8e="ERR_SINK_ENDED",U8e="ERR_DOUBLE_SINK";function wJ(r){let{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=MT}=r,a=new AbortController,c=new AbortController,u=new AbortController,l=s==="initiator"?OT:lJ,f=s==="initiator"?`i${e}`:`r${e}`,h=`${t??e}`,d=!1,m=!1,w=!1,b,v={open:Date.now()},T=E=>{d||(d=!0,ro.trace("%s stream %s source end - err: %o",s,h,E),E!=null&&b==null&&(b=E),m&&(y.stat.timeline.close=Date.now(),i!=null&&i(b)))},p=E=>{m||(m=!0,ro.trace("%s stream %s sink end - err: %o",s,h,E),E!=null&&b==null&&(b=E),d&&(v.close=Date.now(),i!=null&&i(b)))},g=Kt({onEnd:T}),y={close:()=>{ro.trace("%s stream %s close",s,h),y.closeRead(),y.closeWrite()},closeRead:()=>{ro.trace("%s stream %s closeRead",s,h),!d&&g.end()},closeWrite:()=>{if(ro.trace("%s stream %s closeWrite",s,h),!m){u.abort();try{n({id:e,type:l.CLOSE})}catch(E){ro.trace("%s stream %s error sending close",s,t,E)}p()}},abort:E=>{ro.trace("%s stream %s abort",s,h,E),g.end(E),a.abort(),p(E)},reset:()=>{let E=(0,sw.default)(new Error("stream reset"),UT);c.abort(),g.end(E),p(E)},sink:async E=>{if(w)throw(0,sw.default)(new Error("sink already called on stream"),U8e);if(w=!0,m)throw(0,sw.default)(new Error("stream closed for writing"),M8e);E=Cr(E,(0,yJ.anySignal)([a.signal,c.signal,u.signal]));try{s==="initiator"&&n({id:e,type:OT.NEW_STREAM,data:new qe(W(h))});for await(let _ of E)for(;_.length>0;){if(_.length<=o){n({id:e,type:l.MESSAGE,data:_ instanceof Uint8Array?new qe(_):_});break}_=_ instanceof Uint8Array?new qe(_):_,n({id:e,type:l.MESSAGE,data:_.sublist(0,o)}),_.consume(o)}}catch(_){if(_.type==="aborted"&&_.message==="The operation was aborted"){if(u.signal.aborted)return;c.signal.aborted&&(_.message="stream reset",_.code=UT),a.signal.aborted&&(_.message="stream aborted",_.code=B8e)}if(_.code===UT)ro.trace("%s stream %s reset",s,t);else{ro.trace("%s stream %s error",s,t,_);try{n({id:e,type:l.RESET})}catch(x){ro.trace("%s stream %s error sending reset",s,t,x)}}g.end(_),p(_);return}try{n({id:e,type:l.CLOSE})}catch(_){ro.trace("%s stream %s error sending close",s,t,_)}p()},source:g,sourcePush:E=>{g.push(E)},sourceReadableLength(){return g.readableLength},stat:{direction:s==="initiator"?"outbound":"inbound",timeline:v},metadata:{},id:f};return y}var FT=C(Y(),1),_J=C(Sx(),1),EJ=C(Kn(),1),no=D("libp2p:mplex"),F8e=1024,V8e=1024,z8e=1024*1024*4,K8e=5;function bJ(r){let e={...r,type:`${M2[r.type]} (${r.type})`};return r.type===wt.NEW_STREAM&&(e.data=j(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===wt.MESSAGE_INITIATOR||r.type===wt.MESSAGE_RECEIVER)&&(e.data=j(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var ow=class{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();let t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new _J.RateLimiterMemory({points:e.disconnectThreshold??K8e,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>t.abort(e)):this.streams.forEach(t=>t.close()),this.closeController.abort())}_newReceiverStream(e){let{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){let{id:t,name:n,type:i,registry:s}=e;if(no("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??V8e))throw(0,FT.default)(new Error("Too many outbound streams open"),"ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);let c=wJ({id:t,name:n,send:u=>{no.enabled&&no.trace("%s stream %s send",i,t,bJ(u)),this._source.push(u)},type:i,onEnd:()=>{no("%s stream with id %s and protocol %s ended",i,t,c.stat.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return s.set(t,c),c}_createSink(){return async t=>{let n=[this.closeController.signal];this._init.signal!=null&&n.push(this._init.signal),t=Cr(t,(0,EJ.default)(n));try{let i=new iw(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let s of t)for(let o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){no("error in sink",i),this._source.end(i)}}}_createSource(){let t=yL({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(pJ(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){let{id:t,type:n}=e;if(no.enabled&&no.trace("incoming message",bJ(e)),e.type===wt.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??F8e)){no("too many inbound streams open"),this._source.push({id:t,type:wt.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{no("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:j(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){no("missing stream %s for message type %s",t,M2[n]);return}let o=this._init.maxStreamBufferSize??z8e;switch(n){case wt.MESSAGE_INITIATOR:case wt.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o){this._source.push({id:e.id,type:n===wt.MESSAGE_INITIATOR?wt.RESET_RECEIVER:wt.RESET_INITIATOR});let a=(0,FT.default)(new Error("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers"),"ERR_STREAM_INPUT_BUFFER_FULL");s.abort(a);return}s.sourcePush(e.data);break;case wt.CLOSE_INITIATOR:case wt.CLOSE_RECEIVER:s.closeRead();break;case wt.RESET_INITIATOR:case wt.RESET_RECEIVER:s.reset();break;default:no("unknown message type %s",n)}}};var VT=class{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new ow({...e,...this._init})}};function vJ(r={}){return()=>new VT(r)}function zT(r,e={}){let t=ju(r),n=cr.fromReader(t.reader,e),i={read:async s=>{let{value:o}=await t.reader.next(s);if(o==null)throw new Error("Value is null");return o},readLP:async()=>{let{value:s}=await n.next();if(s==null)throw new Error("Value is null");return s},readPB:async s=>{let o=await i.readLP();if(o==null)throw new Error("Value is null");let a=o instanceof Uint8Array?o:o.subarray();return s.decode(a)},write:s=>{s instanceof Uint8Array?t.writer.push(s):t.writer.push(s.subarray())},writeLP:s=>{i.write(vr.single(s,e))},writePB:(s,o)=>{i.writeLP(o.encode(s))},pb:s=>({read:async()=>await i.readPB(s),write:o=>i.writePB(o,s)}),unwrap:()=>(t.rest(),t.stream)};return i}function KT(){let r=vt(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function SJ(){let r=KT(),e=KT();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}var xJ,TJ,AJ=Boolean((TJ=(xJ=globalThis.process)==null?void 0:xJ.env)==null?void 0:TJ.DUMP_SESSION_KEYS);var oee=C(NJ(),1),Y0=C(XJ(),1),_w=C(JJ(),1),sA=C(iA(),1),aee={hashSHA256(r){return(0,_w.hash)(r)},getHKDF(r,e){let i=new oee.HKDF(_w.SHA256,e,r).expand(96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){let r=Y0.generateKeyPair();return{publicKey:r.publicKey,privateKey:r.secretKey}},generateX25519KeyPairFromSeed(r){let e=Y0.generateKeyPairFromSeed(r);return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519SharedKey(r,e){return Y0.sharedKey(r,e)},chaCha20Poly1305Encrypt(r,e,t,n){return new sA.ChaCha20Poly1305(n).seal(e,r,t)},chaCha20Poly1305Decrypt(r,e,t,n,i){return new sA.ChaCha20Poly1305(n).open(e,r,t,i)}};var oA=C(iA(),1);var Xwe=r=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r),Q0=r=>{let e=Xwe(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,r,!1),e};Q0.bytes=2;var H2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");return r instanceof Uint8Array?new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,!1):r.getUint16(0)};H2.bytes=2;function cee(r){return ve([r.ne,r.ciphertext],r.ne.length+r.ciphertext.length)}function uee(r){return ve([r.ne,r.ns,r.ciphertext],r.ne.length+r.ns.length+r.ciphertext.length)}function lee(r){return ve([r.ns,r.ciphertext],r.ns.length+r.ciphertext.length)}function fee(r){if(r.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:r.subarray(0,32),ciphertext:r.subarray(32,r.length),ns:new Uint8Array(0)}}function dee(r){if(r.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:r.subarray(0,32),ns:r.subarray(32,80),ciphertext:r.subarray(80,r.length)}}function hee(r){if(r.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:r.subarray(0,48),ciphertext:r.subarray(48,r.length)}}function mee(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65519){let s=i+65519;s>n.length&&(s=n.length);let o=r.encrypt(n.subarray(i,s),r.session);e==null||e.encryptedPackets.increment(),yield Q0(o.byteLength),yield o}}}function gee(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65535){let s=i+65535;if(s>n.length&&(s=n.length),s-oA.TAG_LENGTH<i)throw new Error("Invalid chunk");let o=n.subarray(i,s),a=n.subarray(i,s-oA.TAG_LENGTH),{plaintext:c,valid:u}=r.decrypt(o,r.session,a);if(!u)throw e==null||e.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e==null||e.decryptedPackets.increment(),yield c}}}var Jf=class extends Error{constructor(e="Unexpected Peer"){super(e),this.code=Jf.code}static get code(){return"ERR_UNEXPECTED_PEER"}},bc=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=bc.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}};var Ew;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={webtransportCerthashes:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.webtransportCerthashes.push(t.bytes());break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(Ew||(Ew={}));var q2;(function(r){let e;r.codec=()=>(e==null&&(e=nt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identityKey!=null&&t.identityKey.byteLength>0)&&(n.uint32(10),n.bytes(t.identityKey)),(i.writeDefaults===!0||t.identitySig!=null&&t.identitySig.byteLength>0)&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),Ew.codec().encode(t.extensions,n,{writeDefaults:!1})),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.identityKey=t.bytes();break;case 2:i.identitySig=t.bytes();break;case 4:i.extensions=Ew.codec().decode(t,t.uint32());break;default:t.skipType(o&7);break}}return i})),e),r.encode=t=>rt(t,r.codec()),r.decode=t=>tt(t,r.codec())})(q2||(q2={}));async function yee(r,e,t){let n=await Jwe(r,wee(e));if(r.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return Zwe(r.publicKey,n,t)}function Zwe(r,e,t){return q2.encode({identityKey:r,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function Jwe(r,e){if(r.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return await(await hn(r.privateKey)).sign(e)}async function aA(r){return await br(r.identityKey)}function cA(r){return q2.decode(r)}function wee(r){let e=W("noise-libp2p-static-key:");return ve([e,r],e.length+r.length)}async function uA(r,e,t){let n=await br(e.identityKey);if(!n.equals(t))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${t.toString()}`);let i=wee(r);if(n.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await ii(n.publicKey).verify(i,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function G2(r){return!(!(r instanceof Uint8Array)||r.length!==32)}var wn=D("libp2p:noise");var Ss;AJ?Ss=wn:Ss=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function bee(r){Ss(`LOCAL_STATIC_PUBLIC_KEY ${j(r.publicKey,"hex")}`),Ss(`LOCAL_STATIC_PRIVATE_KEY ${j(r.privateKey,"hex")}`)}function lA(r){r?(Ss(`LOCAL_PUBLIC_EPHEMERAL_KEY ${j(r.publicKey,"hex")}`),Ss(`LOCAL_PRIVATE_EPHEMERAL_KEY ${j(r.privateKey,"hex")}`)):Ss("Missing local ephemeral keys.")}function _ee(r){Ss(`REMOTE_STATIC_PUBLIC_KEY ${j(r,"hex")}`)}function fA(r){Ss(`REMOTE_EPHEMERAL_PUBLIC_KEY ${j(r,"hex")}`)}function Eee(r){r.cs1&&r.cs2?(Ss(`CIPHER_STATE_1 ${r.cs1.n.getUint64()} ${j(r.cs1.k,"hex")}`),Ss(`CIPHER_STATE_2 ${r.cs2.n.getUint64()} ${j(r.cs2.k,"hex")}`)):Ss("Missing cipher state.")}var e7e="Cipherstate has reached maximum n, a new handshake must be performed",vw=class{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error(e7e)}};var Sw=class{constructor(e){this.crypto=e}encryptWithAd(e,t,n){let i=this.encrypt(e.k,e.n,t,n);return e.n.increment(),i}decryptWithAd(e,t,n,i){let{plaintext:s,valid:o}=this.decrypt(e.k,e.n,t,n,i);return o&&e.n.increment(),{plaintext:s,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){let t=this.createEmptyKey();return ke(t,e)}encrypt(e,t,n,i){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(i,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return this.hasKey(e.cs)?n=this.encryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,n),n}decrypt(e,t,n,i,s){t.assertValue();let o=this.crypto.chaCha20Poly1305Decrypt(i,t.getBytes(),n,e,s);return o?{plaintext:o,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,i=!0;return this.hasKey(e.cs)?{plaintext:n,valid:i}=this.decryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,t),{plaintext:n,valid:i}}dh(e,t){try{let n=this.crypto.generateX25519SharedKey(e,t);return n.length===32?n:n.subarray(0,32)}catch(n){return wn(n.message),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(ve([e,t],e.length+t.length))}mixKey(e,t){let[n,i]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(i),e.ck=n}initializeKey(e){return{k:e,n:new vw}}initializeSymmetric(e){let t=W(e,"utf-8"),n=this.hashProtocolName(t),i=n,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:i,h:n}}hashProtocolName(e){if(e.length<=32){let t=new Uint8Array(32);return t.set(e),t}else return this.getHash(e,new Uint8Array(0))}split(e){let[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),i=this.initializeKey(t),s=this.initializeKey(n);return{cs1:i,cs2:s}}writeMessageRegular(e,t){let n=this.encryptWithAd(e,new Uint8Array(0),t),i=this.createEmptyKey(),s=new Uint8Array(0);return{ne:i,ns:s,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}};var xw=class extends Sw{initializeInitiator(e,t,n,i){let s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:i,re:a}}initializeResponder(e,t,n,i){let s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:i,re:a}}writeMessageA(e,t,n){let i=new Uint8Array(0);n!==void 0?e.e=n:e.e=this.crypto.generateX25519KeyPair();let s=e.e.publicKey;this.mixHash(e.ss,s);let o=this.encryptAndHash(e.ss,t);return{ne:s,ns:i,ciphertext:o}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();let n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let i=e.s.publicKey,s=this.encryptAndHash(e.ss,i);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let o=this.encryptAndHash(e.ss,t);return{ne:n,ns:s,ciphertext:o}}writeMessageC(e,t){let n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let s=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:i,ciphertext:s},{cs1:c,cs2:u}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:c,cs2:u}}readMessageA(e,t){return G2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(G2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);i&&G2(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:i&&o}}readMessageC(e,t){let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);if(i&&G2(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:i&&o,cs1:a,cs2:c}}initSession(e,t,n){let i=this.createEmptyKey(),s=new Uint8Array(32),o;return e?o=this.initializeInitiator(t,n,s,i):o=this.initializeResponder(t,n,s,i),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let i;if(e.mc===0)i=this.writeMessageA(e.hs,t,n);else if(e.mc===1)i=this.writeMessageB(e.hs,t);else if(e.mc===2){let{h:s,messageBuffer:o,cs1:a,cs2:c}=this.writeMessageC(e.hs,t);i=o,e.h=s,e.cs1=a,e.cs2=c}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");i=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");i=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,i}recvMessage(e,t){let n=new Uint8Array(0),i=!1;if(e.mc===0)({plaintext:n,valid:i}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:n,valid:i}=this.readMessageB(e.hs,t));else if(e.mc===2){let{h:s,plaintext:o,valid:a,cs1:c,cs2:u}=this.readMessageC(e.hs,t);n=o,i=a,e.h=s,e.cs1=c,e.cs2=u}return e.mc++,{plaintext:n,valid:i}}};var Tw=class{constructor(e,t,n,i,s,o,a,c){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=s,this.connection=o,a&&(this.remotePeer=a),this.xx=c??new xw(i),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(bee(this.session.hs.s),this.isInitiator){wn("Stage 0 - Initiator starting to send first message.");let e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(cee(e)),wn("Stage 0 - Initiator finished sending first message."),lA(this.session.hs.e)}else{wn("Stage 0 - Responder waiting to receive first message...");let e=fee((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new bc("xx handshake stage 0 validation fail");wn("Stage 0 - Responder received first message."),fA(this.session.hs.re)}}async exchange(){if(this.isInitiator){wn("Stage 1 - Initiator waiting to receive first message from responder...");let e=dee((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new bc("xx handshake stage 1 validation fail");wn("Stage 1 - Initiator received the message."),fA(this.session.hs.re),_ee(this.session.hs.rs),wn("Initiator going to check remote's signature...");try{let i=cA(t);this.remotePeer=this.remotePeer||await aA(i),await uA(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let s=i;throw new Jf(`Error occurred while verifying signed payload: ${s.message}`)}wn("All good with the signature!")}else{wn("Stage 1 - Responder sending out first message with signed payload and static key.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(uee(e)),wn("Stage 1 - Responder sent the second handshake message with signed payload."),lA(this.session.hs.e)}}async finish(){if(this.isInitiator){wn("Stage 2 - Initiator sending third handshake message.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(lee(e)),wn("Stage 2 - Initiator sent message with signed payload.")}else{wn("Stage 2 - Responder waiting for third handshake message...");let e=hee((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new bc("xx handshake stage 2 validation fail");wn("Stage 2 - Responder received the message, finished handshake.");try{let i=cA(t);this.remotePeer=this.remotePeer||await aA(i),await uA(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let s=i;throw new Jf(`Error occurred while verifying signed payload: ${s.message}`)}}Eee(this.session)}encrypt(e,t){let n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){let i=this.getCS(t,!1);return this.xx.decryptWithAd(i,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new bc("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}};function vee(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}var Aw=class{constructor(e={}){this.protocol="/noise";let{staticNoiseKey:t,extensions:n,crypto:i,prologueBytes:s,metrics:o}=e;this.crypto=i??aee,this.extensions=n,this.metrics=o?vee(o):void 0,t?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(t):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,n){let i=zT(t,{lengthEncoder:Q0,lengthDecoder:H2,maxDataLength:65535}),s=await this.performHandshake({connection:i,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,s),remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,n){let i=zT(t,{lengthEncoder:Q0,lengthDecoder:H2,maxDataLength:65535}),s=await this.performHandshake({connection:i,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,s),remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){let t=await yee(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){var a,c;let{isInitiator:n,remotePeer:i,connection:s}=e,o=new Tw(n,t,this.prologue,this.crypto,this.staticKeys,s,i);try{await o.propose(),await o.exchange(),await o.finish(),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(u){if((c=this.metrics)==null||c.xxHandshakeErrors.increment(),u instanceof Error)throw u.message=`Error occurred during XX handshake: ${u.message}`,u}return o}async createSecureConnection(e,t){let[n,i]=SJ(),s=e.unwrap();return await _e(n,mee(t,this.metrics),s,cr({lengthDecoder:H2}),gee(t,this.metrics),n),i}};function See(r={}){return()=>new Aw(r)}var t7e=Ve.bind({ignoreUndefined:!0,concatArrays:!0});function j2({options:r={},peerId:e,multiaddrs:t=[],repo:n,keychainConfig:i={},config:s={}}){let{datastore:o}=n,a=r7e({options:r,config:s,datastore:o,keychainConfig:i,peerId:e,multiaddrs:t});return typeof r.libp2p=="function"?r.libp2p({libp2pOptions:a,options:r,config:s,datastore:o,peerId:e}):(a.start=!1,jX(a))}function r7e({options:r,config:e,datastore:t,keychainConfig:n,peerId:i,multiaddrs:s}){var d,m,w,b;let o=()=>{let v=(0,Ft.default)(e,"Pubsub.Router")||"gossipsub",T=L$();if(!T[v])throw(0,xee.default)(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${v} router.`),"ERR_NOT_SUPPORTED");return T[v]},a={datastore:t,peerId:i},c={addresses:{listen:s.map(v=>v.toString()),announce:(0,Ft.default)(r,"addresses.announce",(0,Ft.default)(e,"Addresses.Announce",[])),noAnnounce:(0,Ft.default)(r,"addresses.noAnnounce",(0,Ft.default)(e,"Addresses.NoAnnounce",[]))},connectionManager:(0,Ft.default)(r,"connectionManager",{maxConnections:(0,Ft.default)(r,"config.Swarm.ConnMgr.HighWater",(0,Ft.default)(e,"Swarm.ConnMgr.HighWater")),minConnections:(0,Ft.default)(r,"config.Swarm.ConnMgr.LowWater",(0,Ft.default)(e,"Swarm.ConnMgr.LowWater"))}),keychain:n,identify:{host:{agentVersion:`js-ipfs/${ql}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[vJ({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[See()],relay:{enabled:(0,Ft.default)(r,"relay.enabled",(0,Ft.default)(e,"relay.enabled",!0)),hop:{enabled:(0,Ft.default)(r,"relay.hop.enabled",(0,Ft.default)(e,"relay.hop.enabled",!1)),active:(0,Ft.default)(r,"relay.hop.active",(0,Ft.default)(e,"relay.hop.active",!1))}},nat:{enabled:!(0,Ft.default)(e,"Swarm.DisableNatPortMap",!1)}};(0,Ft.default)(r,"config.Pubsub.Enabled",(0,Ft.default)(e,"Pubsub.Enabled",!0))&&(c.pubsub=o()),(0,Ft.default)(e,"Routing.Type","dhtclient")!=="none"&&(c.dht=KZ({clientMode:(0,Ft.default)(e,"Routing.Type","dht")!=="dhtserver",kBucketSize:(0,Ft.default)(r,"dht.kBucketSize",20),validators:{ipns:ih},selectors:{ipns:gy}}));let u=(0,Ft.default)(r,"config.Bootstrap",(0,Ft.default)(e,"Bootstrap",[]));u.length>0&&((d=c.peerDiscovery)==null||d.push(HZ({list:u})));let l=(0,Ft.default)(r,"libp2p",void 0);typeof l=="function"&&(l=void 0);let f=t7e(a,AW(),c,l),h=(0,Ft.default)(r,"config.Addresses.Delegates",(0,Ft.default)(e,"Addresses.Delegates",[]));if(h.length>0){let v=h[Math.floor(Math.random()*h.length)],T=oe(v).toOptions(),p={host:T.host,protocol:parseInt(T.port)===443?"https":"http",port:T.port},g=Bj(p);(m=f.contentRouters)==null||m.push(H$(g)),(w=f.peerRouters)==null||w.push(V$(g))}return(0,Ft.default)(r,"config.Discovery.MDNS.Enabled",(0,Ft.default)(e,"Discovery.MDNS.Enabled",!0))||(f.peerDiscovery=(b=f.peerDiscovery)==null?void 0:b.filter(v=>{try{if(typeof v=="function")return v({})[Symbol.toStringTag]!=="@libp2p/mdns"}catch{}return!0})),f.transports==null&&(f.transports=[]),f.transports.find(v=>{try{if(typeof v=="function")return v({})[Symbol.toStringTag]==="@libp2p/websockets"}catch{}return!1})==null&&f.transports.push(uJ()),f}var dA=C(Y(),1);var Aee=Ve.bind({ignoreUndefined:!0}),W2=D("ipfs:components:peer:storage"),X0=class{constructor(e,t,n,i,s){this.print=i,this.peerId=e,this.keychain=t,this.repo=n,this.print=i,this.isNew=s}static async start(e,t,n){let{repoAutoMigrate:i,repo:s,onMigrationProgress:o}=n,a=typeof s=="string"||s==null?pH(e,t,{path:s,autoMigrate:i,onMigrationProgress:o}):s,{peerId:c,keychain:u,isNew:l}=await n7e(e,a,n);return new X0(c,u,a,e,l)}},n7e=async(r,e,t)=>{if(!e.closed)return{...await Tee(e,t),isNew:!1};try{return await e.open(),{...await Tee(e,t),isNew:!1}}catch(n){if(n.code!==af)throw n;if(t.init&&t.init.allowNew===!1)throw new Ds("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await i7e(r,e,t),isNew:!0}}},i7e=async(r,e,t)=>{let n=t.init||{},i=await e.exists();if(W2("repo exists?",i),i===!0)throw new Error("repo already exists");let s=n.privateKey?await s7e(n.privateKey):await o7e(r,n),o=a7e(s);W2("peer identity: %s",o.PeerID);let a={...Aee(Iee(La(),n.profiles),t.config),Identity:o};await e.init(a),await e.open(),W2("repo opened");let c={pass:t.pass};try{c.dek=await e.config.get("Keychain.DEK")}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}let u=await j2({options:void 0,multiaddrs:void 0,peerId:s,repo:e,config:a,keychainConfig:c});return await e.datastore.has(new le("/info/self"))||await u.keychain.importPeer("self",s),await e.config.set("Keychain",{DEK:u.keychain.init.dek}),{peerId:s,keychain:u.keychain}},s7e=async r=>{if(W2("using user-supplied private-key"),$n(r))return r;let e=W(r,"base64pad"),t=await hn(e);return await br(t.public.bytes,t.bytes)},o7e=(r,{algorithm:e="Ed25519",bits:t=2048})=>{if(r("generating %s keypair...",e),e==="Ed25519")return S8();if(e==="RSA")return IX({bits:t});throw(0,dA.default)(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},a7e=r=>{if(r.privateKey==null)throw(0,dA.default)(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:r.toString(),PrivKey:j(r.privateKey,"base64pad")}},Tee=async(r,e)=>{let t=e.config,n=e.init&&e.init.profiles||[],i=e.pass,s=await r.config.getAll(),o=c7e(Iee(s,n),t);if(s!==o&&await r.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new Ea("No private key was found in the config, please intialize the repo");let a=W(o.Identity.PrivKey,"base64pad"),c=await hn(a),u=await br(c.public.bytes,c.bytes),l=await j2({options:void 0,multiaddrs:void 0,peerId:u,repo:r,config:o,keychainConfig:{pass:i,...o.Keychain}});return{peerId:u,keychain:l.keychain}},c7e=(r,e)=>e?Aee(r,e):r,Iee=(r,e)=>(e||[]).reduce((t,n)=>{let i=vh[n];if(!i)throw new Error(`Could not find profile with name '${n}'`);return W2("applying profile %s",n),i.transform(t)},r);var $ee=C(zee(),1);var Y2=C(po(),1);function v7e(r){let e=new Uint8Array(r.reduce((n,i)=>n+Y2.default.encodingLength(i),0)),t=0;for(let n of r)e=Y2.encode(n,e,t),t+=Y2.default.encodingLength(n);return e}var Kee=v7e;var Q2=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(Te)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};var io=C(fo(),1),ca=io.default.Reader,X2=io.default.Writer,Dt=io.default.util,xt=io.default.roots["ipfs-bitswap"]||(io.default.roots["ipfs-bitswap"]={}),$i=xt.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=Dt.emptyArray,r.prototype.payload=Dt.emptyArray,r.prototype.blockPresences=Dt.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=X2.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&xt.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)xt.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)xt.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof ca||(t=ca.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new xt.Message;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:{s.wantlist=xt.Message.Wantlist.decode(t,t.uint32());break}case 2:{s.blocks&&s.blocks.length||(s.blocks=[]),s.blocks.push(t.bytes());break}case 3:{s.payload&&s.payload.length||(s.payload=[]),s.payload.push(xt.Message.Block.decode(t,t.uint32()));break}case 4:{s.blockPresences&&s.blockPresences.length||(s.blockPresences=[]),s.blockPresences.push(xt.Message.BlockPresence.decode(t,t.uint32()));break}case 5:{s.pendingBytes=t.int32();break}default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof xt.Message)return t;var n=new xt.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=xt.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?Dt.base64.decode(t.blocks[i],n.blocks[i]=Dt.newBuffer(Dt.base64.length(t.blocks[i])),0):t.blocks[i].length>=0&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=xt.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=xt.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=xt.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var s=0;s<t.blocks.length;++s)i.blocks[s]=n.bytes===String?Dt.base64.encode(t.blocks[s],0,t.blocks[s].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[s]):t.blocks[s]}if(t.payload&&t.payload.length){i.payload=[];for(var s=0;s<t.payload.length;++s)i.payload[s]=xt.Message.Block.toObject(t.payload[s],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s)i.blockPresences[s]=xt.Message.BlockPresence.toObject(t.blockPresences[s],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,io.default.util.toJSONOptions)},r.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Message"},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=Dt.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=X2.create()),n.entries!=null&&n.entries.length)for(var s=0;s<n.entries.length;++s)xt.Message.Wantlist.Entry.encode(n.entries[s],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof ca||(n=ca.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new xt.Message.Wantlist;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.entries&&o.entries.length||(o.entries=[]),o.entries.push(xt.Message.Wantlist.Entry.decode(n,n.uint32()));break}case 2:{o.full=n.bool();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof xt.Message.Wantlist)return n;var i=new xt.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var s=0;s<n.entries.length;++s){if(typeof n.entries[s]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[s]=xt.Message.Wantlist.Entry.fromObject(n.entries[s])}}return n.full!=null&&(i.full=Boolean(n.full)),i},e.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.entries=[]),i.defaults&&(s.full=!1),n.entries&&n.entries.length){s.entries=[];for(var o=0;o<n.entries.length;++o)s.entries[o]=xt.Message.Wantlist.Entry.toObject(n.entries[o],i)}return n.full!=null&&n.hasOwnProperty("full")&&(s.full=n.full),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,io.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Wantlist"},e.WantType=function(){let t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.block=Dt.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,s){return s||(s=X2.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&s.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&s.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&s.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&s.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&s.uint32(40).bool(i.sendDontHave),s},t.decode=function(i,s){i instanceof ca||(i=ca.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new xt.Message.Wantlist.Entry;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:{a.block=i.bytes();break}case 2:{a.priority=i.int32();break}case 3:{a.cancel=i.bool();break}case 4:{a.wantType=i.int32();break}case 5:{a.sendDontHave=i.bool();break}default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof xt.Message.Wantlist.Entry)return i;var s=new xt.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?Dt.base64.decode(i.block,s.block=Dt.newBuffer(Dt.base64.length(i.block)),0):i.block.length>=0&&(s.block=i.block)),i.priority!=null&&(s.priority=i.priority|0),i.cancel!=null&&(s.cancel=Boolean(i.cancel)),i.wantType){case"Block":case 0:s.wantType=0;break;case"Have":case 1:s.wantType=1;break}return i.sendDontHave!=null&&(s.sendDontHave=Boolean(i.sendDontHave)),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.block="":(o.block=[],s.bytes!==Array&&(o.block=Dt.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=s.enums===String?"Block":0,o.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(o.block=s.bytes===String?Dt.base64.encode(i.block,0,i.block.length):s.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(o.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(o.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(o.wantType=s.enums===String?xt.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(o.sendDontHave=i.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,io.default.util.toJSONOptions)},t.getTypeUrl=function(i){return i===void 0&&(i="type.googleapis.com"),i+"/Message.Wantlist.Entry"},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=Dt.newBuffer([]),e.prototype.data=Dt.newBuffer([]),e.encode=function(n,i){return i||(i=X2.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof ca||(n=ca.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new xt.Message.Block;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.prefix=n.bytes();break}case 2:{o.data=n.bytes();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof xt.Message.Block)return n;var i=new xt.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?Dt.base64.decode(n.prefix,i.prefix=Dt.newBuffer(Dt.base64.length(n.prefix)),0):n.prefix.length>=0&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?Dt.base64.decode(n.data,i.data=Dt.newBuffer(Dt.base64.length(n.data)),0):n.data.length>=0&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.prefix="":(s.prefix=[],i.bytes!==Array&&(s.prefix=Dt.newBuffer(s.prefix))),i.bytes===String?s.data="":(s.data=[],i.bytes!==Array&&(s.data=Dt.newBuffer(s.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(s.prefix=i.bytes===String?Dt.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(s.data=i.bytes===String?Dt.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,io.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Block"},e}(),r.BlockPresenceType=function(){let e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=Dt.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=X2.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof ca||(n=ca.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new xt.Message.BlockPresence;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:{o.cid=n.bytes();break}case 2:{o.type=n.int32();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof xt.Message.BlockPresence)return n;var i=new xt.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?Dt.base64.decode(n.cid,i.cid=Dt.newBuffer(Dt.base64.length(n.cid)),0):n.cid.length>=0&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.cid="":(s.cid=[],i.bytes!==Array&&(s.cid=Dt.newBuffer(s.cid))),s.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(s.cid=i.bytes===String?Dt.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(s.type=i.enums===String?xt.Message.BlockPresenceType[n.type]:n.type),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,io.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.BlockPresence"},e}(),r})();var Hee={Block:$i.Wantlist.WantType.Block,Have:$i.Wantlist.WantType.Have},S7e=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),so=class{constructor(e,t){this.set=t?Vi({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=e.toString(Te),s=this.set.get(i);s?(s.inc(),s.priority=t,s.wantType===Hee.Have&&n===Hee.Block&&(s.wantType=n)):(this.set.set(i,new Q2(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(Te),n=this.set.get(t);n&&(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(S7e(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(Te);return this.set.has(t)}get(e){let t=e.toString(Te);return this.set.get(t)}};so.Entry=Q2;var x7e=so.Entry,tl=class{constructor(e,t,n,i,s){this.entry=new x7e(e,t,n),this.cancel=Boolean(i),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(Te)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var xs=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toString().slice(0,8)}`),D(t.join(":"))};var Iw=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!ke(n,i)||n instanceof tl&&i instanceof tl&&!n.equals(i))return!1}return!0};var Vt=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,s){n==null&&(n=Vt.WantType.Block);let o=e.toString(Te),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=Boolean(i)),s&&(a.sendDontHave=Boolean(s)),n===Vt.WantType.Block&&a.wantType===Vt.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new tl(e,t,n,i,s))}addBlock(e,t){let n=e.toString(Te);this.blocks.set(n,t)}addHave(e){let t=e.toString(Te);this.blockPresences.has(t)||this.blockPresences.set(t,Vt.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(Te);this.blockPresences.has(t)||this.blockPresences.set(t,Vt.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(Te);this.wantlist.delete(t),this.addEntry(e,0,Vt.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return $i.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=P.parse(t),s=i.version,o=i.code,a=i.multihash.code,c=i.multihash.digest.length,u=Kee([s,o,a,c]);e.payload.push(new $i.Block({prefix:u,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new $i.BlockPresence({cid:P.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),$i.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!Iw(this.wantlist,e.wantlist)||!Iw(this.blocks,e.blocks)||!Iw(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};Vt.deserialize=async(r,e)=>{let t=$i.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new Vt(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(s=>{if(!s.block)return;let o=P.decode(s.block);i.addEntry(o,s.priority||0,s.wantType,Boolean(s.cancel),Boolean(s.sendDontHave))}),t.blockPresences&&t.blockPresences.forEach(s=>{if(!s.cid)return;let o=P.decode(s.cid);s.type===Vt.BlockPresenceType.Have?i.addHave(o):i.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async s=>{let o=await Pe.digest(s),a=P.createV0(o);i.addBlock(a,s)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async s=>{if(!s.prefix||!s.data)return;let o=(0,$ee.default)(s.prefix),a=o[0],c=o[1],u=o[2],l=u===Pe.code?Pe:e&&await e.getHasher(u);if(!l)throw new ae("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");let f=await l.digest(s.data),h=P.create(a,c,f);i.addBlock(h,s.data)})),i.setPendingBytes(t.pendingBytes)),i)};Vt.blockPresenceSize=r=>r.bytes.length+1;Vt.Entry=tl;Vt.WantType={Block:$i.Wantlist.WantType.Block,Have:$i.Wantlist.WantType.Have};Vt.BlockPresenceType={Have:$i.BlockPresenceType.Have,DontHave:$i.BlockPresenceType.DontHave};var qee=Math.pow(2,31)-1,Gee=1e3,jee=1;var Wee=T7e;function T7e(r,e,t){var n=null,i=null,s=function(){n&&(clearTimeout(n),i=null,n=null)},o=function(){var c=i;s(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,u=arguments,l=t&&!n;if(s(),i=function(){r.apply(c,u)},n=setTimeout(function(){if(n=null,!l){var f=i;return i=null,f()}},e),l)return i()};return a.cancel=s,a.flush=o,a}var Rw=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=xs(e,"msgqueue"),this.sendEntries=Wee(this._sendEntries.bind(this),jee)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new Vt(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toString(),t.message);return}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}};var Cw=class{constructor(e,t,n,i){this.peers=Vi({name:"ipfs_bitswap_want_manager_peers",metrics:i.metrics}),this.wantlist=new so(n,i),this.network=t,this._stats=n,this._peerId=e,this._log=xs(e,"want")}_addEntries(e,t,n){let i=e.map((s,o)=>new Vt.Entry(s,qee-o,Vt.WantType.Block,t));i.forEach(s=>{s.cancel?n?this.wantlist.removeForce(s.cid.toString(Te)):this.wantlist.remove(s.cid):(this._log("adding to wl"),this.wantlist.add(s.cid,s.priority))});for(let s of this.peers.values())s.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t){t.refcnt++;return}t=new Rw(this._peerId,e,this.network);let n=new Vt(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toString());t&&(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}};var Yee=C(en(),1);var mA="/ipfs/bitswap/1.0.0",gA="/ipfs/bitswap/1.1.0",yA="/ipfs/bitswap/1.2.0",I7e=32,R7e=128,C7e=3e4,Pw=class{constructor(e,t,n,i={}){this._log=xs(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[mA],i.b100Only||(this._protocols.unshift(gA),this._protocols.unshift(yA)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=i.hashLoader,this._maxInboundStreams=i.maxInboundStreams??I7e,this._maxOutboundStreams=i.maxOutboundStreams??R7e,this._incomingStreamTimeout=i.incomingStreamTimeout??C7e}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});let e=r0({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(let t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach(t=>{this._onPeerConnect(t.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarIds!=null){for(let e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;let n=new Yee.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await _e(Cr(e.source,n.signal),cr(),async i=>{for await(let s of i){try{let o=await Vt.deserialize(s.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}n.reset()}})}).catch(i=>{this._log(i),e.abort(i)}).finally(()=>{n.clear(),e.close()})}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){let n=[],i=0;for await(let s of this.findProviders(e,t))if(this._log(`connecting to provider ${s.id}`),n.push(this.connectTo(s.id,t).catch(o=>{this._log.error(o)})),i++,i===3)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toString();this._log("sendMessage to %s",n,t);let s=await(await this._libp2p.dial(e)).newStream([yA,gA,mA]);await P7e(s,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toString();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function P7e(r,e,t){try{let n;switch(r.stat.protocol){case mA:n=e.serializeToBitswap100();break;case gA:case yA:n=e.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+r.stat.protocol)}await _e([n],vr(),r)}catch(n){t(n)}finally{r.close()}}var kw=class{constructor(e){this.partner=e,this.wantlist=new so,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};var Z2=class extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,s=this._kCmp(this._keys[i],e);if(s<0)t=i+1;else if(s>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var k7e={hasNewInfo(){return!1},merge(){}},Dw=class{constructor(e=k7e){this._taskMerger=e,this._byPeer=new Z2([],Nw.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new Nw(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toString());if(!n)return;let i=this._byPeer.indexOf(e.toString());for(let s of t)n.taskDone(s);this._byPeer.update(i)}},Nw=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new wA,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let s=0;s<i.length&&t<e;s++){let o=i[s];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},wA=class{constructor(){this._tasks=new Z2([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};var Qee={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var Xee=Vt.WantType,D7e=16*1024,N7e=1024,Ow=class{constructor(e,t,n,i,s,o={}){this._log=xs(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(o),this.ledgerMap=Vi({name:"ipfs_bitswap_ledger_map",metrics:s.metrics}),this._running=!1,this._requestQueue=new Dw(Qee)}_processOpts(e){return{maxSizeReplaceHasWithBlock:N7e,targetMessageSize:D7e,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new Vt(!1);i.setPendingBytes(n);let s=[],o=new Map;for(let c of t){let u=P.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(s.push(u),o.set(c.topic,c.data)):i.addHave(u):i.addDontHave(u)}let a=await this._getBlocks(s);for(let[c,u]of o){let l=P.parse(c),f=a.get(c);f?i.addBlock(l,f):u.sendDontHave&&i.addDontHave(l)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,u]of a.entries())e&&this.messageSent(e,P.parse(c),u)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let s=n.data.length,o=this._sendAsBlock(i.wantType,s),a=s;o||(a=Vt.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(Te),priority:i.priority,size:a,data:{blockSize:s,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new so),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],s=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),i.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),s.push(o))}),this._cancelWants(e,i),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(Te),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(s=>s.cid)),i=[];for(let s of t){let o=s.cid.toString(Te),a=n.get(o);if(a==null)s.sendDontHave&&i.push({topic:o,priority:s.priority,size:Vt.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===Xee.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{let c=this._sendAsBlock(s.wantType,a),u=a;c||(u=Vt.blockPresenceSize(s.cid)),i.push({topic:o,priority:s.priority,size:u,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===Xee.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(Te),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){let t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;let i=new kw(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};var ete=C(Tn(),1);var Zee=r=>`unwant:${j(r.multihash.bytes,"base64")}`,Jee=r=>`block:${j(r.multihash.bytes,"base64")}`,Lw=class extends ete.EventEmitter{constructor(e){super(),this.setMaxListeners(Gee),this._log=xs(e,"notif")}hasBlock(e,t){let n=Jee(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=Jee(e),i=Zee(e);return this._log(`wantBlock:${e}`),new Promise((s,o)=>{let a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=u=>{this.removeListener(i,a),s(u)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=Zee(e);this._log(t),this.emit(t)}};var ote=C(Tn(),1);var ite=C(Tn(),1),bA=C(nte(),1),J2=class extends ite.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=(0,bA.default)(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let s=i/t*1e3,o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=(0,bA.default)(a)),c.push(n,s)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var ste={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},Bw=class extends ote.EventEmitter{constructor(e,t=[],n=ste){super();let i=Object.assign({},ste,n);if(typeof i.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof i.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=i,this._enabled=this._options.enabled,this._global=new J2(t,i),this._global.on("update",s=>this.emit("update",s)),this._peers=Vi({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new J2(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};var ate=C(Kn(),1);var L7e={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},B7e=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],Mw=class extends qo{constructor(e,t,n={}){super(),this._libp2p=e,this._log=xs(this.peerId),this._options=Object.assign({},L7e,n),this._stats=new Bw(e,B7e,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new Pw(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new Ow(this.peerId,t,this.network,this._stats,e),this.wm=new Cw(this.peerId,this.network,this._stats,e),this.notifications=new Lw(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch{this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,s]of t.blocks.entries()){let o=P.parse(i);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:s})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:s,data:o})=>this._handleReceivedBlock(e,i,o,s)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,s),i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(c,u)=>(this.wm.wantBlocks([c],u),this.notifications.wantBlock(c,u)),i=!1,s=async(c,u)=>{try{return await this.blockstore.get(c,u)}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l;return i||(i=!0,this.network.findAndConnect(c,u).catch(f=>this._log.error(f))),n(c,u)}},o=new AbortController,a=t.signal?(0,ate.anySignal)([t.signal,o.signal]):o.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:a}),s(e,{signal:a})])}finally{o.abort()}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}has(e){return this.blockstore.has(e)}};var cte=(r,e,t={})=>new Mw(r,e,t);var lte=C(Y(),1);var Uw={};zt(Uw,{abortedError:()=>M7e,notFoundError:()=>ute});var _A=C(Y(),1);function ute(r){return r=r||new Error("Not Found"),(0,_A.default)(r,"ERR_NOT_FOUND")}function M7e(r){return r=r||new Error("Aborted"),(0,_A.default)(r,"ERR_ABORTED")}var qEt={...Uw};var Fw=class extends qo{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){let n=ot(e,async({key:i})=>!await this.has(i));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){let n=Kt({objectMode:!0}),i=Kt({objectMode:!0});Promise.resolve().then(async()=>{for await(let s of e)!await this.has(s)&&this.bitswap.isStarted()?n.push(s):i.push(s);n.end(),i.end()}),yield*fr(this.bitswap.getMany(n,t),this.child.getMany(i,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}};var Z0=class{constructor(e,t,n,i,s){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=i,this.blockstore=s}static async start({peerId:e,repo:t,print:n,hashers:i,options:s}){t.closed&&await t.open();let o=await t.config.getAll(),a=await j2({options:s,repo:t,peerId:e,multiaddrs:U7e(e,o),config:o,keychainConfig:void 0});await a.start();for(let l of a.getMultiaddrs())n(`Swarm listening on ${l.toString()}`);let c=cte(a,t.blocks,{statsEnabled:!0,hashLoader:i,maxInboundStreams:1024,maxOutboundStreams:1024});await c.start();let u=new Fw(t.blocks,c);return t.blocks=u,t.pins.blockstore=u,new Z0(e,a,c,t,u)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}},U7e=(r,e)=>{let t=r.toString(),n=[],i=e.Addresses&&e.Addresses.Swarm||[];for(let s of i){let o=oe(s);if(o.protoCodes().includes(F7e))throw(0,lte.default)(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");let a=o.getPeerId();a&&a!==t&&(o=o.encapsulate(`/p2p/${t}`)),n.push(o)}return n},F7e=479;function fte({network:r}){async function e(t={}){let n=[],{libp2p:i}=await r.use(t);return await i.peerStore.forEach(s=>{n.push({id:s.id,addrs:s.addresses.map(o=>o.multiaddr)})}),n}return H(e)}function dte({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.dial(t,n)}return H(e)}function hte({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.hangUp(t)}return H(e)}function pte({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);return n.getMultiaddrs()}return H(e)}function mte({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);if(t.verbose){let s=[];for(let o of n.getConnections()){let a={addr:o.remoteAddr,peer:o.remotePeer};(t.verbose||t.direction)&&(a.direction=o.stat.direction),t.verbose&&(a.muxer=o.stat.multiplexer,a.latency="n/a",a.streams=[]),s.push(a)}return s}let i=new Map;for(let s of n.getConnections()){let o={addr:s.remoteAddr,peer:s.remotePeer};i.set(s.remotePeer.toString(),o)}return Array.from(i.values())}return H(e)}var Vw=class{constructor({network:e}){this.addrs=fte({network:e}),this.connect=dte({network:e}),this.disconnect=hte({network:e}),this.localAddrs=pte({network:e}),this.peers=mte({network:e})}};var eg={success:!0,time:0,text:""};function gte({network:r}){async function*e(t,n={}){let{libp2p:i}=await r.use();n.count=n.count||10;let s=await i.peerStore.get(t),o=s&&s.id;if(!o){yield{...eg,text:`Looking up peer ${t}`};let u=await i.peerRouting.findPeer(t);o=u&&u.id}if(!o)throw new Error("Peer was not found");yield{...eg,text:`PING ${o.toString()}`};let a=0,c=0;for(let u=0;u<n.count;u++)try{let l=await i.ping(o);c+=l,a++,yield{...eg,time:l}}catch(l){yield{...eg,success:!1,text:l.toString()}}if(a){let u=c/a;yield{...eg,text:`Average latency: ${u}ms`}}}return H(e)}var _c=C(Y(),1);var EA="/ipns/";function yte(r){r.startsWith(EA)&&(r=r.substring(EA.length));let e;if((r[0]==="1"||r[0]==="Q")&&(r=`z${r}`),r[0]==="z"&&(e=Te.decode(r)),r[0]==="k"&&(e=Id.decode(r)),!e)throw new Error("Could not parse string");if(e[0]!==1&&e[1]!==114&&(e=ve([[1,114],e])),e.length!==40)throw new Error("Incorrect length "+e.length);return ve([W(EA),e.subarray(2)])}function wte({network:r,repo:e,peerId:t}){let{get:n,put:i,findProvs:s,findPeer:o,provide:a,query:c}={async*get(u,l={}){let{libp2p:f}=await J0(r,t,l),h=u instanceof Uint8Array?u:yte(u);if(f.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.get(h,l)},async*put(u,l,f){let{libp2p:h}=await J0(r,t,f),d=u instanceof Uint8Array?u:yte(u);if(h.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.put(d,l,f)},async*findProvs(u,l={}){let{libp2p:f}=await J0(r,t,l);if(f.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.findProviders(u,{signal:l.signal})},async*findPeer(u,l={}){let{libp2p:f}=await J0(r,t,l);if(f.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.findPeer(u,{signal:l.signal})},async*provide(u,l={recursive:!1}){let{libp2p:f}=await J0(r,t,l);if(!await e.blocks.has(u))throw(0,_c.default)(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(l.recursive)throw(0,_c.default)(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(f.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.provide(u)},async*query(u,l={}){let{libp2p:f}=await J0(r,t,l),h,d=P.asCID(u);if(d!=null?h=d.multihash.bytes:h=fe(u.toString()).toBytes(),f.dht==null)throw(0,_c.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.getClosestPeers(h,l)}};return{get:H(n),put:H(i),findProvs:H(s),findPeer:H(o),provide:H(a),query:H(c)}}var J0=async(r,e,t)=>{let n=await r.use(t);if(n.libp2p.dht!=null)return n;{let i=async function*(){yield{from:e,name:"QUERY_ERROR",type:3,error:new Ds("dht not enabled")}};return{libp2p:{dht:{get:i,put:i,findProviders:i,findPeer:i,provide:i,getClosestPeers:i}}}}};var bte=C(Y(),1);var _te=C(my(),1);function Ete({network:r,config:e}){let t=(0,_te.default)(e||{},"Pubsub.Enabled",!0),n={},i;return{subscribe:t?H(s):tg,unsubscribe:t?H(o):tg,publish:t?H(a):tg,ls:t?H(c):tg,peers:t?H(u):tg};async function s(l,f,h={}){let{libp2p:d}=await r.use(h);d.pubsub.subscribe(l),i==null&&(i=m=>{let w=m.detail;n[w.topic]&&n[w.topic].forEach(b=>{if(typeof b=="function"){b(w);return}b!=null&&b.handleEvent!=null&&b.handleEvent(w)})},d.pubsub.addEventListener("message",i)),f!=null&&(n[l]==null&&(n[l]=[]),n[l].push(f))}async function o(l,f,h={}){let{libp2p:d}=await r.use(h);f!=null&&n[l]!=null&&(n[l]=n[l].filter(m=>m!==f),n[l].length===0&&delete n[l]),typeof f!="function"&&delete n[l],n[l]==null&&d.pubsub.unsubscribe(l),Object.keys(n).length===0&&(d.pubsub.removeEventListener("message",i),i=void 0)}async function a(l,f,h={}){let{libp2p:d}=await r.use(h);if(!f)throw(0,bte.default)(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await d.pubsub.publish(l,f)}async function c(l={}){let{libp2p:f}=await r.use(l);return f.pubsub.getTopics()}async function u(l,f={}){let{libp2p:h}=await r.use(f);return h.pubsub.getSubscribers(l)}}var tg=async()=>{throw new Ds("pubsub not enabled")};var V7e=Ve.bind({ignoreUndefined:!0}),rl=D("ipfs"),z7e=3e4,vA=class{constructor({print:e,storage:t,codecs:n,options:i}){let{peerId:s,repo:o,keychain:a}=t,c=Dn.create(Z0),u=bF(i.preload),l=fD(),f=dD({network:c}),h=new Ey(i),d=Object.values(Hg);(i.ipld&&i.ipld.hashers?i.ipld.hashers:[]).forEach(G=>d.push(G)),this.hashers=new d0({hashers:d,loadHasher:i.ipld&&i.ipld.loadHasher});let m=Object.values(Xi);(i.ipld&&i.ipld.bases?i.ipld.bases:[]).forEach(G=>m.push(G)),this.bases=new l0({bases:m,loadBase:i.ipld&&i.ipld.loadBase});let w=new S3({repo:o,codecs:n}),b=new ky({codecs:n,hashers:this.hashers,preload:u,repo:o}),v=new xy({dns:l,ipns:h,repo:o,codecs:n,peerId:s,isOnline:f,keychain:a,options:i}),T=mD({repo:o,codecs:n,bases:this.bases,name:v}),p=new b5({repo:o,codecs:n,hashers:this.hashers,preload:u}),g=Object.assign(FL({repo:o,codecs:n,resolve:T,preload:u}),{local:VL({repo:t.repo})}),{add:y,addAll:E,cat:_,get:x,ls:S}=new l5({preload:u,repo:o,options:i.EXPERIMENTAL,hashers:this.hashers}),I=rV({repo:o,preload:u,hashers:this.hashers,options:i}),k=_F({files:I,preload:u,options:i.preload});this.preload=u,this.name=v,this.ipns=h,this.pin=w,this.resolve=T,this.block=b,this.refs=g,this.start=Pk({network:c,peerId:s,repo:o,preload:u,ipns:h,mfsPreload:k,print:e,keychain:a,hashers:this.hashers,options:i}),this.stop=kk({network:c,preload:u,mfsPreload:k,ipns:h,repo:o}),this.dht=wte({network:c,repo:o,peerId:s}),this.pubsub=Ete({network:c,config:i.config}),this.dns=l,this.isOnline=f,this.id=GU({network:c,peerId:s}),this.version=qU({repo:o}),this.bitswap=new Ay({network:c}),this.bootstrap=new Ry({repo:o}),this.config=WU({repo:o}),this.ping=gte({network:c}),this.add=y,this.addAll=E,this.cat=_,this.get=x,this.ls=S,this.dag=p,this.files=I,this.key=new R5({keychain:a}),this.object=new P5({preload:u,codecs:n,repo:o}),this.repo=new D5({repo:o,hashers:this.hashers}),this.stats=new N5({repo:o,network:c}),this.swarm=new Vw({network:c}),Object.defineProperty(this,"libp2p",{get(){let G=c.try();return G?G.libp2p:void 0}});let N=()=>Promise.reject((0,zw.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),L=async function*(){throw(0,zw.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=N,this.diag={cmds:N,net:N,sys:N},this.log={level:N,ls:N,tail:L},this.mount=N,this.codecs=n}async init(){throw new ks}},K7e=async r=>{let e=ze({Data:new He({type:"directory"}).marshal(),Links:[]}),t=await r.block.put(e,{mhtype:"sha2-256",format:"dag-pb"});return await r.pin.add(t),t},H7e=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!vte.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function xte(r={}){r=V7e(H7e(),r);let e=r.init||{},t={name:Hr.name,code:Hr.code,encode:u=>u,decode:u=>u},n=Object.values($g);[mt,_a,Ad,vp,t].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>n.push(u));let i=new f0({codecs:n,loadCodec:r.ipld&&r.ipld.loadCodec}),s=r.silent?rl:console.log;rl("creating repo");let o=await X0.start(s,i,r);rl("getting repo config");let a=await o.repo.config.getAll(),c=new vA({storage:o,print:s,codecs:i,options:{...r,config:a}});if(rl("starting preload"),await c.preload.start(),rl("starting storage"),c.ipns.startOffline(o),o.isNew&&!e.emptyRepo){let u=await K7e(c);if(rl("adding default assets"),await(c.addAll,void 0),rl("initializing IPNS keyspace"),o.peerId.publicKey==null)throw(0,zw.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");let l=new Ste.TimeoutController(z7e);try{await c.ipns.initializeKeyspace(o.peerId,W(`/ipfs/${u}`),{signal:l.signal})}finally{l.clear()}}return r.start!==!1&&(rl("starting node"),await c.start()),c}var $7e=C(zS(),1),Tte=xte;var Ate=(()=>({toString:function(r){return r.toV1().toString()},fromString:function(r){return P.parse(r)}}))();var Kw=(()=>{let r;return{init:async()=>{r||(r=await Tte({repo:String(Math.random()+Date.now())}))},store:async function(e,t){await this.init();let n={path:e,content:t},i=await r.add(n),{cid:s}=i;return Ate.toString(s)},retrieve:async function(e){await this.init();let t=new TextDecoder,n="";for await(let i of r.cat(e))n+=t.decode(i,{stream:!0});return n}}})();var q7e=()=>{let r=xe.get("gistId");return xe.get("authToken")?r?"Sync: Notes with my GitHub Gist":"Sync: Pick your Gist to sync with":"Sync: Authorize your GitHub account for synchronisation"},G7e={title:"Share note",icon:Zt(h7,"share note"),sortTitle:"Share",call:NI},j7e={title:"Share public link",key:null,icon:Zt(h7,"share public link"),sortTitle:"Share public link",call:async()=>{lt.hide(),await sp(Z(".terminal").getValue());let r=Dr(),t=(await NA({note:r})).history[0].url,n=await fetch(t).then(l=>l.json()),{files:i}=n,s=Object.values(i),[o]=s,{raw_url:a}=o,c=`${je.baseUrl}?raw=${a}`;ha(c,"MiroPad public link copied to clipboard \u{1F4CB}!")}},SA=()=>[{title:"New note",icon:Zt(kI,"new note"),sortTitle:"New",key:"n",call:dg},{title:"Save",key:"s",icon:Zt(mI,"save"),sortTitle:"Save",call:async()=>{lt.hide(),await sp(Z(".terminal").getValue());let r=Dr(),{disableSync:e=!1}=r;e||Yw([r]),fa()}},...navigator.share?[G7e]:[],{title:"Toggle MarkDown Viewer",icon:Zt(xI,"toggle markdown viewer","rotate90"),sortTitle:"Split",key:"m",call:()=>{ud.toggle(),lt.hide()}},{title:"Full MarkDown view",icon:Zt(TI,"full view"),sortTitle:"Full view",key:"shift m",call:()=>{ud.toggle("full"),lt.hide()}},{title:"Save to IPFS",key:"i",icon:Zt(CI,"save"),sortTitle:"save->ipfs",call:async()=>{lt.hide(),await sp(Z(".terminal").getValue());let r=Dr(),{disableSync:e=!1}=r;if(e||Yw([r]),r){let t=await Kw.store(r.title,r.text);ha(`${je.baseUrl}#?cid=${t}`)}}},...ZA()?[j7e]:[],{title:"Zen mode",icon:Zt(DI,"zen mode"),sortTitle:"Zen mode",key:"shift z",call:()=>{Boolean(je.getSearchParam("zen"))?je.deleteParam("zen"):je.set(void 0,{zen:!0}),lt.hide()}},{title:"List saved notes",icon:Zt(pI,"list notes"),sortTitle:"Notes",key:"p",call:()=>lt.toggle(lt.getModes().notes)},{title:"Delete note",key:"shift d",icon:Zt(ap,"delete note"),sortTitle:"Delete",call:hg},{title:q7e(),icon:Zt(gI,"sync with github"),key:null,call:async()=>{let r=xe.get("authToken");if(!r)return await rI();if(!xe.get("gistId"))return await nI(r);lt.hide(),await op()}},{title:"Sync: Reset Gist settings",icon:Zt(yI,"reset github settings"),key:null,call:async()=>{localStorage.removeItem("authToken"),localStorage.removeItem("gistId"),localStorage.removeItem("lastLocalUpdate"),localStorage.removeItem("lastSync"),Ce.info("Gist setting have been reset!"),lt.hide()}},{title:"Toggle sidebar",experimental:!0,key:"shift l",call:()=>{Z("aside").toggle()}},{title:"Save to File System...",experimental:!0,icon:Zt(wI,"save file"),key:"shift s",call:async()=>{let{text:r,title:e}=Dr();sI(r,e),lt.hide()}},{title:"Email note to...",experimental:!0,icon:Zt(_I,"email"),key:"e",call:()=>{let r=document.querySelector(".terminal").value;fI(r),lt.hide()}},{title:"Toggle experimental features",experimental:!1,icon:Zt(EI,"lab"),key:null,call:()=>{let r=Boolean(xe.get("__experimental__"));r?xe.remove("__experimental__"):xe.set("__experimental__",!0),Ce.showNotification(`Experimental features turned ${r?"off":"on"}`),lt.hide()}},{title:"Toggle Autocompletion",experimental:!1,icon:Zt(AI,"autocompletion"),key:null,call:()=>{let r=Boolean(xe.get("__autocomplete__"));r?xe.remove("__autocomplete__"):xe.set("__autocomplete__",!0),Ce.showNotification(`Autocomplete feature turned ${r?"off":"on"}`),lt.hide(),Z(".terminal").focus()}},{title:"Add a cover picture",experimental:!0,icon:Zt(vI,"cover picture"),key:null,call:async()=>{let r=prompt("Paste the image URL in here...");lt.hide(),await hI(200),ha(`<div class="cover" style="background-image: url('${r}')"></div>`,"\u{1F44C}Copied! Paste the code on the MiroPad editor"),Z(".terminal").focus(),Ce.info("Paste the cover picture wherever you prefer on the MirPad editor")}},{title:"Print MarkDown output",experimental:!0,icon:Zt(SI,"print"),key:null,call:()=>{Z(".preview").show(),ud.init(),window.print(),lt.hide()}},{key:"j",title:"Prettify JSON document",icon:Zt(II,"prettify json"),call:()=>{dI(".terminal"),lt.hide()}},{title:"Toggle command palette",icon:Zt(RI,"toggle command palette"),key:["shift p","k"],call:()=>lt.toggle(lt.getModes().commands)},{title:"Find and Replace...",experimental:!0,icon:Zt(PI,"find and replace"),key:"shift f",call:()=>{let r=Z(".terminal").getValue().slice(Z(".terminal").el.selectionStart,Z(".terminal").el.selectionEnd),e=prompt("What do you wanna find?",r);if(!e)return Ce.info("Value not found");let t=Z(".terminal").getValue().indexOf(e);Z(".terminal").el.setSelectionRange(t,t+e.length);let n=prompt(`Replace ${e} with...`);n&&Z(".terminal").el.setRangeText(n)}},{title:"Download all notes!",icon:Zt(bI,"Download all notes on your local file system"),call:()=>{let r=la({includeDeleted:!0});oI(r),lt.hide()}},{title:"Permanently delete ALL notes \u2757",icon:Zt(ap,"delete note"),call:()=>{confirm("Are you sure you want do delete ALL your notes?")&&(la({includeDeleted:!0}).forEach(t=>{xe.remove(t.id)}),dg()),lt.hide()}}];var W7e={events:[],on(r,e){return Array.isArray(r)?(r.forEach(t=>{let n=t.key||t,i=t.call||e;this.on(n,i)}),this):(r&&typeof r=="string"&&e&&typeof e=="function"&&(this.events=[...this.events,{key:r.includes("shift")?r.replace("shift","").trim():r,shift:r.includes("shift"),fn(){e()}}]),this)},listen(){return document.addEventListener("keydown",r=>{this.handleEvent(r)}),this},handleEvent(r){this.events.map(e=>(e.key===r.key&&(r.ctrlKey===!0||r.metaKey===!0)&&r.shiftKey===e.shift&&(r.preventDefault(),e.fn()),!0))}},Ite=W7e;var Rte=(r,e)=>{let t=document.createElement("a");return t.href=e,t.appendChild(nd(r)?r:document.createTextNode(r)),t};var xA=(r,e=new Date)=>{let t=new Date(r).getFullYear(),n=new Date(e).getFullYear();return t===n},kte=(r,e=new Date)=>{let t=new Date(r).getMonth(),n=new Date(e).getMonth();return t===n},Y7e=(r,e=new Date)=>{let t=new Date(r).getDate(),n=new Date(e).getDate();return t===n},Cte=(r,e=new Date)=>xA(r,e)&&kte(r,e)&&Y7e(r,e),Q7e=["January","February","March","April","May","June","July","August","September","October","November","December"],X7e=Q7e.map(r=>r.slice(0,3)),Pte=(r=new Date)=>{let e=new Date(r),t=new Date().getDate()-1;return kte(e)&&xA(e)&&e.getDate()===t},rg=r=>{let e=new Date(r),t=Pte(r)?"":X7e[e.getMonth()],n=xA(e)?"":e.getFullYear(),i=Pte(e)?"Yesterday":e.getDate();return`${Cte(e)?"":`${i} ${t} ${n}`} ${Cte(e)?e.toLocaleTimeString():""}`};var Dte=r=>r.reduce((t,n)=>{if(t.length===0)return[n];let i=Math.max(...t);return[...t,...n>=i?[n]:[]]},[]).length===r.length;var TA=(r,e)=>{let t=r.split(" ").map(s=>s.toLowerCase()),i=e.split(" ").map(s=>s.toLowerCase()).map(s=>t.map((c,u)=>c.includes(s)?u:-1).reduce((c,u)=>u>-1?u:c,-1));return i.includes(-1)?!1:Dte(i)};var Nte=async()=>{if(!xe.get("__notification-permission__")){let r=await window.Notification.requestPermission();xe.set("__notification-permission__",r)}},Ote=async()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(`${window.location.pathname}service-worker.js?v=2.13.24`)};var Lte=r=>Array.isArray(r)?r.map(e=>Lte(e)).join(", "):r?`\u2318+${r.toUpperCase()}`:"",Z7e=(()=>{let r={off:"off",notes:"notes",revisions:"revisions",commands:"commands",gists:"gists"},e={input:"",mode:r.off,options:{selected:0,length:0}};return{getState:function(){return e},getModes:function(){return r},setState:function(t){return e={...e,...t},e},show:function(t=r.commands){switch(Z("#commander").show(),Z("#commander input").focus(),t){case r.commands:this.generateCommands(),Z("#commander input").setValue("> "),this.setState({mode:r.commands});break;case r.notes:this.generateNotes(),Z("#commander input").setValue(""),this.setState({mode:r.notes});break;case r.revisions:this.generateRevisions(),Z("#commander input").setValue(""),this.setState({mode:r.revisions});break;default:break}return this},hide:function(){return Z("#commander").hide(),e.mode=r.off,this},toggle:function(t){return Nte(),e.mode===r.off||e.mode!==t?this.show(t):this.hide(),this},commands:function(){return SA()},selectOption:function(t,n){let i=e.options.selected,s=e.options.length-1,u=n==="down"?i===s?0:i+1:i===0?s:i-1;e.options={...e.options,selected:u}},initCommander:function(){return SA().slice(0,5).map(t=>{Z(".mobile-dock").append(gg([t.icon,document.createTextNode(t.sortTitle)],t.call,t.title.toLowerCase().replace(/\s/g,"-")))}),Z("#commander button").listen("click",()=>{this.hide()}),Z("#commander input").listen("keydown",t=>{t.keyCode===40&&(e.mode===r.revisions&&Z("#commands li.selected").click(),this.selectOption(t,"down")),t.keyCode===38&&(e.mode===r.revisions&&Z("#commands li.selected").click(),this.selectOption(t,"up"))}).listen("keyup",t=>{t.keyCode===13&&(e.mode===r.commands?Z("#commands li.selected div").click():Z("#commands li.selected a").click()),t.keyCode===27&&Z(".terminal").focus(),e.input!==t.target.value&&(e.options.selected=0),e.input=t.target.value,this.generateOptions(t.target.value)}),this},init:function(){return this.initCommander(),Ite.listen().on(this.commands()),Z(".menu").listen("click",()=>this.toggle()),Z("#revisions").listen("click",()=>this.generateRevisions()),this},generateRevisions:function(){this.show(),e.mode=r.revisions;let{revisions:t}=Dr(),n=e.options.selected,i=Object.keys(t).sort((s,o)=>{let{dateCreated:a}=t[s],{dateCreated:c}=t[o];return c-a}).map((s,o)=>({title:da({content:`...${s.slice(-10)}`}),secondary:`${rg(t[s].dateCreated)}`,onclick:()=>{je.set(void 0,{v:s}),e.options.selected=o,this.generateRevisions()}})).map((s,o)=>xc(s,o===n));return Z("#commands").html(i),e.options={...e.options,length:i.length},this},generateOptions:function(t){switch(e.mode){case r.commands:case r.notes:t.slice(0,1)===">"?(e.mode=r.commands,this.generateCommands(t.slice(1).trim()),Z("#commander input").placeholder("Search for commands...")):(e.mode=r.notes,this.generateNotes(t));return;case r.revisions:return this.generateRevisions();case r.off:break;default:break}},generateNotes:function(t=""){let n=e.options.selected,i=la().filter(({title:s})=>TA(s,t)).filter(({id:s,deleted:o})=>!o&&s!==je.getPageId()).sort((s,o)=>{let a=lg(s.title);return lg(o.title)-a}).map(({id:s,title:o,cid:a},c)=>{let u=lg(o),l=a?`?cid=${a}`:"",f=`${window.location.origin}${window.location.pathname}#${s}${l}`,h=Rte(da({content:o,highlight:t}),f);return xc({title:h,secondary:rg(u),onclick:()=>{this.hide(),Z(".terminal").focus()}},c===n)});return Z("#commands").html(i),Z("#commander input").placeholder(`Search from ${i.length} saved notes...`),e.options={...e.options,length:i.length},this},generateCommands:async function(t=""){let n=e.options.selected,i=this.commands().filter(({title:s})=>TA(s,t)).filter(({experimental:s=!1})=>xe.get("__experimental__")?!0:!s).map(({title:s,key:o,call:a,icon:c},u)=>xc({title:da({content:s,highlight:t}),icon:c,secondary:Lte(o),onclick:a},u===n));return Z("#commands").html(i),e.options={...e.options,length:i.length},this}}})(),lt=Z7e;var Mte=C(Bte());var J7e=(r,e)=>r[e]===void 0||r[e].trim()==="",ebe=r=>{let e=(0,Mte.default)(r,r.selectionEnd),{top:t,left:n}=e,i=Z(".terminal").el.scrollHeight,s=Z("main").el;s.style.height=`${i}px`,Z(".suggestion").el.style.top=`${t}px`,Z(".suggestion").el.style.left=`${n}px`},tbe=(r,e)=>{let t="",n=e-1;do{let i=r[n]||"";n=i.trim()===""?-1:n-1,t=i.trim()!==""?`${i}${t}`:t}while(n>=0);return t},rbe=r=>{let e=r.replace(/[\r\n\t]+/g,"").toLowerCase();return $w.getMatchingWords(e)},Qt=(()=>{let r={matches:[],currentWord:null,prediction:null,options:{selected:0,length:0}},e=r;return{el:Z(".terminal"),setState:function(t){return e={...e,...t},e},resetState:function(){Qt.setState(r)},selectOption:function(t,n){let i=e.options.selected,s=e.options.length-1,u=n==="down"?i===s?0:i+1:i===0?s:i-1;e.options={...e.options,selected:u},Qt.setState({prediction:e.matches[e.options.selected]}),Qt.renderInlineSuggestion(),Qt.renderOptions()},acceptCompletion:t=>{let n=(o,a)=>{let c=o.replace(a.toLowerCase(),"");c?Z(".terminal").insertAtCaret(`${c} `):Z(".terminal").insertAtCaret("  "),Z(".suggestion").hide(),Qt.resetState()},{prediction:i,currentWord:s}=e;if(t)return n(t,s);i&&(n(i,s),$w.insert(i))},renderInlineSuggestion:()=>{let{prediction:t,currentWord:n}=e,i=da({content:`${t.slice(n.length)}`});i.setAttribute("id","inlineSuggestion"),Z(".suggestion").show().html(i)},renderOptions:()=>{let t=Z(".suggestion .options");t&&t.el&&t.el.remove();let n=e.options.selected,i=e.matches.map((o,a)=>xc({title:da({content:o}),secondary:Zt(ap,"delete word"),onSecondaryClick:()=>{xe.removeFromDictionary(o),Qt.setState({matches:e.matches.filter(c=>c!==o)}),Qt.renderOptions()},onclick:()=>{Qt.acceptCompletion(o)}},a===n)),s=document.createElement("ul");s.classList.add("options"),s.classList.add("frost"),i.forEach(o=>s.append(o)),Z(".suggestion").el.append(s)},onFocus:()=>{lt.hide(),Z(".note-info").hide()},onInput:t=>{if(!!!xe.get("__autocomplete__"))return;let i=t.target.selectionEnd,s=Qt.el.getValue(),o=s[i-1];if(t.inputType==="deleteContentBackward"||o===" ")return Qt.setState({prediction:r.prediction,currentWord:r.currentWord}),Z(".suggestion").hide();if(t.inputType==="insertText"&&J7e(s,i)){ebe(t.target);let c=tbe(s,i),u=rbe(c),[l]=u,f=l||"";Qt.setState({prediction:f,currentWord:c,matches:u,options:{selected:0,length:u.length}}),e.currentWord.length>1&&e.prediction?(Qt.renderInlineSuggestion(),Qt.renderOptions()):Z(".suggestion").hide()}},onArrowDown:t=>{e.matches.length>0&&(t.preventDefault(),Qt.selectOption(t,"down"))},onArrowUp:t=>{e.matches.length>0&&(t.preventDefault(),Qt.selectOption(t,"up"))},onEnter:t=>{e.matches.length>0&&(t.preventDefault(),Qt.acceptCompletion())},onEscape:()=>{Qt.resetState(),Z(".suggestion").hide()},onTab:t=>{t.preventDefault(),Qt.acceptCompletion()},onKeyDown:t=>{t.keyCode===13&&Qt.onEnter(t),t.keyCode===40&&Qt.onArrowDown(t),t.keyCode===38&&Qt.onArrowUp(t),t.keyCode===9&&Qt.onTab(t),t.keyCode===32&&Qt.setState({prediction:""}),t.keyCode===27&&Qt.onEscape(t)},onKeyUp:t=>{let n=Dr(),i=cd(t.target.value);Z(".title h3").html(i);let{text:s=""}=n||{},o=n&&Qt.el.getValue()===s;fa(o)},init:function(){this.el.listen("focus",this.onFocus).listen("input",this.onInput).listen("keydown",this.onKeyDown).listen("keyup",this.onKeyUp)}}})();var Ute=()=>{let{authToken:r,gistId:e}=xe.get(["authToken","gistId"]);return!!(r&&e)};var nbe=r=>Object.entries(r).reduce((e,[t,n])=>{let i=e[n]||[];return{...e,[n]:[t,...i]}},{}),Fte=()=>({char:null,children:{},frequency:0,hasChildren:function(){return Object.keys(this.children).length>0},isWord:function(){return this.frequency>0},contains:function(r){return Object.keys(this.children).includes(r)},getWords:function(r,e={}){let t=this;if(t.isWord()&&(e={...e,[r]:this.frequency}),t.hasChildren())for(let n of Object.values(t.children))e=n.getWords(`${r}${n.char}`,e);return e},increaseFrequency:function(){this.frequency=this.frequency+1},insert:function(r){let[e,...t]=r;if(e){let n=t.length===0;if(this.contains(e)){let i=this.children[e];return i.char=e,n&&i.increaseFrequency(),i.insert(t)}else return this.insertNode(e,n).insert(t)}},insertNode:function(r,e=!1){let t=Fte();return e&&t.increaseFrequency(),t.char=r,this.children={...this.children,[r]:t},t}}),Vte=()=>{let r=Fte();return{insert:function(e=[]){return(Array.isArray(e)?e:[e]).forEach(n=>r.insert(n)),this},search:function(e=""){let t=r;return e.split("").forEach(n=>{t&&(t=t.children[n])}),t?t.getWords(e):{}},getMatchingWords:function(e=""){let t=nbe(this.search(e));return Object.keys(t).sort((n,i)=>parseInt(i,10)-parseInt(n,10)).flatMap(n=>t[n].sort())}}};var ibe=r=>{let{message:e="Unexpected error occurred!"}=r;Ce.error(e)},zte=ibe;var Kte=async r=>{Z(".anchor").show(),Z("#logo").addClass("loading");let e=await Kw.retrieve(r);Z("#logo").removeClass("loading"),fa(!1),Z(".terminal").setValue(e)};var sbe=async r=>{if(r){let e=await fetch(r).then(t=>{if(t.ok)return t.text();throw new Error(`Remote note could not be retrieved! code: ${t.status}`)});Z(".terminal").setValue(e)}},obe=async r=>{if(r)try{let e=await sg(r),{files:t}=e,n=Object.values(t),[i]=n,{content:s}=i;Z(".terminal").setValue(s)}catch{Ce.error("MiroPad note not found! \u{1F937}\u200D\u2642\uFE0F")}},AA=async(r={})=>{try{let{oldURL:i,newURL:s}=r,o=je.getPageId(i),a=je.getPageId(s),c=o!==a,{v:u}=je.getParamsObject(i),{v:l}=je.getParamsObject(s);[c,u!==l].some(w=>w)&&fg();let{gistId:d,raw:m}=je.getParamsObject(s);await obe(d),await sbe(m)}catch(i){Ce.error(i.message)}let e=!je.getPageId();Z("#note-info-button").show(!e),Z("#new-note").disable(e),je.getSearchParam("md")==="full"?Z(".terminal").hide():Z(".terminal").show(),je.getSearchParam("zen")==="true"?Z(".header").hide():Z(".header").show(),je.getSearchParam("cid")?await Kte(je.getSearchParam("cid")):Z(".anchor").hide(),Z(".note-info").hide();let t=je.getSearchParam("q"),n=XA(t);n&&Z(".terminal").setValue(n.text)};var abe=()=>"production"==="development",Hte=()=>{abe()&&new EventSource("/esbuild").addEventListener("change",()=>location.reload())};var $w=Vte(),cbe=()=>{Z("#note-info-close").listen("click",()=>{Z(".note-info").hide()}),Z("#note-info-button").listen("click",()=>{let r=Dr();if(Z(".note-info").show(),Z(".note-info .details").innerHTML(`<p>
      <label>
      Title
      </label>
      ${r.title}
      </p>
      <p>
        <label>
        Modified
        </label>
        ${rg(r.dateCreated)}
      </p>
      <p>
        <label>
        No. of revisions
        </label>
        ${r.numberOfRevisions}
      </p>
      `),Ute()&&r){let n=(()=>{let{disableSync:i}=r,s=document.createElement("P");return s.innerHTML=`
          <label>Sync</label>
            <label class="switch" title="Cloud Sync">
              <input id="sync" type="checkbox" ${!i&&"checked"}>
            <span class="slider round"></span>
          </label>
        `,s})();Z(".note-info .details").append(n),Z("#sync").listen("click",i=>{WA(!i.target.checked)})}let t=(()=>{let n=document.createElement("P");return n.innerHTML=`
          <button
            class="icon-button"
            type="button"
            id="delete-note"
          >
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="-3 -3 27.5 27.5">
              <path  d="M15.5 2h-3.5v-0.5c0-0.827-0.673-1.5-1.5-1.5h-2c-0.827 0-1.5 0.673-1.5 1.5v0.5h-3.5c-0.827 0-1.5 0.673-1.5 1.5v1c0 0.652 0.418 1.208 1 1.414v12.586c0 0.827 0.673 1.5 1.5 1.5h10c0.827 0 1.5-0.673 1.5-1.5v-12.586c0.582-0.206 1-0.762 1-1.414v-1c0-0.827-0.673-1.5-1.5-1.5zM8 1.5c0-0.276 0.224-0.5 0.5-0.5h2c0.276 0 0.5 0.224 0.5 0.5v0.5h-3v-0.5zM14.5 19h-10c-0.276 0-0.5-0.224-0.5-0.5v-12.5h11v12.5c0 0.276-0.224 0.5-0.5 0.5zM16 4.5c0 0.276-0.224 0.5-0.5 0.5h-12c-0.276 0-0.5-0.224-0.5-0.5v-1c0-0.276 0.224-0.5 0.5-0.5h12c0.276 0 0.5 0.224 0.5 0.5v1z"></path>
              <path  d="M12.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M9.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M6.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
            </svg>
            Delete
          </button>
        `,n})();Z(".note-info .details").append(t),Z("#delete-note").listen("click",()=>{hg()})})},ube=async()=>{let r=xe.getDictionary();$w.insert(r),window.addEventListener("error",zte),RA(),lt.init(),cbe(),Qt.init(),ug(),fg(je.getPageId()),Z(".logo").listen("click",()=>{lt.toggle(lt.getModes().notes)}),Z("#permalink").listen("click",async()=>{await ha(je.get())}),ud.init(),window.addEventListener("hashchange",AA),AA(),Ote(),await op(),await iI(),Hte()},$te=ube;$te();})();
/*! Bundled license information:

showdown/dist/showdown.js:
  (*! showdown v 2.1.0 - 21-04-2022 *)

bytes/index.js:
  (*!
   * bytes
   * Copyright(c) 2012-2014 TJ Holowaychuk
   * Copyright(c) 2015 Jed Watson
   * MIT Licensed
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=index.js.map
