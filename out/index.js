(()=>{var r3e=Object.create;var h6=Object.defineProperty;var n3e=Object.getOwnPropertyDescriptor;var i3e=Object.getOwnPropertyNames;var o3e=Object.getPrototypeOf,s3e=Object.prototype.hasOwnProperty;var a3e=(r,e,t)=>e in r?h6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var k0=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),xe=(r,e)=>{for(var t in e)h6(r,t,{get:e[t],enumerable:!0})},c3e=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of i3e(e))!s3e.call(r,i)&&i!==t&&h6(r,i,{get:()=>e[i],enumerable:!(n=n3e(e,i))||n.enumerable});return r};var C=(r,e,t)=>(t=r!=null?r3e(o3e(r)):{},c3e(e||!r||!r.__esModule?h6(t,"default",{value:r,enumerable:!0}):t,r));var B=(r,e,t)=>(a3e(r,typeof e!="symbol"?e+"":e,t),t),XS=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var ge=(r,e,t)=>(XS(r,e,"read from private field"),t?t.call(r):e.get(r)),bt=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Dt=(r,e,t,n)=>(XS(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),uh=(r,e,t,n)=>({set _(i){Dt(r,e,i,t)},get _(){return ge(r,e,n)}}),hi=(r,e,t)=>(XS(r,e,"access private method"),t);var bF=P((wF,x6)=>{(function(){function r(m){"use strict";var y={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `\xAB\xAB\xAB` and `\xBB\xBB\xBB` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(m===!1)return JSON.parse(JSON.stringify(y));var b={};for(var E in y)y.hasOwnProperty(E)&&(b[E]=y[E].defaultValue);return b}function e(){"use strict";var m=r(!0),y={};for(var b in m)m.hasOwnProperty(b)&&(y[b]=!0);return y}var t={},n={},i={},o=r(!0),s="vanilla",a={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:r(!0),allOn:e()};t.helper={},t.extensions={},t.setOption=function(m,y){"use strict";return o[m]=y,this},t.getOption=function(m){"use strict";return o[m]},t.getOptions=function(){"use strict";return o},t.resetOptions=function(){"use strict";o=r(!0)},t.setFlavor=function(m){"use strict";if(!a.hasOwnProperty(m))throw Error(m+" flavor was not found");t.resetOptions();var y=a[m];s=m;for(var b in y)y.hasOwnProperty(b)&&(o[b]=y[b])},t.getFlavor=function(){"use strict";return s},t.getFlavorOptions=function(m){"use strict";if(a.hasOwnProperty(m))return a[m]},t.getDefaultOptions=function(m){"use strict";return r(m)},t.subParser=function(m,y){"use strict";if(t.helper.isString(m))if(typeof y<"u")n[m]=y;else{if(n.hasOwnProperty(m))return n[m];throw Error("SubParser named "+m+" not registered!")}},t.extension=function(m,y){"use strict";if(!t.helper.isString(m))throw Error("Extension 'name' must be a string");if(m=t.helper.stdExtName(m),t.helper.isUndefined(y)){if(!i.hasOwnProperty(m))throw Error("Extension named "+m+" is not registered!");return i[m]}else{typeof y=="function"&&(y=y()),t.helper.isArray(y)||(y=[y]);var b=c(y,m);if(b.valid)i[m]=y;else throw Error(b.error)}},t.getAllExtensions=function(){"use strict";return i},t.removeExtension=function(m){"use strict";delete i[m]},t.resetExtensions=function(){"use strict";i={}};function c(m,y){"use strict";var b=y?"Error in "+y+" extension->":"Error in unnamed extension",E={valid:!0,error:""};t.helper.isArray(m)||(m=[m]);for(var v=0;v<m.length;++v){var S=b+" sub-extension "+v+": ",A=m[v];if(typeof A!="object")return E.valid=!1,E.error=S+"must be an object, but "+typeof A+" given",E;if(!t.helper.isString(A.type))return E.valid=!1,E.error=S+'property "type" must be a string, but '+typeof A.type+" given",E;var I=A.type=A.type.toLowerCase();if(I==="language"&&(I=A.type="lang"),I==="html"&&(I=A.type="output"),I!=="lang"&&I!=="output"&&I!=="listener")return E.valid=!1,E.error=S+"type "+I+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',E;if(I==="listener"){if(t.helper.isUndefined(A.listeners))return E.valid=!1,E.error=S+'. Extensions of type "listener" must have a property called "listeners"',E}else if(t.helper.isUndefined(A.filter)&&t.helper.isUndefined(A.regex))return E.valid=!1,E.error=S+I+' extensions must define either a "regex" property or a "filter" method',E;if(A.listeners){if(typeof A.listeners!="object")return E.valid=!1,E.error=S+'"listeners" property must be an object but '+typeof A.listeners+" given",E;for(var k in A.listeners)if(A.listeners.hasOwnProperty(k)&&typeof A.listeners[k]!="function")return E.valid=!1,E.error=S+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+k+" must be a function but "+typeof A.listeners[k]+" given",E}if(A.filter){if(typeof A.filter!="function")return E.valid=!1,E.error=S+'"filter" must be a function, but '+typeof A.filter+" given",E}else if(A.regex){if(t.helper.isString(A.regex)&&(A.regex=new RegExp(A.regex,"g")),!(A.regex instanceof RegExp))return E.valid=!1,E.error=S+'"regex" property must either be a string or a RegExp object, but '+typeof A.regex+" given",E;if(t.helper.isUndefined(A.replace))return E.valid=!1,E.error=S+'"regex" extensions must implement a replace string or function',E}}return E}t.validateExtension=function(m){"use strict";var y=c(m,null);return y.valid?!0:(console.warn(y.error),!1)},t.hasOwnProperty("helper")||(t.helper={}),t.helper.isString=function(m){"use strict";return typeof m=="string"||m instanceof String},t.helper.isFunction=function(m){"use strict";var y={};return m&&y.toString.call(m)==="[object Function]"},t.helper.isArray=function(m){"use strict";return Array.isArray(m)},t.helper.isUndefined=function(m){"use strict";return typeof m>"u"},t.helper.forEach=function(m,y){"use strict";if(t.helper.isUndefined(m))throw new Error("obj param is required");if(t.helper.isUndefined(y))throw new Error("callback param is required");if(!t.helper.isFunction(y))throw new Error("callback param must be a function/closure");if(typeof m.forEach=="function")m.forEach(y);else if(t.helper.isArray(m))for(var b=0;b<m.length;b++)y(m[b],b,m);else if(typeof m=="object")for(var E in m)m.hasOwnProperty(E)&&y(m[E],E,m);else throw new Error("obj does not seem to be an array or an iterable object")},t.helper.stdExtName=function(m){"use strict";return m.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function u(m,y){"use strict";var b=y.charCodeAt(0);return"\xA8E"+b+"E"}t.helper.escapeCharactersCallback=u,t.helper.escapeCharacters=function(m,y,b){"use strict";var E="(["+y.replace(/([\[\]\\])/g,"\\$1")+"])";b&&(E="\\\\"+E);var v=new RegExp(E,"g");return m=m.replace(v,u),m},t.helper.unescapeHTMLEntities=function(m){"use strict";return m.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var l=function(m,y,b,E){"use strict";var v=E||"",S=v.indexOf("g")>-1,A=new RegExp(y+"|"+b,"g"+v.replace(/g/g,"")),I=new RegExp(y,v.replace(/g/g,"")),k=[],N,O,G,R,K;do for(N=0;G=A.exec(m);)if(I.test(G[0]))N++||(O=A.lastIndex,R=O-G[0].length);else if(N&&!--N){K=G.index+G[0].length;var U={left:{start:R,end:O},match:{start:O,end:G.index},right:{start:G.index,end:K},wholeMatch:{start:R,end:K}};if(k.push(U),!S)return k}while(N&&(A.lastIndex=O));return k};t.helper.matchRecursiveRegExp=function(m,y,b,E){"use strict";for(var v=l(m,y,b,E),S=[],A=0;A<v.length;++A)S.push([m.slice(v[A].wholeMatch.start,v[A].wholeMatch.end),m.slice(v[A].match.start,v[A].match.end),m.slice(v[A].left.start,v[A].left.end),m.slice(v[A].right.start,v[A].right.end)]);return S},t.helper.replaceRecursiveRegExp=function(m,y,b,E,v){"use strict";if(!t.helper.isFunction(y)){var S=y;y=function(){return S}}var A=l(m,b,E,v),I=m,k=A.length;if(k>0){var N=[];A[0].wholeMatch.start!==0&&N.push(m.slice(0,A[0].wholeMatch.start));for(var O=0;O<k;++O)N.push(y(m.slice(A[O].wholeMatch.start,A[O].wholeMatch.end),m.slice(A[O].match.start,A[O].match.end),m.slice(A[O].left.start,A[O].left.end),m.slice(A[O].right.start,A[O].right.end))),O<k-1&&N.push(m.slice(A[O].wholeMatch.end,A[O+1].wholeMatch.start));A[k-1].wholeMatch.end<m.length&&N.push(m.slice(A[k-1].wholeMatch.end)),I=N.join("")}return I},t.helper.regexIndexOf=function(m,y,b){"use strict";if(!t.helper.isString(m))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(y instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var E=m.substring(b||0).search(y);return E>=0?E+(b||0):E},t.helper.splitAtIndex=function(m,y){"use strict";if(!t.helper.isString(m))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[m.substring(0,y),m.substring(y)]},t.helper.encodeEmailAddress=function(m){"use strict";var y=[function(b){return"&#"+b.charCodeAt(0)+";"},function(b){return"&#x"+b.charCodeAt(0).toString(16)+";"},function(b){return b}];return m=m.replace(/./g,function(b){if(b==="@")b=y[Math.floor(Math.random()*2)](b);else{var E=Math.random();b=E>.9?y[2](b):E>.45?y[1](b):y[0](b)}return b}),m},t.helper.padEnd=function(y,b,E){"use strict";return b=b>>0,E=String(E||" "),y.length>b?String(y):(b=b-y.length,b>E.length&&(E+=E.repeat(b/E.length)),String(y)+E.slice(0,b))},typeof console>"u"&&(console={warn:function(m){"use strict";alert(m)},log:function(m){"use strict";alert(m)},error:function(m){"use strict";throw m}}),t.helper.regexes={asteriskDashAndColon:/([*_:~])/g},t.helper.emojis={"+1":"\u{1F44D}","-1":"\u{1F44E}",100:"\u{1F4AF}",1234:"\u{1F522}","1st_place_medal":"\u{1F947}","2nd_place_medal":"\u{1F948}","3rd_place_medal":"\u{1F949}","8ball":"\u{1F3B1}",a:"\u{1F170}\uFE0F",ab:"\u{1F18E}",abc:"\u{1F524}",abcd:"\u{1F521}",accept:"\u{1F251}",aerial_tramway:"\u{1F6A1}",airplane:"\u2708\uFE0F",alarm_clock:"\u23F0",alembic:"\u2697\uFE0F",alien:"\u{1F47D}",ambulance:"\u{1F691}",amphora:"\u{1F3FA}",anchor:"\u2693\uFE0F",angel:"\u{1F47C}",anger:"\u{1F4A2}",angry:"\u{1F620}",anguished:"\u{1F627}",ant:"\u{1F41C}",apple:"\u{1F34E}",aquarius:"\u2652\uFE0F",aries:"\u2648\uFE0F",arrow_backward:"\u25C0\uFE0F",arrow_double_down:"\u23EC",arrow_double_up:"\u23EB",arrow_down:"\u2B07\uFE0F",arrow_down_small:"\u{1F53D}",arrow_forward:"\u25B6\uFE0F",arrow_heading_down:"\u2935\uFE0F",arrow_heading_up:"\u2934\uFE0F",arrow_left:"\u2B05\uFE0F",arrow_lower_left:"\u2199\uFE0F",arrow_lower_right:"\u2198\uFE0F",arrow_right:"\u27A1\uFE0F",arrow_right_hook:"\u21AA\uFE0F",arrow_up:"\u2B06\uFE0F",arrow_up_down:"\u2195\uFE0F",arrow_up_small:"\u{1F53C}",arrow_upper_left:"\u2196\uFE0F",arrow_upper_right:"\u2197\uFE0F",arrows_clockwise:"\u{1F503}",arrows_counterclockwise:"\u{1F504}",art:"\u{1F3A8}",articulated_lorry:"\u{1F69B}",artificial_satellite:"\u{1F6F0}",astonished:"\u{1F632}",athletic_shoe:"\u{1F45F}",atm:"\u{1F3E7}",atom_symbol:"\u269B\uFE0F",avocado:"\u{1F951}",b:"\u{1F171}\uFE0F",baby:"\u{1F476}",baby_bottle:"\u{1F37C}",baby_chick:"\u{1F424}",baby_symbol:"\u{1F6BC}",back:"\u{1F519}",bacon:"\u{1F953}",badminton:"\u{1F3F8}",baggage_claim:"\u{1F6C4}",baguette_bread:"\u{1F956}",balance_scale:"\u2696\uFE0F",balloon:"\u{1F388}",ballot_box:"\u{1F5F3}",ballot_box_with_check:"\u2611\uFE0F",bamboo:"\u{1F38D}",banana:"\u{1F34C}",bangbang:"\u203C\uFE0F",bank:"\u{1F3E6}",bar_chart:"\u{1F4CA}",barber:"\u{1F488}",baseball:"\u26BE\uFE0F",basketball:"\u{1F3C0}",basketball_man:"\u26F9\uFE0F",basketball_woman:"\u26F9\uFE0F&zwj;\u2640\uFE0F",bat:"\u{1F987}",bath:"\u{1F6C0}",bathtub:"\u{1F6C1}",battery:"\u{1F50B}",beach_umbrella:"\u{1F3D6}",bear:"\u{1F43B}",bed:"\u{1F6CF}",bee:"\u{1F41D}",beer:"\u{1F37A}",beers:"\u{1F37B}",beetle:"\u{1F41E}",beginner:"\u{1F530}",bell:"\u{1F514}",bellhop_bell:"\u{1F6CE}",bento:"\u{1F371}",biking_man:"\u{1F6B4}",bike:"\u{1F6B2}",biking_woman:"\u{1F6B4}&zwj;\u2640\uFE0F",bikini:"\u{1F459}",biohazard:"\u2623\uFE0F",bird:"\u{1F426}",birthday:"\u{1F382}",black_circle:"\u26AB\uFE0F",black_flag:"\u{1F3F4}",black_heart:"\u{1F5A4}",black_joker:"\u{1F0CF}",black_large_square:"\u2B1B\uFE0F",black_medium_small_square:"\u25FE\uFE0F",black_medium_square:"\u25FC\uFE0F",black_nib:"\u2712\uFE0F",black_small_square:"\u25AA\uFE0F",black_square_button:"\u{1F532}",blonde_man:"\u{1F471}",blonde_woman:"\u{1F471}&zwj;\u2640\uFE0F",blossom:"\u{1F33C}",blowfish:"\u{1F421}",blue_book:"\u{1F4D8}",blue_car:"\u{1F699}",blue_heart:"\u{1F499}",blush:"\u{1F60A}",boar:"\u{1F417}",boat:"\u26F5\uFE0F",bomb:"\u{1F4A3}",book:"\u{1F4D6}",bookmark:"\u{1F516}",bookmark_tabs:"\u{1F4D1}",books:"\u{1F4DA}",boom:"\u{1F4A5}",boot:"\u{1F462}",bouquet:"\u{1F490}",bowing_man:"\u{1F647}",bow_and_arrow:"\u{1F3F9}",bowing_woman:"\u{1F647}&zwj;\u2640\uFE0F",bowling:"\u{1F3B3}",boxing_glove:"\u{1F94A}",boy:"\u{1F466}",bread:"\u{1F35E}",bride_with_veil:"\u{1F470}",bridge_at_night:"\u{1F309}",briefcase:"\u{1F4BC}",broken_heart:"\u{1F494}",bug:"\u{1F41B}",building_construction:"\u{1F3D7}",bulb:"\u{1F4A1}",bullettrain_front:"\u{1F685}",bullettrain_side:"\u{1F684}",burrito:"\u{1F32F}",bus:"\u{1F68C}",business_suit_levitating:"\u{1F574}",busstop:"\u{1F68F}",bust_in_silhouette:"\u{1F464}",busts_in_silhouette:"\u{1F465}",butterfly:"\u{1F98B}",cactus:"\u{1F335}",cake:"\u{1F370}",calendar:"\u{1F4C6}",call_me_hand:"\u{1F919}",calling:"\u{1F4F2}",camel:"\u{1F42B}",camera:"\u{1F4F7}",camera_flash:"\u{1F4F8}",camping:"\u{1F3D5}",cancer:"\u264B\uFE0F",candle:"\u{1F56F}",candy:"\u{1F36C}",canoe:"\u{1F6F6}",capital_abcd:"\u{1F520}",capricorn:"\u2651\uFE0F",car:"\u{1F697}",card_file_box:"\u{1F5C3}",card_index:"\u{1F4C7}",card_index_dividers:"\u{1F5C2}",carousel_horse:"\u{1F3A0}",carrot:"\u{1F955}",cat:"\u{1F431}",cat2:"\u{1F408}",cd:"\u{1F4BF}",chains:"\u26D3",champagne:"\u{1F37E}",chart:"\u{1F4B9}",chart_with_downwards_trend:"\u{1F4C9}",chart_with_upwards_trend:"\u{1F4C8}",checkered_flag:"\u{1F3C1}",cheese:"\u{1F9C0}",cherries:"\u{1F352}",cherry_blossom:"\u{1F338}",chestnut:"\u{1F330}",chicken:"\u{1F414}",children_crossing:"\u{1F6B8}",chipmunk:"\u{1F43F}",chocolate_bar:"\u{1F36B}",christmas_tree:"\u{1F384}",church:"\u26EA\uFE0F",cinema:"\u{1F3A6}",circus_tent:"\u{1F3AA}",city_sunrise:"\u{1F307}",city_sunset:"\u{1F306}",cityscape:"\u{1F3D9}",cl:"\u{1F191}",clamp:"\u{1F5DC}",clap:"\u{1F44F}",clapper:"\u{1F3AC}",classical_building:"\u{1F3DB}",clinking_glasses:"\u{1F942}",clipboard:"\u{1F4CB}",clock1:"\u{1F550}",clock10:"\u{1F559}",clock1030:"\u{1F565}",clock11:"\u{1F55A}",clock1130:"\u{1F566}",clock12:"\u{1F55B}",clock1230:"\u{1F567}",clock130:"\u{1F55C}",clock2:"\u{1F551}",clock230:"\u{1F55D}",clock3:"\u{1F552}",clock330:"\u{1F55E}",clock4:"\u{1F553}",clock430:"\u{1F55F}",clock5:"\u{1F554}",clock530:"\u{1F560}",clock6:"\u{1F555}",clock630:"\u{1F561}",clock7:"\u{1F556}",clock730:"\u{1F562}",clock8:"\u{1F557}",clock830:"\u{1F563}",clock9:"\u{1F558}",clock930:"\u{1F564}",closed_book:"\u{1F4D5}",closed_lock_with_key:"\u{1F510}",closed_umbrella:"\u{1F302}",cloud:"\u2601\uFE0F",cloud_with_lightning:"\u{1F329}",cloud_with_lightning_and_rain:"\u26C8",cloud_with_rain:"\u{1F327}",cloud_with_snow:"\u{1F328}",clown_face:"\u{1F921}",clubs:"\u2663\uFE0F",cocktail:"\u{1F378}",coffee:"\u2615\uFE0F",coffin:"\u26B0\uFE0F",cold_sweat:"\u{1F630}",comet:"\u2604\uFE0F",computer:"\u{1F4BB}",computer_mouse:"\u{1F5B1}",confetti_ball:"\u{1F38A}",confounded:"\u{1F616}",confused:"\u{1F615}",congratulations:"\u3297\uFE0F",construction:"\u{1F6A7}",construction_worker_man:"\u{1F477}",construction_worker_woman:"\u{1F477}&zwj;\u2640\uFE0F",control_knobs:"\u{1F39B}",convenience_store:"\u{1F3EA}",cookie:"\u{1F36A}",cool:"\u{1F192}",policeman:"\u{1F46E}",copyright:"\xA9\uFE0F",corn:"\u{1F33D}",couch_and_lamp:"\u{1F6CB}",couple:"\u{1F46B}",couple_with_heart_woman_man:"\u{1F491}",couple_with_heart_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F468}",couple_with_heart_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F469}",couplekiss_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F468}",couplekiss_man_woman:"\u{1F48F}",couplekiss_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F469}",cow:"\u{1F42E}",cow2:"\u{1F404}",cowboy_hat_face:"\u{1F920}",crab:"\u{1F980}",crayon:"\u{1F58D}",credit_card:"\u{1F4B3}",crescent_moon:"\u{1F319}",cricket:"\u{1F3CF}",crocodile:"\u{1F40A}",croissant:"\u{1F950}",crossed_fingers:"\u{1F91E}",crossed_flags:"\u{1F38C}",crossed_swords:"\u2694\uFE0F",crown:"\u{1F451}",cry:"\u{1F622}",crying_cat_face:"\u{1F63F}",crystal_ball:"\u{1F52E}",cucumber:"\u{1F952}",cupid:"\u{1F498}",curly_loop:"\u27B0",currency_exchange:"\u{1F4B1}",curry:"\u{1F35B}",custard:"\u{1F36E}",customs:"\u{1F6C3}",cyclone:"\u{1F300}",dagger:"\u{1F5E1}",dancer:"\u{1F483}",dancing_women:"\u{1F46F}",dancing_men:"\u{1F46F}&zwj;\u2642\uFE0F",dango:"\u{1F361}",dark_sunglasses:"\u{1F576}",dart:"\u{1F3AF}",dash:"\u{1F4A8}",date:"\u{1F4C5}",deciduous_tree:"\u{1F333}",deer:"\u{1F98C}",department_store:"\u{1F3EC}",derelict_house:"\u{1F3DA}",desert:"\u{1F3DC}",desert_island:"\u{1F3DD}",desktop_computer:"\u{1F5A5}",male_detective:"\u{1F575}\uFE0F",diamond_shape_with_a_dot_inside:"\u{1F4A0}",diamonds:"\u2666\uFE0F",disappointed:"\u{1F61E}",disappointed_relieved:"\u{1F625}",dizzy:"\u{1F4AB}",dizzy_face:"\u{1F635}",do_not_litter:"\u{1F6AF}",dog:"\u{1F436}",dog2:"\u{1F415}",dollar:"\u{1F4B5}",dolls:"\u{1F38E}",dolphin:"\u{1F42C}",door:"\u{1F6AA}",doughnut:"\u{1F369}",dove:"\u{1F54A}",dragon:"\u{1F409}",dragon_face:"\u{1F432}",dress:"\u{1F457}",dromedary_camel:"\u{1F42A}",drooling_face:"\u{1F924}",droplet:"\u{1F4A7}",drum:"\u{1F941}",duck:"\u{1F986}",dvd:"\u{1F4C0}","e-mail":"\u{1F4E7}",eagle:"\u{1F985}",ear:"\u{1F442}",ear_of_rice:"\u{1F33E}",earth_africa:"\u{1F30D}",earth_americas:"\u{1F30E}",earth_asia:"\u{1F30F}",egg:"\u{1F95A}",eggplant:"\u{1F346}",eight_pointed_black_star:"\u2734\uFE0F",eight_spoked_asterisk:"\u2733\uFE0F",electric_plug:"\u{1F50C}",elephant:"\u{1F418}",email:"\u2709\uFE0F",end:"\u{1F51A}",envelope_with_arrow:"\u{1F4E9}",euro:"\u{1F4B6}",european_castle:"\u{1F3F0}",european_post_office:"\u{1F3E4}",evergreen_tree:"\u{1F332}",exclamation:"\u2757\uFE0F",expressionless:"\u{1F611}",eye:"\u{1F441}",eye_speech_bubble:"\u{1F441}&zwj;\u{1F5E8}",eyeglasses:"\u{1F453}",eyes:"\u{1F440}",face_with_head_bandage:"\u{1F915}",face_with_thermometer:"\u{1F912}",fist_oncoming:"\u{1F44A}",factory:"\u{1F3ED}",fallen_leaf:"\u{1F342}",family_man_woman_boy:"\u{1F46A}",family_man_boy:"\u{1F468}&zwj;\u{1F466}",family_man_boy_boy:"\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_girl:"\u{1F468}&zwj;\u{1F467}",family_man_girl_boy:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_girl_girl:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_man_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}",family_man_man_boy_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_man_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}",family_man_man_girl_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_man_girl_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_woman_boy_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_woman_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}",family_man_woman_girl_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_woman_girl_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_boy:"\u{1F469}&zwj;\u{1F466}",family_woman_boy_boy:"\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_girl:"\u{1F469}&zwj;\u{1F467}",family_woman_girl_boy:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_girl_girl:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_woman_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}",family_woman_woman_boy_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_woman_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}",family_woman_woman_girl_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_woman_girl_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",fast_forward:"\u23E9",fax:"\u{1F4E0}",fearful:"\u{1F628}",feet:"\u{1F43E}",female_detective:"\u{1F575}\uFE0F&zwj;\u2640\uFE0F",ferris_wheel:"\u{1F3A1}",ferry:"\u26F4",field_hockey:"\u{1F3D1}",file_cabinet:"\u{1F5C4}",file_folder:"\u{1F4C1}",film_projector:"\u{1F4FD}",film_strip:"\u{1F39E}",fire:"\u{1F525}",fire_engine:"\u{1F692}",fireworks:"\u{1F386}",first_quarter_moon:"\u{1F313}",first_quarter_moon_with_face:"\u{1F31B}",fish:"\u{1F41F}",fish_cake:"\u{1F365}",fishing_pole_and_fish:"\u{1F3A3}",fist_raised:"\u270A",fist_left:"\u{1F91B}",fist_right:"\u{1F91C}",flags:"\u{1F38F}",flashlight:"\u{1F526}",fleur_de_lis:"\u269C\uFE0F",flight_arrival:"\u{1F6EC}",flight_departure:"\u{1F6EB}",floppy_disk:"\u{1F4BE}",flower_playing_cards:"\u{1F3B4}",flushed:"\u{1F633}",fog:"\u{1F32B}",foggy:"\u{1F301}",football:"\u{1F3C8}",footprints:"\u{1F463}",fork_and_knife:"\u{1F374}",fountain:"\u26F2\uFE0F",fountain_pen:"\u{1F58B}",four_leaf_clover:"\u{1F340}",fox_face:"\u{1F98A}",framed_picture:"\u{1F5BC}",free:"\u{1F193}",fried_egg:"\u{1F373}",fried_shrimp:"\u{1F364}",fries:"\u{1F35F}",frog:"\u{1F438}",frowning:"\u{1F626}",frowning_face:"\u2639\uFE0F",frowning_man:"\u{1F64D}&zwj;\u2642\uFE0F",frowning_woman:"\u{1F64D}",middle_finger:"\u{1F595}",fuelpump:"\u26FD\uFE0F",full_moon:"\u{1F315}",full_moon_with_face:"\u{1F31D}",funeral_urn:"\u26B1\uFE0F",game_die:"\u{1F3B2}",gear:"\u2699\uFE0F",gem:"\u{1F48E}",gemini:"\u264A\uFE0F",ghost:"\u{1F47B}",gift:"\u{1F381}",gift_heart:"\u{1F49D}",girl:"\u{1F467}",globe_with_meridians:"\u{1F310}",goal_net:"\u{1F945}",goat:"\u{1F410}",golf:"\u26F3\uFE0F",golfing_man:"\u{1F3CC}\uFE0F",golfing_woman:"\u{1F3CC}\uFE0F&zwj;\u2640\uFE0F",gorilla:"\u{1F98D}",grapes:"\u{1F347}",green_apple:"\u{1F34F}",green_book:"\u{1F4D7}",green_heart:"\u{1F49A}",green_salad:"\u{1F957}",grey_exclamation:"\u2755",grey_question:"\u2754",grimacing:"\u{1F62C}",grin:"\u{1F601}",grinning:"\u{1F600}",guardsman:"\u{1F482}",guardswoman:"\u{1F482}&zwj;\u2640\uFE0F",guitar:"\u{1F3B8}",gun:"\u{1F52B}",haircut_woman:"\u{1F487}",haircut_man:"\u{1F487}&zwj;\u2642\uFE0F",hamburger:"\u{1F354}",hammer:"\u{1F528}",hammer_and_pick:"\u2692",hammer_and_wrench:"\u{1F6E0}",hamster:"\u{1F439}",hand:"\u270B",handbag:"\u{1F45C}",handshake:"\u{1F91D}",hankey:"\u{1F4A9}",hatched_chick:"\u{1F425}",hatching_chick:"\u{1F423}",headphones:"\u{1F3A7}",hear_no_evil:"\u{1F649}",heart:"\u2764\uFE0F",heart_decoration:"\u{1F49F}",heart_eyes:"\u{1F60D}",heart_eyes_cat:"\u{1F63B}",heartbeat:"\u{1F493}",heartpulse:"\u{1F497}",hearts:"\u2665\uFE0F",heavy_check_mark:"\u2714\uFE0F",heavy_division_sign:"\u2797",heavy_dollar_sign:"\u{1F4B2}",heavy_heart_exclamation:"\u2763\uFE0F",heavy_minus_sign:"\u2796",heavy_multiplication_x:"\u2716\uFE0F",heavy_plus_sign:"\u2795",helicopter:"\u{1F681}",herb:"\u{1F33F}",hibiscus:"\u{1F33A}",high_brightness:"\u{1F506}",high_heel:"\u{1F460}",hocho:"\u{1F52A}",hole:"\u{1F573}",honey_pot:"\u{1F36F}",horse:"\u{1F434}",horse_racing:"\u{1F3C7}",hospital:"\u{1F3E5}",hot_pepper:"\u{1F336}",hotdog:"\u{1F32D}",hotel:"\u{1F3E8}",hotsprings:"\u2668\uFE0F",hourglass:"\u231B\uFE0F",hourglass_flowing_sand:"\u23F3",house:"\u{1F3E0}",house_with_garden:"\u{1F3E1}",houses:"\u{1F3D8}",hugs:"\u{1F917}",hushed:"\u{1F62F}",ice_cream:"\u{1F368}",ice_hockey:"\u{1F3D2}",ice_skate:"\u26F8",icecream:"\u{1F366}",id:"\u{1F194}",ideograph_advantage:"\u{1F250}",imp:"\u{1F47F}",inbox_tray:"\u{1F4E5}",incoming_envelope:"\u{1F4E8}",tipping_hand_woman:"\u{1F481}",information_source:"\u2139\uFE0F",innocent:"\u{1F607}",interrobang:"\u2049\uFE0F",iphone:"\u{1F4F1}",izakaya_lantern:"\u{1F3EE}",jack_o_lantern:"\u{1F383}",japan:"\u{1F5FE}",japanese_castle:"\u{1F3EF}",japanese_goblin:"\u{1F47A}",japanese_ogre:"\u{1F479}",jeans:"\u{1F456}",joy:"\u{1F602}",joy_cat:"\u{1F639}",joystick:"\u{1F579}",kaaba:"\u{1F54B}",key:"\u{1F511}",keyboard:"\u2328\uFE0F",keycap_ten:"\u{1F51F}",kick_scooter:"\u{1F6F4}",kimono:"\u{1F458}",kiss:"\u{1F48B}",kissing:"\u{1F617}",kissing_cat:"\u{1F63D}",kissing_closed_eyes:"\u{1F61A}",kissing_heart:"\u{1F618}",kissing_smiling_eyes:"\u{1F619}",kiwi_fruit:"\u{1F95D}",koala:"\u{1F428}",koko:"\u{1F201}",label:"\u{1F3F7}",large_blue_circle:"\u{1F535}",large_blue_diamond:"\u{1F537}",large_orange_diamond:"\u{1F536}",last_quarter_moon:"\u{1F317}",last_quarter_moon_with_face:"\u{1F31C}",latin_cross:"\u271D\uFE0F",laughing:"\u{1F606}",leaves:"\u{1F343}",ledger:"\u{1F4D2}",left_luggage:"\u{1F6C5}",left_right_arrow:"\u2194\uFE0F",leftwards_arrow_with_hook:"\u21A9\uFE0F",lemon:"\u{1F34B}",leo:"\u264C\uFE0F",leopard:"\u{1F406}",level_slider:"\u{1F39A}",libra:"\u264E\uFE0F",light_rail:"\u{1F688}",link:"\u{1F517}",lion:"\u{1F981}",lips:"\u{1F444}",lipstick:"\u{1F484}",lizard:"\u{1F98E}",lock:"\u{1F512}",lock_with_ink_pen:"\u{1F50F}",lollipop:"\u{1F36D}",loop:"\u27BF",loud_sound:"\u{1F50A}",loudspeaker:"\u{1F4E2}",love_hotel:"\u{1F3E9}",love_letter:"\u{1F48C}",low_brightness:"\u{1F505}",lying_face:"\u{1F925}",m:"\u24C2\uFE0F",mag:"\u{1F50D}",mag_right:"\u{1F50E}",mahjong:"\u{1F004}\uFE0F",mailbox:"\u{1F4EB}",mailbox_closed:"\u{1F4EA}",mailbox_with_mail:"\u{1F4EC}",mailbox_with_no_mail:"\u{1F4ED}",man:"\u{1F468}",man_artist:"\u{1F468}&zwj;\u{1F3A8}",man_astronaut:"\u{1F468}&zwj;\u{1F680}",man_cartwheeling:"\u{1F938}&zwj;\u2642\uFE0F",man_cook:"\u{1F468}&zwj;\u{1F373}",man_dancing:"\u{1F57A}",man_facepalming:"\u{1F926}&zwj;\u2642\uFE0F",man_factory_worker:"\u{1F468}&zwj;\u{1F3ED}",man_farmer:"\u{1F468}&zwj;\u{1F33E}",man_firefighter:"\u{1F468}&zwj;\u{1F692}",man_health_worker:"\u{1F468}&zwj;\u2695\uFE0F",man_in_tuxedo:"\u{1F935}",man_judge:"\u{1F468}&zwj;\u2696\uFE0F",man_juggling:"\u{1F939}&zwj;\u2642\uFE0F",man_mechanic:"\u{1F468}&zwj;\u{1F527}",man_office_worker:"\u{1F468}&zwj;\u{1F4BC}",man_pilot:"\u{1F468}&zwj;\u2708\uFE0F",man_playing_handball:"\u{1F93E}&zwj;\u2642\uFE0F",man_playing_water_polo:"\u{1F93D}&zwj;\u2642\uFE0F",man_scientist:"\u{1F468}&zwj;\u{1F52C}",man_shrugging:"\u{1F937}&zwj;\u2642\uFE0F",man_singer:"\u{1F468}&zwj;\u{1F3A4}",man_student:"\u{1F468}&zwj;\u{1F393}",man_teacher:"\u{1F468}&zwj;\u{1F3EB}",man_technologist:"\u{1F468}&zwj;\u{1F4BB}",man_with_gua_pi_mao:"\u{1F472}",man_with_turban:"\u{1F473}",tangerine:"\u{1F34A}",mans_shoe:"\u{1F45E}",mantelpiece_clock:"\u{1F570}",maple_leaf:"\u{1F341}",martial_arts_uniform:"\u{1F94B}",mask:"\u{1F637}",massage_woman:"\u{1F486}",massage_man:"\u{1F486}&zwj;\u2642\uFE0F",meat_on_bone:"\u{1F356}",medal_military:"\u{1F396}",medal_sports:"\u{1F3C5}",mega:"\u{1F4E3}",melon:"\u{1F348}",memo:"\u{1F4DD}",men_wrestling:"\u{1F93C}&zwj;\u2642\uFE0F",menorah:"\u{1F54E}",mens:"\u{1F6B9}",metal:"\u{1F918}",metro:"\u{1F687}",microphone:"\u{1F3A4}",microscope:"\u{1F52C}",milk_glass:"\u{1F95B}",milky_way:"\u{1F30C}",minibus:"\u{1F690}",minidisc:"\u{1F4BD}",mobile_phone_off:"\u{1F4F4}",money_mouth_face:"\u{1F911}",money_with_wings:"\u{1F4B8}",moneybag:"\u{1F4B0}",monkey:"\u{1F412}",monkey_face:"\u{1F435}",monorail:"\u{1F69D}",moon:"\u{1F314}",mortar_board:"\u{1F393}",mosque:"\u{1F54C}",motor_boat:"\u{1F6E5}",motor_scooter:"\u{1F6F5}",motorcycle:"\u{1F3CD}",motorway:"\u{1F6E3}",mount_fuji:"\u{1F5FB}",mountain:"\u26F0",mountain_biking_man:"\u{1F6B5}",mountain_biking_woman:"\u{1F6B5}&zwj;\u2640\uFE0F",mountain_cableway:"\u{1F6A0}",mountain_railway:"\u{1F69E}",mountain_snow:"\u{1F3D4}",mouse:"\u{1F42D}",mouse2:"\u{1F401}",movie_camera:"\u{1F3A5}",moyai:"\u{1F5FF}",mrs_claus:"\u{1F936}",muscle:"\u{1F4AA}",mushroom:"\u{1F344}",musical_keyboard:"\u{1F3B9}",musical_note:"\u{1F3B5}",musical_score:"\u{1F3BC}",mute:"\u{1F507}",nail_care:"\u{1F485}",name_badge:"\u{1F4DB}",national_park:"\u{1F3DE}",nauseated_face:"\u{1F922}",necktie:"\u{1F454}",negative_squared_cross_mark:"\u274E",nerd_face:"\u{1F913}",neutral_face:"\u{1F610}",new:"\u{1F195}",new_moon:"\u{1F311}",new_moon_with_face:"\u{1F31A}",newspaper:"\u{1F4F0}",newspaper_roll:"\u{1F5DE}",next_track_button:"\u23ED",ng:"\u{1F196}",no_good_man:"\u{1F645}&zwj;\u2642\uFE0F",no_good_woman:"\u{1F645}",night_with_stars:"\u{1F303}",no_bell:"\u{1F515}",no_bicycles:"\u{1F6B3}",no_entry:"\u26D4\uFE0F",no_entry_sign:"\u{1F6AB}",no_mobile_phones:"\u{1F4F5}",no_mouth:"\u{1F636}",no_pedestrians:"\u{1F6B7}",no_smoking:"\u{1F6AD}","non-potable_water":"\u{1F6B1}",nose:"\u{1F443}",notebook:"\u{1F4D3}",notebook_with_decorative_cover:"\u{1F4D4}",notes:"\u{1F3B6}",nut_and_bolt:"\u{1F529}",o:"\u2B55\uFE0F",o2:"\u{1F17E}\uFE0F",ocean:"\u{1F30A}",octopus:"\u{1F419}",oden:"\u{1F362}",office:"\u{1F3E2}",oil_drum:"\u{1F6E2}",ok:"\u{1F197}",ok_hand:"\u{1F44C}",ok_man:"\u{1F646}&zwj;\u2642\uFE0F",ok_woman:"\u{1F646}",old_key:"\u{1F5DD}",older_man:"\u{1F474}",older_woman:"\u{1F475}",om:"\u{1F549}",on:"\u{1F51B}",oncoming_automobile:"\u{1F698}",oncoming_bus:"\u{1F68D}",oncoming_police_car:"\u{1F694}",oncoming_taxi:"\u{1F696}",open_file_folder:"\u{1F4C2}",open_hands:"\u{1F450}",open_mouth:"\u{1F62E}",open_umbrella:"\u2602\uFE0F",ophiuchus:"\u26CE",orange_book:"\u{1F4D9}",orthodox_cross:"\u2626\uFE0F",outbox_tray:"\u{1F4E4}",owl:"\u{1F989}",ox:"\u{1F402}",package:"\u{1F4E6}",page_facing_up:"\u{1F4C4}",page_with_curl:"\u{1F4C3}",pager:"\u{1F4DF}",paintbrush:"\u{1F58C}",palm_tree:"\u{1F334}",pancakes:"\u{1F95E}",panda_face:"\u{1F43C}",paperclip:"\u{1F4CE}",paperclips:"\u{1F587}",parasol_on_ground:"\u26F1",parking:"\u{1F17F}\uFE0F",part_alternation_mark:"\u303D\uFE0F",partly_sunny:"\u26C5\uFE0F",passenger_ship:"\u{1F6F3}",passport_control:"\u{1F6C2}",pause_button:"\u23F8",peace_symbol:"\u262E\uFE0F",peach:"\u{1F351}",peanuts:"\u{1F95C}",pear:"\u{1F350}",pen:"\u{1F58A}",pencil2:"\u270F\uFE0F",penguin:"\u{1F427}",pensive:"\u{1F614}",performing_arts:"\u{1F3AD}",persevere:"\u{1F623}",person_fencing:"\u{1F93A}",pouting_woman:"\u{1F64E}",phone:"\u260E\uFE0F",pick:"\u26CF",pig:"\u{1F437}",pig2:"\u{1F416}",pig_nose:"\u{1F43D}",pill:"\u{1F48A}",pineapple:"\u{1F34D}",ping_pong:"\u{1F3D3}",pisces:"\u2653\uFE0F",pizza:"\u{1F355}",place_of_worship:"\u{1F6D0}",plate_with_cutlery:"\u{1F37D}",play_or_pause_button:"\u23EF",point_down:"\u{1F447}",point_left:"\u{1F448}",point_right:"\u{1F449}",point_up:"\u261D\uFE0F",point_up_2:"\u{1F446}",police_car:"\u{1F693}",policewoman:"\u{1F46E}&zwj;\u2640\uFE0F",poodle:"\u{1F429}",popcorn:"\u{1F37F}",post_office:"\u{1F3E3}",postal_horn:"\u{1F4EF}",postbox:"\u{1F4EE}",potable_water:"\u{1F6B0}",potato:"\u{1F954}",pouch:"\u{1F45D}",poultry_leg:"\u{1F357}",pound:"\u{1F4B7}",rage:"\u{1F621}",pouting_cat:"\u{1F63E}",pouting_man:"\u{1F64E}&zwj;\u2642\uFE0F",pray:"\u{1F64F}",prayer_beads:"\u{1F4FF}",pregnant_woman:"\u{1F930}",previous_track_button:"\u23EE",prince:"\u{1F934}",princess:"\u{1F478}",printer:"\u{1F5A8}",purple_heart:"\u{1F49C}",purse:"\u{1F45B}",pushpin:"\u{1F4CC}",put_litter_in_its_place:"\u{1F6AE}",question:"\u2753",rabbit:"\u{1F430}",rabbit2:"\u{1F407}",racehorse:"\u{1F40E}",racing_car:"\u{1F3CE}",radio:"\u{1F4FB}",radio_button:"\u{1F518}",radioactive:"\u2622\uFE0F",railway_car:"\u{1F683}",railway_track:"\u{1F6E4}",rainbow:"\u{1F308}",rainbow_flag:"\u{1F3F3}\uFE0F&zwj;\u{1F308}",raised_back_of_hand:"\u{1F91A}",raised_hand_with_fingers_splayed:"\u{1F590}",raised_hands:"\u{1F64C}",raising_hand_woman:"\u{1F64B}",raising_hand_man:"\u{1F64B}&zwj;\u2642\uFE0F",ram:"\u{1F40F}",ramen:"\u{1F35C}",rat:"\u{1F400}",record_button:"\u23FA",recycle:"\u267B\uFE0F",red_circle:"\u{1F534}",registered:"\xAE\uFE0F",relaxed:"\u263A\uFE0F",relieved:"\u{1F60C}",reminder_ribbon:"\u{1F397}",repeat:"\u{1F501}",repeat_one:"\u{1F502}",rescue_worker_helmet:"\u26D1",restroom:"\u{1F6BB}",revolving_hearts:"\u{1F49E}",rewind:"\u23EA",rhinoceros:"\u{1F98F}",ribbon:"\u{1F380}",rice:"\u{1F35A}",rice_ball:"\u{1F359}",rice_cracker:"\u{1F358}",rice_scene:"\u{1F391}",right_anger_bubble:"\u{1F5EF}",ring:"\u{1F48D}",robot:"\u{1F916}",rocket:"\u{1F680}",rofl:"\u{1F923}",roll_eyes:"\u{1F644}",roller_coaster:"\u{1F3A2}",rooster:"\u{1F413}",rose:"\u{1F339}",rosette:"\u{1F3F5}",rotating_light:"\u{1F6A8}",round_pushpin:"\u{1F4CD}",rowing_man:"\u{1F6A3}",rowing_woman:"\u{1F6A3}&zwj;\u2640\uFE0F",rugby_football:"\u{1F3C9}",running_man:"\u{1F3C3}",running_shirt_with_sash:"\u{1F3BD}",running_woman:"\u{1F3C3}&zwj;\u2640\uFE0F",sa:"\u{1F202}\uFE0F",sagittarius:"\u2650\uFE0F",sake:"\u{1F376}",sandal:"\u{1F461}",santa:"\u{1F385}",satellite:"\u{1F4E1}",saxophone:"\u{1F3B7}",school:"\u{1F3EB}",school_satchel:"\u{1F392}",scissors:"\u2702\uFE0F",scorpion:"\u{1F982}",scorpius:"\u264F\uFE0F",scream:"\u{1F631}",scream_cat:"\u{1F640}",scroll:"\u{1F4DC}",seat:"\u{1F4BA}",secret:"\u3299\uFE0F",see_no_evil:"\u{1F648}",seedling:"\u{1F331}",selfie:"\u{1F933}",shallow_pan_of_food:"\u{1F958}",shamrock:"\u2618\uFE0F",shark:"\u{1F988}",shaved_ice:"\u{1F367}",sheep:"\u{1F411}",shell:"\u{1F41A}",shield:"\u{1F6E1}",shinto_shrine:"\u26E9",ship:"\u{1F6A2}",shirt:"\u{1F455}",shopping:"\u{1F6CD}",shopping_cart:"\u{1F6D2}",shower:"\u{1F6BF}",shrimp:"\u{1F990}",signal_strength:"\u{1F4F6}",six_pointed_star:"\u{1F52F}",ski:"\u{1F3BF}",skier:"\u26F7",skull:"\u{1F480}",skull_and_crossbones:"\u2620\uFE0F",sleeping:"\u{1F634}",sleeping_bed:"\u{1F6CC}",sleepy:"\u{1F62A}",slightly_frowning_face:"\u{1F641}",slightly_smiling_face:"\u{1F642}",slot_machine:"\u{1F3B0}",small_airplane:"\u{1F6E9}",small_blue_diamond:"\u{1F539}",small_orange_diamond:"\u{1F538}",small_red_triangle:"\u{1F53A}",small_red_triangle_down:"\u{1F53B}",smile:"\u{1F604}",smile_cat:"\u{1F638}",smiley:"\u{1F603}",smiley_cat:"\u{1F63A}",smiling_imp:"\u{1F608}",smirk:"\u{1F60F}",smirk_cat:"\u{1F63C}",smoking:"\u{1F6AC}",snail:"\u{1F40C}",snake:"\u{1F40D}",sneezing_face:"\u{1F927}",snowboarder:"\u{1F3C2}",snowflake:"\u2744\uFE0F",snowman:"\u26C4\uFE0F",snowman_with_snow:"\u2603\uFE0F",sob:"\u{1F62D}",soccer:"\u26BD\uFE0F",soon:"\u{1F51C}",sos:"\u{1F198}",sound:"\u{1F509}",space_invader:"\u{1F47E}",spades:"\u2660\uFE0F",spaghetti:"\u{1F35D}",sparkle:"\u2747\uFE0F",sparkler:"\u{1F387}",sparkles:"\u2728",sparkling_heart:"\u{1F496}",speak_no_evil:"\u{1F64A}",speaker:"\u{1F508}",speaking_head:"\u{1F5E3}",speech_balloon:"\u{1F4AC}",speedboat:"\u{1F6A4}",spider:"\u{1F577}",spider_web:"\u{1F578}",spiral_calendar:"\u{1F5D3}",spiral_notepad:"\u{1F5D2}",spoon:"\u{1F944}",squid:"\u{1F991}",stadium:"\u{1F3DF}",star:"\u2B50\uFE0F",star2:"\u{1F31F}",star_and_crescent:"\u262A\uFE0F",star_of_david:"\u2721\uFE0F",stars:"\u{1F320}",station:"\u{1F689}",statue_of_liberty:"\u{1F5FD}",steam_locomotive:"\u{1F682}",stew:"\u{1F372}",stop_button:"\u23F9",stop_sign:"\u{1F6D1}",stopwatch:"\u23F1",straight_ruler:"\u{1F4CF}",strawberry:"\u{1F353}",stuck_out_tongue:"\u{1F61B}",stuck_out_tongue_closed_eyes:"\u{1F61D}",stuck_out_tongue_winking_eye:"\u{1F61C}",studio_microphone:"\u{1F399}",stuffed_flatbread:"\u{1F959}",sun_behind_large_cloud:"\u{1F325}",sun_behind_rain_cloud:"\u{1F326}",sun_behind_small_cloud:"\u{1F324}",sun_with_face:"\u{1F31E}",sunflower:"\u{1F33B}",sunglasses:"\u{1F60E}",sunny:"\u2600\uFE0F",sunrise:"\u{1F305}",sunrise_over_mountains:"\u{1F304}",surfing_man:"\u{1F3C4}",surfing_woman:"\u{1F3C4}&zwj;\u2640\uFE0F",sushi:"\u{1F363}",suspension_railway:"\u{1F69F}",sweat:"\u{1F613}",sweat_drops:"\u{1F4A6}",sweat_smile:"\u{1F605}",sweet_potato:"\u{1F360}",swimming_man:"\u{1F3CA}",swimming_woman:"\u{1F3CA}&zwj;\u2640\uFE0F",symbols:"\u{1F523}",synagogue:"\u{1F54D}",syringe:"\u{1F489}",taco:"\u{1F32E}",tada:"\u{1F389}",tanabata_tree:"\u{1F38B}",taurus:"\u2649\uFE0F",taxi:"\u{1F695}",tea:"\u{1F375}",telephone_receiver:"\u{1F4DE}",telescope:"\u{1F52D}",tennis:"\u{1F3BE}",tent:"\u26FA\uFE0F",thermometer:"\u{1F321}",thinking:"\u{1F914}",thought_balloon:"\u{1F4AD}",ticket:"\u{1F3AB}",tickets:"\u{1F39F}",tiger:"\u{1F42F}",tiger2:"\u{1F405}",timer_clock:"\u23F2",tipping_hand_man:"\u{1F481}&zwj;\u2642\uFE0F",tired_face:"\u{1F62B}",tm:"\u2122\uFE0F",toilet:"\u{1F6BD}",tokyo_tower:"\u{1F5FC}",tomato:"\u{1F345}",tongue:"\u{1F445}",top:"\u{1F51D}",tophat:"\u{1F3A9}",tornado:"\u{1F32A}",trackball:"\u{1F5B2}",tractor:"\u{1F69C}",traffic_light:"\u{1F6A5}",train:"\u{1F68B}",train2:"\u{1F686}",tram:"\u{1F68A}",triangular_flag_on_post:"\u{1F6A9}",triangular_ruler:"\u{1F4D0}",trident:"\u{1F531}",triumph:"\u{1F624}",trolleybus:"\u{1F68E}",trophy:"\u{1F3C6}",tropical_drink:"\u{1F379}",tropical_fish:"\u{1F420}",truck:"\u{1F69A}",trumpet:"\u{1F3BA}",tulip:"\u{1F337}",tumbler_glass:"\u{1F943}",turkey:"\u{1F983}",turtle:"\u{1F422}",tv:"\u{1F4FA}",twisted_rightwards_arrows:"\u{1F500}",two_hearts:"\u{1F495}",two_men_holding_hands:"\u{1F46C}",two_women_holding_hands:"\u{1F46D}",u5272:"\u{1F239}",u5408:"\u{1F234}",u55b6:"\u{1F23A}",u6307:"\u{1F22F}\uFE0F",u6708:"\u{1F237}\uFE0F",u6709:"\u{1F236}",u6e80:"\u{1F235}",u7121:"\u{1F21A}\uFE0F",u7533:"\u{1F238}",u7981:"\u{1F232}",u7a7a:"\u{1F233}",umbrella:"\u2614\uFE0F",unamused:"\u{1F612}",underage:"\u{1F51E}",unicorn:"\u{1F984}",unlock:"\u{1F513}",up:"\u{1F199}",upside_down_face:"\u{1F643}",v:"\u270C\uFE0F",vertical_traffic_light:"\u{1F6A6}",vhs:"\u{1F4FC}",vibration_mode:"\u{1F4F3}",video_camera:"\u{1F4F9}",video_game:"\u{1F3AE}",violin:"\u{1F3BB}",virgo:"\u264D\uFE0F",volcano:"\u{1F30B}",volleyball:"\u{1F3D0}",vs:"\u{1F19A}",vulcan_salute:"\u{1F596}",walking_man:"\u{1F6B6}",walking_woman:"\u{1F6B6}&zwj;\u2640\uFE0F",waning_crescent_moon:"\u{1F318}",waning_gibbous_moon:"\u{1F316}",warning:"\u26A0\uFE0F",wastebasket:"\u{1F5D1}",watch:"\u231A\uFE0F",water_buffalo:"\u{1F403}",watermelon:"\u{1F349}",wave:"\u{1F44B}",wavy_dash:"\u3030\uFE0F",waxing_crescent_moon:"\u{1F312}",wc:"\u{1F6BE}",weary:"\u{1F629}",wedding:"\u{1F492}",weight_lifting_man:"\u{1F3CB}\uFE0F",weight_lifting_woman:"\u{1F3CB}\uFE0F&zwj;\u2640\uFE0F",whale:"\u{1F433}",whale2:"\u{1F40B}",wheel_of_dharma:"\u2638\uFE0F",wheelchair:"\u267F\uFE0F",white_check_mark:"\u2705",white_circle:"\u26AA\uFE0F",white_flag:"\u{1F3F3}\uFE0F",white_flower:"\u{1F4AE}",white_large_square:"\u2B1C\uFE0F",white_medium_small_square:"\u25FD\uFE0F",white_medium_square:"\u25FB\uFE0F",white_small_square:"\u25AB\uFE0F",white_square_button:"\u{1F533}",wilted_flower:"\u{1F940}",wind_chime:"\u{1F390}",wind_face:"\u{1F32C}",wine_glass:"\u{1F377}",wink:"\u{1F609}",wolf:"\u{1F43A}",woman:"\u{1F469}",woman_artist:"\u{1F469}&zwj;\u{1F3A8}",woman_astronaut:"\u{1F469}&zwj;\u{1F680}",woman_cartwheeling:"\u{1F938}&zwj;\u2640\uFE0F",woman_cook:"\u{1F469}&zwj;\u{1F373}",woman_facepalming:"\u{1F926}&zwj;\u2640\uFE0F",woman_factory_worker:"\u{1F469}&zwj;\u{1F3ED}",woman_farmer:"\u{1F469}&zwj;\u{1F33E}",woman_firefighter:"\u{1F469}&zwj;\u{1F692}",woman_health_worker:"\u{1F469}&zwj;\u2695\uFE0F",woman_judge:"\u{1F469}&zwj;\u2696\uFE0F",woman_juggling:"\u{1F939}&zwj;\u2640\uFE0F",woman_mechanic:"\u{1F469}&zwj;\u{1F527}",woman_office_worker:"\u{1F469}&zwj;\u{1F4BC}",woman_pilot:"\u{1F469}&zwj;\u2708\uFE0F",woman_playing_handball:"\u{1F93E}&zwj;\u2640\uFE0F",woman_playing_water_polo:"\u{1F93D}&zwj;\u2640\uFE0F",woman_scientist:"\u{1F469}&zwj;\u{1F52C}",woman_shrugging:"\u{1F937}&zwj;\u2640\uFE0F",woman_singer:"\u{1F469}&zwj;\u{1F3A4}",woman_student:"\u{1F469}&zwj;\u{1F393}",woman_teacher:"\u{1F469}&zwj;\u{1F3EB}",woman_technologist:"\u{1F469}&zwj;\u{1F4BB}",woman_with_turban:"\u{1F473}&zwj;\u2640\uFE0F",womans_clothes:"\u{1F45A}",womans_hat:"\u{1F452}",women_wrestling:"\u{1F93C}&zwj;\u2640\uFE0F",womens:"\u{1F6BA}",world_map:"\u{1F5FA}",worried:"\u{1F61F}",wrench:"\u{1F527}",writing_hand:"\u270D\uFE0F",x:"\u274C",yellow_heart:"\u{1F49B}",yen:"\u{1F4B4}",yin_yang:"\u262F\uFE0F",yum:"\u{1F60B}",zap:"\u26A1\uFE0F",zipper_mouth_face:"\u{1F910}",zzz:"\u{1F4A4}",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},t.Converter=function(m){"use strict";var y={},b=[],E=[],v={},S=s,A={parsed:{},raw:"",format:""};I();function I(){m=m||{};for(var R in o)o.hasOwnProperty(R)&&(y[R]=o[R]);if(typeof m=="object")for(var K in m)m.hasOwnProperty(K)&&(y[K]=m[K]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof m+" was passed instead.");y.extensions&&t.helper.forEach(y.extensions,k)}function k(R,K){if(K=K||null,t.helper.isString(R))if(R=t.helper.stdExtName(R),K=R,t.extensions[R]){console.warn("DEPRECATION WARNING: "+R+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),N(t.extensions[R],R);return}else if(!t.helper.isUndefined(i[R]))R=i[R];else throw Error('Extension "'+R+'" could not be loaded. It was either not found or is not a valid extension.');typeof R=="function"&&(R=R()),t.helper.isArray(R)||(R=[R]);var U=c(R,K);if(!U.valid)throw Error(U.error);for(var te=0;te<R.length;++te){switch(R[te].type){case"lang":b.push(R[te]);break;case"output":E.push(R[te]);break}if(R[te].hasOwnProperty("listeners"))for(var Ce in R[te].listeners)R[te].listeners.hasOwnProperty(Ce)&&O(Ce,R[te].listeners[Ce])}}function N(R,K){typeof R=="function"&&(R=R(new t.Converter)),t.helper.isArray(R)||(R=[R]);var U=c(R,K);if(!U.valid)throw Error(U.error);for(var te=0;te<R.length;++te)switch(R[te].type){case"lang":b.push(R[te]);break;case"output":E.push(R[te]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function O(R,K){if(!t.helper.isString(R))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof R+" given");if(typeof K!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof K+" given");v.hasOwnProperty(R)||(v[R]=[]),v[R].push(K)}function G(R){var K=R.match(/^\s*/)[0].length,U=new RegExp("^\\s{0,"+K+"}","gm");return R.replace(U,"")}this._dispatch=function(K,U,te,Ce){if(v.hasOwnProperty(K))for(var ae=0;ae<v[K].length;++ae){var $e=v[K][ae](K,U,this,te,Ce);$e&&typeof $e<"u"&&(U=$e)}return U},this.listen=function(R,K){return O(R,K),this},this.makeHtml=function(R){if(!R)return R;var K={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:b,outputModifiers:E,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return R=R.replace(/¨/g,"\xA8T"),R=R.replace(/\$/g,"\xA8D"),R=R.replace(/\r\n/g,`
`),R=R.replace(/\r/g,`
`),R=R.replace(/\u00A0/g,"&nbsp;"),y.smartIndentationFix&&(R=G(R)),R=`

`+R+`

`,R=t.subParser("detab")(R,y,K),R=R.replace(/^[ \t]+$/mg,""),t.helper.forEach(b,function(U){R=t.subParser("runExtension")(U,R,y,K)}),R=t.subParser("metadata")(R,y,K),R=t.subParser("hashPreCodeTags")(R,y,K),R=t.subParser("githubCodeBlocks")(R,y,K),R=t.subParser("hashHTMLBlocks")(R,y,K),R=t.subParser("hashCodeTags")(R,y,K),R=t.subParser("stripLinkDefinitions")(R,y,K),R=t.subParser("blockGamut")(R,y,K),R=t.subParser("unhashHTMLSpans")(R,y,K),R=t.subParser("unescapeSpecialChars")(R,y,K),R=R.replace(/¨D/g,"$$"),R=R.replace(/¨T/g,"\xA8"),R=t.subParser("completeHTMLDocument")(R,y,K),t.helper.forEach(E,function(U){R=t.subParser("runExtension")(U,R,y,K)}),A=K.metadata,R},this.makeMarkdown=this.makeMd=function(R,K){if(R=R.replace(/\r\n/g,`
`),R=R.replace(/\r/g,`
`),R=R.replace(/>[ \t]+</,">\xA8NBSP;<"),!K)if(window&&window.document)K=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var U=K.createElement("div");U.innerHTML=R;var te={preList:ot(U)};He(U);for(var Ce=U.childNodes,ae="",$e=0;$e<Ce.length;$e++)ae+=t.subParser("makeMarkdown.node")(Ce[$e],te);function He(Ge){for(var Qe=0;Qe<Ge.childNodes.length;++Qe){var Ze=Ge.childNodes[Qe];Ze.nodeType===3?!/\S/.test(Ze.nodeValue)&&!/^[ ]+$/.test(Ze.nodeValue)?(Ge.removeChild(Ze),--Qe):(Ze.nodeValue=Ze.nodeValue.split(`
`).join(" "),Ze.nodeValue=Ze.nodeValue.replace(/(\s)+/g,"$1")):Ze.nodeType===1&&He(Ze)}}function ot(Ge){for(var Qe=Ge.querySelectorAll("pre"),Ze=[],Je=0;Je<Qe.length;++Je)if(Qe[Je].childElementCount===1&&Qe[Je].firstChild.tagName.toLowerCase()==="code"){var An=Qe[Je].firstChild.innerHTML.trim(),Tn=Qe[Je].firstChild.getAttribute("data-language")||"";if(Tn==="")for(var zn=Qe[Je].firstChild.className.split(" "),In=0;In<zn.length;++In){var Vn=zn[In].match(/^language-(.+)$/);if(Vn!==null){Tn=Vn[1];break}}An=t.helper.unescapeHTMLEntities(An),Ze.push(An),Qe[Je].outerHTML='<precode language="'+Tn+'" precodenum="'+Je.toString()+'"></precode>'}else Ze.push(Qe[Je].innerHTML),Qe[Je].innerHTML="",Qe[Je].setAttribute("prenum",Je.toString());return Ze}return ae},this.setOption=function(R,K){y[R]=K},this.getOption=function(R){return y[R]},this.getOptions=function(){return y},this.addExtension=function(R,K){K=K||null,k(R,K)},this.useExtension=function(R){k(R)},this.setFlavor=function(R){if(!a.hasOwnProperty(R))throw Error(R+" flavor was not found");var K=a[R];S=R;for(var U in K)K.hasOwnProperty(U)&&(y[U]=K[U])},this.getFlavor=function(){return S},this.removeExtension=function(R){t.helper.isArray(R)||(R=[R]);for(var K=0;K<R.length;++K){for(var U=R[K],te=0;te<b.length;++te)b[te]===U&&b.splice(te,1);for(var Ce=0;Ce<E.length;++Ce)E[Ce]===U&&E.splice(Ce,1)}},this.getAllExtensions=function(){return{language:b,output:E}},this.getMetadata=function(R){return R?A.raw:A.parsed},this.getMetadataFormat=function(){return A.format},this._setMetadataPair=function(R,K){A.parsed[R]=K},this._setMetadataFormat=function(R){A.format=R},this._setMetadataRaw=function(R){A.raw=R}},t.subParser("anchors",function(m,y,b){"use strict";m=b.converter._dispatch("anchors.before",m,y,b);var E=function(v,S,A,I,k,N,O){if(t.helper.isUndefined(O)&&(O=""),A=A.toLowerCase(),v.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)I="";else if(!I)if(A||(A=S.toLowerCase().replace(/ ?\n/g," ")),I="#"+A,!t.helper.isUndefined(b.gUrls[A]))I=b.gUrls[A],t.helper.isUndefined(b.gTitles[A])||(O=b.gTitles[A]);else return v;I=I.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var G='<a href="'+I+'"';return O!==""&&O!==null&&(O=O.replace(/"/g,"&quot;"),O=O.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),G+=' title="'+O+'"'),y.openLinksInNewWindow&&!/^#/.test(I)&&(G+=' rel="noopener noreferrer" target="\xA8E95Eblank"'),G+=">"+S+"</a>",G};return m=m.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,E),m=m.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,E),m=m.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,E),m=m.replace(/\[([^\[\]]+)]()()()()()/g,E),y.ghMentions&&(m=m.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(v,S,A,I,k){if(A==="\\")return S+I;if(!t.helper.isString(y.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var N=y.ghMentionsLink.replace(/\{u}/g,k),O="";return y.openLinksInNewWindow&&(O=' rel="noopener noreferrer" target="\xA8E95Eblank"'),S+'<a href="'+N+'"'+O+">"+I+"</a>"})),m=b.converter._dispatch("anchors.after",m,y,b),m});var f=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,h=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,d=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,p=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,g=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,w=function(m){"use strict";return function(y,b,E,v,S,A,I){E=E.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var k=E,N="",O="",G=b||"",R=I||"";return/^www\./i.test(E)&&(E=E.replace(/^www\./i,"http://www.")),m.excludeTrailingPunctuationFromURLs&&A&&(N=A),m.openLinksInNewWindow&&(O=' rel="noopener noreferrer" target="\xA8E95Eblank"'),G+'<a href="'+E+'"'+O+">"+k+"</a>"+N+R}},_=function(m,y){"use strict";return function(b,E,v){var S="mailto:";return E=E||"",v=t.subParser("unescapeSpecialChars")(v,m,y),m.encodeEmails?(S=t.helper.encodeEmailAddress(S+v),v=t.helper.encodeEmailAddress(v)):S=S+v,E+'<a href="'+S+'">'+v+"</a>"}};t.subParser("autoLinks",function(m,y,b){"use strict";return m=b.converter._dispatch("autoLinks.before",m,y,b),m=m.replace(d,w(y)),m=m.replace(g,_(y,b)),m=b.converter._dispatch("autoLinks.after",m,y,b),m}),t.subParser("simplifiedAutoLinks",function(m,y,b){"use strict";return y.simplifiedAutoLink&&(m=b.converter._dispatch("simplifiedAutoLinks.before",m,y,b),y.excludeTrailingPunctuationFromURLs?m=m.replace(h,w(y)):m=m.replace(f,w(y)),m=m.replace(p,_(y,b)),m=b.converter._dispatch("simplifiedAutoLinks.after",m,y,b)),m}),t.subParser("blockGamut",function(m,y,b){"use strict";return m=b.converter._dispatch("blockGamut.before",m,y,b),m=t.subParser("blockQuotes")(m,y,b),m=t.subParser("headers")(m,y,b),m=t.subParser("horizontalRule")(m,y,b),m=t.subParser("lists")(m,y,b),m=t.subParser("codeBlocks")(m,y,b),m=t.subParser("tables")(m,y,b),m=t.subParser("hashHTMLBlocks")(m,y,b),m=t.subParser("paragraphs")(m,y,b),m=b.converter._dispatch("blockGamut.after",m,y,b),m}),t.subParser("blockQuotes",function(m,y,b){"use strict";m=b.converter._dispatch("blockQuotes.before",m,y,b),m=m+`

`;var E=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return y.splitAdjacentBlockquotes&&(E=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),m=m.replace(E,function(v){return v=v.replace(/^[ \t]*>[ \t]?/gm,""),v=v.replace(/¨0/g,""),v=v.replace(/^[ \t]+$/gm,""),v=t.subParser("githubCodeBlocks")(v,y,b),v=t.subParser("blockGamut")(v,y,b),v=v.replace(/(^|\n)/g,"$1  "),v=v.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(S,A){var I=A;return I=I.replace(/^  /mg,"\xA80"),I=I.replace(/¨0/g,""),I}),t.subParser("hashBlock")(`<blockquote>
`+v+`
</blockquote>`,y,b)}),m=b.converter._dispatch("blockQuotes.after",m,y,b),m}),t.subParser("codeBlocks",function(m,y,b){"use strict";m=b.converter._dispatch("codeBlocks.before",m,y,b),m+="\xA80";var E=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return m=m.replace(E,function(v,S,A){var I=S,k=A,N=`
`;return I=t.subParser("outdent")(I,y,b),I=t.subParser("encodeCode")(I,y,b),I=t.subParser("detab")(I,y,b),I=I.replace(/^\n+/g,""),I=I.replace(/\n+$/g,""),y.omitExtraWLInCodeBlocks&&(N=""),I="<pre><code>"+I+N+"</code></pre>",t.subParser("hashBlock")(I,y,b)+k}),m=m.replace(/¨0/,""),m=b.converter._dispatch("codeBlocks.after",m,y,b),m}),t.subParser("codeSpans",function(m,y,b){"use strict";return m=b.converter._dispatch("codeSpans.before",m,y,b),typeof m>"u"&&(m=""),m=m.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(E,v,S,A){var I=A;return I=I.replace(/^([ \t]*)/g,""),I=I.replace(/[ \t]*$/g,""),I=t.subParser("encodeCode")(I,y,b),I=v+"<code>"+I+"</code>",I=t.subParser("hashHTMLSpans")(I,y,b),I}),m=b.converter._dispatch("codeSpans.after",m,y,b),m}),t.subParser("completeHTMLDocument",function(m,y,b){"use strict";if(!y.completeHTMLDocument)return m;m=b.converter._dispatch("completeHTMLDocument.before",m,y,b);var E="html",v=`<!DOCTYPE HTML>
`,S="",A=`<meta charset="utf-8">
`,I="",k="";typeof b.metadata.parsed.doctype<"u"&&(v="<!DOCTYPE "+b.metadata.parsed.doctype+`>
`,E=b.metadata.parsed.doctype.toString().toLowerCase(),(E==="html"||E==="html5")&&(A='<meta charset="utf-8">'));for(var N in b.metadata.parsed)if(b.metadata.parsed.hasOwnProperty(N))switch(N.toLowerCase()){case"doctype":break;case"title":S="<title>"+b.metadata.parsed.title+`</title>
`;break;case"charset":E==="html"||E==="html5"?A='<meta charset="'+b.metadata.parsed.charset+`">
`:A='<meta name="charset" content="'+b.metadata.parsed.charset+`">
`;break;case"language":case"lang":I=' lang="'+b.metadata.parsed[N]+'"',k+='<meta name="'+N+'" content="'+b.metadata.parsed[N]+`">
`;break;default:k+='<meta name="'+N+'" content="'+b.metadata.parsed[N]+`">
`}return m=v+"<html"+I+`>
<head>
`+S+A+k+`</head>
<body>
`+m.trim()+`
</body>
</html>`,m=b.converter._dispatch("completeHTMLDocument.after",m,y,b),m}),t.subParser("detab",function(m,y,b){"use strict";return m=b.converter._dispatch("detab.before",m,y,b),m=m.replace(/\t(?=\t)/g,"    "),m=m.replace(/\t/g,"\xA8A\xA8B"),m=m.replace(/¨B(.+?)¨A/g,function(E,v){for(var S=v,A=4-S.length%4,I=0;I<A;I++)S+=" ";return S}),m=m.replace(/¨A/g,"    "),m=m.replace(/¨B/g,""),m=b.converter._dispatch("detab.after",m,y,b),m}),t.subParser("ellipsis",function(m,y,b){"use strict";return y.ellipsis&&(m=b.converter._dispatch("ellipsis.before",m,y,b),m=m.replace(/\.\.\./g,"\u2026"),m=b.converter._dispatch("ellipsis.after",m,y,b)),m}),t.subParser("emoji",function(m,y,b){"use strict";if(!y.emoji)return m;m=b.converter._dispatch("emoji.before",m,y,b);var E=/:([\S]+?):/g;return m=m.replace(E,function(v,S){return t.helper.emojis.hasOwnProperty(S)?t.helper.emojis[S]:v}),m=b.converter._dispatch("emoji.after",m,y,b),m}),t.subParser("encodeAmpsAndAngles",function(m,y,b){"use strict";return m=b.converter._dispatch("encodeAmpsAndAngles.before",m,y,b),m=m.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),m=m.replace(/<(?![a-z\/?$!])/gi,"&lt;"),m=m.replace(/</g,"&lt;"),m=m.replace(/>/g,"&gt;"),m=b.converter._dispatch("encodeAmpsAndAngles.after",m,y,b),m}),t.subParser("encodeBackslashEscapes",function(m,y,b){"use strict";return m=b.converter._dispatch("encodeBackslashEscapes.before",m,y,b),m=m.replace(/\\(\\)/g,t.helper.escapeCharactersCallback),m=m.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,t.helper.escapeCharactersCallback),m=b.converter._dispatch("encodeBackslashEscapes.after",m,y,b),m}),t.subParser("encodeCode",function(m,y,b){"use strict";return m=b.converter._dispatch("encodeCode.before",m,y,b),m=m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,t.helper.escapeCharactersCallback),m=b.converter._dispatch("encodeCode.after",m,y,b),m}),t.subParser("escapeSpecialCharsWithinTagAttributes",function(m,y,b){"use strict";m=b.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",m,y,b);var E=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,v=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return m=m.replace(E,function(S){return S.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),m=m.replace(v,function(S){return S.replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),m=b.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",m,y,b),m}),t.subParser("githubCodeBlocks",function(m,y,b){"use strict";return y.ghCodeBlocks?(m=b.converter._dispatch("githubCodeBlocks.before",m,y,b),m+="\xA80",m=m.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(E,v,S,A){var I=y.omitExtraWLInCodeBlocks?"":`
`;return A=t.subParser("encodeCode")(A,y,b),A=t.subParser("detab")(A,y,b),A=A.replace(/^\n+/g,""),A=A.replace(/\n+$/g,""),A="<pre><code"+(S?' class="'+S+" language-"+S+'"':"")+">"+A+I+"</code></pre>",A=t.subParser("hashBlock")(A,y,b),`

\xA8G`+(b.ghCodeBlocks.push({text:E,codeblock:A})-1)+`G

`}),m=m.replace(/¨0/,""),b.converter._dispatch("githubCodeBlocks.after",m,y,b)):m}),t.subParser("hashBlock",function(m,y,b){"use strict";return m=b.converter._dispatch("hashBlock.before",m,y,b),m=m.replace(/(^\n+|\n+$)/g,""),m=`

\xA8K`+(b.gHtmlBlocks.push(m)-1)+`K

`,m=b.converter._dispatch("hashBlock.after",m,y,b),m}),t.subParser("hashCodeTags",function(m,y,b){"use strict";m=b.converter._dispatch("hashCodeTags.before",m,y,b);var E=function(v,S,A,I){var k=A+t.subParser("encodeCode")(S,y,b)+I;return"\xA8C"+(b.gHtmlSpans.push(k)-1)+"C"};return m=t.helper.replaceRecursiveRegExp(m,E,"<code\\b[^>]*>","</code>","gim"),m=b.converter._dispatch("hashCodeTags.after",m,y,b),m}),t.subParser("hashElement",function(m,y,b){"use strict";return function(E,v){var S=v;return S=S.replace(/\n\n/g,`
`),S=S.replace(/^\n/,""),S=S.replace(/\n+$/g,""),S=`

\xA8K`+(b.gHtmlBlocks.push(S)-1)+`K

`,S}}),t.subParser("hashHTMLBlocks",function(m,y,b){"use strict";m=b.converter._dispatch("hashHTMLBlocks.before",m,y,b);var E=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],v=function(R,K,U,te){var Ce=R;return U.search(/\bmarkdown\b/)!==-1&&(Ce=U+b.converter.makeHtml(K)+te),`

\xA8K`+(b.gHtmlBlocks.push(Ce)-1)+`K

`};y.backslashEscapesHTMLTags&&(m=m.replace(/\\<(\/?[^>]+?)>/g,function(R,K){return"&lt;"+K+"&gt;"}));for(var S=0;S<E.length;++S)for(var A,I=new RegExp("^ {0,3}(<"+E[S]+"\\b[^>]*>)","im"),k="<"+E[S]+"\\b[^>]*>",N="</"+E[S]+">";(A=t.helper.regexIndexOf(m,I))!==-1;){var O=t.helper.splitAtIndex(m,A),G=t.helper.replaceRecursiveRegExp(O[1],v,k,N,"im");if(G===O[1])break;m=O[0].concat(G)}return m=m.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(m,y,b)),m=t.helper.replaceRecursiveRegExp(m,function(R){return`

\xA8K`+(b.gHtmlBlocks.push(R)-1)+`K

`},"^ {0,3}<!--","-->","gm"),m=m.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(m,y,b)),m=b.converter._dispatch("hashHTMLBlocks.after",m,y,b),m}),t.subParser("hashHTMLSpans",function(m,y,b){"use strict";m=b.converter._dispatch("hashHTMLSpans.before",m,y,b);function E(v){return"\xA8C"+(b.gHtmlSpans.push(v)-1)+"C"}return m=m.replace(/<[^>]+?\/>/gi,function(v){return E(v)}),m=m.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(v){return E(v)}),m=m.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(v){return E(v)}),m=m.replace(/<[^>]+?>/gi,function(v){return E(v)}),m=b.converter._dispatch("hashHTMLSpans.after",m,y,b),m}),t.subParser("unhashHTMLSpans",function(m,y,b){"use strict";m=b.converter._dispatch("unhashHTMLSpans.before",m,y,b);for(var E=0;E<b.gHtmlSpans.length;++E){for(var v=b.gHtmlSpans[E],S=0;/¨C(\d+)C/.test(v);){var A=RegExp.$1;if(v=v.replace("\xA8C"+A+"C",b.gHtmlSpans[A]),S===10){console.error("maximum nesting of 10 spans reached!!!");break}++S}m=m.replace("\xA8C"+E+"C",v)}return m=b.converter._dispatch("unhashHTMLSpans.after",m,y,b),m}),t.subParser("hashPreCodeTags",function(m,y,b){"use strict";m=b.converter._dispatch("hashPreCodeTags.before",m,y,b);var E=function(v,S,A,I){var k=A+t.subParser("encodeCode")(S,y,b)+I;return`

\xA8G`+(b.ghCodeBlocks.push({text:v,codeblock:k})-1)+`G

`};return m=t.helper.replaceRecursiveRegExp(m,E,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),m=b.converter._dispatch("hashPreCodeTags.after",m,y,b),m}),t.subParser("headers",function(m,y,b){"use strict";m=b.converter._dispatch("headers.before",m,y,b);var E=isNaN(parseInt(y.headerLevelStart))?1:parseInt(y.headerLevelStart),v=y.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,S=y.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;m=m.replace(v,function(k,N){var O=t.subParser("spanGamut")(N,y,b),G=y.noHeaderId?"":' id="'+I(N)+'"',R=E,K="<h"+R+G+">"+O+"</h"+R+">";return t.subParser("hashBlock")(K,y,b)}),m=m.replace(S,function(k,N){var O=t.subParser("spanGamut")(N,y,b),G=y.noHeaderId?"":' id="'+I(N)+'"',R=E+1,K="<h"+R+G+">"+O+"</h"+R+">";return t.subParser("hashBlock")(K,y,b)});var A=y.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;m=m.replace(A,function(k,N,O){var G=O;y.customizedHeaderId&&(G=O.replace(/\s?\{([^{]+?)}\s*$/,""));var R=t.subParser("spanGamut")(G,y,b),K=y.noHeaderId?"":' id="'+I(O)+'"',U=E-1+N.length,te="<h"+U+K+">"+R+"</h"+U+">";return t.subParser("hashBlock")(te,y,b)});function I(k){var N,O;if(y.customizedHeaderId){var G=k.match(/\{([^{]+?)}\s*$/);G&&G[1]&&(k=G[1])}return N=k,t.helper.isString(y.prefixHeaderId)?O=y.prefixHeaderId:y.prefixHeaderId===!0?O="section-":O="",y.rawPrefixHeaderId||(N=O+N),y.ghCompatibleHeaderId?N=N.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():y.rawHeaderId?N=N.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"\xA8").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():N=N.replace(/[^\w]/g,"").toLowerCase(),y.rawPrefixHeaderId&&(N=O+N),b.hashLinkCounts[N]?N=N+"-"+b.hashLinkCounts[N]++:b.hashLinkCounts[N]=1,N}return m=b.converter._dispatch("headers.after",m,y,b),m}),t.subParser("horizontalRule",function(m,y,b){"use strict";m=b.converter._dispatch("horizontalRule.before",m,y,b);var E=t.subParser("hashBlock")("<hr />",y,b);return m=m.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,E),m=m.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,E),m=m.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,E),m=b.converter._dispatch("horizontalRule.after",m,y,b),m}),t.subParser("images",function(m,y,b){"use strict";m=b.converter._dispatch("images.before",m,y,b);var E=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,v=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,S=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,A=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,I=/!\[([^\[\]]+)]()()()()()/g;function k(O,G,R,K,U,te,Ce,ae){return K=K.replace(/\s/g,""),N(O,G,R,K,U,te,Ce,ae)}function N(O,G,R,K,U,te,Ce,ae){var $e=b.gUrls,He=b.gTitles,ot=b.gDimensions;if(R=R.toLowerCase(),ae||(ae=""),O.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)K="";else if(K===""||K===null)if((R===""||R===null)&&(R=G.toLowerCase().replace(/ ?\n/g," ")),K="#"+R,!t.helper.isUndefined($e[R]))K=$e[R],t.helper.isUndefined(He[R])||(ae=He[R]),t.helper.isUndefined(ot[R])||(U=ot[R].width,te=ot[R].height);else return O;G=G.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),K=K.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var Ge='<img src="'+K+'" alt="'+G+'"';return ae&&t.helper.isString(ae)&&(ae=ae.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),Ge+=' title="'+ae+'"'),U&&te&&(U=U==="*"?"auto":U,te=te==="*"?"auto":te,Ge+=' width="'+U+'"',Ge+=' height="'+te+'"'),Ge+=" />",Ge}return m=m.replace(A,N),m=m.replace(S,k),m=m.replace(v,N),m=m.replace(E,N),m=m.replace(I,N),m=b.converter._dispatch("images.after",m,y,b),m}),t.subParser("italicsAndBold",function(m,y,b){"use strict";m=b.converter._dispatch("italicsAndBold.before",m,y,b);function E(v,S,A){return S+v+A}return y.literalMidWordUnderscores?(m=m.replace(/\b___(\S[\s\S]*?)___\b/g,function(v,S){return E(S,"<strong><em>","</em></strong>")}),m=m.replace(/\b__(\S[\s\S]*?)__\b/g,function(v,S){return E(S,"<strong>","</strong>")}),m=m.replace(/\b_(\S[\s\S]*?)_\b/g,function(v,S){return E(S,"<em>","</em>")})):(m=m.replace(/___(\S[\s\S]*?)___/g,function(v,S){return/\S$/.test(S)?E(S,"<strong><em>","</em></strong>"):v}),m=m.replace(/__(\S[\s\S]*?)__/g,function(v,S){return/\S$/.test(S)?E(S,"<strong>","</strong>"):v}),m=m.replace(/_([^\s_][\s\S]*?)_/g,function(v,S){return/\S$/.test(S)?E(S,"<em>","</em>"):v})),y.literalMidWordAsterisks?(m=m.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(v,S,A){return E(A,S+"<strong><em>","</em></strong>")}),m=m.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(v,S,A){return E(A,S+"<strong>","</strong>")}),m=m.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(v,S,A){return E(A,S+"<em>","</em>")})):(m=m.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(v,S){return/\S$/.test(S)?E(S,"<strong><em>","</em></strong>"):v}),m=m.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(v,S){return/\S$/.test(S)?E(S,"<strong>","</strong>"):v}),m=m.replace(/\*([^\s*][\s\S]*?)\*/g,function(v,S){return/\S$/.test(S)?E(S,"<em>","</em>"):v})),m=b.converter._dispatch("italicsAndBold.after",m,y,b),m}),t.subParser("lists",function(m,y,b){"use strict";function E(A,I){b.gListLevel++,A=A.replace(/\n{2,}$/,`
`),A+="\xA80";var k=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,N=/\n[ \t]*\n(?!¨0)/.test(A);return y.disableForced4SpacesIndentedSublists&&(k=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),A=A.replace(k,function(O,G,R,K,U,te,Ce){Ce=Ce&&Ce.trim()!=="";var ae=t.subParser("outdent")(U,y,b),$e="";return te&&y.tasklists&&($e=' class="task-list-item" style="list-style-type: none;"',ae=ae.replace(/^[ \t]*\[(x|X| )?]/m,function(){var He='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return Ce&&(He+=" checked"),He+=">",He})),ae=ae.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(He){return"\xA8A"+He}),G||ae.search(/\n{2,}/)>-1?(ae=t.subParser("githubCodeBlocks")(ae,y,b),ae=t.subParser("blockGamut")(ae,y,b)):(ae=t.subParser("lists")(ae,y,b),ae=ae.replace(/\n$/,""),ae=t.subParser("hashHTMLBlocks")(ae,y,b),ae=ae.replace(/\n\n+/g,`

`),N?ae=t.subParser("paragraphs")(ae,y,b):ae=t.subParser("spanGamut")(ae,y,b)),ae=ae.replace("\xA8A",""),ae="<li"+$e+">"+ae+`</li>
`,ae}),A=A.replace(/¨0/g,""),b.gListLevel--,I&&(A=A.replace(/\s+$/,"")),A}function v(A,I){if(I==="ol"){var k=A.match(/^ *(\d+)\./);if(k&&k[1]!=="1")return' start="'+k[1]+'"'}return""}function S(A,I,k){var N=y.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,O=y.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,G=I==="ul"?N:O,R="";if(A.search(G)!==-1)(function U(te){var Ce=te.search(G),ae=v(A,I);Ce!==-1?(R+=`

<`+I+ae+`>
`+E(te.slice(0,Ce),!!k)+"</"+I+`>
`,I=I==="ul"?"ol":"ul",G=I==="ul"?N:O,U(te.slice(Ce))):R+=`

<`+I+ae+`>
`+E(te,!!k)+"</"+I+`>
`})(A);else{var K=v(A,I);R=`

<`+I+K+`>
`+E(A,!!k)+"</"+I+`>
`}return R}return m=b.converter._dispatch("lists.before",m,y,b),m+="\xA80",b.gListLevel?m=m.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(A,I,k){var N=k.search(/[*+-]/g)>-1?"ul":"ol";return S(I,N,!0)}):m=m.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(A,I,k,N){var O=N.search(/[*+-]/g)>-1?"ul":"ol";return S(k,O,!1)}),m=m.replace(/¨0/,""),m=b.converter._dispatch("lists.after",m,y,b),m}),t.subParser("metadata",function(m,y,b){"use strict";if(!y.metadata)return m;m=b.converter._dispatch("metadata.before",m,y,b);function E(v){b.metadata.raw=v,v=v.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),v=v.replace(/\n {4}/g," "),v.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(S,A,I){return b.metadata.parsed[A]=I,""})}return m=m.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(v,S,A){return E(A),"\xA8M"}),m=m.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(v,S,A){return S&&(b.metadata.format=S),E(A),"\xA8M"}),m=m.replace(/¨M/g,""),m=b.converter._dispatch("metadata.after",m,y,b),m}),t.subParser("outdent",function(m,y,b){"use strict";return m=b.converter._dispatch("outdent.before",m,y,b),m=m.replace(/^(\t|[ ]{1,4})/gm,"\xA80"),m=m.replace(/¨0/g,""),m=b.converter._dispatch("outdent.after",m,y,b),m}),t.subParser("paragraphs",function(m,y,b){"use strict";m=b.converter._dispatch("paragraphs.before",m,y,b),m=m.replace(/^\n+/g,""),m=m.replace(/\n+$/g,"");for(var E=m.split(/\n{2,}/g),v=[],S=E.length,A=0;A<S;A++){var I=E[A];I.search(/¨(K|G)(\d+)\1/g)>=0?v.push(I):I.search(/\S/)>=0&&(I=t.subParser("spanGamut")(I,y,b),I=I.replace(/^([ \t]*)/g,"<p>"),I+="</p>",v.push(I))}for(S=v.length,A=0;A<S;A++){for(var k="",N=v[A],O=!1;/¨(K|G)(\d+)\1/.test(N);){var G=RegExp.$1,R=RegExp.$2;G==="K"?k=b.gHtmlBlocks[R]:O?k=t.subParser("encodeCode")(b.ghCodeBlocks[R].text,y,b):k=b.ghCodeBlocks[R].codeblock,k=k.replace(/\$/g,"$$$$"),N=N.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,k),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(N)&&(O=!0)}v[A]=N}return m=v.join(`
`),m=m.replace(/^\n+/g,""),m=m.replace(/\n+$/g,""),b.converter._dispatch("paragraphs.after",m,y,b)}),t.subParser("runExtension",function(m,y,b,E){"use strict";if(m.filter)y=m.filter(y,E.converter,b);else if(m.regex){var v=m.regex;v instanceof RegExp||(v=new RegExp(v,"g")),y=y.replace(v,m.replace)}return y}),t.subParser("spanGamut",function(m,y,b){"use strict";return m=b.converter._dispatch("spanGamut.before",m,y,b),m=t.subParser("codeSpans")(m,y,b),m=t.subParser("escapeSpecialCharsWithinTagAttributes")(m,y,b),m=t.subParser("encodeBackslashEscapes")(m,y,b),m=t.subParser("images")(m,y,b),m=t.subParser("anchors")(m,y,b),m=t.subParser("autoLinks")(m,y,b),m=t.subParser("simplifiedAutoLinks")(m,y,b),m=t.subParser("emoji")(m,y,b),m=t.subParser("underline")(m,y,b),m=t.subParser("italicsAndBold")(m,y,b),m=t.subParser("strikethrough")(m,y,b),m=t.subParser("ellipsis")(m,y,b),m=t.subParser("hashHTMLSpans")(m,y,b),m=t.subParser("encodeAmpsAndAngles")(m,y,b),y.simpleLineBreaks?/\n\n¨K/.test(m)||(m=m.replace(/\n+/g,`<br />
`)):m=m.replace(/  +\n/g,`<br />
`),m=b.converter._dispatch("spanGamut.after",m,y,b),m}),t.subParser("strikethrough",function(m,y,b){"use strict";function E(v){return y.simplifiedAutoLink&&(v=t.subParser("simplifiedAutoLinks")(v,y,b)),"<del>"+v+"</del>"}return y.strikethrough&&(m=b.converter._dispatch("strikethrough.before",m,y,b),m=m.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(v,S){return E(S)}),m=b.converter._dispatch("strikethrough.after",m,y,b)),m}),t.subParser("stripLinkDefinitions",function(m,y,b){"use strict";var E=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,v=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;m+="\xA80";var S=function(A,I,k,N,O,G,R){return I=I.toLowerCase(),m.toLowerCase().split(I).length-1<2?A:(k.match(/^data:.+?\/.+?;base64,/)?b.gUrls[I]=k.replace(/\s/g,""):b.gUrls[I]=t.subParser("encodeAmpsAndAngles")(k,y,b),G?G+R:(R&&(b.gTitles[I]=R.replace(/"|'/g,"&quot;")),y.parseImgDimensions&&N&&O&&(b.gDimensions[I]={width:N,height:O}),""))};return m=m.replace(v,S),m=m.replace(E,S),m=m.replace(/¨0/,""),m}),t.subParser("tables",function(m,y,b){"use strict";if(!y.tables)return m;var E=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,v=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function S(O){return/^:[ \t]*--*$/.test(O)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(O)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(O)?' style="text-align:center;"':""}function A(O,G){var R="";return O=O.trim(),(y.tablesHeaderId||y.tableHeaderId)&&(R=' id="'+O.replace(/ /g,"_").toLowerCase()+'"'),O=t.subParser("spanGamut")(O,y,b),"<th"+R+G+">"+O+`</th>
`}function I(O,G){var R=t.subParser("spanGamut")(O,y,b);return"<td"+G+">"+R+`</td>
`}function k(O,G){for(var R=`<table>
<thead>
<tr>
`,K=O.length,U=0;U<K;++U)R+=O[U];for(R+=`</tr>
</thead>
<tbody>
`,U=0;U<G.length;++U){R+=`<tr>
`;for(var te=0;te<K;++te)R+=G[U][te];R+=`</tr>
`}return R+=`</tbody>
</table>
`,R}function N(O){var G,R=O.split(`
`);for(G=0;G<R.length;++G)/^ {0,3}\|/.test(R[G])&&(R[G]=R[G].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(R[G])&&(R[G]=R[G].replace(/\|[ \t]*$/,"")),R[G]=t.subParser("codeSpans")(R[G],y,b);var K=R[0].split("|").map(function(Ge){return Ge.trim()}),U=R[1].split("|").map(function(Ge){return Ge.trim()}),te=[],Ce=[],ae=[],$e=[];for(R.shift(),R.shift(),G=0;G<R.length;++G)R[G].trim()!==""&&te.push(R[G].split("|").map(function(Ge){return Ge.trim()}));if(K.length<U.length)return O;for(G=0;G<U.length;++G)ae.push(S(U[G]));for(G=0;G<K.length;++G)t.helper.isUndefined(ae[G])&&(ae[G]=""),Ce.push(A(K[G],ae[G]));for(G=0;G<te.length;++G){for(var He=[],ot=0;ot<Ce.length;++ot)t.helper.isUndefined(te[G][ot]),He.push(I(te[G][ot],ae[ot]));$e.push(He)}return k(Ce,$e)}return m=b.converter._dispatch("tables.before",m,y,b),m=m.replace(/\\(\|)/g,t.helper.escapeCharactersCallback),m=m.replace(E,N),m=m.replace(v,N),m=b.converter._dispatch("tables.after",m,y,b),m}),t.subParser("underline",function(m,y,b){"use strict";return y.underline&&(m=b.converter._dispatch("underline.before",m,y,b),y.literalMidWordUnderscores?(m=m.replace(/\b___(\S[\s\S]*?)___\b/g,function(E,v){return"<u>"+v+"</u>"}),m=m.replace(/\b__(\S[\s\S]*?)__\b/g,function(E,v){return"<u>"+v+"</u>"})):(m=m.replace(/___(\S[\s\S]*?)___/g,function(E,v){return/\S$/.test(v)?"<u>"+v+"</u>":E}),m=m.replace(/__(\S[\s\S]*?)__/g,function(E,v){return/\S$/.test(v)?"<u>"+v+"</u>":E})),m=m.replace(/(_)/g,t.helper.escapeCharactersCallback),m=b.converter._dispatch("underline.after",m,y,b)),m}),t.subParser("unescapeSpecialChars",function(m,y,b){"use strict";return m=b.converter._dispatch("unescapeSpecialChars.before",m,y,b),m=m.replace(/¨E(\d+)E/g,function(E,v){var S=parseInt(v);return String.fromCharCode(S)}),m=b.converter._dispatch("unescapeSpecialChars.after",m,y,b),m}),t.subParser("makeMarkdown.blockquote",function(m,y){"use strict";var b="";if(m.hasChildNodes())for(var E=m.childNodes,v=E.length,S=0;S<v;++S){var A=t.subParser("makeMarkdown.node")(E[S],y);A!==""&&(b+=A)}return b=b.trim(),b="> "+b.split(`
`).join(`
> `),b}),t.subParser("makeMarkdown.codeBlock",function(m,y){"use strict";var b=m.getAttribute("language"),E=m.getAttribute("precodenum");return"```"+b+`
`+y.preList[E]+"\n```"}),t.subParser("makeMarkdown.codeSpan",function(m){"use strict";return"`"+m.innerHTML+"`"}),t.subParser("makeMarkdown.emphasis",function(m,y){"use strict";var b="";if(m.hasChildNodes()){b+="*";for(var E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);b+="*"}return b}),t.subParser("makeMarkdown.header",function(m,y,b){"use strict";var E=new Array(b+1).join("#"),v="";if(m.hasChildNodes()){v=E+" ";for(var S=m.childNodes,A=S.length,I=0;I<A;++I)v+=t.subParser("makeMarkdown.node")(S[I],y)}return v}),t.subParser("makeMarkdown.hr",function(){"use strict";return"---"}),t.subParser("makeMarkdown.image",function(m){"use strict";var y="";return m.hasAttribute("src")&&(y+="!["+m.getAttribute("alt")+"](",y+="<"+m.getAttribute("src")+">",m.hasAttribute("width")&&m.hasAttribute("height")&&(y+=" ="+m.getAttribute("width")+"x"+m.getAttribute("height")),m.hasAttribute("title")&&(y+=' "'+m.getAttribute("title")+'"'),y+=")"),y}),t.subParser("makeMarkdown.links",function(m,y){"use strict";var b="";if(m.hasChildNodes()&&m.hasAttribute("href")){var E=m.childNodes,v=E.length;b="[";for(var S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);b+="](",b+="<"+m.getAttribute("href")+">",m.hasAttribute("title")&&(b+=' "'+m.getAttribute("title")+'"'),b+=")"}return b}),t.subParser("makeMarkdown.list",function(m,y,b){"use strict";var E="";if(!m.hasChildNodes())return"";for(var v=m.childNodes,S=v.length,A=m.getAttribute("start")||1,I=0;I<S;++I)if(!(typeof v[I].tagName>"u"||v[I].tagName.toLowerCase()!=="li")){var k="";b==="ol"?k=A.toString()+". ":k="- ",E+=k+t.subParser("makeMarkdown.listItem")(v[I],y),++A}return E+=`
<!-- -->
`,E.trim()}),t.subParser("makeMarkdown.listItem",function(m,y){"use strict";for(var b="",E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);return/\n$/.test(b)?b=b.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):b+=`
`,b}),t.subParser("makeMarkdown.node",function(m,y,b){"use strict";b=b||!1;var E="";if(m.nodeType===3)return t.subParser("makeMarkdown.txt")(m,y);if(m.nodeType===8)return"<!--"+m.data+`-->

`;if(m.nodeType!==1)return"";var v=m.tagName.toLowerCase();switch(v){case"h1":b||(E=t.subParser("makeMarkdown.header")(m,y,1)+`

`);break;case"h2":b||(E=t.subParser("makeMarkdown.header")(m,y,2)+`

`);break;case"h3":b||(E=t.subParser("makeMarkdown.header")(m,y,3)+`

`);break;case"h4":b||(E=t.subParser("makeMarkdown.header")(m,y,4)+`

`);break;case"h5":b||(E=t.subParser("makeMarkdown.header")(m,y,5)+`

`);break;case"h6":b||(E=t.subParser("makeMarkdown.header")(m,y,6)+`

`);break;case"p":b||(E=t.subParser("makeMarkdown.paragraph")(m,y)+`

`);break;case"blockquote":b||(E=t.subParser("makeMarkdown.blockquote")(m,y)+`

`);break;case"hr":b||(E=t.subParser("makeMarkdown.hr")(m,y)+`

`);break;case"ol":b||(E=t.subParser("makeMarkdown.list")(m,y,"ol")+`

`);break;case"ul":b||(E=t.subParser("makeMarkdown.list")(m,y,"ul")+`

`);break;case"precode":b||(E=t.subParser("makeMarkdown.codeBlock")(m,y)+`

`);break;case"pre":b||(E=t.subParser("makeMarkdown.pre")(m,y)+`

`);break;case"table":b||(E=t.subParser("makeMarkdown.table")(m,y)+`

`);break;case"code":E=t.subParser("makeMarkdown.codeSpan")(m,y);break;case"em":case"i":E=t.subParser("makeMarkdown.emphasis")(m,y);break;case"strong":case"b":E=t.subParser("makeMarkdown.strong")(m,y);break;case"del":E=t.subParser("makeMarkdown.strikethrough")(m,y);break;case"a":E=t.subParser("makeMarkdown.links")(m,y);break;case"img":E=t.subParser("makeMarkdown.image")(m,y);break;default:E=m.outerHTML+`

`}return E}),t.subParser("makeMarkdown.paragraph",function(m,y){"use strict";var b="";if(m.hasChildNodes())for(var E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);return b=b.trim(),b}),t.subParser("makeMarkdown.pre",function(m,y){"use strict";var b=m.getAttribute("prenum");return"<pre>"+y.preList[b]+"</pre>"}),t.subParser("makeMarkdown.strikethrough",function(m,y){"use strict";var b="";if(m.hasChildNodes()){b+="~~";for(var E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);b+="~~"}return b}),t.subParser("makeMarkdown.strong",function(m,y){"use strict";var b="";if(m.hasChildNodes()){b+="**";for(var E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y);b+="**"}return b}),t.subParser("makeMarkdown.table",function(m,y){"use strict";var b="",E=[[],[]],v=m.querySelectorAll("thead>tr>th"),S=m.querySelectorAll("tbody>tr"),A,I;for(A=0;A<v.length;++A){var k=t.subParser("makeMarkdown.tableCell")(v[A],y),N="---";if(v[A].hasAttribute("style")){var O=v[A].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(O){case"text-align:left;":N=":---";break;case"text-align:right;":N="---:";break;case"text-align:center;":N=":---:";break}}E[0][A]=k.trim(),E[1][A]=N}for(A=0;A<S.length;++A){var G=E.push([])-1,R=S[A].getElementsByTagName("td");for(I=0;I<v.length;++I){var K=" ";typeof R[I]<"u"&&(K=t.subParser("makeMarkdown.tableCell")(R[I],y)),E[G].push(K)}}var U=3;for(A=0;A<E.length;++A)for(I=0;I<E[A].length;++I){var te=E[A][I].length;te>U&&(U=te)}for(A=0;A<E.length;++A){for(I=0;I<E[A].length;++I)A===1?E[A][I].slice(-1)===":"?E[A][I]=t.helper.padEnd(E[A][I].slice(-1),U-1,"-")+":":E[A][I]=t.helper.padEnd(E[A][I],U,"-"):E[A][I]=t.helper.padEnd(E[A][I],U);b+="| "+E[A].join(" | ")+` |
`}return b.trim()}),t.subParser("makeMarkdown.tableCell",function(m,y){"use strict";var b="";if(!m.hasChildNodes())return"";for(var E=m.childNodes,v=E.length,S=0;S<v;++S)b+=t.subParser("makeMarkdown.node")(E[S],y,!0);return b.trim()}),t.subParser("makeMarkdown.txt",function(m){"use strict";var y=m.nodeValue;return y=y.replace(/ +/g," "),y=y.replace(/¨NBSP;/g," "),y=t.helper.unescapeHTMLEntities(y),y=y.replace(/([*_~|`])/g,"\\$1"),y=y.replace(/^(\s*)>/g,"\\$1>"),y=y.replace(/^#/gm,"\\#"),y=y.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),y=y.replace(/^( {0,3}\d+)\./gm,"$1\\."),y=y.replace(/^( {0,3})([+-])/gm,"$1\\$2"),y=y.replace(/]([\s]*)\(/g,"\\]$1\\("),y=y.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),y});var x=this;typeof define=="function"&&define.amd?define(function(){"use strict";return t}):typeof x6<"u"&&x6.exports?x6.exports=t:x.showdown=t}).call(wF)});var GF=P((aWe,HF)=>{"use strict";HF.exports=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}});var _A=P((QF,XF)=>{"use strict";var T6=GF(),{hasOwnProperty:WF}=Object.prototype,{propertyIsEnumerable:Dwe}=Object,F0=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),Owe=QF,jF={concatArrays:!1,ignoreUndefined:!1},I6=r=>{let e=[];for(let t in r)WF.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)Dwe.call(r,n)&&e.push(n)}return e};function z0(r){return Array.isArray(r)?Lwe(r):T6(r)?Bwe(r):r}function Lwe(r){let e=r.slice(0,0);return I6(r).forEach(t=>{F0(e,t,z0(r[t]))}),e}function Bwe(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return I6(r).forEach(t=>{F0(e,t,z0(r[t]))}),e}var YF=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?F0(r,i,bA(r[i],e[i],n)):F0(r,i,z0(e[i])))}),r),Mwe=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(o=>{let s=[];for(let a=0;a<o.length;a++)WF.call(o,a)&&(s.push(String(a)),o===r?F0(n,i++,o[a]):F0(n,i++,z0(o[a])));n=YF(n,o,I6(o).filter(a=>!s.includes(a)),t)}),n};function bA(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?Mwe(r,e,t):!T6(e)||!T6(r)?z0(e):YF(r,e,I6(e),t)}XF.exports=function(...r){let e=bA(z0(jF),this!==Owe&&this||{},jF),t={_:{}};for(let n of r)if(n!==void 0){if(!T6(n))throw new TypeError("`"+n+"` is not an Option Object");t=bA(t,{_:n},e)}return t._}});var EA=P((uWe,JF)=>{function Uwe(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}JF.exports=Uwe});var C6=P((lWe,ez)=>{"use strict";var Fwe=EA(),R6=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,Hg=Fwe(),zwe=R6&&!Hg,Vwe=Hg&&!R6,Kwe=Hg&&R6,$we=typeof k0=="function"&&typeof process<"u"&&typeof process.release<"u"&&process.release.name==="node"&&!Hg,qwe=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Hwe=typeof process<"u"&&typeof process.env<"u"&&!1,Gwe=typeof navigator<"u"&&navigator.product==="ReactNative";ez.exports={isTest:Hwe,isElectron:Hg,isElectronMain:Vwe,isElectronRenderer:Kwe,isNode:$we,isBrowser:zwe,isWebWorker:qwe,isEnvWithDom:R6,isReactNative:Gwe}});var vA=P((dWe,tz)=>{var V0=1e3,K0=V0*60,$0=K0*60,lh=$0*24,jwe=lh*7,Wwe=lh*365.25;tz.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Ywe(r);if(t==="number"&&isFinite(r))return e.long?Xwe(r):Qwe(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Ywe(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Wwe;case"weeks":case"week":case"w":return t*jwe;case"days":case"day":case"d":return t*lh;case"hours":case"hour":case"hrs":case"hr":case"h":return t*$0;case"minutes":case"minute":case"mins":case"min":case"m":return t*K0;case"seconds":case"second":case"secs":case"sec":case"s":return t*V0;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Qwe(r){var e=Math.abs(r);return e>=lh?Math.round(r/lh)+"d":e>=$0?Math.round(r/$0)+"h":e>=K0?Math.round(r/K0)+"m":e>=V0?Math.round(r/V0)+"s":r+"ms"}function Xwe(r){var e=Math.abs(r);return e>=lh?P6(r,e,lh,"day"):e>=$0?P6(r,e,$0,"hour"):e>=K0?P6(r,e,K0,"minute"):e>=V0?P6(r,e,V0,"second"):r+" ms"}function P6(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var nz=P((hWe,rz)=>{function Zwe(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=vA(),t.destroy=u,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let h=0;h<l.length;h++)f=(f<<5)-f+l.charCodeAt(h),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,h=null,d,p;function g(...w){if(!g.enabled)return;let _=g,x=Number(new Date),m=x-(f||x);_.diff=m,_.prev=f,_.curr=x,f=x,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let y=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(E,v)=>{if(E==="%%")return"%";y++;let S=t.formatters[v];if(typeof S=="function"){let A=w[y];E=S.call(_,A),w.splice(y,1),y--}return E}),t.formatArgs.call(_,w),(_.log||t.log).apply(_,w)}return g.namespace=l,g.useColors=t.useColors(),g.color=t.selectColor(l),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(d!==t.namespaces&&(d=t.namespaces,p=t.enabled(l)),p),set:w=>{h=w}}),typeof t.init=="function"&&t.init(g),g}function n(l,f){let h=t(this.namespace+(typeof f>"u"?":":f)+l);return h.log=this.log,h}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f,h=(typeof l=="string"?l:"").split(/[\s,]+/),d=h.length;for(f=0;f<d;f++)h[f]&&(l=h[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function o(){let l=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),l}function s(l){if(l[l.length-1]==="*")return!0;let f,h;for(f=0,h=t.skips.length;f<h;f++)if(t.skips[f].test(l))return!1;for(f=0,h=t.names.length;f<h;f++)if(t.names[f].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}rz.exports=Zwe});var xA=P((Ro,k6)=>{Ro.formatArgs=e5e;Ro.save=t5e;Ro.load=r5e;Ro.useColors=Jwe;Ro.storage=n5e();Ro.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Ro.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Jwe(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function e5e(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+k6.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Ro.log=console.debug||console.log||(()=>{});function t5e(r){try{r?Ro.storage.setItem("debug",r):Ro.storage.removeItem("debug")}catch{}}function r5e(){let r;try{r=Ro.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function n5e(){try{return localStorage}catch{}}k6.exports=nz()(Ro);var{formatters:i5e}=k6.exports;i5e.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ee=P((bWe,oz)=>{"use strict";function iz(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function c5e(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return iz(r,t)}catch{t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),iz(new i,t)}}oz.exports=c5e});var N6=P((_We,sz)=>{"use strict";sz.exports=u5e;function u5e(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(l){if(o)if(o=!1,l)c(l);else{for(var f=new Array(arguments.length-1),h=0;h<f.length;)f[h++]=arguments[h];a.apply(null,f)}};try{r.apply(e||null,t)}catch(u){o&&(o=!1,c(u))}})}});var O6=P(uz=>{"use strict";var D6=uz;D6.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var q0=new Array(64),cz=new Array(123);for(xa=0;xa<64;)cz[q0[xa]=xa<26?xa+65:xa<52?xa+71:xa<62?xa-4:xa-59|43]=xa++;var xa;D6.encode=function(e,t,n){for(var i=null,o=[],s=0,a=0,c;t<n;){var u=e[t++];switch(a){case 0:o[s++]=q0[u>>2],c=(u&3)<<4,a=1;break;case 1:o[s++]=q0[c|u>>4],c=(u&15)<<2,a=2;break;case 2:o[s++]=q0[c|u>>6],o[s++]=q0[u&63],a=0;break}s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0)}return a&&(o[s++]=q0[c],o[s++]=61,a===1&&(o[s++]=61)),i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var az="invalid encoding";D6.decode=function(e,t,n){for(var i=n,o=0,s,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&o>1)break;if((c=cz[c])===void 0)throw Error(az);switch(o){case 0:s=c,o=1;break;case 1:t[n++]=s<<2|(c&48)>>4,s=c,o=2;break;case 2:t[n++]=(s&15)<<4|(c&60)>>2,s=c,o=3;break;case 3:t[n++]=(s&3)<<6|c,o=0;break}}if(o===1)throw Error(az);return n-i};D6.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var B6=P((vWe,lz)=>{"use strict";lz.exports=L6;function L6(){this._listeners={}}L6.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};L6.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};L6.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var M6=P((xWe,gz)=>{"use strict";gz.exports=fz(fz);function fz(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,u,l){e[0]=c,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3]}function o(c,u,l){e[0]=c,u[l]=t[3],u[l+1]=t[2],u[l+2]=t[1],u[l+3]=t[0]}r.writeFloatLE=n?i:o,r.writeFloatBE=n?o:i;function s(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],e[0]}function a(c,u){return t[3]=c[u],t[2]=c[u+1],t[1]=c[u+2],t[0]=c[u+3],e[0]}r.readFloatLE=n?s:a,r.readFloatBE=n?a:s}():function(){function e(n,i,o,s){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,o,s);else if(isNaN(i))n(2143289344,o,s);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,o,s);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,o,s);else{var c=Math.floor(Math.log(i)/Math.LN2),u=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|u)>>>0,o,s)}}r.writeFloatLE=e.bind(null,dz),r.writeFloatBE=e.bind(null,hz);function t(n,i,o){var s=n(i,o),a=(s>>31)*2+1,c=s>>>23&255,u=s&8388607;return c===255?u?NaN:a*(1/0):c===0?a*1401298464324817e-60*u:a*Math.pow(2,c-150)*(u+8388608)}r.readFloatLE=t.bind(null,pz),r.readFloatBE=t.bind(null,mz)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,u,l){e[0]=c,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3],u[l+4]=t[4],u[l+5]=t[5],u[l+6]=t[6],u[l+7]=t[7]}function o(c,u,l){e[0]=c,u[l]=t[7],u[l+1]=t[6],u[l+2]=t[5],u[l+3]=t[4],u[l+4]=t[3],u[l+5]=t[2],u[l+6]=t[1],u[l+7]=t[0]}r.writeDoubleLE=n?i:o,r.writeDoubleBE=n?o:i;function s(c,u){return t[0]=c[u],t[1]=c[u+1],t[2]=c[u+2],t[3]=c[u+3],t[4]=c[u+4],t[5]=c[u+5],t[6]=c[u+6],t[7]=c[u+7],e[0]}function a(c,u){return t[7]=c[u],t[6]=c[u+1],t[5]=c[u+2],t[4]=c[u+3],t[3]=c[u+4],t[2]=c[u+5],t[1]=c[u+6],t[0]=c[u+7],e[0]}r.readDoubleLE=n?s:a,r.readDoubleBE=n?a:s}():function(){function e(n,i,o,s,a,c){var u=s<0?1:0;if(u&&(s=-s),s===0)n(0,a,c+i),n(1/s>0?0:2147483648,a,c+o);else if(isNaN(s))n(0,a,c+i),n(2146959360,a,c+o);else if(s>17976931348623157e292)n(0,a,c+i),n((u<<31|2146435072)>>>0,a,c+o);else{var l;if(s<22250738585072014e-324)l=s/5e-324,n(l>>>0,a,c+i),n((u<<31|l/4294967296)>>>0,a,c+o);else{var f=Math.floor(Math.log(s)/Math.LN2);f===1024&&(f=1023),l=s*Math.pow(2,-f),n(l*4503599627370496>>>0,a,c+i),n((u<<31|f+1023<<20|l*1048576&1048575)>>>0,a,c+o)}}}r.writeDoubleLE=e.bind(null,dz,0,4),r.writeDoubleBE=e.bind(null,hz,4,0);function t(n,i,o,s,a){var c=n(s,a+i),u=n(s,a+o),l=(u>>31)*2+1,f=u>>>20&2047,h=4294967296*(u&1048575)+c;return f===2047?h?NaN:l*(1/0):f===0?l*5e-324*h:l*Math.pow(2,f-1075)*(h+4503599627370496)}r.readDoubleLE=t.bind(null,pz,0,4),r.readDoubleBE=t.bind(null,mz,4,0)}(),r}function dz(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function hz(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function pz(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function mz(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var U6=P((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var F6=P(yz=>{"use strict";var AA=yz;AA.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};AA.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var o=null,s=[],a=0,c;t<n;)c=e[t++],c<128?s[a++]=c:c>191&&c<224?s[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[a++]=55296+(c>>10),s[a++]=56320+(c&1023)):s[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};AA.write=function(e,t,n){for(var i=n,o,s,a=0;a<e.length;++a)o=e.charCodeAt(a),o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(a+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++a,t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=o&63|128):(t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=o&63|128);return n-i}});var z6=P((AWe,wz)=>{"use strict";wz.exports=l5e;function l5e(r,e,t){var n=t||8192,i=n>>>1,o=null,s=n;return function(c){if(c<1||c>i)return r(c);s+c>n&&(o=r(n),s=0);var u=e.call(o,s,s+=c);return s&7&&(s=(s|7)+1),u}}});var _z=P((TWe,bz)=>{"use strict";bz.exports=Qn;var jg=Du();function Qn(r,e){this.lo=r>>>0,this.hi=e>>>0}var dh=Qn.zero=new Qn(0,0);dh.toNumber=function(){return 0};dh.zzEncode=dh.zzDecode=function(){return this};dh.length=function(){return 1};var f5e=Qn.zeroHash="\0\0\0\0\0\0\0\0";Qn.fromNumber=function(e){if(e===0)return dh;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Qn(n,i)};Qn.from=function(e){if(typeof e=="number")return Qn.fromNumber(e);if(jg.isString(e))if(jg.Long)e=jg.Long.fromString(e);else return Qn.fromNumber(parseInt(e,10));return e.low||e.high?new Qn(e.low>>>0,e.high>>>0):dh};Qn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};Qn.prototype.toLong=function(e){return jg.Long?new jg.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var of=String.prototype.charCodeAt;Qn.fromHash=function(e){return e===f5e?dh:new Qn((of.call(e,0)|of.call(e,1)<<8|of.call(e,2)<<16|of.call(e,3)<<24)>>>0,(of.call(e,4)|of.call(e,5)<<8|of.call(e,6)<<16|of.call(e,7)<<24)>>>0)};Qn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Qn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Qn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Qn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Du=P(TA=>{"use strict";var Le=TA;Le.asPromise=N6();Le.base64=O6();Le.EventEmitter=B6();Le.float=M6();Le.inquire=U6();Le.utf8=F6();Le.pool=z6();Le.LongBits=_z();Le.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Le.global=Le.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||TA;Le.emptyArray=Object.freeze?Object.freeze([]):[];Le.emptyObject=Object.freeze?Object.freeze({}):{};Le.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Le.isString=function(e){return typeof e=="string"||e instanceof String};Le.isObject=function(e){return e&&typeof e=="object"};Le.isset=Le.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Le.Buffer=function(){try{var r=Le.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Le._Buffer_from=null;Le._Buffer_allocUnsafe=null;Le.newBuffer=function(e){return typeof e=="number"?Le.Buffer?Le._Buffer_allocUnsafe(e):new Le.Array(e):Le.Buffer?Le._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Le.Array=typeof Uint8Array<"u"?Uint8Array:Array;Le.Long=Le.global.dcodeIO&&Le.global.dcodeIO.Long||Le.global.Long||Le.inquire("long");Le.key2Re=/^true|false|0|1$/;Le.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Le.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Le.longToHash=function(e){return e?Le.LongBits.from(e).toHash():Le.LongBits.zeroHash};Le.longFromHash=function(e,t){var n=Le.LongBits.fromHash(e);return Le.Long?Le.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)};function Ez(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Le.merge=Ez;Le.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function vz(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Ez(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Le.newError=vz;Le.ProtocolError=vz("ProtocolError");Le.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),o=i.length-1;o>-1;--o)if(t[i[o]]===1&&this[i[o]]!==void 0&&this[i[o]]!==null)return i[o]}};Le.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Le.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Le._configure=function(){var r=Le.Buffer;if(!r){Le._Buffer_from=Le._Buffer_allocUnsafe=null;return}Le._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Le._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var K6=P((RWe,Tz)=>{"use strict";Tz.exports=Ht;var As=Du(),IA,V6=As.LongBits,xz=As.base64,Sz=As.utf8;function Wg(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function CA(){}function d5e(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Ht(){this.len=0,this.head=new Wg(CA,0,0),this.tail=this.head,this.states=null}var Az=function(){return As.Buffer?function(){return(Ht.create=function(){return new IA})()}:function(){return new Ht}};Ht.create=Az();Ht.alloc=function(e){return new As.Array(e)};As.Array!==Array&&(Ht.alloc=As.pool(Ht.alloc,As.Array.prototype.subarray));Ht.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Wg(e,t,n),this.len+=t,this};function PA(r,e,t){e[t]=r&255}function h5e(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function kA(r,e){this.len=r,this.next=void 0,this.val=e}kA.prototype=Object.create(Wg.prototype);kA.prototype.fn=h5e;Ht.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new kA((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Ht.prototype.int32=function(e){return e<0?this._push(NA,10,V6.fromNumber(e)):this.uint32(e)};Ht.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function NA(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Ht.prototype.uint64=function(e){var t=V6.from(e);return this._push(NA,t.length(),t)};Ht.prototype.int64=Ht.prototype.uint64;Ht.prototype.sint64=function(e){var t=V6.from(e).zzEncode();return this._push(NA,t.length(),t)};Ht.prototype.bool=function(e){return this._push(PA,1,e?1:0)};function RA(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Ht.prototype.fixed32=function(e){return this._push(RA,4,e>>>0)};Ht.prototype.sfixed32=Ht.prototype.fixed32;Ht.prototype.fixed64=function(e){var t=V6.from(e);return this._push(RA,4,t.lo)._push(RA,4,t.hi)};Ht.prototype.sfixed64=Ht.prototype.fixed64;Ht.prototype.float=function(e){return this._push(As.float.writeFloatLE,4,e)};Ht.prototype.double=function(e){return this._push(As.float.writeDoubleLE,8,e)};var p5e=As.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Ht.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(PA,1,0);if(As.isString(e)){var n=Ht.alloc(t=xz.length(e));xz.decode(e,n,0),e=n}return this.uint32(t)._push(p5e,t,e)};Ht.prototype.string=function(e){var t=Sz.length(e);return t?this.uint32(t)._push(Sz.write,t,e):this._push(PA,1,0)};Ht.prototype.fork=function(){return this.states=new d5e(this),this.head=this.tail=new Wg(CA,0,0),this.len=0,this};Ht.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wg(CA,0,0),this.len=0),this};Ht.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Ht.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Ht._configure=function(r){IA=r,Ht.create=Az(),IA._configure()}});var DA=P((CWe,Rz)=>{"use strict";Rz.exports=pc;var Iz=K6();(pc.prototype=Object.create(Iz.prototype)).constructor=pc;var sf=Du();function pc(){Iz.call(this)}pc._configure=function(){pc.alloc=sf._Buffer_allocUnsafe,pc.writeBytesBuffer=sf.Buffer&&sf.Buffer.prototype instanceof Uint8Array&&sf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};pc.prototype.bytes=function(e){sf.isString(e)&&(e=sf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(pc.writeBytesBuffer,t,e),this};function m5e(r,e,t){r.length<40?sf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}pc.prototype.string=function(e){var t=sf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(m5e,t,e),this};pc._configure()});var q6=P((PWe,Dz)=>{"use strict";Dz.exports=pn;var mc=Du(),LA,kz=mc.LongBits,g5e=mc.utf8;function Sa(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function pn(r){this.buf=r,this.pos=0,this.len=r.length}var Cz=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new pn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new pn(e);throw Error("illegal buffer")},Nz=function(){return mc.Buffer?function(t){return(pn.create=function(i){return mc.Buffer.isBuffer(i)?new LA(i):Cz(i)})(t)}:Cz};pn.create=Nz();pn.prototype._slice=mc.Array.prototype.subarray||mc.Array.prototype.slice;pn.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Sa(this,10);return e}}();pn.prototype.int32=function(){return this.uint32()|0};pn.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function OA(){var r=new kz(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Sa(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Sa(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}pn.prototype.bool=function(){return this.uint32()!==0};function $6(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}pn.prototype.fixed32=function(){if(this.pos+4>this.len)throw Sa(this,4);return $6(this.buf,this.pos+=4)};pn.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Sa(this,4);return $6(this.buf,this.pos+=4)|0};function Pz(){if(this.pos+8>this.len)throw Sa(this,8);return new kz($6(this.buf,this.pos+=4),$6(this.buf,this.pos+=4))}pn.prototype.float=function(){if(this.pos+4>this.len)throw Sa(this,4);var e=mc.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};pn.prototype.double=function(){if(this.pos+8>this.len)throw Sa(this,4);var e=mc.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};pn.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Sa(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};pn.prototype.string=function(){var e=this.bytes();return g5e.read(e,0,e.length)};pn.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Sa(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Sa(this);while(this.buf[this.pos++]&128);return this};pn.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};pn._configure=function(r){LA=r,pn.create=Nz(),LA._configure();var e=mc.Long?"toLong":"toNumber";mc.merge(pn.prototype,{int64:function(){return OA.call(this)[e](!1)},uint64:function(){return OA.call(this)[e](!0)},sint64:function(){return OA.call(this).zzDecode()[e](!1)},fixed64:function(){return Pz.call(this)[e](!0)},sfixed64:function(){return Pz.call(this)[e](!1)}})}});var BA=P((kWe,Bz)=>{"use strict";Bz.exports=hh;var Lz=q6();(hh.prototype=Object.create(Lz.prototype)).constructor=hh;var Oz=Du();function hh(r){Lz.call(this,r)}hh._configure=function(){Oz.Buffer&&(hh.prototype._slice=Oz.Buffer.prototype.slice)};hh.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};hh._configure()});var Uz=P((NWe,Mz)=>{"use strict";Mz.exports=Yg;var MA=Du();(Yg.prototype=Object.create(MA.EventEmitter.prototype)).constructor=Yg;function Yg(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");MA.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}Yg.prototype.rpcCall=function r(e,t,n,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return MA.asPromise(r,s,e,t,n,i);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(e,t[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return s.emit("error",c,e),o(c);if(u===null){s.end(!0);return}if(!(u instanceof n))try{u=n[s.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return s.emit("error",l,e),o(l)}return s.emit("data",u,e),o(null,u)})}catch(a){s.emit("error",a,e),setTimeout(function(){o(a)},0);return}};Yg.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var zz=P(Fz=>{"use strict";var y5e=Fz;y5e.Service=Uz()});var Kz=P((OWe,Vz)=>{"use strict";Vz.exports={}});var Hz=P(qz=>{"use strict";var fo=qz;fo.build="minimal";fo.Writer=K6();fo.BufferWriter=DA();fo.Reader=q6();fo.BufferReader=BA();fo.util=Du();fo.rpc=zz();fo.roots=Kz();fo.configure=$z;function $z(){fo.util._configure(),fo.Writer._configure(fo.BufferWriter),fo.Reader._configure(fo.BufferReader)}$z()});var gc=P((BWe,Gz)=>{"use strict";Gz.exports=Hz()});var xq=P((cJe,vq)=>{"use strict";vq.exports=function(){return Date.now()}});var vI=P((uJe,Sq)=>{"use strict";var R8=xq(),EI=class{constructor(e,t,n){let i=this;this._started=R8(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(R8()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=R8();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=R8(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}};function w_e(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new EI(arguments[0],arguments[1],r)}Sq.exports=w_e});var Kn=P((lJe,Tq)=>{"use strict";var{AbortController:b_e}=globalThis,Aq=vI(),vy=class extends b_e{constructor(e){super(),this._ms=e,this._timer=Aq(()=>this.abort(),e),Object.setPrototypeOf(this,vy.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=Aq(()=>this.abort(),this._ms)}};Tq.exports={TimeoutController:vy}});var iR=P((mtt,nH)=>{"use strict";var yEe=typeof navigator<"u"&&navigator.product==="ReactNative";function wEe(){return yEe?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}var Iy=self.URL,rH=wEe(),nR=class{constructor(e="",t=rH){this.super=new Iy(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return Iy.createObjectURL(e)}static revokeObjectURL(e){Iy.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}};function bEe(r){if(typeof r=="string")return new Iy(r).toString();if(!(r instanceof Iy)){let e=r.username&&r.password?`${r.username}:${r.password}@`:"",t=r.auth?r.auth+"@":"",n=r.port?":"+r.port:"",i=r.protocol?r.protocol+"//":"",o=r.host||"",s=r.hostname||"",a=r.search||(r.query?"?"+r.query:""),c=r.hash||"",u=r.pathname||"",l=r.path||u+a;return`${i}${e||t}${o||s+n}${l}${c}`}}nH.exports={URLWithLegacySupport:nR,URLSearchParams:self.URLSearchParams,defaultBase:rH,format:bEe}});var sH=P((gtt,oH)=>{"use strict";var{URLWithLegacySupport:iH,format:_Ee}=iR();oH.exports=(r,e={},t={},n)=>{let i=e.protocol?e.protocol.replace(":",""):"http";i=(t[i]||n||i)+":";let o;try{o=new iH(r)}catch{o={}}let s=Object.assign({},e,{protocol:i||o.protocol,host:e.host||o.host});return new iH(r,_Ee(s)).toString()}});var F8=P((ytt,aH)=>{"use strict";var{URLWithLegacySupport:EEe,format:vEe,URLSearchParams:xEe,defaultBase:SEe}=iR(),AEe=sH();aH.exports={URL:EEe,URLSearchParams:xEe,format:vEe,relative:AEe,defaultBase:SEe}});var Da=P((irt,gR)=>{function AH(r){let e=new globalThis.AbortController;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}gR.exports=AH;gR.exports.anySignal=AH});var Cy=P((Srt,LH)=>{LH.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(o,s){t[o]=s,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(o){return t[o]!==void 0||n[o]!==void 0},remove:function(o){t[o]!==void 0&&(t[o]=void 0),n[o]!==void 0&&(n[o]=void 0)},get:function(o){var s=t[o];if(s!==void 0)return s;if((s=n[o])!==void 0)return i(o,s),s},set:function(o,s){t[o]!==void 0?t[o]=s:i(o,s)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var UH=P((Trt,bR)=>{"use strict";var QEe=Object.prototype.hasOwnProperty,Zi="~";function Py(){}Object.create&&(Py.prototype=Object.create(null),new Py().__proto__||(Zi=!1));function XEe(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function MH(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new XEe(t,n||r,i),s=Zi?Zi+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],o]:r._events[s].push(o):(r._events[s]=o,r._eventsCount++),r}function Q8(r,e){--r._eventsCount===0?r._events=new Py:delete r._events[e]}function ki(){this._events=new Py,this._eventsCount=0}ki.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)QEe.call(t,n)&&e.push(Zi?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ki.prototype.listeners=function(e){var t=Zi?Zi+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s};ki.prototype.listenerCount=function(e){var t=Zi?Zi+e:e,n=this._events[t];return n?n.fn?1:n.length:0};ki.prototype.emit=function(e,t,n,i,o,s){var a=Zi?Zi+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,l,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,o),!0;case 6:return c.fn.call(c.context,t,n,i,o,s),!0}for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c.fn.apply(c.context,l)}else{var h=c.length,d;for(f=0;f<h;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),u){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,i);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[f].fn.apply(c[f].context,l)}}return!0};ki.prototype.on=function(e,t,n){return MH(this,e,t,n,!1)};ki.prototype.once=function(e,t,n){return MH(this,e,t,n,!0)};ki.prototype.removeListener=function(e,t,n,i){var o=Zi?Zi+e:e;if(!this._events[o])return this;if(!t)return Q8(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!i||s.once)&&(!n||s.context===n)&&Q8(this,o);else{for(var a=0,c=[],u=s.length;a<u;a++)(s[a].fn!==t||i&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[o]=c.length===1?c[0]:c:Q8(this,o)}return this};ki.prototype.removeAllListeners=function(e){var t;return e?(t=Zi?Zi+e:e,this._events[t]&&Q8(this,t)):(this._events=new Py,this._eventsCount=0),this};ki.prototype.off=ki.prototype.removeListener;ki.prototype.addListener=ki.prototype.on;ki.prefixed=Zi;ki.EventEmitter=ki;typeof bR<"u"&&(bR.exports=ki)});var CR=P(ob=>{"use strict";var TR=class extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}};ob.TimeoutError=TR;var IR=class extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}};ob.AbortError=IR;var RR=class extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}};ob.HTTPError=RR});var My=P((D1,WH)=>{"use strict";var ZEe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},Ch=ZEe();WH.exports=D1=Ch.fetch;Ch.fetch&&(D1.default=Ch.fetch.bind(Ch));D1.Headers=Ch.Headers;D1.Request=Ch.Request;D1.Response=Ch.Response});var YH=P((Mrt,PR)=>{"use strict";globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?PR.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:PR.exports={default:My().default,Headers:My().Headers,Request:My().Request,Response:My().Response}});var XH=P((Urt,QH)=>{"use strict";QH.exports=YH()});var eG=P((Frt,JH)=>{"use strict";var{TimeoutError:JEe,AbortError:e7e}=CR(),{Response:ZH,Request:t7e,Headers:NR,default:r7e}=XH(),n7e=(r,e={})=>{let t=new XMLHttpRequest;t.open(e.method||"GET",r.toString(),!0);let{timeout:n,headers:i}=e;if(n&&n>0&&n<1/0&&(t.timeout=n),e.overrideMimeType!=null&&t.overrideMimeType(e.overrideMimeType),i)for(let[o,s]of new NR(i))t.setRequestHeader(o,s);return e.signal&&(e.signal.onabort=()=>t.abort()),e.onUploadProgress&&(t.upload.onprogress=e.onUploadProgress),t.responseType="arraybuffer",new Promise((o,s)=>{let a=c=>{switch(c.type){case"error":{o(ZH.error());break}case"load":{o(new kR(t.responseURL,t.response,{status:t.status,statusText:t.statusText,headers:s7e(t.getAllResponseHeaders())}));break}case"timeout":{s(new JEe);break}case"abort":{s(new e7e);break}default:break}};t.onerror=a,t.onload=a,t.ontimeout=a,t.onabort=a,t.send(e.body)})},i7e=r7e,o7e=(r,e={})=>e.onUploadProgress!=null?n7e(r,e):i7e(r,e),s7e=r=>{let e=new NR;for(let t of r.trim().split(/[\r\n]+/)){let n=t.indexOf(": ");n>0&&e.set(t.slice(0,n),t.slice(n+1))}return e},kR=class extends ZH{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}};JH.exports={fetch:o7e,Request:t7e,Headers:NR}});var rG=P((zrt,tG)=>{"use strict";async function*a7e(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&t.cancel(),t.releaseLock()}}tG.exports=a7e});var iG=P((Vrt,nG)=>{"use strict";var c7e=async r=>{let e=[];for await(let t of r)e.push(t);return e};nG.exports=c7e});var O1=P((Krt,lG)=>{"use strict";var{fetch:u7e,Request:l7e,Headers:f7e}=eG(),{TimeoutError:DR,HTTPError:cG}=CR(),oG=_A().bind({ignoreUndefined:!0}),{URL:sG,URLSearchParams:aG}=F8(),d7e=Da(),h7e=rG(),{isBrowser:p7e,isWebWorker:m7e}=C6(),g7e=iG(),y7e=(r,e,t)=>{if(e===void 0)return r;let n=Date.now(),i=()=>Date.now()-n>=e;return new Promise((o,s)=>{let a=setTimeout(()=>{i()&&(s(new DR),t.abort())},e),c=u=>f=>{if(clearTimeout(a),i()){s(new DR);return}u(f)};r.then(c(o),c(s))})},w7e={throwHttpErrors:!0,credentials:"same-origin"},Ni=class{constructor(e={}){this.opts=oG(w7e,e)}async fetch(e,t={}){let n=oG(this.opts,t),i=new f7e(n.headers);if(typeof e!="string"&&!(e instanceof sG||e instanceof l7e))throw new TypeError("`resource` must be a string, URL, or Request");let o=new sG(e.toString(),n.base),{searchParams:s,transformSearchParams:a,json:c}=n;s&&(typeof a=="function"?o.search=a(new aG(n.searchParams)):o.search=new aG(n.searchParams)),c&&(n.body=JSON.stringify(n.json),i.set("content-type","application/json"));let u=new AbortController,l=d7e([u.signal,n.signal]);globalThis.ReadableStream!=null&&n.body instanceof globalThis.ReadableStream&&(p7e||m7e)&&(n.body=new Blob(await g7e(h7e(n.body))));let f=await y7e(u7e(o.toString(),{...n,signal:l,timeout:void 0,headers:i,duplex:"half"}),n.timeout,u);if(!f.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(f),new cG(f);return f.iterator=async function*(){yield*uG(f.body)},f.ndjson=async function*(){for await(let h of b7e(f.iterator()))t.transform?yield t.transform(h):yield h},f}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}},b7e=async function*(r){let e=new TextDecoder,t="";for await(let n of r){t+=e.decode(n,{stream:!0});let i=t.split(/\r?\n/);for(let o=0;o<i.length-1;o++){let s=i[o].trim();s.length>0&&(yield JSON.parse(s))}t=i[i.length-1]}t+=e.decode(),t=t.trim(),t.length!==0&&(yield JSON.parse(t))},uG=r=>{if(_7e(r))return r;if(v7e(r)){let e=r[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:e.next.bind(e),return(t){return r.destroy(),typeof e.return=="function"?e.return():Promise.resolve({done:!0,value:t})}}}}}if(E7e(r)){let e=r.getReader();return async function*(){try{for(;;){let{done:t,value:n}=await e.read();if(t)return;n&&(yield n)}}finally{e.releaseLock()}}()}throw new TypeError("Body can't be converted to AsyncIterable")},_7e=r=>typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function",E7e=r=>r&&typeof r.getReader=="function",v7e=r=>Object.prototype.hasOwnProperty.call(r,"readable")&&Object.prototype.hasOwnProperty.call(r,"writable");Ni.HTTPError=cG;Ni.TimeoutError=DR;Ni.streamToAsyncIterator=uG;Ni.post=(r,e)=>new Ni(e).post(r,e);Ni.get=(r,e)=>new Ni(e).get(r,e);Ni.put=(r,e)=>new Ni(e).put(r,e);Ni.delete=(r,e)=>new Ni(e).delete(r,e);Ni.options=(r,e)=>new Ni(e).options(r,e);lG.exports=Ni});var AG=P((Wnt,FR)=>{var jnt=function(){typeof FR<"u"&&(FR.exports=g);var r=86400,e=3200,t=146097*e/400,n=r*t,i=1e3*n,o=864e13,s=4294967296,a=1e6,c="000000000",u=Math.trunc||function(S){var A=S-S%1;return A==0&&(S<0||S===0&&1/S!=1/0)?-0:A},l=g.prototype,f=(g.fromDate=function(S){return new g(+S)},g.fromInt64BE=y(0,1,2,3,0,4),g.fromInt64LE=y(3,2,1,0,4,0),g.fromString=function(k){var A,I=new g,k=(k+="").replace(/^\s*[+\-]?\d+/,function(O){var O=+O,G=1970+(O-1970)%400;return I.year=O-G,G}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(N,O,G){return O<0&&(G*=-1),A=6e4*(60*+O+ +G),""}).replace(/\.\d+$/,function(N){return I.nano=+(N+c).substr(1,9),""}).split(/\D+/);if(1<k.length?k[1]--:k[1]=0,I.time=A=Date.UTC.apply(Date,k)-(A||0),isNaN(A))throw new TypeError("Invalid Date");return w(I)},g.fromTimeT=function(S){return x(S,0)},l.year=0,l.time=0,l.nano=0,l.addNano=function(S){return this.nano+=+S||0,this},l.getNano=function(){var S=w(this);return(S.time%1e3*a+ +S.nano+1e9)%1e9},l.getTimeT=function(){var A=w(this),S=Math.floor(A.time/1e3),A=A.year;return A&&(S+=A*t*r/e),S},l.getYear=function(){return this.toDate().getUTCFullYear()+this.year},l.toDate=function(){return _(w(this).time)},l.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},l.toString=function(S){var A=this,I=A.toDate(),k={H:function(){return E(I.getUTCHours())},L:function(){return v(I.getUTCMilliseconds(),3)},M:function(){return E(I.getUTCMinutes())},N:function(){return v(A.getNano(),9)},S:function(){return E(I.getUTCSeconds())},Y:function(){var N=A.getYear();return 999999<N?"+"+N:9999<N?"+"+v(N,6):0<=N?v(N,4):-999999<=N?"-"+v(-N,6):N},a:function(){return d[I.getUTCDay()]},b:function(){return h[I.getUTCMonth()]},d:function(){return E(I.getUTCDate())},e:function(){return function(N){return(9<N?"":" ")+(0|N)}(I.getUTCDate())},m:function(){return E(I.getUTCMonth()+1)}};return function N(O){return O.replace(/%./g,function(G){var K=G[1],R=p[K],K=k[K];return R?N(R):K?K():G})}(S||f)},l.writeInt64BE=m(0,1,2,3,0,4),l.writeInt64LE=m(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],p={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return g;function g(S,A,I){var k=this;if(!(k instanceof g))return new g(S,A,I);k.time=+S||0,k.nano=+A||0,k.year=+I||0,w(k)}function w(S){var A,I,k,N=S.year,O=S.time,G=S.nano,R=((G<0||a<=G)&&(G-=(I=Math.floor(G/a))*a,O+=I,I=1),N%e);return(O<-o||o<O||R)&&((A=u(O/i))&&(N+=A*e,O-=A*i),(k=_(O)).setUTCFullYear(R+k.getUTCFullYear()),k=(O=+k)+(A=u((N-=R)/e))*i,A&&-o<=k&&k<=o&&(N-=A*e,O=k),I=1),I&&(S.year=N,S.time=O,S.nano=G),S}function _(S){var A=new Date(0);return A.setTime(S),A}function x(N,k){N=+N||0;var I=u((k=(k|0)*s)/n)+u(N/n),k=k%n+N%n,N=u(k/n);return N&&(I+=N,k-=N*n),new g(1e3*k,0,I*e)}function m(S,A,I,k,N,O){return function(R,K){var te=w(this);R=R||new Array(8),b(R,K|=0);var Ce=Math.floor(te.time/1e3),te=te.year*(t*r/e),U=u(te/s)+u(Ce/s),te=te%s+Ce%s,Ce=Math.floor(te/s);return Ce&&(U+=Ce,te-=Ce*s),G(R,K+N,U),G(R,K+O,te),R};function G(R,K,U){R[K+S]=U>>24&255,R[K+A]=U>>16&255,R[K+I]=U>>8&255,R[K+k]=255&U}}function y(S,A,I,k,N,O){return function(R,K){b(R,K|=0);var U=G(R,K+N);return x(G(R,K+O),U)};function G(R,K){return 16777216*R[K+S]+(R[K+A]<<16|R[K+I]<<8|R[K+k])}}function b(S,A){if(S=S&&S.length,S==null)throw new TypeError("Invalid Buffer");if(S<A+8)throw new RangeError("Out of range")}function E(S){return(9<S?"":"0")+(0|S)}function v(S,A){return(c+(0|S)).substr(-A)}}()});var at=P((Ynt,TG)=>{TG.exports={options:{usePureJavaScript:!1}}});var CG=P((Qnt,RG)=>{var zR={};RG.exports=zR;var IG={};zR.encode=function(r,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(r instanceof Uint8Array))n=O7e(r,e);else{var i=0,o=e.length,s=e.charAt(0),a=[0];for(i=0;i<r.length;++i){for(var c=0,u=r[i];c<a.length;++c)u+=a[c]<<8,a[c]=u%o,u=u/o|0;for(;u>0;)a.push(u%o),u=u/o|0}for(i=0;r[i]===0&&i<r.length-1;++i)n+=s;for(i=a.length-1;i>=0;--i)n+=e[a[i]]}if(t){var l=new RegExp(".{1,"+t+"}","g");n=n.match(l).join(`\r
`)}return n};zR.decode=function(r,e){if(typeof r!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=IG[e];if(!t){t=IG[e]=[];for(var n=0;n<e.length;++n)t[e.charCodeAt(n)]=n}r=r.replace(/\s/g,"");for(var i=e.length,o=e.charAt(0),s=[0],n=0;n<r.length;n++){var a=t[r.charCodeAt(n)];if(a===void 0)return;for(var c=0,u=a;c<s.length;++c)u+=s[c]*i,s[c]=u&255,u>>=8;for(;u>0;)s.push(u&255),u>>=8}for(var l=0;r[l]===o&&l<r.length-1;++l)s.push(0);return typeof Buffer<"u"?Buffer.from(s.reverse()):new Uint8Array(s.reverse())};function O7e(r,e){var t=0,n=e.length,i=e.charAt(0),o=[0];for(t=0;t<r.length();++t){for(var s=0,a=r.at(t);s<o.length;++s)a+=o[s]<<8,o[s]=a%n,a=a/n|0;for(;a>0;)o.push(a%n),a=a/n|0}var c="";for(t=0;r.at(t)===0&&t<r.length()-1;++t)c+=i;for(t=o.length-1;t>=0;--t)c+=e[o[t]];return c}});var gr=P((Xnt,DG)=>{var PG=at(),kG=CG(),F=DG.exports=PG.util=PG.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){F.nextTick=process.nextTick,typeof setImmediate=="function"?F.setImmediate=setImmediate:F.setImmediate=F.nextTick;return}if(typeof setImmediate=="function"){F.setImmediate=function(){return setImmediate.apply(void 0,arguments)},F.nextTick=function(a){return setImmediate(a)};return}if(F.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(c){if(c.source===window&&c.data===r){c.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(l){l()})}};var s=a,r="forge.setImmediate",e=[];F.setImmediate=function(c){e.push(c),e.length===1&&window.postMessage(r,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),n=!0,i=document.createElement("div"),e=[];new MutationObserver(function(){var c=e.slice();e.length=0,c.forEach(function(u){u()})}).observe(i,{attributes:!0});var o=F.setImmediate;F.setImmediate=function(c){Date.now()-t>15?(t=Date.now(),o(c)):(e.push(c),e.length===1&&i.setAttribute("a",n=!n))}}F.nextTick=F.setImmediate})();F.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;F.globalScope=function(){return F.isNodejs?globalThis:typeof self>"u"?window:self}();F.isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};F.isArrayBuffer=function(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer};F.isArrayBufferView=function(r){return r&&F.isArrayBuffer(r.buffer)&&r.byteLength!==void 0};function zy(r){if(!(r===8||r===16||r===24||r===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+r)}F.ByteBuffer=VR;function VR(r){if(this.data="",this.read=0,typeof r=="string")this.data=r;else if(F.isArrayBuffer(r)||F.isArrayBufferView(r))if(typeof Buffer<"u"&&r instanceof Buffer)this.data=r.toString("binary");else{var e=new Uint8Array(r);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(r instanceof VR||typeof r=="object"&&typeof r.data=="string"&&typeof r.read=="number")&&(this.data=r.data,this.read=r.read);this._constructedStringLength=0}F.ByteStringBuffer=VR;var L7e=4096;F.ByteStringBuffer.prototype._optimizeConstructedString=function(r){this._constructedStringLength+=r,this._constructedStringLength>L7e&&(this.data.substr(0,1),this._constructedStringLength=0)};F.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};F.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};F.ByteStringBuffer.prototype.putByte=function(r){return this.putBytes(String.fromCharCode(r))};F.ByteStringBuffer.prototype.fillWithByte=function(r,e){r=String.fromCharCode(r);for(var t=this.data;e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return this.data=t,this._optimizeConstructedString(e),this};F.ByteStringBuffer.prototype.putBytes=function(r){return this.data+=r,this._optimizeConstructedString(r.length),this};F.ByteStringBuffer.prototype.putString=function(r){return this.putBytes(F.encodeUtf8(r))};F.ByteStringBuffer.prototype.putInt16=function(r){return this.putBytes(String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};F.ByteStringBuffer.prototype.putInt24=function(r){return this.putBytes(String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};F.ByteStringBuffer.prototype.putInt32=function(r){return this.putBytes(String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};F.ByteStringBuffer.prototype.putInt16Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255))};F.ByteStringBuffer.prototype.putInt24Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255))};F.ByteStringBuffer.prototype.putInt32Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>24&255))};F.ByteStringBuffer.prototype.putInt=function(r,e){zy(e);var t="";do e-=8,t+=String.fromCharCode(r>>e&255);while(e>0);return this.putBytes(t)};F.ByteStringBuffer.prototype.putSignedInt=function(r,e){return r<0&&(r+=2<<e-1),this.putInt(r,e)};F.ByteStringBuffer.prototype.putBuffer=function(r){return this.putBytes(r.getBytes())};F.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};F.ByteStringBuffer.prototype.getInt16=function(){var r=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,r};F.ByteStringBuffer.prototype.getInt24=function(){var r=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,r};F.ByteStringBuffer.prototype.getInt32=function(){var r=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,r};F.ByteStringBuffer.prototype.getInt16Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,r};F.ByteStringBuffer.prototype.getInt24Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,r};F.ByteStringBuffer.prototype.getInt32Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,r};F.ByteStringBuffer.prototype.getInt=function(r){zy(r);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),r-=8;while(r>0);return e};F.ByteStringBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};F.ByteStringBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};F.ByteStringBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};F.ByteStringBuffer.prototype.at=function(r){return this.data.charCodeAt(this.read+r)};F.ByteStringBuffer.prototype.setAt=function(r,e){return this.data=this.data.substr(0,this.read+r)+String.fromCharCode(e)+this.data.substr(this.read+r+1),this};F.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};F.ByteStringBuffer.prototype.copy=function(){var r=F.createBuffer(this.data);return r.read=this.read,r};F.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};F.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};F.ByteStringBuffer.prototype.truncate=function(r){var e=Math.max(0,this.length()-r);return this.data=this.data.substr(this.read,e),this.read=0,this};F.ByteStringBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(r+="0"),r+=t.toString(16)}return r};F.ByteStringBuffer.prototype.toString=function(){return F.decodeUtf8(this.bytes())};function B7e(r,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=F.isArrayBuffer(r),n=F.isArrayBufferView(r);if(t||n){t?this.data=new DataView(r):this.data=new DataView(r.buffer,r.byteOffset,r.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,r!=null&&this.putBytes(r),"writeOffset"in e&&(this.write=e.writeOffset)}F.DataBuffer=B7e;F.DataBuffer.prototype.length=function(){return this.write-this.read};F.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};F.DataBuffer.prototype.accommodate=function(r,e){if(this.length()>=r)return this;e=Math.max(e||this.growSize,r);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(t),this.data=new DataView(n.buffer),this};F.DataBuffer.prototype.putByte=function(r){return this.accommodate(1),this.data.setUint8(this.write++,r),this};F.DataBuffer.prototype.fillWithByte=function(r,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(r);return this};F.DataBuffer.prototype.putBytes=function(r,e){if(F.isArrayBufferView(r)){var t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),n=t.byteLength-t.byteOffset;this.accommodate(n);var i=new Uint8Array(this.data.buffer,this.write);return i.set(t),this.write+=n,this}if(F.isArrayBuffer(r)){var t=new Uint8Array(r);this.accommodate(t.byteLength);var i=new Uint8Array(this.data.buffer);return i.set(t,this.write),this.write+=t.byteLength,this}if(r instanceof F.DataBuffer||typeof r=="object"&&typeof r.read=="number"&&typeof r.write=="number"&&F.isArrayBufferView(r.data)){var t=new Uint8Array(r.data.byteLength,r.read,r.length());this.accommodate(t.byteLength);var i=new Uint8Array(r.data.byteLength,this.write);return i.set(t),this.write+=t.byteLength,this}if(r instanceof F.ByteStringBuffer&&(r=r.data,e="binary"),e=e||"binary",typeof r=="string"){var o;if(e==="hex")return this.accommodate(Math.ceil(r.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=F.binary.hex.decode(r,o,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(r.length/4)*3),o=new Uint8Array(this.data.buffer,this.write),this.write+=F.binary.base64.decode(r,o,this.write),this;if(e==="utf8"&&(r=F.encodeUtf8(r),e="binary"),e==="binary"||e==="raw")return this.accommodate(r.length),o=new Uint8Array(this.data.buffer,this.write),this.write+=F.binary.raw.decode(o),this;if(e==="utf16")return this.accommodate(r.length*2),o=new Uint16Array(this.data.buffer,this.write),this.write+=F.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+r)};F.DataBuffer.prototype.putBuffer=function(r){return this.putBytes(r),r.clear(),this};F.DataBuffer.prototype.putString=function(r){return this.putBytes(r,"utf16")};F.DataBuffer.prototype.putInt16=function(r){return this.accommodate(2),this.data.setInt16(this.write,r),this.write+=2,this};F.DataBuffer.prototype.putInt24=function(r){return this.accommodate(3),this.data.setInt16(this.write,r>>8&65535),this.data.setInt8(this.write,r>>16&255),this.write+=3,this};F.DataBuffer.prototype.putInt32=function(r){return this.accommodate(4),this.data.setInt32(this.write,r),this.write+=4,this};F.DataBuffer.prototype.putInt16Le=function(r){return this.accommodate(2),this.data.setInt16(this.write,r,!0),this.write+=2,this};F.DataBuffer.prototype.putInt24Le=function(r){return this.accommodate(3),this.data.setInt8(this.write,r>>16&255),this.data.setInt16(this.write,r>>8&65535,!0),this.write+=3,this};F.DataBuffer.prototype.putInt32Le=function(r){return this.accommodate(4),this.data.setInt32(this.write,r,!0),this.write+=4,this};F.DataBuffer.prototype.putInt=function(r,e){zy(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,r>>e&255);while(e>0);return this};F.DataBuffer.prototype.putSignedInt=function(r,e){return zy(e),this.accommodate(e/8),r<0&&(r+=2<<e-1),this.putInt(r,e)};F.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};F.DataBuffer.prototype.getInt16=function(){var r=this.data.getInt16(this.read);return this.read+=2,r};F.DataBuffer.prototype.getInt24=function(){var r=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,r};F.DataBuffer.prototype.getInt32=function(){var r=this.data.getInt32(this.read);return this.read+=4,r};F.DataBuffer.prototype.getInt16Le=function(){var r=this.data.getInt16(this.read,!0);return this.read+=2,r};F.DataBuffer.prototype.getInt24Le=function(){var r=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,r};F.DataBuffer.prototype.getInt32Le=function(){var r=this.data.getInt32(this.read,!0);return this.read+=4,r};F.DataBuffer.prototype.getInt=function(r){zy(r);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),r-=8;while(r>0);return e};F.DataBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};F.DataBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};F.DataBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};F.DataBuffer.prototype.at=function(r){return this.data.getUint8(this.read+r)};F.DataBuffer.prototype.setAt=function(r,e){return this.data.setUint8(r,e),this};F.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};F.DataBuffer.prototype.copy=function(){return new F.DataBuffer(this)};F.DataBuffer.prototype.compact=function(){if(this.read>0){var r=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(r.byteLength);e.set(r),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};F.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};F.DataBuffer.prototype.truncate=function(r){return this.write=Math.max(0,this.length()-r),this.read=Math.min(this.read,this.write),this};F.DataBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(r+="0"),r+=t.toString(16)}return r};F.DataBuffer.prototype.toString=function(r){var e=new Uint8Array(this.data,this.read,this.length());if(r=r||"utf8",r==="binary"||r==="raw")return F.binary.raw.encode(e);if(r==="hex")return F.binary.hex.encode(e);if(r==="base64")return F.binary.base64.encode(e);if(r==="utf8")return F.text.utf8.decode(e);if(r==="utf16")return F.text.utf16.decode(e);throw new Error("Invalid encoding: "+r)};F.createBuffer=function(r,e){return e=e||"raw",r!==void 0&&e==="utf8"&&(r=F.encodeUtf8(r)),new F.ByteBuffer(r)};F.fillString=function(r,e){for(var t="";e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return t};F.xorBytes=function(r,e,t){for(var n="",i="",o="",s=0,a=0;t>0;--t,++s)i=r.charCodeAt(s)^e.charCodeAt(s),a>=10&&(n+=o,o="",a=0),o+=String.fromCharCode(i),++a;return n+=o,n};F.hexToBytes=function(r){var e="",t=0;for(r.length&!0&&(t=1,e+=String.fromCharCode(parseInt(r[0],16)));t<r.length;t+=2)e+=String.fromCharCode(parseInt(r.substr(t,2),16));return e};F.bytesToHex=function(r){return F.createBuffer(r).toHex()};F.int32ToBytes=function(r){return String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255)};var Bf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Mf=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],NG="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";F.encode64=function(r,e){for(var t="",n="",i,o,s,a=0;a<r.length;)i=r.charCodeAt(a++),o=r.charCodeAt(a++),s=r.charCodeAt(a++),t+=Bf.charAt(i>>2),t+=Bf.charAt((i&3)<<4|o>>4),isNaN(o)?t+="==":(t+=Bf.charAt((o&15)<<2|s>>6),t+=isNaN(s)?"=":Bf.charAt(s&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};F.decode64=function(r){r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,n,i,o,s=0;s<r.length;)t=Mf[r.charCodeAt(s++)-43],n=Mf[r.charCodeAt(s++)-43],i=Mf[r.charCodeAt(s++)-43],o=Mf[r.charCodeAt(s++)-43],e+=String.fromCharCode(t<<2|n>>4),i!==64&&(e+=String.fromCharCode((n&15)<<4|i>>2),o!==64&&(e+=String.fromCharCode((i&3)<<6|o)));return e};F.encodeUtf8=function(r){return unescape(encodeURIComponent(r))};F.decodeUtf8=function(r){return decodeURIComponent(escape(r))};F.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:kG.encode,decode:kG.decode}};F.binary.raw.encode=function(r){return String.fromCharCode.apply(null,r)};F.binary.raw.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,o=0;o<r.length;++o)n[i++]=r.charCodeAt(o);return e?i-t:n};F.binary.hex.encode=F.bytesToHex;F.binary.hex.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/2))),t=t||0;var i=0,o=t;for(r.length&1&&(i=1,n[o++]=parseInt(r[0],16));i<r.length;i+=2)n[o++]=parseInt(r.substr(i,2),16);return e?o-t:n};F.binary.base64.encode=function(r,e){for(var t="",n="",i,o,s,a=0;a<r.byteLength;)i=r[a++],o=r[a++],s=r[a++],t+=Bf.charAt(i>>2),t+=Bf.charAt((i&3)<<4|o>>4),isNaN(o)?t+="==":(t+=Bf.charAt((o&15)<<2|s>>6),t+=isNaN(s)?"=":Bf.charAt(s&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};F.binary.base64.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/4)*3)),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var i,o,s,a,c=0,u=t;c<r.length;)i=Mf[r.charCodeAt(c++)-43],o=Mf[r.charCodeAt(c++)-43],s=Mf[r.charCodeAt(c++)-43],a=Mf[r.charCodeAt(c++)-43],n[u++]=i<<2|o>>4,s!==64&&(n[u++]=(o&15)<<4|s>>2,a!==64&&(n[u++]=(s&3)<<6|a));return e?u-t:n.subarray(0,u)};F.binary.base58.encode=function(r,e){return F.binary.baseN.encode(r,NG,e)};F.binary.base58.decode=function(r,e){return F.binary.baseN.decode(r,NG,e)};F.text={utf8:{},utf16:{}};F.text.utf8.encode=function(r,e,t){r=F.encodeUtf8(r);var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var i=t,o=0;o<r.length;++o)n[i++]=r.charCodeAt(o);return e?i-t:n};F.text.utf8.decode=function(r){return F.decodeUtf8(String.fromCharCode.apply(null,r))};F.text.utf16.encode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length*2));var i=new Uint16Array(n.buffer);t=t||0;for(var o=t,s=t,a=0;a<r.length;++a)i[s++]=r.charCodeAt(a),o+=2;return e?o-t:n};F.text.utf16.decode=function(r){return String.fromCharCode.apply(null,new Uint16Array(r.buffer))};F.deflate=function(r,e,t){if(e=F.decode64(r.deflate(F.encode64(e)).rval),t){var n=2,i=e.charCodeAt(1);i&32&&(n=6),e=e.substring(n,e.length-4)}return e};F.inflate=function(r,e,t){var n=r.inflate(F.encode64(e)).rval;return n===null?null:F.decode64(n)};var KR=function(r,e,t){if(!r)throw new Error("WebStorage not available.");var n;if(t===null?n=r.removeItem(e):(t=F.encode64(JSON.stringify(t)),n=r.setItem(e,t)),typeof n<"u"&&n.rval!==!0){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},$R=function(r,e){if(!r)throw new Error("WebStorage not available.");var t=r.getItem(e);if(r.init)if(t.rval===null){if(t.error){var n=new Error(t.error.message);throw n.id=t.error.id,n.name=t.error.name,n}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(F.decode64(t))),t},M7e=function(r,e,t,n){var i=$R(r,e);i===null&&(i={}),i[t]=n,KR(r,e,i)},U7e=function(r,e,t){var n=$R(r,e);return n!==null&&(n=t in n?n[t]:null),n},F7e=function(r,e,t){var n=$R(r,e);if(n!==null&&t in n){delete n[t];var i=!0;for(var o in n){i=!1;break}i&&(n=null),KR(r,e,n)}},z7e=function(r,e){KR(r,e,null)},fb=function(r,e,t){var n=null;typeof t>"u"&&(t=["web","flash"]);var i,o=!1,s=null;for(var a in t){i=t[a];try{if(i==="flash"||i==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=r.apply(this,e),o=i==="flash"}(i==="web"||i==="both")&&(e[0]=localStorage,n=r.apply(this,e),o=!0)}catch(c){s=c}if(o)break}if(!o)throw s;return n};F.setItem=function(r,e,t,n,i){fb(M7e,arguments,i)};F.getItem=function(r,e,t,n){return fb(U7e,arguments,n)};F.removeItem=function(r,e,t,n){fb(F7e,arguments,n)};F.clearItems=function(r,e,t){fb(z7e,arguments,t)};F.isEmpty=function(r){for(var e in r)if(r.hasOwnProperty(e))return!1;return!0};F.format=function(r){for(var e=/%./g,t,n,i=0,o=[],s=0;t=e.exec(r);){n=r.substring(s,e.lastIndex-2),n.length>0&&o.push(n),s=e.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?o.push(arguments[i+++1]):o.push("<?>");break;case"%":o.push("%");break;default:o.push("<%"+a+"?>")}}return o.push(r.substring(s)),o.join("")};F.formatNumber=function(r,e,t,n){var i=r,o=isNaN(e=Math.abs(e))?2:e,s=t===void 0?",":t,a=n===void 0?".":n,c=i<0?"-":"",u=parseInt(i=Math.abs(+i||0).toFixed(o),10)+"",l=u.length>3?u.length%3:0;return c+(l?u.substr(0,l)+a:"")+u.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+a)+(o?s+Math.abs(i-u).toFixed(o).slice(2):"")};F.formatSize=function(r){return r>=1073741824?r=F.formatNumber(r/1073741824,2,".","")+" GiB":r>=1048576?r=F.formatNumber(r/1048576,2,".","")+" MiB":r>=1024?r=F.formatNumber(r/1024,0)+" KiB":r=F.formatNumber(r,0)+" bytes",r};F.bytesFromIP=function(r){return r.indexOf(".")!==-1?F.bytesFromIPv4(r):r.indexOf(":")!==-1?F.bytesFromIPv6(r):null};F.bytesFromIPv4=function(r){if(r=r.split("."),r.length!==4)return null;for(var e=F.createBuffer(),t=0;t<r.length;++t){var n=parseInt(r[t],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};F.bytesFromIPv6=function(r){var e=0;r=r.split(":").filter(function(s){return s.length===0&&++e,!0});for(var t=(8-r.length+e)*2,n=F.createBuffer(),i=0;i<8;++i){if(!r[i]||r[i].length===0){n.fillWithByte(0,t),t=0;continue}var o=F.hexToBytes(r[i]);o.length<2&&n.putByte(0),n.putBytes(o)}return n.getBytes()};F.bytesToIP=function(r){return r.length===4?F.bytesToIPv4(r):r.length===16?F.bytesToIPv6(r):null};F.bytesToIPv4=function(r){if(r.length!==4)return null;for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e.join(".")};F.bytesToIPv6=function(r){if(r.length!==16)return null;for(var e=[],t=[],n=0,i=0;i<r.length;i+=2){for(var o=F.bytesToHex(r[i]+r[i+1]);o[0]==="0"&&o!=="0";)o=o.substr(1);if(o==="0"){var s=t[t.length-1],a=e.length;!s||a!==s.end+1?t.push({start:a,end:a}):(s.end=a,s.end-s.start>t[n].end-t[n].start&&(n=t.length-1))}e.push(o)}if(t.length>0){var c=t[n];c.end-c.start>0&&(e.splice(c.start,c.end-c.start+1,""),c.start===0&&e.unshift(""),c.end===7&&e.push(""))}return e.join(":")};F.estimateCores=function(r,e){if(typeof r=="function"&&(e=r,r={}),r=r||{},"cores"in F&&!r.update)return e(null,F.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return F.cores=navigator.hardwareConcurrency,e(null,F.cores);if(typeof Worker>"u")return F.cores=1,e(null,F.cores);if(typeof Blob>"u")return F.cores=2,e(null,F.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(s){for(var a=Date.now(),c=a+4;Date.now()<c;);self.postMessage({st:a,et:c})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(s,a,c){if(a===0){var u=Math.floor(s.reduce(function(l,f){return l+f},0)/s.length);return F.cores=Math.max(1,u),URL.revokeObjectURL(t),e(null,F.cores)}i(c,function(l,f){s.push(o(c,f)),n(s,a-1,c)})}function i(s,a){for(var c=[],u=[],l=0;l<s;++l){var f=new Worker(t);f.addEventListener("message",function(h){if(u.push(h.data),u.length===s){for(var d=0;d<s;++d)c[d].terminate();a(null,u)}}),c.push(f)}for(var l=0;l<s;++l)c[l].postMessage(l)}function o(s,a){for(var c=[],u=0;u<s;++u)for(var l=a[u],f=c[u]=[],h=0;h<s;++h)if(u!==h){var d=a[h];(l.st>d.st&&l.st<d.et||d.st>l.st&&d.st<l.et)&&f.push(h)}return c.reduce(function(p,g){return Math.max(p,g.length)},0)}}});var z1=P((Znt,OG)=>{var Vy=at();Vy.pki=Vy.pki||{};var qR=OG.exports=Vy.pki.oids=Vy.oids=Vy.oids||{};function se(r,e){qR[r]=e,qR[e]=r}function ur(r,e){qR[r]=e}se("1.2.840.113549.1.1.1","rsaEncryption");se("1.2.840.113549.1.1.4","md5WithRSAEncryption");se("1.2.840.113549.1.1.5","sha1WithRSAEncryption");se("1.2.840.113549.1.1.7","RSAES-OAEP");se("1.2.840.113549.1.1.8","mgf1");se("1.2.840.113549.1.1.9","pSpecified");se("1.2.840.113549.1.1.10","RSASSA-PSS");se("1.2.840.113549.1.1.11","sha256WithRSAEncryption");se("1.2.840.113549.1.1.12","sha384WithRSAEncryption");se("1.2.840.113549.1.1.13","sha512WithRSAEncryption");se("1.3.101.112","EdDSA25519");se("1.2.840.10040.4.3","dsa-with-sha1");se("1.3.14.3.2.7","desCBC");se("1.3.14.3.2.26","sha1");se("1.3.14.3.2.29","sha1WithRSASignature");se("2.16.840.1.101.3.4.2.1","sha256");se("2.16.840.1.101.3.4.2.2","sha384");se("2.16.840.1.101.3.4.2.3","sha512");se("2.16.840.1.101.3.4.2.4","sha224");se("2.16.840.1.101.3.4.2.5","sha512-224");se("2.16.840.1.101.3.4.2.6","sha512-256");se("1.2.840.113549.2.2","md2");se("1.2.840.113549.2.5","md5");se("1.2.840.113549.1.7.1","data");se("1.2.840.113549.1.7.2","signedData");se("1.2.840.113549.1.7.3","envelopedData");se("1.2.840.113549.1.7.4","signedAndEnvelopedData");se("1.2.840.113549.1.7.5","digestedData");se("1.2.840.113549.1.7.6","encryptedData");se("1.2.840.113549.1.9.1","emailAddress");se("1.2.840.113549.1.9.2","unstructuredName");se("1.2.840.113549.1.9.3","contentType");se("1.2.840.113549.1.9.4","messageDigest");se("1.2.840.113549.1.9.5","signingTime");se("1.2.840.113549.1.9.6","counterSignature");se("1.2.840.113549.1.9.7","challengePassword");se("1.2.840.113549.1.9.8","unstructuredAddress");se("1.2.840.113549.1.9.14","extensionRequest");se("1.2.840.113549.1.9.20","friendlyName");se("1.2.840.113549.1.9.21","localKeyId");se("1.2.840.113549.1.9.22.1","x509Certificate");se("1.2.840.113549.1.12.10.1.1","keyBag");se("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");se("1.2.840.113549.1.12.10.1.3","certBag");se("1.2.840.113549.1.12.10.1.4","crlBag");se("1.2.840.113549.1.12.10.1.5","secretBag");se("1.2.840.113549.1.12.10.1.6","safeContentsBag");se("1.2.840.113549.1.5.13","pkcs5PBES2");se("1.2.840.113549.1.5.12","pkcs5PBKDF2");se("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");se("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");se("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");se("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");se("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");se("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");se("1.2.840.113549.2.7","hmacWithSHA1");se("1.2.840.113549.2.8","hmacWithSHA224");se("1.2.840.113549.2.9","hmacWithSHA256");se("1.2.840.113549.2.10","hmacWithSHA384");se("1.2.840.113549.2.11","hmacWithSHA512");se("1.2.840.113549.3.7","des-EDE3-CBC");se("2.16.840.1.101.3.4.1.2","aes128-CBC");se("2.16.840.1.101.3.4.1.22","aes192-CBC");se("2.16.840.1.101.3.4.1.42","aes256-CBC");se("2.5.4.3","commonName");se("2.5.4.4","surname");se("2.5.4.5","serialNumber");se("2.5.4.6","countryName");se("2.5.4.7","localityName");se("2.5.4.8","stateOrProvinceName");se("2.5.4.9","streetAddress");se("2.5.4.10","organizationName");se("2.5.4.11","organizationalUnitName");se("2.5.4.12","title");se("2.5.4.13","description");se("2.5.4.15","businessCategory");se("2.5.4.17","postalCode");se("2.5.4.42","givenName");se("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");se("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");se("2.16.840.1.113730.1.1","nsCertType");se("2.16.840.1.113730.1.13","nsComment");ur("2.5.29.1","authorityKeyIdentifier");ur("2.5.29.2","keyAttributes");ur("2.5.29.3","certificatePolicies");ur("2.5.29.4","keyUsageRestriction");ur("2.5.29.5","policyMapping");ur("2.5.29.6","subtreesConstraint");ur("2.5.29.7","subjectAltName");ur("2.5.29.8","issuerAltName");ur("2.5.29.9","subjectDirectoryAttributes");ur("2.5.29.10","basicConstraints");ur("2.5.29.11","nameConstraints");ur("2.5.29.12","policyConstraints");ur("2.5.29.13","basicConstraints");se("2.5.29.14","subjectKeyIdentifier");se("2.5.29.15","keyUsage");ur("2.5.29.16","privateKeyUsagePeriod");se("2.5.29.17","subjectAltName");se("2.5.29.18","issuerAltName");se("2.5.29.19","basicConstraints");ur("2.5.29.20","cRLNumber");ur("2.5.29.21","cRLReason");ur("2.5.29.22","expirationDate");ur("2.5.29.23","instructionCode");ur("2.5.29.24","invalidityDate");ur("2.5.29.25","cRLDistributionPoints");ur("2.5.29.26","issuingDistributionPoint");ur("2.5.29.27","deltaCRLIndicator");ur("2.5.29.28","issuingDistributionPoint");ur("2.5.29.29","certificateIssuer");ur("2.5.29.30","nameConstraints");se("2.5.29.31","cRLDistributionPoints");se("2.5.29.32","certificatePolicies");ur("2.5.29.33","policyMappings");ur("2.5.29.34","policyConstraints");se("2.5.29.35","authorityKeyIdentifier");ur("2.5.29.36","policyConstraints");se("2.5.29.37","extKeyUsage");ur("2.5.29.46","freshestCRL");ur("2.5.29.54","inhibitAnyPolicy");se("1.3.6.1.4.1.11129.2.4.2","timestampList");se("1.3.6.1.5.5.7.1.1","authorityInfoAccess");se("1.3.6.1.5.5.7.3.1","serverAuth");se("1.3.6.1.5.5.7.3.2","clientAuth");se("1.3.6.1.5.5.7.3.3","codeSigning");se("1.3.6.1.5.5.7.3.4","emailProtection");se("1.3.6.1.5.5.7.3.8","timeStamping")});var Ic=P((Jnt,BG)=>{var Or=at();gr();z1();var we=BG.exports=Or.asn1=Or.asn1||{};we.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};we.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};we.create=function(r,e,t,n,i){if(Or.util.isArray(n)){for(var o=[],s=0;s<n.length;++s)n[s]!==void 0&&o.push(n[s]);n=o}var a={tagClass:r,type:e,constructed:t,composed:t||Or.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=we.copy(a)),a};we.copy=function(r,e){var t;if(Or.util.isArray(r)){t=[];for(var n=0;n<r.length;++n)t.push(we.copy(r[n],e));return t}return typeof r=="string"?r:(t={tagClass:r.tagClass,type:r.type,constructed:r.constructed,composed:r.composed,value:we.copy(r.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=r.bitStringContents),t)};we.equals=function(r,e,t){if(Or.util.isArray(r)){if(!Or.util.isArray(e)||r.length!==e.length)return!1;for(var n=0;n<r.length;++n)if(!we.equals(r[n],e[n]))return!1;return!0}if(typeof r!=typeof e)return!1;if(typeof r=="string")return r===e;var i=r.tagClass===e.tagClass&&r.type===e.type&&r.constructed===e.constructed&&r.composed===e.composed&&we.equals(r.value,e.value);return t&&t.includeBitStringContents&&(i=i&&r.bitStringContents===e.bitStringContents),i};we.getBerValueLength=function(r){var e=r.getByte();if(e!==128){var t,n=e&128;return n?t=r.getInt((e&127)<<3):t=e,t}};function Ky(r,e,t){if(t>e){var n=new Error("Too few bytes to parse DER.");throw n.available=r.length(),n.remaining=e,n.requested=t,n}}var V7e=function(r,e){var t=r.getByte();if(e--,t!==128){var n,i=t&128;if(!i)n=t;else{var o=t&127;Ky(r,e,o),n=r.getInt(o<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};we.fromDer=function(r,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof r=="string"&&(r=Or.util.createBuffer(r));var t=r.length(),n=db(r,r.length(),0,e);if(e.parseAllBytes&&r.length()!==0){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=t,i.remaining=r.length(),i}return n};function db(r,e,t,n){var i;Ky(r,e,2);var o=r.getByte();e--;var s=o&192,a=o&31;i=r.length();var c=V7e(r,e);if(e-=i-r.length(),c!==void 0&&c>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=r.length(),u.remaining=e,u.requested=c,u}c=e}var l,f,h=(o&32)===32;if(h)if(l=[],c===void 0)for(;;){if(Ky(r,e,2),r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2),e-=2;break}i=r.length(),l.push(db(r,e,t+1,n)),e-=i-r.length()}else for(;c>0;)i=r.length(),l.push(db(r,c,t+1,n)),e-=i-r.length(),c-=i-r.length();if(l===void 0&&s===we.Class.UNIVERSAL&&a===we.Type.BITSTRING&&(f=r.bytes(c)),l===void 0&&n.decodeBitStrings&&s===we.Class.UNIVERSAL&&a===we.Type.BITSTRING&&c>1){var d=r.read,p=e,g=0;if(a===we.Type.BITSTRING&&(Ky(r,e,1),g=r.getByte(),e--),g===0)try{i=r.length();var w={strict:!0,decodeBitStrings:!0},_=db(r,e,t+1,w),x=i-r.length();e-=x,a==we.Type.BITSTRING&&x++;var m=_.tagClass;x===c&&(m===we.Class.UNIVERSAL||m===we.Class.CONTEXT_SPECIFIC)&&(l=[_])}catch{}l===void 0&&(r.read=d,e=p)}if(l===void 0){if(c===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e}if(a===we.Type.BMPSTRING)for(l="";c>0;c-=2)Ky(r,e,2),l+=String.fromCharCode(r.getInt16()),e-=2;else l=r.getBytes(c),e-=c}var y=f===void 0?null:{bitStringContents:f};return we.create(s,a,h,l,y)}we.toDer=function(r){var e=Or.util.createBuffer(),t=r.tagClass|r.type,n=Or.util.createBuffer(),i=!1;if("bitStringContents"in r&&(i=!0,r.original&&(i=we.equals(r,r.original))),i)n.putBytes(r.bitStringContents);else if(r.composed){r.constructed?t|=32:n.putByte(0);for(var o=0;o<r.value.length;++o)r.value[o]!==void 0&&n.putBuffer(we.toDer(r.value[o]))}else if(r.type===we.Type.BMPSTRING)for(var o=0;o<r.value.length;++o)n.putInt16(r.value.charCodeAt(o));else r.type===we.Type.INTEGER&&r.value.length>1&&(r.value.charCodeAt(0)===0&&!(r.value.charCodeAt(1)&128)||r.value.charCodeAt(0)===255&&(r.value.charCodeAt(1)&128)===128)?n.putBytes(r.value.substr(1)):n.putBytes(r.value);if(e.putByte(t),n.length()<=127)e.putByte(n.length()&127);else{var s=n.length(),a="";do a+=String.fromCharCode(s&255),s=s>>>8;while(s>0);e.putByte(a.length|128);for(var o=a.length-1;o>=0;--o)e.putByte(a.charCodeAt(o))}return e.putBuffer(n),e};we.oidToDer=function(r){var e=r.split("."),t=Or.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,i,o,s,a=2;a<e.length;++a){n=!0,i=[],o=parseInt(e[a],10);do s=o&127,o=o>>>7,n||(s|=128),i.push(s),n=!1;while(o>0);for(var c=i.length-1;c>=0;--c)t.putByte(i[c])}return t};we.derToOid=function(r){var e;typeof r=="string"&&(r=Or.util.createBuffer(r));var t=r.getByte();e=Math.floor(t/40)+"."+t%40;for(var n=0;r.length()>0;)t=r.getByte(),n=n<<7,t&128?n+=t&127:(e+="."+(n+t),n=0);return e};we.utcTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,2),10);t=t>=50?1900+t:2e3+t;var n=parseInt(r.substr(2,2),10)-1,i=parseInt(r.substr(4,2),10),o=parseInt(r.substr(6,2),10),s=parseInt(r.substr(8,2),10),a=0;if(r.length>11){var c=r.charAt(10),u=10;c!=="+"&&c!=="-"&&(a=parseInt(r.substr(10,2),10),u+=2)}if(e.setUTCFullYear(t,n,i),e.setUTCHours(o,s,a,0),u&&(c=r.charAt(u),c==="+"||c==="-")){var l=parseInt(r.substr(u+1,2),10),f=parseInt(r.substr(u+4,2),10),h=l*60+f;h*=6e4,c==="+"?e.setTime(+e-h):e.setTime(+e+h)}return e};we.generalizedTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,4),10),n=parseInt(r.substr(4,2),10)-1,i=parseInt(r.substr(6,2),10),o=parseInt(r.substr(8,2),10),s=parseInt(r.substr(10,2),10),a=parseInt(r.substr(12,2),10),c=0,u=0,l=!1;r.charAt(r.length-1)==="Z"&&(l=!0);var f=r.length-5,h=r.charAt(f);if(h==="+"||h==="-"){var d=parseInt(r.substr(f+1,2),10),p=parseInt(r.substr(f+4,2),10);u=d*60+p,u*=6e4,h==="+"&&(u*=-1),l=!0}return r.charAt(14)==="."&&(c=parseFloat(r.substr(14),10)*1e3),l?(e.setUTCFullYear(t,n,i),e.setUTCHours(o,s,a,c),e.setTime(+e+u)):(e.setFullYear(t,n,i),e.setHours(o,s,a,c)),e};we.dateToUtcTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push((""+r.getUTCFullYear()).substr(2)),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};we.dateToGeneralizedTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push(""+r.getUTCFullYear()),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};we.integerToDer=function(r){var e=Or.util.createBuffer();if(r>=-128&&r<128)return e.putSignedInt(r,8);if(r>=-32768&&r<32768)return e.putSignedInt(r,16);if(r>=-8388608&&r<8388608)return e.putSignedInt(r,24);if(r>=-2147483648&&r<2147483648)return e.putSignedInt(r,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=r,t};we.derToInteger=function(r){typeof r=="string"&&(r=Or.util.createBuffer(r));var e=r.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return r.getSignedInt(e)};we.validate=function(r,e,t,n){var i=!1;if((r.tagClass===e.tagClass||typeof e.tagClass>"u")&&(r.type===e.type||typeof e.type>"u"))if(r.constructed===e.constructed||typeof e.constructed>"u"){if(i=!0,e.value&&Or.util.isArray(e.value))for(var o=0,s=0;i&&s<e.value.length;++s)i=e.value[s].optional||!1,r.value[o]&&(i=we.validate(r.value[o],e.value[s],t,n),i?++o:e.value[s].optional&&(i=!0)),!i&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+r.value.length+'"');if(i&&t&&(e.capture&&(t[e.capture]=r.value),e.captureAsn1&&(t[e.captureAsn1]=r),e.captureBitStringContents&&"bitStringContents"in r&&(t[e.captureBitStringContents]=r.bitStringContents),e.captureBitStringValue&&"bitStringContents"in r)){var a;if(r.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var c=r.bitStringContents.charCodeAt(0);if(c!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=r.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+r.constructed+'"');else n&&(r.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+r.tagClass+'"'),r.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+r.type+'"'));return i};var LG=/[^\\u0000-\\u00ff]/;we.prettyPrint=function(r,e,t){var n="";e=e||0,t=t||2,e>0&&(n+=`
`);for(var i="",o=0;o<e*t;++o)i+=" ";switch(n+=i+"Tag: ",r.tagClass){case we.Class.UNIVERSAL:n+="Universal:";break;case we.Class.APPLICATION:n+="Application:";break;case we.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case we.Class.PRIVATE:n+="Private:";break}if(r.tagClass===we.Class.UNIVERSAL)switch(n+=r.type,r.type){case we.Type.NONE:n+=" (None)";break;case we.Type.BOOLEAN:n+=" (Boolean)";break;case we.Type.INTEGER:n+=" (Integer)";break;case we.Type.BITSTRING:n+=" (Bit string)";break;case we.Type.OCTETSTRING:n+=" (Octet string)";break;case we.Type.NULL:n+=" (Null)";break;case we.Type.OID:n+=" (Object Identifier)";break;case we.Type.ODESC:n+=" (Object Descriptor)";break;case we.Type.EXTERNAL:n+=" (External or Instance of)";break;case we.Type.REAL:n+=" (Real)";break;case we.Type.ENUMERATED:n+=" (Enumerated)";break;case we.Type.EMBEDDED:n+=" (Embedded PDV)";break;case we.Type.UTF8:n+=" (UTF8)";break;case we.Type.ROID:n+=" (Relative Object Identifier)";break;case we.Type.SEQUENCE:n+=" (Sequence)";break;case we.Type.SET:n+=" (Set)";break;case we.Type.PRINTABLESTRING:n+=" (Printable String)";break;case we.Type.IA5String:n+=" (IA5String (ASCII))";break;case we.Type.UTCTIME:n+=" (UTC time)";break;case we.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case we.Type.BMPSTRING:n+=" (BMP String)";break}else n+=r.type;if(n+=`
`,n+=i+"Constructed: "+r.constructed+`
`,r.composed){for(var s=0,a="",o=0;o<r.value.length;++o)r.value[o]!==void 0&&(s+=1,a+=we.prettyPrint(r.value[o],e+1,t),o+1<r.value.length&&(a+=","));n+=i+"Sub values: "+s+a}else{if(n+=i+"Value: ",r.type===we.Type.OID){var c=we.derToOid(r.value);n+=c,Or.pki&&Or.pki.oids&&c in Or.pki.oids&&(n+=" ("+Or.pki.oids[c]+") ")}if(r.type===we.Type.INTEGER)try{n+=we.derToInteger(r.value)}catch{n+="0x"+Or.util.bytesToHex(r.value)}else if(r.type===we.Type.BITSTRING){if(r.value.length>1?n+="0x"+Or.util.bytesToHex(r.value.slice(1)):n+="(none)",r.value.length>0){var u=r.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(r.type===we.Type.OCTETSTRING)LG.test(r.value)||(n+="("+r.value+") "),n+="0x"+Or.util.bytesToHex(r.value);else if(r.type===we.Type.UTF8)try{n+=Or.util.decodeUtf8(r.value)}catch(l){if(l.message==="URI malformed")n+="0x"+Or.util.bytesToHex(r.value)+" (malformed UTF8)";else throw l}else r.type===we.Type.PRINTABLESTRING||r.type===we.Type.IA5String?n+=r.value:LG.test(r.value)?n+="0x"+Or.util.bytesToHex(r.value):r.value.length===0?n+="[null]":n+=r.value}return n}});var GR=P((eit,MG)=>{var ri=at();gr();MG.exports=ri.cipher=ri.cipher||{};ri.cipher.algorithms=ri.cipher.algorithms||{};ri.cipher.createCipher=function(r,e){var t=r;if(typeof t=="string"&&(t=ri.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new ri.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};ri.cipher.createDecipher=function(r,e){var t=r;if(typeof t=="string"&&(t=ri.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new ri.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};ri.cipher.registerAlgorithm=function(r,e){r=r.toUpperCase(),ri.cipher.algorithms[r]=e};ri.cipher.getAlgorithm=function(r){return r=r.toUpperCase(),r in ri.cipher.algorithms?ri.cipher.algorithms[r]:null};var HR=ri.cipher.BlockCipher=function(r){this.algorithm=r.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=r.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=r.decrypt,this.algorithm.initialize(r)};HR.prototype.start=function(r){r=r||{};var e={};for(var t in r)e[t]=r[t];e.decrypt=this._decrypt,this._finish=!1,this._input=ri.util.createBuffer(),this.output=r.output||ri.util.createBuffer(),this.mode.start(e)};HR.prototype.update=function(r){for(r&&this._input.putBuffer(r);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};HR.prototype.finish=function(r){r&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return r(this.blockSize,t,!1)},this.mode.unpad=function(t){return r(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var WR=P((tit,UG)=>{var ni=at();gr();ni.cipher=ni.cipher||{};var Tt=UG.exports=ni.cipher.modes=ni.cipher.modes||{};Tt.ecb=function(r){r=r||{},this.name="ECB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Tt.ecb.prototype.start=function(r){};Tt.ecb.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Tt.ecb.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Tt.ecb.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};Tt.ecb.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};Tt.cbc=function(r){r=r||{},this.name="CBC",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Tt.cbc.prototype.start=function(r){if(r.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in r)this._iv=hb(r.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};Tt.cbc.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};Tt.cbc.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};Tt.cbc.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};Tt.cbc.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};Tt.cfb=function(r){r=r||{},this.name="CFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=ni.util.createBuffer(),this._partialBytes=0};Tt.cfb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=hb(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Tt.cfb.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);return}var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(o>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!t)return e.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Tt.cfb.prototype.decrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=r.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);return}var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=r.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(o>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!t)return e.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Tt.ofb=function(r){r=r||{},this.name="OFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ni.util.createBuffer(),this._partialBytes=0};Tt.ofb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=hb(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Tt.ofb.prototype.encrypt=function(r,e,t){var n=r.length();if(r.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];return}var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(o>0)r.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!t)return e.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Tt.ofb.prototype.decrypt=Tt.ofb.prototype.encrypt;Tt.ctr=function(r){r=r||{},this.name="CTR",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ni.util.createBuffer(),this._partialBytes=0};Tt.ctr.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=hb(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Tt.ctr.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(r.getInt32()^this._outBlock[i]);else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(o>0&&(r.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!t)return e.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}pb(this._inBlock)};Tt.ctr.prototype.decrypt=Tt.ctr.prototype.encrypt;Tt.gcm=function(r){r=r||{},this.name="GCM",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=ni.util.createBuffer(),this._partialBytes=0,this._R=3774873600};Tt.gcm.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");var e=ni.util.createBuffer(r.iv);this._cipherLength=0;var t;if("additionalData"in r?t=ni.util.createBuffer(r.additionalData):t=ni.util.createBuffer(),"tagLength"in r?this._tagLength=r.tagLength:this._tagLength=128,this._tag=null,r.decrypt&&(this._tag=ni.util.createBuffer(r.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(jR(n*8)))}this._inBlock=this._j0.slice(0),pb(this._inBlock),this._partialBytes=0,t=ni.util.createBuffer(t),this._aDataLength=jR(t.length()*8);var i=t.length()%this.blockSize;for(i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};Tt.gcm.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=r.getInt32());this._cipherLength+=this.blockSize}else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(r.getInt32()^this._outBlock[i]);if(o<=0||t){if(t){var s=n%this.blockSize;this._cipherLength+=s,this._partialOutput.truncate(this.blockSize-s)}else this._cipherLength+=this.blockSize;for(var i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!t)return r.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),pb(this._inBlock)};Tt.gcm.prototype.decrypt=function(r,e,t){var n=r.length();if(n<this.blockSize&&!(t&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),pb(this._inBlock),this._hashBlock[0]=r.getInt32(),this._hashBlock[1]=r.getInt32(),this._hashBlock[2]=r.getInt32(),this._hashBlock[3]=r.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};Tt.gcm.prototype.afterFinish=function(r,e){var t=!0;e.decrypt&&e.overflow&&r.truncate(this.blockSize-e.overflow),this.tag=ni.util.createBuffer();var n=this._aDataLength.concat(jR(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var o=0;o<this._ints;++o)this.tag.putInt32(this._s[o]^i[o]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};Tt.gcm.prototype.multiply=function(r,e){for(var t=[0,0,0,0],n=e.slice(0),i=0;i<128;++i){var o=r[i/32|0]&1<<31-i%32;o&&(t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3]),this.pow(n,n)}return t};Tt.gcm.prototype.pow=function(r,e){for(var t=r[3]&1,n=3;n>0;--n)e[n]=r[n]>>>1|(r[n-1]&1)<<31;e[0]=r[0]>>>1,t&&(e[0]^=this._R)};Tt.gcm.prototype.tableMultiply=function(r){for(var e=[0,0,0,0],t=0;t<32;++t){var n=t/8|0,i=r[n]>>>(7-t%8)*4&15,o=this._m[t][i];e[0]^=o[0],e[1]^=o[1],e[2]^=o[2],e[3]^=o[3]}return e};Tt.gcm.prototype.ghash=function(r,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};Tt.gcm.prototype.generateHashTable=function(r,e){for(var t=8/e,n=4*t,i=16*t,o=new Array(i),s=0;s<i;++s){var a=[0,0,0,0],c=s/n|0,u=(n-1-s%n)*e;a[c]=1<<e-1<<u,o[s]=this.generateSubHashTable(this.multiply(a,r),e)}return o};Tt.gcm.prototype.generateSubHashTable=function(r,e){var t=1<<e,n=t>>>1,i=new Array(t);i[n]=r.slice(0);for(var o=n>>>1;o>0;)this.pow(i[2*o],i[o]=[]),o>>=1;for(o=2;o<n;){for(var s=1;s<o;++s){var a=i[o],c=i[s];i[o+s]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}o*=2}for(i[0]=[0,0,0,0],o=n+1;o<t;++o){var u=i[o^n];i[o]=[r[0]^u[0],r[1]^u[1],r[2]^u[2],r[3]^u[3]]}return i};function hb(r,e){if(typeof r=="string"&&(r=ni.util.createBuffer(r)),ni.util.isArray(r)&&r.length>4){var t=r;r=ni.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}if(r.length()<e)throw new Error("Invalid IV length; got "+r.length()+" bytes and expected "+e+" bytes.");if(!ni.util.isArray(r)){for(var i=[],o=e/4,n=0;n<o;++n)i.push(r.getInt32());r=i}return r}function pb(r){r[r.length-1]=r[r.length-1]+1&4294967295}function jR(r){return[r/4294967296|0,r&4294967295]}});var Nh=P((rit,KG)=>{var Ar=at();GR();WR();gr();KG.exports=Ar.aes=Ar.aes||{};Ar.aes.startEncrypting=function(r,e,t,n){var i=mb({key:r,output:t,decrypt:!1,mode:n});return i.start(e),i};Ar.aes.createEncryptionCipher=function(r,e){return mb({key:r,output:null,decrypt:!1,mode:e})};Ar.aes.startDecrypting=function(r,e,t,n){var i=mb({key:r,output:t,decrypt:!0,mode:n});return i.start(e),i};Ar.aes.createDecryptionCipher=function(r,e){return mb({key:r,output:null,decrypt:!0,mode:e})};Ar.aes.Algorithm=function(r,e){XR||zG();var t=this;t.name=r,t.mode=new e({blockSize:16,cipher:{encrypt:function(n,i){return QR(t._w,n,i,!1)},decrypt:function(n,i){return QR(t._w,n,i,!0)}}}),t._init=!1};Ar.aes.Algorithm.prototype.initialize=function(r){if(!this._init){var e=r.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=Ar.util.createBuffer(e);else if(Ar.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=Ar.util.createBuffer();for(var n=0;n<t.length;++n)e.putByte(t[n])}if(!Ar.util.isArray(e)){t=e,e=[];var i=t.length();if(i===16||i===24||i===32){i=i>>>2;for(var n=0;n<i;++n)e.push(t.getInt32())}}if(!Ar.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var o=this.mode.name,s=["CFB","OFB","CTR","GCM"].indexOf(o)!==-1;this._w=VG(e,r.decrypt&&!s),this._init=!0}};Ar.aes._expandKey=function(r,e){return XR||zG(),VG(r,e)};Ar.aes._updateBlock=QR;K1("AES-ECB",Ar.cipher.modes.ecb);K1("AES-CBC",Ar.cipher.modes.cbc);K1("AES-CFB",Ar.cipher.modes.cfb);K1("AES-OFB",Ar.cipher.modes.ofb);K1("AES-CTR",Ar.cipher.modes.ctr);K1("AES-GCM",Ar.cipher.modes.gcm);function K1(r,e){var t=function(){return new Ar.aes.Algorithm(r,e)};Ar.cipher.registerAlgorithm(r,t)}var XR=!1,V1=4,eo,YR,FG,kh,La;function zG(){XR=!0,FG=[0,1,2,4,8,16,32,64,128,27,54];for(var r=new Array(256),e=0;e<128;++e)r[e]=e<<1,r[e+128]=e+128<<1^283;eo=new Array(256),YR=new Array(256),kh=new Array(4),La=new Array(4);for(var e=0;e<4;++e)kh[e]=new Array(256),La[e]=new Array(256);for(var t=0,n=0,i,o,s,a,c,u,l,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,eo[t]=a,YR[a]=t,c=r[a],i=r[t],o=r[i],s=r[o],u=c<<24^a<<16^a<<8^(a^c),l=(i^o^s)<<24^(t^s)<<16^(t^o^s)<<8^(t^i^s);for(var f=0;f<4;++f)kh[f][t]=u,La[f][a]=l,u=u<<24|u>>>8,l=l<<24|l>>>8;t===0?t=n=1:(t=i^r[r[r[i^s]]],n^=r[r[n]])}}function VG(r,e){for(var t=r.slice(0),n,i=1,o=t.length,s=o+6+1,a=V1*s,c=o;c<a;++c)n=t[c-1],c%o===0?(n=eo[n>>>16&255]<<24^eo[n>>>8&255]<<16^eo[n&255]<<8^eo[n>>>24]^FG[i]<<24,i++):o>6&&c%o===4&&(n=eo[n>>>24]<<24^eo[n>>>16&255]<<16^eo[n>>>8&255]<<8^eo[n&255]),t[c]=t[c-o]^n;if(e){var u,l=La[0],f=La[1],h=La[2],d=La[3],p=t.slice(0);a=t.length;for(var c=0,g=a-V1;c<a;c+=V1,g-=V1)if(c===0||c===a-V1)p[c]=t[g],p[c+1]=t[g+3],p[c+2]=t[g+2],p[c+3]=t[g+1];else for(var w=0;w<V1;++w)u=t[g+w],p[c+(3&-w)]=l[eo[u>>>24]]^f[eo[u>>>16&255]]^h[eo[u>>>8&255]]^d[eo[u&255]];t=p}return t}function QR(r,e,t,n){var i=r.length/4-1,o,s,a,c,u;n?(o=La[0],s=La[1],a=La[2],c=La[3],u=YR):(o=kh[0],s=kh[1],a=kh[2],c=kh[3],u=eo);var l,f,h,d,p,g,w;l=e[0]^r[0],f=e[n?3:1]^r[1],h=e[2]^r[2],d=e[n?1:3]^r[3];for(var _=3,x=1;x<i;++x)p=o[l>>>24]^s[f>>>16&255]^a[h>>>8&255]^c[d&255]^r[++_],g=o[f>>>24]^s[h>>>16&255]^a[d>>>8&255]^c[l&255]^r[++_],w=o[h>>>24]^s[d>>>16&255]^a[l>>>8&255]^c[f&255]^r[++_],d=o[d>>>24]^s[l>>>16&255]^a[f>>>8&255]^c[h&255]^r[++_],l=p,f=g,h=w;t[0]=u[l>>>24]<<24^u[f>>>16&255]<<16^u[h>>>8&255]<<8^u[d&255]^r[++_],t[n?3:1]=u[f>>>24]<<24^u[h>>>16&255]<<16^u[d>>>8&255]<<8^u[l&255]^r[++_],t[2]=u[h>>>24]<<24^u[d>>>16&255]<<16^u[l>>>8&255]<<8^u[f&255]^r[++_],t[n?1:3]=u[d>>>24]<<24^u[l>>>16&255]<<16^u[f>>>8&255]<<8^u[h&255]^r[++_]}function mb(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="AES-"+e,n;r.decrypt?n=Ar.cipher.createDecipher(t,r.key):n=Ar.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(o,s){var a=null;s instanceof Ar.util.ByteBuffer&&(a=s,s={}),s=s||{},s.output=a,s.iv=o,i.call(n,s)},n}});var yb=P((nit,qG)=>{var zr=at();GR();WR();gr();qG.exports=zr.des=zr.des||{};zr.des.startEncrypting=function(r,e,t,n){var i=gb({key:r,output:t,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};zr.des.createEncryptionCipher=function(r,e){return gb({key:r,output:null,decrypt:!1,mode:e})};zr.des.startDecrypting=function(r,e,t,n){var i=gb({key:r,output:t,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};zr.des.createDecryptionCipher=function(r,e){return gb({key:r,output:null,decrypt:!0,mode:e})};zr.des.Algorithm=function(r,e){var t=this;t.name=r,t.mode=new e({blockSize:8,cipher:{encrypt:function(n,i){return $G(t._keys,n,i,!1)},decrypt:function(n,i){return $G(t._keys,n,i,!0)}}}),t._init=!1};zr.des.Algorithm.prototype.initialize=function(r){if(!this._init){var e=zr.util.createBuffer(r.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=Q7e(e),this._init=!0}};Rc("DES-ECB",zr.cipher.modes.ecb);Rc("DES-CBC",zr.cipher.modes.cbc);Rc("DES-CFB",zr.cipher.modes.cfb);Rc("DES-OFB",zr.cipher.modes.ofb);Rc("DES-CTR",zr.cipher.modes.ctr);Rc("3DES-ECB",zr.cipher.modes.ecb);Rc("3DES-CBC",zr.cipher.modes.cbc);Rc("3DES-CFB",zr.cipher.modes.cfb);Rc("3DES-OFB",zr.cipher.modes.ofb);Rc("3DES-CTR",zr.cipher.modes.ctr);function Rc(r,e){var t=function(){return new zr.des.Algorithm(r,e)};zr.cipher.registerAlgorithm(r,t)}var K7e=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],$7e=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],q7e=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],H7e=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],G7e=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],j7e=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],W7e=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Y7e=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Q7e(r){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],s=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=r.length()>8?3:1,w=[],_=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],x=0,m,y=0;y<g;y++){var b=r.getInt32(),E=r.getInt32();m=(b>>>4^E)&252645135,E^=m,b^=m<<4,m=(E>>>-16^b)&65535,b^=m,E^=m<<-16,m=(b>>>2^E)&858993459,E^=m,b^=m<<2,m=(E>>>-16^b)&65535,b^=m,E^=m<<-16,m=(b>>>1^E)&1431655765,E^=m,b^=m<<1,m=(E>>>8^b)&16711935,b^=m,E^=m<<8,m=(b>>>1^E)&1431655765,E^=m,b^=m<<1,m=b<<8|E>>>20&240,b=E<<24|E<<8&16711680|E>>>8&65280|E>>>24&240,E=m;for(var v=0;v<_.length;++v){_[v]?(b=b<<2|b>>>26,E=E<<2|E>>>26):(b=b<<1|b>>>27,E=E<<1|E>>>27),b&=-15,E&=-15;var S=e[b>>>28]|t[b>>>24&15]|n[b>>>20&15]|i[b>>>16&15]|o[b>>>12&15]|s[b>>>8&15]|a[b>>>4&15],A=c[E>>>28]|u[E>>>24&15]|l[E>>>20&15]|f[E>>>16&15]|h[E>>>12&15]|d[E>>>8&15]|p[E>>>4&15];m=(A>>>16^S)&65535,w[x++]=S^m,w[x++]=A^m<<16}}return w}function $G(r,e,t,n){var i=r.length===32?3:9,o;i===3?o=n?[30,-2,-2]:[0,32,2]:o=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var s,a=e[0],c=e[1];s=(a>>>4^c)&252645135,c^=s,a^=s<<4,s=(a>>>16^c)&65535,c^=s,a^=s<<16,s=(c>>>2^a)&858993459,a^=s,c^=s<<2,s=(c>>>8^a)&16711935,a^=s,c^=s<<8,s=(a>>>1^c)&1431655765,c^=s,a^=s<<1,a=a<<1|a>>>31,c=c<<1|c>>>31;for(var u=0;u<i;u+=3){for(var l=o[u+1],f=o[u+2],h=o[u];h!=l;h+=f){var d=c^r[h],p=(c>>>4|c<<28)^r[h+1];s=a,a=c,c=s^($7e[d>>>24&63]|H7e[d>>>16&63]|j7e[d>>>8&63]|Y7e[d&63]|K7e[p>>>24&63]|q7e[p>>>16&63]|G7e[p>>>8&63]|W7e[p&63])}s=a,a=c,c=s}a=a>>>1|a<<31,c=c>>>1|c<<31,s=(a>>>1^c)&1431655765,c^=s,a^=s<<1,s=(c>>>8^a)&16711935,a^=s,c^=s<<8,s=(c>>>2^a)&858993459,a^=s,c^=s<<2,s=(a>>>16^c)&65535,c^=s,a^=s<<16,s=(a>>>4^c)&252645135,c^=s,a^=s<<4,t[0]=a,t[1]=c}function gb(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="DES-"+e,n;r.decrypt?n=zr.cipher.createDecipher(t,r.key):n=zr.cipher.createCipher(t,r.key);var i=n.start;return n.start=function(o,s){var a=null;s instanceof zr.util.ByteBuffer&&(a=s,s={}),s=s||{},s.output=a,s.iv=o,i.call(n,s)},n}});var Uf=P((iit,HG)=>{var wb=at();HG.exports=wb.md=wb.md||{};wb.md.algorithms=wb.md.algorithms||{}});var jG=P((oit,GG)=>{var Zu=at();Uf();gr();var X7e=GG.exports=Zu.hmac=Zu.hmac||{};X7e.create=function(){var r=null,e=null,t=null,n=null,i={};return i.start=function(o,s){if(o!==null)if(typeof o=="string")if(o=o.toLowerCase(),o in Zu.md.algorithms)e=Zu.md.algorithms[o].create();else throw new Error('Unknown hash algorithm "'+o+'"');else e=o;if(s===null)s=r;else{if(typeof s=="string")s=Zu.util.createBuffer(s);else if(Zu.util.isArray(s)){var a=s;s=Zu.util.createBuffer();for(var c=0;c<a.length;++c)s.putByte(a[c])}var u=s.length();u>e.blockLength&&(e.start(),e.update(s.bytes()),s=e.digest()),t=Zu.util.createBuffer(),n=Zu.util.createBuffer(),u=s.length();for(var c=0;c<u;++c){var a=s.at(c);t.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,c=0;c<a;++c)t.putByte(54),n.putByte(92);r=s,t=t.bytes(),n=n.bytes()}e.start(),e.update(t)},i.update=function(o){e.update(o)},i.getMac=function(){var o=e.digest().bytes();return e.start(),e.update(n),e.update(o),e.digest()},i.digest=i.getMac,i}});var Ju=P(()=>{});var bb=P((cit,WG)=>{var to=at();jG();Uf();gr();var Z7e=to.pkcs5=to.pkcs5||{},el;to.util.isNodejs&&!to.options.usePureJavaScript&&(el=Ju());WG.exports=to.pbkdf2=Z7e.pbkdf2=function(r,e,t,n,i,o){if(typeof i=="function"&&(o=i,i=null),to.util.isNodejs&&!to.options.usePureJavaScript&&el.pbkdf2&&(i===null||typeof i!="object")&&(el.pbkdf2Sync.length>4||!i||i==="sha1"))return typeof i!="string"&&(i="sha1"),r=Buffer.from(r,"binary"),e=Buffer.from(e,"binary"),o?el.pbkdf2Sync.length===4?el.pbkdf2(r,e,t,n,function(m,y){if(m)return o(m);o(null,y.toString("binary"))}):el.pbkdf2(r,e,t,n,i,function(m,y){if(m)return o(m);o(null,y.toString("binary"))}):el.pbkdf2Sync.length===4?el.pbkdf2Sync(r,e,t,n).toString("binary"):el.pbkdf2Sync(r,e,t,n,i).toString("binary");if((typeof i>"u"||i===null)&&(i="sha1"),typeof i=="string"){if(!(i in to.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=to.md[i].create()}var s=i.digestLength;if(n>4294967295*s){var a=new Error("Derived key is too long.");if(o)return o(a);throw a}var c=Math.ceil(n/s),u=n-(c-1)*s,l=to.hmac.create();l.start(i,r);var f="",h,d,p;if(!o){for(var g=1;g<=c;++g){l.start(null,null),l.update(e),l.update(to.util.int32ToBytes(g)),h=p=l.digest().getBytes();for(var w=2;w<=t;++w)l.start(null,null),l.update(p),d=l.digest().getBytes(),h=to.util.xorBytes(h,d,s),p=d;f+=g<c?h:h.substr(0,u)}return f}var g=1,w;function _(){if(g>c)return o(null,f);l.start(null,null),l.update(e),l.update(to.util.int32ToBytes(g)),h=p=l.digest().getBytes(),w=2,x()}function x(){if(w<=t)return l.start(null,null),l.update(p),d=l.digest().getBytes(),h=to.util.xorBytes(h,d,s),p=d,++w,to.util.setImmediate(x);f+=g<c?h:h.substr(0,u),++g,_()}_()}});var vb=P((uit,QG)=>{var Eb=at();gr();var YG=QG.exports=Eb.pem=Eb.pem||{};YG.encode=function(r,e){e=e||{};var t="-----BEGIN "+r.type+`-----\r
`,n;if(r.procType&&(n={name:"Proc-Type",values:[String(r.procType.version),r.procType.type]},t+=_b(n)),r.contentDomain&&(n={name:"Content-Domain",values:[r.contentDomain]},t+=_b(n)),r.dekInfo&&(n={name:"DEK-Info",values:[r.dekInfo.algorithm]},r.dekInfo.parameters&&n.values.push(r.dekInfo.parameters),t+=_b(n)),r.headers)for(var i=0;i<r.headers.length;++i)t+=_b(r.headers[i]);return r.procType&&(t+=`\r
`),t+=Eb.util.encode64(r.body,e.maxline||64)+`\r
`,t+="-----END "+r.type+`-----\r
`,t};YG.decode=function(r){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/,o;o=t.exec(r),!!o;){var s=o[1];s==="NEW CERTIFICATE REQUEST"&&(s="CERTIFICATE REQUEST");var a={type:s,procType:null,contentDomain:null,dekInfo:null,headers:[],body:Eb.util.decode64(o[3])};if(e.push(a),!!o[2]){for(var c=o[2].split(i),u=0;o&&u<c.length;){for(var l=c[u].replace(/\s+$/,""),f=u+1;f<c.length;++f){var h=c[f];if(!/\s/.test(h[0]))break;l+=h,u=f}if(o=l.match(n),o){for(var d={name:o[1],values:[]},p=o[2].split(","),g=0;g<p.length;++g)d.values.push(J7e(p[g]));if(a.procType)if(!a.contentDomain&&d.name==="Content-Domain")a.contentDomain=p[0]||"";else if(!a.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:p[0],parameters:p[1]||null}}else a.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:p[0],type:p[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function _b(r){for(var e=r.name+": ",t=[],n=function(c,u){return" "+u},i=0;i<r.values.length;++i)t.push(r.values[i].replace(/^(\S+\r\n)/,n));e+=t.join(",")+`\r
`;for(var o=0,s=-1,i=0;i<e.length;++i,++o)if(o>65&&s!==-1){var a=e[s];a===","?(++s,e=e.substr(0,s)+`\r
 `+e.substr(s)):e=e.substr(0,s)+`\r
`+a+e.substr(s+1),o=i-s-1,s=-1,++i}else(e[i]===" "||e[i]==="	"||e[i]===",")&&(s=i);return e}function J7e(r){return r.replace(/^\s+/,"")}});var rj=P((lit,tj)=>{var Cc=at();Uf();gr();var ZG=tj.exports=Cc.sha256=Cc.sha256||{};Cc.md.sha256=Cc.md.algorithms.sha256=ZG;ZG.create=function(){JG||eve();var r=null,e=Cc.util.createBuffer(),t=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,o=0;o<i;++o)n.fullMessageLength.push(0);return e=Cc.util.createBuffer(),r={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(i,o){o==="utf8"&&(i=Cc.util.encodeUtf8(i));var s=i.length;n.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=s[1],s[1]=s[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,s[0]=s[1]/4294967296>>>0;return e.putBytes(i),XG(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Cc.util.createBuffer();i.putBytes(e.bytes());var o=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,s=o&n.blockLength-1;i.putBytes(ZR.substr(0,n.blockLength-s));for(var a,c,u=n.fullMessageLength[0]*8,l=0;l<n.fullMessageLength.length-1;++l)a=n.fullMessageLength[l+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4,h5:r.h5,h6:r.h6,h7:r.h7};XG(f,t,i);var h=Cc.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h.putInt32(f.h5),h.putInt32(f.h6),h.putInt32(f.h7),h},n};var ZR=null,JG=!1,ej=null;function eve(){ZR=String.fromCharCode(128),ZR+=Cc.util.fillString(String.fromCharCode(0),64),ej=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],JG=!0}function XG(r,e,t){for(var n,i,o,s,a,c,u,l,f,h,d,p,g,w,_,x=t.length();x>=64;){for(u=0;u<16;++u)e[u]=t.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=n+e[u-7]+i+e[u-16]|0;for(l=r.h0,f=r.h1,h=r.h2,d=r.h3,p=r.h4,g=r.h5,w=r.h6,_=r.h7,u=0;u<64;++u)s=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),a=w^p&(g^w),o=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),c=l&f|h&(l^f),n=_+s+a+ej[u]+e[u],i=o+c,_=w,w=g,g=p,p=d+n>>>0,d=h,h=f,f=l,l=n+i>>>0;r.h0=r.h0+l|0,r.h1=r.h1+f|0,r.h2=r.h2+h|0,r.h3=r.h3+d|0,r.h4=r.h4+p|0,r.h5=r.h5+g|0,r.h6=r.h6+w|0,r.h7=r.h7+_|0,x-=64}}});var ij=P((fit,nj)=>{var Pc=at();gr();var xb=null;Pc.util.isNodejs&&!Pc.options.usePureJavaScript&&!process.versions["node-webkit"]&&(xb=Ju());var tve=nj.exports=Pc.prng=Pc.prng||{};tve.create=function(r){for(var e={plugin:r,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=r.md,n=new Array(32),i=0;i<32;++i)n[i]=t.create();e.pools=n,e.pool=0,e.generate=function(u,l){if(!l)return e.generateSync(u);var f=e.plugin.cipher,h=e.plugin.increment,d=e.plugin.formatKey,p=e.plugin.formatSeed,g=Pc.util.createBuffer();e.key=null,w();function w(_){if(_)return l(_);if(g.length()>=u)return l(null,g.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Pc.util.nextTick(function(){o(w)});var x=f(e.key,e.seed);e.generated+=x.length,g.putBytes(x),e.key=d(f(e.key,h(e.seed))),e.seed=p(f(e.key,e.seed)),Pc.util.setImmediate(w)}},e.generateSync=function(u){var l=e.plugin.cipher,f=e.plugin.increment,h=e.plugin.formatKey,d=e.plugin.formatSeed;e.key=null;for(var p=Pc.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&s();var g=l(e.key,e.seed);e.generated+=g.length,p.putBytes(g),e.key=h(l(e.key,f(e.seed))),e.seed=d(l(e.key,e.seed))}return p.getBytes(u)};function o(u){if(e.pools[0].messageLength>=32)return a(),u();var l=32-e.pools[0].messageLength<<5;e.seedFile(l,function(f,h){if(f)return u(f);e.collect(h),a(),u()})}function s(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var l=1,f=0;f<32;++f)e.reseeds%l===0&&(u.update(e.pools[f].digest().getBytes()),e.pools[f].start()),l=l<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var h=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(h),e.generated=0}function c(u){var l=null,f=Pc.util.globalScope,h=f.crypto||f.msCrypto;h&&h.getRandomValues&&(l=function(b){return h.getRandomValues(b)});var d=Pc.util.createBuffer();if(l)for(;d.length()<u;){var p=Math.max(1,Math.min(u-d.length(),65536)/4),g=new Uint32Array(Math.floor(p));try{l(g);for(var w=0;w<g.length;++w)d.putInt32(g[w])}catch(b){if(!(typeof QuotaExceededError<"u"&&b instanceof QuotaExceededError))throw b}}if(d.length()<u)for(var _,x,m,y=Math.floor(Math.random()*65536);d.length()<u;){x=16807*(y&65535),_=16807*(y>>16),x+=(_&32767)<<16,x+=_>>15,x=(x&2147483647)+(x>>31),y=x&4294967295;for(var w=0;w<3;++w)m=y>>>(w<<3),m^=Math.floor(Math.random()*256),d.putByte(m&255)}return d.getBytes(u)}return xb?(e.seedFile=function(u,l){xb.randomBytes(u,function(f,h){if(f)return l(f);l(null,h.toString())})},e.seedFileSync=function(u){return xb.randomBytes(u).toString()}):(e.seedFile=function(u,l){try{l(null,c(u))}catch(f){l(f)}},e.seedFileSync=c),e.collect=function(u){for(var l=u.length,f=0;f<l;++f)e.pools[e.pool].update(u.substr(f,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,l){for(var f="",h=0;h<l;h+=8)f+=String.fromCharCode(u>>h&255);e.collect(f)},e.registerWorker=function(u){if(u===self)e.seedFile=function(f,h){function d(p){var g=p.data;g.forge&&g.forge.prng&&(self.removeEventListener("message",d),h(g.forge.prng.err,g.forge.prng.bytes))}self.addEventListener("message",d),self.postMessage({forge:{prng:{needed:f}}})};else{var l=function(f){var h=f.data;h.forge&&h.forge.prng&&e.seedFile(h.forge.prng.needed,function(d,p){u.postMessage({forge:{prng:{err:d,bytes:p}}})})};u.addEventListener("message",l)}},e}});var Dh=P((dit,JR)=>{var ii=at();Nh();rj();ij();gr();(function(){if(ii.random&&ii.random.getBytes){JR.exports=ii.random;return}(function(r){var e={},t=new Array(4),n=ii.util.createBuffer();e.formatKey=function(f){var h=ii.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),ii.aes._expandKey(f,!1)},e.formatSeed=function(f){var h=ii.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),f},e.cipher=function(f,h){return ii.aes._updateBlock(f,h,t,!1),n.putInt32(t[0]),n.putInt32(t[1]),n.putInt32(t[2]),n.putInt32(t[3]),n.getBytes()},e.increment=function(f){return++f[3],f},e.md=ii.md.sha256;function i(){var f=ii.prng.create(e);return f.getBytes=function(h,d){return f.generate(h,d)},f.getBytesSync=function(h){return f.generate(h)},f}var o=i(),s=null,a=ii.util.globalScope,c=a.crypto||a.msCrypto;if(c&&c.getRandomValues&&(s=function(f){return c.getRandomValues(f)}),ii.options.usePureJavaScript||!ii.util.isNodejs&&!s){if(typeof window>"u"||window.document,o.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var l in navigator)try{typeof navigator[l]=="string"&&(u+=navigator[l])}catch{}o.collect(u),u=null}r&&(r().mousemove(function(f){o.collectInt(f.clientX,16),o.collectInt(f.clientY,16)}),r().keypress(function(f){o.collectInt(f.charCode,8)}))}if(!ii.random)ii.random=o;else for(var l in o)ii.random[l]=o[l];ii.random.createInstance=i,JR.exports=ii.random})(typeof jQuery<"u"?jQuery:null)})()});var cj=P((hit,aj)=>{var ho=at();gr();var eC=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],oj=[1,2,3,5],rve=function(r,e){return r<<e&65535|(r&65535)>>16-e},nve=function(r,e){return(r&65535)>>e|r<<16-e&65535};aj.exports=ho.rc2=ho.rc2||{};ho.rc2.expandKey=function(r,e){typeof r=="string"&&(r=ho.util.createBuffer(r)),e=e||128;var t=r,n=r.length(),i=e,o=Math.ceil(i/8),s=255>>(i&7),a;for(a=n;a<128;a++)t.putByte(eC[t.at(a-1)+t.at(a-n)&255]);for(t.setAt(128-o,eC[t.at(128-o)&s]),a=127-o;a>=0;a--)t.setAt(a,eC[t.at(a+1)^t.at(a+o)]);return t};var sj=function(r,e,t){var n=!1,i=null,o=null,s=null,a,c,u,l,f=[];for(r=ho.rc2.expandKey(r,e),u=0;u<64;u++)f.push(r.getInt16Le());t?(a=function(p){for(u=0;u<4;u++)p[u]+=f[l]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=rve(p[u],oj[u]),l++},c=function(p){for(u=0;u<4;u++)p[u]+=f[p[(u+3)%4]&63]}):(a=function(p){for(u=3;u>=0;u--)p[u]=nve(p[u],oj[u]),p[u]-=f[l]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),l--},c=function(p){for(u=3;u>=0;u--)p[u]-=f[p[(u+3)%4]&63]});var h=function(p){var g=[];for(u=0;u<4;u++){var w=i.getInt16Le();s!==null&&(t?w^=s.getInt16Le():s.putInt16Le(w)),g.push(w&65535)}l=t?0:63;for(var _=0;_<p.length;_++)for(var x=0;x<p[_][0];x++)p[_][1](g);for(u=0;u<4;u++)s!==null&&(t?s.putInt16Le(g[u]):g[u]^=s.getInt16Le()),o.putInt16Le(g[u])},d=null;return d={start:function(p,g){p&&typeof p=="string"&&(p=ho.util.createBuffer(p)),n=!1,i=ho.util.createBuffer(),o=g||new ho.util.createBuffer,s=p,d.output=o},update:function(p){for(n||i.putBuffer(p);i.length()>=8;)h([[5,a],[1,c],[6,a],[1,c],[5,a]])},finish:function(p){var g=!0;if(t)if(p)g=p(8,i,!t);else{var w=i.length()===8?8:8-i.length();i.fillWithByte(w,w)}if(g&&(n=!0,d.update()),!t&&(g=i.length()===0,g))if(p)g=p(8,o,!t);else{var _=o.length(),x=o.at(_-1);x>_?g=!1:o.truncate(x)}return g}},d};ho.rc2.startEncrypting=function(r,e,t){var n=ho.rc2.createEncryptionCipher(r,128);return n.start(e,t),n};ho.rc2.createEncryptionCipher=function(r,e){return sj(r,e,!0)};ho.rc2.startDecrypting=function(r,e,t){var n=ho.rc2.createDecryptionCipher(r,128);return n.start(e,t),n};ho.rc2.createDecryptionCipher=function(r,e){return sj(r,e,!1)}});var qy=P((pit,gj)=>{var tC=at();gj.exports=tC.jsbn=tC.jsbn||{};var tl,ive=0xdeadbeefcafe,uj=(ive&16777215)==15715070;function ne(r,e,t){this.data=[],r!=null&&(typeof r=="number"?this.fromNumber(r,e,t):e==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,e))}tC.jsbn.BigInteger=ne;function Gt(){return new ne(null)}function ove(r,e,t,n,i,o){for(;--o>=0;){var s=e*this.data[r++]+t.data[n]+i;i=Math.floor(s/67108864),t.data[n++]=s&67108863}return i}function sve(r,e,t,n,i,o){for(var s=e&32767,a=e>>15;--o>=0;){var c=this.data[r]&32767,u=this.data[r++]>>15,l=a*c+u*s;c=s*c+((l&32767)<<15)+t.data[n]+(i&1073741823),i=(c>>>30)+(l>>>15)+a*u+(i>>>30),t.data[n++]=c&1073741823}return i}function lj(r,e,t,n,i,o){for(var s=e&16383,a=e>>14;--o>=0;){var c=this.data[r]&16383,u=this.data[r++]>>14,l=a*c+u*s;c=s*c+((l&16383)<<14)+t.data[n]+i,i=(c>>28)+(l>>14)+a*u,t.data[n++]=c&268435455}return i}typeof navigator>"u"?(ne.prototype.am=lj,tl=28):uj&&navigator.appName=="Microsoft Internet Explorer"?(ne.prototype.am=sve,tl=30):uj&&navigator.appName!="Netscape"?(ne.prototype.am=ove,tl=26):(ne.prototype.am=lj,tl=28);ne.prototype.DB=tl;ne.prototype.DM=(1<<tl)-1;ne.prototype.DV=1<<tl;var rC=52;ne.prototype.FV=Math.pow(2,rC);ne.prototype.F1=rC-tl;ne.prototype.F2=2*tl-rC;var ave="0123456789abcdefghijklmnopqrstuvwxyz",Sb=new Array,$1,Ds;$1="0".charCodeAt(0);for(Ds=0;Ds<=9;++Ds)Sb[$1++]=Ds;$1="a".charCodeAt(0);for(Ds=10;Ds<36;++Ds)Sb[$1++]=Ds;$1="A".charCodeAt(0);for(Ds=10;Ds<36;++Ds)Sb[$1++]=Ds;function fj(r){return ave.charAt(r)}function dj(r,e){var t=Sb[r.charCodeAt(e)];return t??-1}function cve(r){for(var e=this.t-1;e>=0;--e)r.data[e]=this.data[e];r.t=this.t,r.s=this.s}function uve(r){this.t=1,this.s=r<0?-1:0,r>0?this.data[0]=r:r<-1?this.data[0]=r+this.DV:this.t=0}function Ff(r){var e=Gt();return e.fromInt(r),e}function lve(r,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(r,e);return}this.t=0,this.s=0;for(var n=r.length,i=!1,o=0;--n>=0;){var s=t==8?r[n]&255:dj(r,n);if(s<0){r.charAt(n)=="-"&&(i=!0);continue}i=!1,o==0?this.data[this.t++]=s:o+t>this.DB?(this.data[this.t-1]|=(s&(1<<this.DB-o)-1)<<o,this.data[this.t++]=s>>this.DB-o):this.data[this.t-1]|=s<<o,o+=t,o>=this.DB&&(o-=this.DB)}t==8&&r[0]&128&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&ne.ZERO.subTo(this,this)}function fve(){for(var r=this.s&this.DM;this.t>0&&this.data[this.t-1]==r;)--this.t}function dve(r){if(this.s<0)return"-"+this.negate().toString(r);var e;if(r==16)e=4;else if(r==8)e=3;else if(r==2)e=1;else if(r==32)e=5;else if(r==4)e=2;else return this.toRadix(r);var t=(1<<e)-1,n,i=!1,o="",s=this.t,a=this.DB-s*this.DB%e;if(s-- >0)for(a<this.DB&&(n=this.data[s]>>a)>0&&(i=!0,o=fj(n));s>=0;)a<e?(n=(this.data[s]&(1<<a)-1)<<e-a,n|=this.data[--s]>>(a+=this.DB-e)):(n=this.data[s]>>(a-=e)&t,a<=0&&(a+=this.DB,--s)),n>0&&(i=!0),i&&(o+=fj(n));return i?o:"0"}function hve(){var r=Gt();return ne.ZERO.subTo(this,r),r}function pve(){return this.s<0?this.negate():this}function mve(r){var e=this.s-r.s;if(e!=0)return e;var t=this.t;if(e=t-r.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-r.data[t])!=0)return e;return 0}function Ab(r){var e=1,t;return(t=r>>>16)!=0&&(r=t,e+=16),(t=r>>8)!=0&&(r=t,e+=8),(t=r>>4)!=0&&(r=t,e+=4),(t=r>>2)!=0&&(r=t,e+=2),(t=r>>1)!=0&&(r=t,e+=1),e}function gve(){return this.t<=0?0:this.DB*(this.t-1)+Ab(this.data[this.t-1]^this.s&this.DM)}function yve(r,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+r]=this.data[t];for(t=r-1;t>=0;--t)e.data[t]=0;e.t=this.t+r,e.s=this.s}function wve(r,e){for(var t=r;t<this.t;++t)e.data[t-r]=this.data[t];e.t=Math.max(this.t-r,0),e.s=this.s}function bve(r,e){var t=r%this.DB,n=this.DB-t,i=(1<<n)-1,o=Math.floor(r/this.DB),s=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+o+1]=this.data[a]>>n|s,s=(this.data[a]&i)<<t;for(a=o-1;a>=0;--a)e.data[a]=0;e.data[o]=s,e.t=this.t+o+1,e.s=this.s,e.clamp()}function _ve(r,e){e.s=this.s;var t=Math.floor(r/this.DB);if(t>=this.t){e.t=0;return}var n=r%this.DB,i=this.DB-n,o=(1<<n)-1;e.data[0]=this.data[t]>>n;for(var s=t+1;s<this.t;++s)e.data[s-t-1]|=(this.data[s]&o)<<i,e.data[s-t]=this.data[s]>>n;n>0&&(e.data[this.t-t-1]|=(this.s&o)<<i),e.t=this.t-t,e.clamp()}function Eve(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]-r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n-=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n-=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n-=r.s}e.s=n<0?-1:0,n<-1?e.data[t++]=this.DV+n:n>0&&(e.data[t++]=n),e.t=t,e.clamp()}function vve(r,e){var t=this.abs(),n=r.abs(),i=t.t;for(e.t=i+n.t;--i>=0;)e.data[i]=0;for(i=0;i<n.t;++i)e.data[i+t.t]=t.am(0,n.data[i],e,i,0,t.t);e.s=0,e.clamp(),this.s!=r.s&&ne.ZERO.subTo(e,e)}function xve(r){for(var e=this.abs(),t=r.t=2*e.t;--t>=0;)r.data[t]=0;for(t=0;t<e.t-1;++t){var n=e.am(t,e.data[t],r,2*t,0,1);(r.data[t+e.t]+=e.am(t+1,2*e.data[t],r,2*t+1,n,e.t-t-1))>=e.DV&&(r.data[t+e.t]-=e.DV,r.data[t+e.t+1]=1)}r.t>0&&(r.data[r.t-1]+=e.am(t,e.data[t],r,2*t,0,1)),r.s=0,r.clamp()}function Sve(r,e,t){var n=r.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e!=null&&e.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=Gt());var o=Gt(),s=this.s,a=r.s,c=this.DB-Ab(n.data[n.t-1]);c>0?(n.lShiftTo(c,o),i.lShiftTo(c,t)):(n.copyTo(o),i.copyTo(t));var u=o.t,l=o.data[u-1];if(l!=0){var f=l*(1<<this.F1)+(u>1?o.data[u-2]>>this.F2:0),h=this.FV/f,d=(1<<this.F1)/f,p=1<<this.F2,g=t.t,w=g-u,_=e??Gt();for(o.dlShiftTo(w,_),t.compareTo(_)>=0&&(t.data[t.t++]=1,t.subTo(_,t)),ne.ONE.dlShiftTo(u,_),_.subTo(o,o);o.t<u;)o.data[o.t++]=0;for(;--w>=0;){var x=t.data[--g]==l?this.DM:Math.floor(t.data[g]*h+(t.data[g-1]+p)*d);if((t.data[g]+=o.am(0,x,t,w,0,u))<x)for(o.dlShiftTo(w,_),t.subTo(_,t);t.data[g]<--x;)t.subTo(_,t)}e!=null&&(t.drShiftTo(u,e),s!=a&&ne.ZERO.subTo(e,e)),t.t=u,t.clamp(),c>0&&t.rShiftTo(c,t),s<0&&ne.ZERO.subTo(t,t)}}}function Ave(r){var e=Gt();return this.abs().divRemTo(r,null,e),this.s<0&&e.compareTo(ne.ZERO)>0&&r.subTo(e,e),e}function Oh(r){this.m=r}function Tve(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r}function Ive(r){return r}function Rve(r){r.divRemTo(this.m,null,r)}function Cve(r,e,t){r.multiplyTo(e,t),this.reduce(t)}function Pve(r,e){r.squareTo(e),this.reduce(e)}Oh.prototype.convert=Tve;Oh.prototype.revert=Ive;Oh.prototype.reduce=Rve;Oh.prototype.mulTo=Cve;Oh.prototype.sqrTo=Pve;function kve(){if(this.t<1)return 0;var r=this.data[0];if(!(r&1))return 0;var e=r&3;return e=e*(2-(r&15)*e)&15,e=e*(2-(r&255)*e)&255,e=e*(2-((r&65535)*e&65535))&65535,e=e*(2-r*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Lh(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function Nve(r){var e=Gt();return r.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),r.s<0&&e.compareTo(ne.ZERO)>0&&this.m.subTo(e,e),e}function Dve(r){var e=Gt();return r.copyTo(e),this.reduce(e),e}function Ove(r){for(;r.t<=this.mt2;)r.data[r.t++]=0;for(var e=0;e<this.m.t;++e){var t=r.data[e]&32767,n=t*this.mpl+((t*this.mph+(r.data[e]>>15)*this.mpl&this.um)<<15)&r.DM;for(t=e+this.m.t,r.data[t]+=this.m.am(0,n,r,e,0,this.m.t);r.data[t]>=r.DV;)r.data[t]-=r.DV,r.data[++t]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function Lve(r,e){r.squareTo(e),this.reduce(e)}function Bve(r,e,t){r.multiplyTo(e,t),this.reduce(t)}Lh.prototype.convert=Nve;Lh.prototype.revert=Dve;Lh.prototype.reduce=Ove;Lh.prototype.mulTo=Bve;Lh.prototype.sqrTo=Lve;function Mve(){return(this.t>0?this.data[0]&1:this.s)==0}function Uve(r,e){if(r>4294967295||r<1)return ne.ONE;var t=Gt(),n=Gt(),i=e.convert(this),o=Ab(r)-1;for(i.copyTo(t);--o>=0;)if(e.sqrTo(t,n),(r&1<<o)>0)e.mulTo(n,i,t);else{var s=t;t=n,n=s}return e.revert(t)}function Fve(r,e){var t;return r<256||e.isEven()?t=new Oh(e):t=new Lh(e),this.exp(r,t)}ne.prototype.copyTo=cve;ne.prototype.fromInt=uve;ne.prototype.fromString=lve;ne.prototype.clamp=fve;ne.prototype.dlShiftTo=yve;ne.prototype.drShiftTo=wve;ne.prototype.lShiftTo=bve;ne.prototype.rShiftTo=_ve;ne.prototype.subTo=Eve;ne.prototype.multiplyTo=vve;ne.prototype.squareTo=xve;ne.prototype.divRemTo=Sve;ne.prototype.invDigit=kve;ne.prototype.isEven=Mve;ne.prototype.exp=Uve;ne.prototype.toString=dve;ne.prototype.negate=hve;ne.prototype.abs=pve;ne.prototype.compareTo=mve;ne.prototype.bitLength=gve;ne.prototype.mod=Ave;ne.prototype.modPowInt=Fve;ne.ZERO=Ff(0);ne.ONE=Ff(1);function zve(){var r=Gt();return this.copyTo(r),r}function Vve(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function Kve(){return this.t==0?this.s:this.data[0]<<24>>24}function $ve(){return this.t==0?this.s:this.data[0]<<16>>16}function qve(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function Hve(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Gve(r){if(r==null&&(r=10),this.signum()==0||r<2||r>36)return"0";var e=this.chunkSize(r),t=Math.pow(r,e),n=Ff(t),i=Gt(),o=Gt(),s="";for(this.divRemTo(n,i,o);i.signum()>0;)s=(t+o.intValue()).toString(r).substr(1)+s,i.divRemTo(n,i,o);return o.intValue().toString(r)+s}function jve(r,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),n=Math.pow(e,t),i=!1,o=0,s=0,a=0;a<r.length;++a){var c=dj(r,a);if(c<0){r.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}s=e*s+c,++o>=t&&(this.dMultiply(n),this.dAddOffset(s,0),o=0,s=0)}o>0&&(this.dMultiply(Math.pow(e,o)),this.dAddOffset(s,0)),i&&ne.ZERO.subTo(this,this)}function Wve(r,e,t){if(typeof e=="number")if(r<2)this.fromInt(1);else for(this.fromNumber(r,t),this.testBit(r-1)||this.bitwiseTo(ne.ONE.shiftLeft(r-1),nC,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(ne.ONE.shiftLeft(r-1),this);else{var n=new Array,i=r&7;n.length=(r>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function Yve(){var r=this.t,e=new Array;e[0]=this.s;var t=this.DB-r*this.DB%8,n,i=0;if(r-- >0)for(t<this.DB&&(n=this.data[r]>>t)!=(this.s&this.DM)>>t&&(e[i++]=n|this.s<<this.DB-t);r>=0;)t<8?(n=(this.data[r]&(1<<t)-1)<<8-t,n|=this.data[--r]>>(t+=this.DB-8)):(n=this.data[r]>>(t-=8)&255,t<=0&&(t+=this.DB,--r)),n&128&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function Qve(r){return this.compareTo(r)==0}function Xve(r){return this.compareTo(r)<0?this:r}function Zve(r){return this.compareTo(r)>0?this:r}function Jve(r,e,t){var n,i,o=Math.min(r.t,this.t);for(n=0;n<o;++n)t.data[n]=e(this.data[n],r.data[n]);if(r.t<this.t){for(i=r.s&this.DM,n=o;n<this.t;++n)t.data[n]=e(this.data[n],i);t.t=this.t}else{for(i=this.s&this.DM,n=o;n<r.t;++n)t.data[n]=e(i,r.data[n]);t.t=r.t}t.s=e(this.s,r.s),t.clamp()}function e9e(r,e){return r&e}function t9e(r){var e=Gt();return this.bitwiseTo(r,e9e,e),e}function nC(r,e){return r|e}function r9e(r){var e=Gt();return this.bitwiseTo(r,nC,e),e}function hj(r,e){return r^e}function n9e(r){var e=Gt();return this.bitwiseTo(r,hj,e),e}function pj(r,e){return r&~e}function i9e(r){var e=Gt();return this.bitwiseTo(r,pj,e),e}function o9e(){for(var r=Gt(),e=0;e<this.t;++e)r.data[e]=this.DM&~this.data[e];return r.t=this.t,r.s=~this.s,r}function s9e(r){var e=Gt();return r<0?this.rShiftTo(-r,e):this.lShiftTo(r,e),e}function a9e(r){var e=Gt();return r<0?this.lShiftTo(-r,e):this.rShiftTo(r,e),e}function c9e(r){if(r==0)return-1;var e=0;return r&65535||(r>>=16,e+=16),r&255||(r>>=8,e+=8),r&15||(r>>=4,e+=4),r&3||(r>>=2,e+=2),r&1||++e,e}function u9e(){for(var r=0;r<this.t;++r)if(this.data[r]!=0)return r*this.DB+c9e(this.data[r]);return this.s<0?this.t*this.DB:-1}function l9e(r){for(var e=0;r!=0;)r&=r-1,++e;return e}function f9e(){for(var r=0,e=this.s&this.DM,t=0;t<this.t;++t)r+=l9e(this.data[t]^e);return r}function d9e(r){var e=Math.floor(r/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<r%this.DB)!=0}function h9e(r,e){var t=ne.ONE.shiftLeft(r);return this.bitwiseTo(t,e,t),t}function p9e(r){return this.changeBit(r,nC)}function m9e(r){return this.changeBit(r,pj)}function g9e(r){return this.changeBit(r,hj)}function y9e(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this.data[t]+r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n+=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n+=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=r.s}e.s=n<0?-1:0,n>0?e.data[t++]=n:n<-1&&(e.data[t++]=this.DV+n),e.t=t,e.clamp()}function w9e(r){var e=Gt();return this.addTo(r,e),e}function b9e(r){var e=Gt();return this.subTo(r,e),e}function _9e(r){var e=Gt();return this.multiplyTo(r,e),e}function E9e(r){var e=Gt();return this.divRemTo(r,e,null),e}function v9e(r){var e=Gt();return this.divRemTo(r,null,e),e}function x9e(r){var e=Gt(),t=Gt();return this.divRemTo(r,e,t),new Array(e,t)}function S9e(r){this.data[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()}function A9e(r,e){if(r!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=r;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function $y(){}function mj(r){return r}function T9e(r,e,t){r.multiplyTo(e,t)}function I9e(r,e){r.squareTo(e)}$y.prototype.convert=mj;$y.prototype.revert=mj;$y.prototype.mulTo=T9e;$y.prototype.sqrTo=I9e;function R9e(r){return this.exp(r,new $y)}function C9e(r,e,t){var n=Math.min(this.t+r.t,e);for(t.s=0,t.t=n;n>0;)t.data[--n]=0;var i;for(i=t.t-this.t;n<i;++n)t.data[n+this.t]=this.am(0,r.data[n],t,n,0,this.t);for(i=Math.min(r.t,e);n<i;++n)this.am(0,r.data[n],t,n,0,e-n);t.clamp()}function P9e(r,e,t){--e;var n=t.t=this.t+r.t-e;for(t.s=0;--n>=0;)t.data[n]=0;for(n=Math.max(e-this.t,0);n<r.t;++n)t.data[this.t+n-e]=this.am(e-n,r.data[n],t,0,0,this.t+n-e);t.clamp(),t.drShiftTo(1,t)}function q1(r){this.r2=Gt(),this.q3=Gt(),ne.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}function k9e(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var e=Gt();return r.copyTo(e),this.reduce(e),e}function N9e(r){return r}function D9e(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)}function O9e(r,e){r.squareTo(e),this.reduce(e)}function L9e(r,e,t){r.multiplyTo(e,t),this.reduce(t)}q1.prototype.convert=k9e;q1.prototype.revert=N9e;q1.prototype.reduce=D9e;q1.prototype.mulTo=L9e;q1.prototype.sqrTo=O9e;function B9e(r,e){var t=r.bitLength(),n,i=Ff(1),o;if(t<=0)return i;t<18?n=1:t<48?n=3:t<144?n=4:t<768?n=5:n=6,t<8?o=new Oh(e):e.isEven()?o=new q1(e):o=new Lh(e);var s=new Array,a=3,c=n-1,u=(1<<n)-1;if(s[1]=o.convert(this),n>1){var l=Gt();for(o.sqrTo(s[1],l);a<=u;)s[a]=Gt(),o.mulTo(l,s[a-2],s[a]),a+=2}var f=r.t-1,h,d=!0,p=Gt(),g;for(t=Ab(r.data[f])-1;f>=0;){for(t>=c?h=r.data[f]>>t-c&u:(h=(r.data[f]&(1<<t+1)-1)<<c-t,f>0&&(h|=r.data[f-1]>>this.DB+t-c)),a=n;!(h&1);)h>>=1,--a;if((t-=a)<0&&(t+=this.DB,--f),d)s[h].copyTo(i),d=!1;else{for(;a>1;)o.sqrTo(i,p),o.sqrTo(p,i),a-=2;a>0?o.sqrTo(i,p):(g=i,i=p,p=g),o.mulTo(p,s[h],i)}for(;f>=0&&!(r.data[f]&1<<t);)o.sqrTo(i,p),g=i,i=p,p=g,--t<0&&(t=this.DB-1,--f)}return o.revert(i)}function M9e(r){var e=this.s<0?this.negate():this.clone(),t=r.s<0?r.negate():r.clone();if(e.compareTo(t)<0){var n=e;e=t,t=n}var i=e.getLowestSetBit(),o=t.getLowestSetBit();if(o<0)return e;for(i<o&&(o=i),o>0&&(e.rShiftTo(o,e),t.rShiftTo(o,t));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return o>0&&t.lShiftTo(o,t),t}function U9e(r){if(r<=0)return 0;var e=this.DV%r,t=this.s<0?r-1:0;if(this.t>0)if(e==0)t=this.data[0]%r;else for(var n=this.t-1;n>=0;--n)t=(e*t+this.data[n])%r;return t}function F9e(r){var e=r.isEven();if(this.isEven()&&e||r.signum()==0)return ne.ZERO;for(var t=r.clone(),n=this.clone(),i=Ff(1),o=Ff(0),s=Ff(0),a=Ff(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!i.isEven()||!o.isEven())&&(i.addTo(this,i),o.subTo(r,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(r,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),e?((!s.isEven()||!a.isEven())&&(s.addTo(this,s),a.subTo(r,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(r,a),a.rShiftTo(1,a);t.compareTo(n)>=0?(t.subTo(n,t),e&&i.subTo(s,i),o.subTo(a,o)):(n.subTo(t,n),e&&s.subTo(i,s),a.subTo(o,a))}if(n.compareTo(ne.ONE)!=0)return ne.ZERO;if(a.compareTo(r)>=0)return a.subtract(r);if(a.signum()<0)a.addTo(r,a);else return a;return a.signum()<0?a.add(r):a}var Ba=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],z9e=(1<<26)/Ba[Ba.length-1];function V9e(r){var e,t=this.abs();if(t.t==1&&t.data[0]<=Ba[Ba.length-1]){for(e=0;e<Ba.length;++e)if(t.data[0]==Ba[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<Ba.length;){for(var n=Ba[e],i=e+1;i<Ba.length&&n<z9e;)n*=Ba[i++];for(n=t.modInt(n);e<i;)if(n%Ba[e++]==0)return!1}return t.millerRabin(r)}function K9e(r){var e=this.subtract(ne.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var n=e.shiftRight(t),i=$9e(),o,s=0;s<r;++s){do o=new ne(this.bitLength(),i);while(o.compareTo(ne.ONE)<=0||o.compareTo(e)>=0);var a=o.modPow(n,this);if(a.compareTo(ne.ONE)!=0&&a.compareTo(e)!=0){for(var c=1;c++<t&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(ne.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function $9e(){return{nextBytes:function(r){for(var e=0;e<r.length;++e)r[e]=Math.floor(Math.random()*256)}}}ne.prototype.chunkSize=qve;ne.prototype.toRadix=Gve;ne.prototype.fromRadix=jve;ne.prototype.fromNumber=Wve;ne.prototype.bitwiseTo=Jve;ne.prototype.changeBit=h9e;ne.prototype.addTo=y9e;ne.prototype.dMultiply=S9e;ne.prototype.dAddOffset=A9e;ne.prototype.multiplyLowerTo=C9e;ne.prototype.multiplyUpperTo=P9e;ne.prototype.modInt=U9e;ne.prototype.millerRabin=K9e;ne.prototype.clone=zve;ne.prototype.intValue=Vve;ne.prototype.byteValue=Kve;ne.prototype.shortValue=$ve;ne.prototype.signum=Hve;ne.prototype.toByteArray=Yve;ne.prototype.equals=Qve;ne.prototype.min=Xve;ne.prototype.max=Zve;ne.prototype.and=t9e;ne.prototype.or=r9e;ne.prototype.xor=n9e;ne.prototype.andNot=i9e;ne.prototype.not=o9e;ne.prototype.shiftLeft=s9e;ne.prototype.shiftRight=a9e;ne.prototype.getLowestSetBit=u9e;ne.prototype.bitCount=f9e;ne.prototype.testBit=d9e;ne.prototype.setBit=p9e;ne.prototype.clearBit=m9e;ne.prototype.flipBit=g9e;ne.prototype.add=w9e;ne.prototype.subtract=b9e;ne.prototype.multiply=_9e;ne.prototype.divide=E9e;ne.prototype.remainder=v9e;ne.prototype.divideAndRemainder=x9e;ne.prototype.modPow=B9e;ne.prototype.modInverse=F9e;ne.prototype.pow=R9e;ne.prototype.gcd=M9e;ne.prototype.isProbablePrime=V9e});var Ej=P((mit,_j)=>{var kc=at();Uf();gr();var wj=_j.exports=kc.sha1=kc.sha1||{};kc.md.sha1=kc.md.algorithms.sha1=wj;wj.create=function(){bj||q9e();var r=null,e=kc.util.createBuffer(),t=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,o=0;o<i;++o)n.fullMessageLength.push(0);return e=kc.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(i,o){o==="utf8"&&(i=kc.util.encodeUtf8(i));var s=i.length;n.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=s[1],s[1]=s[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,s[0]=s[1]/4294967296>>>0;return e.putBytes(i),yj(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=kc.util.createBuffer();i.putBytes(e.bytes());var o=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,s=o&n.blockLength-1;i.putBytes(iC.substr(0,n.blockLength-s));for(var a,c,u=n.fullMessageLength[0]*8,l=0;l<n.fullMessageLength.length-1;++l)a=n.fullMessageLength[l+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4};yj(f,t,i);var h=kc.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h},n};var iC=null,bj=!1;function q9e(){iC=String.fromCharCode(128),iC+=kc.util.fillString(String.fromCharCode(0),64),bj=!0}function yj(r,e,t){for(var n,i,o,s,a,c,u,l,f=t.length();f>=64;){for(i=r.h0,o=r.h1,s=r.h2,a=r.h3,c=r.h4,l=0;l<16;++l)n=t.getInt32(),e[l]=n,u=a^o&(s^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;for(;l<20;++l)n=e[l-3]^e[l-8]^e[l-14]^e[l-16],n=n<<1|n>>>31,e[l]=n,u=a^o&(s^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;for(;l<32;++l)n=e[l-3]^e[l-8]^e[l-14]^e[l-16],n=n<<1|n>>>31,e[l]=n,u=o^s^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;for(;l<40;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=o^s^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;for(;l<60;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=o&s|a&(o^s),n=(i<<5|i>>>27)+u+c+2400959708+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;for(;l<80;++l)n=e[l-6]^e[l-16]^e[l-28]^e[l-32],n=n<<2|n>>>30,e[l]=n,u=o^s^a,n=(i<<5|i>>>27)+u+c+3395469782+n,c=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=n;r.h0=r.h0+i|0,r.h1=r.h1+o|0,r.h2=r.h2+s|0,r.h3=r.h3+a|0,r.h4=r.h4+c|0,f-=64}}});var Sj=P((git,xj)=>{var Nc=at();gr();Dh();Ej();var vj=xj.exports=Nc.pkcs1=Nc.pkcs1||{};vj.encode_rsa_oaep=function(r,e,t){var n,i,o,s;typeof t=="string"?(n=t,i=arguments[3]||void 0,o=arguments[4]||void 0):t&&(n=t.label||void 0,i=t.seed||void 0,o=t.md||void 0,t.mgf1&&t.mgf1.md&&(s=t.mgf1.md)),o?o.start():o=Nc.md.sha1.create(),s||(s=o);var a=Math.ceil(r.n.bitLength()/8),c=a-2*o.digestLength-2;if(e.length>c){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=c,u}n||(n=""),o.update(n,"raw");for(var l=o.digest(),f="",h=c-e.length,d=0;d<h;d++)f+="\0";var p=l.getBytes()+f+""+e;if(!i)i=Nc.random.getBytes(o.digestLength);else if(i.length!==o.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=i.length,u.digestLength=o.digestLength,u}var g=Tb(i,a-o.digestLength-1,s),w=Nc.util.xorBytes(p,g,p.length),_=Tb(w,o.digestLength,s),x=Nc.util.xorBytes(i,_,i.length);return"\0"+x+w};vj.decode_rsa_oaep=function(r,e,t){var n,i,o;typeof t=="string"?(n=t,i=arguments[3]||void 0):t&&(n=t.label||void 0,i=t.md||void 0,t.mgf1&&t.mgf1.md&&(o=t.mgf1.md));var s=Math.ceil(r.n.bitLength()/8);if(e.length!==s){var w=new Error("RSAES-OAEP encoded message length is invalid.");throw w.length=e.length,w.expectedLength=s,w}if(i===void 0?i=Nc.md.sha1.create():i.start(),o||(o=i),s<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),c=e.charAt(0),u=e.substring(1,i.digestLength+1),l=e.substring(1+i.digestLength),f=Tb(l,i.digestLength,o),h=Nc.util.xorBytes(u,f,u.length),d=Tb(h,s-i.digestLength-1,o),p=Nc.util.xorBytes(l,d,l.length),g=p.substring(0,i.digestLength),w=c!=="\0",_=0;_<i.digestLength;++_)w|=a.charAt(_)!==g.charAt(_);for(var x=1,m=i.digestLength,y=i.digestLength;y<p.length;y++){var b=p.charCodeAt(y),E=b&1^1,v=x?65534:0;w|=b&v,x=x&E,m+=x}if(w||p.charCodeAt(m)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(m+1)};function Tb(r,e,t){t||(t=Nc.md.sha1.create());for(var n="",i=Math.ceil(e/t.digestLength),o=0;o<i;++o){var s=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255);t.start(),t.update(r+s),n+=t.digest().getBytes()}return n.substring(0,e)}});var Aj=P((yit,oC)=>{var zf=at();gr();qy();Dh();(function(){if(zf.prime){oC.exports=zf.prime;return}var r=oC.exports=zf.prime=zf.prime||{},e=zf.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(f,h){return f|h};r.generateProbablePrime=function(f,h,d){typeof h=="function"&&(d=h,h={}),h=h||{};var p=h.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var g=h.prng||zf.random,w={nextBytes:function(_){for(var x=g.getBytesSync(_.length),m=0;m<_.length;++m)_[m]=x.charCodeAt(m)}};if(p.name==="PRIMEINC")return o(f,w,p.options,d);throw new Error("Invalid prime generation algorithm: "+p.name)};function o(f,h,d,p){return"workers"in d?c(f,h,d,p):s(f,h,d,p)}function s(f,h,d,p){var g=u(f,h),w=0,_=l(g.bitLength());"millerRabinTests"in d&&(_=d.millerRabinTests);var x=10;"maxBlockTime"in d&&(x=d.maxBlockTime),a(g,f,h,w,_,x,p)}function a(f,h,d,p,g,w,_){var x=+new Date;do{if(f.bitLength()>h&&(f=u(h,d)),f.isProbablePrime(g))return _(null,f);f.dAddOffset(t[p++%8],0)}while(w<0||+new Date-x<w);zf.util.setImmediate(function(){a(f,h,d,p,g,w,_)})}function c(f,h,d,p){if(typeof Worker>"u")return s(f,h,d,p);var g=u(f,h),w=d.workers,_=d.workLoad||100,x=_*30/8,m=d.workerScript||"forge/prime.worker.js";if(w===-1)return zf.util.estimateCores(function(b,E){b&&(E=2),w=E-1,y()});y();function y(){w=Math.max(1,w);for(var b=[],E=0;E<w;++E)b[E]=new Worker(m);for(var v=w,E=0;E<w;++E)b[E].addEventListener("message",A);var S=!1;function A(I){if(!S){--v;var k=I.data;if(k.found){for(var N=0;N<b.length;++N)b[N].terminate();return S=!0,p(null,new e(k.prime,16))}g.bitLength()>f&&(g=u(f,h));var O=g.toString(16);I.target.postMessage({hex:O,workLoad:_}),g.dAddOffset(x,0)}}}}function u(f,h){var d=new e(f,h),p=f-1;return d.testBit(p)||d.bitwiseTo(e.ONE.shiftLeft(p),i,d),d.dAddOffset(31-d.mod(n).byteValue(),0),d}function l(f){return f<=100?27:f<=150?18:f<=200?15:f<=250?12:f<=300?9:f<=350?8:f<=400?7:f<=500?6:f<=600?5:f<=800?4:f<=1250?3:2}})()});var Bh=P((wit,Nj)=>{var Ve=at();Ic();qy();z1();Sj();Aj();Dh();gr();typeof Ft>"u"&&(Ft=Ve.jsbn.BigInteger);var Ft,sC=Ve.util.isNodejs?Ju():null,H=Ve.asn1,Os=Ve.util;Ve.pki=Ve.pki||{};Nj.exports=Ve.pki.rsa=Ve.rsa=Ve.rsa||{};var ct=Ve.pki,H9e=[6,4,2,4,2,4,6,2],G9e={name:"PrivateKeyInfo",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},j9e={name:"RSAPrivateKey",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},W9e={name:"RSAPublicKey",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},Y9e=Ve.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:H.Class.UNIVERSAL,type:H.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},Q9e={name:"DigestInfo",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:H.Class.UNIVERSAL,type:H.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},X9e=function(r){var e;if(r.algorithm in ct.oids)e=ct.oids[r.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=r.algorithm,t}var n=H.oidToDer(e).getBytes(),i=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[]),o=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[]);o.value.push(H.create(H.Class.UNIVERSAL,H.Type.OID,!1,n)),o.value.push(H.create(H.Class.UNIVERSAL,H.Type.NULL,!1,""));var s=H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,r.digest().getBytes());return i.value.push(o),i.value.push(s),H.toDer(i).getBytes()},Pj=function(r,e,t){if(t)return r.modPow(e.e,e.n);if(!e.p||!e.q)return r.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Ft.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Ft.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new Ft(Ve.util.bytesToHex(Ve.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(Ft.ONE));r=r.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var i=r.mod(e.p).modPow(e.dP,e.p),o=r.mod(e.q).modPow(e.dQ,e.q);i.compareTo(o)<0;)i=i.add(e.p);var s=i.subtract(o).multiply(e.qInv).mod(e.p).multiply(e.q).add(o);return s=s.multiply(n.modInverse(e.n)).mod(e.n),s};ct.rsa.encrypt=function(r,e,t){var n=t,i,o=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(n=t===2,i=kj(r,e,t)):(i=Ve.util.createBuffer(),i.putBytes(r));for(var s=new Ft(i.toHex(),16),a=Pj(s,e,n),c=a.toString(16),u=Ve.util.createBuffer(),l=o-Math.ceil(c.length/2);l>0;)u.putByte(0),--l;return u.putBytes(Ve.util.hexToBytes(c)),u.getBytes()};ct.rsa.decrypt=function(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8);if(r.length!==i){var o=new Error("Encrypted message length is invalid.");throw o.length=r.length,o.expected=i,o}var s=new Ft(Ve.util.createBuffer(r).toHex(),16);if(s.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=Pj(s,e,t),c=a.toString(16),u=Ve.util.createBuffer(),l=i-Math.ceil(c.length/2);l>0;)u.putByte(0),--l;return u.putBytes(Ve.util.hexToBytes(c)),n!==!1?Ib(u.getBytes(),e,t):u.getBytes()};ct.rsa.createKeyPairGenerationState=function(r,e,t){typeof r=="string"&&(r=parseInt(r,10)),r=r||2048,t=t||{};var n=t.prng||Ve.random,i={nextBytes:function(a){for(var c=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=c.charCodeAt(u)}},o=t.algorithm||"PRIMEINC",s;if(o==="PRIMEINC")s={algorithm:o,state:0,bits:r,rng:i,eInt:e||65537,e:new Ft(null),p:null,q:null,qBits:r>>1,pBits:r-(r>>1),pqState:0,num:null,keys:null},s.e.fromInt(s.eInt);else throw new Error("Invalid key generation algorithm: "+o);return s};ct.rsa.stepKeyPairGenerationState=function(r,e){"algorithm"in r||(r.algorithm="PRIMEINC");var t=new Ft(null);t.fromInt(30);for(var n=0,i=function(f,h){return f|h},o=+new Date,s,a=0;r.keys===null&&(e<=0||a<e);){if(r.state===0){var c=r.p===null?r.pBits:r.qBits,u=c-1;r.pqState===0?(r.num=new Ft(c,r.rng),r.num.testBit(u)||r.num.bitwiseTo(Ft.ONE.shiftLeft(u),i,r.num),r.num.dAddOffset(31-r.num.mod(t).byteValue(),0),n=0,++r.pqState):r.pqState===1?r.num.bitLength()>c?r.pqState=0:r.num.isProbablePrime(J9e(r.num.bitLength()))?++r.pqState:r.num.dAddOffset(H9e[n++%8],0):r.pqState===2?r.pqState=r.num.subtract(Ft.ONE).gcd(r.e).compareTo(Ft.ONE)===0?3:0:r.pqState===3&&(r.pqState=0,r.p===null?r.p=r.num:r.q=r.num,r.p!==null&&r.q!==null&&++r.state,r.num=null)}else if(r.state===1)r.p.compareTo(r.q)<0&&(r.num=r.p,r.p=r.q,r.q=r.num),++r.state;else if(r.state===2)r.p1=r.p.subtract(Ft.ONE),r.q1=r.q.subtract(Ft.ONE),r.phi=r.p1.multiply(r.q1),++r.state;else if(r.state===3)r.phi.gcd(r.e).compareTo(Ft.ONE)===0?++r.state:(r.p=null,r.q=null,r.state=0);else if(r.state===4)r.n=r.p.multiply(r.q),r.n.bitLength()===r.bits?++r.state:(r.q=null,r.state=0);else if(r.state===5){var l=r.e.modInverse(r.phi);r.keys={privateKey:ct.rsa.setPrivateKey(r.n,r.e,l,r.p,r.q,l.mod(r.p1),l.mod(r.q1),r.q.modInverse(r.p)),publicKey:ct.rsa.setPublicKey(r.n,r.e)}}s=+new Date,a+=s-o,o=s}return r.keys!==null};ct.rsa.generateKeyPair=function(r,e,t,n){if(arguments.length===1?typeof r=="object"?(t=r,r=void 0):typeof r=="function"&&(n=r,r=void 0):arguments.length===2?typeof r=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=r,n=e,r=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(n=t,t=void 0):(n=t,t=e,e=void 0)),t=t||{},r===void 0&&(r=t.bits||2048),e===void 0&&(e=t.e||65537),!Ve.options.usePureJavaScript&&!t.prng&&r>=256&&r<=16384&&(e===65537||e===3)){if(n){if(Tj("generateKeyPair"))return sC.generateKeyPair("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,c,u){if(a)return n(a);n(null,{privateKey:ct.privateKeyFromPem(u),publicKey:ct.publicKeyFromPem(c)})});if(Ij("generateKey")&&Ij("exportKey"))return Os.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:Cj(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return Os.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var c=ct.privateKeyFromAsn1(H.fromDer(Ve.util.createBuffer(a)));n(null,{privateKey:c,publicKey:ct.setRsaPublicKey(c.n,c.e)})}});if(Rj("generateKey")&&Rj("exportKey")){var i=Os.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:Cj(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);i.oncomplete=function(a){var c=a.target.result,u=Os.globalScope.msCrypto.subtle.exportKey("pkcs8",c.privateKey);u.oncomplete=function(l){var f=l.target.result,h=ct.privateKeyFromAsn1(H.fromDer(Ve.util.createBuffer(f)));n(null,{privateKey:h,publicKey:ct.setRsaPublicKey(h.n,h.e)})},u.onerror=function(l){n(l)}},i.onerror=function(a){n(a)};return}}else if(Tj("generateKeyPairSync")){var o=sC.generateKeyPairSync("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:ct.privateKeyFromPem(o.privateKey),publicKey:ct.publicKeyFromPem(o.publicKey)}}}var s=ct.rsa.createKeyPairGenerationState(r,e,t);if(!n)return ct.rsa.stepKeyPairGenerationState(s,0),s.keys;Z9e(s,t,n)};ct.setRsaPublicKey=ct.rsa.setPublicKey=function(r,e){var t={n:r,e};return t.encrypt=function(n,i,o){if(typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSAES-PKCS1-V1_5"),i==="RSAES-PKCS1-V1_5")i={encode:function(a,c,u){return kj(a,c,2).getBytes()}};else if(i==="RSA-OAEP"||i==="RSAES-OAEP")i={encode:function(a,c){return Ve.pkcs1.encode_rsa_oaep(c,a,o)}};else if(["RAW","NONE","NULL",null].indexOf(i)!==-1)i={encode:function(a){return a}};else if(typeof i=="string")throw new Error('Unsupported encryption scheme: "'+i+'".');var s=i.encode(n,t,!0);return ct.rsa.encrypt(s,t,!0)},t.verify=function(n,i,o,s){typeof o=="string"?o=o.toUpperCase():o===void 0&&(o="RSASSA-PKCS1-V1_5"),s===void 0&&(s={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in s||(s._parseAllDigestBytes=!0),o==="RSASSA-PKCS1-V1_5"?o={verify:function(c,u){u=Ib(u,t,!0);var l=H.fromDer(u,{parseAllBytes:s._parseAllDigestBytes}),f={},h=[];if(!H.validate(l,Q9e,f,h)){var d=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw d.errors=h,d}var p=H.derToOid(f.algorithmIdentifier);if(!(p===Ve.oids.md2||p===Ve.oids.md5||p===Ve.oids.sha1||p===Ve.oids.sha224||p===Ve.oids.sha256||p===Ve.oids.sha384||p===Ve.oids.sha512||p===Ve.oids["sha512-224"]||p===Ve.oids["sha512-256"])){var d=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw d.oid=p,d}if((p===Ve.oids.md2||p===Ve.oids.md5)&&!("parameters"in f))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return c===f.digest}}:(o==="NONE"||o==="NULL"||o===null)&&(o={verify:function(c,u){return u=Ib(u,t,!0),c===u}});var a=ct.rsa.decrypt(i,t,!0,!1);return o.verify(n,a,t.n.bitLength())},t};ct.setRsaPrivateKey=ct.rsa.setPrivateKey=function(r,e,t,n,i,o,s,a){var c={n:r,e,d:t,p:n,q:i,dP:o,dQ:s,qInv:a};return c.decrypt=function(u,l,f){typeof l=="string"?l=l.toUpperCase():l===void 0&&(l="RSAES-PKCS1-V1_5");var h=ct.rsa.decrypt(u,c,!1,!1);if(l==="RSAES-PKCS1-V1_5")l={decode:Ib};else if(l==="RSA-OAEP"||l==="RSAES-OAEP")l={decode:function(d,p){return Ve.pkcs1.decode_rsa_oaep(p,d,f)}};else if(["RAW","NONE","NULL",null].indexOf(l)!==-1)l={decode:function(d){return d}};else throw new Error('Unsupported encryption scheme: "'+l+'".');return l.decode(h,c,!1)},c.sign=function(u,l){var f=!1;typeof l=="string"&&(l=l.toUpperCase()),l===void 0||l==="RSASSA-PKCS1-V1_5"?(l={encode:X9e},f=1):(l==="NONE"||l==="NULL"||l===null)&&(l={encode:function(){return u}},f=1);var h=l.encode(u,c.n.bitLength());return ct.rsa.encrypt(h,c,f)},c};ct.wrapRsaPrivateKey=function(r){return H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,H.integerToDer(0).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(ct.oids.rsaEncryption).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.NULL,!1,"")]),H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,H.toDer(r).getBytes())])};ct.privateKeyFromAsn1=function(r){var e={},t=[];if(H.validate(r,G9e,e,t)&&(r=H.fromDer(Ve.util.createBuffer(e.privateKey))),e={},t=[],!H.validate(r,j9e,e,t)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=t,n}var i,o,s,a,c,u,l,f;return i=Ve.util.createBuffer(e.privateKeyModulus).toHex(),o=Ve.util.createBuffer(e.privateKeyPublicExponent).toHex(),s=Ve.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=Ve.util.createBuffer(e.privateKeyPrime1).toHex(),c=Ve.util.createBuffer(e.privateKeyPrime2).toHex(),u=Ve.util.createBuffer(e.privateKeyExponent1).toHex(),l=Ve.util.createBuffer(e.privateKeyExponent2).toHex(),f=Ve.util.createBuffer(e.privateKeyCoefficient).toHex(),ct.setRsaPrivateKey(new Ft(i,16),new Ft(o,16),new Ft(s,16),new Ft(a,16),new Ft(c,16),new Ft(u,16),new Ft(l,16),new Ft(f,16))};ct.privateKeyToAsn1=ct.privateKeyToRSAPrivateKey=function(r){return H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,H.integerToDer(0).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.n)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.e)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.d)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.p)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.q)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.dP)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.dQ)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.qInv))])};ct.publicKeyFromAsn1=function(r){var e={},t=[];if(H.validate(r,Y9e,e,t)){var n=H.derToOid(e.publicKeyOid);if(n!==ct.oids.rsaEncryption){var i=new Error("Cannot read public key. Unknown OID.");throw i.oid=n,i}r=e.rsaPublicKey}if(t=[],!H.validate(r,W9e,e,t)){var i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw i.errors=t,i}var o=Ve.util.createBuffer(e.publicKeyModulus).toHex(),s=Ve.util.createBuffer(e.publicKeyExponent).toHex();return ct.setRsaPublicKey(new Ft(o,16),new Ft(s,16))};ct.publicKeyToAsn1=ct.publicKeyToSubjectPublicKeyInfo=function(r){return H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(ct.oids.rsaEncryption).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.NULL,!1,"")]),H.create(H.Class.UNIVERSAL,H.Type.BITSTRING,!1,[ct.publicKeyToRSAPublicKey(r)])])};ct.publicKeyToRSAPublicKey=function(r){return H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.n)),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,Dc(r.e))])};function kj(r,e,t){var n=Ve.util.createBuffer(),i=Math.ceil(e.n.bitLength()/8);if(r.length>i-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=r.length,o.max=i-11,o}n.putByte(0),n.putByte(t);var s=i-3-r.length,a;if(t===0||t===1){a=t===0?0:255;for(var c=0;c<s;++c)n.putByte(a)}else for(;s>0;){for(var u=0,l=Ve.random.getBytes(s),c=0;c<s;++c)a=l.charCodeAt(c),a===0?++u:n.putByte(a);s=u}return n.putByte(0),n.putBytes(r),n}function Ib(r,e,t,n){var i=Math.ceil(e.n.bitLength()/8),o=Ve.util.createBuffer(r),s=o.getByte(),a=o.getByte();if(s!==0||t&&a!==0&&a!==1||!t&&a!=2||t&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var c=0;if(a===0){c=i-3-n;for(var u=0;u<c;++u)if(o.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(c=0;o.length()>1;){if(o.getByte()!==255){--o.read;break}++c}else if(a===2)for(c=0;o.length()>1;){if(o.getByte()===0){--o.read;break}++c}var l=o.getByte();if(l!==0||c!==i-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function Z9e(r,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),i();function i(){o(r.pBits,function(a,c){if(a)return t(a);if(r.p=c,r.q!==null)return s(a,r.q);o(r.qBits,s)})}function o(a,c){Ve.prime.generateProbablePrime(a,n,c)}function s(a,c){if(a)return t(a);if(r.q=c,r.p.compareTo(r.q)<0){var u=r.p;r.p=r.q,r.q=u}if(r.p.subtract(Ft.ONE).gcd(r.e).compareTo(Ft.ONE)!==0){r.p=null,i();return}if(r.q.subtract(Ft.ONE).gcd(r.e).compareTo(Ft.ONE)!==0){r.q=null,o(r.qBits,s);return}if(r.p1=r.p.subtract(Ft.ONE),r.q1=r.q.subtract(Ft.ONE),r.phi=r.p1.multiply(r.q1),r.phi.gcd(r.e).compareTo(Ft.ONE)!==0){r.p=r.q=null,i();return}if(r.n=r.p.multiply(r.q),r.n.bitLength()!==r.bits){r.q=null,o(r.qBits,s);return}var l=r.e.modInverse(r.phi);r.keys={privateKey:ct.rsa.setPrivateKey(r.n,r.e,l,r.p,r.q,l.mod(r.p1),l.mod(r.q1),r.q.modInverse(r.p)),publicKey:ct.rsa.setPublicKey(r.n,r.e)},t(null,r.keys)}}function Dc(r){var e=r.toString(16);e[0]>="8"&&(e="00"+e);var t=Ve.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&!(t.charCodeAt(1)&128)||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function J9e(r){return r<=100?27:r<=150?18:r<=200?15:r<=250?12:r<=300?9:r<=350?8:r<=400?7:r<=500?6:r<=600?5:r<=800?4:r<=1250?3:2}function Tj(r){return Ve.util.isNodejs&&typeof sC[r]=="function"}function Ij(r){return typeof Os.globalScope<"u"&&typeof Os.globalScope.crypto=="object"&&typeof Os.globalScope.crypto.subtle=="object"&&typeof Os.globalScope.crypto.subtle[r]=="function"}function Rj(r){return typeof Os.globalScope<"u"&&typeof Os.globalScope.msCrypto=="object"&&typeof Os.globalScope.msCrypto.subtle=="object"&&typeof Os.globalScope.msCrypto.subtle[r]=="function"}function Cj(r){for(var e=Ve.util.hexToBytes(r.toString(16)),t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}});var Rb=P((bit,Mj)=>{var Ae=at();Nh();Ic();yb();Uf();z1();bb();vb();Dh();cj();Bh();gr();typeof Dj>"u"&&(Dj=Ae.jsbn.BigInteger);var Dj,W=Ae.asn1,gt=Ae.pki=Ae.pki||{};Mj.exports=gt.pbe=Ae.pbe=Ae.pbe||{};var Mh=gt.oids,exe={name:"EncryptedPrivateKeyInfo",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:W.Class.UNIVERSAL,type:W.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:W.Class.UNIVERSAL,type:W.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},txe={name:"PBES2Algorithms",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:W.Class.UNIVERSAL,type:W.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:W.Class.UNIVERSAL,type:W.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:W.Class.UNIVERSAL,type:W.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:W.Class.UNIVERSAL,type:W.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:W.Class.UNIVERSAL,type:W.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:W.Class.UNIVERSAL,type:W.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:W.Class.UNIVERSAL,type:W.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},rxe={name:"pkcs-12PbeParams",tagClass:W.Class.UNIVERSAL,type:W.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:W.Class.UNIVERSAL,type:W.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:W.Class.UNIVERSAL,type:W.Type.INTEGER,constructed:!1,capture:"iterations"}]};gt.encryptPrivateKeyInfo=function(r,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var n=Ae.random.getBytesSync(t.saltSize),i=t.count,o=W.integerToDer(i),s,a,c;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var u,l,f;switch(t.algorithm){case"aes128":s=16,u=16,l=Mh["aes128-CBC"],f=Ae.aes.createEncryptionCipher;break;case"aes192":s=24,u=16,l=Mh["aes192-CBC"],f=Ae.aes.createEncryptionCipher;break;case"aes256":s=32,u=16,l=Mh["aes256-CBC"],f=Ae.aes.createEncryptionCipher;break;case"des":s=8,u=8,l=Mh.desCBC,f=Ae.des.createEncryptionCipher;break;default:var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var d="hmacWith"+t.prfAlgorithm.toUpperCase(),p=Bj(d),g=Ae.pkcs5.pbkdf2(e,n,i,s,p),w=Ae.random.getBytesSync(u),_=f(g);_.start(w),_.update(W.toDer(r)),_.finish(),c=_.output.getBytes();var x=nxe(n,o,s,d);a=W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OID,!1,W.oidToDer(Mh.pkcs5PBES2).getBytes()),W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OID,!1,W.oidToDer(Mh.pkcs5PBKDF2).getBytes()),x]),W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OID,!1,W.oidToDer(l).getBytes()),W.create(W.Class.UNIVERSAL,W.Type.OCTETSTRING,!1,w)])])])}else if(t.algorithm==="3des"){s=24;var m=new Ae.util.ByteBuffer(n),g=gt.pbe.generatePkcs12Key(e,m,1,i,s),w=gt.pbe.generatePkcs12Key(e,m,2,i,s),_=Ae.des.createEncryptionCipher(g);_.start(w),_.update(W.toDer(r)),_.finish(),c=_.output.getBytes(),a=W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OID,!1,W.oidToDer(Mh["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OCTETSTRING,!1,n),W.create(W.Class.UNIVERSAL,W.Type.INTEGER,!1,o.getBytes())])])}else{var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var y=W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[a,W.create(W.Class.UNIVERSAL,W.Type.OCTETSTRING,!1,c)]);return y};gt.decryptPrivateKeyInfo=function(r,e){var t=null,n={},i=[];if(!W.validate(r,exe,n,i)){var o=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw o.errors=i,o}var s=W.derToOid(n.encryptionOid),a=gt.pbe.getCipher(s,n.encryptionParams,e),c=Ae.util.createBuffer(n.encryptedData);return a.update(c),a.finish()&&(t=W.fromDer(a.output)),t};gt.encryptedPrivateKeyToPem=function(r,e){var t={type:"ENCRYPTED PRIVATE KEY",body:W.toDer(r).getBytes()};return Ae.pem.encode(t,{maxline:e})};gt.encryptedPrivateKeyFromPem=function(r){var e=Ae.pem.decode(r)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return W.fromDer(e.body)};gt.encryptRsaPrivateKey=function(r,e,t){if(t=t||{},!t.legacy){var n=gt.wrapRsaPrivateKey(gt.privateKeyToAsn1(r));return n=gt.encryptPrivateKeyInfo(n,e,t),gt.encryptedPrivateKeyToPem(n)}var i,o,s,a;switch(t.algorithm){case"aes128":i="AES-128-CBC",s=16,o=Ae.random.getBytesSync(16),a=Ae.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",s=24,o=Ae.random.getBytesSync(16),a=Ae.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",s=32,o=Ae.random.getBytesSync(16),a=Ae.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",s=24,o=Ae.random.getBytesSync(8),a=Ae.des.createEncryptionCipher;break;case"des":i="DES-CBC",s=8,o=Ae.random.getBytesSync(8),a=Ae.des.createEncryptionCipher;break;default:var c=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw c.algorithm=t.algorithm,c}var u=Ae.pbe.opensslDeriveBytes(e,o.substr(0,8),s),l=a(u);l.start(o),l.update(W.toDer(gt.privateKeyToAsn1(r))),l.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:Ae.util.bytesToHex(o).toUpperCase()},body:l.output.getBytes()};return Ae.pem.encode(f)};gt.decryptRsaPrivateKey=function(r,e){var t=null,n=Ae.pem.decode(r)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(n.procType&&n.procType.type==="ENCRYPTED"){var o,s;switch(n.dekInfo.algorithm){case"DES-CBC":o=8,s=Ae.des.createDecryptionCipher;break;case"DES-EDE3-CBC":o=24,s=Ae.des.createDecryptionCipher;break;case"AES-128-CBC":o=16,s=Ae.aes.createDecryptionCipher;break;case"AES-192-CBC":o=24,s=Ae.aes.createDecryptionCipher;break;case"AES-256-CBC":o=32,s=Ae.aes.createDecryptionCipher;break;case"RC2-40-CBC":o=5,s=function(f){return Ae.rc2.createDecryptionCipher(f,40)};break;case"RC2-64-CBC":o=8,s=function(f){return Ae.rc2.createDecryptionCipher(f,64)};break;case"RC2-128-CBC":o=16,s=function(f){return Ae.rc2.createDecryptionCipher(f,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw i.algorithm=n.dekInfo.algorithm,i}var a=Ae.util.hexToBytes(n.dekInfo.parameters),c=Ae.pbe.opensslDeriveBytes(e,a.substr(0,8),o),u=s(c);if(u.start(a),u.update(Ae.util.createBuffer(n.body)),u.finish())t=u.output.getBytes();else return t}else t=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?t=gt.decryptPrivateKeyInfo(W.fromDer(t),e):t=W.fromDer(t),t!==null&&(t=gt.privateKeyFromAsn1(t)),t};gt.pbe.generatePkcs12Key=function(r,e,t,n,i,o){var s,a;if(typeof o>"u"||o===null){if(!("sha1"in Ae.md))throw new Error('"sha1" hash algorithm unavailable.');o=Ae.md.sha1.create()}var c=o.digestLength,u=o.blockLength,l=new Ae.util.ByteBuffer,f=new Ae.util.ByteBuffer;if(r!=null){for(a=0;a<r.length;a++)f.putInt16(r.charCodeAt(a));f.putInt16(0)}var h=f.length(),d=e.length(),p=new Ae.util.ByteBuffer;p.fillWithByte(t,u);var g=u*Math.ceil(d/u),w=new Ae.util.ByteBuffer;for(a=0;a<g;a++)w.putByte(e.at(a%d));var _=u*Math.ceil(h/u),x=new Ae.util.ByteBuffer;for(a=0;a<_;a++)x.putByte(f.at(a%h));var m=w;m.putBuffer(x);for(var y=Math.ceil(i/c),b=1;b<=y;b++){var E=new Ae.util.ByteBuffer;E.putBytes(p.bytes()),E.putBytes(m.bytes());for(var v=0;v<n;v++)o.start(),o.update(E.getBytes()),E=o.digest();var S=new Ae.util.ByteBuffer;for(a=0;a<u;a++)S.putByte(E.at(a%c));var A=Math.ceil(d/u)+Math.ceil(h/u),I=new Ae.util.ByteBuffer;for(s=0;s<A;s++){var k=new Ae.util.ByteBuffer(m.getBytes(u)),N=511;for(a=S.length()-1;a>=0;a--)N=N>>8,N+=S.at(a)+k.at(a),k.setAt(a,N&255);I.putBuffer(k)}m=I,l.putBuffer(E)}return l.truncate(l.length()-i),l};gt.pbe.getCipher=function(r,e,t){switch(r){case gt.oids.pkcs5PBES2:return gt.pbe.getCipherForPBES2(r,e,t);case gt.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case gt.oids["pbewithSHAAnd40BitRC2-CBC"]:return gt.pbe.getCipherForPKCS12PBE(r,e,t);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=r,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};gt.pbe.getCipherForPBES2=function(r,e,t){var n={},i=[];if(!W.validate(e,txe,n,i)){var o=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw o.errors=i,o}if(r=W.derToOid(n.kdfOid),r!==gt.oids.pkcs5PBKDF2){var o=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw o.oid=r,o.supportedOids=["pkcs5PBKDF2"],o}if(r=W.derToOid(n.encOid),r!==gt.oids["aes128-CBC"]&&r!==gt.oids["aes192-CBC"]&&r!==gt.oids["aes256-CBC"]&&r!==gt.oids["des-EDE3-CBC"]&&r!==gt.oids.desCBC){var o=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw o.oid=r,o.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],o}var s=n.kdfSalt,a=Ae.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var c,u;switch(gt.oids[r]){case"aes128-CBC":c=16,u=Ae.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,u=Ae.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,u=Ae.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,u=Ae.des.createDecryptionCipher;break;case"desCBC":c=8,u=Ae.des.createDecryptionCipher;break}var l=Lj(n.prfOid),f=Ae.pkcs5.pbkdf2(t,s,a,c,l),h=n.encIv,d=u(f);return d.start(h),d};gt.pbe.getCipherForPKCS12PBE=function(r,e,t){var n={},i=[];if(!W.validate(e,rxe,n,i)){var o=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw o.errors=i,o}var s=Ae.util.createBuffer(n.salt),a=Ae.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var c,u,l;switch(r){case gt.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,u=8,l=Ae.des.startDecrypting;break;case gt.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,u=8,l=function(g,w){var _=Ae.rc2.createDecryptionCipher(g,40);return _.start(w,null),_};break;default:var o=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw o.oid=r,o}var f=Lj(n.prfOid),h=gt.pbe.generatePkcs12Key(t,s,1,a,c,f);f.start();var d=gt.pbe.generatePkcs12Key(t,s,2,a,u,f);return l(h,d)};gt.pbe.opensslDeriveBytes=function(r,e,t,n){if(typeof n>"u"||n===null){if(!("md5"in Ae.md))throw new Error('"md5" hash algorithm unavailable.');n=Ae.md.md5.create()}e===null&&(e="");for(var i=[Oj(n,r+e)],o=16,s=1;o<t;++s,o+=16)i.push(Oj(n,i[s-1]+r+e));return i.join("").substr(0,t)};function Oj(r,e){return r.start().update(e).digest().getBytes()}function Lj(r){var e;if(!r)e="hmacWithSHA1";else if(e=gt.oids[W.derToOid(r)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return Bj(e)}function Bj(r){var e=Ae.md;switch(r){case"hmacWithSHA224":e=Ae.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":r=r.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(r in e))throw new Error("Unknown hash algorithm: "+r);return e[r].create()}function nxe(r,e,t,n){var i=W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OCTETSTRING,!1,r),W.create(W.Class.UNIVERSAL,W.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&i.value.push(W.create(W.Class.UNIVERSAL,W.Type.INTEGER,!1,Ae.util.hexToBytes(t.toString(16))),W.create(W.Class.UNIVERSAL,W.Type.SEQUENCE,!0,[W.create(W.Class.UNIVERSAL,W.Type.OID,!1,W.oidToDer(gt.oids[n]).getBytes()),W.create(W.Class.UNIVERSAL,W.Type.NULL,!1,"")])),i}});var NC=P(($ot,EW)=>{var Mr=at();Uf();gr();var Zy=EW.exports=Mr.sha512=Mr.sha512||{};Mr.md.sha512=Mr.md.algorithms.sha512=Zy;var bW=Mr.sha384=Mr.sha512.sha384=Mr.sha512.sha384||{};bW.create=function(){return Zy.create("SHA-384")};Mr.md.sha384=Mr.md.algorithms.sha384=bW;Mr.sha512.sha256=Mr.sha512.sha256||{create:function(){return Zy.create("SHA-512/256")}};Mr.md["sha512/256"]=Mr.md.algorithms["sha512/256"]=Mr.sha512.sha256;Mr.sha512.sha224=Mr.sha512.sha224||{create:function(){return Zy.create("SHA-512/224")}};Mr.md["sha512/224"]=Mr.md.algorithms["sha512/224"]=Mr.sha512.sha224;Zy.create=function(r){if(_W||Mxe(),typeof r>"u"&&(r="SHA-512"),!(r in Kh))throw new Error("Invalid SHA-512 algorithm: "+r);for(var e=Kh[r],t=null,n=Mr.util.createBuffer(),i=new Array(80),o=0;o<80;++o)i[o]=new Array(2);var s=64;switch(r){case"SHA-384":s=48;break;case"SHA-512/256":s=32;break;case"SHA-512/224":s=28;break}var a={algorithm:r.replace("-","").toLowerCase(),blockLength:128,digestLength:s,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var c=a.messageLengthSize/4,u=0;u<c;++u)a.fullMessageLength.push(0);n=Mr.util.createBuffer(),t=new Array(e.length);for(var u=0;u<e.length;++u)t[u]=e[u].slice(0);return a},a.start(),a.update=function(c,u){u==="utf8"&&(c=Mr.util.encodeUtf8(c));var l=c.length;a.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var f=a.fullMessageLength.length-1;f>=0;--f)a.fullMessageLength[f]+=l[1],l[1]=l[0]+(a.fullMessageLength[f]/4294967296>>>0),a.fullMessageLength[f]=a.fullMessageLength[f]>>>0,l[0]=l[1]/4294967296>>>0;return n.putBytes(c),wW(t,i,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var c=Mr.util.createBuffer();c.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,l=u&a.blockLength-1;c.putBytes(PC.substr(0,a.blockLength-l));for(var f,h,d=a.fullMessageLength[0]*8,p=0;p<a.fullMessageLength.length-1;++p)f=a.fullMessageLength[p+1]*8,h=f/4294967296>>>0,d+=h,c.putInt32(d>>>0),d=f>>>0;c.putInt32(d);for(var g=new Array(t.length),p=0;p<t.length;++p)g[p]=t[p].slice(0);wW(g,i,c);var w=Mr.util.createBuffer(),_;r==="SHA-512"?_=g.length:r==="SHA-384"?_=g.length-2:_=g.length-4;for(var p=0;p<_;++p)w.putInt32(g[p][0]),(p!==_-1||r!=="SHA-512/224")&&w.putInt32(g[p][1]);return w},a};var PC=null,_W=!1,kC=null,Kh=null;function Mxe(){PC=String.fromCharCode(128),PC+=Mr.util.fillString(String.fromCharCode(0),128),kC=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Kh={},Kh["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Kh["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Kh["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Kh["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],_W=!0}function wW(r,e,t){for(var n,i,o,s,a,c,u,l,f,h,d,p,g,w,_,x,m,y,b,E,v,S,A,I,k,N,O,G,R,K,U,te,Ce,ae,$e,He=t.length();He>=128;){for(R=0;R<16;++R)e[R][0]=t.getInt32()>>>0,e[R][1]=t.getInt32()>>>0;for(;R<80;++R)te=e[R-2],K=te[0],U=te[1],n=((K>>>19|U<<13)^(U>>>29|K<<3)^K>>>6)>>>0,i=((K<<13|U>>>19)^(U<<3|K>>>29)^(K<<26|U>>>6))>>>0,ae=e[R-15],K=ae[0],U=ae[1],o=((K>>>1|U<<31)^(K>>>8|U<<24)^K>>>7)>>>0,s=((K<<31|U>>>1)^(K<<24|U>>>8)^(K<<25|U>>>7))>>>0,Ce=e[R-7],$e=e[R-16],U=i+Ce[1]+s+$e[1],e[R][0]=n+Ce[0]+o+$e[0]+(U/4294967296>>>0)>>>0,e[R][1]=U>>>0;for(g=r[0][0],w=r[0][1],_=r[1][0],x=r[1][1],m=r[2][0],y=r[2][1],b=r[3][0],E=r[3][1],v=r[4][0],S=r[4][1],A=r[5][0],I=r[5][1],k=r[6][0],N=r[6][1],O=r[7][0],G=r[7][1],R=0;R<80;++R)u=((v>>>14|S<<18)^(v>>>18|S<<14)^(S>>>9|v<<23))>>>0,l=((v<<18|S>>>14)^(v<<14|S>>>18)^(S<<23|v>>>9))>>>0,f=(k^v&(A^k))>>>0,h=(N^S&(I^N))>>>0,a=((g>>>28|w<<4)^(w>>>2|g<<30)^(w>>>7|g<<25))>>>0,c=((g<<4|w>>>28)^(w<<30|g>>>2)^(w<<25|g>>>7))>>>0,d=(g&_|m&(g^_))>>>0,p=(w&x|y&(w^x))>>>0,U=G+l+h+kC[R][1]+e[R][1],n=O+u+f+kC[R][0]+e[R][0]+(U/4294967296>>>0)>>>0,i=U>>>0,U=c+p,o=a+d+(U/4294967296>>>0)>>>0,s=U>>>0,O=k,G=N,k=A,N=I,A=v,I=S,U=E+i,v=b+n+(U/4294967296>>>0)>>>0,S=U>>>0,b=m,E=y,m=_,y=x,_=g,x=w,U=i+s,g=n+o+(U/4294967296>>>0)>>>0,w=U>>>0;U=r[0][1]+w,r[0][0]=r[0][0]+g+(U/4294967296>>>0)>>>0,r[0][1]=U>>>0,U=r[1][1]+x,r[1][0]=r[1][0]+_+(U/4294967296>>>0)>>>0,r[1][1]=U>>>0,U=r[2][1]+y,r[2][0]=r[2][0]+m+(U/4294967296>>>0)>>>0,r[2][1]=U>>>0,U=r[3][1]+E,r[3][0]=r[3][0]+b+(U/4294967296>>>0)>>>0,r[3][1]=U>>>0,U=r[4][1]+S,r[4][0]=r[4][0]+v+(U/4294967296>>>0)>>>0,r[4][1]=U>>>0,U=r[5][1]+I,r[5][0]=r[5][0]+A+(U/4294967296>>>0)>>>0,r[5][1]=U>>>0,U=r[6][1]+N,r[6][0]=r[6][0]+k+(U/4294967296>>>0)>>>0,r[6][1]=U>>>0,U=r[7][1]+G,r[7][0]=r[7][0]+O+(U/4294967296>>>0)>>>0,r[7][1]=U>>>0,He-=128}}});var iY=P((Pst,nY)=>{"use strict";nY.exports=si;var l3=Gh();function si(r,e){this.lo=r>>>0,this.hi=e>>>0}var Hh=si.zero=new si(0,0);Hh.toNumber=function(){return 0};Hh.zzEncode=Hh.zzDecode=function(){return this};Hh.length=function(){return 1};var hSe=si.zeroHash="\0\0\0\0\0\0\0\0";si.fromNumber=function(e){if(e===0)return Hh;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new si(n,i)};si.from=function(e){if(typeof e=="number")return si.fromNumber(e);if(l3.isString(e))if(l3.Long)e=l3.Long.fromString(e);else return si.fromNumber(parseInt(e,10));return e.low||e.high?new si(e.low>>>0,e.high>>>0):Hh};si.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};si.prototype.toLong=function(e){return l3.Long?new l3.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Qf=String.prototype.charCodeAt;si.fromHash=function(e){return e===hSe?Hh:new si((Qf.call(e,0)|Qf.call(e,1)<<8|Qf.call(e,2)<<16|Qf.call(e,3)<<24)>>>0,(Qf.call(e,4)|Qf.call(e,5)<<8|Qf.call(e,6)<<16|Qf.call(e,7)<<24)>>>0)};si.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};si.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};si.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};si.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Gh=P(WC=>{"use strict";var Be=WC;Be.asPromise=N6();Be.base64=O6();Be.EventEmitter=B6();Be.float=M6();Be.inquire=U6();Be.utf8=F6();Be.pool=z6();Be.LongBits=iY();Be.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Be.global=Be.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||WC;Be.emptyArray=Object.freeze?Object.freeze([]):[];Be.emptyObject=Object.freeze?Object.freeze({}):{};Be.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Be.isString=function(e){return typeof e=="string"||e instanceof String};Be.isObject=function(e){return e&&typeof e=="object"};Be.isset=Be.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Be.Buffer=function(){try{var r=Be.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Be._Buffer_from=null;Be._Buffer_allocUnsafe=null;Be.newBuffer=function(e){return typeof e=="number"?Be.Buffer?Be._Buffer_allocUnsafe(e):new Be.Array(e):Be.Buffer?Be._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Be.Array=typeof Uint8Array<"u"?Uint8Array:Array;Be.Long=Be.global.dcodeIO&&Be.global.dcodeIO.Long||Be.global.Long||Be.inquire("long");Be.key2Re=/^true|false|0|1$/;Be.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Be.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Be.longToHash=function(e){return e?Be.LongBits.from(e).toHash():Be.LongBits.zeroHash};Be.longFromHash=function(e,t){var n=Be.LongBits.fromHash(e);return Be.Long?Be.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)};function oY(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Be.merge=oY;Be.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function sY(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&oY(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Be.newError=sY;Be.ProtocolError=sY("ProtocolError");Be.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),o=i.length-1;o>-1;--o)if(t[i[o]]===1&&this[i[o]]!==void 0&&this[i[o]]!==null)return i[o]}};Be.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Be.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Be._configure=function(){var r=Be.Buffer;if(!r){Be._Buffer_from=Be._Buffer_allocUnsafe=null;return}Be._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Be._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var XC=P((Nst,fY)=>{"use strict";fY.exports=wn;var Ka=Gh(),QC,uY=Ka.LongBits,pSe=Ka.utf8;function $a(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function wn(r){this.buf=r,this.pos=0,this.len=r.length}var aY=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new wn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new wn(e);throw Error("illegal buffer")},lY=function(){return Ka.Buffer?function(t){return(wn.create=function(i){return Ka.Buffer.isBuffer(i)?new QC(i):aY(i)})(t)}:aY};wn.create=lY();wn.prototype._slice=Ka.Array.prototype.subarray||Ka.Array.prototype.slice;wn.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,$a(this,10);return e}}();wn.prototype.int32=function(){return this.uint32()|0};wn.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function YC(){var r=new uY(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw $a(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw $a(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}wn.prototype.bool=function(){return this.uint32()!==0};function Jb(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}wn.prototype.fixed32=function(){if(this.pos+4>this.len)throw $a(this,4);return Jb(this.buf,this.pos+=4)};wn.prototype.sfixed32=function(){if(this.pos+4>this.len)throw $a(this,4);return Jb(this.buf,this.pos+=4)|0};function cY(){if(this.pos+8>this.len)throw $a(this,8);return new uY(Jb(this.buf,this.pos+=4),Jb(this.buf,this.pos+=4))}wn.prototype.float=function(){if(this.pos+4>this.len)throw $a(this,4);var e=Ka.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};wn.prototype.double=function(){if(this.pos+8>this.len)throw $a(this,4);var e=Ka.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};wn.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw $a(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var i=Ka.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)};wn.prototype.string=function(){var e=this.bytes();return pSe.read(e,0,e.length)};wn.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw $a(this,e);this.pos+=e}else do if(this.pos>=this.len)throw $a(this);while(this.buf[this.pos++]&128);return this};wn.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};wn._configure=function(r){QC=r,wn.create=lY(),QC._configure();var e=Ka.Long?"toLong":"toNumber";Ka.merge(wn.prototype,{int64:function(){return YC.call(this)[e](!1)},uint64:function(){return YC.call(this)[e](!0)},sint64:function(){return YC.call(this).zzDecode()[e](!1)},fixed64:function(){return cY.call(this)[e](!0)},sfixed64:function(){return cY.call(this)[e](!1)}})}});var mY=P((Dst,pY)=>{"use strict";pY.exports=jh;var hY=XC();(jh.prototype=Object.create(hY.prototype)).constructor=jh;var dY=Gh();function jh(r){hY.call(this,r)}jh._configure=function(){dY.Buffer&&(jh.prototype._slice=dY.Buffer.prototype.slice)};jh.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};jh._configure()});var iP=P((Ost,bY)=>{"use strict";bY.exports=Wt;var Ms=Gh(),ZC,e_=Ms.LongBits,gY=Ms.base64,yY=Ms.utf8;function f3(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function eP(){}function mSe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Wt(){this.len=0,this.head=new f3(eP,0,0),this.tail=this.head,this.states=null}var wY=function(){return Ms.Buffer?function(){return(Wt.create=function(){return new ZC})()}:function(){return new Wt}};Wt.create=wY();Wt.alloc=function(e){return new Ms.Array(e)};Ms.Array!==Array&&(Wt.alloc=Ms.pool(Wt.alloc,Ms.Array.prototype.subarray));Wt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new f3(e,t,n),this.len+=t,this};function tP(r,e,t){e[t]=r&255}function gSe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function rP(r,e){this.len=r,this.next=void 0,this.val=e}rP.prototype=Object.create(f3.prototype);rP.prototype.fn=gSe;Wt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new rP((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Wt.prototype.int32=function(e){return e<0?this._push(nP,10,e_.fromNumber(e)):this.uint32(e)};Wt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function nP(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Wt.prototype.uint64=function(e){var t=e_.from(e);return this._push(nP,t.length(),t)};Wt.prototype.int64=Wt.prototype.uint64;Wt.prototype.sint64=function(e){var t=e_.from(e).zzEncode();return this._push(nP,t.length(),t)};Wt.prototype.bool=function(e){return this._push(tP,1,e?1:0)};function JC(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Wt.prototype.fixed32=function(e){return this._push(JC,4,e>>>0)};Wt.prototype.sfixed32=Wt.prototype.fixed32;Wt.prototype.fixed64=function(e){var t=e_.from(e);return this._push(JC,4,t.lo)._push(JC,4,t.hi)};Wt.prototype.sfixed64=Wt.prototype.fixed64;Wt.prototype.float=function(e){return this._push(Ms.float.writeFloatLE,4,e)};Wt.prototype.double=function(e){return this._push(Ms.float.writeDoubleLE,8,e)};var ySe=Ms.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Wt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(tP,1,0);if(Ms.isString(e)){var n=Wt.alloc(t=gY.length(e));gY.decode(e,n,0),e=n}return this.uint32(t)._push(ySe,t,e)};Wt.prototype.string=function(e){var t=yY.length(e);return t?this.uint32(t)._push(yY.write,t,e):this._push(tP,1,0)};Wt.prototype.fork=function(){return this.states=new mSe(this),this.head=this.tail=new f3(eP,0,0),this.len=0,this};Wt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new f3(eP,0,0),this.len=0),this};Wt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Wt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Wt._configure=function(r){ZC=r,Wt.create=wY(),ZC._configure()}});var vY=P((Lst,EY)=>{"use strict";EY.exports=Fc;var _Y=iP();(Fc.prototype=Object.create(_Y.prototype)).constructor=Fc;var Xf=Gh();function Fc(){_Y.call(this)}Fc._configure=function(){Fc.alloc=Xf._Buffer_allocUnsafe,Fc.writeBytesBuffer=Xf.Buffer&&Xf.Buffer.prototype instanceof Uint8Array&&Xf.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};Fc.prototype.bytes=function(e){Xf.isString(e)&&(e=Xf._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Fc.writeBytesBuffer,t,e),this};function wSe(r,e,t){r.length<40?Xf.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Fc.prototype.string=function(e){var t=Xf.Buffer.byteLength(e);return this.uint32(t),t&&this._push(wSe,t,e),this};Fc._configure()});var QQ=P((sut,YQ)=>{var gm=1e3,ym=gm*60,wm=ym*60,Xh=wm*24,aAe=Xh*7,cAe=Xh*365.25;YQ.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return uAe(r);if(t==="number"&&isFinite(r))return e.long?fAe(r):lAe(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function uAe(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*cAe;case"weeks":case"week":case"w":return t*aAe;case"days":case"day":case"d":return t*Xh;case"hours":case"hour":case"hrs":case"hr":case"h":return t*wm;case"minutes":case"minute":case"mins":case"min":case"m":return t*ym;case"seconds":case"second":case"secs":case"sec":case"s":return t*gm;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function lAe(r){var e=Math.abs(r);return e>=Xh?Math.round(r/Xh)+"d":e>=wm?Math.round(r/wm)+"h":e>=ym?Math.round(r/ym)+"m":e>=gm?Math.round(r/gm)+"s":r+"ms"}function fAe(r){var e=Math.abs(r);return e>=Xh?b_(r,e,Xh,"day"):e>=wm?b_(r,e,wm,"hour"):e>=ym?b_(r,e,ym,"minute"):e>=gm?b_(r,e,gm,"second"):r+" ms"}function b_(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var ZQ=P((aut,XQ)=>{function dAe(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=QQ(),t.destroy=u,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let h=0;h<l.length;h++)f=(f<<5)-f+l.charCodeAt(h),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,h=null,d,p;function g(...w){if(!g.enabled)return;let _=g,x=Number(new Date),m=x-(f||x);_.diff=m,_.prev=f,_.curr=x,f=x,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let y=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(E,v)=>{if(E==="%%")return"%";y++;let S=t.formatters[v];if(typeof S=="function"){let A=w[y];E=S.call(_,A),w.splice(y,1),y--}return E}),t.formatArgs.call(_,w),(_.log||t.log).apply(_,w)}return g.namespace=l,g.useColors=t.useColors(),g.color=t.selectColor(l),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(d!==t.namespaces&&(d=t.namespaces,p=t.enabled(l)),p),set:w=>{h=w}}),typeof t.init=="function"&&t.init(g),g}function n(l,f){let h=t(this.namespace+(typeof f>"u"?":":f)+l);return h.log=this.log,h}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f,h=(typeof l=="string"?l:"").split(/[\s,]+/),d=h.length;for(f=0;f<d;f++)h[f]&&(l=h[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function o(){let l=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),l}function s(l){if(l[l.length-1]==="*")return!0;let f,h;for(f=0,h=t.skips.length;f<h;f++)if(t.skips[f].test(l))return!1;for(f=0,h=t.names.length;f<h;f++)if(t.names[f].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}XQ.exports=dAe});var $s=P((Yo,__)=>{Yo.formatArgs=pAe;Yo.save=mAe;Yo.load=gAe;Yo.useColors=hAe;Yo.storage=yAe();Yo.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Yo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hAe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function pAe(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+__.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Yo.log=console.debug||console.log||(()=>{});function mAe(r){try{r?Yo.storage.setItem("debug",r):Yo.storage.removeItem("debug")}catch{}}function gAe(){let r;try{r=Yo.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function yAe(){try{return localStorage}catch{}}__.exports=ZQ()(Yo);var{formatters:wAe}=__.exports;wAe.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var v_=P((RP,CP)=>{(function(r,e){typeof RP=="object"&&typeof CP<"u"?CP.exports=function(t,n,i,o,s){for(n=n.split?n.split("."):n,o=0;o<n.length;o++)t=t?t[n[o]]:s;return t===s?i:t}:typeof define=="function"&&define.amd?define(function(){return function(t,n,i,o,s){for(n=n.split?n.split("."):n,o=0;o<n.length;o++)t=t?t[n[o]]:s;return t===s?i:t}}):r.dlv=function(t,n,i,o,s){for(n=n.split?n.split("."):n,o=0;o<n.length;o++)t=t?t[n[o]]:s;return t===s?i:t}})(RP)});var lX=P((Ift,uX)=>{"use strict";var RAe=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;uX.exports=function(e,t){if(t==null&&(t=!1),e.length<2||e.length>255)return!1;var n=e[e.length-1];if(t){if(n!==".")return!1}else if(n===".")return!1;return RAe.test(e)}});var MX=P((Odt,BX)=>{BX.exports=qP;var LX=128,jAe=127,WAe=~jAe,YAe=Math.pow(2,31);function qP(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw qP.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=YAe;)e[t++]=r&255|LX,r/=128;for(;r&WAe;)e[t++]=r&255|LX,r>>>=7;return e[t]=r|0,qP.bytes=t-n+1,e}});var zX=P((Ldt,FX)=>{FX.exports=HP;var QAe=128,UX=127;function HP(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a||i>49)throw HP.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&UX)<<i:(s&UX)*Math.pow(2,i),i+=7}while(s>=QAe);return HP.bytes=o-n,t}});var KX=P((Bdt,VX)=>{var XAe=Math.pow(2,7),ZAe=Math.pow(2,14),JAe=Math.pow(2,21),eTe=Math.pow(2,28),tTe=Math.pow(2,35),rTe=Math.pow(2,42),nTe=Math.pow(2,49),iTe=Math.pow(2,56),oTe=Math.pow(2,63);VX.exports=function(r){return r<XAe?1:r<ZAe?2:r<JAe?3:r<eTe?4:r<tTe?5:r<rTe?6:r<nTe?7:r<iTe?8:r<oTe?9:10}});var Xo=P((Mdt,$X)=>{$X.exports={encode:MX(),decode:zX(),encodingLength:KX()}});var pZ=P((z3,Y_)=>{(function(r,e){"use strict";var t={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(d){if(!Array.isArray(d)&&!ArrayBuffer.isView(d))return!1;for(var p=0;p<d.length;p++)if(!Number.isInteger(d[p])||d[p]<0||d[p]>255)return!1;return!0}function i(d,p){return(d&65535)*p+(((d>>>16)*p&65535)<<16)}function o(d,p){return d<<p|d>>>32-p}function s(d){return d^=d>>>16,d=i(d,2246822507),d^=d>>>13,d=i(d,3266489909),d^=d>>>16,d}function a(d,p){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535];var g=[0,0,0,0];return g[3]+=d[3]+p[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]+p[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]+p[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]+p[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function c(d,p){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535];var g=[0,0,0,0];return g[3]+=d[3]*p[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]*p[3],g[1]+=g[2]>>>16,g[2]&=65535,g[2]+=d[3]*p[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]*p[3],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[2]*p[2],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[3]*p[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]*p[3]+d[1]*p[2]+d[2]*p[1]+d[3]*p[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function u(d,p){return p%=64,p===32?[d[1],d[0]]:p<32?[d[0]<<p|d[1]>>>32-p,d[1]<<p|d[0]>>>32-p]:(p-=32,[d[1]<<p|d[0]>>>32-p,d[0]<<p|d[1]>>>32-p])}function l(d,p){return p%=64,p===0?d:p<32?[d[0]<<p|d[1]>>>32-p,d[1]<<p]:[d[1]<<p-32,0]}function f(d,p){return[d[0]^p[0],d[1]^p[1]]}function h(d){return d=f(d,[0,d[0]>>>1]),d=c(d,[4283543511,3981806797]),d=f(d,[0,d[0]>>>1]),d=c(d,[3301882366,444984403]),d=f(d,[0,d[0]>>>1]),d}t.x86.hash32=function(d,p){if(t.inputValidation&&!n(d))return e;p=p||0;for(var g=d.length%4,w=d.length-g,_=p,x=0,m=3432918353,y=461845907,b=0;b<w;b=b+4)x=d[b]|d[b+1]<<8|d[b+2]<<16|d[b+3]<<24,x=i(x,m),x=o(x,15),x=i(x,y),_^=x,_=o(_,13),_=i(_,5)+3864292196;switch(x=0,g){case 3:x^=d[b+2]<<16;case 2:x^=d[b+1]<<8;case 1:x^=d[b],x=i(x,m),x=o(x,15),x=i(x,y),_^=x}return _^=d.length,_=s(_),_>>>0},t.x86.hash128=function(d,p){if(t.inputValidation&&!n(d))return e;p=p||0;for(var g=d.length%16,w=d.length-g,_=p,x=p,m=p,y=p,b=0,E=0,v=0,S=0,A=597399067,I=2869860233,k=951274213,N=2716044179,O=0;O<w;O=O+16)b=d[O]|d[O+1]<<8|d[O+2]<<16|d[O+3]<<24,E=d[O+4]|d[O+5]<<8|d[O+6]<<16|d[O+7]<<24,v=d[O+8]|d[O+9]<<8|d[O+10]<<16|d[O+11]<<24,S=d[O+12]|d[O+13]<<8|d[O+14]<<16|d[O+15]<<24,b=i(b,A),b=o(b,15),b=i(b,I),_^=b,_=o(_,19),_+=x,_=i(_,5)+1444728091,E=i(E,I),E=o(E,16),E=i(E,k),x^=E,x=o(x,17),x+=m,x=i(x,5)+197830471,v=i(v,k),v=o(v,17),v=i(v,N),m^=v,m=o(m,15),m+=y,m=i(m,5)+2530024501,S=i(S,N),S=o(S,18),S=i(S,A),y^=S,y=o(y,13),y+=_,y=i(y,5)+850148119;switch(b=0,E=0,v=0,S=0,g){case 15:S^=d[O+14]<<16;case 14:S^=d[O+13]<<8;case 13:S^=d[O+12],S=i(S,N),S=o(S,18),S=i(S,A),y^=S;case 12:v^=d[O+11]<<24;case 11:v^=d[O+10]<<16;case 10:v^=d[O+9]<<8;case 9:v^=d[O+8],v=i(v,k),v=o(v,17),v=i(v,N),m^=v;case 8:E^=d[O+7]<<24;case 7:E^=d[O+6]<<16;case 6:E^=d[O+5]<<8;case 5:E^=d[O+4],E=i(E,I),E=o(E,16),E=i(E,k),x^=E;case 4:b^=d[O+3]<<24;case 3:b^=d[O+2]<<16;case 2:b^=d[O+1]<<8;case 1:b^=d[O],b=i(b,A),b=o(b,15),b=i(b,I),_^=b}return _^=d.length,x^=d.length,m^=d.length,y^=d.length,_+=x,_+=m,_+=y,x+=_,m+=_,y+=_,_=s(_),x=s(x),m=s(m),y=s(y),_+=x,_+=m,_+=y,x+=_,m+=_,y+=_,("00000000"+(_>>>0).toString(16)).slice(-8)+("00000000"+(x>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(y>>>0).toString(16)).slice(-8)},t.x64.hash128=function(d,p){if(t.inputValidation&&!n(d))return e;p=p||0;for(var g=d.length%16,w=d.length-g,_=[0,p],x=[0,p],m=[0,0],y=[0,0],b=[2277735313,289559509],E=[1291169091,658871167],v=0;v<w;v=v+16)m=[d[v+4]|d[v+5]<<8|d[v+6]<<16|d[v+7]<<24,d[v]|d[v+1]<<8|d[v+2]<<16|d[v+3]<<24],y=[d[v+12]|d[v+13]<<8|d[v+14]<<16|d[v+15]<<24,d[v+8]|d[v+9]<<8|d[v+10]<<16|d[v+11]<<24],m=c(m,b),m=u(m,31),m=c(m,E),_=f(_,m),_=u(_,27),_=a(_,x),_=a(c(_,[0,5]),[0,1390208809]),y=c(y,E),y=u(y,33),y=c(y,b),x=f(x,y),x=u(x,31),x=a(x,_),x=a(c(x,[0,5]),[0,944331445]);switch(m=[0,0],y=[0,0],g){case 15:y=f(y,l([0,d[v+14]],48));case 14:y=f(y,l([0,d[v+13]],40));case 13:y=f(y,l([0,d[v+12]],32));case 12:y=f(y,l([0,d[v+11]],24));case 11:y=f(y,l([0,d[v+10]],16));case 10:y=f(y,l([0,d[v+9]],8));case 9:y=f(y,[0,d[v+8]]),y=c(y,E),y=u(y,33),y=c(y,b),x=f(x,y);case 8:m=f(m,l([0,d[v+7]],56));case 7:m=f(m,l([0,d[v+6]],48));case 6:m=f(m,l([0,d[v+5]],40));case 5:m=f(m,l([0,d[v+4]],32));case 4:m=f(m,l([0,d[v+3]],24));case 3:m=f(m,l([0,d[v+2]],16));case 2:m=f(m,l([0,d[v+1]],8));case 1:m=f(m,[0,d[v]]),m=c(m,b),m=u(m,31),m=c(m,E),_=f(_,m)}return _=f(_,[0,d.length]),x=f(x,[0,d.length]),_=a(_,x),x=a(x,_),_=h(_),x=h(x),_=a(_,x),x=a(x,_),("00000000"+(_[0]>>>0).toString(16)).slice(-8)+("00000000"+(_[1]>>>0).toString(16)).slice(-8)+("00000000"+(x[0]>>>0).toString(16)).slice(-8)+("00000000"+(x[1]>>>0).toString(16)).slice(-8)},typeof z3<"u"?(typeof Y_<"u"&&Y_.exports&&(z3=Y_.exports=t),z3.murmurHash3=t):typeof define=="function"&&define.amd?define([],function(){return t}):(t._murmurHash3=r.murmurHash3,t.noConflict=function(){return r.murmurHash3=t._murmurHash3,t._murmurHash3=e,t.noConflict=e,t},r.murmurHash3=t)})(z3)});var nk=P((Spt,mZ)=>{mZ.exports=pZ()});var RZ=P((l0t,IZ)=>{var ok=class{constructor(e,t=12,n=8*1024,i=32*1024,o=64,s){this.bits=t,this.min=n,this.max=i,this.asModule=e,this.rabin=new e.Rabin(t,n,i,o,s),this.polynomial=s}fingerprint(e){let{__retain:t,__release:n,__allocArray:i,__getInt32Array:o,Int32Array_ID:s,Uint8Array_ID:a}=this.asModule,c=new Int32Array(Math.ceil(e.length/this.min)),u=t(i(s,c)),l=t(i(a,e)),f=this.rabin.fingerprint(l,u),h=o(f);n(l),n(u);let d=h.indexOf(0);return d>=0?h.subarray(0,d):h}};IZ.exports=ok});var OZ=P(q3=>{"use strict";var UTe=typeof BigUint64Array<"u",K3=Symbol(),$3=1024;function CZ(r,e){let t=new Uint32Array(r),n=new Uint16Array(r);var i=t[e+-4>>>2]>>>1,o=e>>>1;if(i<=$3)return String.fromCharCode.apply(String,n.subarray(o,o+i));let s=[];do{let a=n[o+$3-1],c=a>=55296&&a<56320?$3-1:$3;s.push(String.fromCharCode.apply(String,n.subarray(o,o+=c))),i-=c}while(i>$3);return s.join("")+String.fromCharCode.apply(String,n.subarray(o,o+i))}function sk(r){let e={};function t(i,o){return i?CZ(i.buffer,o):"<yet unknown>"}let n=r.env=r.env||{};return n.abort=n.abort||function(o,s,a,c){let u=e.memory||n.memory;throw Error("abort: "+t(u,o)+" at "+t(u,s)+":"+a+":"+c)},n.trace=n.trace||function(o,s){let a=e.memory||n.memory;console.log("trace: "+t(a,o)+(s?" ":"")+Array.prototype.slice.call(arguments,2,2+s).join(", "))},r.Math=r.Math||Math,r.Date=r.Date||Date,e}function ak(r,e){let t=e.exports,n=t.memory,i=t.table,o=t.__alloc,s=t.__retain,a=t.__rtti_base||-1;function c(E){let v=new Uint32Array(n.buffer),S=v[a>>>2];if((E>>>=0)>=S)throw Error("invalid id: "+E);return v[(a+4>>>2)+E*2]}function u(E){let v=new Uint32Array(n.buffer),S=v[a>>>2];if((E>>>=0)>=S)throw Error("invalid id: "+E);return v[(a+4>>>2)+E*2+1]}function l(E){return 31-Math.clz32(E>>>5&31)}function f(E){return 31-Math.clz32(E>>>14&31)}function h(E){let v=E.length,S=o(v<<1,1),A=new Uint16Array(n.buffer);for(var I=0,k=S>>>1;I<v;++I)A[k+I]=E.charCodeAt(I);return S}r.__allocString=h;function d(E){let v=n.buffer;if(new Uint32Array(v)[E+-8>>>2]!==1)throw Error("not a string: "+E);return CZ(v,E)}r.__getString=d;function p(E,v,S){let A=n.buffer;if(S)switch(E){case 2:return new Float32Array(A);case 3:return new Float64Array(A)}else switch(E){case 0:return new(v?Int8Array:Uint8Array)(A);case 1:return new(v?Int16Array:Uint16Array)(A);case 2:return new(v?Int32Array:Uint32Array)(A);case 3:return new(v?BigInt64Array:BigUint64Array)(A)}throw Error("unsupported align: "+E)}function g(E,v){let S=c(E);if(!(S&3))throw Error("not an array: "+E+" @ "+S);let A=l(S),I=v.length,k=o(I<<A,0),N=o(S&2?16:12,E),O=new Uint32Array(n.buffer);O[N+0>>>2]=s(k),O[N+4>>>2]=k,O[N+8>>>2]=I<<A,S&2&&(O[N+12>>>2]=I);let G=p(A,S&1024,S&2048);if(S&8192)for(let R=0;R<I;++R)G[(k>>>A)+R]=s(v[R]);else G.set(v,k>>>A);return N}r.__allocArray=g;function w(E){let v=new Uint32Array(n.buffer),S=v[E+-8>>>2],A=c(S);if(!(A&1))throw Error("not an array: "+S);let I=l(A);var k=v[E+4>>>2];let N=A&2?v[E+12>>>2]:v[k+-4>>>2]>>>I;return p(I,A&1024,A&2048).subarray(k>>>=I,k+N)}r.__getArrayView=w;function _(E){let v=w(E),S=v.length,A=new Array(S);for(let I=0;I<S;I++)A[I]=v[I];return A}r.__getArray=_;function x(E){let v=n.buffer,S=new Uint32Array(v)[E+-4>>>2];return v.slice(E,E+S)}r.__getArrayBuffer=x;function m(E,v,S){return new E(y(E,v,S))}function y(E,v,S){let A=n.buffer,I=new Uint32Array(A),k=I[S+4>>>2];return new E(A,k,I[k+-4>>>2]>>>v)}r.__getInt8Array=m.bind(null,Int8Array,0),r.__getInt8ArrayView=y.bind(null,Int8Array,0),r.__getUint8Array=m.bind(null,Uint8Array,0),r.__getUint8ArrayView=y.bind(null,Uint8Array,0),r.__getUint8ClampedArray=m.bind(null,Uint8ClampedArray,0),r.__getUint8ClampedArrayView=y.bind(null,Uint8ClampedArray,0),r.__getInt16Array=m.bind(null,Int16Array,1),r.__getInt16ArrayView=y.bind(null,Int16Array,1),r.__getUint16Array=m.bind(null,Uint16Array,1),r.__getUint16ArrayView=y.bind(null,Uint16Array,1),r.__getInt32Array=m.bind(null,Int32Array,2),r.__getInt32ArrayView=y.bind(null,Int32Array,2),r.__getUint32Array=m.bind(null,Uint32Array,2),r.__getUint32ArrayView=y.bind(null,Uint32Array,2),UTe&&(r.__getInt64Array=m.bind(null,BigInt64Array,3),r.__getInt64ArrayView=y.bind(null,BigInt64Array,3),r.__getUint64Array=m.bind(null,BigUint64Array,3),r.__getUint64ArrayView=y.bind(null,BigUint64Array,3)),r.__getFloat32Array=m.bind(null,Float32Array,2),r.__getFloat32ArrayView=y.bind(null,Float32Array,2),r.__getFloat64Array=m.bind(null,Float64Array,3),r.__getFloat64ArrayView=y.bind(null,Float64Array,3);function b(E,v){let S=new Uint32Array(n.buffer);var A=S[E+-8>>>2];if(A<=S[a>>>2])do if(A==v)return!0;while(A=u(A));return!1}return r.__instanceof=b,r.memory=r.memory||n,r.table=r.table||i,DZ(t,r)}function PZ(r){return typeof Response<"u"&&r instanceof Response}async function kZ(r,e){return PZ(r=await r)?NZ(r,e):ak(sk(e||(e={})),await WebAssembly.instantiate(r instanceof WebAssembly.Module?r:await WebAssembly.compile(r),e))}q3.instantiate=kZ;function FTe(r,e){return ak(sk(e||(e={})),new WebAssembly.Instance(r instanceof WebAssembly.Module?r:new WebAssembly.Module(r),e))}q3.instantiateSync=FTe;async function NZ(r,e){return WebAssembly.instantiateStreaming?ak(sk(e||(e={})),(await WebAssembly.instantiateStreaming(r,e)).instance):kZ(PZ(r=await r)?r.arrayBuffer():r,e)}q3.instantiateStreaming=NZ;function DZ(r,e){var t=e?Object.create(e):{},n=r.__argumentsLength?function(i){r.__argumentsLength.value=i}:r.__setArgumentsLength||r.__setargc||function(){};for(let i in r){if(!Object.prototype.hasOwnProperty.call(r,i))continue;let o=r[i],s=i.split("."),a=t;for(;s.length>1;){let l=s.shift();Object.prototype.hasOwnProperty.call(a,l)||(a[l]={}),a=a[l]}let c=s[0],u=c.indexOf("#");if(u>=0){let l=c.substring(0,u),f=a[l];if(typeof f>"u"||!f.prototype){let h=function(...d){return h.wrap(h.prototype.constructor(0,...d))};h.prototype={valueOf:function(){return this[K3]}},h.wrap=function(d){return Object.create(h.prototype,{[K3]:{value:d,writable:!1}})},f&&Object.getOwnPropertyNames(f).forEach(d=>Object.defineProperty(h,d,Object.getOwnPropertyDescriptor(f,d))),a[l]=h}if(c=c.substring(u+1),a=a[l].prototype,/^(get|set):/.test(c)){if(!Object.prototype.hasOwnProperty.call(a,c=c.substring(4))){let h=r[i.replace("set:","get:")],d=r[i.replace("get:","set:")];Object.defineProperty(a,c,{get:function(){return h(this[K3])},set:function(p){d(this[K3],p)},enumerable:!0})}}else c==="constructor"?(a[c]=(...h)=>(n(h.length),o(...h))).original=o:(a[c]=function(...h){return n(h.length),o(this[K3],...h)}).original=o}else/^(get|set):/.test(c)?Object.prototype.hasOwnProperty.call(a,c=c.substring(4))||Object.defineProperty(a,c,{get:r[i.replace("set:","get:")],set:r[i.replace("get:","set:")],enumerable:!0}):typeof o=="function"&&o!==n?(a[c]=(...l)=>(n(l.length),o(...l))).original=o:a[c]=o}return t}q3.demangle=DZ});var BZ=P((d0t,LZ)=>{var{instantiate:zTe}=OZ();ck.supported=typeof WebAssembly<"u";function ck(r={}){if(!ck.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return zTe(new Response(new Blob([e],{type:"application/wasm"})),r)}LZ.exports=ck});var FZ=P((h0t,UZ)=>{var MZ=RZ(),VTe=BZ(),KTe=async(r,e,t,n,i)=>{let o=await VTe();return new MZ(o,r,e,t,n,i)};UZ.exports={Rabin:MZ,create:KTe}});var pk=P((D0t,GZ)=>{"use strict";GZ.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):i=!0,this._setInternalPos(n,e,t,i),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,i=t;for(;n<this.length;){let o=this.get(n);i=e(i,o,n),n++}return i}find(e){let t=0,n,i;for(;t<this.length&&!n;)i=this.get(t),n=e(i),t++;return n?i:void 0}_internalPositionFor(e,t){let n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;let i=this._bitArrays[n],o=e-n*7;if(!((i&1<<o)>0))return-1;let a=this._bitArrays.slice(0,n).reduce(XTe,0),c=~(4294967295<<o+1),u=HZ(i&c);return a+u-1}_bytePosFor(e,t){let n=Math.floor(e/7),i=n+1;for(;!t&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*7}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*7)}_setInternalPos(e,t,n,i){let o=this._data,s=[t,n];if(i)this._sortData(),o[e]=s;else{if(o.length)if(o[o.length-1][0]>=t)o.push(s);else if(o[0][0]<=t)o.unshift(s);else{let a=Math.round(o.length/2);this._data=o.slice(0,a).concat(s).concat(o.slice(a))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(ZTe),this._changedData=!1}bitField(){let e=[],t=8,n=0,i=0,o,s=this._bitArrays.slice();for(;s.length||n;){n===0&&(o=s.shift(),n=7);let c=Math.min(n,t),u=~(255<<c),l=o&u;i|=l<<8-t,o=o>>>c,n-=c,t-=c,(!t||!n&&!s.length)&&(e.push(i),i=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(JTe)}};function XTe(r,e){return r+HZ(e)}function HZ(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function ZTe(r,e){return r[0]-e[0]}function JTe(r){return r[1]}});var xJ=P((dmt,bk)=>{"use strict";var zIe=Object.prototype.hasOwnProperty,oo="~";function Q3(){}Object.create&&(Q3.prototype=Object.create(null),new Q3().__proto__||(oo=!1));function VIe(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function vJ(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new VIe(t,n||r,i),s=oo?oo+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],o]:r._events[s].push(o):(r._events[s]=o,r._eventsCount++),r}function cE(r,e){--r._eventsCount===0?r._events=new Q3:delete r._events[e]}function Ui(){this._events=new Q3,this._eventsCount=0}Ui.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)zIe.call(t,n)&&e.push(oo?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ui.prototype.listeners=function(e){var t=oo?oo+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s};Ui.prototype.listenerCount=function(e){var t=oo?oo+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Ui.prototype.emit=function(e,t,n,i,o,s){var a=oo?oo+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,l,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,o),!0;case 6:return c.fn.call(c.context,t,n,i,o,s),!0}for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c.fn.apply(c.context,l)}else{var h=c.length,d;for(f=0;f<h;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),u){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,i);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[f].fn.apply(c[f].context,l)}}return!0};Ui.prototype.on=function(e,t,n){return vJ(this,e,t,n,!1)};Ui.prototype.once=function(e,t,n){return vJ(this,e,t,n,!0)};Ui.prototype.removeListener=function(e,t,n,i){var o=oo?oo+e:e;if(!this._events[o])return this;if(!t)return cE(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!i||s.once)&&(!n||s.context===n)&&cE(this,o);else{for(var a=0,c=[],u=s.length;a<u;a++)(s[a].fn!==t||i&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[o]=c.length===1?c[0]:c:cE(this,o)}return this};Ui.prototype.removeAllListeners=function(e){var t;return e?(t=oo?oo+e:e,this._events[t]&&cE(this,t)):(this._events=new Q3,this._eventsCount=0),this};Ui.prototype.off=Ui.prototype.removeListener;Ui.prototype.addListener=Ui.prototype.on;Ui.prefixed=oo;Ui.EventEmitter=Ui;typeof bk<"u"&&(bk.exports=Ui)});var jJ=P((P2t,GJ)=>{"use strict";GJ.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:8,RTLD_LOCAL:4,E2BIG:7,EACCES:13,EADDRINUSE:48,EADDRNOTAVAIL:49,EAFNOSUPPORT:47,EAGAIN:35,EALREADY:37,EBADF:9,EBADMSG:94,EBUSY:16,ECANCELED:89,ECHILD:10,ECONNABORTED:53,ECONNREFUSED:61,ECONNRESET:54,EDEADLK:11,EDESTADDRREQ:39,EDOM:33,EDQUOT:69,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:65,EIDRM:90,EILSEQ:92,EINPROGRESS:36,EINTR:4,EINVAL:22,EIO:5,EISCONN:56,EISDIR:21,ELOOP:62,EMFILE:24,EMLINK:31,EMSGSIZE:40,EMULTIHOP:95,ENAMETOOLONG:63,ENETDOWN:50,ENETRESET:52,ENETUNREACH:51,ENFILE:23,ENOBUFS:55,ENODATA:96,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:77,ENOLINK:97,ENOMEM:12,ENOMSG:91,ENOPROTOOPT:42,ENOSPC:28,ENOSR:98,ENOSTR:99,ENOSYS:78,ENOTCONN:57,ENOTDIR:20,ENOTEMPTY:66,ENOTSOCK:38,ENOTSUP:45,ENOTTY:25,ENXIO:6,EOPNOTSUPP:102,EOVERFLOW:84,EPERM:1,EPIPE:32,EPROTO:100,EPROTONOSUPPORT:43,EPROTOTYPE:41,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:70,ETIME:101,ETIMEDOUT:60,ETXTBSY:26,EWOULDBLOCK:35,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:10,SIGFPE:8,SIGKILL:9,SIGUSR1:30,SIGSEGV:11,SIGUSR2:31,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:20,SIGCONT:19,SIGSTOP:17,SIGTSTP:18,SIGTTIN:21,SIGTTOU:22,SIGURG:16,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:23,SIGINFO:29,SIGSYS:12,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,UV_FS_O_FILEMAP:0,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306480,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}});var vne=P((LN,Ene)=>{"use strict";Object.defineProperty(LN,"__esModule",{value:!0});m7.BASE=2166136261;function m7(r,e=m7.BASE){let t=r.length;for(let n=0;n<t;n++)e^=r.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}LN.default=m7;Ene.exports=m7});var gie=P((e_t,I7)=>{"use strict";I7.exports=BDe;I7.exports.format=pie;I7.exports.parse=mie;var DDe=/\B(?=(\d{3})+(?!\d))/g,ODe=/(?:\.0*|(\.[^0]+)0+)$/,Sd={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},LDe=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function BDe(r,e){return typeof r=="string"?mie(r):typeof r=="number"?pie(r,e):null}function pie(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",i=e&&e.unitSeparator||"",o=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,s=!!(e&&e.fixedDecimals),a=e&&e.unit||"";(!a||!Sd[a.toLowerCase()])&&(t>=Sd.pb?a="PB":t>=Sd.tb?a="TB":t>=Sd.gb?a="GB":t>=Sd.mb?a="MB":t>=Sd.kb?a="KB":a="B");var c=r/Sd[a.toLowerCase()],u=c.toFixed(o);return s||(u=u.replace(ODe,"$1")),n&&(u=u.split(".").map(function(l,f){return f===0?l.replace(DDe,n):l}).join(".")),u+i+a}function mie(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=LDe.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(Sd[n]*t)}});var Qie=P(Yie=>{"use strict";Yie.supports=function(...e){let t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}});var Za=P((WEt,Xie)=>{"use strict";Xie.exports=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var eoe=P(L7=>{"use strict";L7.byteLength=aOe;L7.toByteArray=uOe;L7.fromByteArray=dOe;var iu=[],Zs=[],sOe=typeof Uint8Array<"u"?Uint8Array:Array,ND="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Dp=0,Zie=ND.length;Dp<Zie;++Dp)iu[Dp]=ND[Dp],Zs[ND.charCodeAt(Dp)]=Dp;var Dp,Zie;Zs["-".charCodeAt(0)]=62;Zs["_".charCodeAt(0)]=63;function Jie(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function aOe(r){var e=Jie(r),t=e[0],n=e[1];return(t+n)*3/4-n}function cOe(r,e,t){return(e+t)*3/4-t}function uOe(r){var e,t=Jie(r),n=t[0],i=t[1],o=new sOe(cOe(r,n,i)),s=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=Zs[r.charCodeAt(c)]<<18|Zs[r.charCodeAt(c+1)]<<12|Zs[r.charCodeAt(c+2)]<<6|Zs[r.charCodeAt(c+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=Zs[r.charCodeAt(c)]<<2|Zs[r.charCodeAt(c+1)]>>4,o[s++]=e&255),i===1&&(e=Zs[r.charCodeAt(c)]<<10|Zs[r.charCodeAt(c+1)]<<4|Zs[r.charCodeAt(c+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function lOe(r){return iu[r>>18&63]+iu[r>>12&63]+iu[r>>6&63]+iu[r&63]}function fOe(r,e,t){for(var n,i=[],o=e;o<t;o+=3)n=(r[o]<<16&16711680)+(r[o+1]<<8&65280)+(r[o+2]&255),i.push(lOe(n));return i.join("")}function dOe(r){for(var e,t=r.length,n=t%3,i=[],o=16383,s=0,a=t-n;s<a;s+=o)i.push(fOe(r,s,s+o>a?a:s+o));return n===1?(e=r[t-1],i.push(iu[e>>2]+iu[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(iu[e>>10]+iu[e>>4&63]+iu[e<<2&63]+"=")),i.join("")}});var toe=P(DD=>{DD.read=function(r,e,t,n,i){var o,s,a=i*8-n-1,c=(1<<a)-1,u=c>>1,l=-7,f=t?i-1:0,h=t?-1:1,d=r[e+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=o*256+r[e+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=s*256+r[e+f],f+=h,l-=8);if(o===0)o=1-u;else{if(o===c)return s?NaN:(d?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-u}return(d?-1:1)*s*Math.pow(2,o-n)};DD.write=function(r,e,t,n,i,o){var s,a,c,u=o*8-i-1,l=(1<<u)-1,f=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),s+f>=1?e+=h/c:e+=h*Math.pow(2,1-f),e*c>=2&&(s++,c/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*c-1)*Math.pow(2,i),s=s+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;r[t+d]=a&255,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;r[t+d]=s&255,d+=p,s/=256,u-=8);r[t+d-p]|=g*128}});var n5=P(w2=>{"use strict";var OD=eoe(),g2=toe(),roe=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;w2.Buffer=Y;w2.SlowBuffer=wOe;w2.INSPECT_MAX_BYTES=50;var B7=2147483647;w2.kMaxLength=B7;Y.TYPED_ARRAY_SUPPORT=hOe();!Y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function hOe(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(Y.prototype,"parent",{enumerable:!0,get:function(){if(Y.isBuffer(this))return this.buffer}});Object.defineProperty(Y.prototype,"offset",{enumerable:!0,get:function(){if(Y.isBuffer(this))return this.byteOffset}});function wl(r){if(r>B7)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,Y.prototype),e}function Y(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return UD(r)}return soe(r,e,t)}Y.poolSize=8192;function soe(r,e,t){if(typeof r=="string")return mOe(r,e);if(ArrayBuffer.isView(r))return gOe(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(ou(r,ArrayBuffer)||r&&ou(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ou(r,SharedArrayBuffer)||r&&ou(r.buffer,SharedArrayBuffer)))return BD(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return Y.from(n,e,t);let i=yOe(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return Y.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}Y.from=function(r,e,t){return soe(r,e,t)};Object.setPrototypeOf(Y.prototype,Uint8Array.prototype);Object.setPrototypeOf(Y,Uint8Array);function aoe(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function pOe(r,e,t){return aoe(r),r<=0?wl(r):e!==void 0?typeof t=="string"?wl(r).fill(e,t):wl(r).fill(e):wl(r)}Y.alloc=function(r,e,t){return pOe(r,e,t)};function UD(r){return aoe(r),wl(r<0?0:FD(r)|0)}Y.allocUnsafe=function(r){return UD(r)};Y.allocUnsafeSlow=function(r){return UD(r)};function mOe(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!Y.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=coe(r,e)|0,n=wl(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function LD(r){let e=r.length<0?0:FD(r.length)|0,t=wl(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function gOe(r){if(ou(r,Uint8Array)){let e=new Uint8Array(r);return BD(e.buffer,e.byteOffset,e.byteLength)}return LD(r)}function BD(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,Y.prototype),n}function yOe(r){if(Y.isBuffer(r)){let e=FD(r.length)|0,t=wl(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||VD(r.length)?wl(0):LD(r);if(r.type==="Buffer"&&Array.isArray(r.data))return LD(r.data)}function FD(r){if(r>=B7)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B7.toString(16)+" bytes");return r|0}function wOe(r){return+r!=r&&(r=0),Y.alloc(+r)}Y.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==Y.prototype};Y.compare=function(e,t){if(ou(e,Uint8Array)&&(e=Y.from(e,e.offset,e.byteLength)),ou(t,Uint8Array)&&(t=Y.from(t,t.offset,t.byteLength)),!Y.isBuffer(e)||!Y.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==t[o]){n=e[o],i=t[o];break}return n<i?-1:i<n?1:0};Y.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};Y.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return Y.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=Y.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){let s=e[n];if(ou(s,Uint8Array))o+s.length>i.length?(Y.isBuffer(s)||(s=Y.from(s)),s.copy(i,o)):Uint8Array.prototype.set.call(i,s,o);else if(Y.isBuffer(s))s.copy(i,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=s.length}return i};function coe(r,e){if(Y.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||ou(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return MD(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return yoe(r).length;default:if(i)return n?-1:MD(r).length;e=(""+e).toLowerCase(),i=!0}}Y.byteLength=coe;function bOe(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return COe(this,e,t);case"utf8":case"utf-8":return loe(this,e,t);case"ascii":return IOe(this,e,t);case"latin1":case"binary":return ROe(this,e,t);case"base64":return AOe(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return POe(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}Y.prototype._isBuffer=!0;function Op(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}Y.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)Op(this,t,t+1);return this};Y.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)Op(this,t,t+3),Op(this,t+1,t+2);return this};Y.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)Op(this,t,t+7),Op(this,t+1,t+6),Op(this,t+2,t+5),Op(this,t+3,t+4);return this};Y.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?loe(this,0,e):bOe.apply(this,arguments)};Y.prototype.toLocaleString=Y.prototype.toString;Y.prototype.equals=function(e){if(!Y.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:Y.compare(this,e)===0};Y.prototype.inspect=function(){let e="",t=w2.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};roe&&(Y.prototype[roe]=Y.prototype.inspect);Y.prototype.compare=function(e,t,n,i,o){if(ou(e,Uint8Array)&&(e=Y.from(e,e.offset,e.byteLength)),!Y.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),t<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=n)return 0;if(i>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,o>>>=0,this===e)return 0;let s=o-i,a=n-t,c=Math.min(s,a),u=this.slice(i,o),l=e.slice(t,n);for(let f=0;f<c;++f)if(u[f]!==l[f]){s=u[f],a=l[f];break}return s<a?-1:a<s?1:0};function uoe(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,VD(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=Y.from(e,n)),Y.isBuffer(e))return e.length===0?-1:noe(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):noe(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function noe(r,e,t,n,i){let o=1,s=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;o=2,s/=2,a/=2,t/=2}function c(l,f){return o===1?l[f]:l.readUInt16BE(f*o)}let u;if(i){let l=-1;for(u=t;u<s;u++)if(c(r,u)===c(e,l===-1?0:u-l)){if(l===-1&&(l=u),u-l+1===a)return l*o}else l!==-1&&(u-=u-l),l=-1}else for(t+a>s&&(t=s-a),u=t;u>=0;u--){let l=!0;for(let f=0;f<a;f++)if(c(r,u+f)!==c(e,f)){l=!1;break}if(l)return u}return-1}Y.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};Y.prototype.indexOf=function(e,t,n){return uoe(this,e,t,n,!0)};Y.prototype.lastIndexOf=function(e,t,n){return uoe(this,e,t,n,!1)};function _Oe(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let o=e.length;n>o/2&&(n=o/2);let s;for(s=0;s<n;++s){let a=parseInt(e.substr(s*2,2),16);if(VD(a))return s;r[t+s]=a}return s}function EOe(r,e,t,n){return M7(MD(e,r.length-t),r,t,n)}function vOe(r,e,t,n){return M7(OOe(e),r,t,n)}function xOe(r,e,t,n){return M7(yoe(e),r,t,n)}function SOe(r,e,t,n){return M7(LOe(e,r.length-t),r,t,n)}Y.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let o=this.length-t;if((n===void 0||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let s=!1;for(;;)switch(i){case"hex":return _Oe(this,e,t,n);case"utf8":case"utf-8":return EOe(this,e,t,n);case"ascii":case"latin1":case"binary":return vOe(this,e,t,n);case"base64":return xOe(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return SOe(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}};Y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function AOe(r,e,t){return e===0&&t===r.length?OD.fromByteArray(r):OD.fromByteArray(r.slice(e,t))}function loe(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let o=r[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=t){let c,u,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:c=r[i+1],(c&192)===128&&(f=(o&31)<<6|c&63,f>127&&(s=f));break;case 3:c=r[i+1],u=r[i+2],(c&192)===128&&(u&192)===128&&(f=(o&15)<<12|(c&63)<<6|u&63,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:c=r[i+1],u=r[i+2],l=r[i+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(f=(o&15)<<18|(c&63)<<12|(u&63)<<6|l&63,f>65535&&f<1114112&&(s=f))}}s===null?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),i+=a}return TOe(n)}var ioe=4096;function TOe(r){let e=r.length;if(e<=ioe)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=ioe));return t}function IOe(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function ROe(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function COe(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let o=e;o<t;++o)i+=BOe[r[o]];return i}function POe(r,e,t){let n=r.slice(e,t),i="";for(let o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+n[o+1]*256);return i}Y.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,Y.prototype),i};function li(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}Y.prototype.readUintLE=Y.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||li(e,t,this.length);let i=this[e],o=1,s=0;for(;++s<t&&(o*=256);)i+=this[e+s]*o;return i};Y.prototype.readUintBE=Y.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||li(e,t,this.length);let i=this[e+--t],o=1;for(;t>0&&(o*=256);)i+=this[e+--t]*o;return i};Y.prototype.readUint8=Y.prototype.readUInt8=function(e,t){return e=e>>>0,t||li(e,1,this.length),this[e]};Y.prototype.readUint16LE=Y.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||li(e,2,this.length),this[e]|this[e+1]<<8};Y.prototype.readUint16BE=Y.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||li(e,2,this.length),this[e]<<8|this[e+1]};Y.prototype.readUint32LE=Y.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||li(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};Y.prototype.readUint32BE=Y.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||li(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};Y.prototype.readBigUInt64LE=Rd(function(e){e=e>>>0,y2(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&r5(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,o=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(o)<<BigInt(32))});Y.prototype.readBigUInt64BE=Rd(function(e){e=e>>>0,y2(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&r5(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],o=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(o)});Y.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||li(e,t,this.length);let i=this[e],o=1,s=0;for(;++s<t&&(o*=256);)i+=this[e+s]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i};Y.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||li(e,t,this.length);let i=t,o=1,s=this[e+--i];for(;i>0&&(o*=256);)s+=this[e+--i]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s};Y.prototype.readInt8=function(e,t){return e=e>>>0,t||li(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};Y.prototype.readInt16LE=function(e,t){e=e>>>0,t||li(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};Y.prototype.readInt16BE=function(e,t){e=e>>>0,t||li(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};Y.prototype.readInt32LE=function(e,t){return e=e>>>0,t||li(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};Y.prototype.readInt32BE=function(e,t){return e=e>>>0,t||li(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};Y.prototype.readBigInt64LE=Rd(function(e){e=e>>>0,y2(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&r5(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});Y.prototype.readBigInt64BE=Rd(function(e){e=e>>>0,y2(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&r5(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});Y.prototype.readFloatLE=function(e,t){return e=e>>>0,t||li(e,4,this.length),g2.read(this,e,!0,23,4)};Y.prototype.readFloatBE=function(e,t){return e=e>>>0,t||li(e,4,this.length),g2.read(this,e,!1,23,4)};Y.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||li(e,8,this.length),g2.read(this,e,!0,52,8)};Y.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||li(e,8,this.length),g2.read(this,e,!1,52,8)};function vo(r,e,t,n,i,o){if(!Y.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}Y.prototype.writeUintLE=Y.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;vo(this,e,t,n,a,0)}let o=1,s=0;for(this[t]=e&255;++s<n&&(o*=256);)this[t+s]=e/o&255;return t+n};Y.prototype.writeUintBE=Y.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;vo(this,e,t,n,a,0)}let o=n-1,s=1;for(this[t+o]=e&255;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+n};Y.prototype.writeUint8=Y.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,1,255,0),this[t]=e&255,t+1};Y.prototype.writeUint16LE=Y.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};Y.prototype.writeUint16BE=Y.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};Y.prototype.writeUint32LE=Y.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};Y.prototype.writeUint32BE=Y.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function foe(r,e,t,n,i){goe(e,n,i,r,t,7);let o=Number(e&BigInt(4294967295));r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,t}function doe(r,e,t,n,i){goe(e,n,i,r,t,7);let o=Number(e&BigInt(4294967295));r[t+7]=o,o=o>>8,r[t+6]=o,o=o>>8,r[t+5]=o,o=o>>8,r[t+4]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=s,s=s>>8,r[t+2]=s,s=s>>8,r[t+1]=s,s=s>>8,r[t]=s,t+8}Y.prototype.writeBigUInt64LE=Rd(function(e,t=0){return foe(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});Y.prototype.writeBigUInt64BE=Rd(function(e,t=0){return doe(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});Y.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);vo(this,e,t,n,c-1,-c)}let o=0,s=1,a=0;for(this[t]=e&255;++o<n&&(s*=256);)e<0&&a===0&&this[t+o-1]!==0&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n};Y.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);vo(this,e,t,n,c-1,-c)}let o=n-1,s=1,a=0;for(this[t+o]=e&255;--o>=0&&(s*=256);)e<0&&a===0&&this[t+o+1]!==0&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n};Y.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};Y.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};Y.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};Y.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};Y.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||vo(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};Y.prototype.writeBigInt64LE=Rd(function(e,t=0){return foe(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});Y.prototype.writeBigInt64BE=Rd(function(e,t=0){return doe(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function hoe(r,e,t,n,i,o){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function poe(r,e,t,n,i){return e=+e,t=t>>>0,i||hoe(r,e,t,4,34028234663852886e22,-34028234663852886e22),g2.write(r,e,t,n,23,4),t+4}Y.prototype.writeFloatLE=function(e,t,n){return poe(this,e,t,!0,n)};Y.prototype.writeFloatBE=function(e,t,n){return poe(this,e,t,!1,n)};function moe(r,e,t,n,i){return e=+e,t=t>>>0,i||hoe(r,e,t,8,17976931348623157e292,-17976931348623157e292),g2.write(r,e,t,n,52,8),t+8}Y.prototype.writeDoubleLE=function(e,t,n){return moe(this,e,t,!0,n)};Y.prototype.writeDoubleBE=function(e,t,n){return moe(this,e,t,!1,n)};Y.prototype.copy=function(e,t,n,i){if(!Y.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let o=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),o};Y.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!Y.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let s=e.charCodeAt(0);(i==="utf8"&&s<128||i==="latin1")&&(e=s)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let o;if(typeof e=="number")for(o=t;o<n;++o)this[o]=e;else{let s=Y.isBuffer(e)?e:Y.from(e,i),a=s.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var m2={};function zD(r,e,t){m2[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}zD("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);zD("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);zD("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=ooe(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=ooe(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function ooe(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function kOe(r,e,t){y2(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&r5(e,r.length-(t+1))}function goe(r,e,t,n,i,o){if(r>t||r<e){let s=typeof e=="bigint"?"n":"",a;throw o>3?e===0||e===BigInt(0)?a=`>= 0${s} and < 2${s} ** ${(o+1)*8}${s}`:a=`>= -(2${s} ** ${(o+1)*8-1}${s}) and < 2 ** ${(o+1)*8-1}${s}`:a=`>= ${e}${s} and <= ${t}${s}`,new m2.ERR_OUT_OF_RANGE("value",a,r)}kOe(n,i,o)}function y2(r,e){if(typeof r!="number")throw new m2.ERR_INVALID_ARG_TYPE(e,"number",r)}function r5(r,e,t){throw Math.floor(r)!==r?(y2(r,t),new m2.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new m2.ERR_BUFFER_OUT_OF_BOUNDS:new m2.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var NOe=/[^+/0-9A-Za-z-_]/g;function DOe(r){if(r=r.split("=")[0],r=r.trim().replace(NOe,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function MD(r,e){e=e||1/0;let t,n=r.length,i=null,o=[];for(let s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function OOe(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function LOe(r,e){let t,n,i,o=[];for(let s=0;s<r.length&&!((e-=2)<0);++s)t=r.charCodeAt(s),n=t>>8,i=t%256,o.push(i),o.push(n);return o}function yoe(r){return OD.toByteArray(DOe(r))}function M7(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function ou(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function VD(r){return r!==r}var BOe=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function Rd(r){return typeof BigInt>"u"?MOe:r}function MOe(){throw new Error("BigInt not supported")}});var $D=P((JEt,woe)=>{"use strict";var KD=null;woe.exports=function(){return KD===null&&(KD={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),KD}});var GD=P(boe=>{"use strict";var qD=Za(),UOe=new Set(["buffer","view","utf8"]),HD=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!UOe.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new qD(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new qD(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new qD(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};boe.Encoding=HD});var QD=P(U7=>{"use strict";var{Buffer:WD}=n5()||{},{Encoding:YD}=GD(),FOe=$D(),i5=class extends YD{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new o5({encode:this.encode,decode:e=>this.decode(WD.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},o5=class extends YD{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new i5({encode:e=>{let t=this.encode(e);return WD.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},jD=class extends YD{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new i5({encode:e=>WD.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:e,textDecoder:t}=FOe();return new o5({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};U7.BufferFormat=i5;U7.ViewFormat=o5;U7.UTF8Format=jD});var xoe=P(Lp=>{"use strict";var{Buffer:zi}=n5()||{Buffer:{isBuffer:()=>!1}},{textEncoder:Eoe,textDecoder:_oe}=$D()(),{BufferFormat:s5,ViewFormat:XD,UTF8Format:voe}=QD(),F7=r=>r;Lp.utf8=new voe({encode:function(r){return zi.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?_oe.decode(r):String(r)},decode:F7,name:"utf8",createViewTranscoder(){return new XD({encode:function(r){return ArrayBuffer.isView(r)?r:Eoe.encode(r)},decode:function(r){return _oe.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new s5({encode:function(r){return zi.isBuffer(r)?r:ArrayBuffer.isView(r)?zi.from(r.buffer,r.byteOffset,r.byteLength):zi.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});Lp.json=new voe({encode:JSON.stringify,decode:JSON.parse,name:"json"});Lp.buffer=new s5({encode:function(r){return zi.isBuffer(r)?r:ArrayBuffer.isView(r)?zi.from(r.buffer,r.byteOffset,r.byteLength):zi.from(String(r),"utf8")},decode:F7,name:"buffer",createViewTranscoder(){return new XD({encode:function(r){return ArrayBuffer.isView(r)?r:zi.from(String(r),"utf8")},decode:function(r){return zi.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});Lp.view=new XD({encode:function(r){return ArrayBuffer.isView(r)?r:Eoe.encode(r)},decode:F7,name:"view",createBufferTranscoder(){return new s5({encode:function(r){return zi.isBuffer(r)?r:ArrayBuffer.isView(r)?zi.from(r.buffer,r.byteOffset,r.byteLength):zi.from(String(r),"utf8")},decode:F7,name:`${this.name}+buffer`})}});Lp.hex=new s5({encode:function(r){return zi.isBuffer(r)?r:zi.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});Lp.base64=new s5({encode:function(r){return zi.isBuffer(r)?r:zi.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"})});var Toe=P(Aoe=>{"use strict";var Soe=Za(),V7=xoe(),{Encoding:zOe}=GD(),{BufferFormat:VOe,ViewFormat:KOe,UTF8Format:$Oe}=QD(),a5=Symbol("formats"),z7=Symbol("encodings"),qOe=new Set(["buffer","view","utf8"]),ZD=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>qOe.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[z7]=new Map,this[a5]=new Set(e);for(let t in V7)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[z7].values()))}encoding(e){let t=this[z7].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=WOe[e],!t)throw new Soe(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=HOe(e)}let{name:n,format:i}=t;if(!this[a5].has(i))if(this[a5].has("view"))t=t.createViewTranscoder();else if(this[a5].has("buffer"))t=t.createBufferTranscoder();else if(this[a5].has("utf8"))t=t.createUTF8Transcoder();else throw new Soe(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let o of[e,n,t.name,t.commonName])this[z7].set(o,t)}return t}};Aoe.Transcoder=ZD;function HOe(r){if(r instanceof zOe)return r;let e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${YOe++}`;switch(GOe(r)){case"view":return new KOe({...r,name:t});case"utf8":return new $Oe({...r,name:t});case"buffer":return new VOe({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function GOe(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}var jOe={binary:V7.buffer,"utf-8":V7.utf8},WOe={...V7,...jOe},YOe=0});var xi=P((i7t,JD)=>{"use strict";var b2=typeof Reflect=="object"?Reflect:null,Ioe=b2&&typeof b2.apply=="function"?b2.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},K7;b2&&typeof b2.ownKeys=="function"?K7=b2.ownKeys:Object.getOwnPropertySymbols?K7=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:K7=function(e){return Object.getOwnPropertyNames(e)};function QOe(r){console&&console.warn&&console.warn(r)}var Coe=Number.isNaN||function(e){return e!==e};function wr(){wr.init.call(this)}JD.exports=wr;JD.exports.once=eLe;wr.EventEmitter=wr;wr.prototype._events=void 0;wr.prototype._eventsCount=0;wr.prototype._maxListeners=void 0;var Roe=10;function $7(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(wr,"defaultMaxListeners",{enumerable:!0,get:function(){return Roe},set:function(r){if(typeof r!="number"||r<0||Coe(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Roe=r}});wr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Coe(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Poe(r){return r._maxListeners===void 0?wr.defaultMaxListeners:r._maxListeners}wr.prototype.getMaxListeners=function(){return Poe(this)};wr.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(c===void 0)return!1;if(typeof c=="function")Ioe(c,this,t);else for(var u=c.length,l=Loe(c,u),n=0;n<u;++n)Ioe(l[n],this,t);return!0};function koe(r,e,t,n){var i,o,s;if($7(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),s=o[e]),s===void 0)s=o[e]=t,++r._eventsCount;else if(typeof s=="function"?s=o[e]=n?[t,s]:[s,t]:n?s.unshift(t):s.push(t),i=Poe(r),i>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=s.length,QOe(a)}return r}wr.prototype.addListener=function(e,t){return koe(this,e,t,!1)};wr.prototype.on=wr.prototype.addListener;wr.prototype.prependListener=function(e,t){return koe(this,e,t,!0)};function XOe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Noe(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=XOe.bind(n);return i.listener=t,n.wrapFn=i,i}wr.prototype.once=function(e,t){return $7(t),this.on(e,Noe(this,e,t)),this};wr.prototype.prependOnceListener=function(e,t){return $7(t),this.prependListener(e,Noe(this,e,t)),this};wr.prototype.removeListener=function(e,t){var n,i,o,s,a;if($7(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,o=s;break}if(o<0)return this;o===0?n.shift():ZOe(n,o),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};wr.prototype.off=wr.prototype.removeListener;wr.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Doe(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?JOe(i):Loe(i,i.length)}wr.prototype.listeners=function(e){return Doe(this,e,!0)};wr.prototype.rawListeners=function(e){return Doe(this,e,!1)};wr.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Ooe.call(r,e)};wr.prototype.listenerCount=Ooe;function Ooe(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}wr.prototype.eventNames=function(){return this._eventsCount>0?K7(this._events):[]};function Loe(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function ZOe(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function JOe(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function eLe(r,e){return new Promise(function(t,n){function i(s){r.removeListener(e,o),n(s)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}Boe(r,e,o,{once:!0}),e!=="error"&&tLe(r,i,{once:!0})})}function tLe(r,e,t){typeof r.on=="function"&&Boe(r,"error",e,t)}function Boe(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(o){n.once&&r.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var Uoe=P((o7t,Moe)=>{Moe.exports=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r)});var c5=P(eO=>{"use strict";var Foe=Uoe();eO.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(o,s){o?i(o):n(s)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};eO.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){Foe(()=>e(null,t))}).catch(function(t){Foe(()=>e(t))})}});var q7=P(tO=>{"use strict";tO.getCallback=function(r,e){return typeof r=="function"?r:e};tO.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}}});var Od=P(W7=>{"use strict";var{fromCallback:rO}=c5(),us=Za(),{getOptions:nO,getCallback:zoe}=q7(),Bp=Symbol("promise"),_2=Symbol("callback"),su=Symbol("working"),Mp=Symbol("handleOne"),bl=Symbol("handleMany"),iO=Symbol("autoClose"),Nd=Symbol("finishWork"),au=Symbol("returnMany"),Cd=Symbol("closing"),u5=Symbol("handleClose"),H7=Symbol("closed"),l5=Symbol("closeCallbacks"),kd=Symbol("keyEncoding"),Up=Symbol("valueEncoding"),oO=Symbol("abortOnClose"),G7=Symbol("legacy"),sO=Symbol("keys"),aO=Symbol("values"),Pd=Symbol("limit"),Js=Symbol("count"),j7=Object.freeze({}),rLe=()=>{},Voe=!1,f5=class{constructor(e,t,n){if(typeof e!="object"||e===null){let i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[H7]=!1,this[l5]=[],this[su]=!1,this[Cd]=!1,this[iO]=!1,this[_2]=null,this[Mp]=this[Mp].bind(this),this[bl]=this[bl].bind(this),this[u5]=this[u5].bind(this),this[kd]=t[kd],this[Up]=t[Up],this[G7]=n,this[Pd]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[Js]=0,this[oO]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[Js]}get limit(){return this[Pd]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(o,s,a)=>{o?i(o):this[G7]?s===void 0&&a===void 0?n():n([s,a]):n(s)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[Cd]?this.nextTick(e,new us("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[su]?this.nextTick(e,new us("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[su]=!0,this[_2]=e,this[Js]>=this[Pd]?this.nextTick(this[Mp],null):this._next(this[Mp])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=zoe(t,n),n=rO(n,Bp),t=nO(t,j7),Number.isInteger(e)?(this[Cd]?this.nextTick(n,new us("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[su]?this.nextTick(n,new us("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[Pd]<1/0&&(e=Math.min(e,this[Pd]-this[Js])),this[su]=!0,this[_2]=n,e<=0?this.nextTick(this[bl],null,[]):this._nextv(e,t,this[bl])),n[Bp]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[Bp])}_nextv(e,t,n){let i=[],o=(s,a,c)=>{if(s)return n(s);if(this[G7]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[G7]?[a,c]:a),i.length===e?n(null,i):this._next(o)};this._next(o)}all(e,t){return t=zoe(e,t),t=rO(t,Bp),e=nO(e,j7),this[Cd]?this.nextTick(t,new us("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[su]?this.nextTick(t,new us("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[su]=!0,this[_2]=t,this[iO]=!0,this[Js]>=this[Pd]?this.nextTick(this[bl],null,[]):this._all(e,this[bl])),t[Bp]}_all(e,t){let n=this[Js],i=[],o=()=>{let a=this[Pd]<1/0?Math.min(1e3,this[Pd]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,j7,s)},s=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,o())};o()}[Nd](){let e=this[_2];return this[oO]&&e===null?rLe:(this[su]=!1,this[_2]=null,this[Cd]&&this._close(this[u5]),e)}[au](e,t,n){this[iO]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=nO(t,j7),!this[Cd]){if(this[su])throw new us("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let n=this.db.keyEncoding(t.keyEncoding||this[kd]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});let o=this.db.prefixKey(n.encode(e),i);this._seek(o,t)}}}_seek(e,t){throw new us("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=rO(e,Bp),this[H7]?this.nextTick(e):this[Cd]?this[l5].push(e):(this[Cd]=!0,this[l5].push(e),this[su]?this[oO]&&this[Nd]()(new us("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[u5])),e[Bp]}_close(e){this.nextTick(e)}[u5](){this[H7]=!0,this.db.detachResource(this);let e=this[l5];this[l5]=[];for(let t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[H7]||await this.close()}}},E2=class extends f5{constructor(e,t){super(e,t,!0),this[sO]=t.keys!==!1,this[aO]=t.values!==!1}[Mp](e,t,n){let i=this[Nd]();if(e)return i(e);try{t=this[sO]&&t!==void 0?this[kd].decode(t):void 0,n=this[aO]&&n!==void 0?this[Up].decode(n):void 0}catch(o){return i(new Dd("entry",o))}t===void 0&&n===void 0||this[Js]++,i(null,t,n)}[bl](e,t){let n=this[Nd]();if(e)return this[au](n,e);try{for(let i of t){let o=i[0],s=i[1];i[0]=this[sO]&&o!==void 0?this[kd].decode(o):void 0,i[1]=this[aO]&&s!==void 0?this[Up].decode(s):void 0}}catch(i){return this[au](n,new Dd("entries",i))}this[Js]+=t.length,this[au](n,null,t)}end(e){return!Voe&&typeof console<"u"&&(Voe=!0,console.warn(new us("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},cO=class extends f5{constructor(e,t){super(e,t,!1)}[Mp](e,t){let n=this[Nd]();if(e)return n(e);try{t=t!==void 0?this[kd].decode(t):void 0}catch(i){return n(new Dd("key",i))}t!==void 0&&this[Js]++,n(null,t)}[bl](e,t){let n=this[Nd]();if(e)return this[au](n,e);try{for(let i=0;i<t.length;i++){let o=t[i];t[i]=o!==void 0?this[kd].decode(o):void 0}}catch(i){return this[au](n,new Dd("keys",i))}this[Js]+=t.length,this[au](n,null,t)}},uO=class extends f5{constructor(e,t){super(e,t,!1)}[Mp](e,t){let n=this[Nd]();if(e)return n(e);try{t=t!==void 0?this[Up].decode(t):void 0}catch(i){return n(new Dd("value",i))}t!==void 0&&this[Js]++,n(null,t)}[bl](e,t){let n=this[Nd]();if(e)return this[au](n,e);try{for(let i=0;i<t.length;i++){let o=t[i];t[i]=o!==void 0?this[Up].decode(o):void 0}}catch(i){return this[au](n,new Dd("values",i))}this[Js]+=t.length,this[au](n,null,t)}},Dd=class extends us{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}};for(let r of["_ended property","_nexting property","_end method"])Object.defineProperty(E2.prototype,r.split(" ")[0],{get(){throw new us(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new us(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});E2.keyEncoding=kd;E2.valueEncoding=Up;W7.AbstractIterator=E2;W7.AbstractKeyIterator=cO;W7.AbstractValueIterator=uO});var Koe=P(lO=>{"use strict";var{AbstractKeyIterator:nLe,AbstractValueIterator:iLe}=Od(),Fp=Symbol("iterator"),d5=Symbol("callback"),v2=Symbol("handleOne"),zp=Symbol("handleMany"),h5=class extends nLe{constructor(e,t){super(e,t),this[Fp]=e.iterator({...t,keys:!0,values:!1}),this[v2]=this[v2].bind(this),this[zp]=this[zp].bind(this)}},Y7=class extends iLe{constructor(e,t){super(e,t),this[Fp]=e.iterator({...t,keys:!1,values:!0}),this[v2]=this[v2].bind(this),this[zp]=this[zp].bind(this)}};for(let r of[h5,Y7]){let e=r===h5,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[d5]=n,this[Fp].next(this[v2])},r.prototype[v2]=function(n,i,o){let s=this[d5];n?s(n):s(null,e?i:o)},r.prototype._nextv=function(n,i,o){this[d5]=o,this[Fp].nextv(n,i,this[zp])},r.prototype._all=function(n,i){this[d5]=i,this[Fp].all(n,this[zp])},r.prototype[zp]=function(n,i){let o=this[d5];n?o(n):o(null,i.map(t))},r.prototype._seek=function(n,i){this[Fp].seek(n,i)},r.prototype._close=function(n){this[Fp].close(n)}}lO.DefaultKeyIterator=h5;lO.DefaultValueIterator=Y7});var $oe=P(tv=>{"use strict";var{AbstractIterator:oLe,AbstractKeyIterator:sLe,AbstractValueIterator:aLe}=Od(),fO=Za(),xo=Symbol("nut"),J7=Symbol("undefer"),ev=Symbol("factory"),Q7=class extends oLe{constructor(e,t){super(e,t),this[xo]=null,this[ev]=()=>e.iterator(t),this.db.defer(()=>this[J7]())}},X7=class extends sLe{constructor(e,t){super(e,t),this[xo]=null,this[ev]=()=>e.keys(t),this.db.defer(()=>this[J7]())}},Z7=class extends aLe{constructor(e,t){super(e,t),this[xo]=null,this[ev]=()=>e.values(t),this.db.defer(()=>this[J7]())}};for(let r of[Q7,X7,Z7])r.prototype[J7]=function(){this.db.status==="open"&&(this[xo]=this[ev]())},r.prototype._next=function(e){this[xo]!==null?this[xo].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new fO("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[xo]!==null?this[xo].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new fO("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[xo]!==null?this[xo].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new fO("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[xo]!==null?this[xo]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[xo]!==null?this[xo].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};tv.DeferredIterator=Q7;tv.DeferredKeyIterator=X7;tv.DeferredValueIterator=Z7});var hO=P(Hoe=>{"use strict";var{fromCallback:qoe}=c5(),rv=Za(),{getCallback:cLe,getOptions:uLe}=q7(),nv=Symbol("promise"),ea=Symbol("status"),x2=Symbol("operations"),p5=Symbol("finishClose"),S2=Symbol("closeCallbacks"),dO=class{constructor(e){if(typeof e!="object"||e===null){let t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[x2]=[],this[S2]=[],this[ea]="open",this[p5]=this[p5].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[x2].length}put(e,t,n){if(this[ea]!=="open")throw new rv("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;let o=n&&n.sublevel!=null?n.sublevel:this.db,s=n,a=o.keyEncoding(n&&n.keyEncoding),c=o.valueEncoding(n&&n.valueEncoding),u=a.format;n={...n,keyEncoding:u,valueEncoding:c.format},o!==this.db&&(n.sublevel=null);let l=o.prefixKey(a.encode(e),u),f=c.encode(t);return this._put(l,f,n),this[x2].push({...s,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[ea]!=="open")throw new rv("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(e);if(n)throw n;let i=t&&t.sublevel!=null?t.sublevel:this.db,o=t,s=i.keyEncoding(t&&t.keyEncoding),a=s.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(s.encode(e),a),t),this[x2].push({...o,type:"del",key:e}),this}_del(e,t){}clear(){if(this[ea]!=="open")throw new rv("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[x2]=[],this}_clear(){}write(e,t){return t=cLe(e,t),t=qoe(t,nv),e=uLe(e),this[ea]!=="open"?this.nextTick(t,new rv("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[ea]="writing",this._write(e,n=>{this[ea]="closing",this[S2].push(()=>t(n)),n||this.db.emit("batch",this[x2]),this._close(this[p5])})),t[nv]}_write(e,t){}close(e){return e=qoe(e,nv),this[ea]==="closing"?this[S2].push(e):this[ea]==="closed"?this.nextTick(e):(this[S2].push(e),this[ea]!=="writing"&&(this[ea]="closing",this._close(this[p5]))),e[nv]}_close(e){this.nextTick(e)}[p5](){this[ea]="closed",this.db.detachResource(this);let e=this[S2];this[S2]=[];for(let t of e)t()}};Hoe.AbstractChainedBatch=dO});var joe=P(Goe=>{"use strict";var{AbstractChainedBatch:lLe}=hO(),fLe=Za(),A2=Symbol("encoded"),pO=class extends lLe{constructor(e){super(e),this[A2]=[]}_put(e,t,n){this[A2].push({...n,type:"put",key:e,value:t})}_del(e,t){this[A2].push({...t,type:"del",key:e})}_clear(){this[A2]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[A2].length===0?this.nextTick(t):this.db._batch(this[A2],e,t):this.nextTick(t,new fLe("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};Goe.DefaultChainedBatch=pO});var Qoe=P((h7t,Yoe)=>{"use strict";var Woe=Za(),dLe=Object.prototype.hasOwnProperty,hLe=new Set(["lt","lte","gt","gte"]);Yoe.exports=function(r,e){let t={};for(let n in r)if(dLe.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new Woe(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new Woe("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});hLe.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t}});var mO=P((p7t,Zoe)=>{var Xoe;Zoe.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):r=>(Xoe||(Xoe=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0))});var tse=P((m7t,ese)=>{"use strict";var Joe=mO();ese.exports=function(r,...e){e.length===0?Joe(r):Joe(()=>r(...e))}});var rse=P(iv=>{"use strict";var{AbstractIterator:pLe,AbstractKeyIterator:mLe,AbstractValueIterator:gLe}=Od(),T2=Symbol("unfix"),Ja=Symbol("iterator"),Vp=Symbol("handleOne"),Ld=Symbol("handleMany"),_l=Symbol("callback"),m5=class extends pLe{constructor(e,t,n,i){super(e,t),this[Ja]=n,this[T2]=i,this[Vp]=this[Vp].bind(this),this[Ld]=this[Ld].bind(this),this[_l]=null}[Vp](e,t,n){let i=this[_l];if(e)return i(e);t!==void 0&&(t=this[T2](t)),i(e,t,n)}[Ld](e,t){let n=this[_l];if(e)return n(e);for(let i of t){let o=i[0];o!==void 0&&(i[0]=this[T2](o))}n(e,t)}},g5=class extends mLe{constructor(e,t,n,i){super(e,t),this[Ja]=n,this[T2]=i,this[Vp]=this[Vp].bind(this),this[Ld]=this[Ld].bind(this),this[_l]=null}[Vp](e,t){let n=this[_l];if(e)return n(e);t!==void 0&&(t=this[T2](t)),n(e,t)}[Ld](e,t){let n=this[_l];if(e)return n(e);for(let i=0;i<t.length;i++){let o=t[i];o!==void 0&&(t[i]=this[T2](o))}n(e,t)}},y5=class extends gLe{constructor(e,t,n){super(e,t),this[Ja]=n}};for(let r of[m5,g5])r.prototype._next=function(e){this[_l]=e,this[Ja].next(this[Vp])},r.prototype._nextv=function(e,t,n){this[_l]=n,this[Ja].nextv(e,t,this[Ld])},r.prototype._all=function(e,t){this[_l]=t,this[Ja].all(e,this[Ld])};for(let r of[y5])r.prototype._next=function(e){this[Ja].next(e)},r.prototype._nextv=function(e,t,n){this[Ja].nextv(e,t,n)},r.prototype._all=function(e,t){this[Ja].all(e,t)};for(let r of[m5,g5,y5])r.prototype._seek=function(e,t){this[Ja].seek(e,t)},r.prototype._close=function(e){this[Ja].close(e)};iv.AbstractSublevelIterator=m5;iv.AbstractSublevelKeyIterator=g5;iv.AbstractSublevelValueIterator=y5});var sse=P((y7t,ose)=>{"use strict";var gO=Za(),{Buffer:bO}=n5()||{},{AbstractSublevelIterator:yLe,AbstractSublevelKeyIterator:wLe,AbstractSublevelValueIterator:bLe}=rse(),El=Symbol("prefix"),nse=Symbol("upperBound"),w5=Symbol("prefixRange"),ls=Symbol("parent"),yO=Symbol("unfix"),ise=new TextEncoder,_Le={separator:"!"};ose.exports=function({AbstractLevel:r}){class e extends r{static defaults(n){if(typeof n=="string")throw new gO("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(n&&n.open)throw new gO("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return n==null?_Le:n.separator?n:{...n,separator:"!"}}constructor(n,i,o){let{separator:s,manifest:a,...c}=e.defaults(o);i=vLe(i,s);let u=s.charCodeAt(0)+1,l=n[ls]||n;if(!ise.encode(i).every(d=>d>u&&d<127))throw new gO(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(ELe(l,a),c);let f=(n.prefix||"")+s+i+s,h=f.slice(0,-1)+String.fromCharCode(u);this[ls]=l,this[El]=new ov(f),this[nse]=new ov(h),this[yO]=new _O,this.nextTick=l.nextTick}prefixKey(n,i){if(i==="utf8")return this[El].utf8+n;if(n.byteLength===0)return this[El][i];if(i==="view"){let o=this[El].view,s=new Uint8Array(o.byteLength+n.byteLength);return s.set(o,0),s.set(n,o.byteLength),s}else{let o=this[El].buffer;return bO.concat([o,n],o.byteLength+n.byteLength)}}[w5](n,i){n.gte!==void 0?n.gte=this.prefixKey(n.gte,i):n.gt!==void 0?n.gt=this.prefixKey(n.gt,i):n.gte=this[El][i],n.lte!==void 0?n.lte=this.prefixKey(n.lte,i):n.lt!==void 0?n.lt=this.prefixKey(n.lt,i):n.lte=this[nse][i]}get prefix(){return this[El].utf8}get db(){return this[ls]}_open(n,i){this[ls].open({passive:!0},i)}_put(n,i,o,s){this[ls].put(n,i,o,s)}_get(n,i,o){this[ls].get(n,i,o)}_getMany(n,i,o){this[ls].getMany(n,i,o)}_del(n,i,o){this[ls].del(n,i,o)}_batch(n,i,o){this[ls].batch(n,i,o)}_clear(n,i){this[w5](n,n.keyEncoding),this[ls].clear(n,i)}_iterator(n){this[w5](n,n.keyEncoding);let i=this[ls].iterator(n),o=this[yO].get(this[El].utf8.length,n.keyEncoding);return new yLe(this,n,i,o)}_keys(n){this[w5](n,n.keyEncoding);let i=this[ls].keys(n),o=this[yO].get(this[El].utf8.length,n.keyEncoding);return new wLe(this,n,i,o)}_values(n){this[w5](n,n.keyEncoding);let i=this[ls].values(n);return new bLe(this,n,i)}}return{AbstractSublevel:e}};var ELe=function(r,e){return{...r.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...e,encodings:{utf8:wO(r,"utf8"),buffer:wO(r,"buffer"),view:wO(r,"view")}}},wO=function(r,e){return r.supports.encodings[e]?r.keyEncoding(e).name===e:!1},ov=class{constructor(e){this.utf8=e,this.view=ise.encode(e),this.buffer=bO?bO.from(this.view.buffer,0,this.view.byteLength):{}}},_O=class{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return n===void 0&&(t==="view"?n=function(i,o){return o.subarray(i)}.bind(null,e):n=function(i,o){return o.slice(i)}.bind(null,e),this.cache.set(t,n)),n}},vLe=function(r,e){let t=0,n=r.length;for(;t<n&&r[t]===e;)t++;for(;n>t&&r[n-1]===e;)n--;return r.slice(t,n)}});var AO=P(SO=>{"use strict";var{supports:xLe}=Qie(),{Transcoder:SLe}=Toe(),{EventEmitter:ALe}=xi(),{fromCallback:Bd}=c5(),ec=Za(),{AbstractIterator:Kp}=Od(),{DefaultKeyIterator:TLe,DefaultValueIterator:ILe}=Koe(),{DeferredIterator:RLe,DeferredKeyIterator:CLe,DeferredValueIterator:PLe}=$oe(),{DefaultChainedBatch:ase}=joe(),{getCallback:$p,getOptions:Md}=q7(),sv=Qoe(),wt=Symbol("promise"),vl=Symbol("landed"),qp=Symbol("resources"),EO=Symbol("closeResources"),b5=Symbol("operations"),_5=Symbol("undefer"),av=Symbol("deferOpen"),cse=Symbol("options"),It=Symbol("status"),Hp=Symbol("defaultOptions"),I2=Symbol("transcoder"),cv=Symbol("keyEncoding"),vO=Symbol("valueEncoding"),kLe=()=>{},E5=class extends ALe{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=Md(t);let{keyEncoding:n,valueEncoding:i,passive:o,...s}=t;this[qp]=new Set,this[b5]=[],this[av]=!0,this[cse]=s,this[It]="opening",this.supports=xLe(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[I2]=new SLe(NLe(this)),this[cv]=this[I2].encoding(n||"utf8"),this[vO]=this[I2].encoding(i||"utf8");for(let a of this[I2].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Hp]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[cv].commonName,valueEncoding:this[vO].commonName}),key:Object.freeze({keyEncoding:this[cv].commonName})},this.nextTick(()=>{this[av]&&this.open({passive:!1},kLe)})}get status(){return this[It]}keyEncoding(e){return this[I2].encoding(e??this[cv])}valueEncoding(e){return this[I2].encoding(e??this[vO])}open(e,t){t=$p(e,t),t=Bd(t,wt),e={...this[cse],...Md(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;let n=i=>{this[It]==="closing"||this[It]==="opening"?this.once(vl,i?()=>n(i):n):this[It]!=="open"?t(new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[It]==="opening"?this.once(vl,n):this.nextTick(n):this[It]==="closed"||this[av]?(this[av]=!1,this[It]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[It]="closed",this[EO](()=>{this.emit(vl),n(i)}),this[_5]();return}this[It]="open",this[_5](),this.emit(vl),this[It]==="open"&&this.emit("open"),this[It]==="open"&&this.emit("ready"),n()})):this[It]==="open"?this.nextTick(n):this.once(vl,()=>this.open(e,t)),t[wt]}_open(e,t){this.nextTick(t)}close(e){e=Bd(e,wt);let t=n=>{this[It]==="opening"||this[It]==="closing"?this.once(vl,n?t(n):t):this[It]!=="closed"?e(new ec("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[It]==="open"){this[It]="closing",this.emit("closing");let n=i=>{this[It]="open",this[_5](),this.emit(vl),t(i)};this[EO](()=>{this._close(i=>{if(i)return n(i);this[It]="closed",this[_5](),this.emit(vl),this[It]==="closed"&&this.emit("closed"),t()})})}else this[It]==="closed"?this.nextTick(t):this.once(vl,()=>this.close(e));return e[wt]}[EO](e){if(this[qp].size===0)return this.nextTick(e);let t=this[qp].size,n=!0,i=()=>{--t===0&&(n?this.nextTick(e):e())};for(let o of this[qp])o.close(i);n=!1,this[qp].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=$p(t,n),n=Bd(n,wt),t=Md(t,this[Hp].entry),this[It]==="opening")return this.defer(()=>this.get(e,t,n)),n[wt];if(R2(this,n))return n[wt];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[wt];let o=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),a=o.format,c=s.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(o.encode(e),a),t,(u,l)=>{if(u)return(u.code==="LEVEL_NOT_FOUND"||u.notFound||/NotFound/i.test(u))&&(u.code||(u.code="LEVEL_NOT_FOUND"),u.notFound||(u.notFound=!0),u.status||(u.status=404)),n(u);try{l=s.decode(l)}catch(f){return n(new ec("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:f}))}n(null,l)}),n[wt]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=$p(t,n),n=Bd(n,wt),t=Md(t,this[Hp].entry),this[It]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[wt];if(R2(this,n))return n[wt];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[wt];if(e.length===0)return this.nextTick(n,null,[]),n[wt];let i=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),s=i.format,a=o.format;(t.keyEncoding!==s||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:s,valueEncoding:a}));let c=new Array(e.length);for(let u=0;u<e.length;u++){let l=e[u],f=this._checkKey(l);if(f)return this.nextTick(n,f),n[wt];c[u]=this.prefixKey(i.encode(l),s)}return this._getMany(c,t,(u,l)=>{if(u)return n(u);try{for(let f=0;f<l.length;f++)l[f]!==void 0&&(l[f]=o.decode(l[f]))}catch(f){return n(new ec(`Could not decode one or more of ${l.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:f}))}n(null,l)}),n[wt]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=$p(n,i),i=Bd(i,wt),n=Md(n,this[Hp].entry),this[It]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[wt];if(R2(this,i))return i[wt];let o=this._checkKey(e)||this._checkValue(t);if(o)return this.nextTick(i,o),i[wt];let s=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=s.format,u=a.format;(n.keyEncoding!==c||n.valueEncoding!==u)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:u}));let l=this.prefixKey(s.encode(e),c),f=a.encode(t);return this._put(l,f,n,h=>{if(h)return i(h);this.emit("put",e,t),i()}),i[wt]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=$p(t,n),n=Bd(n,wt),t=Md(t,this[Hp].key),this[It]==="opening")return this.defer(()=>this.del(e,t,n)),n[wt];if(R2(this,n))return n[wt];let i=this._checkKey(e);if(i)return this.nextTick(n,i),n[wt];let o=this.keyEncoding(t.keyEncoding),s=o.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(o.encode(e),s),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[wt]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[It]==="opening")return new ase(this);if(this[It]!=="open")throw new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=$p(t,n),n=Bd(n,wt),t=Md(t,this[Hp].empty),this[It]==="opening")return this.defer(()=>this.batch(e,t,n)),n[wt];if(R2(this,n))return n[wt];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[wt];if(e.length===0)return this.nextTick(n),n[wt];let i=new Array(e.length),{keyEncoding:o,valueEncoding:s,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[wt];let u=Object.assign({},e[c]);if(u.type!=="put"&&u.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[wt];let l=this._checkKey(u.key);if(l)return this.nextTick(n,l),n[wt];let f=u.sublevel!=null?u.sublevel:this,h=f.keyEncoding(u.keyEncoding||o),d=h.format;if(u.key=f.prefixKey(h.encode(u.key),d),u.keyEncoding=d,u.type==="put"){let p=this._checkValue(u.value);if(p)return this.nextTick(n,p),n[wt];let g=f.valueEncoding(u.valueEncoding||s);u.value=g.encode(u.value),u.valueEncoding=g.format}f!==this&&(u.sublevel=null),i[c]=u}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[wt]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,xO.defaults(t))}_sublevel(e,t){return new xO(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=$p(e,t),t=Bd(t,wt),e=Md(e,this[Hp].empty),this[It]==="opening")return this.defer(()=>this.clear(e,t)),t[wt];if(R2(this,t))return t[wt];let n=e,i=this.keyEncoding(e.keyEncoding);return e=sv(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,o=>{if(o)return t(o);this.emit("clear",n),t()}),t[wt]}_clear(e,t){this.nextTick(t)}iterator(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=sv(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[Kp.keyEncoding]=t,e[Kp.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[It]==="opening")return new RLe(this,e);if(this[It]!=="open")throw new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new Kp(this,e)}keys(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=sv(e,t),e[Kp.keyEncoding]=t,e[Kp.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[It]==="opening")return new CLe(this,e);if(this[It]!=="open")throw new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new TLe(this,e)}values(e){let t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=sv(e,t),e[Kp.keyEncoding]=t,e[Kp.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[It]==="opening")return new PLe(this,e);if(this[It]!=="open")throw new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new ILe(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[b5].push(e)}[_5](){if(this[b5].length===0)return;let e=this[b5];this[b5]=[];for(let t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[qp].add(e)}detachResource(e){this[qp].delete(e)}_chainedBatch(){return new ase(this)}_checkKey(e){if(e==null)return new ec("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new ec("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};E5.prototype.nextTick=tse();var{AbstractSublevel:xO}=sse()({AbstractLevel:E5});SO.AbstractLevel=E5;SO.AbstractSublevel=xO;var R2=function(r,e){return r[It]!=="open"?(r.nextTick(e,new ec("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},NLe=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])}});var TO=P(Gp=>{"use strict";Gp.AbstractLevel=AO().AbstractLevel;Gp.AbstractSublevel=AO().AbstractSublevel;Gp.AbstractIterator=Od().AbstractIterator;Gp.AbstractKeyIterator=Od().AbstractKeyIterator;Gp.AbstractValueIterator=Od().AbstractValueIterator;Gp.AbstractChainedBatch=hO().AbstractChainedBatch});var lse=P((_7t,use)=>{use.exports=OLe;var DLe=mO();function OLe(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,o,s,a,c=!0,u;Array.isArray(r)?(n=[],o=i=r.length):(s=Object.keys(r),n={},o=i=s.length);function l(h){function d(){t&&t(h,n),t=null}c?DLe(d):d()}function f(h,d,p){if(n[h]=p,d&&(a=!0),--o===0||d)l(d);else if(!a&&u<i){let g;s?(g=s[u],u+=1,r[g](function(w,_){f(g,w,_)})):(g=u,u+=1,r[g](function(w,_){f(g,w,_)}))}}u=e,o?s?s.some(function(h,d){return r[h](function(p,g){f(h,p,g)}),d===e-1}):r.some(function(h,d){return h(function(p,g){f(d,p,g)}),d===e-1}):l(null),c=!1}});var IO=P((E7t,fse)=>{"use strict";fse.exports=function(e){let t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,o=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,o):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,o):null}});var RO=P((v7t,dse)=>{"use strict";var LLe=new TextEncoder;dse.exports=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):LLe.encode(r)}});var yse=P(gse=>{"use strict";var{AbstractIterator:BLe}=TO(),hse=IO(),uv=RO(),cu=Symbol("cache"),xl=Symbol("finished"),fs=Symbol("options"),Sl=Symbol("currentOptions"),jp=Symbol("position"),CO=Symbol("location"),C2=Symbol("first"),pse={},PO=class extends BLe{constructor(e,t,n){super(e,n),this[cu]=[],this[xl]=this.limit===0,this[fs]=n,this[Sl]={...n},this[jp]=void 0,this[CO]=t,this[C2]=!0}_nextv(e,t,n){if(this[C2]=!1,this[xl])return this.nextTick(n,null,[]);if(this[cu].length>0)return e=Math.min(e,this[cu].length),this.nextTick(n,null,this[cu].splice(0,e));this[jp]!==void 0&&(this[fs].reverse?(this[Sl].lt=this[jp],this[Sl].lte=void 0):(this[Sl].gt=this[jp],this[Sl].gte=void 0));let i;try{i=hse(this[Sl])}catch{return this[xl]=!0,this.nextTick(n,null,[])}let o=this.db.db.transaction([this[CO]],"readonly"),s=o.objectStore(this[CO]),a=[];if(this[fs].reverse){let c=!this[fs].values&&s.openKeyCursor?"openKeyCursor":"openCursor";s[c](i,"prev").onsuccess=u=>{let l=u.target.result;if(l){let{key:f,value:h}=l;this[jp]=f,a.push([this[fs].keys&&f!==void 0?uv(f):void 0,this[fs].values&&h!==void 0?uv(h):void 0]),a.length<e?l.continue():mse(o)}else this[xl]=!0}}else{let c,u,l=()=>{if(c===void 0||u===void 0)return;let f=Math.max(c.length,u.length);f===0||e===1/0?this[xl]=!0:this[jp]=c[f-1],a.length=f;for(let h=0;h<f;h++){let d=c[h],p=u[h];a[h]=[this[fs].keys&&d!==void 0?uv(d):void 0,this[fs].values&&p!==void 0?uv(p):void 0]}mse(o)};this[fs].keys||e<1/0?s.getAllKeys(i,e<1/0?e:void 0).onsuccess=f=>{c=f.target.result,l()}:(c=[],this.nextTick(l)),this[fs].values?s.getAll(i,e<1/0?e:void 0).onsuccess=f=>{u=f.target.result,l()}:(u=[],this.nextTick(l))}o.onabort=()=>{n(o.error||new Error("aborted by user")),n=null},o.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[cu].length>0){let[t,n]=this[cu].shift();this.nextTick(e,null,t,n)}else if(this[xl])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[C2]&&(this[C2]=!1,t=1),this._nextv(t,pse,(n,i)=>{if(n)return e(n);this[cu]=i,this._next(e)})}}_all(e,t){this[C2]=!1;let n=this[cu].splice(0,this[cu].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,pse,(o,s)=>{if(o)return t(o);n.length>0&&(s=n.concat(s)),t(null,s)})}_seek(e,t){this[C2]=!0,this[cu]=[],this[xl]=!1,this[jp]=void 0,this[Sl]={...this[fs]};let n;try{n=hse(this[fs])}catch{this[xl]=!0;return}n!==null&&!n.includes(e)?this[xl]=!0:this[fs].reverse?this[Sl].lte=e:this[Sl].gte=e}};gse.Iterator=PO;function mse(r){typeof r.commit=="function"&&r.commit()}});var bse=P((S7t,wse)=>{"use strict";wse.exports=function(e,t,n,i,o){if(i.limit===0)return e.nextTick(o);let s=e.db.transaction([t],"readwrite"),a=s.objectStore(t),c=0;s.oncomplete=function(){o()},s.onabort=function(){o(s.error||new Error("aborted by user"))};let u=a.openKeyCursor?"openKeyCursor":"openCursor",l=i.reverse?"prev":"next";a[u](n,l).onsuccess=function(f){let h=f.target.result;h&&(a.delete(h.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&h.continue()})}}});var Ase=P(Sse=>{"use strict";var{AbstractLevel:MLe}=TO(),_se=Za(),ULe=lse(),{fromCallback:FLe}=c5(),{Iterator:zLe}=yse(),Ese=RO(),VLe=bse(),KLe=IO(),xse="level-js-",v5=Symbol("idb"),kO=Symbol("namePrefix"),Al=Symbol("location"),NO=Symbol("version"),Wp=Symbol("store"),x5=Symbol("onComplete"),vse=Symbol("promise"),lv=class extends MLe{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new _se("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:o,...s}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},s),typeof e!="string")throw new Error("constructor requires a location string argument");this[Al]=e,this[kO]=i??xse,this[NO]=parseInt(o||1,10),this[v5]=null}get location(){return this[Al]}get namePrefix(){return this[kO]}get version(){return this[NO]}get db(){return this[v5]}get type(){return"browser-level"}_open(e,t){let n=indexedDB.open(this[kO]+this[Al],this[NO]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[v5]=n.result,t()},n.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(this[Al])||o.createObjectStore(this[Al])}}[Wp](e){return this[v5].transaction([this[Al]],e).objectStore(this[Al])}[x5](e,t){let n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){let i=this[Wp]("readonly"),o;try{o=i.get(e)}catch(s){return this.nextTick(n,s)}this[x5](o,function(s,a){if(s)return n(s);if(a===void 0)return n(new _se("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,Ese(a))})}_getMany(e,t,n){let i=this[Wp]("readonly"),o=e.map(s=>a=>{let c;try{c=i.get(s)}catch(u){return a(u)}c.onsuccess=()=>{let u=c.result;a(null,u===void 0?u:Ese(u))},c.onerror=u=>{u.stopPropagation(),a(c.error)}});ULe(o,16,n)}_del(e,t,n){let i=this[Wp]("readwrite"),o;try{o=i.delete(e)}catch(s){return this.nextTick(n,s)}this[x5](o,n)}_put(e,t,n,i){let o=this[Wp]("readwrite"),s;try{s=o.put(t,e)}catch(a){return this.nextTick(i,a)}this[x5](s,i)}_iterator(e){return new zLe(this,this[Al],e)}_batch(e,t,n){let i=this[Wp]("readwrite"),o=i.transaction,s=0,a;o.onabort=function(){n(a||o.error||new Error("aborted by user"))},o.oncomplete=function(){n()};function c(){let u=e[s++],l=u.key,f;try{f=u.type==="del"?i.delete(l):i.put(u.value,l)}catch(h){a=h,o.abort();return}s<e.length?f.onsuccess=c:typeof o.commit=="function"&&o.commit()}c()}_clear(e,t){let n,i;try{n=KLe(e)}catch{return this.nextTick(t)}if(e.limit>=0)return VLe(this,this[Al],n,e,t);try{let o=this[Wp]("readwrite");i=n?o.delete(n):o.clear()}catch(o){return this.nextTick(t,o)}this[x5](i,t)}_close(e){this[v5].close(),this.nextTick(e)}};lv.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=xse),t=FLe(t,vse);let n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[vse]};Sse.BrowserLevel=lv});var Ise=P(Tse=>{Tse.Level=Ase().BrowserLevel});var Mse=P((Kvt,Bse)=>{"use strict";Bse.exports=fi;var T5=Kd();function fi(r,e){this.lo=r>>>0,this.hi=e>>>0}var Qp=fi.zero=new fi(0,0);Qp.toNumber=function(){return 0};Qp.zzEncode=Qp.zzDecode=function(){return this};Qp.length=function(){return 1};var iBe=fi.zeroHash="\0\0\0\0\0\0\0\0";fi.fromNumber=function(e){if(e===0)return Qp;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new fi(n,i)};fi.from=function(e){if(typeof e=="number")return fi.fromNumber(e);if(T5.isString(e))if(T5.Long)e=T5.Long.fromString(e);else return fi.fromNumber(parseInt(e,10));return e.low||e.high?new fi(e.low>>>0,e.high>>>0):Qp};fi.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};fi.prototype.toLong=function(e){return T5.Long?new T5.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Vd=String.prototype.charCodeAt;fi.fromHash=function(e){return e===iBe?Qp:new fi((Vd.call(e,0)|Vd.call(e,1)<<8|Vd.call(e,2)<<16|Vd.call(e,3)<<24)>>>0,(Vd.call(e,4)|Vd.call(e,5)<<8|Vd.call(e,6)<<16|Vd.call(e,7)<<24)>>>0)};fi.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};fi.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};fi.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};fi.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Kd=P(UO=>{"use strict";var Ue=UO;Ue.asPromise=N6();Ue.base64=O6();Ue.EventEmitter=B6();Ue.float=M6();Ue.inquire=U6();Ue.utf8=F6();Ue.pool=z6();Ue.LongBits=Mse();Ue.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);Ue.global=Ue.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||UO;Ue.emptyArray=Object.freeze?Object.freeze([]):[];Ue.emptyObject=Object.freeze?Object.freeze({}):{};Ue.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ue.isString=function(e){return typeof e=="string"||e instanceof String};Ue.isObject=function(e){return e&&typeof e=="object"};Ue.isset=Ue.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};Ue.Buffer=function(){try{var r=Ue.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();Ue._Buffer_from=null;Ue._Buffer_allocUnsafe=null;Ue.newBuffer=function(e){return typeof e=="number"?Ue.Buffer?Ue._Buffer_allocUnsafe(e):new Ue.Array(e):Ue.Buffer?Ue._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ue.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ue.Long=Ue.global.dcodeIO&&Ue.global.dcodeIO.Long||Ue.global.Long||Ue.inquire("long");Ue.key2Re=/^true|false|0|1$/;Ue.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ue.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ue.longToHash=function(e){return e?Ue.LongBits.from(e).toHash():Ue.LongBits.zeroHash};Ue.longFromHash=function(e,t){var n=Ue.LongBits.fromHash(e);return Ue.Long?Ue.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)};function Use(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}Ue.merge=Use;Ue.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Fse(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Use(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}Ue.newError=Fse;Ue.ProtocolError=Fse("ProtocolError");Ue.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),o=i.length-1;o>-1;--o)if(t[i[o]]===1&&this[i[o]]!==void 0&&this[i[o]]!==null)return i[o]}};Ue.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};Ue.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ue._configure=function(){var r=Ue.Buffer;if(!r){Ue._Buffer_from=Ue._Buffer_allocUnsafe=null;return}Ue._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},Ue._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var HO=P((qvt,$se)=>{"use strict";$se.exports=Xt;var ta=Kd(),FO,mv=ta.LongBits,zse=ta.base64,Vse=ta.utf8;function I5(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function VO(){}function oBe(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Xt(){this.len=0,this.head=new I5(VO,0,0),this.tail=this.head,this.states=null}var Kse=function(){return ta.Buffer?function(){return(Xt.create=function(){return new FO})()}:function(){return new Xt}};Xt.create=Kse();Xt.alloc=function(e){return new ta.Array(e)};ta.Array!==Array&&(Xt.alloc=ta.pool(Xt.alloc,ta.Array.prototype.subarray));Xt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new I5(e,t,n),this.len+=t,this};function KO(r,e,t){e[t]=r&255}function sBe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function $O(r,e){this.len=r,this.next=void 0,this.val=e}$O.prototype=Object.create(I5.prototype);$O.prototype.fn=sBe;Xt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new $O((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Xt.prototype.int32=function(e){return e<0?this._push(qO,10,mv.fromNumber(e)):this.uint32(e)};Xt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function qO(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Xt.prototype.uint64=function(e){var t=mv.from(e);return this._push(qO,t.length(),t)};Xt.prototype.int64=Xt.prototype.uint64;Xt.prototype.sint64=function(e){var t=mv.from(e).zzEncode();return this._push(qO,t.length(),t)};Xt.prototype.bool=function(e){return this._push(KO,1,e?1:0)};function zO(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Xt.prototype.fixed32=function(e){return this._push(zO,4,e>>>0)};Xt.prototype.sfixed32=Xt.prototype.fixed32;Xt.prototype.fixed64=function(e){var t=mv.from(e);return this._push(zO,4,t.lo)._push(zO,4,t.hi)};Xt.prototype.sfixed64=Xt.prototype.fixed64;Xt.prototype.float=function(e){return this._push(ta.float.writeFloatLE,4,e)};Xt.prototype.double=function(e){return this._push(ta.float.writeDoubleLE,8,e)};var aBe=ta.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Xt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(KO,1,0);if(ta.isString(e)){var n=Xt.alloc(t=zse.length(e));zse.decode(e,n,0),e=n}return this.uint32(t)._push(aBe,t,e)};Xt.prototype.string=function(e){var t=Vse.length(e);return t?this.uint32(t)._push(Vse.write,t,e):this._push(KO,1,0)};Xt.prototype.fork=function(){return this.states=new oBe(this),this.head=this.tail=new I5(VO,0,0),this.len=0,this};Xt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new I5(VO,0,0),this.len=0),this};Xt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Xt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Xt._configure=function(r){FO=r,Xt.create=Kse(),FO._configure()}});var Gse=P((Hvt,Hse)=>{"use strict";Hse.exports=fu;var qse=HO();(fu.prototype=Object.create(qse.prototype)).constructor=fu;var $d=Kd();function fu(){qse.call(this)}fu._configure=function(){fu.alloc=$d._Buffer_allocUnsafe,fu.writeBytesBuffer=$d.Buffer&&$d.Buffer.prototype instanceof Uint8Array&&$d.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};fu.prototype.bytes=function(e){$d.isString(e)&&(e=$d._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(fu.writeBytesBuffer,t,e),this};function cBe(r,e,t){r.length<40?$d.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}fu.prototype.string=function(e){var t=$d.Buffer.byteLength(e);return this.uint32(t),t&&this._push(cBe,t,e),this};fu._configure()});var WO=P((Gvt,Xse)=>{"use strict";Xse.exports=En;var du=Kd(),jO,Yse=du.LongBits,uBe=du.utf8;function tc(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function En(r){this.buf=r,this.pos=0,this.len=r.length}var jse=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new En(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new En(e);throw Error("illegal buffer")},Qse=function(){return du.Buffer?function(t){return(En.create=function(i){return du.Buffer.isBuffer(i)?new jO(i):jse(i)})(t)}:jse};En.create=Qse();En.prototype._slice=du.Array.prototype.subarray||du.Array.prototype.slice;En.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,tc(this,10);return e}}();En.prototype.int32=function(){return this.uint32()|0};En.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function GO(){var r=new Yse(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw tc(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw tc(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}En.prototype.bool=function(){return this.uint32()!==0};function gv(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}En.prototype.fixed32=function(){if(this.pos+4>this.len)throw tc(this,4);return gv(this.buf,this.pos+=4)};En.prototype.sfixed32=function(){if(this.pos+4>this.len)throw tc(this,4);return gv(this.buf,this.pos+=4)|0};function Wse(){if(this.pos+8>this.len)throw tc(this,8);return new Yse(gv(this.buf,this.pos+=4),gv(this.buf,this.pos+=4))}En.prototype.float=function(){if(this.pos+4>this.len)throw tc(this,4);var e=du.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};En.prototype.double=function(){if(this.pos+8>this.len)throw tc(this,4);var e=du.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};En.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw tc(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};En.prototype.string=function(){var e=this.bytes();return uBe.read(e,0,e.length)};En.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw tc(this,e);this.pos+=e}else do if(this.pos>=this.len)throw tc(this);while(this.buf[this.pos++]&128);return this};En.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};En._configure=function(r){jO=r,En.create=Qse(),jO._configure();var e=du.Long?"toLong":"toNumber";du.merge(En.prototype,{int64:function(){return GO.call(this)[e](!1)},uint64:function(){return GO.call(this)[e](!0)},sint64:function(){return GO.call(this).zzDecode()[e](!1)},fixed64:function(){return Wse.call(this)[e](!0)},sfixed64:function(){return Wse.call(this)[e](!1)}})}});var tae=P((jvt,eae)=>{"use strict";eae.exports=Xp;var Jse=WO();(Xp.prototype=Object.create(Jse.prototype)).constructor=Xp;var Zse=Kd();function Xp(r){Jse.call(this,r)}Xp._configure=function(){Zse.Buffer&&(Xp.prototype._slice=Zse.Buffer.prototype.slice)};Xp.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Xp._configure()});var nae=P((Wvt,rae)=>{"use strict";rae.exports=R5;var YO=Kd();(R5.prototype=Object.create(YO.EventEmitter.prototype)).constructor=R5;function R5(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");YO.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}R5.prototype.rpcCall=function r(e,t,n,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return YO.asPromise(r,s,e,t,n,i);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(e,t[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,u){if(c)return s.emit("error",c,e),o(c);if(u===null){s.end(!0);return}if(!(u instanceof n))try{u=n[s.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return s.emit("error",l,e),o(l)}return s.emit("data",u,e),o(null,u)})}catch(a){s.emit("error",a,e),setTimeout(function(){o(a)},0);return}};R5.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var oae=P(iae=>{"use strict";var lBe=iae;lBe.Service=nae()});var aae=P((Qvt,sae)=>{"use strict";sae.exports={}});var lae=P(uae=>{"use strict";var So=uae;So.build="minimal";So.Writer=HO();So.BufferWriter=Gse();So.Reader=WO();So.BufferReader=tae();So.util=Kd();So.rpc=oae();So.roots=aae();So.configure=cae;function cae(){So.util._configure(),So.Writer._configure(So.BufferWriter),So.Reader._configure(So.BufferReader)}cae()});var QO=P((Zvt,fae)=>{"use strict";fae.exports=lae()});var hae=P((dae,C5)=>{(function(r,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof k0=="function"&&typeof C5=="object"&&C5&&C5.exports&&(C5.exports=e(QO()))})(dae,function(r){"use strict";var e=r.Reader,t=r.Writer,n=r.util,i=r.roots.default||(r.roots.default={});return i.RPC=function(){function o(a){if(this.subscriptions=[],this.messages=[],a)for(var c=Object.keys(a),u=0;u<c.length;++u)a[c[u]]!=null&&(this[c[u]]=a[c[u]])}o.prototype.subscriptions=n.emptyArray,o.prototype.messages=n.emptyArray,o.prototype.control=null;var s;return Object.defineProperty(o.prototype,"_control",{get:n.oneOfGetter(s=["control"]),set:n.oneOfSetter(s)}),o.encode=function(c,u){if(u||(u=t.create()),c.subscriptions!=null&&c.subscriptions.length)for(var l=0;l<c.subscriptions.length;++l)i.RPC.SubOpts.encode(c.subscriptions[l],u.uint32(10).fork()).ldelim();if(c.messages!=null&&c.messages.length)for(var l=0;l<c.messages.length;++l)i.RPC.Message.encode(c.messages[l],u.uint32(18).fork()).ldelim();return c.control!=null&&Object.hasOwnProperty.call(c,"control")&&i.RPC.ControlMessage.encode(c.control,u.uint32(26).fork()).ldelim(),u},o.decode=function(c,u){c instanceof e||(c=e.create(c));for(var l=u===void 0?c.len:c.pos+u,f=new i.RPC;c.pos<l;){var h=c.uint32();switch(h>>>3){case 1:f.subscriptions&&f.subscriptions.length||(f.subscriptions=[]),f.subscriptions.push(i.RPC.SubOpts.decode(c,c.uint32()));break;case 2:f.messages&&f.messages.length||(f.messages=[]),f.messages.push(i.RPC.Message.decode(c,c.uint32()));break;case 3:f.control=i.RPC.ControlMessage.decode(c,c.uint32());break;default:c.skipType(h&7);break}}return f},o.fromObject=function(c){if(c instanceof i.RPC)return c;var u=new i.RPC;if(c.subscriptions){if(!Array.isArray(c.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var l=0;l<c.subscriptions.length;++l){if(typeof c.subscriptions[l]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[l]=i.RPC.SubOpts.fromObject(c.subscriptions[l])}}if(c.messages){if(!Array.isArray(c.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var l=0;l<c.messages.length;++l){if(typeof c.messages[l]!="object")throw TypeError(".RPC.messages: object expected");u.messages[l]=i.RPC.Message.fromObject(c.messages[l])}}if(c.control!=null){if(typeof c.control!="object")throw TypeError(".RPC.control: object expected");u.control=i.RPC.ControlMessage.fromObject(c.control)}return u},o.toObject=function(c,u){u||(u={});var l={};if((u.arrays||u.defaults)&&(l.subscriptions=[],l.messages=[]),c.subscriptions&&c.subscriptions.length){l.subscriptions=[];for(var f=0;f<c.subscriptions.length;++f)l.subscriptions[f]=i.RPC.SubOpts.toObject(c.subscriptions[f],u)}if(c.messages&&c.messages.length){l.messages=[];for(var f=0;f<c.messages.length;++f)l.messages[f]=i.RPC.Message.toObject(c.messages[f],u)}return c.control!=null&&c.hasOwnProperty("control")&&(l.control=i.RPC.ControlMessage.toObject(c.control,u),u.oneofs&&(l._control="control")),l},o.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},o.SubOpts=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.subscribe=null,a.prototype.topic=null;var c;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(c=["subscribe"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(c=["topic"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.subscribe!=null&&Object.hasOwnProperty.call(l,"subscribe")&&f.uint32(8).bool(l.subscribe),l.topic!=null&&Object.hasOwnProperty.call(l,"topic")&&f.uint32(18).string(l.topic),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.SubOpts;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.subscribe=l.bool();break;case 2:d.topic=l.string();break;default:l.skipType(p&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.SubOpts)return l;var f=new i.RPC.SubOpts;return l.subscribe!=null&&(f.subscribe=!!l.subscribe),l.topic!=null&&(f.topic=String(l.topic)),f},a.toObject=function(l,f){f||(f={});var h={};return l.subscribe!=null&&l.hasOwnProperty("subscribe")&&(h.subscribe=l.subscribe,f.oneofs&&(h._subscribe="subscribe")),l.topic!=null&&l.hasOwnProperty("topic")&&(h.topic=l.topic,f.oneofs&&(h._topic="topic")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.Message=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var c;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(c=["from"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(c=["data"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(c=["seqno"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(c=["signature"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(c=["key"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.from!=null&&Object.hasOwnProperty.call(l,"from")&&f.uint32(10).bytes(l.from),l.data!=null&&Object.hasOwnProperty.call(l,"data")&&f.uint32(18).bytes(l.data),l.seqno!=null&&Object.hasOwnProperty.call(l,"seqno")&&f.uint32(26).bytes(l.seqno),f.uint32(34).string(l.topic),l.signature!=null&&Object.hasOwnProperty.call(l,"signature")&&f.uint32(42).bytes(l.signature),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&f.uint32(50).bytes(l.key),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.Message;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.from=l.bytes();break;case 2:d.data=l.bytes();break;case 3:d.seqno=l.bytes();break;case 4:d.topic=l.string();break;case 5:d.signature=l.bytes();break;case 6:d.key=l.bytes();break;default:l.skipType(p&7);break}}if(!d.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:d});return d},a.fromObject=function(l){if(l instanceof i.RPC.Message)return l;var f=new i.RPC.Message;return l.from!=null&&(typeof l.from=="string"?n.base64.decode(l.from,f.from=n.newBuffer(n.base64.length(l.from)),0):l.from.length&&(f.from=l.from)),l.data!=null&&(typeof l.data=="string"?n.base64.decode(l.data,f.data=n.newBuffer(n.base64.length(l.data)),0):l.data.length&&(f.data=l.data)),l.seqno!=null&&(typeof l.seqno=="string"?n.base64.decode(l.seqno,f.seqno=n.newBuffer(n.base64.length(l.seqno)),0):l.seqno.length&&(f.seqno=l.seqno)),l.topic!=null&&(f.topic=String(l.topic)),l.signature!=null&&(typeof l.signature=="string"?n.base64.decode(l.signature,f.signature=n.newBuffer(n.base64.length(l.signature)),0):l.signature.length&&(f.signature=l.signature)),l.key!=null&&(typeof l.key=="string"?n.base64.decode(l.key,f.key=n.newBuffer(n.base64.length(l.key)),0):l.key.length&&(f.key=l.key)),f},a.toObject=function(l,f){f||(f={});var h={};return f.defaults&&(h.topic=""),l.from!=null&&l.hasOwnProperty("from")&&(h.from=f.bytes===String?n.base64.encode(l.from,0,l.from.length):f.bytes===Array?Array.prototype.slice.call(l.from):l.from,f.oneofs&&(h._from="from")),l.data!=null&&l.hasOwnProperty("data")&&(h.data=f.bytes===String?n.base64.encode(l.data,0,l.data.length):f.bytes===Array?Array.prototype.slice.call(l.data):l.data,f.oneofs&&(h._data="data")),l.seqno!=null&&l.hasOwnProperty("seqno")&&(h.seqno=f.bytes===String?n.base64.encode(l.seqno,0,l.seqno.length):f.bytes===Array?Array.prototype.slice.call(l.seqno):l.seqno,f.oneofs&&(h._seqno="seqno")),l.topic!=null&&l.hasOwnProperty("topic")&&(h.topic=l.topic),l.signature!=null&&l.hasOwnProperty("signature")&&(h.signature=f.bytes===String?n.base64.encode(l.signature,0,l.signature.length):f.bytes===Array?Array.prototype.slice.call(l.signature):l.signature,f.oneofs&&(h._signature="signature")),l.key!=null&&l.hasOwnProperty("key")&&(h.key=f.bytes===String?n.base64.encode(l.key,0,l.key.length):f.bytes===Array?Array.prototype.slice.call(l.key):l.key,f.oneofs&&(h._key="key")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.ControlMessage=function(){function a(c){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],c)for(var u=Object.keys(c),l=0;l<u.length;++l)c[u[l]]!=null&&(this[u[l]]=c[u[l]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,l){if(l||(l=t.create()),u.ihave!=null&&u.ihave.length)for(var f=0;f<u.ihave.length;++f)i.RPC.ControlIHave.encode(u.ihave[f],l.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var f=0;f<u.iwant.length;++f)i.RPC.ControlIWant.encode(u.iwant[f],l.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var f=0;f<u.graft.length;++f)i.RPC.ControlGraft.encode(u.graft[f],l.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var f=0;f<u.prune.length;++f)i.RPC.ControlPrune.encode(u.prune[f],l.uint32(34).fork()).ldelim();return l},a.decode=function(u,l){u instanceof e||(u=e.create(u));for(var f=l===void 0?u.len:u.pos+l,h=new i.RPC.ControlMessage;u.pos<f;){var d=u.uint32();switch(d>>>3){case 1:h.ihave&&h.ihave.length||(h.ihave=[]),h.ihave.push(i.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:h.iwant&&h.iwant.length||(h.iwant=[]),h.iwant.push(i.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:h.graft&&h.graft.length||(h.graft=[]),h.graft.push(i.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:h.prune&&h.prune.length||(h.prune=[]),h.prune.push(i.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(d&7);break}}return h},a.fromObject=function(u){if(u instanceof i.RPC.ControlMessage)return u;var l=new i.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");l.ihave=[];for(var f=0;f<u.ihave.length;++f){if(typeof u.ihave[f]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");l.ihave[f]=i.RPC.ControlIHave.fromObject(u.ihave[f])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");l.iwant=[];for(var f=0;f<u.iwant.length;++f){if(typeof u.iwant[f]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");l.iwant[f]=i.RPC.ControlIWant.fromObject(u.iwant[f])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");l.graft=[];for(var f=0;f<u.graft.length;++f){if(typeof u.graft[f]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");l.graft[f]=i.RPC.ControlGraft.fromObject(u.graft[f])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");l.prune=[];for(var f=0;f<u.prune.length;++f){if(typeof u.prune[f]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");l.prune[f]=i.RPC.ControlPrune.fromObject(u.prune[f])}}return l},a.toObject=function(u,l){l||(l={});var f={};if((l.arrays||l.defaults)&&(f.ihave=[],f.iwant=[],f.graft=[],f.prune=[]),u.ihave&&u.ihave.length){f.ihave=[];for(var h=0;h<u.ihave.length;++h)f.ihave[h]=i.RPC.ControlIHave.toObject(u.ihave[h],l)}if(u.iwant&&u.iwant.length){f.iwant=[];for(var h=0;h<u.iwant.length;++h)f.iwant[h]=i.RPC.ControlIWant.toObject(u.iwant[h],l)}if(u.graft&&u.graft.length){f.graft=[];for(var h=0;h<u.graft.length;++h)f.graft[h]=i.RPC.ControlGraft.toObject(u.graft[h],l)}if(u.prune&&u.prune.length){f.prune=[];for(var h=0;h<u.prune.length;++h)f.prune[h]=i.RPC.ControlPrune.toObject(u.prune[h],l)}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){if(f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),l.messageIDs!=null&&l.messageIDs.length)for(var h=0;h<l.messageIDs.length;++h)f.uint32(18).bytes(l.messageIDs[h]);return f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlIHave;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.topicID=l.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(l.bytes());break;default:l.skipType(p&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlIHave)return l;var f=new i.RPC.ControlIHave;if(l.topicID!=null&&(f.topicID=String(l.topicID)),l.messageIDs){if(!Array.isArray(l.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");f.messageIDs=[];for(var h=0;h<l.messageIDs.length;++h)typeof l.messageIDs[h]=="string"?n.base64.decode(l.messageIDs[h],f.messageIDs[h]=n.newBuffer(n.base64.length(l.messageIDs[h])),0):l.messageIDs[h].length&&(f.messageIDs[h]=l.messageIDs[h])}return f},a.toObject=function(l,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.messageIDs=[]),l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),l.messageIDs&&l.messageIDs.length){h.messageIDs=[];for(var d=0;d<l.messageIDs.length;++d)h.messageIDs[d]=f.bytes===String?n.base64.encode(l.messageIDs[d],0,l.messageIDs[d].length):f.bytes===Array?Array.prototype.slice.call(l.messageIDs[d]):l.messageIDs[d]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.ControlIWant=function(){function a(c){if(this.messageIDs=[],c)for(var u=Object.keys(c),l=0;l<u.length;++l)c[u[l]]!=null&&(this[u[l]]=c[u[l]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,l){if(l||(l=t.create()),u.messageIDs!=null&&u.messageIDs.length)for(var f=0;f<u.messageIDs.length;++f)l.uint32(10).bytes(u.messageIDs[f]);return l},a.decode=function(u,l){u instanceof e||(u=e.create(u));for(var f=l===void 0?u.len:u.pos+l,h=new i.RPC.ControlIWant;u.pos<f;){var d=u.uint32();switch(d>>>3){case 1:h.messageIDs&&h.messageIDs.length||(h.messageIDs=[]),h.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return h},a.fromObject=function(u){if(u instanceof i.RPC.ControlIWant)return u;var l=new i.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");l.messageIDs=[];for(var f=0;f<u.messageIDs.length;++f)typeof u.messageIDs[f]=="string"?n.base64.decode(u.messageIDs[f],l.messageIDs[f]=n.newBuffer(n.base64.length(u.messageIDs[f])),0):u.messageIDs[f].length&&(l.messageIDs[f]=u.messageIDs[f])}return l},a.toObject=function(u,l){l||(l={});var f={};if((l.arrays||l.defaults)&&(f.messageIDs=[]),u.messageIDs&&u.messageIDs.length){f.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)f.messageIDs[h]=l.bytes===String?n.base64.encode(u.messageIDs[h],0,u.messageIDs[h].length):l.bytes===Array?Array.prototype.slice.call(u.messageIDs[h]):u.messageIDs[h]}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.ControlGraft=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlGraft;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.topicID=l.string();break;default:l.skipType(p&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlGraft)return l;var f=new i.RPC.ControlGraft;return l.topicID!=null&&(f.topicID=String(l.topicID)),f},a.toObject=function(l,f){f||(f={});var h={};return l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(c=["backoff"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){if(f||(f=t.create()),l.topicID!=null&&Object.hasOwnProperty.call(l,"topicID")&&f.uint32(10).string(l.topicID),l.peers!=null&&l.peers.length)for(var h=0;h<l.peers.length;++h)i.RPC.PeerInfo.encode(l.peers[h],f.uint32(18).fork()).ldelim();return l.backoff!=null&&Object.hasOwnProperty.call(l,"backoff")&&f.uint32(24).uint64(l.backoff),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.ControlPrune;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.topicID=l.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(i.RPC.PeerInfo.decode(l,l.uint32()));break;case 3:d.backoff=l.uint64();break;default:l.skipType(p&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.ControlPrune)return l;var f=new i.RPC.ControlPrune;if(l.topicID!=null&&(f.topicID=String(l.topicID)),l.peers){if(!Array.isArray(l.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");f.peers=[];for(var h=0;h<l.peers.length;++h){if(typeof l.peers[h]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");f.peers[h]=i.RPC.PeerInfo.fromObject(l.peers[h])}}return l.backoff!=null&&(n.Long?(f.backoff=n.Long.fromValue(l.backoff)).unsigned=!0:typeof l.backoff=="string"?f.backoff=parseInt(l.backoff,10):typeof l.backoff=="number"?f.backoff=l.backoff:typeof l.backoff=="object"&&(f.backoff=new n.LongBits(l.backoff.low>>>0,l.backoff.high>>>0).toNumber(!0))),f},a.toObject=function(l,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.peers=[]),l.topicID!=null&&l.hasOwnProperty("topicID")&&(h.topicID=l.topicID,f.oneofs&&(h._topicID="topicID")),l.peers&&l.peers.length){h.peers=[];for(var d=0;d<l.peers.length;++d)h.peers[d]=i.RPC.PeerInfo.toObject(l.peers[d],f)}return l.backoff!=null&&l.hasOwnProperty("backoff")&&(typeof l.backoff=="number"?h.backoff=f.longs===String?String(l.backoff):l.backoff:h.backoff=f.longs===String?n.Long.prototype.toString.call(l.backoff):f.longs===Number?new n.LongBits(l.backoff.low>>>0,l.backoff.high>>>0).toNumber(!0):l.backoff,f.oneofs&&(h._backoff="backoff")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o.PeerInfo=function(){function a(u){if(u)for(var l=Object.keys(u),f=0;f<l.length;++f)u[l[f]]!=null&&(this[l[f]]=u[l[f]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var c;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(c=["peerID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(c=["signedPeerRecord"]),set:n.oneOfSetter(c)}),a.encode=function(l,f){return f||(f=t.create()),l.peerID!=null&&Object.hasOwnProperty.call(l,"peerID")&&f.uint32(10).bytes(l.peerID),l.signedPeerRecord!=null&&Object.hasOwnProperty.call(l,"signedPeerRecord")&&f.uint32(18).bytes(l.signedPeerRecord),f},a.decode=function(l,f){l instanceof e||(l=e.create(l));for(var h=f===void 0?l.len:l.pos+f,d=new i.RPC.PeerInfo;l.pos<h;){var p=l.uint32();switch(p>>>3){case 1:d.peerID=l.bytes();break;case 2:d.signedPeerRecord=l.bytes();break;default:l.skipType(p&7);break}}return d},a.fromObject=function(l){if(l instanceof i.RPC.PeerInfo)return l;var f=new i.RPC.PeerInfo;return l.peerID!=null&&(typeof l.peerID=="string"?n.base64.decode(l.peerID,f.peerID=n.newBuffer(n.base64.length(l.peerID)),0):l.peerID.length&&(f.peerID=l.peerID)),l.signedPeerRecord!=null&&(typeof l.signedPeerRecord=="string"?n.base64.decode(l.signedPeerRecord,f.signedPeerRecord=n.newBuffer(n.base64.length(l.signedPeerRecord)),0):l.signedPeerRecord.length&&(f.signedPeerRecord=l.signedPeerRecord)),f},a.toObject=function(l,f){f||(f={});var h={};return l.peerID!=null&&l.hasOwnProperty("peerID")&&(h.peerID=f.bytes===String?n.base64.encode(l.peerID,0,l.peerID.length):f.bytes===Array?Array.prototype.slice.call(l.peerID):l.peerID,f.oneofs&&(h._peerID="peerID")),l.signedPeerRecord!=null&&l.hasOwnProperty("signedPeerRecord")&&(h.signedPeerRecord=f.bytes===String?n.base64.encode(l.signedPeerRecord,0,l.signedPeerRecord.length):f.bytes===Array?Array.prototype.slice.call(l.signedPeerRecord):l.signedPeerRecord,f.oneofs&&(h._signedPeerRecord="signedPeerRecord")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),o}(),i})});var Sae=P((S9t,xae)=>{"use strict";function un(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}un.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};un.prototype.get=function(e){return this.peekAt(e)};un.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};un.prototype.peekFront=function(){return this.peek()};un.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(un.prototype,"length",{get:function(){return this.size()}});un.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};un.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};un.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};un.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};un.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};un.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var o=this._list[t],s;if(e<n/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(s=n-1-e;s>0;s--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return o}}};un.prototype.remove=function(e,t){var n=e,i,o=t;if(n===(n|0)&&this._head!==this._tail){var s=this.size(),a=this._list.length;if(!(n>=s||n<-s||t<1)){if(n<0&&(n+=s),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=s)return i=this.toArray(),this.clear(),i;n+t>s&&(t=s-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===s){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<s/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;o>0;)this._list[n=n-1+a&this._capacityMask]=void 0,o--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=s-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;o>0;)this._list[n=n+1+a&this._capacityMask]=void 0,o--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};un.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var o,s,a,c=arguments.length,u=this._list.length,l=2;if(!i||n<i/2){for(s=new Array(n),o=0;o<n;o++)s[o]=this._list[this._head+o&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+u&this._capacityMask);c>l;)this.unshift(arguments[--c]);for(o=n;o>0;o--)this.unshift(s[o-1])}else{s=new Array(i-(n+t));var f=s.length;for(o=0;o<f;o++)s[o]=this._list[this._head+n+t+o&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-f+u&this._capacityMask);l<c;)this.push(arguments[l++]);for(o=0;o<f;o++)this.push(s[o])}return a}else return this.remove(n,t)}};un.prototype.clear=function(){this._head=0,this._tail=0};un.prototype.isEmpty=function(){return this._head===this._tail};un.prototype.toArray=function(){return this._copyArray(!1)};un.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};un.prototype._copyArray=function(e){var t=[],n=this._list,i=n.length,o;if(e||this._head>this._tail){for(o=this._head;o<i;o++)t.push(n[o]);for(o=0;o<this._tail;o++)t.push(n[o])}else for(o=this._head;o<this._tail;o++)t.push(n[o]);return t};un.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};un.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};xae.exports=un});var fue=P((rPt,lue)=>{lue.exports=r=>{if(r[Symbol.asyncIterator])return r;if(r.getReader)return async function*(){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")}});var dL=P((ZBt,Jle)=>{"use strict";var oUe=O1(),sUe=(r,e)=>({path:decodeURIComponent(new URL(r).pathname.split("/").pop()||""),content:aUe(r,e)});async function*aUe(r,e){yield*(await new oUe().get(r,e)).iterator()}Jle.exports=sUe});var r9=P((PFt,Nfe)=>{"use strict";function FUe(r){let e=new Uint8Array(r),t=0;if(r>0)if(r>65536)for(;t<r;)t+65536>r?(crypto.getRandomValues(e.subarray(t,t+(r-t))),t+=r-t):(crypto.getRandomValues(e.subarray(t,t+65536)),t+=65536);else crypto.getRandomValues(e);return e}Nfe.exports=FUe});var RL=P((DFt,IL)=>{"use strict";var VUe=(r,e)=>Math.floor(Math.random()*(e-r+1)+r),Lfe=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},Bfe=({clearTimeout:r,setTimeout:e,willResolve:t})=>(n,{value:i,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(Lfe());let s,a,c,u=r||clearTimeout,l=()=>{u(s),c(Lfe())},f=()=>{o&&o.removeEventListener("abort",l)},h=new Promise((d,p)=>{a=()=>{f(),t?d(i):p(i)},c=p,s=(e||setTimeout)(a,n)});return o&&o.addEventListener("abort",l,{once:!0}),h.clear=()=>{u(s),s=null,a()},h},Mfe=r=>{let e=Bfe({...r,willResolve:!0});return e.reject=Bfe({...r,willResolve:!1}),e.range=(t,n,i)=>e(VUe(t,n),i),e},TL=Mfe();TL.createWithTimers=Mfe;IL.exports=TL;IL.exports.default=TL});var FL=P((mVt,tde)=>{"use strict";var Q2=new Map,eFe=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function tFe(r,e,t){for(;Q2.get(t);){try{await r()}catch(n){setTimeout(()=>{throw n},1);break}if(!Q2.get(t))break;await new Promise(n=>{let i=setTimeout(n,e);Q2.set(t,i)})}}function rFe(r,e,t){t=t||e;let n=eFe(),i=setTimeout(()=>{tFe(r,e,n)},t);return Q2.set(n,i),n}function nFe(r){let e=Q2.get(r);e&&(clearTimeout(e),Q2.delete(r))}tde.exports={setDelayedInterval:rFe,clearDelayedInterval:nFe}});var o4=P((iKt,ade)=>{ade.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:!!e}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}});var ude=P((sKt,cde)=>{cde.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){let t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();let n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}}});var fde=P((aKt,lde)=>{var aFe=ude();lde.exports=aFe});var ys=P((uKt,dde)=>{dde.exports=class{constructor(e,t,n,i){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof i>"u"?!1:i}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=!!e}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}});var Z2=P((fKt,pde)=>{var VL=o4(),cFe=fde(),hde=ys();pde.exports=class extends VL{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new cFe}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,i,o,s={}){let a=this._getRateLimiterRes(n,i,o);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+i&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(u=>{t(u)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,i,o,s=!1,a={}){this.insuranceLimiter instanceof VL?this.insuranceLimiter[t](o,s,a).then(c=>{n(c)}).catch(c=>{i(c)}):i(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof VL))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){let i=t*1e3;return this._block(this.getKey(e),this.points+1,i,n)}set(e,t,n,i={}){let o=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,o,i)}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(s);if(a>0)return o(new hde(0,a));this._upsert(s,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(i,o,s,t,c)}).catch(c=>{this._handleError(c,"consume",i,o,e,t,n)})})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise((o,s)=>{this._upsert(i,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{o(this._getRateLimiterRes(i,t,a))}).catch(a=>{this._handleError(a,"penalty",o,s,e,t,n)})})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise((o,s)=>{this._upsert(i,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{o(this._getRateLimiterRes(i,-t,a))}).catch(a=>{this._handleError(a,"reward",o,s,e,t,n)})})}get(e,t={}){let n=this.getKey(e);return new Promise((i,o)=>{this._get(n,t).then(s=>{i(s===null||typeof s>"u"?null:this._getRateLimiterRes(n,0,s))}).catch(s=>{this._handleError(s,"get",i,o,e,t)})})}delete(e,t={}){let n=this.getKey(e);return new Promise((i,o)=>{this._delete(n,t).then(s=>{this._inMemoryBlockedKeys.delete(n),i(s)}).catch(s=>{this._handleError(s,"delete",i,o,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,i={}){return new Promise((o,s)=>{this._upsert(e,t,n,!0,i).then(()=>{o(new hde(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",o,s,this.parseKey(e),n/1e3,i)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,i=!1,o={}){throw new Error("You have to implement the method '_upsert'!")}}});var yde=P((dKt,gde)=>{var uFe=Z2(),lFe=ys(),mde="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ",KL=class extends uFe{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:mde})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[i,o]=n;Array.isArray(i)&&([,i]=i,[,o]=o);let s=new lFe;return s.consumedPoints=parseInt(i),s.isFirstInDuration=s.consumedPoints===t,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=o,s}_upsert(e,t,n,i=!1){return new Promise((o,s)=>{if(!this._isRedisReady())return s(new Error("Redis connection is not ready"));let a=Math.floor(n/1e3),c=this.client.multi();if(i)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((u,l)=>u?s(u):o(l));else if(a>0){let u=function(l,f){return l?s(l):o(f)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,u):this.client.eval(mde,1,e,t,a,u)}else c.incrby(e,t).pttl(e).exec((u,l)=>u?s(u):o(l))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((i,o)=>{if(i)n(i);else{let[s]=o;if(s===null)return t(null);t(o)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,o)=>{i?n(i):t(o>0)})})}};gde.exports=KL});var _de=P((hKt,bde)=>{var fFe=Z2(),dFe=ys();function wde(r){try{let e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(i=>parseInt(i));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}var s4=class extends fFe{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=wde(this.client)}):(this._initCollection(),this._driverVersion=wde(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?s4.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){let t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){let i=new dFe,o;return typeof n.value>"u"?o=n:o=n.value,i.isFirstInDuration=o.points===t,i.consumedPoints=o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire!==null?Math.max(new Date(o.expire).getTime()-Date.now(),0):-1,i}_upsert(e,t,n,i=!1,o={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let s=o.attrs||{},a,c;i?(a={key:e},a=Object.assign(a,s),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,s)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,s),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,s));let u={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?u.returnDocument="after":u.returnOriginal=!1,new Promise((l,f)=>{this._collection.findOneAndUpdate(a,c,u).then(h=>{l(h)}).catch(h=>{if(h&&h.code===11e3){let d=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),p={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},s)};this._collection.findOneAndUpdate(d,p,u).then(g=>{l(g)}).catch(g=>{g&&g.code===11e3?this._upsert(e,t,n,i).then(w=>l(w)).catch(w=>f(w)):f(g)})}else f(h)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(i)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e},n);return this._collection.deleteOne(i).then(o=>o.deletedCount>0)}};bde.exports=s4});var vde=P((pKt,Ede)=>{var hFe=Z2(),pFe=ys(),$L=class extends hFe{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,i)=>{if(n)return t(n);e(i)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,i=>{if(i)return this._releaseConnection(n),t(i);n.query(this._getCreateTableStmt(),o=>{if(o)return this._releaseConnection(n),t(o);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let i=new pFe,[o]=n;return i.isFirstInDuration=t===o.points,i.consumedPoints=i.isFirstInDuration?t:o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire?Math.max(o.expire-Date.now(),0):-1,i}_upsertTransaction(e,t,n,i,o){return new Promise((s,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);let u=Date.now(),l=i>0?u+i:null,f,h;o?(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,h=[this.dbName,this.tableName,t,n,l,n,l]):(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,h=[this.dbName,this.tableName,t,n,l,u,n,n,u,l]),e.query(f,h,d=>{if(d)return e.rollback(),a(d);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(p,g)=>{if(p)return e.rollback(),a(p);e.query("COMMIT",w=>{if(w)return e.rollback(),a(w);s(g)})})})})})}_upsert(e,t,n,i=!1){return this.tableCreated?new Promise((o,s)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,i).then(c=>{o(c),this._releaseConnection(a)}).catch(c=>{s(c),this._releaseConnection(a)})}).catch(a=>{s(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(o,s)=>{o?n(o):s.length===0?t(null):t(s),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(o,s)=>{o?n(o):t(s.affectedRows>0),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}};Ede.exports=$L});var Sde=P((mKt,xde)=>{var mFe=Z2(),gFe=ys(),qL=class extends mFe{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{let n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){let t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let i=new gFe,o=n.rows[0];return i.isFirstInDuration=t===o.points,i.consumedPoints=i.isFirstInDuration?t:o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire?Math.max(o.expire-Date.now(),0):-1,i}_query(e){let n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((i,o)=>{this._getConnection().then(s=>{s.query(n).then(a=>{i(a),this._releaseConnection(s)}).catch(a=>{o(a),this._releaseConnection(s)})}).catch(s=>{o(s)})})}_upsert(e,t,n,i=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let o=n>0?Date.now()+n:null,s=i?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:i?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${i?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${s}
            RETURNING points, expire;`,values:[e,t,o,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(i=>{i.rowCount===0&&(i=null),t(i)}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};xde.exports=qL});var HL=P(()=>{});var Tde=P((bKt,Ade)=>{Ade.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}});var Rde=P((EKt,Ide)=>{var yFe=Tde(),GL=ys();Ide.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){let i=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return i!==0?(this._storage[e].value=this._storage[e].value+t,new GL(0,i,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let i=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new yFe(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new GL(0,i===0?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){let t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new GL(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}}});var WL=P((vKt,Pde)=>{var wFe=o4(),bFe=Rde(),Cde=ys(),jL=class extends wFe{constructor(e={}){super(e),this._memoryStorage=new bFe}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=this.getKey(e),a=this._getKeySecDuration(n),c=this._memoryStorage.incrby(s,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(s,c.consumedPoints,this.blockDuration)),o(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(i,u,c)}else i(c)})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise(o=>{let s=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,t,s);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),o(a)})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise(o=>{let s=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,-t,s);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),o(a)})}block(e,t){let n=t*1e3,i=this.points+1;return this._memoryStorage.set(this.getKey(e),i,t),Promise.resolve(new Cde(0,n===0?-1:n,i))}set(e,t,n){let i=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new Cde(0,i===0?-1:i,t))}get(e){let t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};Pde.exports=jL});var Mde=P((xKt,Bde)=>{var kde=HL(),_Fe=Ju(),EFe=o4(),Dde=WL(),vFe=ys(),ca="rate_limiter_flexible",tg=null,Nde=function(r,e,t,n){let i;n===null||n===!0||n===!1?i=n:i={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:ca,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:i})},Ode=function(r){setTimeout(()=>{this._initiated?process.send(r):typeof this._promises[r.promiseId]<"u"&&Ode.call(this,r)},30)},J2=function(r,e,t,n,i){let o={channel:ca,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:i}};this._initiated?process.send(o):Ode.call(this,o)},Lde=function(r,e){if(!e||e.channel!==ca||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{Nde(r,e,"resolve",n)}).catch(n=>{Nde(r,e,"reject",n)})},xFe=function(r){if(!r||r.channel!==ca||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new vFe(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},SFe=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},eg=function(r,e){let t=process.hrtime(),n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=_Fe.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n},YL=class{constructor(){if(tg)return tg;this._rateLimiters={},kde.setMaxListeners(0),kde.on("message",(e,t)=>{t&&t.channel===ca&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new Dde(t.opts)),e.send({channel:ca,type:"init",keyPrefix:t.opts.keyPrefix})):Lde.call(this,e,t)}),tg=this}},QL=class{constructor(e){if(tg)return tg;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",i=>{let o=i.raw;if(o&&o.channel===ca&&o.type==="init")typeof this._rateLimiters[o.opts.keyPrefix]>"u"&&(this._rateLimiters[o.opts.keyPrefix]=new Dde(o.opts)),e.sendDataToProcessId(i.process.pm_id,{data:{},topic:ca,channel:ca,type:"init",keyPrefix:o.opts.keyPrefix},(s,a)=>{s&&console.log(s,a)});else{let s={send:a=>{let c=a;c.topic=ca,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(i.process.pm_id,c,(u,l)=>{u&&console.log(u,l)})}};Lde.call(this,s,o)}})}),tg=this}},XL=class extends EFe{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",t=>{t&&t.channel===ca&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:xFe.call(this,t)}),process.send({channel:ca,type:"init",opts:SFe.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=eg.call(this,i,o);J2.call(this,"consume",s,e,t,n)})}penalty(e,t=1,n={}){return new Promise((i,o)=>{let s=eg.call(this,i,o);J2.call(this,"penalty",s,e,t,n)})}reward(e,t=1,n={}){return new Promise((i,o)=>{let s=eg.call(this,i,o);J2.call(this,"reward",s,e,t,n)})}block(e,t,n={}){return new Promise((i,o)=>{let s=eg.call(this,i,o);J2.call(this,"block",s,e,t,n)})}get(e,t={}){return new Promise((n,i)=>{let o=eg.call(this,n,i);J2.call(this,"get",o,e,t)})}delete(e,t={}){return new Promise((n,i)=>{let o=eg.call(this,n,i);J2.call(this,"delete",o,e,t)})}};Bde.exports={RateLimiterClusterMaster:YL,RateLimiterClusterMasterPM2:QL,RateLimiterCluster:XL}});var Fde=P((SKt,Ude)=>{var AFe=Z2(),TFe=ys(),ZL=class extends AFe{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){let i=new TFe;return i.consumedPoints=parseInt(n.consumedPoints),i.isFirstInDuration=n.consumedPoints===t,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=n.msBeforeNext,i}_upsert(e,t,n,i=!1,o={}){return new Promise((s,a)=>{let c=Date.now(),u=Math.floor(n/1e3);i?this.client.set(e,t,u,l=>{l?a(l):this.client.set(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let f={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};s(f)})}):this.client.incr(e,t,(l,f)=>{l||f===!1?this.client.add(e,t,u,(h,d)=>{if(h||!d)if(typeof o.attemptNumber>"u"||o.attemptNumber<3){let p=Object.assign({},o);p.attemptNumber=p.attemptNumber?p.attemptNumber+1:1,this._upsert(e,t,n,i,p).then(g=>s(g)).catch(g=>a(g))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let p={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};s(p)})}):this.client.get(`${e}_expire`,(h,d)=>{if(h)a(h);else{let p=d===!1?0:d,g={consumedPoints:f,msBeforeNext:p>=0?Math.max(p-c,0):-1};s(g)}})})})}_get(e){return new Promise((t,n)=>{let i=Date.now();this.client.get(e,(o,s)=>{s?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{let u=c===!1?0:c,l={consumedPoints:s,msBeforeNext:u>=0?Math.max(u-i,0):-1};t(l)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,o)=>{i?n(i):o===!1?t(o):this.client.del(`${e}_expire`,s=>{s?n(s):t(o)})})})}};Ude.exports=ZL});var Kde=P((TKt,Vde)=>{var zde=ys();Vde.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new zde(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new zde(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}});var qde=P((RKt,$de)=>{var IFe=o4();$de.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof IFe))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,i)=>{let o=[];this._limiters.forEach(s=>{o.push(s.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(o).then(s=>{let a={},c=!1;s.forEach(u=>{u.rejected===!0&&(c=!0)});for(let u=0;u<s.length;u++)c&&s[u].rejected===!0?a[this._limiters[u].keyPrefix]=s[u].rej:c||(a[this._limiters[u].keyPrefix]=s[u]);c?i(a):n(a)})})}}});var Gde=P((PKt,Hde)=>{Hde.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}});var Qde=P((NKt,Yde)=>{var jde=Gde(),Wde=4294967295,JL="limiter";Yde.exports=class{constructor(e,t={maxQueueSize:Wde}){this._queueLimiters={KEY_DEFAULT:new b9(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=JL){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=JL){return this._queueLimiters[t]||(this._queueLimiters[t]=new b9(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};var b9=class{constructor(e,t={maxQueueSize:Wde,key:JL}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){let t=this;return new Promise((n,i)=>{if(e>t._limiterFlexible.points){i(new jde(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,i,e):t._limiterFlexible.consume(t._key,e).then(o=>{n(o.remainingPoints)}).catch(o=>{o instanceof Error?i(o):(t._queueRequest.call(t,n,i,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),o.msBeforeNext)))})})}_queueRequest(e,t,n){let i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:n}):t(new jde(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){let e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;let t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}});var Zde=P((OKt,Xde)=>{var eB=ys();Xde.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new eB(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(i=>i instanceof eB?this._burstLimiter.consume(e,t,n).then(o=>Promise.resolve(this._combineRes(i,o))).catch(o=>o instanceof eB?Promise.reject(this._combineRes(i,o)):Promise.reject(o)):Promise.reject(i))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}}});var ehe=P((LKt,Jde)=>{var RFe=yde(),CFe=_de(),PFe=vde(),kFe=Sde(),{RateLimiterClusterMaster:NFe,RateLimiterClusterMasterPM2:DFe,RateLimiterCluster:OFe}=Mde(),LFe=WL(),BFe=Fde(),MFe=Kde(),UFe=qde(),FFe=Qde(),zFe=Zde(),VFe=ys();Jde.exports={RateLimiterRedis:RFe,RateLimiterMongo:CFe,RateLimiterMySQL:PFe,RateLimiterPostgres:kFe,RateLimiterMemory:LFe,RateLimiterMemcache:BFe,RateLimiterClusterMaster:NFe,RateLimiterClusterMasterPM2:DFe,RateLimiterCluster:OFe,RLWrapperBlackAndWhite:MFe,RateLimiterUnion:UFe,RateLimiterQueue:FFe,BurstyRateLimiter:zFe,RateLimiterRes:VFe}});var dB=P(u4=>{(function(){var r,e,t,n,i,o,s,a;a=function(c){var u,l,f,h;return u=(c&255<<24)>>>24,l=(c&255<<16)>>>16,f=(c&65280)>>>8,h=c&255,[u,l,f,h].join(".")},s=function(c){var u,l,f,h,d,p;for(u=[],f=h=0;h<=3&&c.length!==0;f=++h){if(f>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}p=e(c),d=p[0],l=p[1],c=c.substring(l),u.push(d)}if(c.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),o=t("a"),i=t("A"),e=function(c){var u,l,f,h,d;for(h=0,u=10,l="9",f=0,c.length>1&&c[f]==="0"&&(c[f+1]==="x"||c[f+1]==="X"?(f+=2,u=16):"0"<=c[f+1]&&c[f+1]<="9"&&(f++,u=8,l="7")),d=f;f<c.length;){if("0"<=c[f]&&c[f]<=l)h=h*u+(t(c[f])-n)>>>0;else if(u===16)if("a"<=c[f]&&c[f]<="f")h=h*u+(10+t(c[f])-o)>>>0;else if("A"<=c[f]&&c[f]<="F")h=h*u+(10+t(c[f])-i)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");f++}if(f===d)throw new Error("empty octet");return[h,f]},r=function(){function c(u,l){var f,h,d,p;if(typeof u!="string")throw new Error("Missing `net' parameter");if(l||(p=u.split("/",2),u=p[0],l=p[1]),l||(l=32),typeof l=="string"&&l.indexOf(".")>-1){try{this.maskLong=s(l)}catch(g){throw f=g,new Error("Invalid mask: "+l)}for(h=d=32;d>=0;h=--d)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(l||l===0)this.bitmask=parseInt(l,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(s(u)&this.maskLong)>>>0}catch(g){throw f=g,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+l);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new c(u)),u instanceof c?this.contains(u.base)&&this.contains(u.broadcast||u.last):(s(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(u){return u==null&&(u=1),new c(a(this.netLong+this.size*u),this.mask)},c.prototype.forEach=function(u){var l,f,h;for(h=s(this.first),f=s(this.last),l=0;h<=f;)u(a(h),h,l),l++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),u4.ip2long=s,u4.long2ip=a,u4.Netmask=r}).call(u4)});var _he=P((bhe,N9)=>{(function(r){"use strict";let e="(0?\\d+|0x[a-f0-9]+)",t={fourOctet:new RegExp(`^${e}\\.${e}\\.${e}\\.${e}$`,"i"),threeOctet:new RegExp(`^${e}\\.${e}\\.${e}$`,"i"),twoOctet:new RegExp(`^${e}\\.${e}$`,"i"),longValue:new RegExp(`^${e}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",s="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${s})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${e}\\.${e}\\.${e}\\.${e}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${s})|(?:::)(?:${s})?)${e}\\.${e}\\.${e}\\.${e}(${o})?$`,"i")};function c(d,p){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let g=0,w=-1,_=(d.match(a.zoneIndex)||[])[0],x,m;for(_&&(_=_.substring(1),d=d.replace(/%.+$/,""));(w=d.indexOf(":",w+1))>=0;)g++;if(d.substr(0,2)==="::"&&g--,d.substr(-2,2)==="::"&&g--,g>p)return null;for(m=p-g,x=":";m--;)x+="0:";return d=d.replace("::",x),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),p=function(){let y=d.split(":"),b=[];for(let E=0;E<y.length;E++)b.push(parseInt(y[E],16));return b}(),{parts:p,zoneId:_}}function u(d,p,g,w){if(d.length!==p.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let _=0,x;for(;w>0;){if(x=g-w,x<0&&(x=0),d[_]>>x!==p[_]>>x)return!1;w-=g,_+=1}return!0}function l(d){if(i.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(n.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function f(d,p){for(;d.length<p;)d=`0${d}`;return d}let h={};h.IPv4=function(){function d(p){if(p.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let g,w;for(g=0;g<p.length;g++)if(w=p[g],!(0<=w&&w<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=p}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(p,g){let w;if(g===void 0&&(w=p,p=w[0],g=w[1]),p.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,p.octets,8,g)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,g=!1,w={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},_,x,m;for(_=3;_>=0;_-=1)if(x=this.octets[_],x in w){if(m=w[x],g&&m!==0)return null;m!==8&&(g=!0),p+=m}else return null;return 32-p},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),h.IPv4.broadcastAddressFromCIDR=function(d){try{let p=this.parseCIDR(d),g=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],x=0;for(;x<4;)_.push(parseInt(g[x],10)|parseInt(w[x],10)^255),x++;return new this(_)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(d){return this.parser(d)!==null},h.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},h.IPv4.isValidFourPartDecimal=function(d){return!!(h.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(d){let p,g,w,_,x;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),x=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],g=0;g<4;)_.push(parseInt(w[g],10)&parseInt(x[g],10)),g++;return new this(_)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(d){let p=this.parser(d);if(p===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(p)},h.IPv4.parseCIDR=function(d){let p;if(p=d.match(/^(.+)\/(\d+)$/)){let g=parseInt(p[2]);if(g>=0&&g<=32){let w=[this.parse(p[1]),g];return Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(d){let p,g,w;if(p=d.match(t.fourOctet))return function(){let _=p.slice(1,6),x=[];for(let m=0;m<_.length;m++)g=_[m],x.push(l(g));return x}();if(p=d.match(t.longValue)){if(w=l(p[1]),w>4294967295||w<0)throw new Error("ipaddr: address outside defined range");return function(){let _=[],x;for(x=0;x<=24;x+=8)_.push(w>>x&255);return _}().reverse()}else return(p=d.match(t.twoOctet))?function(){let _=p.slice(1,4),x=[];if(w=l(_[1]),w>16777215||w<0)throw new Error("ipaddr: address outside defined range");return x.push(l(_[0])),x.push(w>>16&255),x.push(w>>8&255),x.push(w&255),x}():(p=d.match(t.threeOctet))?function(){let _=p.slice(1,5),x=[];if(w=l(_[2]),w>65535||w<0)throw new Error("ipaddr: address outside defined range");return x.push(l(_[0])),x.push(l(_[1])),x.push(w>>8&255),x.push(w&255),x}():null},h.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");let p=[0,0,0,0],g=0,w=Math.floor(d/8);for(;g<w;)p[g]=255,g++;return w<4&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},h.IPv6=function(){function d(p,g){let w,_;if(p.length===16)for(this.parts=[],w=0;w<=14;w+=2)this.parts.push(p[w]<<8|p[w+1]);else if(p.length===8)this.parts=p;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(w=0;w<this.parts.length;w++)if(_=this.parts[w],!(0<=_&&_<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");g&&(this.zoneId=g)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],reserved:[[new d([8193,3512,0,0,0,0,0,0]),32]]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(p,g){let w;if(g===void 0&&(w=p,p=w[0],g=w[1]),p.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,p.parts,16,g)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,g=!1,w={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},_,x;for(let m=7;m>=0;m-=1)if(_=this.parts[m],_ in w){if(x=w[_],g&&x!==0)return null;x!==16&&(g=!0),p+=x}else return null;return 128-p},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let p,g=[],w=this.parts;for(let _=0;_<w.length;_++)p=w[_],g.push(p>>8),g.push(p&255);return g},d.prototype.toFixedLengthString=function(){let p=function(){let w=[];for(let _=0;_<this.parts.length;_++)w.push(f(this.parts[_].toString(16),4));return w}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),p+g},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let p=this.parts.slice(-2),g=p[0],w=p[1];return new h.IPv4([g>>8,g&255,w>>8,w&255])},d.prototype.toNormalizedString=function(){let p=function(){let w=[];for(let _=0;_<this.parts.length;_++)w.push(this.parts[_].toString(16));return w}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),p+g},d.prototype.toRFC5952String=function(){let p=/((^|:)(0(:|$)){2,})/g,g=this.toNormalizedString(),w=0,_=-1,x;for(;x=p.exec(g);)x[0].length>_&&(w=x.index,_=x[0].length);return _<0?g:`${g.substring(0,w)}::${g.substring(w+_)}`},d.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},d}(),h.IPv6.broadcastAddressFromCIDR=function(d){try{let p=this.parseCIDR(d),g=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],x=0;for(;x<16;)_.push(parseInt(g[x],10)|parseInt(w[x],10)^255),x++;return new this(_)}catch(p){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${p})`)}},h.IPv6.isIPv6=function(d){return this.parser(d)!==null},h.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{let p=this.parser(d);return new this(p.parts,p.zoneId),!0}catch{return!1}},h.IPv6.networkAddressFromCIDR=function(d){let p,g,w,_,x;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),x=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],g=0;g<16;)_.push(parseInt(w[g],10)&parseInt(x[g],10)),g++;return new this(_)}catch(m){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${m})`)}},h.IPv6.parse=function(d){let p=this.parser(d);if(p.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(p.parts,p.zoneId)},h.IPv6.parseCIDR=function(d){let p,g,w;if((g=d.match(/^(.+)\/(\d+)$/))&&(p=parseInt(g[2]),p>=0&&p<=128))return w=[this.parse(g[1]),p],Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(d){let p,g,w,_,x,m;if(w=d.match(a.deprecatedTransitional))return this.parser(`::ffff:${w[1]}`);if(a.native.test(d))return c(d,8);if((w=d.match(a.transitional))&&(m=w[6]||"",p=c(w[1].slice(0,-1)+m,6),p.parts)){for(x=[parseInt(w[2]),parseInt(w[3]),parseInt(w[4]),parseInt(w[5])],g=0;g<x.length;g++)if(_=x[g],!(0<=_&&_<=255))return null;return p.parts.push(x[0]<<8|x[1]),p.parts.push(x[2]<<8|x[3]),{parts:p.parts,zoneId:p.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");let p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=0,w=Math.floor(d/8);for(;g<w;)p[g]=255,g++;return w<16&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},h.fromByteArray=function(d){let p=d.length;if(p===4)return new h.IPv4(d);if(p===16)return new h.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(d){return h.IPv6.isValid(d)||h.IPv4.isValid(d)},h.parse=function(d){if(h.IPv6.isValid(d))return h.IPv6.parse(d);if(h.IPv4.isValid(d))return h.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(d){try{return h.IPv6.parseCIDR(d)}catch{try{return h.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(d){let p=this.parse(d);return p.kind()==="ipv6"&&p.isIPv4MappedAddress()?p.toIPv4Address():p},h.subnetMatch=function(d,p,g){let w,_,x,m;g==null&&(g="unicast");for(_ in p)if(Object.prototype.hasOwnProperty.call(p,_)){for(x=p[_],x[0]&&!(x[0]instanceof Array)&&(x=[x]),w=0;w<x.length;w++)if(m=x[w],d.kind()===m[0].kind()&&d.match.apply(d,m))return _}return g},typeof N9<"u"&&N9.exports?N9.exports=h:r.ipaddr=h})(bhe)});var Ihe=P((Zqt,The)=>{"use strict";function sze(r){return r>=55296&&r<=56319}function aze(r){return r>=56320&&r<=57343}The.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,o=0,s,a,c=0;c<i;c+=1){if(s=t.charCodeAt(c),a=t[c],sze(s)&&aze(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),o+=e(a),o===n)return t.slice(0,c+1);if(o>n)return t.slice(0,c-a.length+1)}return t}});var Che=P((Jqt,Rhe)=>{"use strict";function cze(r){return r>=55296&&r<=56319}function uze(r){return r>=56320&&r<=57343}Rhe.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,o=null,s=0;s<t;s++)i=e.charCodeAt(s),uze(i)?o!=null&&cze(o)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),o=i;return n}});var khe=P((eHt,Phe)=>{"use strict";var lze=Ihe(),fze=Che();Phe.exports=lze.bind(null,fze)});var Ohe=P((tHt,Dhe)=>{"use strict";var dze=khe(),hze=/[\/\?<>\\:\*\|"]/g,pze=/[\x00-\x1f\x80-\x9f]/g,mze=/^\.+$/,gze=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,yze=/[\. ]+$/;function Nhe(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(hze,e).replace(pze,e).replace(mze,e).replace(gze,e).replace(yze,e);return dze(t,255)}Dhe.exports=function(r,e){var t=e&&e.replacement||"",n=Nhe(r,t);return t===""?n:Nhe(n,"")}});var Uhe=P((rHt,Mhe)=>{var og=at();Ic();gr();var be=og.asn1,sg=Mhe.exports=og.pkcs7asn1=og.pkcs7asn1||{};og.pkcs7=og.pkcs7||{};og.pkcs7.asn1=sg;var Lhe={name:"ContentInfo",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:be.Class.UNIVERSAL,type:be.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:be.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};sg.contentInfoValidator=Lhe;var Bhe={name:"EncryptedContentInfo",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:be.Class.UNIVERSAL,type:be.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:be.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:be.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};sg.envelopedDataValidator={name:"EnvelopedData",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:be.Class.UNIVERSAL,type:be.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Bhe)};sg.encryptedDataValidator={name:"EncryptedData",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"version"}].concat(Bhe)};var wze={name:"SignerInfo",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:be.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:be.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:be.Class.UNIVERSAL,type:be.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:be.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};sg.signedDataValidator={name:"SignedData",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:be.Class.UNIVERSAL,type:be.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Lhe,{name:"SignedData.Certificates",tagClass:be.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:be.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:be.Class.UNIVERSAL,type:be.Type.SET,capture:"signerInfos",optional:!0,value:[wze]}]};sg.recipientInfoValidator={name:"RecipientInfo",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:be.Class.UNIVERSAL,type:be.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:be.Class.UNIVERSAL,type:be.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:be.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:be.Class.UNIVERSAL,type:be.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}});var zhe=P((nHt,Fhe)=>{var p0=at();gr();p0.mgf=p0.mgf||{};var bze=Fhe.exports=p0.mgf.mgf1=p0.mgf1=p0.mgf1||{};bze.create=function(r){var e={generate:function(t,n){for(var i=new p0.util.ByteBuffer,o=Math.ceil(n/r.digestLength),s=0;s<o;s++){var a=new p0.util.ByteBuffer;a.putInt32(s),r.start(),r.update(t+a.getBytes()),i.putBuffer(r.digest())}return i.truncate(i.length()-n),i.getBytes()}};return e}});var Khe=P((iHt,Vhe)=>{var M9=at();zhe();Vhe.exports=M9.mgf=M9.mgf||{};M9.mgf.mgf1=M9.mgf1});var qhe=P((oHt,$he)=>{var m0=at();Dh();gr();var _ze=$he.exports=m0.pss=m0.pss||{};_ze.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=r.md,t=r.mgf,n=e.digestLength,i=r.salt||null;typeof i=="string"&&(i=m0.util.createBuffer(i));var o;if("saltLength"in r)o=r.saltLength;else if(i!==null)o=i.length();else throw new Error("Salt length not specified or specific salt not given.");if(i!==null&&i.length()!==o)throw new Error("Given salt length does not match length of given salt.");var s=r.prng||m0.random,a={};return a.encode=function(c,u){var l,f=u-1,h=Math.ceil(f/8),d=c.digest().getBytes();if(h<n+o+2)throw new Error("Message is too long to encrypt.");var p;i===null?p=s.getBytesSync(o):p=i.bytes();var g=new m0.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(d),g.putBytes(p),e.start(),e.update(g.getBytes());var w=e.digest().getBytes(),_=new m0.util.ByteBuffer;_.fillWithByte(0,h-o-n-2),_.putByte(1),_.putBytes(p);var x=_.getBytes(),m=h-n-1,y=t.generate(w,m),b="";for(l=0;l<m;l++)b+=String.fromCharCode(x.charCodeAt(l)^y.charCodeAt(l));var E=65280>>8*h-f&255;return b=String.fromCharCode(b.charCodeAt(0)&~E)+b.substr(1),b+w+String.fromCharCode(188)},a.verify=function(c,u,l){var f,h=l-1,d=Math.ceil(h/8);if(u=u.substr(-d),d<n+o+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(d-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var p=d-n-1,g=u.substr(0,p),w=u.substr(p,n),_=65280>>8*d-h&255;if(g.charCodeAt(0)&_)throw new Error("Bits beyond keysize not zero as expected.");var x=t.generate(w,p),m="";for(f=0;f<p;f++)m+=String.fromCharCode(g.charCodeAt(f)^x.charCodeAt(f));m=String.fromCharCode(m.charCodeAt(0)&~_)+m.substr(1);var y=d-n-o-2;for(f=0;f<y;f++)if(m.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(m.charCodeAt(y)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var b=m.substr(-o),E=new m0.util.ByteBuffer;E.fillWithByte(0,8),E.putBytes(c),E.putBytes(b),e.start(),e.update(E.getBytes());var v=e.digest().getBytes();return w===v},a}});var gB=P((sHt,Yhe)=>{var Ke=at();Nh();Ic();yb();Uf();Khe();z1();vb();qhe();Bh();gr();var T=Ke.asn1,le=Yhe.exports=Ke.pki=Ke.pki||{},$t=le.oids,fn={};fn.CN=$t.commonName;fn.commonName="CN";fn.C=$t.countryName;fn.countryName="C";fn.L=$t.localityName;fn.localityName="L";fn.ST=$t.stateOrProvinceName;fn.stateOrProvinceName="ST";fn.O=$t.organizationName;fn.organizationName="O";fn.OU=$t.organizationalUnitName;fn.organizationalUnitName="OU";fn.E=$t.emailAddress;fn.emailAddress="E";var Ghe=Ke.pki.rsa.publicKeyValidator,Eze={name:"Certificate",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:T.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:T.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:T.Class.UNIVERSAL,type:T.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:T.Class.UNIVERSAL,type:T.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:T.Class.UNIVERSAL,type:T.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:T.Class.UNIVERSAL,type:T.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Ghe,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:T.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:T.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:T.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:T.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},vze={name:"rsapss",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:T.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:T.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:T.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:T.Class.UNIVERSAL,type:T.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:T.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:T.Class.UNIVERSAL,type:T.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},xze={name:"CertificationRequestInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Ghe,{name:"CertificationRequestInfo.attributes",tagClass:T.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:T.Class.UNIVERSAL,type:T.Type.SET,constructed:!0}]}]}]},Sze={name:"CertificationRequest",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[xze,{name:"CertificationRequest.signatureAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:T.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};le.RDNAttributesAsArray=function(r,e){for(var t=[],n,i,o,s=0;s<r.value.length;++s){n=r.value[s];for(var a=0;a<n.value.length;++a)o={},i=n.value[a],o.type=T.derToOid(i.value[0].value),o.value=i.value[1].value,o.valueTagClass=i.value[1].type,o.type in $t&&(o.name=$t[o.type],o.name in fn&&(o.shortName=fn[o.name])),e&&(e.update(o.type),e.update(o.value)),t.push(o)}return t};le.CRIAttributesAsArray=function(r){for(var e=[],t=0;t<r.length;++t)for(var n=r[t],i=T.derToOid(n.value[0].value),o=n.value[1].value,s=0;s<o.length;++s){var a={};if(a.type=i,a.value=o[s].value,a.valueTagClass=o[s].type,a.type in $t&&(a.name=$t[a.type],a.name in fn&&(a.shortName=fn[a.name])),a.type===$t.extensionRequest){a.extensions=[];for(var c=0;c<a.value.length;++c)a.extensions.push(le.certificateExtensionFromAsn1(a.value[c]))}e.push(a)}return e};function th(r,e){typeof e=="string"&&(e={shortName:e});for(var t=null,n,i=0;t===null&&i<r.attributes.length;++i)n=r.attributes[i],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(t=n);return t}var U9=function(r,e,t){var n={};if(r!==$t["RSASSA-PSS"])return n;t&&(n={hash:{algorithmOid:$t.sha1},mgf:{algorithmOid:$t.mgf1,hash:{algorithmOid:$t.sha1}},saltLength:20});var i={},o=[];if(!T.validate(e,vze,i,o)){var s=new Error("Cannot read RSASSA-PSS parameter block.");throw s.errors=o,s}return i.hashOid!==void 0&&(n.hash=n.hash||{},n.hash.algorithmOid=T.derToOid(i.hashOid)),i.maskGenOid!==void 0&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=T.derToOid(i.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=T.derToOid(i.maskGenHashOid)),i.saltLength!==void 0&&(n.saltLength=i.saltLength.charCodeAt(0)),n},F9=function(r){switch($t[r.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Ke.md.sha1.create();case"md5WithRSAEncryption":return Ke.md.md5.create();case"sha256WithRSAEncryption":return Ke.md.sha256.create();case"sha384WithRSAEncryption":return Ke.md.sha384.create();case"sha512WithRSAEncryption":return Ke.md.sha512.create();case"RSASSA-PSS":return Ke.md.sha256.create();default:var e=new Error("Could not compute "+r.type+" digest. Unknown signature OID.");throw e.signatureOid=r.signatureOid,e}},jhe=function(r){var e=r.certificate,t;switch(e.signatureOid){case $t.sha1WithRSAEncryption:case $t.sha1WithRSASignature:break;case $t["RSASSA-PSS"]:var n,i;if(n=$t[e.signatureParameters.mgf.hash.algorithmOid],n===void 0||Ke.md[n]===void 0){var o=new Error("Unsupported MGF hash function.");throw o.oid=e.signatureParameters.mgf.hash.algorithmOid,o.name=n,o}if(i=$t[e.signatureParameters.mgf.algorithmOid],i===void 0||Ke.mgf[i]===void 0){var o=new Error("Unsupported MGF function.");throw o.oid=e.signatureParameters.mgf.algorithmOid,o.name=i,o}if(i=Ke.mgf[i].create(Ke.md[n].create()),n=$t[e.signatureParameters.hash.algorithmOid],n===void 0||Ke.md[n]===void 0){var o=new Error("Unsupported RSASSA-PSS hash function.");throw o.oid=e.signatureParameters.hash.algorithmOid,o.name=n,o}t=Ke.pss.create(Ke.md[n].create(),i,e.signatureParameters.saltLength);break}return e.publicKey.verify(r.md.digest().getBytes(),r.signature,t)};le.certificateFromPem=function(r,e,t){var n=Ke.pem.decode(r)[0];if(n.type!=="CERTIFICATE"&&n.type!=="X509 CERTIFICATE"&&n.type!=="TRUSTED CERTIFICATE"){var i=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var o=T.fromDer(n.body,t);return le.certificateFromAsn1(o,e)};le.certificateToPem=function(r,e){var t={type:"CERTIFICATE",body:T.toDer(le.certificateToAsn1(r)).getBytes()};return Ke.pem.encode(t,{maxline:e})};le.publicKeyFromPem=function(r){var e=Ke.pem.decode(r)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=T.fromDer(e.body);return le.publicKeyFromAsn1(n)};le.publicKeyToPem=function(r,e){var t={type:"PUBLIC KEY",body:T.toDer(le.publicKeyToAsn1(r)).getBytes()};return Ke.pem.encode(t,{maxline:e})};le.publicKeyToRSAPublicKeyPem=function(r,e){var t={type:"RSA PUBLIC KEY",body:T.toDer(le.publicKeyToRSAPublicKey(r)).getBytes()};return Ke.pem.encode(t,{maxline:e})};le.getPublicKeyFingerprint=function(r,e){e=e||{};var t=e.md||Ke.md.sha1.create(),n=e.type||"RSAPublicKey",i;switch(n){case"RSAPublicKey":i=T.toDer(le.publicKeyToRSAPublicKey(r)).getBytes();break;case"SubjectPublicKeyInfo":i=T.toDer(le.publicKeyToAsn1(r)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(i);var o=t.digest();if(e.encoding==="hex"){var s=o.toHex();return e.delimiter?s.match(/.{2}/g).join(e.delimiter):s}else{if(e.encoding==="binary")return o.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return o};le.certificationRequestFromPem=function(r,e,t){var n=Ke.pem.decode(r)[0];if(n.type!=="CERTIFICATE REQUEST"){var i=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw i.headerType=n.type,i}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var o=T.fromDer(n.body,t);return le.certificationRequestFromAsn1(o,e)};le.certificationRequestToPem=function(r,e){var t={type:"CERTIFICATE REQUEST",body:T.toDer(le.certificationRequestToAsn1(r)).getBytes()};return Ke.pem.encode(t,{maxline:e})};le.createCertificate=function(){var r={};return r.version=2,r.serialNumber="00",r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.validity={},r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.issuer={},r.issuer.getField=function(e){return th(r.issuer,e)},r.issuer.addField=function(e){fa([e]),r.issuer.attributes.push(e)},r.issuer.attributes=[],r.issuer.hash=null,r.subject={},r.subject.getField=function(e){return th(r.subject,e)},r.subject.addField=function(e){fa([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.extensions=[],r.publicKey=null,r.md=null,r.setSubject=function(e,t){fa(e),r.subject.attributes=e,delete r.subject.uniqueId,t&&(r.subject.uniqueId=t),r.subject.hash=null},r.setIssuer=function(e,t){fa(e),r.issuer.attributes=e,delete r.issuer.uniqueId,t&&(r.issuer.uniqueId=t),r.issuer.hash=null},r.setExtensions=function(e){for(var t=0;t<e.length;++t)Whe(e[t],{cert:r});r.extensions=e},r.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,n,i=0;t===null&&i<r.extensions.length;++i)n=r.extensions[i],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(t=n);return t},r.sign=function(e,t){r.md=t||Ke.md.sha1.create();var n=$t[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.tbsCertificate=le.getTBSCertificate(r);var o=T.toDer(r.tbsCertificate);r.md.update(o.getBytes()),r.signature=e.sign(r.md)},r.verify=function(e){var t=!1;if(!r.issued(e)){var n=e.issuer,i=r.subject,o=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw o.expectedIssuer=i.attributes,o.actualIssuer=n.attributes,o}var s=e.md;if(s===null){s=F9({signatureOid:e.signatureOid,type:"certificate"});var a=e.tbsCertificate||le.getTBSCertificate(e),c=T.toDer(a);s.update(c.getBytes())}return s!==null&&(t=jhe({certificate:r,md:s,signature:e.signature})),t},r.isIssuer=function(e){var t=!1,n=r.issuer,i=e.subject;if(n.hash&&i.hash)t=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){t=!0;for(var o,s,a=0;t&&a<n.attributes.length;++a)o=n.attributes[a],s=i.attributes[a],(o.type!==s.type||o.value!==s.value)&&(t=!1)}return t},r.issued=function(e){return e.isIssuer(r)},r.generateSubjectKeyIdentifier=function(){return le.getPublicKeyFingerprint(r.publicKey,{type:"RSAPublicKey"})},r.verifySubjectKeyIdentifier=function(){for(var e=$t.subjectKeyIdentifier,t=0;t<r.extensions.length;++t){var n=r.extensions[t];if(n.id===e){var i=r.generateSubjectKeyIdentifier().getBytes();return Ke.util.hexToBytes(n.subjectKeyIdentifier)===i}}return!1},r};le.certificateFromAsn1=function(r,e){var t={},n=[];if(!T.validate(r,Eze,t,n)){var i=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw i.errors=n,i}var o=T.derToOid(t.publicKeyOid);if(o!==le.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=le.createCertificate();s.version=t.certVersion?t.certVersion.charCodeAt(0):0;var a=Ke.util.createBuffer(t.certSerialNumber);s.serialNumber=a.toHex(),s.signatureOid=Ke.asn1.derToOid(t.certSignatureOid),s.signatureParameters=U9(s.signatureOid,t.certSignatureParams,!0),s.siginfo.algorithmOid=Ke.asn1.derToOid(t.certinfoSignatureOid),s.siginfo.parameters=U9(s.siginfo.algorithmOid,t.certinfoSignatureParams,!1),s.signature=t.certSignature;var c=[];if(t.certValidity1UTCTime!==void 0&&c.push(T.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&c.push(T.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&c.push(T.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&c.push(T.generalizedTimeToDate(t.certValidity4GeneralizedTime)),c.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(c.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(s.validity.notBefore=c[0],s.validity.notAfter=c[1],s.tbsCertificate=t.tbsCertificate,e){s.md=F9({signatureOid:s.signatureOid,type:"certificate"});var u=T.toDer(s.tbsCertificate);s.md.update(u.getBytes())}var l=Ke.md.sha1.create(),f=T.toDer(t.certIssuer);l.update(f.getBytes()),s.issuer.getField=function(p){return th(s.issuer,p)},s.issuer.addField=function(p){fa([p]),s.issuer.attributes.push(p)},s.issuer.attributes=le.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(s.issuer.uniqueId=t.certIssuerUniqueId),s.issuer.hash=l.digest().toHex();var h=Ke.md.sha1.create(),d=T.toDer(t.certSubject);return h.update(d.getBytes()),s.subject.getField=function(p){return th(s.subject,p)},s.subject.addField=function(p){fa([p]),s.subject.attributes.push(p)},s.subject.attributes=le.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(s.subject.uniqueId=t.certSubjectUniqueId),s.subject.hash=h.digest().toHex(),t.certExtensions?s.extensions=le.certificateExtensionsFromAsn1(t.certExtensions):s.extensions=[],s.publicKey=le.publicKeyFromAsn1(t.subjectPublicKeyInfo),s};le.certificateExtensionsFromAsn1=function(r){for(var e=[],t=0;t<r.value.length;++t)for(var n=r.value[t],i=0;i<n.value.length;++i)e.push(le.certificateExtensionFromAsn1(n.value[i]));return e};le.certificateExtensionFromAsn1=function(r){var e={};if(e.id=T.derToOid(r.value[0].value),e.critical=!1,r.value[1].type===T.Type.BOOLEAN?(e.critical=r.value[1].value.charCodeAt(0)!==0,e.value=r.value[2].value):e.value=r.value[1].value,e.id in $t){if(e.name=$t[e.id],e.name==="keyUsage"){var t=T.fromDer(e.value),n=0,i=0;t.value.length>1&&(n=t.value.charCodeAt(1),i=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(n&128)===128,e.nonRepudiation=(n&64)===64,e.keyEncipherment=(n&32)===32,e.dataEncipherment=(n&16)===16,e.keyAgreement=(n&8)===8,e.keyCertSign=(n&4)===4,e.cRLSign=(n&2)===2,e.encipherOnly=(n&1)===1,e.decipherOnly=(i&128)===128}else if(e.name==="basicConstraints"){var t=T.fromDer(e.value);t.value.length>0&&t.value[0].type===T.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var o=null;t.value.length>0&&t.value[0].type===T.Type.INTEGER?o=t.value[0].value:t.value.length>1&&(o=t.value[1].value),o!==null&&(e.pathLenConstraint=T.derToInteger(o))}else if(e.name==="extKeyUsage")for(var t=T.fromDer(e.value),s=0;s<t.value.length;++s){var a=T.derToOid(t.value[s].value);a in $t?e[$t[a]]=!0:e[a]=!0}else if(e.name==="nsCertType"){var t=T.fromDer(e.value),n=0;t.value.length>1&&(n=t.value.charCodeAt(1)),e.client=(n&128)===128,e.server=(n&64)===64,e.email=(n&32)===32,e.objsign=(n&16)===16,e.reserved=(n&8)===8,e.sslCA=(n&4)===4,e.emailCA=(n&2)===2,e.objCA=(n&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var c,t=T.fromDer(e.value),u=0;u<t.value.length;++u){c=t.value[u];var l={type:c.type,value:c.value};switch(e.altNames.push(l),c.type){case 1:case 2:case 6:break;case 7:l.ip=Ke.util.bytesToIP(c.value);break;case 8:l.oid=T.derToOid(c.value);break;default:}}}else if(e.name==="subjectKeyIdentifier"){var t=T.fromDer(e.value);e.subjectKeyIdentifier=Ke.util.bytesToHex(t.value)}}return e};le.certificationRequestFromAsn1=function(r,e){var t={},n=[];if(!T.validate(r,Sze,t,n)){var i=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw i.errors=n,i}var o=T.derToOid(t.publicKeyOid);if(o!==le.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=le.createCertificationRequest();if(s.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,s.signatureOid=Ke.asn1.derToOid(t.csrSignatureOid),s.signatureParameters=U9(s.signatureOid,t.csrSignatureParams,!0),s.siginfo.algorithmOid=Ke.asn1.derToOid(t.csrSignatureOid),s.siginfo.parameters=U9(s.siginfo.algorithmOid,t.csrSignatureParams,!1),s.signature=t.csrSignature,s.certificationRequestInfo=t.certificationRequestInfo,e){s.md=F9({signatureOid:s.signatureOid,type:"certification request"});var a=T.toDer(s.certificationRequestInfo);s.md.update(a.getBytes())}var c=Ke.md.sha1.create();return s.subject.getField=function(u){return th(s.subject,u)},s.subject.addField=function(u){fa([u]),s.subject.attributes.push(u)},s.subject.attributes=le.RDNAttributesAsArray(t.certificationRequestInfoSubject,c),s.subject.hash=c.digest().toHex(),s.publicKey=le.publicKeyFromAsn1(t.subjectPublicKeyInfo),s.getAttribute=function(u){return th(s,u)},s.addAttribute=function(u){fa([u]),s.attributes.push(u)},s.attributes=le.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),s};le.createCertificationRequest=function(){var r={};return r.version=0,r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.subject={},r.subject.getField=function(e){return th(r.subject,e)},r.subject.addField=function(e){fa([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.publicKey=null,r.attributes=[],r.getAttribute=function(e){return th(r,e)},r.addAttribute=function(e){fa([e]),r.attributes.push(e)},r.md=null,r.setSubject=function(e){fa(e),r.subject.attributes=e,r.subject.hash=null},r.setAttributes=function(e){fa(e),r.attributes=e},r.sign=function(e,t){r.md=t||Ke.md.sha1.create();var n=$t[r.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw i.algorithm=r.md.algorithm,i}r.signatureOid=r.siginfo.algorithmOid=n,r.certificationRequestInfo=le.getCertificationRequestInfo(r);var o=T.toDer(r.certificationRequestInfo);r.md.update(o.getBytes()),r.signature=e.sign(r.md)},r.verify=function(){var e=!1,t=r.md;if(t===null){t=F9({signatureOid:r.signatureOid,type:"certification request"});var n=r.certificationRequestInfo||le.getCertificationRequestInfo(r),i=T.toDer(n);t.update(i.getBytes())}return t!==null&&(e=jhe({certificate:r,md:t,signature:r.signature})),e},r};function ag(r){for(var e=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]),t,n,i=r.attributes,o=0;o<i.length;++o){t=i[o];var s=t.value,a=T.Type.PRINTABLESTRING;"valueTagClass"in t&&(a=t.valueTagClass,a===T.Type.UTF8&&(s=Ke.util.encodeUtf8(s))),n=T.create(T.Class.UNIVERSAL,T.Type.SET,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(t.type).getBytes()),T.create(T.Class.UNIVERSAL,a,!1,s)])]),e.value.push(n)}return e}function fa(r){for(var e,t=0;t<r.length;++t){if(e=r[t],typeof e.name>"u"&&(e.type&&e.type in le.oids?e.name=le.oids[e.type]:e.shortName&&e.shortName in fn&&(e.name=le.oids[fn[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in le.oids)e.type=le.oids[e.name];else{var n=new Error("Attribute type not specified.");throw n.attribute=e,n}if(typeof e.shortName>"u"&&e.name&&e.name in fn&&(e.shortName=fn[e.name]),e.type===$t.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=T.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var i=0;i<e.extensions.length;++i)e.value.push(le.certificateExtensionToAsn1(Whe(e.extensions[i])))}if(typeof e.value>"u"){var n=new Error("Attribute value not specified.");throw n.attribute=e,n}}}function Whe(r,e){if(e=e||{},typeof r.name>"u"&&r.id&&r.id in le.oids&&(r.name=le.oids[r.id]),typeof r.id>"u")if(r.name&&r.name in le.oids)r.id=le.oids[r.name];else{var t=new Error("Extension ID not specified.");throw t.extension=r,t}if(typeof r.value<"u")return r;if(r.name==="keyUsage"){var n=0,i=0,o=0;r.digitalSignature&&(i|=128,n=7),r.nonRepudiation&&(i|=64,n=6),r.keyEncipherment&&(i|=32,n=5),r.dataEncipherment&&(i|=16,n=4),r.keyAgreement&&(i|=8,n=3),r.keyCertSign&&(i|=4,n=2),r.cRLSign&&(i|=2,n=1),r.encipherOnly&&(i|=1,n=0),r.decipherOnly&&(o|=128,n=7);var s=String.fromCharCode(n);o!==0?s+=String.fromCharCode(i)+String.fromCharCode(o):i!==0&&(s+=String.fromCharCode(i)),r.value=T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,s)}else if(r.name==="basicConstraints")r.value=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]),r.cA&&r.value.value.push(T.create(T.Class.UNIVERSAL,T.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in r&&r.value.value.push(T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(r.pathLenConstraint).getBytes()));else if(r.name==="extKeyUsage"){r.value=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);var a=r.value.value;for(var c in r)r[c]===!0&&(c in $t?a.push(T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer($t[c]).getBytes())):c.indexOf(".")!==-1&&a.push(T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(c).getBytes())))}else if(r.name==="nsCertType"){var n=0,i=0;r.client&&(i|=128,n=7),r.server&&(i|=64,n=6),r.email&&(i|=32,n=5),r.objsign&&(i|=16,n=4),r.reserved&&(i|=8,n=3),r.sslCA&&(i|=4,n=2),r.emailCA&&(i|=2,n=1),r.objCA&&(i|=1,n=0);var s=String.fromCharCode(n);i!==0&&(s+=String.fromCharCode(i)),r.value=T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,s)}else if(r.name==="subjectAltName"||r.name==="issuerAltName"){r.value=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);for(var u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var s=u.value;if(u.type===7&&u.ip){if(s=Ke.util.bytesFromIP(u.ip),s===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?s=T.oidToDer(T.oidToDer(u.oid)):s=T.oidToDer(s));r.value.value.push(T.create(T.Class.CONTEXT_SPECIFIC,u.type,!1,s))}}else if(r.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(r.comment)||r.comment.length<1||r.comment.length>128)throw new Error('Invalid "nsComment" content.');r.value=T.create(T.Class.UNIVERSAL,T.Type.IA5STRING,!1,r.comment)}else if(r.name==="subjectKeyIdentifier"&&e.cert){var f=e.cert.generateSubjectKeyIdentifier();r.subjectKeyIdentifier=f.toHex(),r.value=T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,f.getBytes())}else if(r.name==="authorityKeyIdentifier"&&e.cert){r.value=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);var a=r.value.value;if(r.keyIdentifier){var h=r.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():r.keyIdentifier;a.push(T.create(T.Class.CONTEXT_SPECIFIC,0,!1,h))}if(r.authorityCertIssuer){var d=[T.create(T.Class.CONTEXT_SPECIFIC,4,!0,[ag(r.authorityCertIssuer===!0?e.cert.issuer:r.authorityCertIssuer)])];a.push(T.create(T.Class.CONTEXT_SPECIFIC,1,!0,d))}if(r.serialNumber){var p=Ke.util.hexToBytes(r.serialNumber===!0?e.cert.serialNumber:r.serialNumber);a.push(T.create(T.Class.CONTEXT_SPECIFIC,2,!1,p))}}else if(r.name==="cRLDistributionPoints"){r.value=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);for(var a=r.value.value,g=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]),w=T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[]),u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var s=u.value;if(u.type===7&&u.ip){if(s=Ke.util.bytesFromIP(u.ip),s===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?s=T.oidToDer(T.oidToDer(u.oid)):s=T.oidToDer(s));w.value.push(T.create(T.Class.CONTEXT_SPECIFIC,u.type,!1,s))}g.value.push(T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[w])),a.push(g)}if(typeof r.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=r,t}return r}function mB(r,e){switch(r){case $t["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(e.hash.algorithmOid).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(T.create(T.Class.CONTEXT_SPECIFIC,1,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(e.mgf.algorithmOid).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(e.mgf.hash.algorithmOid).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(T.create(T.Class.CONTEXT_SPECIFIC,2,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(e.saltLength).getBytes())])),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,t);default:return T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")}}function Aze(r){var e=T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[]);if(r.attributes.length===0)return e;for(var t=r.attributes,n=0;n<t.length;++n){var i=t[n],o=i.value,s=T.Type.UTF8;"valueTagClass"in i&&(s=i.valueTagClass),s===T.Type.UTF8&&(o=Ke.util.encodeUtf8(o));var a=!1;"valueConstructed"in i&&(a=i.valueConstructed);var c=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(i.type).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SET,!0,[T.create(T.Class.UNIVERSAL,s,a,o)])]);e.value.push(c)}return e}var Tze=new Date("1950-01-01T00:00:00Z"),Ize=new Date("2050-01-01T00:00:00Z");function Hhe(r){return r>=Tze&&r<Ize?T.create(T.Class.UNIVERSAL,T.Type.UTCTIME,!1,T.dateToUtcTime(r)):T.create(T.Class.UNIVERSAL,T.Type.GENERALIZEDTIME,!1,T.dateToGeneralizedTime(r))}le.getTBSCertificate=function(r){var e=Hhe(r.validity.notBefore),t=Hhe(r.validity.notAfter),n=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(r.version).getBytes())]),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Ke.util.hexToBytes(r.serialNumber)),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(r.siginfo.algorithmOid).getBytes()),mB(r.siginfo.algorithmOid,r.siginfo.parameters)]),ag(r.issuer),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[e,t]),ag(r.subject),le.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&n.value.push(T.create(T.Class.CONTEXT_SPECIFIC,1,!0,[T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&n.value.push(T.create(T.Class.CONTEXT_SPECIFIC,2,!0,[T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&n.value.push(le.certificateExtensionsToAsn1(r.extensions)),n};le.getCertificationRequestInfo=function(r){var e=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(r.version).getBytes()),ag(r.subject),le.publicKeyToAsn1(r.publicKey),Aze(r)]);return e};le.distinguishedNameToAsn1=function(r){return ag(r)};le.certificateToAsn1=function(r){var e=r.tbsCertificate||le.getTBSCertificate(r);return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[e,T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(r.signatureOid).getBytes()),mB(r.signatureOid,r.signatureParameters)]),T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};le.certificateExtensionsToAsn1=function(r){var e=T.create(T.Class.CONTEXT_SPECIFIC,3,!0,[]),t=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);e.value.push(t);for(var n=0;n<r.length;++n)t.value.push(le.certificateExtensionToAsn1(r[n]));return e};le.certificateExtensionToAsn1=function(r){var e=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);e.value.push(T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(r.id).getBytes())),r.critical&&e.value.push(T.create(T.Class.UNIVERSAL,T.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=r.value;return typeof r.value!="string"&&(t=T.toDer(t).getBytes()),e.value.push(T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,t)),e};le.certificationRequestToAsn1=function(r){var e=r.certificationRequestInfo||le.getCertificationRequestInfo(r);return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[e,T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(r.signatureOid).getBytes()),mB(r.signatureOid,r.signatureParameters)]),T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};le.createCaStore=function(r){var e={certs:{}};e.getIssuer=function(s){var a=t(s.issuer);return a},e.addCertificate=function(s){if(typeof s=="string"&&(s=Ke.pki.certificateFromPem(s)),n(s.subject),!e.hasCertificate(s))if(s.subject.hash in e.certs){var a=e.certs[s.subject.hash];Ke.util.isArray(a)||(a=[a]),a.push(s),e.certs[s.subject.hash]=a}else e.certs[s.subject.hash]=s},e.hasCertificate=function(s){typeof s=="string"&&(s=Ke.pki.certificateFromPem(s));var a=t(s.subject);if(!a)return!1;Ke.util.isArray(a)||(a=[a]);for(var c=T.toDer(le.certificateToAsn1(s)).getBytes(),u=0;u<a.length;++u){var l=T.toDer(le.certificateToAsn1(a[u])).getBytes();if(c===l)return!0}return!1},e.listAllCertificates=function(){var s=[];for(var a in e.certs)if(e.certs.hasOwnProperty(a)){var c=e.certs[a];if(!Ke.util.isArray(c))s.push(c);else for(var u=0;u<c.length;++u)s.push(c[u])}return s},e.removeCertificate=function(s){var a;if(typeof s=="string"&&(s=Ke.pki.certificateFromPem(s)),n(s.subject),!e.hasCertificate(s))return null;var c=t(s.subject);if(!Ke.util.isArray(c))return a=e.certs[s.subject.hash],delete e.certs[s.subject.hash],a;for(var u=T.toDer(le.certificateToAsn1(s)).getBytes(),l=0;l<c.length;++l){var f=T.toDer(le.certificateToAsn1(c[l])).getBytes();u===f&&(a=c[l],c.splice(l,1))}return c.length===0&&delete e.certs[s.subject.hash],a};function t(s){return n(s),e.certs[s.hash]||null}function n(s){if(!s.hash){var a=Ke.md.sha1.create();s.attributes=le.RDNAttributesAsArray(ag(s),a),s.hash=a.digest().toHex()}}if(r)for(var i=0;i<r.length;++i){var o=r[i];e.addCertificate(o)}return e};le.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};le.verifyCertificateChain=function(r,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var n=e.slice(0),i=t.validityCheckDate;typeof i>"u"&&(i=new Date);var o=!0,s=null,a=0;do{var c=e.shift(),u=null,l=!1;if(i&&(i<c.validity.notBefore||i>c.validity.notAfter)&&(s={message:"Certificate is not valid yet or has expired.",error:le.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:i}),s===null){if(u=e[0]||r.getIssuer(c),u===null&&c.isIssuer(c)&&(l=!0,u=c),u){var f=u;Ke.util.isArray(f)||(f=[f]);for(var h=!1;!h&&f.length>0;){u=f.shift();try{h=u.verify(c)}catch{}}h||(s={message:"Certificate signature is invalid.",error:le.certificateError.bad_certificate})}s===null&&(!u||l)&&!r.hasCertificate(c)&&(s={message:"Certificate is not trusted.",error:le.certificateError.unknown_ca})}if(s===null&&u&&!c.isIssuer(u)&&(s={message:"Certificate issuer is invalid.",error:le.certificateError.bad_certificate}),s===null)for(var d={keyUsage:!0,basicConstraints:!0},p=0;s===null&&p<c.extensions.length;++p){var g=c.extensions[p];g.critical&&!(g.name in d)&&(s={message:"Certificate has an unsupported critical extension.",error:le.certificateError.unsupported_certificate})}if(s===null&&(!o||e.length===0&&(!u||l))){var w=c.getExtension("basicConstraints"),_=c.getExtension("keyUsage");if(_!==null&&(!_.keyCertSign||w===null)&&(s={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:le.certificateError.bad_certificate}),s===null&&w!==null&&!w.cA&&(s={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:le.certificateError.bad_certificate}),s===null&&_!==null&&"pathLenConstraint"in w){var x=a-1;x>w.pathLenConstraint&&(s={message:"Certificate basicConstraints pathLenConstraint violated.",error:le.certificateError.bad_certificate})}}var m=s===null?!0:s.error,y=t.verify?t.verify(m,a,n):m;if(y===!0)s=null;else throw m===!0&&(s={message:"The application rejected the certificate.",error:le.certificateError.bad_certificate}),(y||y===0)&&(typeof y=="object"&&!Ke.util.isArray(y)?(y.message&&(s.message=y.message),y.error&&(s.error=y.error)):typeof y=="string"&&(s.error=y)),s;o=!1,++a}while(e.length>0);return!0}});var Zhe=P((aHt,Xhe)=>{var ye=at();Nh();Ic();yb();z1();vb();Uhe();Dh();gr();gB();var L=ye.asn1,uo=Xhe.exports=ye.pkcs7=ye.pkcs7||{};uo.messageFromPem=function(r){var e=ye.pem.decode(r)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=L.fromDer(e.body);return uo.messageFromAsn1(n)};uo.messageToPem=function(r,e){var t={type:"PKCS7",body:L.toDer(r.toAsn1()).getBytes()};return ye.pem.encode(t,{maxline:e})};uo.messageFromAsn1=function(r){var e={},t=[];if(!L.validate(r,uo.asn1.contentInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=t,n}var i=L.derToOid(e.contentType),o;switch(i){case ye.pki.oids.envelopedData:o=uo.createEnvelopedData();break;case ye.pki.oids.encryptedData:o=uo.createEncryptedData();break;case ye.pki.oids.signedData:o=uo.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return o.fromAsn1(e.content.value[0]),o};uo.createSignedData=function(){var r=null;return r={type:ye.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(n){if(wB(r,n,uo.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[],r.rawCapture.certificates)for(var i=r.rawCapture.certificates.value,o=0;o<i.length;++o)r.certificates.push(ye.pki.certificateFromAsn1(i[o]))},toAsn1:function(){r.contentInfo||r.sign();for(var n=[],i=0;i<r.certificates.length;++i)n.push(ye.pki.certificateToAsn1(r.certificates[i]));var o=[],s=L.create(L.Class.CONTEXT_SPECIFIC,0,!0,[L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,L.integerToDer(r.version).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo])]);return n.length>0&&s.value[0].value.push(L.create(L.Class.CONTEXT_SPECIFIC,0,!0,n)),o.length>0&&s.value[0].value.push(L.create(L.Class.CONTEXT_SPECIFIC,1,!0,o)),s.value[0].value.push(L.create(L.Class.UNIVERSAL,L.Type.SET,!0,r.signerInfos)),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.type).getBytes()),s])},addSigner:function(n){var i=n.issuer,o=n.serialNumber;if(n.certificate){var s=n.certificate;typeof s=="string"&&(s=ye.pki.certificateFromPem(s)),i=s.issuer.attributes,o=s.serialNumber}var a=n.key;if(!a)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof a=="string"&&(a=ye.pki.privateKeyFromPem(a));var c=n.digestAlgorithm||ye.pki.oids.sha1;switch(c){case ye.pki.oids.sha1:case ye.pki.oids.sha256:case ye.pki.oids.sha384:case ye.pki.oids.sha512:case ye.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+c)}var u=n.authenticatedAttributes||[];if(u.length>0){for(var l=!1,f=!1,h=0;h<u.length;++h){var d=u[h];if(!l&&d.type===ye.pki.oids.contentType){if(l=!0,f)break;continue}if(!f&&d.type===ye.pki.oids.messageDigest){if(f=!0,l)break;continue}}if(!l||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}r.signers.push({key:a,version:1,issuer:i,serialNumber:o,digestAlgorithm:c,signatureAlgorithm:ye.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(n){if(n=n||{},(typeof r.content!="object"||r.contentInfo===null)&&(r.contentInfo=L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(ye.pki.oids.data).getBytes())]),"content"in r)){var i;r.content instanceof ye.util.ByteBuffer?i=r.content.bytes():typeof r.content=="string"&&(i=ye.util.encodeUtf8(r.content)),n.detached?r.detachedContent=L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,i):r.contentInfo.value.push(L.create(L.Class.CONTEXT_SPECIFIC,0,!0,[L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,i)]))}if(r.signers.length!==0){var o=e();t(o)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(n){typeof n=="string"&&(n=ye.pki.certificateFromPem(n)),r.certificates.push(n)},addCertificateRevokationList:function(n){throw new Error("PKCS#7 CRL support not yet implemented.")}},r;function e(){for(var n={},i=0;i<r.signers.length;++i){var o=r.signers[i],s=o.digestAlgorithm;s in n||(n[s]=ye.md[ye.pki.oids[s]].create()),o.authenticatedAttributes.length===0?o.md=n[s]:o.md=ye.md[ye.pki.oids[s]].create()}r.digestAlgorithmIdentifiers=[];for(var s in n)r.digestAlgorithmIdentifiers.push(L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(s).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.NULL,!1,"")]));return n}function t(n){var i;if(r.detachedContent?i=r.detachedContent:(i=r.contentInfo.value[1],i=i.value[0]),!i)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var o=L.derToOid(r.contentInfo.value[0].value),s=L.toDer(i);s.getByte(),L.getBerValueLength(s),s=s.getBytes();for(var a in n)n[a].start().update(s);for(var c=new Date,u=0;u<r.signers.length;++u){var l=r.signers[u];if(l.authenticatedAttributes.length===0){if(o!==ye.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{l.authenticatedAttributesAsn1=L.create(L.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=L.create(L.Class.UNIVERSAL,L.Type.SET,!0,[]),h=0;h<l.authenticatedAttributes.length;++h){var d=l.authenticatedAttributes[h];d.type===ye.pki.oids.messageDigest?d.value=n[l.digestAlgorithm].digest():d.type===ye.pki.oids.signingTime&&(d.value||(d.value=c)),f.value.push(yB(d)),l.authenticatedAttributesAsn1.value.push(yB(d))}s=L.toDer(f).getBytes(),l.md.start().update(s)}l.signature=l.key.sign(l.md,"RSASSA-PKCS1-V1_5")}r.signerInfos=Dze(r.signers)}};uo.createEncryptedData=function(){var r=null;return r={type:ye.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:ye.pki.oids["aes256-CBC"]},fromAsn1:function(e){wB(r,e,uo.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(r.encryptedContent.key=e),Qhe(r)}},r};uo.createEnvelopedData=function(){var r=null;return r={type:ye.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:ye.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=wB(r,e,uo.asn1.envelopedDataValidator);r.recipients=Pze(t.recipientInfos.value)},toAsn1:function(){return L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.type).getBytes()),L.create(L.Class.CONTEXT_SPECIFIC,0,!0,[L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,L.integerToDer(r.version).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SET,!0,kze(r.recipients)),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,Oze(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var i=r.recipients[n],o=i.issuer;if(i.serialNumber===e.serialNumber&&o.length===t.length){for(var s=!0,a=0;a<t.length;++a)if(o[a].type!==t[a].type||o[a].value!==t[a].value){s=!1;break}if(s)return i}}return null},decrypt:function(e,t){if(r.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case ye.pki.oids.rsaEncryption:case ye.pki.oids.desCBC:var n=t.decrypt(e.encryptedContent.content);r.encryptedContent.key=ye.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}Qhe(r)},addRecipient:function(e){r.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:ye.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(r.encryptedContent.content===void 0){t=t||r.encryptedContent.algorithm,e=e||r.encryptedContent.key;var n,i,o;switch(t){case ye.pki.oids["aes128-CBC"]:n=16,i=16,o=ye.aes.createEncryptionCipher;break;case ye.pki.oids["aes192-CBC"]:n=24,i=16,o=ye.aes.createEncryptionCipher;break;case ye.pki.oids["aes256-CBC"]:n=32,i=16,o=ye.aes.createEncryptionCipher;break;case ye.pki.oids["des-EDE3-CBC"]:n=24,i=8,o=ye.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=ye.util.createBuffer(ye.random.getBytes(n));else if(e.length()!=n)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+n+".");r.encryptedContent.algorithm=t,r.encryptedContent.key=e,r.encryptedContent.parameter=ye.util.createBuffer(ye.random.getBytes(i));var s=o(e);if(s.start(r.encryptedContent.parameter.copy()),s.update(r.content),!s.finish())throw new Error("Symmetric encryption failed.");r.encryptedContent.content=s.output}for(var a=0;a<r.recipients.length;++a){var c=r.recipients[a];if(c.encryptedContent.content===void 0)switch(c.encryptedContent.algorithm){case ye.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm)}}}},r};function Rze(r){var e={},t=[];if(!L.validate(r,uo.asn1.recipientInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=t,n}return{version:e.version.charCodeAt(0),issuer:ye.pki.RDNAttributesAsArray(e.issuer),serialNumber:ye.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:L.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function Cze(r){return L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,L.integerToDer(r.version).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[ye.pki.distinguishedNameToAsn1({attributes:r.issuer}),L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,ye.util.hexToBytes(r.serialNumber))]),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.encryptedContent.algorithm).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.NULL,!1,"")]),L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,r.encryptedContent.content)])}function Pze(r){for(var e=[],t=0;t<r.length;++t)e.push(Rze(r[t]));return e}function kze(r){for(var e=[],t=0;t<r.length;++t)e.push(Cze(r[t]));return e}function Nze(r){var e=L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,L.integerToDer(r.version).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[ye.pki.distinguishedNameToAsn1({attributes:r.issuer}),L.create(L.Class.UNIVERSAL,L.Type.INTEGER,!1,ye.util.hexToBytes(r.serialNumber))]),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.digestAlgorithm).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.NULL,!1,"")])]);if(r.authenticatedAttributesAsn1&&e.value.push(r.authenticatedAttributesAsn1),e.value.push(L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.signatureAlgorithm).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.NULL,!1,"")])),e.value.push(L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,r.signature)),r.unauthenticatedAttributes.length>0){for(var t=L.create(L.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<r.unauthenticatedAttributes.length;++n){var i=r.unauthenticatedAttributes[n];t.values.push(yB(i))}e.value.push(t)}return e}function Dze(r){for(var e=[],t=0;t<r.length;++t)e.push(Nze(r[t]));return e}function yB(r){var e;if(r.type===ye.pki.oids.contentType)e=L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.value).getBytes());else if(r.type===ye.pki.oids.messageDigest)e=L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,r.value.bytes());else if(r.type===ye.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),i=r.value;if(typeof i=="string"){var o=Date.parse(i);isNaN(o)?i.length===13?i=L.utcTimeToDate(i):i=L.generalizedTimeToDate(i):i=new Date(o)}i>=t&&i<n?e=L.create(L.Class.UNIVERSAL,L.Type.UTCTIME,!1,L.dateToUtcTime(i)):e=L.create(L.Class.UNIVERSAL,L.Type.GENERALIZEDTIME,!1,L.dateToGeneralizedTime(i))}return L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.type).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SET,!0,[e])])}function Oze(r){return[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(ye.pki.oids.data).getBytes()),L.create(L.Class.UNIVERSAL,L.Type.SEQUENCE,!0,[L.create(L.Class.UNIVERSAL,L.Type.OID,!1,L.oidToDer(r.algorithm).getBytes()),r.parameter?L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,r.parameter.getBytes()):void 0]),L.create(L.Class.CONTEXT_SPECIFIC,0,!0,[L.create(L.Class.UNIVERSAL,L.Type.OCTETSTRING,!1,r.content.getBytes())])]}function wB(r,e,t){var n={},i=[];if(!L.validate(e,t,n,i)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw o.errors=o,o}var s=L.derToOid(n.contentType);if(s!==ye.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var a="";if(ye.util.isArray(n.encryptedContent))for(var c=0;c<n.encryptedContent.length;++c){if(n.encryptedContent[c].type!==L.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=n.encryptedContent[c].value}else a=n.encryptedContent;r.encryptedContent={algorithm:L.derToOid(n.encAlgorithm),parameter:ye.util.createBuffer(n.encParameter.value),content:ye.util.createBuffer(a)}}if(n.content){var a="";if(ye.util.isArray(n.content))for(var c=0;c<n.content.length;++c){if(n.content[c].type!==L.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=n.content[c].value}else a=n.content;r.content=ye.util.createBuffer(a)}return r.version=n.version.charCodeAt(0),r.rawCapture=n,n}function Qhe(r){if(r.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(r.content===void 0){var e;switch(r.encryptedContent.algorithm){case ye.pki.oids["aes128-CBC"]:case ye.pki.oids["aes192-CBC"]:case ye.pki.oids["aes256-CBC"]:e=ye.aes.createDecryptionCipher(r.encryptedContent.key);break;case ye.pki.oids.desCBC:case ye.pki.oids["des-EDE3-CBC"]:e=ye.des.createDecryptionCipher(r.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+r.encryptedContent.algorithm)}if(e.start(r.encryptedContent.parameter),e.update(r.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");r.content=e.output}}});var k0e=P((aXt,P0e)=>{"use strict";P0e.exports=C0e;var _Ve=vA(),nh=C0e.prototype,EVe=new Date%1e9;function vVe(){return(Math.random()*1e9>>>0)+EVe++}function C0e(r){r=r||{},this.id=r.id||vVe(),this.max=r.max||1/0,this.items=r.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(r.lastModified||new Date);for(var e,t,n=this.items.length;n--;)e=this.items[n],t=new Date(e.expires)-new Date,this._lookup[e.key]=e,t>0?this.expire(e.key,t):t<=0&&this.delete(e.key)}nh.has=function(r){return r in this._lookup};nh.get=function(r){if(!this.has(r))return null;var e=this._lookup[r];return e.refresh&&this.expire(r,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value};nh.meta=function(r){if(!this.has(r))return null;var e=this._lookup[r];return"meta"in e?e.meta:null};nh.set=function(r,e,t){var n=this._lookup[r],i=this._lookup[r]={key:r,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),t&&("ttl"in t&&this.expire(r,t.ttl),"meta"in t&&(i.meta=t.meta),t.refresh&&(i.refresh=t.ttl)),this};nh.delete=function(r){var e=this._lookup[r];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[r],this.size--,this):!1};nh.expire=function(r,e){var t=e||0,n=this._lookup[r];if(!n)return this;if(typeof t=="string"&&(t=_Ve(e)),typeof t!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),t),n.expires=Number(new Date)+t,this};nh.clear=function(){for(var r=this.items.length;r--;)this.delete(this.items[r].key);return this};nh.toJSON=function(){for(var r=new Array(this.items.length),e,t=r.length;t--;)e=this.items[t],r[t]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:r}}});var V0e=P((VXt,z0e)=>{z0e.exports=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var q0e=P(($Xt,$0e)=>{var K0e=V0e();$0e.exports=class{constructor(e){this.hwm=e||16,this.head=new K0e(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let t=this.head;this.head=t.next=new K0e(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var G0e=P((qXt,H0e)=>{"use strict";var kVe=()=>{let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r};H0e.exports=kVe});var Q0e=P((GXt,Y0e)=>{var j0e=q0e(),W0e=G0e();Y0e.exports=class{constructor(){this._buffer=new j0e,this._waitingConsumers=new j0e}push(e){let{promise:t,resolve:n}=W0e();return this._buffer.push({chunk:e,resolve:n}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){let e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){let{promise:e,resolve:t}=W0e();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}});var a1e=P((cM,s1e)=>{var Rx=n5(),vu=Rx.Buffer;function o1e(r,e){for(var t in r)e[t]=r[t]}vu.from&&vu.alloc&&vu.allocUnsafe&&vu.allocUnsafeSlow?s1e.exports=Rx:(o1e(Rx,cM),cM.Buffer=R0);function R0(r,e,t){return vu(r,e,t)}R0.prototype=Object.create(vu.prototype);o1e(vu,R0);R0.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return vu(r,e,t)};R0.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=vu(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};R0.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return vu(r)};R0.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Rx.SlowBuffer(r)}});var c1e=P((HZt,lM)=>{"use strict";var uM=65536,OVe=4294967295;function LVe(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var BVe=a1e().Buffer,Cx=globalThis.crypto||globalThis.msCrypto;Cx&&Cx.getRandomValues?lM.exports=MVe:lM.exports=LVe;function MVe(r,e){if(r>OVe)throw new RangeError("requested too many random bytes");var t=BVe.allocUnsafe(r);if(r>0)if(r>uM)for(var n=0;n<r;n+=uM)Cx.getRandomValues(t.slice(n,n+uM));else Cx.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}});var f1e=P((GZt,l1e)=>{"use strict";var UVe=c1e(),{EventEmitter:FVe}=xi();function u1e(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;++t)if(r[t]!==e[t])return!1;return!0}function fM(){return{contacts:[],dontSplit:!1,left:null,right:null}}function O4(r,e){if(!(e instanceof Uint8Array))throw new TypeError(r+" is not a Uint8Array")}var wg=class extends FVe{constructor(e={}){super(),this.localNodeId=e.localNodeId||UVe(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||wg.distance,this.arbiter=e.arbiter||wg.arbiter,this.metadata=Object.assign({},e.metadata),O4("option.localNodeId as parameter 1",this.localNodeId),this.root=fM()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let n=0,i=0,o=Math.min(e.length,t.length),s=Math.max(e.length,t.length);for(;i<o;++i)n=n*256+(e[i]^t[i]);for(;i<s;++i)n=n*256+255;return n}add(e){O4("contact.id",(e||{}).id);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e.id,t++);let i=this._indexOf(n,e.id);return i>=0?(this._update(n,i,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.emit("added",e),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(O4("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let i=[this.root],o=0;i.length>0&&n.length<t;){let s=i.pop();if(s.contacts===null){let a=this._determineNode(s,e,o++);i.push(s.left===a?s.right:s.left),i.push(a)}else n=n.concat(s.contacts)}return n.map(i=>[this.distance(i.id,e),i]).sort((i,o)=>i[0]-o[0]).slice(0,t).map(i=>i[1])}count(){let e=0;for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e+=n.contacts.length}return e}_determineNode(e,t,n){let i=n>>3,o=n%8;return t.length<=i&&o!==0?e.left:t[i]&1<<7-o?e.right:e.left}get(e){O4("id",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);return i>=0?n.contacts[i]:null}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(u1e(e.contacts[n].id,t))return n;return-1}remove(e){O4("the id as parameter 1",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let i=this._indexOf(n,e);if(i>=0){let o=n.contacts.splice(i,1)[0];this.emit("removed",o)}return this}_split(e,t){e.left=fM(),e.right=fM();for(let o of e.contacts)this._determineNode(e,o.id,t).contacts.push(o);e.contacts=null;let n=this._determineNode(e,this.localNodeId,t),i=e.left===n?e.right:e.left;i.dontSplit=!0}toArray(){let e=[];for(let t=[this.root];t.length>0;){let n=t.pop();n.contacts===null?t.push(n.right,n.left):e=e.concat(n.contacts)}return e}*toIterable(){for(let e=[this.root];e.length>0;){let t=e.pop();t.contacts===null?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,n){if(!u1e(e.contacts[t].id,n.id))throw new Error("wrong index for _update");let i=e.contacts[t],o=this.arbiter(i,n);o===i&&i!==n||(e.contacts.splice(t,1),e.contacts.push(o),this.emit("updated",i,o))}};l1e.exports=wg});var h1e=P((d1e,Px)=>{(function(r){"use strict";let e="(0?\\d+|0x[a-f0-9]+)",t={fourOctet:new RegExp(`^${e}\\.${e}\\.${e}\\.${e}$`,"i"),threeOctet:new RegExp(`^${e}\\.${e}\\.${e}$`,"i"),twoOctet:new RegExp(`^${e}\\.${e}$`,"i"),longValue:new RegExp(`^${e}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",s="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${s})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${e}\\.${e}\\.${e}\\.${e}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${s})|(?:::)(?:${s})?)${e}\\.${e}\\.${e}\\.${e}(${o})?$`,"i")};function c(d,p){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let g=0,w=-1,_=(d.match(a.zoneIndex)||[])[0],x,m;for(_&&(_=_.substring(1),d=d.replace(/%.+$/,""));(w=d.indexOf(":",w+1))>=0;)g++;if(d.substr(0,2)==="::"&&g--,d.substr(-2,2)==="::"&&g--,g>p)return null;for(m=p-g,x=":";m--;)x+="0:";return d=d.replace("::",x),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),p=function(){let y=d.split(":"),b=[];for(let E=0;E<y.length;E++)b.push(parseInt(y[E],16));return b}(),{parts:p,zoneId:_}}function u(d,p,g,w){if(d.length!==p.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let _=0,x;for(;w>0;){if(x=g-w,x<0&&(x=0),d[_]>>x!==p[_]>>x)return!1;w-=g,_+=1}return!0}function l(d){if(i.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(n.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function f(d,p){for(;d.length<p;)d=`0${d}`;return d}let h={};h.IPv4=function(){function d(p){if(p.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let g,w;for(g=0;g<p.length;g++)if(w=p[g],!(0<=w&&w<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=p}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,18,0,0]),15],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]],as112:[[new d([192,175,48,0]),24],[new d([192,31,196,0]),24]],amt:[[new d([192,52,193,0]),24]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(p,g){let w;if(g===void 0&&(w=p,p=w[0],g=w[1]),p.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,p.octets,8,g)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,g=!1,w={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},_,x,m;for(_=3;_>=0;_-=1)if(x=this.octets[_],x in w){if(m=w[x],g&&m!==0)return null;m!==8&&(g=!0),p+=m}else return null;return 32-p},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),h.IPv4.broadcastAddressFromCIDR=function(d){try{let p=this.parseCIDR(d),g=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],x=0;for(;x<4;)_.push(parseInt(g[x],10)|parseInt(w[x],10)^255),x++;return new this(_)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(d){return this.parser(d)!==null},h.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},h.IPv4.isValidCIDR=function(d){try{return this.parseCIDR(d),!0}catch{return!1}},h.IPv4.isValidFourPartDecimal=function(d){return!!(h.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(d){let p,g,w,_,x;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),x=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],g=0;g<4;)_.push(parseInt(w[g],10)&parseInt(x[g],10)),g++;return new this(_)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(d){let p=this.parser(d);if(p===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(p)},h.IPv4.parseCIDR=function(d){let p;if(p=d.match(/^(.+)\/(\d+)$/)){let g=parseInt(p[2]);if(g>=0&&g<=32){let w=[this.parse(p[1]),g];return Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(d){let p,g,w;if(p=d.match(t.fourOctet))return function(){let _=p.slice(1,6),x=[];for(let m=0;m<_.length;m++)g=_[m],x.push(l(g));return x}();if(p=d.match(t.longValue)){if(w=l(p[1]),w>4294967295||w<0)throw new Error("ipaddr: address outside defined range");return function(){let _=[],x;for(x=0;x<=24;x+=8)_.push(w>>x&255);return _}().reverse()}else return(p=d.match(t.twoOctet))?function(){let _=p.slice(1,4),x=[];if(w=l(_[1]),w>16777215||w<0)throw new Error("ipaddr: address outside defined range");return x.push(l(_[0])),x.push(w>>16&255),x.push(w>>8&255),x.push(w&255),x}():(p=d.match(t.threeOctet))?function(){let _=p.slice(1,5),x=[];if(w=l(_[2]),w>65535||w<0)throw new Error("ipaddr: address outside defined range");return x.push(l(_[0])),x.push(l(_[1])),x.push(w>>8&255),x.push(w&255),x}():null},h.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");let p=[0,0,0,0],g=0,w=Math.floor(d/8);for(;g<w;)p[g]=255,g++;return w<4&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},h.IPv6=function(){function d(p,g){let w,_;if(p.length===16)for(this.parts=[],w=0;w<=14;w+=2)this.parts.push(p[w]<<8|p[w+1]);else if(p.length===8)this.parts=p;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(w=0;w<this.parts.length;w++)if(_=this.parts[w],!(0<=_&&_<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");g&&(this.zoneId=g)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],discard:[new d([256,0,0,0,0,0,0,0]),64],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],benchmarking:[new d([8193,2,0,0,0,0,0,0]),48],amt:[new d([8193,3,0,0,0,0,0,0]),32],as112v6:[[new d([8193,4,274,0,0,0,0,0]),48],[new d([9760,79,32768,0,0,0,0,0]),48]],deprecated:[new d([8193,16,0,0,0,0,0,0]),28],orchid2:[new d([8193,32,0,0,0,0,0,0]),28],droneRemoteIdProtocolEntityTags:[new d([8193,48,0,0,0,0,0,0]),28],reserved:[[new d([8193,0,0,0,0,0,0,0]),23],[new d([8193,3512,0,0,0,0,0,0]),32]]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(p,g){let w;if(g===void 0&&(w=p,p=w[0],g=w[1]),p.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,p.parts,16,g)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,g=!1,w={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},_,x;for(let m=7;m>=0;m-=1)if(_=this.parts[m],_ in w){if(x=w[_],g&&x!==0)return null;x!==16&&(g=!0),p+=x}else return null;return 128-p},d.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let p,g=[],w=this.parts;for(let _=0;_<w.length;_++)p=w[_],g.push(p>>8),g.push(p&255);return g},d.prototype.toFixedLengthString=function(){let p=function(){let w=[];for(let _=0;_<this.parts.length;_++)w.push(f(this.parts[_].toString(16),4));return w}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),p+g},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let p=this.parts.slice(-2),g=p[0],w=p[1];return new h.IPv4([g>>8,g&255,w>>8,w&255])},d.prototype.toNormalizedString=function(){let p=function(){let w=[];for(let _=0;_<this.parts.length;_++)w.push(this.parts[_].toString(16));return w}.call(this).join(":"),g="";return this.zoneId&&(g=`%${this.zoneId}`),p+g},d.prototype.toRFC5952String=function(){let p=/((^|:)(0(:|$)){2,})/g,g=this.toNormalizedString(),w=0,_=-1,x;for(;x=p.exec(g);)x[0].length>_&&(w=x.index,_=x[0].length);return _<0?g:`${g.substring(0,w)}::${g.substring(w+_)}`},d.prototype.toString=function(){return this.toRFC5952String()},d}(),h.IPv6.broadcastAddressFromCIDR=function(d){try{let p=this.parseCIDR(d),g=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],x=0;for(;x<16;)_.push(parseInt(g[x],10)|parseInt(w[x],10)^255),x++;return new this(_)}catch(p){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${p})`)}},h.IPv6.isIPv6=function(d){return this.parser(d)!==null},h.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{let p=this.parser(d);return new this(p.parts,p.zoneId),!0}catch{return!1}},h.IPv6.isValidCIDR=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{return this.parseCIDR(d),!0}catch{return!1}},h.IPv6.networkAddressFromCIDR=function(d){let p,g,w,_,x;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),x=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),_=[],g=0;g<16;)_.push(parseInt(w[g],10)&parseInt(x[g],10)),g++;return new this(_)}catch(m){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${m})`)}},h.IPv6.parse=function(d){let p=this.parser(d);if(p.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(p.parts,p.zoneId)},h.IPv6.parseCIDR=function(d){let p,g,w;if((g=d.match(/^(.+)\/(\d+)$/))&&(p=parseInt(g[2]),p>=0&&p<=128))return w=[this.parse(g[1]),p],Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(d){let p,g,w,_,x,m;if(w=d.match(a.deprecatedTransitional))return this.parser(`::ffff:${w[1]}`);if(a.native.test(d))return c(d,8);if((w=d.match(a.transitional))&&(m=w[6]||"",p=w[1],w[1].endsWith("::")||(p=p.slice(0,-1)),p=c(p+m,6),p.parts)){for(x=[parseInt(w[2]),parseInt(w[3]),parseInt(w[4]),parseInt(w[5])],g=0;g<x.length;g++)if(_=x[g],!(0<=_&&_<=255))return null;return p.parts.push(x[0]<<8|x[1]),p.parts.push(x[2]<<8|x[3]),{parts:p.parts,zoneId:p.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");let p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=0,w=Math.floor(d/8);for(;g<w;)p[g]=255,g++;return w<16&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},h.fromByteArray=function(d){let p=d.length;if(p===4)return new h.IPv4(d);if(p===16)return new h.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(d){return h.IPv6.isValid(d)||h.IPv4.isValid(d)},h.isValidCIDR=function(d){return h.IPv6.isValidCIDR(d)||h.IPv4.isValidCIDR(d)},h.parse=function(d){if(h.IPv6.isValid(d))return h.IPv6.parse(d);if(h.IPv4.isValid(d))return h.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(d){try{return h.IPv6.parseCIDR(d)}catch{try{return h.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(d){let p=this.parse(d);return p.kind()==="ipv6"&&p.isIPv4MappedAddress()?p.toIPv4Address():p},h.subnetMatch=function(d,p,g){let w,_,x,m;g==null&&(g="unicast");for(_ in p)if(Object.prototype.hasOwnProperty.call(p,_)){for(x=p[_],x[0]&&!(x[0]instanceof Array)&&(x=[x]),w=0;w<x.length;w++)if(m=x[w],d.kind()===m[0].kind()&&d.match.apply(d,m))return _}return g},typeof Px<"u"&&Px.exports?Px.exports=h:r.ipaddr=h})(d1e)});var J1e=P(rS=>{"use strict";Object.defineProperty(rS,"__esModule",{value:!0});var SM=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},tS=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let i=new SM;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:o=>i.push(o),stop:()=>i.stop(),fail:o=>i.fail(o),on:(o,s)=>{i.eventHandlers[o]=s}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};rS.EventIterator=tS;rS.default=tS});var eme=P($4=>{"use strict";Object.defineProperty($4,"__esModule",{value:!0});var AM=J1e();$4.EventIterator=AM.EventIterator;function _Ke(r,e,t){return new AM.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}$4.subscribe=_Ke;$4.default=AM.EventIterator});var H4=P((Eir,Rme)=>{Rme.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:!!e}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}});var Pme=P((xir,Cme)=>{Cme.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){let t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();let n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}}});var Nme=P((Sir,kme)=>{var NKe=Pme();kme.exports=NKe});var vs=P((Tir,Dme)=>{Dme.exports=class{constructor(e,t,n,i){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof i>"u"?!1:i}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=!!e}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}});var Ig=P((Rir,Lme)=>{var DM=H4(),DKe=Nme(),Ome=vs();Lme.exports=class extends DM{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new DKe}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,i,o,s={}){let a=this._getRateLimiterRes(n,i,o);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+i&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(u=>{t(u)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,i,o,s=!1,a={}){this.insuranceLimiter instanceof DM?this.insuranceLimiter[t](o,s,a).then(c=>{n(c)}).catch(c=>{i(c)}):i(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof DM))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){let i=t*1e3;return this._block(this.getKey(e),this.points+1,i,n)}set(e,t,n,i={}){let o=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,o,i)}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(s);if(a>0)return o(new Ome(0,a));this._upsert(s,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(i,o,s,t,c)}).catch(c=>{this._handleError(c,"consume",i,o,e,t,n)})})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise((o,s)=>{this._upsert(i,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{o(this._getRateLimiterRes(i,t,a))}).catch(a=>{this._handleError(a,"penalty",o,s,e,t,n)})})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise((o,s)=>{this._upsert(i,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{o(this._getRateLimiterRes(i,-t,a))}).catch(a=>{this._handleError(a,"reward",o,s,e,t,n)})})}get(e,t={}){let n=this.getKey(e);return new Promise((i,o)=>{this._get(n,t).then(s=>{i(s===null||typeof s>"u"?null:this._getRateLimiterRes(n,0,s))}).catch(s=>{this._handleError(s,"get",i,o,e,t)})})}delete(e,t={}){let n=this.getKey(e);return new Promise((i,o)=>{this._delete(n,t).then(s=>{this._inMemoryBlockedKeys.delete(n),i(s)}).catch(s=>{this._handleError(s,"delete",i,o,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,i={}){return new Promise((o,s)=>{this._upsert(e,t,n,!0,i).then(()=>{o(new Ome(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",o,s,this.parseKey(e),n/1e3,i)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,i=!1,o={}){throw new Error("You have to implement the method '_upsert'!")}}});var Ume=P((Cir,Mme)=>{var OKe=Ig(),LKe=vs(),Bme="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ",OM=class extends OKe{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:Bme})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[i,o]=n;Array.isArray(i)&&([,i]=i,[,o]=o);let s=new LKe;return s.consumedPoints=parseInt(i),s.isFirstInDuration=s.consumedPoints===t,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=o,s}_upsert(e,t,n,i=!1){return new Promise((o,s)=>{if(!this._isRedisReady())return s(new Error("Redis connection is not ready"));let a=Math.floor(n/1e3),c=this.client.multi();if(i)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((u,l)=>u?s(u):o(l));else if(a>0){let u=function(l,f){return l?s(l):o(f)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,u):this.client.eval(Bme,1,e,t,a,u)}else c.incrby(e,t).pttl(e).exec((u,l)=>u?s(u):o(l))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((i,o)=>{if(i)n(i);else{let[s]=o;if(s===null)return t(null);t(o)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,o)=>{i?n(i):t(o>0)})})}};Mme.exports=OM});var Vme=P((Pir,zme)=>{var BKe=Ig(),MKe=vs();function Fme(r){try{let e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(i=>parseInt(i));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}var G4=class extends BKe{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=Fme(this.client)}):(this._initCollection(),this._driverVersion=Fme(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?G4.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){let t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){let i=new MKe,o;return typeof n.value>"u"?o=n:o=n.value,i.isFirstInDuration=o.points===t,i.consumedPoints=o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire!==null?Math.max(new Date(o.expire).getTime()-Date.now(),0):-1,i}_upsert(e,t,n,i=!1,o={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let s=o.attrs||{},a,c;i?(a={key:e},a=Object.assign(a,s),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,s)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,s),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,s));let u={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?u.returnDocument="after":u.returnOriginal=!1,new Promise((l,f)=>{this._collection.findOneAndUpdate(a,c,u).then(h=>{l(h)}).catch(h=>{if(h&&h.code===11e3){let d=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),p={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},s)};this._collection.findOneAndUpdate(d,p,u).then(g=>{l(g)}).catch(g=>{g&&g.code===11e3?this._upsert(e,t,n,i).then(w=>l(w)).catch(w=>f(w)):f(g)})}else f(h)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(i)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},i=Object.assign({key:e},n);return this._collection.deleteOne(i).then(o=>o.deletedCount>0)}};zme.exports=G4});var $me=P((kir,Kme)=>{var UKe=Ig(),FKe=vs(),LM=class extends UKe{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,i)=>{if(n)return t(n);e(i)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,i=>{if(i)return this._releaseConnection(n),t(i);n.query(this._getCreateTableStmt(),o=>{if(o)return this._releaseConnection(n),t(o);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let i=new FKe,[o]=n;return i.isFirstInDuration=t===o.points,i.consumedPoints=i.isFirstInDuration?t:o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire?Math.max(o.expire-Date.now(),0):-1,i}_upsertTransaction(e,t,n,i,o){return new Promise((s,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);let u=Date.now(),l=i>0?u+i:null,f,h;o?(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,h=[this.dbName,this.tableName,t,n,l,n,l]):(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,h=[this.dbName,this.tableName,t,n,l,u,n,n,u,l]),e.query(f,h,d=>{if(d)return e.rollback(),a(d);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(p,g)=>{if(p)return e.rollback(),a(p);e.query("COMMIT",w=>{if(w)return e.rollback(),a(w);s(g)})})})})})}_upsert(e,t,n,i=!1){return this.tableCreated?new Promise((o,s)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,i).then(c=>{o(c),this._releaseConnection(a)}).catch(c=>{s(c),this._releaseConnection(a)})}).catch(a=>{s(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(o,s)=>{o?n(o):s.length===0?t(null):t(s),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(i=>{i.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(o,s)=>{o?n(o):t(s.affectedRows>0),this._releaseConnection(i)})}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}};Kme.exports=LM});var Hme=P((Nir,qme)=>{var zKe=Ig(),VKe=vs(),BM=class extends zKe{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{let n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){let t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let i=new VKe,o=n.rows[0];return i.isFirstInDuration=t===o.points,i.consumedPoints=i.isFirstInDuration?t:o.points,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=o.expire?Math.max(o.expire-Date.now(),0):-1,i}_query(e){let n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((i,o)=>{this._getConnection().then(s=>{s.query(n).then(a=>{i(a),this._releaseConnection(s)}).catch(a=>{o(a),this._releaseConnection(s)})}).catch(s=>{o(s)})})}_upsert(e,t,n,i=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let o=n>0?Date.now()+n:null,s=i?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:i?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${i?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${s}
            RETURNING points, expire;`,values:[e,t,o,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(i=>{i.rowCount===0&&(i=null),t(i)}).catch(i=>{n(i)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};qme.exports=BM});var jme=P((Oir,Gme)=>{Gme.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}});var Yme=P((Bir,Wme)=>{var KKe=jme(),MM=vs();Wme.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){let i=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return i!==0?(this._storage[e].value=this._storage[e].value+t,new MM(0,i,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let i=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new KKe(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new MM(0,i===0?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){let t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new MM(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}}});var FM=P((Mir,Xme)=>{var $Ke=H4(),qKe=Yme(),Qme=vs(),UM=class extends $Ke{constructor(e={}){super(e),this._memoryStorage=new qKe}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=this.getKey(e),a=this._getKeySecDuration(n),c=this._memoryStorage.incrby(s,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(s,c.consumedPoints,this.blockDuration)),o(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(i,u,c)}else i(c)})}penalty(e,t=1,n={}){let i=this.getKey(e);return new Promise(o=>{let s=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,t,s);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),o(a)})}reward(e,t=1,n={}){let i=this.getKey(e);return new Promise(o=>{let s=this._getKeySecDuration(n),a=this._memoryStorage.incrby(i,-t,s);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),o(a)})}block(e,t){let n=t*1e3,i=this.points+1;return this._memoryStorage.set(this.getKey(e),i,t),Promise.resolve(new Qme(0,n===0?-1:n,i))}set(e,t,n){let i=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new Qme(0,i===0?-1:i,t))}get(e){let t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};Xme.exports=UM});var i2e=P((Uir,n2e)=>{var Zme=HL(),HKe=Ju(),GKe=H4(),e2e=FM(),jKe=vs(),ya="rate_limiter_flexible",Pg=null,Jme=function(r,e,t,n){let i;n===null||n===!0||n===!1?i=n:i={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:ya,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:i})},t2e=function(r){setTimeout(()=>{this._initiated?process.send(r):typeof this._promises[r.promiseId]<"u"&&t2e.call(this,r)},30)},Rg=function(r,e,t,n,i){let o={channel:ya,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:i}};this._initiated?process.send(o):t2e.call(this,o)},r2e=function(r,e){if(!e||e.channel!==ya||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{Jme(r,e,"resolve",n)}).catch(n=>{Jme(r,e,"reject",n)})},WKe=function(r){if(!r||r.channel!==ya||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new jKe(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},YKe=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},Cg=function(r,e){let t=process.hrtime(),n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=HKe.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n},zM=class{constructor(){if(Pg)return Pg;this._rateLimiters={},Zme.setMaxListeners(0),Zme.on("message",(e,t)=>{t&&t.channel===ya&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new e2e(t.opts)),e.send({channel:ya,type:"init",keyPrefix:t.opts.keyPrefix})):r2e.call(this,e,t)}),Pg=this}},VM=class{constructor(e){if(Pg)return Pg;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",i=>{let o=i.raw;if(o&&o.channel===ya&&o.type==="init")typeof this._rateLimiters[o.opts.keyPrefix]>"u"&&(this._rateLimiters[o.opts.keyPrefix]=new e2e(o.opts)),e.sendDataToProcessId(i.process.pm_id,{data:{},topic:ya,channel:ya,type:"init",keyPrefix:o.opts.keyPrefix},(s,a)=>{s&&console.log(s,a)});else{let s={send:a=>{let c=a;c.topic=ya,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(i.process.pm_id,c,(u,l)=>{u&&console.log(u,l)})}};r2e.call(this,s,o)}})}),Pg=this}},KM=class extends GKe{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",t=>{t&&t.channel===ya&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:WKe.call(this,t)}),process.send({channel:ya,type:"init",opts:YKe.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((i,o)=>{let s=Cg.call(this,i,o);Rg.call(this,"consume",s,e,t,n)})}penalty(e,t=1,n={}){return new Promise((i,o)=>{let s=Cg.call(this,i,o);Rg.call(this,"penalty",s,e,t,n)})}reward(e,t=1,n={}){return new Promise((i,o)=>{let s=Cg.call(this,i,o);Rg.call(this,"reward",s,e,t,n)})}block(e,t,n={}){return new Promise((i,o)=>{let s=Cg.call(this,i,o);Rg.call(this,"block",s,e,t,n)})}get(e,t={}){return new Promise((n,i)=>{let o=Cg.call(this,n,i);Rg.call(this,"get",o,e,t)})}delete(e,t={}){return new Promise((n,i)=>{let o=Cg.call(this,n,i);Rg.call(this,"delete",o,e,t)})}};n2e.exports={RateLimiterClusterMaster:zM,RateLimiterClusterMasterPM2:VM,RateLimiterCluster:KM}});var s2e=P((Fir,o2e)=>{var QKe=Ig(),XKe=vs(),$M=class extends QKe{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){let i=new XKe;return i.consumedPoints=parseInt(n.consumedPoints),i.isFirstInDuration=n.consumedPoints===t,i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.msBeforeNext=n.msBeforeNext,i}_upsert(e,t,n,i=!1,o={}){return new Promise((s,a)=>{let c=Date.now(),u=Math.floor(n/1e3);i?this.client.set(e,t,u,l=>{l?a(l):this.client.set(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let f={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};s(f)})}):this.client.incr(e,t,(l,f)=>{l||f===!1?this.client.add(e,t,u,(h,d)=>{if(h||!d)if(typeof o.attemptNumber>"u"||o.attemptNumber<3){let p=Object.assign({},o);p.attemptNumber=p.attemptNumber?p.attemptNumber+1:1,this._upsert(e,t,n,i,p).then(g=>s(g)).catch(g=>a(g))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{let p={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};s(p)})}):this.client.get(`${e}_expire`,(h,d)=>{if(h)a(h);else{let p=d===!1?0:d,g={consumedPoints:f,msBeforeNext:p>=0?Math.max(p-c,0):-1};s(g)}})})})}_get(e){return new Promise((t,n)=>{let i=Date.now();this.client.get(e,(o,s)=>{s?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{let u=c===!1?0:c,l={consumedPoints:s,msBeforeNext:u>=0?Math.max(u-i,0):-1};t(l)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(i,o)=>{i?n(i):o===!1?t(o):this.client.del(`${e}_expire`,s=>{s?n(s):t(o)})})})}};o2e.exports=$M});var u2e=P((Vir,c2e)=>{var a2e=vs();c2e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new a2e(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new a2e(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}});var f2e=P(($ir,l2e)=>{var ZKe=H4();l2e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof ZKe))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,i)=>{let o=[];this._limiters.forEach(s=>{o.push(s.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(o).then(s=>{let a={},c=!1;s.forEach(u=>{u.rejected===!0&&(c=!0)});for(let u=0;u<s.length;u++)c&&s[u].rejected===!0?a[this._limiters[u].keyPrefix]=s[u].rej:c||(a[this._limiters[u].keyPrefix]=s[u]);c?i(a):n(a)})})}}});var h2e=P((Hir,d2e)=>{d2e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}});var y2e=P((jir,g2e)=>{var p2e=h2e(),m2e=4294967295,qM="limiter";g2e.exports=class{constructor(e,t={maxQueueSize:m2e}){this._queueLimiters={KEY_DEFAULT:new iS(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=qM){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=qM){return this._queueLimiters[t]||(this._queueLimiters[t]=new iS(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};var iS=class{constructor(e,t={maxQueueSize:m2e,key:qM}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){let t=this;return new Promise((n,i)=>{if(e>t._limiterFlexible.points){i(new p2e(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,i,e):t._limiterFlexible.consume(t._key,e).then(o=>{n(o.remainingPoints)}).catch(o=>{o instanceof Error?i(o):(t._queueRequest.call(t,n,i,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),o.msBeforeNext)))})})}_queueRequest(e,t,n){let i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:n}):t(new p2e(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){let e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;let t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}});var b2e=P((Yir,w2e)=>{var HM=vs();w2e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new HM(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(i=>i instanceof HM?this._burstLimiter.consume(e,t,n).then(o=>Promise.resolve(this._combineRes(i,o))).catch(o=>o instanceof HM?Promise.reject(this._combineRes(i,o)):Promise.reject(o)):Promise.reject(i))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}}});var E2e=P((Qir,_2e)=>{var JKe=Ume(),e$e=Vme(),t$e=$me(),r$e=Hme(),{RateLimiterClusterMaster:n$e,RateLimiterClusterMasterPM2:i$e,RateLimiterCluster:o$e}=i2e(),s$e=FM(),a$e=s2e(),c$e=u2e(),u$e=f2e(),l$e=y2e(),f$e=b2e(),d$e=vs();_2e.exports={RateLimiterRedis:JKe,RateLimiterMongo:e$e,RateLimiterMySQL:t$e,RateLimiterPostgres:r$e,RateLimiterMemory:s$e,RateLimiterMemcache:a$e,RateLimiterClusterMaster:n$e,RateLimiterClusterMasterPM2:i$e,RateLimiterCluster:o$e,RLWrapperBlackAndWhite:c$e,RateLimiterUnion:u$e,RateLimiterQueue:l$e,BurstyRateLimiter:f$e,RateLimiterRes:d$e}});var P2e=P(XM=>{"use strict";Object.defineProperty(XM,"__esModule",{value:!0});function _$e(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}XM.isSerializableHash=_$e});var hS=P(kg=>{"use strict";Object.defineProperty(kg,"__esModule",{value:!0});function E$e(r,e,t){return~(r-1)&e|r-1&t}kg.select=E$e;function v$e(r,e){return(r|0)-(e|0)-1>>>31&1}kg.lessOrEqual=v$e;function k2e(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}kg.compare=k2e;function x$e(r,e){return r.length===0||e.length===0?!1:k2e(r,e)!==0}kg.equal=x$e});var Su=P(ZM=>{"use strict";Object.defineProperty(ZM,"__esModule",{value:!0});function S$e(r){for(var e=0;e<r.length;e++)r[e]=0;return r}ZM.wipe=S$e});var D2e=P(W4=>{"use strict";Object.defineProperty(W4,"__esModule",{value:!0});var Au=P2e(),A$e=hS(),T$e=Su(),N2e=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),Au.isSerializableHash(this._inner)&&Au.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),T$e.wipe(n)}return r.prototype.reset=function(){if(!Au.isSerializableHash(this._inner)||!Au.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){Au.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Au.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!Au.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!Au.isSerializableHash(this._inner)||!Au.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!Au.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();W4.HMAC=N2e;function I$e(r,e,t){var n=new N2e(r,e);n.update(t);var i=n.digest();return n.clean(),i}W4.hmac=I$e;W4.equal=A$e.equal});var B2e=P(JM=>{"use strict";Object.defineProperty(JM,"__esModule",{value:!0});var O2e=D2e(),L2e=Su(),R$e=function(){function r(e,t,n,i){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var o=O2e.hmac(this._hash,n,t);this._hmac=new O2e.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),n=0;n<t.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[n]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),L2e.wipe(this._buffer),L2e.wipe(this._counter),this._bufpos=0},r}();JM.HKDF=R$e});var U2e=P(pS=>{"use strict";Object.defineProperty(pS,"__esModule",{value:!0});pS.BrowserRandomSource=void 0;var M2e=65536,eU=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;let e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");let t=new Uint8Array(e);for(let n=0;n<t.length;n+=M2e)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,M2e)));return t}};pS.BrowserRandomSource=eU});var F2e=P(mS=>{"use strict";Object.defineProperty(mS,"__esModule",{value:!0});mS.NodeRandomSource=void 0;var C$e=Su(),tU=class{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof k0<"u"){let e=Ju();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");let n=new Uint8Array(e);for(let i=0;i<n.length;i++)n[i]=t[i];return(0,C$e.wipe)(t),n}};mS.NodeRandomSource=tU});var z2e=P(gS=>{"use strict";Object.defineProperty(gS,"__esModule",{value:!0});gS.SystemRandomSource=void 0;var P$e=U2e(),k$e=F2e(),rU=class{constructor(){if(this.isAvailable=!1,this.name="",this._source=new P$e.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new k$e.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}};gS.SystemRandomSource=rU});var V2e=P(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});function N$e(r,e){var t=r>>>16&65535,n=r&65535,i=e>>>16&65535,o=e&65535;return n*o+(t*o+n*i<<16>>>0)|0}xs.mul=Math.imul||N$e;function D$e(r,e){return r+e|0}xs.add=D$e;function O$e(r,e){return r-e|0}xs.sub=O$e;function L$e(r,e){return r<<e|r>>>32-e}xs.rotl=L$e;function B$e(r,e){return r<<32-e|r>>>e}xs.rotr=B$e;function M$e(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r}xs.isInteger=Number.isInteger||M$e;xs.MAX_SAFE_INTEGER=9007199254740991;xs.isSafeInteger=function(r){return xs.isInteger(r)&&r>=-xs.MAX_SAFE_INTEGER&&r<=xs.MAX_SAFE_INTEGER}});var Y4=P(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});var K2e=V2e();function U$e(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}At.readInt16BE=U$e;function F$e(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}At.readUint16BE=F$e;function z$e(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}At.readInt16LE=z$e;function V$e(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}At.readUint16LE=V$e;function $2e(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}At.writeUint16BE=$2e;At.writeInt16BE=$2e;function q2e(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}At.writeUint16LE=q2e;At.writeInt16LE=q2e;function nU(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}At.readInt32BE=nU;function iU(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}At.readUint32BE=iU;function oU(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}At.readInt32LE=oU;function sU(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}At.readUint32LE=sU;function yS(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}At.writeUint32BE=yS;At.writeInt32BE=yS;function wS(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}At.writeUint32LE=wS;At.writeInt32LE=wS;function K$e(r,e){e===void 0&&(e=0);var t=nU(r,e),n=nU(r,e+4);return t*4294967296+n-(n>>31)*4294967296}At.readInt64BE=K$e;function $$e(r,e){e===void 0&&(e=0);var t=iU(r,e),n=iU(r,e+4);return t*4294967296+n}At.readUint64BE=$$e;function q$e(r,e){e===void 0&&(e=0);var t=oU(r,e),n=oU(r,e+4);return n*4294967296+t-(t>>31)*4294967296}At.readInt64LE=q$e;function H$e(r,e){e===void 0&&(e=0);var t=sU(r,e),n=sU(r,e+4);return n*4294967296+t}At.readUint64LE=H$e;function H2e(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),yS(r/4294967296>>>0,e,t),yS(r>>>0,e,t+4),e}At.writeUint64BE=H2e;At.writeInt64BE=H2e;function G2e(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),wS(r>>>0,e,t),wS(r/4294967296>>>0,e,t+4),e}At.writeUint64LE=G2e;At.writeInt64LE=G2e;function G$e(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,o=r/8+t-1;o>=t;o--)n+=e[o]*i,i*=256;return n}At.readUintBE=G$e;function j$e(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,o=t;o<t+r/8;o++)n+=e[o]*i,i*=256;return n}At.readUintLE=j$e;function W$e(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!K2e.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,o=r/8+n-1;o>=n;o--)t[o]=e/i&255,i*=256;return t}At.writeUintBE=W$e;function Y$e(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!K2e.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,o=n;o<n+r/8;o++)t[o]=e/i&255,i*=256;return t}At.writeUintLE=Y$e;function Q$e(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}At.readFloat32BE=Q$e;function X$e(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}At.readFloat32LE=X$e;function Z$e(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}At.readFloat64BE=Z$e;function J$e(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}At.readFloat64LE=J$e;function eqe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}At.writeFloat32BE=eqe;function tqe(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}At.writeFloat32LE=tqe;function rqe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}At.writeFloat64BE=rqe;function nqe(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}At.writeFloat64LE=nqe});var Q2e=P(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.randomStringForEntropy=ji.randomString=ji.randomUint32=ji.randomBytes=ji.defaultRandomSource=void 0;var iqe=z2e(),oqe=Y4(),j2e=Su();ji.defaultRandomSource=new iqe.SystemRandomSource;function aU(r,e=ji.defaultRandomSource){return e.randomBytes(r)}ji.randomBytes=aU;function sqe(r=ji.defaultRandomSource){let e=aU(4,r),t=(0,oqe.readUint32LE)(e);return(0,j2e.wipe)(e),t}ji.randomUint32=sqe;var W2e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Y2e(r,e=W2e,t=ji.defaultRandomSource){if(e.length<2)throw new Error("randomString charset is too short");if(e.length>256)throw new Error("randomString charset is too long");let n="",i=e.length,o=256-256%i;for(;r>0;){let s=aU(Math.ceil(r*256/o),t);for(let a=0;a<s.length&&r>0;a++){let c=s[a];c<o&&(n+=e.charAt(c%i),r--)}(0,j2e.wipe)(s)}return n}ji.randomString=Y2e;function aqe(r,e=W2e,t=ji.defaultRandomSource){let n=Math.ceil(r/(Math.log(e.length)/Math.LN2));return Y2e(n,e,t)}ji.randomStringForEntropy=aqe});var ege=P(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.sharedKey=dn.generateKeyPair=dn.generateKeyPairFromSeed=dn.scalarMultBase=dn.scalarMult=dn.SHARED_KEY_LENGTH=dn.SECRET_KEY_LENGTH=dn.PUBLIC_KEY_LENGTH=void 0;var cqe=Q2e(),uqe=Su();dn.PUBLIC_KEY_LENGTH=32;dn.SECRET_KEY_LENGTH=32;dn.SHARED_KEY_LENGTH=32;function Tu(r){let e=new Float64Array(16);if(r)for(let t=0;t<r.length;t++)e[t]=r[t];return e}var X2e=new Uint8Array(32);X2e[0]=9;var lqe=Tu([56129,1]);function cU(r){let e=1;for(let t=0;t<16;t++){let n=r[t]+e+65535;e=Math.floor(n/65536),r[t]=n-e*65536}r[0]+=e-1+37*(e-1)}function Q4(r,e,t){let n=~(t-1);for(let i=0;i<16;i++){let o=n&(r[i]^e[i]);r[i]^=o,e[i]^=o}}function fqe(r,e){let t=Tu(),n=Tu();for(let i=0;i<16;i++)n[i]=e[i];cU(n),cU(n),cU(n);for(let i=0;i<2;i++){t[0]=n[0]-65517;for(let s=1;s<15;s++)t[s]=n[s]-65535-(t[s-1]>>16&1),t[s-1]&=65535;t[15]=n[15]-32767-(t[14]>>16&1);let o=t[15]>>16&1;t[14]&=65535,Q4(n,t,1-o)}for(let i=0;i<16;i++)r[2*i]=n[i]&255,r[2*i+1]=n[i]>>8}function dqe(r,e){for(let t=0;t<16;t++)r[t]=e[2*t]+(e[2*t+1]<<8);r[15]&=32767}function bS(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]+t[n]}function _S(r,e,t){for(let n=0;n<16;n++)r[n]=e[n]-t[n]}function Ql(r,e,t){let n,i,o=0,s=0,a=0,c=0,u=0,l=0,f=0,h=0,d=0,p=0,g=0,w=0,_=0,x=0,m=0,y=0,b=0,E=0,v=0,S=0,A=0,I=0,k=0,N=0,O=0,G=0,R=0,K=0,U=0,te=0,Ce=0,ae=t[0],$e=t[1],He=t[2],ot=t[3],Ge=t[4],Qe=t[5],Ze=t[6],Je=t[7],An=t[8],Tn=t[9],zn=t[10],In=t[11],Vn=t[12],Si=t[13],Ai=t[14],Ti=t[15];n=e[0],o+=n*ae,s+=n*$e,a+=n*He,c+=n*ot,u+=n*Ge,l+=n*Qe,f+=n*Ze,h+=n*Je,d+=n*An,p+=n*Tn,g+=n*zn,w+=n*In,_+=n*Vn,x+=n*Si,m+=n*Ai,y+=n*Ti,n=e[1],s+=n*ae,a+=n*$e,c+=n*He,u+=n*ot,l+=n*Ge,f+=n*Qe,h+=n*Ze,d+=n*Je,p+=n*An,g+=n*Tn,w+=n*zn,_+=n*In,x+=n*Vn,m+=n*Si,y+=n*Ai,b+=n*Ti,n=e[2],a+=n*ae,c+=n*$e,u+=n*He,l+=n*ot,f+=n*Ge,h+=n*Qe,d+=n*Ze,p+=n*Je,g+=n*An,w+=n*Tn,_+=n*zn,x+=n*In,m+=n*Vn,y+=n*Si,b+=n*Ai,E+=n*Ti,n=e[3],c+=n*ae,u+=n*$e,l+=n*He,f+=n*ot,h+=n*Ge,d+=n*Qe,p+=n*Ze,g+=n*Je,w+=n*An,_+=n*Tn,x+=n*zn,m+=n*In,y+=n*Vn,b+=n*Si,E+=n*Ai,v+=n*Ti,n=e[4],u+=n*ae,l+=n*$e,f+=n*He,h+=n*ot,d+=n*Ge,p+=n*Qe,g+=n*Ze,w+=n*Je,_+=n*An,x+=n*Tn,m+=n*zn,y+=n*In,b+=n*Vn,E+=n*Si,v+=n*Ai,S+=n*Ti,n=e[5],l+=n*ae,f+=n*$e,h+=n*He,d+=n*ot,p+=n*Ge,g+=n*Qe,w+=n*Ze,_+=n*Je,x+=n*An,m+=n*Tn,y+=n*zn,b+=n*In,E+=n*Vn,v+=n*Si,S+=n*Ai,A+=n*Ti,n=e[6],f+=n*ae,h+=n*$e,d+=n*He,p+=n*ot,g+=n*Ge,w+=n*Qe,_+=n*Ze,x+=n*Je,m+=n*An,y+=n*Tn,b+=n*zn,E+=n*In,v+=n*Vn,S+=n*Si,A+=n*Ai,I+=n*Ti,n=e[7],h+=n*ae,d+=n*$e,p+=n*He,g+=n*ot,w+=n*Ge,_+=n*Qe,x+=n*Ze,m+=n*Je,y+=n*An,b+=n*Tn,E+=n*zn,v+=n*In,S+=n*Vn,A+=n*Si,I+=n*Ai,k+=n*Ti,n=e[8],d+=n*ae,p+=n*$e,g+=n*He,w+=n*ot,_+=n*Ge,x+=n*Qe,m+=n*Ze,y+=n*Je,b+=n*An,E+=n*Tn,v+=n*zn,S+=n*In,A+=n*Vn,I+=n*Si,k+=n*Ai,N+=n*Ti,n=e[9],p+=n*ae,g+=n*$e,w+=n*He,_+=n*ot,x+=n*Ge,m+=n*Qe,y+=n*Ze,b+=n*Je,E+=n*An,v+=n*Tn,S+=n*zn,A+=n*In,I+=n*Vn,k+=n*Si,N+=n*Ai,O+=n*Ti,n=e[10],g+=n*ae,w+=n*$e,_+=n*He,x+=n*ot,m+=n*Ge,y+=n*Qe,b+=n*Ze,E+=n*Je,v+=n*An,S+=n*Tn,A+=n*zn,I+=n*In,k+=n*Vn,N+=n*Si,O+=n*Ai,G+=n*Ti,n=e[11],w+=n*ae,_+=n*$e,x+=n*He,m+=n*ot,y+=n*Ge,b+=n*Qe,E+=n*Ze,v+=n*Je,S+=n*An,A+=n*Tn,I+=n*zn,k+=n*In,N+=n*Vn,O+=n*Si,G+=n*Ai,R+=n*Ti,n=e[12],_+=n*ae,x+=n*$e,m+=n*He,y+=n*ot,b+=n*Ge,E+=n*Qe,v+=n*Ze,S+=n*Je,A+=n*An,I+=n*Tn,k+=n*zn,N+=n*In,O+=n*Vn,G+=n*Si,R+=n*Ai,K+=n*Ti,n=e[13],x+=n*ae,m+=n*$e,y+=n*He,b+=n*ot,E+=n*Ge,v+=n*Qe,S+=n*Ze,A+=n*Je,I+=n*An,k+=n*Tn,N+=n*zn,O+=n*In,G+=n*Vn,R+=n*Si,K+=n*Ai,U+=n*Ti,n=e[14],m+=n*ae,y+=n*$e,b+=n*He,E+=n*ot,v+=n*Ge,S+=n*Qe,A+=n*Ze,I+=n*Je,k+=n*An,N+=n*Tn,O+=n*zn,G+=n*In,R+=n*Vn,K+=n*Si,U+=n*Ai,te+=n*Ti,n=e[15],y+=n*ae,b+=n*$e,E+=n*He,v+=n*ot,S+=n*Ge,A+=n*Qe,I+=n*Ze,k+=n*Je,N+=n*An,O+=n*Tn,G+=n*zn,R+=n*In,K+=n*Vn,U+=n*Si,te+=n*Ai,Ce+=n*Ti,o+=38*b,s+=38*E,a+=38*v,c+=38*S,u+=38*A,l+=38*I,f+=38*k,h+=38*N,d+=38*O,p+=38*G,g+=38*R,w+=38*K,_+=38*U,x+=38*te,m+=38*Ce,i=1,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=l+i+65535,i=Math.floor(n/65536),l=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=_+i+65535,i=Math.floor(n/65536),_=n-i*65536,n=x+i+65535,i=Math.floor(n/65536),x=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=y+i+65535,i=Math.floor(n/65536),y=n-i*65536,o+=i-1+37*(i-1),i=1,n=o+i+65535,i=Math.floor(n/65536),o=n-i*65536,n=s+i+65535,i=Math.floor(n/65536),s=n-i*65536,n=a+i+65535,i=Math.floor(n/65536),a=n-i*65536,n=c+i+65535,i=Math.floor(n/65536),c=n-i*65536,n=u+i+65535,i=Math.floor(n/65536),u=n-i*65536,n=l+i+65535,i=Math.floor(n/65536),l=n-i*65536,n=f+i+65535,i=Math.floor(n/65536),f=n-i*65536,n=h+i+65535,i=Math.floor(n/65536),h=n-i*65536,n=d+i+65535,i=Math.floor(n/65536),d=n-i*65536,n=p+i+65535,i=Math.floor(n/65536),p=n-i*65536,n=g+i+65535,i=Math.floor(n/65536),g=n-i*65536,n=w+i+65535,i=Math.floor(n/65536),w=n-i*65536,n=_+i+65535,i=Math.floor(n/65536),_=n-i*65536,n=x+i+65535,i=Math.floor(n/65536),x=n-i*65536,n=m+i+65535,i=Math.floor(n/65536),m=n-i*65536,n=y+i+65535,i=Math.floor(n/65536),y=n-i*65536,o+=i-1+37*(i-1),r[0]=o,r[1]=s,r[2]=a,r[3]=c,r[4]=u,r[5]=l,r[6]=f,r[7]=h,r[8]=d,r[9]=p,r[10]=g,r[11]=w,r[12]=_,r[13]=x,r[14]=m,r[15]=y}function X4(r,e){Ql(r,e,e)}function hqe(r,e){let t=Tu();for(let n=0;n<16;n++)t[n]=e[n];for(let n=253;n>=0;n--)X4(t,t),n!==2&&n!==4&&Ql(t,t,e);for(let n=0;n<16;n++)r[n]=t[n]}function uU(r,e){let t=new Uint8Array(32),n=new Float64Array(80),i=Tu(),o=Tu(),s=Tu(),a=Tu(),c=Tu(),u=Tu();for(let d=0;d<31;d++)t[d]=r[d];t[31]=r[31]&127|64,t[0]&=248,dqe(n,e);for(let d=0;d<16;d++)o[d]=n[d];i[0]=a[0]=1;for(let d=254;d>=0;--d){let p=t[d>>>3]>>>(d&7)&1;Q4(i,o,p),Q4(s,a,p),bS(c,i,s),_S(i,i,s),bS(s,o,a),_S(o,o,a),X4(a,c),X4(u,i),Ql(i,s,i),Ql(s,o,c),bS(c,i,s),_S(i,i,s),X4(o,i),_S(s,a,u),Ql(i,s,lqe),bS(i,i,a),Ql(s,s,i),Ql(i,a,u),Ql(a,o,n),X4(o,c),Q4(i,o,p),Q4(s,a,p)}for(let d=0;d<16;d++)n[d+16]=i[d],n[d+32]=s[d],n[d+48]=o[d],n[d+64]=a[d];let l=n.subarray(32),f=n.subarray(16);hqe(l,l),Ql(f,f,l);let h=new Uint8Array(32);return fqe(h,f),h}dn.scalarMult=uU;function Z2e(r){return uU(r,X2e)}dn.scalarMultBase=Z2e;function J2e(r){if(r.length!==dn.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${dn.SECRET_KEY_LENGTH} bytes`);let e=new Uint8Array(r);return{publicKey:Z2e(e),secretKey:e}}dn.generateKeyPairFromSeed=J2e;function pqe(r){let e=(0,cqe.randomBytes)(32,r),t=J2e(e);return(0,uqe.wipe)(e),t}dn.generateKeyPair=pqe;function mqe(r,e,t=!1){if(r.length!==dn.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(e.length!==dn.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");let n=uU(r,e);if(t){let i=0;for(let o=0;o<n.length;o++)i|=n[o];if(i===0)throw new Error("X25519: invalid shared key")}return n}dn.sharedKey=mqe});var rge=P(sh=>{"use strict";Object.defineProperty(sh,"__esModule",{value:!0});var vS=Y4(),ES=Su();sh.DIGEST_LENGTH=32;sh.BLOCK_SIZE=64;var tge=function(){function r(){this.digestLength=sh.DIGEST_LENGTH,this.blockSize=sh.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return r.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},r.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},r.prototype.clean=function(){ES.wipe(this._buffer),ES.wipe(this._temp),this.reset()},r.prototype.update=function(e,t){if(t===void 0&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(lU(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(n=lU(this._temp,this._state,e,n,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[n++],t--;return this},r.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,i=t/536870912|0,o=t<<3,s=t%64<56?64:128;this._buffer[n]=128;for(var a=n+1;a<s-8;a++)this._buffer[a]=0;vS.writeUint32BE(i,this._buffer,s-8),vS.writeUint32BE(o,this._buffer,s-4),lU(this._temp,this._state,this._buffer,0,s),this._finished=!0}for(var a=0;a<this.digestLength/4;a++)vS.writeUint32BE(this._state[a],e,a*4);return this},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},r.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},r.prototype.cleanSavedState=function(e){ES.wipe(e.state),e.buffer&&ES.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},r}();sh.SHA256=tge;var gqe=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function lU(r,e,t,n,i){for(;i>=64;){for(var o=e[0],s=e[1],a=e[2],c=e[3],u=e[4],l=e[5],f=e[6],h=e[7],d=0;d<16;d++){var p=n+d*4;r[d]=vS.readUint32BE(t,p)}for(var d=16;d<64;d++){var g=r[d-2],w=(g>>>17|g<<32-17)^(g>>>19|g<<32-19)^g>>>10;g=r[d-15];var _=(g>>>7|g<<32-7)^(g>>>18|g<<32-18)^g>>>3;r[d]=(w+r[d-7]|0)+(_+r[d-16]|0)}for(var d=0;d<64;d++){var w=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&l^~u&f)|0)+(h+(gqe[d]+r[d]|0)|0)|0,_=((o>>>2|o<<32-2)^(o>>>13|o<<32-13)^(o>>>22|o<<32-22))+(o&s^o&a^s&a)|0;h=f,f=l,l=u,u=c+w|0,c=a,a=s,s=o,o=w+_|0}e[0]+=o,e[1]+=s,e[2]+=a,e[3]+=c,e[4]+=u,e[5]+=l,e[6]+=f,e[7]+=h,n+=64,i-=64}return n}function yqe(r){var e=new tge;e.update(r);var t=e.digest();return e.clean(),t}sh.hash=yqe});var ige=P(xS=>{"use strict";Object.defineProperty(xS,"__esModule",{value:!0});var Wi=Y4(),fU=Su(),wqe=20;function bqe(r,e,t){for(var n=1634760805,i=857760878,o=2036477234,s=1797285236,a=t[3]<<24|t[2]<<16|t[1]<<8|t[0],c=t[7]<<24|t[6]<<16|t[5]<<8|t[4],u=t[11]<<24|t[10]<<16|t[9]<<8|t[8],l=t[15]<<24|t[14]<<16|t[13]<<8|t[12],f=t[19]<<24|t[18]<<16|t[17]<<8|t[16],h=t[23]<<24|t[22]<<16|t[21]<<8|t[20],d=t[27]<<24|t[26]<<16|t[25]<<8|t[24],p=t[31]<<24|t[30]<<16|t[29]<<8|t[28],g=e[3]<<24|e[2]<<16|e[1]<<8|e[0],w=e[7]<<24|e[6]<<16|e[5]<<8|e[4],_=e[11]<<24|e[10]<<16|e[9]<<8|e[8],x=e[15]<<24|e[14]<<16|e[13]<<8|e[12],m=n,y=i,b=o,E=s,v=a,S=c,A=u,I=l,k=f,N=h,O=d,G=p,R=g,K=w,U=_,te=x,Ce=0;Ce<wqe;Ce+=2)m=m+v|0,R^=m,R=R>>>32-16|R<<16,k=k+R|0,v^=k,v=v>>>32-12|v<<12,y=y+S|0,K^=y,K=K>>>32-16|K<<16,N=N+K|0,S^=N,S=S>>>32-12|S<<12,b=b+A|0,U^=b,U=U>>>32-16|U<<16,O=O+U|0,A^=O,A=A>>>32-12|A<<12,E=E+I|0,te^=E,te=te>>>32-16|te<<16,G=G+te|0,I^=G,I=I>>>32-12|I<<12,b=b+A|0,U^=b,U=U>>>32-8|U<<8,O=O+U|0,A^=O,A=A>>>32-7|A<<7,E=E+I|0,te^=E,te=te>>>32-8|te<<8,G=G+te|0,I^=G,I=I>>>32-7|I<<7,y=y+S|0,K^=y,K=K>>>32-8|K<<8,N=N+K|0,S^=N,S=S>>>32-7|S<<7,m=m+v|0,R^=m,R=R>>>32-8|R<<8,k=k+R|0,v^=k,v=v>>>32-7|v<<7,m=m+S|0,te^=m,te=te>>>32-16|te<<16,O=O+te|0,S^=O,S=S>>>32-12|S<<12,y=y+A|0,R^=y,R=R>>>32-16|R<<16,G=G+R|0,A^=G,A=A>>>32-12|A<<12,b=b+I|0,K^=b,K=K>>>32-16|K<<16,k=k+K|0,I^=k,I=I>>>32-12|I<<12,E=E+v|0,U^=E,U=U>>>32-16|U<<16,N=N+U|0,v^=N,v=v>>>32-12|v<<12,b=b+I|0,K^=b,K=K>>>32-8|K<<8,k=k+K|0,I^=k,I=I>>>32-7|I<<7,E=E+v|0,U^=E,U=U>>>32-8|U<<8,N=N+U|0,v^=N,v=v>>>32-7|v<<7,y=y+A|0,R^=y,R=R>>>32-8|R<<8,G=G+R|0,A^=G,A=A>>>32-7|A<<7,m=m+S|0,te^=m,te=te>>>32-8|te<<8,O=O+te|0,S^=O,S=S>>>32-7|S<<7;Wi.writeUint32LE(m+n|0,r,0),Wi.writeUint32LE(y+i|0,r,4),Wi.writeUint32LE(b+o|0,r,8),Wi.writeUint32LE(E+s|0,r,12),Wi.writeUint32LE(v+a|0,r,16),Wi.writeUint32LE(S+c|0,r,20),Wi.writeUint32LE(A+u|0,r,24),Wi.writeUint32LE(I+l|0,r,28),Wi.writeUint32LE(k+f|0,r,32),Wi.writeUint32LE(N+h|0,r,36),Wi.writeUint32LE(O+d|0,r,40),Wi.writeUint32LE(G+p|0,r,44),Wi.writeUint32LE(R+g|0,r,48),Wi.writeUint32LE(K+w|0,r,52),Wi.writeUint32LE(U+_|0,r,56),Wi.writeUint32LE(te+x|0,r,60)}function nge(r,e,t,n,i){if(i===void 0&&(i=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var o,s;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),s=o.length-e.length,o.set(e,s)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,s=i}for(var a=new Uint8Array(64),c=0;c<t.length;c+=64){bqe(a,o,r);for(var u=c;u<c+64&&u<t.length;u++)n[u]=t[u]^a[u-c];Eqe(o,0,s)}return fU.wipe(a),i===0&&fU.wipe(o),n}xS.streamXOR=nge;function _qe(r,e,t,n){return n===void 0&&(n=0),fU.wipe(t),nge(r,e,t,t,n)}xS.stream=_qe;function Eqe(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}});var sge=P(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});var vqe=hS(),SS=Su();Xl.DIGEST_LENGTH=16;var oge=function(){function r(e){this.digestLength=Xl.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var t=e[0]|e[1]<<8;this._r[0]=t&8191;var n=e[2]|e[3]<<8;this._r[1]=(t>>>13|n<<3)&8191;var i=e[4]|e[5]<<8;this._r[2]=(n>>>10|i<<6)&7939;var o=e[6]|e[7]<<8;this._r[3]=(i>>>7|o<<9)&8191;var s=e[8]|e[9]<<8;this._r[4]=(o>>>4|s<<12)&255,this._r[5]=s>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=(s>>>14|a<<2)&8191;var c=e[12]|e[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var u=e[14]|e[15]<<8;this._r[8]=(c>>>8|u<<8)&8191,this._r[9]=u>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return r.prototype._blocks=function(e,t,n){for(var i=this._fin?0:2048,o=this._h[0],s=this._h[1],a=this._h[2],c=this._h[3],u=this._h[4],l=this._h[5],f=this._h[6],h=this._h[7],d=this._h[8],p=this._h[9],g=this._r[0],w=this._r[1],_=this._r[2],x=this._r[3],m=this._r[4],y=this._r[5],b=this._r[6],E=this._r[7],v=this._r[8],S=this._r[9];n>=16;){var A=e[t+0]|e[t+1]<<8;o+=A&8191;var I=e[t+2]|e[t+3]<<8;s+=(A>>>13|I<<3)&8191;var k=e[t+4]|e[t+5]<<8;a+=(I>>>10|k<<6)&8191;var N=e[t+6]|e[t+7]<<8;c+=(k>>>7|N<<9)&8191;var O=e[t+8]|e[t+9]<<8;u+=(N>>>4|O<<12)&8191,l+=O>>>1&8191;var G=e[t+10]|e[t+11]<<8;f+=(O>>>14|G<<2)&8191;var R=e[t+12]|e[t+13]<<8;h+=(G>>>11|R<<5)&8191;var K=e[t+14]|e[t+15]<<8;d+=(R>>>8|K<<8)&8191,p+=K>>>5|i;var U=0,te=U;te+=o*g,te+=s*(5*S),te+=a*(5*v),te+=c*(5*E),te+=u*(5*b),U=te>>>13,te&=8191,te+=l*(5*y),te+=f*(5*m),te+=h*(5*x),te+=d*(5*_),te+=p*(5*w),U+=te>>>13,te&=8191;var Ce=U;Ce+=o*w,Ce+=s*g,Ce+=a*(5*S),Ce+=c*(5*v),Ce+=u*(5*E),U=Ce>>>13,Ce&=8191,Ce+=l*(5*b),Ce+=f*(5*y),Ce+=h*(5*m),Ce+=d*(5*x),Ce+=p*(5*_),U+=Ce>>>13,Ce&=8191;var ae=U;ae+=o*_,ae+=s*w,ae+=a*g,ae+=c*(5*S),ae+=u*(5*v),U=ae>>>13,ae&=8191,ae+=l*(5*E),ae+=f*(5*b),ae+=h*(5*y),ae+=d*(5*m),ae+=p*(5*x),U+=ae>>>13,ae&=8191;var $e=U;$e+=o*x,$e+=s*_,$e+=a*w,$e+=c*g,$e+=u*(5*S),U=$e>>>13,$e&=8191,$e+=l*(5*v),$e+=f*(5*E),$e+=h*(5*b),$e+=d*(5*y),$e+=p*(5*m),U+=$e>>>13,$e&=8191;var He=U;He+=o*m,He+=s*x,He+=a*_,He+=c*w,He+=u*g,U=He>>>13,He&=8191,He+=l*(5*S),He+=f*(5*v),He+=h*(5*E),He+=d*(5*b),He+=p*(5*y),U+=He>>>13,He&=8191;var ot=U;ot+=o*y,ot+=s*m,ot+=a*x,ot+=c*_,ot+=u*w,U=ot>>>13,ot&=8191,ot+=l*g,ot+=f*(5*S),ot+=h*(5*v),ot+=d*(5*E),ot+=p*(5*b),U+=ot>>>13,ot&=8191;var Ge=U;Ge+=o*b,Ge+=s*y,Ge+=a*m,Ge+=c*x,Ge+=u*_,U=Ge>>>13,Ge&=8191,Ge+=l*w,Ge+=f*g,Ge+=h*(5*S),Ge+=d*(5*v),Ge+=p*(5*E),U+=Ge>>>13,Ge&=8191;var Qe=U;Qe+=o*E,Qe+=s*b,Qe+=a*y,Qe+=c*m,Qe+=u*x,U=Qe>>>13,Qe&=8191,Qe+=l*_,Qe+=f*w,Qe+=h*g,Qe+=d*(5*S),Qe+=p*(5*v),U+=Qe>>>13,Qe&=8191;var Ze=U;Ze+=o*v,Ze+=s*E,Ze+=a*b,Ze+=c*y,Ze+=u*m,U=Ze>>>13,Ze&=8191,Ze+=l*x,Ze+=f*_,Ze+=h*w,Ze+=d*g,Ze+=p*(5*S),U+=Ze>>>13,Ze&=8191;var Je=U;Je+=o*S,Je+=s*v,Je+=a*E,Je+=c*b,Je+=u*y,U=Je>>>13,Je&=8191,Je+=l*m,Je+=f*x,Je+=h*_,Je+=d*w,Je+=p*g,U+=Je>>>13,Je&=8191,U=(U<<2)+U|0,U=U+te|0,te=U&8191,U=U>>>13,Ce+=U,o=te,s=Ce,a=ae,c=$e,u=He,l=ot,f=Ge,h=Qe,d=Ze,p=Je,t+=16,n-=16}this._h[0]=o,this._h[1]=s,this._h[2]=a,this._h[3]=c,this._h[4]=u,this._h[5]=l,this._h[6]=f,this._h[7]=h,this._h[8]=d,this._h[9]=p},r.prototype.finish=function(e,t){t===void 0&&(t=0);var n=new Uint16Array(10),i,o,s,a;if(this._leftover){for(a=this._leftover,this._buffer[a++]=1;a<16;a++)this._buffer[a]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(i=this._h[1]>>>13,this._h[1]&=8191,a=2;a<10;a++)this._h[a]+=i,i=this._h[a]>>>13,this._h[a]&=8191;for(this._h[0]+=i*5,i=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=i,i=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=i,n[0]=this._h[0]+5,i=n[0]>>>13,n[0]&=8191,a=1;a<10;a++)n[a]=this._h[a]+i,i=n[a]>>>13,n[a]&=8191;for(n[9]-=8192,o=(i^1)-1,a=0;a<10;a++)n[a]&=o;for(o=~o,a=0;a<10;a++)this._h[a]=this._h[a]&o|n[a];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,s=this._h[0]+this._pad[0],this._h[0]=s&65535,a=1;a<8;a++)s=(this._h[a]+this._pad[a]|0)+(s>>>16)|0,this._h[a]=s&65535;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},r.prototype.update=function(e){var t=0,n=e.length,i;if(this._leftover){i=16-this._leftover,i>n&&(i=n);for(var o=0;o<i;o++)this._buffer[this._leftover+o]=e[t+o];if(n-=i,t+=i,this._leftover+=i,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(i=n-n%16,this._blocks(e,t,i),t+=i,n-=i),n){for(var o=0;o<n;o++)this._buffer[this._leftover+o]=e[t+o];this._leftover+=n}return this},r.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},r.prototype.clean=function(){return SS.wipe(this._buffer),SS.wipe(this._r),SS.wipe(this._h),SS.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},r}();Xl.Poly1305=oge;function xqe(r,e){var t=new oge(r);t.update(e);var n=t.digest();return t.clean(),n}Xl.oneTimeAuth=xqe;function Sqe(r,e){return r.length!==Xl.DIGEST_LENGTH||e.length!==Xl.DIGEST_LENGTH?!1:vqe.equal(r,e)}Xl.equal=Sqe});var dU=P(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});var AS=ige(),Aqe=sge(),Z4=Su(),age=Y4(),Tqe=hS();Zl.KEY_LENGTH=32;Zl.NONCE_LENGTH=12;Zl.TAG_LENGTH=16;var cge=new Uint8Array(16),Iqe=function(){function r(e){if(this.nonceLength=Zl.NONCE_LENGTH,this.tagLength=Zl.TAG_LENGTH,e.length!==Zl.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return r.prototype.seal=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(e,o.length-e.length);var s=new Uint8Array(32);AS.stream(this._key,o,s,4);var a=t.length+this.tagLength,c;if(i){if(i.length!==a)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(a);return AS.streamXOR(this._key,o,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),s,c.subarray(0,c.length-this.tagLength),n),Z4.wipe(o),c},r.prototype.open=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var o=new Uint8Array(16);o.set(e,o.length-e.length);var s=new Uint8Array(32);AS.stream(this._key,o,s,4);var a=new Uint8Array(this.tagLength);if(this._authenticate(a,s,t.subarray(0,t.length-this.tagLength),n),!Tqe.equal(a,t.subarray(t.length-this.tagLength,t.length)))return null;var c=t.length-this.tagLength,u;if(i){if(i.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");u=i}else u=new Uint8Array(c);return AS.streamXOR(this._key,o,t.subarray(0,t.length-this.tagLength),u,4),Z4.wipe(o),u},r.prototype.clean=function(){return Z4.wipe(this._key),this},r.prototype._authenticate=function(e,t,n,i){var o=new Aqe.Poly1305(t);i&&(o.update(i),i.length%16>0&&o.update(cge.subarray(i.length%16))),o.update(n),n.length%16>0&&o.update(cge.subarray(n.length%16));var s=new Uint8Array(8);i&&age.writeUint64LE(i.length,s),o.update(s),age.writeUint64LE(n.length,s),o.update(s);for(var a=o.digest(),c=0;c<a.length;c++)e[c]=a[c];o.clean(),Z4.wipe(a),Z4.wipe(s)},r}();Zl.ChaCha20Poly1305=Iqe});var Mge=P((Lar,Bge)=>{Bge.exports=Lge;var Oge=128,zqe=127,Vqe=~zqe,Kqe=Math.pow(2,31);function Lge(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Kqe;)e[t++]=r&255|Oge,r/=128;for(;r&Vqe;)e[t++]=r&255|Oge,r>>>=7;return e[t]=r|0,Lge.bytes=t-n+1,e}});var zge=P((Bar,Fge)=>{Fge.exports=vU;var $qe=128,Uge=127;function vU(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw vU.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&Uge)<<i:(s&Uge)*Math.pow(2,i),i+=7}while(s>=$qe);return vU.bytes=o-n,t}});var Kge=P((Mar,Vge)=>{var qqe=Math.pow(2,7),Hqe=Math.pow(2,14),Gqe=Math.pow(2,21),jqe=Math.pow(2,28),Wqe=Math.pow(2,35),Yqe=Math.pow(2,42),Qqe=Math.pow(2,49),Xqe=Math.pow(2,56),Zqe=Math.pow(2,63);Vge.exports=function(r){return r<qqe?1:r<Hqe?2:r<Gqe?3:r<jqe?4:r<Wqe?5:r<Yqe?6:r<Qqe?7:r<Xqe?8:r<Zqe?9:10}});var qge=P((Uar,$ge)=>{$ge.exports={encode:Mge(),decode:zge(),encodingLength:Kge()}});var jge=P((Far,Gge)=>{"use strict";var Hge=qge();Gge.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=Hge.decode(r);e.push(t),r=r.slice(Hge.decode.bytes)}return e}});var fye=P((uye,lye)=>{"use strict";var fHe=Math.exp;uye=lye.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,o=0,s,a={};function c(u,l){return 1-fHe(-(u-l)/e)}return a.push=function(l,f){if(s){let h=c(l,s),d=f-t,p=h*d;t=h*f+(1-h)*t,n=(1-h)*(n+d*p),i=Math.sqrt(n),o=t+h*d}else t=f;s=l},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return o},a}});var qye=P((mdr,YS)=>{(function(){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],e=typeof window<"u",t=e&&window.mozInnerScreenX!=null;function n(i,o,s){if(!e)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var a=s&&s.debug||!1;if(a){var c=document.querySelector("#input-textarea-caret-position-mirror-div");c&&c.parentNode.removeChild(c)}var u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);var l=u.style,f=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,h=i.nodeName==="INPUT";l.whiteSpace="pre-wrap",h||(l.wordWrap="break-word"),l.position="absolute",a||(l.visibility="hidden"),r.forEach(function(g){h&&g==="lineHeight"?l.lineHeight=f.height:l[g]=f[g]}),t?i.scrollHeight>parseInt(f.height)&&(l.overflowY="scroll"):l.overflow="hidden",u.textContent=i.value.substring(0,o),h&&(u.textContent=u.textContent.replace(/\s/g,"\xA0"));var d=document.createElement("span");d.textContent=i.value.substring(o)||".",u.appendChild(d);var p={top:d.offsetTop+parseInt(f.borderTopWidth),left:d.offsetLeft+parseInt(f.borderLeftWidth),height:parseInt(f.lineHeight)};return a?d.style.backgroundColor="#aaa":document.body.removeChild(u),p}typeof YS<"u"&&typeof YS.exports<"u"?YS.exports=n:e&&(window.getCaretCoordinates=n)})()});var N0=r=>Array.isArray(r);var u3e=r=>({el:document.querySelector(r),elements:document.querySelectorAll(r),placeholder(e){return this.el.placeholder=e,this},getValue(){return this.el.value},insertAtCaret(e){return this.el.setRangeText(e,this.el.selectionStart,this.el.selectionEnd,"end"),this},setValue(e){this.el.value=e;let t=new Event("input",{bubbles:!0,cancelable:!0});return this.el.dispatchEvent(t),this},innerHTML(e){return this.el.innerHTML=e,this},html(e){return this.el.innerHTML="",this.append(e),this},append(e){return(N0(e)?e:[e]).forEach(n=>{let i=D0(n)?n:document.createTextNode(n);this.el.appendChild(i)}),this},appendListElement(e){let t=document.createElement("LI");return t.appendChild(document.createTextNode(e)),this.el.appendChild(t),this},removeClass(e){return this.el.classList.remove(e),this},removeClasses(e=[]){return e.map(t=>this.removeClass(t)),this},addClass(e){return this.el.classList.add(e),this},hasClass(e){return(" "+this.el.className+" ").indexOf(" "+e+" ")>-1},show(e=!0){return e?this.removeClass("hidden"):this.hide(),this},hide(){return this.addClass("hidden"),this},toggle(e="hidden"){return this.hasClass(e)?this.removeClass(e):this.addClass(e),this},focus(){return this.el.focus(),this},listenAll(e,t){return Array.prototype.slice.call(this.elements).map(i=>{i.addEventListener(e,o=>t(o.srcElement))}),this},listen(e,t){return this.el.addEventListener(e,n=>t(n,this)),this},click(){this.el&&this.el.click()},checked(e){return this.el.checked=!!e,this},disable(e=!0){return this.el.disabled=e,this}}),D0=r=>{try{return r instanceof HTMLElement}catch{return typeof r=="object"&&r.nodeType===1&&typeof r.style=="object"&&typeof r.ownerDocument=="object"}},X=u3e;var JS={info:"info",success:"success",error:"error",warning:"warning"},eA=X("#notification"),ZS=()=>eA.removeClasses(Object.values(JS));eA.el.onclick=()=>ZS();var l3e=()=>Object.values(JS).reduce((r,e)=>({...r,[e](t){this.showNotification(t,e)}}),{}),f3e=(r=5)=>({autohideDuration:r,timer:void 0,removeAfter(){this.timer=setTimeout(()=>{ZS()},this.autohideDuration*1e3)},showNotification(e,t=JS.info){ZS(),eA.innerHTML(e).addClass(t),clearTimeout(this.timer),this.removeAfter()},...l3e()}),d3e=f3e(),ze=d3e;var h3e=()=>{let r=localStorage.getItem("miropad.user");r?ze.info(`\u{1F917} Happy to see you again from ${r}`):ze.info(`<h1>Welcome \u{1F44B} \u{1F603} </h1>
       <p>Use  Ctrl+S:  to save your note<p/>
       <p>& Ctrl+P: to format a JSON doc<p/>
      `,100),localStorage.setItem("miropad.user",new Date().toLocaleDateString())},MU=h3e;var p3e=(()=>({set:function(r,e){return localStorage.setItem(r,e),this},update:function(r,e){let t=JSON.parse(this.get(r));return localStorage.setItem(r,JSON.stringify({...t,...e})),this},remove:function(r){return localStorage.removeItem(r),this},get:function(r){return N0(r)?r.reduce((e,t)=>({...e,[t]:this.get(t)}),{}):localStorage.getItem(r)},getDictionary:function(){let r=localStorage.getItem("__dictionary__");return r?JSON.parse(r):[]},removeFromDictionary:function(r){let t=this.getDictionary().filter(n=>n!==r);localStorage.setItem("__dictionary__",JSON.stringify(t))},saveToDictionary:async function(r){if(r.length)try{let e=r.toLowerCase().replace(/[^a-zA-Zά-ώΑ-Ω]/g," "),t=await this.getDictionary(),n=[...e.split(" ").filter(o=>o.length>3),...t],i=[...new Set(n)];localStorage.setItem("__dictionary__",JSON.stringify(i))}catch(e){ze.error(`\u{1F631} Something went wrong while trying to save to local storage ${e}`)}else ze.warning("\u{1F615} Nothing to save!");return this}}))(),Fe=p3e;var dc={github:{client_id:"70c1955dfe4914c52c10",request_state:"miro-pad"},auth_service:"https://vercel-api-phi.vercel.app/api/auth",mail_service:{api:"https://vercel-api-phi.vercel.app/api/mail",signature:`Theo Mironidis <br/>
    Software Engineer <br/>
    https://teomrd.github.io`},file_service:{api:"https://vercel-api-phi.vercel.app/api/upload"}};var p6=(r,e=Fe.get("authToken"))=>fetch(`https://api.github.com/gists/${r}`,{headers:{Authorization:`token ${e}`}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}),UU=(r=Fe.get("authToken"))=>fetch("https://api.github.com/gists",{headers:{Authorization:`token ${r}`}}).then(e=>{if(!e.ok)throw Error(e.statusText);return e.json()}),FU=async(r,e=Fe.get("gistId"),t=Fe.get("authToken"))=>fetch(`https://api.github.com/gists/${e}`,{method:"PATCH",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[r]:null},description:"MiroPad Gist",public:!1})}).then(n=>{if(!n.ok)throw new Error(n.statusText);return n.json()}).then(n=>(ze.info(`${r} deleted on Gist!`),n)),tA=async(r=Ru(),e=Fe.get("gistId"),t=Fe.get("authToken"))=>{if(e&&t){let n=r.reduce((i,{id:o,text:s,deleted:a})=>({...i,[o]:a?null:{content:s}}),{});return fetch(`https://api.github.com/gists/${e}`,{method:"PATCH",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:n,description:"MiroPad Gist",public:!1})}).then(i=>{if(!i.ok)throw new Error(i.statusText);return i.json()}).then(i=>(r.map(({id:o,deleted:s})=>{s&&localStorage.removeItem(o)}),i))}},zU=(r=Fe.get("authToken"))=>{let t=Ru().reduce((n,i)=>({...n,[i.id]:{content:i.text}}),{});return fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${r}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:t,description:"MiroPad Gist",public:!1})}).then(n=>{if(!n.ok)throw Error(n.statusText);return n.json()}).then(n=>n)},VU=(r,e)=>fetch(`${dc.auth_service}?state=${e}&code=${r}`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}).then(t=>t),KU=({note:r,token:e=Fe.get("authToken")}={})=>fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${e}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[r.id]:{content:r.text}},description:"MiroPad Gist",public:!0})}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}).then(t=>t);var m3e=HU,$U=128,g3e=127,y3e=~g3e,w3e=Math.pow(2,31);function HU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=w3e;)e[t++]=r&255|$U,r/=128;for(;r&y3e;)e[t++]=r&255|$U,r>>>=7;return e[t]=r|0,HU.bytes=t-n+1,e}var b3e=rA,_3e=128,qU=127;function rA(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw rA.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&qU)<<i:(s&qU)*Math.pow(2,i),i+=7}while(s>=_3e);return rA.bytes=o-n,t}var E3e=Math.pow(2,7),v3e=Math.pow(2,14),x3e=Math.pow(2,21),S3e=Math.pow(2,28),A3e=Math.pow(2,35),T3e=Math.pow(2,42),I3e=Math.pow(2,49),R3e=Math.pow(2,56),C3e=Math.pow(2,63),P3e=function(r){return r<E3e?1:r<v3e?2:r<x3e?3:r<S3e?4:r<A3e?5:r<T3e?6:r<I3e?7:r<R3e?8:r<C3e?9:10},k3e={encode:m3e,decode:b3e,encodingLength:P3e},N3e=k3e,Mg=N3e;var Ug=(r,e=0)=>[Mg.decode(r,e),Mg.decode.bytes],O0=(r,e,t=0)=>(Mg.encode(r,e,t),e),L0=r=>Mg.encodingLength(r);var dGe=new Uint8Array(0);var GU=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},_a=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var jU=r=>new TextEncoder().encode(r),WU=r=>new TextDecoder().decode(r);var hc=(r,e)=>{let t=e.byteLength,n=L0(r),i=n+L0(t),o=new Uint8Array(i+t);return O0(r,o,0),O0(t,o,n),o.set(e,i),new B0(r,t,e,o)},Ea=r=>{let e=_a(r),[t,n]=Ug(e),[i,o]=Ug(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new B0(t,i,s,e)},YU=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&GU(r.bytes,t.bytes)}},B0=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var cA={};xe(cA,{base58btc:()=>pr,base58flickr:()=>U3e});function D3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,x=p.length;_!==x&&p[_]===0;)_++,g++;for(var m=(x-_)*l+1>>>0,y=new Uint8Array(m);_!==x;){for(var b=p[_],E=0,v=m-1;(b!==0||E<w)&&v!==-1;v--,E++)b+=256*y[v]>>>0,y[v]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");w=E,_++}for(var S=m-w;S!==m&&y[S]===0;)S++;for(var A=c.repeat(g);S<m;++S)A+=r.charAt(y[S]);return A}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var x=(p.length-g)*u+1>>>0,m=new Uint8Array(x);p[g];){var y=t[p.charCodeAt(g)];if(y===255)return;for(var b=0,E=x-1;(y!==0||b<_)&&E!==-1;E--,b++)y+=a*m[E]>>>0,m[E]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");_=b,g++}if(p[g]!==" "){for(var v=x-_;v!==x&&m[v]===0;)v++;for(var S=new Uint8Array(w+(x-v)),A=w;v!==x;)S[A++]=m[v++];return S}}}function d(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:d}}var O3e=D3e,L3e=O3e,QU=L3e;var iA=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},oA=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return XU(this,e)}},sA=class{constructor(e){this.decoders=e}or(e){return XU(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},XU=(r,e)=>new sA({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),aA=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new iA(e,t,n),this.decoder=new oA(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},M0=({name:r,prefix:e,encode:t,decode:n})=>new aA(r,e,t,n),tf=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=QU(t,e);return M0({prefix:r,name:e,encode:n,decode:o=>_a(i(o))})},B3e=(r,e,t,n)=>{let i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let o=r.length;for(;r[o-1]==="=";)--o;let s=new Uint8Array(o*t/8|0),a=0,c=0,u=0;for(let l=0;l<o;++l){let f=i[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},M3e=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,o="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o},Zr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>M0({prefix:e,name:r,encode(i){return M3e(i,n,t)},decode(i){return B3e(i,n,t,r)}});var pr=tf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),U3e=tf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var lA={};xe(lA,{base32:()=>va,base32hex:()=>V3e,base32hexpad:()=>$3e,base32hexpadupper:()=>q3e,base32hexupper:()=>K3e,base32pad:()=>F3e,base32padupper:()=>z3e,base32upper:()=>uA,base32z:()=>H3e});var va=Zr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uA=Zr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),F3e=Zr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),z3e=Zr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),V3e=Zr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),K3e=Zr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$3e=Zr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),q3e=Zr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),H3e=Zr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ZU=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return j3e(t,fA(r),e||pr.encoder);default:return W3e(t,fA(r),e||va.encoder)}};var JU=new WeakMap,fA=r=>{let e=JU.get(r);if(e==null){let t=new Map;return JU.set(r,t),t}return e},z=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Fg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Y3e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return z.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=hc(e,t);return z.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return z.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&YU(e.multihash,n.multihash)}toString(e){return ZU(this,e)}toJSON(){return{"/":ZU(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof z)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:o,bytes:s}=t;return new z(n,i,o,s||eF(n,i,o.bytes))}else if(t[Q3e]===!0){let{version:n,multihash:i,code:o}=t,s=Ea(i);return z.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Fg)throw new Error(`Version 0 CID must use dag-pb (code: ${Fg}) block encoding`);return new z(e,t,n,n.bytes)}case 1:{let i=eF(e,t,n.bytes);return new z(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return z.create(0,Fg,e)}static createV1(e,t){return z.create(1,e,t)}static decode(e){let[t,n]=z.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=z.inspectBytes(e),n=t.size-t.multihashSize,i=_a(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=i.subarray(t.multihashSize-t.digestSize),s=new B0(t.multihashCode,t.digestSize,o,i);return[t.version===0?z.createV0(s):z.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Ug(e.subarray(t));return t+=h,f},i=n(),o=Fg;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=t,a=n(),c=n(),u=t+c,l=u-s;return{version:i,codec:o,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[n,i]=G3e(e,t),o=z.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return fA(o).set(n,e),o}},G3e=(r,e)=>{switch(r[0]){case"Q":{let t=e||pr;return[pr.prefix,t.decode(`${pr.prefix}${r}`)]}case pr.prefix:{let t=e||pr;return[pr.prefix,t.decode(r)]}case va.prefix:{let t=e||va;return[va.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},j3e=(r,e,t)=>{let{prefix:n}=t;if(n!==pr.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return i},W3e=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let o=t.encode(r);return e.set(n,o),o}else return i},Fg=112,Y3e=18,eF=(r,e,t)=>{let n=L0(r),i=n+L0(e),o=new Uint8Array(i+t.byteLength);return O0(r,o,0),O0(e,o,n),o.set(t,i),o},Q3e=Symbol.for("@ipld/js-cid/CID");var Vg={};xe(Vg,{code:()=>zg,decode:()=>ewe,encode:()=>dA,name:()=>J3e});var X3e=new TextEncoder,Z3e=new TextDecoder,J3e="json",zg=512,dA=r=>X3e.encode(JSON.stringify(r)),ewe=r=>JSON.parse(Z3e.decode(r));var mA={};xe(mA,{sha256:()=>dt,sha512:()=>twe});var pA=({name:r,code:e,encode:t})=>new hA(r,e,t),hA=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?hc(this.code,t):t.then(n=>hc(this.code,n))}else throw Error("Unknown type, must be binary type")}};var rF=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),dt=pA({name:"sha2-256",code:18,encode:rF("SHA-256")}),twe=pA({name:"sha2-512",code:19,encode:rF("SHA-512")});var rwe=async r=>{let e=dA(r),t=await dt.digest(e);return z.create(1,zg,t).toString()},g6=rwe;var nwe=r=>{try{JSON.parse(r)}catch{return!1}return!0},y6=nwe;var nF=()=>document.title.split("|")[0],gA=r=>{let e=nF();document.title=e.trim()+" | "+r.trim(),X(".title h3").html(r.trim())},w6=()=>{let r=nF();document.title=r,X("title").innerHTML("\u270D\uFE0F MiroPad v2.15.15"),X(".title h3").innerHTML('\u270D\uFE0F MiroPad <span class="version">v2.15.15</span>')};var ht={baseUrl:`${window.location.origin}${window.location.pathname}`,get:function(){return window.location.href},getPageId:function(r=window.location.href){return new URL(r).hash.substr(1).split("?")[0]||null},getSearchParams:function(r=window.location.href){let n=new URL(r).href.split("?")[1]||"";return new URLSearchParams(n)},getParamsObject:function(r=window.location.href){let e=this.getSearchParams(r),t={};for(let n of e.keys())t={...t,[n]:this.getSearchParam(n,r)};return t},getSearchParam(r,e=window.location.href){return this.getSearchParams(e).get(r)},deleteParam:function(r){let e=this.getSearchParams();typeof r=="object"&&r.length>0?r.forEach(i=>{e.delete(i)}):e.delete(r);let{pathname:t}=window.location,n=this.getPageId();return window.location.assign(`${n?`#${n}`:t}${e.toString()?`?${e.toString()}`:""}`)},set:function(r=this.getPageId(),e=this.getParamsObject()){let t={...this.getParamsObject(),...e},n=new URLSearchParams(t);return window.location.assign(`#${r}?${n.toString()}`)}};var Pu=(r=!0)=>{r?(X("#save").removeClass("unsaved"),X("#logo").removeClass("unsaved")):(X("#save").addClass("unsaved"),X("#logo").addClass("unsaved"))};var iF=r=>{let e=encodeURIComponent(r);if(e.length===0)throw new Error("You need to start with a valid title for your note!");return e},b6=r=>{let e=sF(r),t=hn(e),{dateCreated:n}=t||{};return n},iwe=r=>{let e=hn(r);localStorage.setItem(r,JSON.stringify({title:e.title,deleted:!0,revisions:e.revisions}))},hn=(r=ht.getPageId(),e)=>{let t;try{if(t=JSON.parse(Fe.get(r)),!t.revisions)throw new Error("This is not a note!")}catch{return null}let n=t?Object.values(t.revisions).reduce((o,s)=>s.dateCreated>o.dateCreated?s:o,{dateCreated:0}):{},i=e?t.revisions[e]:n;return r?{...t,id:r,...i||{},numberOfRevisions:t&&t.revisions?Object.keys(t.revisions).length:void 0,title:t.title}:null},oF=r=>{let{id:e,title:t}=hn();Fe.update(e,{disableSync:r}),ze.info(`"${t}" cloud sync ${r?"disabled \u{1F636}":"enabled \u26A1\uFE0F"}`)},_6=async(r=ht.getPageId())=>{if(r){let e=ht.getSearchParam("v"),t=hn(void 0,e);t&&(X("#revisions").html(`${t.numberOfRevisions} revision${t.numberOfRevisions>1?"s":""}`),gA(t.title),X(".terminal").setValue(t.text)),t||ze.error("404 Note not found \u{1F937}\u200D\u2642\uFE0F")}},E6=()=>{location.hash="",w6(),X("#revisions").html(""),X(".terminal").setValue("").focus(),Pu()},U0=(r="")=>r.split(`
`)[0].trim().replace("#","").trim(),sF=r=>{let e=U0(r);return iF(e)},aF=async r=>{if(r.length){let e=sF(r),t=U0(r),n=hn(e);if(n===null)return Kg(r);let{text:i}=n,o=await g6(r),s=await g6(i);if(o===s)return;let a=Fe.get(e),c=JSON.parse(a);Fe.set(e,JSON.stringify({...c,title:t,revisions:{...c&&c.revisions||{},[o]:{dateCreated:Date.now(),text:r}}}))}},Kg=async(r=X(".terminal").getValue(),e)=>{if(await Fe.saveToDictionary(r),r.length){let t=await g6(r);try{let n=r.split(`
`)[0].trim().replace("#","").trim();gA(n);let i=iF(n),o=Fe.get(i),s=JSON.parse(o);Fe.set(i,JSON.stringify({...s,title:n,lines:r.split(`
`),revisions:{...s&&s.revisions||{},[t]:{dateCreated:Date.now(),text:r,...e?{cid:e}:{}}}})),ht.set(i,{v:t,...e?{cid:e}:{}}),e||ht.deleteParam("cid"),Fe.set("lastLocalUpdate",new Date),ze.success("\u{1F44C} Note saved!"),Pu()}catch(n){ze.error(`\u{1F631} Something went wrong while trying to save to local storage ${n}`)}}else ze.warning("\u{1F615} Nothing to save!")},Ru=({includeDeleted:r}={})=>Object.entries(localStorage).filter(([,e])=>typeof e=="string").filter(([e,t])=>!e.startsWith("__")&&y6(t)).map(([e,t])=>[e,JSON.parse(t)]).filter(([,e])=>!!e.title).reduce((e,[t])=>[...e,hn(t)],[]).filter(({deleted:e})=>r?!0:!e),cF=r=>r?Ru().map(({id:t})=>hn(t)).filter(({text:t})=>t.toLowerCase().includes(r.toLowerCase()))[0]:void 0,v6=()=>{if(confirm("Are you sure you want do that?")){let e=hn();E6(),e&&e.id&&(FU(e.id),iwe(e.id))}Ct.hide()};var uF=()=>!!Fe.get("authToken");var rf=({title:r,secondary:e,onclick:t,onSecondaryClick:n,icon:i},o=!1)=>{let s=document.createElement("LI");if(s.className=o?"selected":"",i){let u=i.cloneNode(!0);s.appendChild(u)}let a=D0(r)?r:document.createTextNode(r);a.onclick=t,s.appendChild(a);let c=document.createElement("span");if(e){c.className="secondary";let u=D0(e)?e:document.createTextNode(e);u.onclick=n,c.appendChild(u)}return s.appendChild(c),s};var lF=(r,e)=>r.map((t,n)=>rf(t,n===e));var fF=(r,e)=>{let t=r.toLowerCase().split(e),n=0;return t.reduce((i,o,s)=>[...i,...s===0?[o]:[e,o]],[]).filter(i=>i!=="").map(i=>{n=n+i.length;let o=n-i.length,s=o+i.length;return r.slice(o,s)})};var dF=r=>{let e=document.createElement("mark");return e.appendChild(document.createTextNode(r)),e},ku=({content:r="",highlight:e=""})=>{let t=document.createElement("div"),n=r.split(" "),i=e.toLowerCase().split(" ");return e.trim()===""?(t.appendChild(document.createTextNode(r)),t):(n.map(o=>{let s=i.map(a=>o.toLocaleLowerCase().includes(a)?a:void 0).filter(a=>a!==void 0);return{word:o,matches:s}}).forEach(({word:o,matches:s})=>{if(s.length>0){let a=s[0];if(o===a)t.appendChild(dF(` ${o}`));else{let u=fF(o,a).map(l=>l.toLowerCase()===a?dF(l):document.createTextNode(l));t.appendChild(document.createTextNode(" ")),u.forEach(l=>{t.appendChild(l)})}}else t.appendChild(document.createTextNode(` ${o} `))}),t)};var hF=async()=>(ze.info("You need to be authenticated!"),Ct.hide(),window.location.replace(`https://github.com/login/oauth/authorize?client_id=${dc.github.client_id}&scope=gist&state=${dc.github.request_state}`)),pF=async r=>{ze.info("Downloading my Gists!");let e=await UU(r);Ct.setState({mode:Ct.getModes().gists}),ze.info("Select Gist to sync with");let t=e.sort((i,o)=>new Date(o.updated_at).getTime()-new Date(i.updated_at).getTime()).map(({description:i,updated_at:o,id:s})=>({title:ku({content:`${i}(${s})`}),secondary:o,onclick:async()=>{await Fe.set("gistId",s),ze.success(`${i}(${s}) selected for synchronization!`),$g(),Ct.hide()}})),n=lF([{title:"Create a new Gist",onclick:async()=>{ze.info("Syncing your MiroPads to a new Gist");try{let{id:i}=await zU();Fe.set("gistId",i),ze.success("MiroPads synced to a new Gist \u{1F389}")}catch(i){ze.error(i.message)}Ct.hide()}},...t]);X("#commands").html(""),X("#commands").append(n)},$g=async(r=Fe.get("gistId"))=>{if(Fe.get("authToken")&&r){X("#logo").addClass("loading");let{files:t}=await p6(r);Object.values(t).forEach(({content:n})=>{aF(n)}),Fe.set("lastSync",new Date),ze.success("\u2B07 MiroPad synced \u2705"),X("#logo").removeClass("loading")}},mF=async()=>{let r=ht.getSearchParam("code"),e=ht.getSearchParam("state");if(r&&e){X("#logo").addClass("loading"),ze.info("\u{1F510} Authenticating...");try{let{token:t}=await VU(r,e);Fe.set("authToken",t),ze.info("\u26F3 You have been authenticated!"),ht.deleteParam(["code","state"])}catch(t){ze.error(t.message)}X("#logo").removeClass("loading")}};var owe=async(r="no-titled")=>{let e={suggestedName:`${r}`,types:[{description:"MiroPad text notes",accept:{"text/plain":[".miropad"]}}]};return await window.showSaveFilePicker(e)},swe=async(r,e)=>{let t=await r.createWritable();await t.write(e),await t.close()},gF=async(r,e)=>{try{let t=await owe(e);await swe(t,r)}catch{let n="An error occurred trying to save the file.";ze.error(n);return}},yF=(()=>{let r=document.createElement("a");return document.body.appendChild(r),r.style="display: none",(e,t=`MiroPad-${new Date().toISOString()}.json`)=>{let n=JSON.stringify(e),i=new Blob([n],{type:"octet/stream"}),o=window.URL.createObjectURL(i);r.href=o,r.download=t,r.click(),window.URL.revokeObjectURL(o)}})();var _F=C(bF()),EF=new _F.default.Converter({tasklists:!0,underline:!0,emoji:!0,simplifiedAutoLink:!0,tables:!0,openLinksInNewWindow:!0});EF.setFlavor("github");var S6=r=>EF.makeHtml(r);var yA=r=>{if(r.status.toString().slice(0,1)==="2")return r;throw new Error(r)},awe=(r="")=>`<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
      <style>
      img {
        border-style: none;
        max-width: 100%;
        box-sizing: content-box;
      }
      </style>
    </head>
    <table style="width:100%;background-color:#ffffff" align="center" border="0" cellPadding="0" cellSpacing="0" role="presentation">
      <tbody>
        <tr>
          <td>
            <div><!--[if mso | IE]>
              <table role="presentation" width="100%" align="center" style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px;"><tr><td></td><td style="width:37.5em;background:#ffffff">
            <![endif]--></div>

            <div style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px"><img alt="Theo Mironidis Logo" src="https://teomrd.github.io/miroFavicon.f0c5b85b.png" width="42" height="42" style="display:block;outline:none;border:none;text-decoration:none;width:42px;height:42px" />
              ${r}
              <hr style="width:100%;border:none;border-top:1px solid #eaeaea;border-color:#dfe1e4;margin:42px 0 26px" />
              <a target="_blank" style="color:#b4becc;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen-Sans,Ubuntu,Cantarell,&quot;Helvetica Neue&quot;,sans-serif;font-size:14px" href="https://teomrd.github.io">
              ${dc.mail_service.signature}
              </a>
            </div>
            <div><!--[if mso | IE]>
            </td><td></td></tr></table>
            <![endif]--></div>
          </td>
        </tr>
      </tbody>
    </table>
  </html>`,cwe=async(r,e,t="MiroPad note")=>{if(!r){ze.error("\u{1F47B} No message to send, type something and try again! \u{1F913}");return}try{await fetch(`${dc.mail_service.api}`,{method:"POST",headers:{"x-secret-token":Fe.get("MIROPAD_SECRET_TOKEN"),accept:"application/json","content-type":"application/json"},body:JSON.stringify({to:e,subject:t,html:awe(r)})}).then(yA).then(n=>n.json()),ze.success("Email sent \u{1F680}")}catch{ze.error("Error not went through \u{1F4A5}! Check your credentials and try again!")}},uwe=()=>{let r=Fe.get("mail");if(r){let n=window.prompt(`Mail ${r} again? (y)es/(no)`,"yeap");if(n===null)return n;if(n.slice(0,1).toLowerCase()==="y")return r}let e=window.prompt("Where do you wanna send the mail to?"),t=window.prompt("Do you wanna save that to your preferences for later on? (y)es/(no)","yeap");return t&&t.slice(0,1).toLowerCase()==="y"&&Fe.set("mail",e),e},vF=r=>{let e=uwe();if(e===null){ze.info("Sending mail cancelled \u{1F636}");return}ze.info("Sending mail... \u{1F680}");let t=U0(r),n=S6(r);cwe(n,e,t)};var Nu=async(r,e="\u{1F4CB} Copied to clipboard")=>{try{await navigator.clipboard.writeText(r),ze.success(e)}catch(t){ze.error(t.message)}};var A6=(r,e,t)=>{let n=N0(r)?r:[r],i=document.createElement("button");return i.setAttribute("type","button"),t&&i.setAttribute("id",t),n.forEach(o=>{typeof o=="string"?i.appendChild(document.createTextNode(o)):i.appendChild(o)}),i.onclick=o=>e(o),i};var lwe=(()=>({view:X(".preview"),init:function(){return this.update(),X(".terminal").listen("input",()=>this.update()),!!ht.getSearchParam("md")?this.view.show():this.view.hide(),this},update:async function(){let md=X(".terminal").getValue();this.view.innerHTML(S6(md));let{elements}=X("pre");Array.prototype.slice.call(elements).forEach(r=>{let e=A6("\u{1F4CB} Copy",async t=>{t.stopPropagation();let n=t.srcElement.previousSibling.innerHTML;await Nu(n,"\u{1F4CB} Code copied to clipboard")});r.appendChild(e)}),X("code").listenAll("click",async({innerHTML})=>{let result=eval(innerHTML);X(".console").show().innerHTML(result)}),X(".console").listen("click",async r=>{r.srcElement.classList.add("hidden");let e=r.srcElement.innerHTML;await Nu(e,"\u{1F4CB} Code copied to clipboard")})},show:function(r=!0){this.view.show(),ht.set(void 0,{md:r})},hide:function(){this.view.hide(),ht.deleteParam("md")},toggle:function(r="true"){return ht.getSearchParam("md")===r?this.hide():this.show(r),this}}))(),nf=lwe;var fwe=r=>{let e=document.querySelector(r);if(y6(e.value)){let t=JSON.stringify(JSON.parse(e.value),null,2);e.value=t,ze.success("\u{1F44D} JSON value prettified")}else ze.error("\u{1F627} Value is not in valid JSON format")},xF=fwe;var SF=(r=1e3)=>new Promise(e=>{setTimeout(e,r)});var Sr=(r,e,t)=>{let n=document.createElement("IMG");return t&&n.classList.add(t),e&&n.setAttribute("alt",e),n.setAttribute("src",r),n};var AF="./list-LK7OCHR7.svg";var qg="./trash-RDL437QG.svg";var TF="./checkmark-circle-JQ7ADSUI.svg";var IF="./cloud-sync-F3RLGHML.svg";var RF="./lighter-UBEI67LL.svg";var CF="./enter-down-6TVO6OFR.svg";var PF="./download-FVXMIYZ4.svg";var kF="./envelope-Z2VRVSLR.svg";var NF="./bug-36UGMUXT.svg";var DF="./picture-3TDOSVS3.svg";var OF="./printer-B7RMPYZC.svg";var LF="./page-break-BLVP5QBQ.svg";var BF="./frame-expand-CX6CNP53.svg";var MF="./arrow-right-circle-2Q6EHM2H.svg";var UF="./magic-wand-JQJ6EKRO.svg";var FF="./rocket-AIY2RJJS.svg";var zF="./earth-DJLABK7O.svg";var VF="./spell-check-V6QYTGNT.svg";var KF="./pencil-X3ZMY3QU.svg";var wA="./exit-up-GH6BPN2X.svg";var $F="./leaf-CGBE7XAJ.svg";var qF=async()=>{try{let r=hn(),e=ht.get();await navigator.share({title:r?r.title:"\u270D\uFE0F MiroPad",text:r?r.text:"Temporary note keeping app for the browser",url:e})}catch(r){ze.info(`${r.message}`)}};var ZF=C(_A(),1),et=ZF.default;var Pye=C(C6(),1);var Co=C(xA(),1);var SA={};xe(SA,{base64:()=>fh,base64pad:()=>o5e,base64url:()=>Gg,base64urlpad:()=>s5e});var fh=Zr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),o5e=Zr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Gg=Zr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s5e=Zr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});Co.default.formatters.b=r=>r==null?"undefined":pr.baseEncode(r);Co.default.formatters.t=r=>r==null?"undefined":va.baseEncode(r);Co.default.formatters.m=r=>r==null?"undefined":fh.baseEncode(r);Co.default.formatters.p=r=>r==null?"undefined":r.toString();Co.default.formatters.c=r=>r==null?"undefined":r.toString();Co.default.formatters.k=r=>r==null?"undefined":r.toString();Co.default.formatters.a=r=>r==null?"undefined":r.toString();function a5e(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function j(r){let e=a5e(`${r}:trace`);return Co.default.enabled(`${r}:trace`)&&Co.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,Co.default)(`${r}:trace`)),Object.assign((0,Co.default)(r),{error:(0,Co.default)(`${r}:error`),trace:e})}var jS=C(ee(),1);var H6=C(ee(),1);var Ou=C(gc(),1),H0=Ou.default.Reader,UA=Ou.default.Writer,je=Ou.default.util,pi=Ou.default.roots["ipfs-unixfs"]||(Ou.default.roots["ipfs-unixfs"]={}),jz=pi.Data=(()=>{function r(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Type=0,r.prototype.Data=je.newBuffer([]),r.prototype.filesize=je.Long?je.Long.fromBits(0,0,!0):0,r.prototype.blocksizes=je.emptyArray,r.prototype.hashType=je.Long?je.Long.fromBits(0,0,!0):0,r.prototype.fanout=je.Long?je.Long.fromBits(0,0,!0):0,r.prototype.mode=0,r.prototype.mtime=null,r.encode=function(t,n){if(n||(n=UA.create()),n.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&n.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&n.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var i=0;i<t.blocksizes.length;++i)n.uint32(32).uint64(t.blocksizes[i]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&n.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&n.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&n.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&pi.UnixTime.encode(t.mtime,n.uint32(66).fork()).ldelim(),n},r.decode=function(t,n){t instanceof H0||(t=H0.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new pi.Data;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.Type=t.int32();break;case 2:o.Data=t.bytes();break;case 3:o.filesize=t.uint64();break;case 4:if(o.blocksizes&&o.blocksizes.length||(o.blocksizes=[]),(s&7)===2)for(var a=t.uint32()+t.pos;t.pos<a;)o.blocksizes.push(t.uint64());else o.blocksizes.push(t.uint64());break;case 5:o.hashType=t.uint64();break;case 6:o.fanout=t.uint64();break;case 7:o.mode=t.uint32();break;case 8:o.mtime=pi.UnixTime.decode(t,t.uint32());break;default:t.skipType(s&7);break}}if(!o.hasOwnProperty("Type"))throw je.ProtocolError("missing required 'Type'",{instance:o});return o},r.fromObject=function(t){if(t instanceof pi.Data)return t;var n=new pi.Data;switch(t.Type){case"Raw":case 0:n.Type=0;break;case"Directory":case 1:n.Type=1;break;case"File":case 2:n.Type=2;break;case"Metadata":case 3:n.Type=3;break;case"Symlink":case 4:n.Type=4;break;case"HAMTShard":case 5:n.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?je.base64.decode(t.Data,n.Data=je.newBuffer(je.base64.length(t.Data)),0):t.Data.length&&(n.Data=t.Data)),t.filesize!=null&&(je.Long?(n.filesize=je.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?n.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?n.filesize=t.filesize:typeof t.filesize=="object"&&(n.filesize=new je.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");n.blocksizes=[];for(var i=0;i<t.blocksizes.length;++i)je.Long?(n.blocksizes[i]=je.Long.fromValue(t.blocksizes[i])).unsigned=!0:typeof t.blocksizes[i]=="string"?n.blocksizes[i]=parseInt(t.blocksizes[i],10):typeof t.blocksizes[i]=="number"?n.blocksizes[i]=t.blocksizes[i]:typeof t.blocksizes[i]=="object"&&(n.blocksizes[i]=new je.LongBits(t.blocksizes[i].low>>>0,t.blocksizes[i].high>>>0).toNumber(!0))}if(t.hashType!=null&&(je.Long?(n.hashType=je.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?n.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?n.hashType=t.hashType:typeof t.hashType=="object"&&(n.hashType=new je.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(je.Long?(n.fanout=je.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?n.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?n.fanout=t.fanout:typeof t.fanout=="object"&&(n.fanout=new je.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(n.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");n.mtime=pi.UnixTime.fromObject(t.mtime)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocksizes=[]),n.defaults){if(i.Type=n.enums===String?"Raw":0,n.bytes===String?i.Data="":(i.Data=[],n.bytes!==Array&&(i.Data=je.newBuffer(i.Data))),je.Long){var o=new je.Long(0,0,!0);i.filesize=n.longs===String?o.toString():n.longs===Number?o.toNumber():o}else i.filesize=n.longs===String?"0":0;if(je.Long){var o=new je.Long(0,0,!0);i.hashType=n.longs===String?o.toString():n.longs===Number?o.toNumber():o}else i.hashType=n.longs===String?"0":0;if(je.Long){var o=new je.Long(0,0,!0);i.fanout=n.longs===String?o.toString():n.longs===Number?o.toNumber():o}else i.fanout=n.longs===String?"0":0;i.mode=0,i.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(i.Type=n.enums===String?pi.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(i.Data=n.bytes===String?je.base64.encode(t.Data,0,t.Data.length):n.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?i.filesize=n.longs===String?String(t.filesize):t.filesize:i.filesize=n.longs===String?je.Long.prototype.toString.call(t.filesize):n.longs===Number?new je.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){i.blocksizes=[];for(var s=0;s<t.blocksizes.length;++s)typeof t.blocksizes[s]=="number"?i.blocksizes[s]=n.longs===String?String(t.blocksizes[s]):t.blocksizes[s]:i.blocksizes[s]=n.longs===String?je.Long.prototype.toString.call(t.blocksizes[s]):n.longs===Number?new je.LongBits(t.blocksizes[s].low>>>0,t.blocksizes[s].high>>>0).toNumber(!0):t.blocksizes[s]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?i.hashType=n.longs===String?String(t.hashType):t.hashType:i.hashType=n.longs===String?je.Long.prototype.toString.call(t.hashType):n.longs===Number?new je.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?i.fanout=n.longs===String?String(t.fanout):t.fanout:i.fanout=n.longs===String?je.Long.prototype.toString.call(t.fanout):n.longs===Number?new je.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(i.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(i.mtime=pi.UnixTime.toObject(t.mtime,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ou.default.util.toJSONOptions)},r.DataType=function(){let e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),r})(),MWe=pi.UnixTime=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Seconds=je.Long?je.Long.fromBits(0,0,!1):0,r.prototype.FractionalNanoseconds=0,r.encode=function(t,n){return n||(n=UA.create()),n.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&n.uint32(21).fixed32(t.FractionalNanoseconds),n},r.decode=function(t,n){t instanceof H0||(t=H0.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new pi.UnixTime;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.Seconds=t.int64();break;case 2:o.FractionalNanoseconds=t.fixed32();break;default:t.skipType(s&7);break}}if(!o.hasOwnProperty("Seconds"))throw je.ProtocolError("missing required 'Seconds'",{instance:o});return o},r.fromObject=function(t){if(t instanceof pi.UnixTime)return t;var n=new pi.UnixTime;return t.Seconds!=null&&(je.Long?(n.Seconds=je.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?n.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?n.Seconds=t.Seconds:typeof t.Seconds=="object"&&(n.Seconds=new je.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(n.FractionalNanoseconds=t.FractionalNanoseconds>>>0),n},r.toObject=function(t,n){n||(n={});var i={};if(n.defaults){if(je.Long){var o=new je.Long(0,0,!1);i.Seconds=n.longs===String?o.toString():n.longs===Number?o.toNumber():o}else i.Seconds=n.longs===String?"0":0;i.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?i.Seconds=n.longs===String?String(t.Seconds):t.Seconds:i.Seconds=n.longs===String?je.Long.prototype.toString.call(t.Seconds):n.longs===Number?new je.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(i.FractionalNanoseconds=t.FractionalNanoseconds),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ou.default.util.toJSONOptions)},r})(),UWe=pi.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.MimeType="",r.encode=function(t,n){return n||(n=UA.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&n.uint32(10).string(t.MimeType),n},r.decode=function(t,n){t instanceof H0||(t=H0.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new pi.Metadata;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.MimeType=t.string();break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof pi.Metadata)return t;var n=new pi.Metadata;return t.MimeType!=null&&(n.MimeType=String(t.MimeType)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(i.MimeType=t.MimeType),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ou.default.util.toJSONOptions)},r})();var Lu=jz,Wz=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],b5e=["directory","hamt-sharded-directory"],Yz=parseInt("0644",8),Qz=parseInt("0755",8);function Bu(r){if(r!=null)return typeof r=="number"?r&4095:(r=r.toString(),r.substring(0,1)==="0"?parseInt(r,8)&4095:parseInt(r,10)&4095)}function af(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,H6.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}var st=class{static unmarshal(e){let t=Lu.decode(e),n=Lu.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),i=new st({type:Wz[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return i._originalMode=n.mode||0,i}constructor(e={type:"file"}){let{type:t,data:n,blockSizes:i,hashType:o,fanout:s,mtime:a,mode:c}=e;if(t&&!Wz.includes(t))throw(0,H6.default)(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=o,this.fanout=s,this.blockSizes=i||[],this._originalMode=0,this.mode=Bu(c),a&&(this.mtime=af(a),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?Qz:Yz;let t=Bu(e);t!==void 0&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return!!(this.type&&b5e.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach(t=>{e+=t}),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=Lu.DataType.Raw;break;case"directory":e=Lu.DataType.Directory;break;case"file":e=Lu.DataType.File;break;case"metadata":e=Lu.DataType.Metadata;break;case"symlink":e=Lu.DataType.Symlink;break;case"hamt-sharded-directory":e=Lu.DataType.HAMTShard;break;default:throw(0,H6.default)(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t=this.data;(!this.data||!this.data.length)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(Bu(this.mode)||0),n===Yz&&!this.isDirectory()&&(n=void 0),n===Qz&&this.isDirectory()&&(n=void 0));let i;if(this.mtime!=null){let s=af(this.mtime);s&&(i={Seconds:s.secs,FractionalNanoseconds:s.nsecs},i.FractionalNanoseconds===0&&delete i.FractionalNanoseconds)}let o={Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i};return Lu.encode(o).finish()}};var sr={};xe(sr,{code:()=>kr,createLink:()=>gV,createNode:()=>mV,decode:()=>en,encode:()=>pt,name:()=>w4e,prepare:()=>Xn,validate:()=>JA});var GA={};xe(GA,{base32:()=>wc,base32hex:()=>k5e,base32hexpad:()=>D5e,base32hexpadupper:()=>O5e,base32hexupper:()=>N5e,base32pad:()=>C5e,base32padupper:()=>P5e,base32upper:()=>R5e,base32z:()=>L5e});var G0={};xe(G0,{coerce:()=>yc,empty:()=>Xz,equals:()=>FA,fromHex:()=>E5e,fromString:()=>zA,isBinary:()=>v5e,toHex:()=>_5e,toString:()=>VA});var Xz=new Uint8Array(0);function _5e(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function E5e(r){let e=r.match(/../g);return e!=null?new Uint8Array(e.map(t=>parseInt(t,16))):Xz}function FA(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function yc(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function v5e(r){return r instanceof ArrayBuffer||ArrayBuffer.isView(r)}function zA(r){return new TextEncoder().encode(r)}function VA(r){return new TextDecoder().decode(r)}function x5e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,x=p.length;_!==x&&p[_]===0;)_++,g++;for(var m=(x-_)*l+1>>>0,y=new Uint8Array(m);_!==x;){for(var b=p[_],E=0,v=m-1;(b!==0||E<w)&&v!==-1;v--,E++)b+=256*y[v]>>>0,y[v]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");w=E,_++}for(var S=m-w;S!==m&&y[S]===0;)S++;for(var A=c.repeat(g);S<m;++S)A+=r.charAt(y[S]);return A}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var x=(p.length-g)*u+1>>>0,m=new Uint8Array(x);p[g];){var y=t[p.charCodeAt(g)];if(y===255)return;for(var b=0,E=x-1;(y!==0||b<_)&&E!==-1;E--,b++)y+=a*m[E]>>>0,m[E]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");_=b,g++}if(p[g]!==" "){for(var v=x-_;v!==x&&m[v]===0;)v++;for(var S=new Uint8Array(w+(x-v)),A=w;v!==x;)S[A++]=m[v++];return S}}}function d(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:d}}var S5e=x5e,A5e=S5e,Zz=A5e;var KA=class{constructor(e,t,n){B(this,"name");B(this,"prefix");B(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$A=class{constructor(e,t,n){B(this,"name");B(this,"prefix");B(this,"baseDecode");B(this,"prefixCodePoint");this.name=e,this.prefix=t;let i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Jz(this,e)}},qA=class{constructor(e){B(this,"decoders");this.decoders=e}or(e){return Jz(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Jz(r,e){return new qA({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}var HA=class{constructor(e,t,n,i){B(this,"name");B(this,"prefix");B(this,"baseEncode");B(this,"baseDecode");B(this,"encoder");B(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new KA(e,t,n),this.decoder=new $A(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function j0({name:r,prefix:e,encode:t,decode:n}){return new HA(r,e,t,n)}function cf({name:r,prefix:e,alphabet:t}){let{encode:n,decode:i}=Zz(t,r);return j0({prefix:e,name:r,encode:n,decode:o=>yc(i(o))})}function T5e(r,e,t,n){let i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let o=r.length;for(;r[o-1]==="=";)--o;let s=new Uint8Array(o*t/8|0),a=0,c=0,u=0;for(let l=0;l<o;++l){let f=i[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s}function I5e(r,e,t){let n=e[e.length-1]==="=",i=(1<<t)-1,o="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s!==0&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o}function Jr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return j0({prefix:e,name:r,encode(i){return I5e(i,n,t)},decode(i){return T5e(i,n,t,r)}})}var wc=Jr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),R5e=Jr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),C5e=Jr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),P5e=Jr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),k5e=Jr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),N5e=Jr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),D5e=Jr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),O5e=Jr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),L5e=Jr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jA={};xe(jA,{base36:()=>Qg,base36upper:()=>B5e});var Qg=cf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),B5e=cf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var WA={};xe(WA,{base58btc:()=>Yi,base58flickr:()=>M5e});var Yi=cf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M5e=cf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var U5e=rV,eV=128,F5e=127,z5e=~F5e,V5e=Math.pow(2,31);function rV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=V5e;)e[t++]=r&255|eV,r/=128;for(;r&z5e;)e[t++]=r&255|eV,r>>>=7;return e[t]=r|0,rV.bytes=t-n+1,e}var K5e=YA,$5e=128,tV=127;function YA(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw YA.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&tV)<<i:(s&tV)*Math.pow(2,i),i+=7}while(s>=$5e);return YA.bytes=o-n,t}var q5e=Math.pow(2,7),H5e=Math.pow(2,14),G5e=Math.pow(2,21),j5e=Math.pow(2,28),W5e=Math.pow(2,35),Y5e=Math.pow(2,42),Q5e=Math.pow(2,49),X5e=Math.pow(2,56),Z5e=Math.pow(2,63),J5e=function(r){return r<q5e?1:r<H5e?2:r<G5e?3:r<j5e?4:r<W5e?5:r<Y5e?6:r<Q5e?7:r<X5e?8:r<Z5e?9:10},e4e={encode:U5e,decode:K5e,encodingLength:J5e},t4e=e4e,Xg=t4e;function Zg(r,e=0){return[Xg.decode(r,e),Xg.decode.bytes]}function W0(r,e,t=0){return Xg.encode(r,e,t),e}function Y0(r){return Xg.encodingLength(r)}function ph(r,e){let t=e.byteLength,n=Y0(r),i=n+Y0(t),o=new Uint8Array(i+t);return W0(r,o,0),W0(t,o,n),o.set(e,i),new Q0(r,t,e,o)}function uf(r){let e=yc(r),[t,n]=Zg(e),[i,o]=Zg(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Q0(t,i,s,e)}function nV(r,e){if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&FA(r.bytes,t.bytes)}}var Q0=class{constructor(e,t,n,i){B(this,"code");B(this,"size");B(this,"digest");B(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function iV(r,e){let{bytes:t,version:n}=r;switch(n){case 0:return n4e(t,QA(r),e??Yi.encoder);default:return i4e(t,QA(r),e??wc.encoder)}}var oV=new WeakMap;function QA(r){let e=oV.get(r);if(e==null){let t=new Map;return oV.set(r,t),t}return e}var a4e,Xe=class{constructor(e,t,n,i){B(this,"code");B(this,"version");B(this,"multihash");B(this,"bytes");B(this,"/");B(this,a4e,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Jg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==o4e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Xe.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=ph(e,t);return Xe.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Xe.equals(this,e)}static equals(e,t){let n=t;return n!=null&&e.code===n.code&&e.version===n.version&&nV(e.multihash,n.multihash)}toString(e){return iV(this,e)}toJSON(){return{"/":iV(this)}}link(){return this}[(a4e=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof Xe)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:o,bytes:s}=t;return new Xe(n,i,o,s??sV(n,i,o.bytes))}else if(t[s4e]===!0){let{version:n,multihash:i,code:o}=t,s=uf(i);return Xe.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Jg)throw new Error(`Version 0 CID must use dag-pb (code: ${Jg}) block encoding`);return new Xe(e,t,n,n.bytes)}case 1:{let i=sV(e,t,n.bytes);return new Xe(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Xe.create(0,Jg,e)}static createV1(e,t){return Xe.create(1,e,t)}static decode(e){let[t,n]=Xe.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=Xe.inspectBytes(e),n=t.size-t.multihashSize,i=yc(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=i.subarray(t.multihashSize-t.digestSize),s=new Q0(t.multihashCode,t.digestSize,o,i);return[t.version===0?Xe.createV0(s):Xe.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Zg(e.subarray(t));return t+=h,f},i=n(),o=Jg;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=t,a=n(),c=n(),u=t+c,l=u-s;return{version:i,codec:o,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[n,i]=r4e(e,t),o=Xe.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return QA(o).set(n,e),o}};function r4e(r,e){switch(r[0]){case"Q":{let t=e??Yi;return[Yi.prefix,t.decode(`${Yi.prefix}${r}`)]}case Yi.prefix:{let t=e??Yi;return[Yi.prefix,t.decode(r)]}case wc.prefix:{let t=e??wc;return[wc.prefix,t.decode(r)]}case Qg.prefix:{let t=e??Qg;return[Qg.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function n4e(r,e,t){let{prefix:n}=t;if(n!==Yi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return i}function i4e(r,e,t){let{prefix:n}=t,i=e.get(n);if(i==null){let o=t.encode(r);return e.set(n,o),o}else return i}var Jg=112,o4e=18;function sV(r,e,t){let n=Y0(r),i=n+Y0(e),o=new Uint8Array(i+t.byteLength);return W0(r,o,0),W0(e,o,n),o.set(t,i),o}var s4e=Symbol.for("@ipld/js-cid/CID");var c4e=new TextDecoder;function XA(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function j6(r,e){let t;[t,e]=XA(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function aV(r,e){let t;return[t,e]=XA(r,e),[t&7,t>>3,e]}function u4e(r){let e={},t=r.length,n=0;for(;n<t;){let i,o;if([i,o,n]=aV(r,n),o===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=j6(r,n)}else if(o===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=j6(r,n),e.Name=c4e.decode(s)}else if(o===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=XA(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function cV(r){let e=r.length,t=0,n,i=!1,o;for(;t<e;){let a,c;if([a,c,t]=aV(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,t]=j6(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,t]=j6(r,t),n.push(u4e(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return o&&(s.Data=o),s.Links=n||[],s}var lV=new TextEncoder,uV=2**32,l4e=2**31;function f4e(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=ey(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=lV.encode(r.Name);t-=n.length,e.set(n,t),t=ey(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=ey(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function fV(r){let e=h4e(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=ey(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){let o=f4e(r.Links[i],t.subarray(0,n));n-=o,n=ey(t,n,o)-1,t[n]=18}return t}function d4e(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+X0(t)}if(typeof r.Name=="string"){let t=lV.encode(r.Name).length;e+=1+t+X0(t)}return typeof r.Tsize=="number"&&(e+=1+X0(r.Tsize)),e}function h4e(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+X0(t)}if(r.Links)for(let t of r.Links){let n=d4e(t);e+=1+n+X0(n)}return e}function ey(r,e,t){e-=X0(t);let n=e;for(;t>=l4e;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function X0(r){return r%2===0&&r++,Math.floor((p4e(r)+6)/7)}function p4e(r){let e=0;return r>=uV&&(r=Math.floor(r/uV),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+m4e[r]}var m4e=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var g4e=["Data","Links"],y4e=["Hash","Name","Tsize"],ZA=new TextEncoder;function hV(r,e){if(r===e)return 0;let t=r.Name?ZA.encode(r.Name):[],n=e.Name?ZA.encode(e.Name):[],i=t.length,o=n.length;for(let s=0,a=Math.min(i,o);s<a;++s)if(t[s]!==n[s]){i=t[s],o=n[s];break}return i<o?-1:o<i?1:0}function dV(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function pV(r){if(typeof r.asCID=="object"){let t=Xe.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Hash){let t=Xe.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=Xe.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=Xe.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function Xn(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=ZA.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(pV),e.Links.sort(hV);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function JA(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!dV(r,g4e))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!dV(t,y4e))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&hV(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function mV(r,e=[]){return Xn({Data:r,Links:e})}function gV(r,e,t){return pV({Hash:t,Name:r,Tsize:e})}function yV(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}var w4e="dag-pb",kr=112;function pt(r){JA(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),fV(e)}function en(r){let e=yV(r),t=cV(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{let o={};try{o.Hash=Xe.decode(i.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(o.Name=i.Name),i.Tsize!==void 0&&(o.Tsize=i.Tsize),o})),n}var o1={};xe(o1,{code:()=>lT,decode:()=>dT,decodeOptions:()=>Z4e,encode:()=>fT,encodeOptions:()=>Q4e,name:()=>J4e,toByteView:()=>vK});var b4e=["string","number","bigint","symbol"],_4e=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function wV(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(b4e.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(E4e(r))return"Buffer";let t=v4e(r);return t||"Object"}function E4e(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function v4e(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(_4e.includes(e))return e}var V=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};V.uint=new V(0,"uint",!0);V.negint=new V(1,"negint",!0);V.bytes=new V(2,"bytes",!0);V.string=new V(3,"string",!0);V.array=new V(4,"array",!1);V.map=new V(5,"map",!1);V.tag=new V(6,"tag",!1);V.float=new V(7,"float",!0);V.false=new V(7,"false",!0);V.true=new V(7,"true",!0);V.null=new V(7,"null",!0);V.undefined=new V(7,"undefined",!0);V.break=new V(7,"break",!0);var oe=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Z0=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",x4e=new TextDecoder,S4e=new TextEncoder;function W6(r){return Z0&&globalThis.Buffer.isBuffer(r)}function ty(r){return r instanceof Uint8Array?W6(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var vV=Z0?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):_V(r,e,t):(r,e,t)=>t-e>64?x4e.decode(r.subarray(e,t)):_V(r,e,t),Y6=Z0?r=>r.length>64?globalThis.Buffer.from(r):bV(r):r=>r.length>64?S4e.encode(r):bV(r),bc=r=>Uint8Array.from(r),J0=Z0?(r,e,t)=>W6(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),xV=Z0?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),ty(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},SV=Z0?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function AV(r,e){if(W6(r)&&W6(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function bV(r){let e=[],t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function _V(r,e,t){let n=[];for(;e<t;){let i=r[e],o=null,s=i>239?4:i>223?3:i>191?2:1;if(e+s<=t){let a,c,u,l;switch(s){case 1:i<128&&(o=i);break;case 2:a=r[e+1],(a&192)===128&&(l=(i&31)<<6|a&63,l>127&&(o=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(i&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(i&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(o=l))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=s}return eT(n)}var EV=4096;function eT(r){let e=r.length;if(e<=EV)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=EV));return t}var A4e=256,ry=class{constructor(e=A4e){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){let i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=SV(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=J0(n,0,this.cursor)}else t=xV(this.chunks,this.cursor);return e&&this.reset(),t}};var Pe="CBOR decode error:",Mu="CBOR encode error:",ny=[];ny[23]=1;ny[24]=2;ny[25]=3;ny[26]=5;ny[27]=9;function Uu(r,e,t){if(r.length-e<t)throw new Error(`${Pe} not enough data for type`)}var Zn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Po(r,e,t){Uu(r,e,1);let n=r[e];if(t.strict===!0&&n<Zn[0])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function ko(r,e,t){Uu(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<Zn[1])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function No(r,e,t){Uu(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<Zn[2])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function Do(r,e,t){Uu(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&o<Zn[3])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${Pe} integers outside of the safe integer range are not supported`)}function TV(r,e,t,n){return new oe(V.uint,Po(r,e+1,n),2)}function IV(r,e,t,n){return new oe(V.uint,ko(r,e+1,n),3)}function RV(r,e,t,n){return new oe(V.uint,No(r,e+1,n),5)}function CV(r,e,t,n){return new oe(V.uint,Do(r,e+1,n),9)}function Ts(r,e){return mi(r,0,e.value)}function mi(r,e,t){if(t<Zn[0]){let n=Number(t);r.push([e|n])}else if(t<Zn[1]){let n=Number(t);r.push([e|24,n])}else if(t<Zn[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<Zn[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<Zn[4]){let i=[e|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,r.push(i)}else throw new Error(`${Pe} encountered BigInt larger than allowable range`)}}Ts.encodedSize=function(e){return mi.encodedSize(e.value)};mi.encodedSize=function(e){return e<Zn[0]?1:e<Zn[1]?2:e<Zn[2]?3:e<Zn[3]?5:9};Ts.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function PV(r,e,t,n){return new oe(V.negint,-1-Po(r,e+1,n),2)}function kV(r,e,t,n){return new oe(V.negint,-1-ko(r,e+1,n),3)}function NV(r,e,t,n){return new oe(V.negint,-1-No(r,e+1,n),5)}var tT=BigInt(-1),DV=BigInt(1);function OV(r,e,t,n){let i=Do(r,e+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new oe(V.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${Pe} integers outside of the safe integer range are not supported`);return new oe(V.negint,tT-BigInt(i),9)}function Q6(r,e){let t=e.value,n=typeof t=="bigint"?t*tT-DV:t*-1-1;mi(r,e.type.majorEncoded,n)}Q6.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*tT-DV:t*-1-1;return n<Zn[0]?1:n<Zn[1]?2:n<Zn[2]?3:n<Zn[3]?5:9};Q6.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function iy(r,e,t,n){Uu(r,e,t+n);let i=J0(r,e+t,e+t+n);return new oe(V.bytes,i,t+n)}function LV(r,e,t,n){return iy(r,e,1,t)}function BV(r,e,t,n){return iy(r,e,2,Po(r,e+1,n))}function MV(r,e,t,n){return iy(r,e,3,ko(r,e+1,n))}function UV(r,e,t,n){return iy(r,e,5,No(r,e+1,n))}function FV(r,e,t,n){let i=Do(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Pe} 64-bit integer bytes lengths not supported`);return iy(r,e,9,i)}function X6(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===V.string?Y6(r.value):r.value),r.encodedBytes}function e1(r,e){let t=X6(e);mi(r,e.type.majorEncoded,t.length),r.push(t)}e1.encodedSize=function(e){let t=X6(e);return mi.encodedSize(t.length)+t.length};e1.compareTokens=function(e,t){return I4e(X6(e),X6(t))};function I4e(r,e){return r.length<e.length?-1:r.length>e.length?1:AV(r,e)}function oy(r,e,t,n,i){let o=t+n;Uu(r,e,o);let s=new oe(V.string,vV(r,e+t,e+o),o);return i.retainStringBytes===!0&&(s.byteValue=J0(r,e+t,e+o)),s}function zV(r,e,t,n){return oy(r,e,1,t,n)}function VV(r,e,t,n){return oy(r,e,2,Po(r,e+1,n),n)}function KV(r,e,t,n){return oy(r,e,3,ko(r,e+1,n),n)}function $V(r,e,t,n){return oy(r,e,5,No(r,e+1,n),n)}function qV(r,e,t,n){let i=Do(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Pe} 64-bit integer string lengths not supported`);return oy(r,e,9,i,n)}var HV=e1;function t1(r,e,t,n){return new oe(V.array,n,t)}function GV(r,e,t,n){return t1(r,e,1,t)}function jV(r,e,t,n){return t1(r,e,2,Po(r,e+1,n))}function WV(r,e,t,n){return t1(r,e,3,ko(r,e+1,n))}function YV(r,e,t,n){return t1(r,e,5,No(r,e+1,n))}function QV(r,e,t,n){let i=Do(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Pe} 64-bit integer array lengths not supported`);return t1(r,e,9,i)}function XV(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return t1(r,e,1,1/0)}function Z6(r,e){mi(r,V.array.majorEncoded,e.value)}Z6.compareTokens=Ts.compareTokens;Z6.encodedSize=function(e){return mi.encodedSize(e.value)};function r1(r,e,t,n){return new oe(V.map,n,t)}function ZV(r,e,t,n){return r1(r,e,1,t)}function JV(r,e,t,n){return r1(r,e,2,Po(r,e+1,n))}function eK(r,e,t,n){return r1(r,e,3,ko(r,e+1,n))}function tK(r,e,t,n){return r1(r,e,5,No(r,e+1,n))}function rK(r,e,t,n){let i=Do(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Pe} 64-bit integer map lengths not supported`);return r1(r,e,9,i)}function nK(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return r1(r,e,1,1/0)}function J6(r,e){mi(r,V.map.majorEncoded,e.value)}J6.compareTokens=Ts.compareTokens;J6.encodedSize=function(e){return mi.encodedSize(e.value)};function iK(r,e,t,n){return new oe(V.tag,t,1)}function oK(r,e,t,n){return new oe(V.tag,Po(r,e+1,n),2)}function sK(r,e,t,n){return new oe(V.tag,ko(r,e+1,n),3)}function aK(r,e,t,n){return new oe(V.tag,No(r,e+1,n),5)}function cK(r,e,t,n){return new oe(V.tag,Do(r,e+1,n),9)}function e8(r,e){mi(r,V.tag.majorEncoded,e.value)}e8.compareTokens=Ts.compareTokens;e8.encodedSize=function(e){return mi.encodedSize(e.value)};var D4e=20,O4e=21,L4e=22,B4e=23;function uK(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Pe} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new oe(V.null,null,1):new oe(V.undefined,void 0,1)}function lK(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return new oe(V.break,void 0,1)}function rT(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Pe} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Pe} Infinity values are not supported`)}return new oe(V.float,r,e)}function fK(r,e,t,n){return rT(nT(r,e+1),3,n)}function dK(r,e,t,n){return rT(iT(r,e+1),5,n)}function hK(r,e,t,n){return rT(yK(r,e+1),9,n)}function t8(r,e,t){let n=e.value;if(n===!1)r.push([V.float.majorEncoded|D4e]);else if(n===!0)r.push([V.float.majorEncoded|O4e]);else if(n===null)r.push([V.float.majorEncoded|L4e]);else if(n===void 0)r.push([V.float.majorEncoded|B4e]);else{let i,o=!1;(!t||t.float64!==!0)&&(mK(n),i=nT(Aa,1),n===i||Number.isNaN(n)?(Aa[0]=249,r.push(Aa.slice(0,3)),o=!0):(gK(n),i=iT(Aa,1),n===i&&(Aa[0]=250,r.push(Aa.slice(0,5)),o=!0))),o||(M4e(n),i=yK(Aa,1),Aa[0]=251,r.push(Aa.slice(0,9)))}}t8.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){mK(n);let i=nT(Aa,1);if(n===i||Number.isNaN(n))return 3;if(gK(n),i=iT(Aa,1),n===i)return 5}return 9};var pK=new ArrayBuffer(9),Is=new DataView(pK,1),Aa=new Uint8Array(pK,0);function mK(r){if(r===1/0)Is.setUint16(0,31744,!1);else if(r===-1/0)Is.setUint16(0,64512,!1);else if(Number.isNaN(r))Is.setUint16(0,32256,!1);else{Is.setFloat32(0,r);let e=Is.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Is.setUint16(0,31744,!1);else if(t===0)Is.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let i=t-127;i<-24?Is.setUint16(0,0):i<-14?Is.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Is.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function nT(r,e){if(r.length-e<2)throw new Error(`${Pe} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,i=t&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,t&32768?-o:o}function gK(r){Is.setFloat32(0,r,!1)}function iT(r,e){if(r.length-e<4)throw new Error(`${Pe} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function M4e(r){Is.setFloat64(0,r,!1)}function yK(r,e){if(r.length-e<8)throw new Error(`${Pe} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}t8.compareTokens=Ts.compareTokens;function Jt(r,e,t){throw new Error(`${Pe} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function r8(r){return()=>{throw new Error(`${Pe} ${r}`)}}var de=[];for(let r=0;r<=23;r++)de[r]=Jt;de[24]=TV;de[25]=IV;de[26]=RV;de[27]=CV;de[28]=Jt;de[29]=Jt;de[30]=Jt;de[31]=Jt;for(let r=32;r<=55;r++)de[r]=Jt;de[56]=PV;de[57]=kV;de[58]=NV;de[59]=OV;de[60]=Jt;de[61]=Jt;de[62]=Jt;de[63]=Jt;for(let r=64;r<=87;r++)de[r]=LV;de[88]=BV;de[89]=MV;de[90]=UV;de[91]=FV;de[92]=Jt;de[93]=Jt;de[94]=Jt;de[95]=r8("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)de[r]=zV;de[120]=VV;de[121]=KV;de[122]=$V;de[123]=qV;de[124]=Jt;de[125]=Jt;de[126]=Jt;de[127]=r8("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)de[r]=GV;de[152]=jV;de[153]=WV;de[154]=YV;de[155]=QV;de[156]=Jt;de[157]=Jt;de[158]=Jt;de[159]=XV;for(let r=160;r<=183;r++)de[r]=ZV;de[184]=JV;de[185]=eK;de[186]=tK;de[187]=rK;de[188]=Jt;de[189]=Jt;de[190]=Jt;de[191]=nK;for(let r=192;r<=215;r++)de[r]=iK;de[216]=oK;de[217]=sK;de[218]=aK;de[219]=cK;de[220]=Jt;de[221]=Jt;de[222]=Jt;de[223]=Jt;for(let r=224;r<=243;r++)de[r]=r8("simple values are not supported");de[244]=Jt;de[245]=Jt;de[246]=Jt;de[247]=uK;de[248]=r8("simple values are not supported");de[249]=fK;de[250]=dK;de[251]=hK;de[252]=Jt;de[253]=Jt;de[254]=Jt;de[255]=lK;var Ta=[];for(let r=0;r<24;r++)Ta[r]=new oe(V.uint,r,1);for(let r=-1;r>=-24;r--)Ta[31-r]=new oe(V.negint,r,1);Ta[64]=new oe(V.bytes,new Uint8Array(0),1);Ta[96]=new oe(V.string,"",1);Ta[128]=new oe(V.array,0,1);Ta[160]=new oe(V.map,0,1);Ta[244]=new oe(V.false,!1,1);Ta[245]=new oe(V.true,!0,1);Ta[246]=new oe(V.null,null,1);function wK(r){switch(r.type){case V.false:return bc([244]);case V.true:return bc([245]);case V.null:return bc([246]);case V.bytes:return r.value.length?void 0:bc([64]);case V.string:return r.value===""?bc([96]):void 0;case V.array:return r.value===0?bc([128]):void 0;case V.map:return r.value===0?bc([160]):void 0;case V.uint:return r.value<24?bc([Number(r.value)]):void 0;case V.negint:if(r.value>=-24)return bc([31-Number(r.value)])}}var F4e={float64:!1,mapSorter:K4e,quickEncodeToken:wK};function z4e(){let r=[];return r[V.uint.major]=Ts,r[V.negint.major]=Q6,r[V.bytes.major]=e1,r[V.string.major]=HV,r[V.array.major]=Z6,r[V.map.major]=J6,r[V.tag.major]=e8,r[V.float.major]=t8,r}var bK=z4e(),oT=new ry,n1=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Mu} object contains circular references`);return new n1(t,e)}},ff={null:new oe(V.null,null),undefined:new oe(V.undefined,void 0),true:new oe(V.true,!0),false:new oe(V.false,!1),emptyArray:new oe(V.array,0),emptyMap:new oe(V.map,0)},df={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new oe(V.float,r):r>=0?new oe(V.uint,r):new oe(V.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new oe(V.uint,r):new oe(V.negint,r)},Uint8Array(r,e,t,n){return new oe(V.bytes,r)},string(r,e,t,n){return new oe(V.string,r)},boolean(r,e,t,n){return r?ff.true:ff.false},null(r,e,t,n){return ff.null},undefined(r,e,t,n){return ff.undefined},ArrayBuffer(r,e,t,n){return new oe(V.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new oe(V.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[ff.emptyArray,new oe(V.break)]:ff.emptyArray;n=n1.createCheck(n,r);let i=[],o=0;for(let s of r)i[o++]=n8(s,t,n);return t.addBreakTokens?[new oe(V.array,r.length),i,new oe(V.break)]:[new oe(V.array,r.length),i]},Object(r,e,t,n){let i=e!=="Object",o=i?r.keys():Object.keys(r),s=i?r.size:o.length;if(!s)return t.addBreakTokens===!0?[ff.emptyMap,new oe(V.break)]:ff.emptyMap;n=n1.createCheck(n,r);let a=[],c=0;for(let u of o)a[c++]=[n8(u,t,n),n8(i?r.get(u):r[u],t,n)];return V4e(a,t),t.addBreakTokens?[new oe(V.map,s),a,new oe(V.break)]:[new oe(V.map,s),a]}};df.Map=df.Object;df.Buffer=df.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))df[`${r}Array`]=df.DataView;function n8(r,e={},t){let n=wV(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||df[n];if(typeof i=="function"){let s=i(r,n,e,t);if(s!=null)return s}let o=df[n];if(!o)throw new Error(`${Mu} unsupported type: ${n}`);return o(r,n,e,t)}function V4e(r,e){e.mapSorter&&r.sort(e.mapSorter)}function K4e(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let i=t.type.major,o=bK[i].compareTokens(t,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function _K(r,e,t,n){if(Array.isArray(e))for(let i of e)_K(r,i,t,n);else t[e.type.major](r,e,n)}function sT(r,e,t){let n=n8(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let i=t.quickEncodeToken(n);if(i)return i;let o=e[n.type.major];if(o.encodedSize){let s=o.encodedSize(n,t),a=new ry(s);if(o(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return ty(a.chunks[0])}}return oT.reset(),_K(oT,n,e,t),oT.toBytes(!0)}function aT(r,e){return e=Object.assign({},F4e,e),sT(r,bK,e)}var $4e={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},i8=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=Ta[e];if(t===void 0){let n=de[e];if(!n)throw new Error(`${Pe} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}},sy=Symbol.for("DONE"),o8=Symbol.for("BREAK");function q4e(r,e,t){let n=[];for(let i=0;i<r.value;i++){let o=i1(e,t);if(o===o8){if(r.value===1/0)break;throw new Error(`${Pe} got unexpected break to lengthed array`)}if(o===sy)throw new Error(`${Pe} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=o}return n}function H4e(r,e,t){let n=t.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=i1(e,t);if(a===o8){if(r.value===1/0)break;throw new Error(`${Pe} got unexpected break to lengthed map`)}if(a===sy)throw new Error(`${Pe} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Pe} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${Pe} found repeat map key "${a}"`);let c=i1(e,t);if(c===sy)throw new Error(`${Pe} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?o.set(a,c):i[a]=c}return n?o:i}function i1(r,e){if(r.done())return sy;let t=r.next();if(t.type===V.break)return o8;if(t.type.terminal)return t.value;if(t.type===V.array)return q4e(t,r,e);if(t.type===V.map)return H4e(t,r,e);if(t.type===V.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=i1(r,e);return e.tags[t.value](n)}throw new Error(`${Pe} tag not supported (${t.value})`)}throw new Error("unsupported")}function cT(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Pe} data to decode must be a Uint8Array`);e=Object.assign({},$4e,e);let t=e.tokenizer||new i8(r,e),n=i1(t,e);if(n===sy)throw new Error(`${Pe} did not find any content to decode`);if(n===o8)throw new Error(`${Pe} got unexpected break`);return[n,r.subarray(t.pos())]}function ay(r,e){let[t,n]=cT(r,e);if(n.length>0)throw new Error(`${Pe} too many terminals, data makes no sense`);return t}var EK=42;function vK(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function j4e(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=Xe.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new oe(V.tag,EK),new oe(V.bytes,t)]}function W4e(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Y4e(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var uT={float64:!0,typeEncoders:{Object:j4e,undefined:W4e,number:Y4e}},Q4e={...uT,typeEncoders:{...uT.typeEncoders}};function X4e(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Xe.decode(r.subarray(1))}var s8={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};s8.tags[EK]=X4e;var Z4e={...s8,tags:s8.tags.slice()},J4e="dag-cbor",lT=113,fT=r=>aT(r,uT),dT=r=>ay(vK(r),s8);var a1={};xe(a1,{code:()=>_T,decode:()=>AK,encode:()=>SK,format:()=>h6e,name:()=>d6e,parse:()=>m6e,stringify:()=>h6e});var hT=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===V.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===V.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[V.uint.major](e,t){this.prefix(e);let n=String(t.value),i=[];for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o);e.push(i)}[V.negint.major](e,t){this[V.uint.major](e,t)}[V.bytes.major](e,t){throw new Error(`${Mu} unsupported type: Uint8Array`)}[V.string.major](e,t){this.prefix(e);let n=Y6(JSON.stringify(t.value));e.push(n.length>32?ty(n):n)}[V.array.major](e,t){this.prefix(e),this.inRecursive.push({type:V.array,elements:0}),e.push([91])}[V.map.major](e,t){this.prefix(e),this.inRecursive.push({type:V.map,elements:0}),e.push([123])}[V.tag.major](e,t){}[V.float.major](e,t){if(t.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===V.array)e.push([93]);else if(s.type===V.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Mu} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),i=[],o=!1;for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s),!o&&(i[s]===46||i[s]===101||i[s]===69)&&(o=!0);o||(i.push(46),i.push(48)),e.push(i)}};function e6e(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${Mu} complex map keys are not supported`);let t=r[0],n=e[0];if(t.type!==V.string||n.type!==V.string)throw new Error(`${Mu} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${Mu} unexpected duplicate map keys, this is not supported`)}var t6e={addBreakTokens:!0,mapSorter:e6e};function pT(r,e){return e=Object.assign({},t6e,e),sT(r,new hT,e)}var s1=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Pe} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Pe} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,n=!1,i=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new oe(V.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Pe} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Pe} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));let o=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(o);return n?new oe(V.float,s,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new oe(s>=0?V.uint:V.negint,s,this._pos-e):new oe(s>=0?V.uint:V.negint,BigInt(o),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Pe} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let o=this._pos,s=0;o<this.data.length&&s<65536;o++,s++){let a=this.data[o];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this._pos,o));return this._pos=o+1,new oe(V.string,c,s)}}let e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Pe} unexpected end of unicode escape sequence at position ${this._pos}`);let o=0;for(let s=0;s<4;s++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Pe} unexpected unicode escape character at position ${this._pos}`);o=o*16+a,this._pos++}return o},i=()=>{let o=this.ch(),s=null,a=o>239?4:o>223?3:o>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Pe} unexpected unicode sequence at position ${this._pos}`);let c,u,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(f=(o&31)<<6|c&63,f>127&&(s=f));break;case 3:c=this.data[this._pos+1],u=this.data[this._pos+2],(c&192)===128&&(u&192)===128&&(f=(o&15)<<12|(c&63)<<6|u&63,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:c=this.data[this._pos+1],u=this.data[this._pos+2],l=this.data[this._pos+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(f=(o&15)<<18|(c&63)<<12|(u&63)<<6|l&63,f>65535&&f<1114112&&(s=f))}s===null?(s=65533,a=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|s&1023),t.push(s),this._pos+=a};for(;!this.done();){let o=this.ch(),s;switch(o){case 92:if(this._pos++,this.done())throw new Error(`${Pe} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Pe} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new oe(V.string,eT(t),this._pos-e);default:if(o<32)throw new Error(`${Pe} invalid control character at position ${this._pos}`);o<128?(t.push(o),this._pos++):i()}}throw new Error(`${Pe} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new oe(V.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new oe(V.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new oe(V.null,null,4);case 102:return this.expect([102,97,108,115,101]),new oe(V.false,!1,5);case 116:return this.expect([116,114,117,101]),new oe(V.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Pe} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new oe(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new oe(V.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new oe(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new oe(V.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Pe} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function mT(r,e){return e=Object.assign({tokenizer:new s1(r,e)},e),ay(r,e)}function gh({name:r,code:e,encode:t}){return new gT(r,e,t)}var gT=class{constructor(e,t,n){B(this,"name");B(this,"code");B(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?ph(this.code,t):t.then(n=>ph(this.code,n))}else throw Error("Unknown type, must be binary type")}};var yT={};xe(yT,{base64:()=>a8,base64pad:()=>n6e,base64url:()=>i6e,base64urlpad:()=>o6e});var a8=Jr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),n6e=Jr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i6e=Jr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),o6e=Jr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function s6e(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function a6e(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=Xe.asCID(r);if(!e)return null;let t=e.toString();return[new oe(V.map,1/0,1),new oe(V.string,"/",1),new oe(V.string,t,t.length),new oe(V.break,void 0,1)]}function c8(r){let e=a8.encode(r).slice(1);return[new oe(V.map,1/0,1),new oe(V.string,"/",1),new oe(V.map,1/0,1),new oe(V.string,"bytes",5),new oe(V.string,e,e.length),new oe(V.break,void 0,1),new oe(V.break,void 0,1)]}function Ia(r){return c8(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function c6e(r){return c8(new Uint8Array(r))}function u6e(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function l6e(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var f6e={typeEncoders:{Object:a6e,Buffer:c8,Uint8Array:c8,Int8Array:Ia,Uint16Array:Ia,Int16Array:Ia,Uint32Array:Ia,Int32Array:Ia,Float32Array:Ia,Float64Array:Ia,Uint8ClampedArray:Ia,BigInt64Array:Ia,BigUint64Array:Ia,DataView:Ia,ArrayBuffer:c6e,undefined:u6e,number:l6e}},wT=class extends s1{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===V.map){let t=this._next();if(t.type===V.string&&t.value==="/"){let n=this._next();if(n.type===V.string){if(this._next().type!==V.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new oe(V.tag,42,0)}if(n.type===V.map){let i=this._next();if(i.type===V.string&&i.value==="bytes"){let o=this._next();if(o.type===V.string){for(let a=0;a<2;a++)if(this._next().type!==V.break)throw new Error("Invalid encoded Bytes form");let s=a8.decode(`m${o.value}`);return new oe(V.bytes,s,o.value.length)}this.tokenBuffer.push(o)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},bT={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};bT.tags[42]=Xe.parse;var d6e="dag-json",_T=297,SK=r=>pT(r,f6e),AK=r=>{let e=s6e(r),t=Object.assign(bT,{tokenizer:new wT(e,bT)});return mT(e,t)},h6e=r=>p6e.decode(SK(r));var p6e=new TextDecoder,m6e=r=>AK(g6e.encode(r)),g6e=new TextEncoder;var yy={};xe(yy,{code:()=>H8e,decode:()=>Y8e,encode:()=>W8e,name:()=>q8e,toGeneral:()=>Z$});var RT={};xe(RT,{base64:()=>wh,base64pad:()=>A6e,base64url:()=>u8,base64urlpad:()=>T6e});function y6e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,x=p.length;_!==x&&p[_]===0;)_++,g++;for(var m=(x-_)*l+1>>>0,y=new Uint8Array(m);_!==x;){for(var b=p[_],E=0,v=m-1;(b!==0||E<w)&&v!==-1;v--,E++)b+=256*y[v]>>>0,y[v]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");w=E,_++}for(var S=m-w;S!==m&&y[S]===0;)S++;for(var A=c.repeat(g);S<m;++S)A+=r.charAt(y[S]);return A}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var x=(p.length-g)*u+1>>>0,m=new Uint8Array(x);p[g];){var y=t[p.charCodeAt(g)];if(y===255)return;for(var b=0,E=x-1;(y!==0||b<_)&&E!==-1;E--,b++)y+=a*m[E]>>>0,m[E]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");_=b,g++}if(p[g]!==" "){for(var v=x-_;v!==x&&m[v]===0;)v++;for(var S=new Uint8Array(w+(x-v)),A=w;v!==x;)S[A++]=m[v++];return S}}}function d(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:d}}var w6e=y6e,b6e=w6e,TK=b6e;var yh={};xe(yh,{coerce:()=>_c,empty:()=>IK,equals:()=>ET,fromHex:()=>E6e,fromString:()=>vT,isBinary:()=>v6e,toHex:()=>_6e,toString:()=>xT});var IK=new Uint8Array(0),_6e=r=>r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),E6e=r=>{let e=r.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):IK},ET=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},_c=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},v6e=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),vT=r=>new TextEncoder().encode(r),xT=r=>new TextDecoder().decode(r);var ST=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},AT=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return RK(this,e)}},TT=class{constructor(e){this.decoders=e}or(e){return RK(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},RK=(r,e)=>new TT({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),IT=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ST(e,t,n),this.decoder=new AT(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},c1=({name:r,prefix:e,encode:t,decode:n})=>new IT(r,e,t,n),hf=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=TK(t,e);return c1({prefix:r,name:e,encode:n,decode:o=>_c(i(o))})},x6e=(r,e,t,n)=>{let i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let o=r.length;for(;r[o-1]==="=";)--o;let s=new Uint8Array(o*t/8|0),a=0,c=0,u=0;for(let l=0;l<o;++l){let f=i[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},S6e=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,o="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o},tn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>c1({prefix:e,name:r,encode(i){return S6e(i,n,t)},decode(i){return x6e(i,n,t,r)}});var wh=tn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),A6e=tn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),u8=tn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),T6e=tn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Ra(r){return u8.encode(r).slice(1)}function Rs(r){return u8.decode(`u${r}`)}var I6e=kK,CK=128,R6e=127,C6e=~R6e,P6e=Math.pow(2,31);function kK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=P6e;)e[t++]=r&255|CK,r/=128;for(;r&C6e;)e[t++]=r&255|CK,r>>>=7;return e[t]=r|0,kK.bytes=t-n+1,e}var k6e=CT,N6e=128,PK=127;function CT(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw CT.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&PK)<<i:(s&PK)*Math.pow(2,i),i+=7}while(s>=N6e);return CT.bytes=o-n,t}var D6e=Math.pow(2,7),O6e=Math.pow(2,14),L6e=Math.pow(2,21),B6e=Math.pow(2,28),M6e=Math.pow(2,35),U6e=Math.pow(2,42),F6e=Math.pow(2,49),z6e=Math.pow(2,56),V6e=Math.pow(2,63),K6e=function(r){return r<D6e?1:r<O6e?2:r<L6e?3:r<B6e?4:r<M6e?5:r<U6e?6:r<F6e?7:r<z6e?8:r<V6e?9:10},$6e={encode:I6e,decode:k6e,encodingLength:K6e},q6e=$6e,cy=q6e;var uy=(r,e=0)=>[cy.decode(r,e),cy.decode.bytes],u1=(r,e,t=0)=>(cy.encode(r,e,t),e),l1=r=>cy.encodingLength(r);var Ec=(r,e)=>{let t=e.byteLength,n=l1(r),i=n+l1(t),o=new Uint8Array(i+t);return u1(r,o,0),u1(t,o,n),o.set(e,i),new f1(r,t,e,o)},Jn=r=>{let e=_c(r),[t,n]=uy(e),[i,o]=uy(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new f1(t,i,s,e)},NK=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ET(r.bytes,t.bytes)}},f1=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var PT={};xe(PT,{base58btc:()=>tt,base58flickr:()=>H6e});var tt=hf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),H6e=hf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var NT={};xe(NT,{base32:()=>Ot,base32hex:()=>W6e,base32hexpad:()=>Q6e,base32hexpadupper:()=>X6e,base32hexupper:()=>Y6e,base32pad:()=>kT,base32padupper:()=>j6e,base32upper:()=>G6e,base32z:()=>Z6e});var Ot=tn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),G6e=tn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kT=tn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),j6e=tn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),W6e=tn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Y6e=tn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Q6e=tn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X6e=tn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Z6e=tn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var DK=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return e8e(t,DT(r),e||tt.encoder);default:return t8e(t,DT(r),e||Ot.encoder)}};var OK=new WeakMap,DT=r=>{let e=OK.get(r);if(e==null){let t=new Map;return OK.set(r,t),t}return e},ce=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==ly)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==r8e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ce.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ec(e,t);return ce.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ce.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&NK(e.multihash,n.multihash)}toString(e){return DK(this,e)}toJSON(){return{"/":DK(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof ce)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:o,bytes:s}=t;return new ce(n,i,o,s||LK(n,i,o.bytes))}else if(t[n8e]===!0){let{version:n,multihash:i,code:o}=t,s=Jn(i);return ce.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ly)throw new Error(`Version 0 CID must use dag-pb (code: ${ly}) block encoding`);return new ce(e,t,n,n.bytes)}case 1:{let i=LK(e,t,n.bytes);return new ce(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return ce.create(0,ly,e)}static createV1(e,t){return ce.create(1,e,t)}static decode(e){let[t,n]=ce.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=ce.inspectBytes(e),n=t.size-t.multihashSize,i=_c(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=i.subarray(t.multihashSize-t.digestSize),s=new f1(t.multihashCode,t.digestSize,o,i);return[t.version===0?ce.createV0(s):ce.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=uy(e.subarray(t));return t+=h,f},i=n(),o=ly;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=t,a=n(),c=n(),u=t+c,l=u-s;return{version:i,codec:o,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[n,i]=J6e(e,t),o=ce.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return DT(o).set(n,e),o}},J6e=(r,e)=>{switch(r[0]){case"Q":{let t=e||tt;return[tt.prefix,t.decode(`${tt.prefix}${r}`)]}case tt.prefix:{let t=e||tt;return[tt.prefix,t.decode(r)]}case Ot.prefix:{let t=e||Ot;return[Ot.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},e8e=(r,e,t)=>{let{prefix:n}=t;if(n!==tt.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return i},t8e=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let o=t.encode(r);return e.set(n,o),o}else return i},ly=112,r8e=18,LK=(r,e,t)=>{let n=l1(r),i=n+l1(e),o=new Uint8Array(i+t.byteLength);return u1(r,o,0),u1(e,o,n),o.set(t,i),o},n8e=Symbol.for("@ipld/js-cid/CID");function BK(r){let[e,t,n]=r;return{payload:t,signatures:[{protected:e,signature:n}],link:ce.decode(Rs(t))}}function i8e(r){let e={signature:Rs(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=Rs(r.protected)),e}function MK(r){let e=Rs(r.payload);try{ce.decode(e)}catch{throw new Error("Not a valid DagJWS")}return{payload:e,signatures:r.signatures.map(i8e)}}function o8e(r){let e={signature:Ra(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=Ra(r.protected)),e}function UK(r){let e={payload:Ra(r.payload),signatures:r.signatures.map(o8e)};return e.link=ce.decode(new Uint8Array(r.payload)),e}function FK(r){let[e,t,n,i,o]=r,s={ciphertext:i,iv:n,protected:e,tag:o};return t&&(s.recipients=[{encrypted_key:t}]),s}function a8e(r){let e={};return r.encrypted_key&&(e.encrypted_key=Rs(r.encrypted_key)),r.header&&(e.header=r.header),e}function zK(r){let e={ciphertext:Rs(r.ciphertext),protected:Rs(r.protected),iv:Rs(r.iv),tag:Rs(r.tag)};return r.aad&&(e.aad=Rs(r.aad)),r.recipients&&(e.recipients=r.recipients.map(a8e)),r.unprotected&&(e.unprotected=r.unprotected),e}function c8e(r){let e={};return r.encrypted_key&&(e.encrypted_key=Ra(r.encrypted_key)),r.header&&(e.header=r.header),e}function VK(r){let e={ciphertext:Ra(r.ciphertext),protected:Ra(r.protected),iv:Ra(r.iv),tag:Ra(r.tag)};return r.aad&&(e.aad=Ra(r.aad)),r.recipients&&(e.recipients=r.recipients.map(c8e)),r.unprotected&&(e.unprotected=r.unprotected),e}var l8e=["string","number","bigint","symbol"],f8e=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function KK(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(l8e.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(d8e(r))return"Buffer";let t=h8e(r);return t||"Object"}function d8e(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function h8e(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(f8e.includes(e))return e}var Q=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};Q.uint=new Q(0,"uint",!0);Q.negint=new Q(1,"negint",!0);Q.bytes=new Q(2,"bytes",!0);Q.string=new Q(3,"string",!0);Q.array=new Q(4,"array",!1);Q.map=new Q(5,"map",!1);Q.tag=new Q(6,"tag",!1);Q.float=new Q(7,"float",!0);Q.false=new Q(7,"false",!0);Q.true=new Q(7,"true",!0);Q.null=new Q(7,"null",!0);Q.undefined=new Q(7,"undefined",!0);Q.break=new Q(7,"break",!0);var Se=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var d1=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",p8e=new TextDecoder,m8e=new TextEncoder;function f8(r){return d1&&globalThis.Buffer.isBuffer(r)}function OT(r){return r instanceof Uint8Array?f8(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var GK=d1?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):qK(r,e,t):(r,e,t)=>t-e>64?p8e.decode(r.subarray(e,t)):qK(r,e,t),jK=d1?r=>r.length>64?globalThis.Buffer.from(r):$K(r):r=>r.length>64?m8e.encode(r):$K(r),vc=r=>Uint8Array.from(r),h1=d1?(r,e,t)=>f8(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),WK=d1?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),OT(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},YK=d1?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function QK(r,e){if(f8(r)&&f8(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function $K(r,e=1/0){let t,n=r.length,i=null,o=[];for(let s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function qK(r,e,t){let n=[];for(;e<t;){let i=r[e],o=null,s=i>239?4:i>223?3:i>191?2:1;if(e+s<=t){let a,c,u,l;switch(s){case 1:i<128&&(o=i);break;case 2:a=r[e+1],(a&192)===128&&(l=(i&31)<<6|a&63,l>127&&(o=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(i&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(i&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(o=l))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=s}return g8e(n)}var HK=4096;function g8e(r){let e=r.length;if(e<=HK)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=HK));return t}var y8e=256,fy=class{constructor(e=y8e){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){let i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=YK(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=h1(n,0,this.cursor)}else t=WK(this.chunks,this.cursor);return e&&this.reset(),t}};var nt="CBOR decode error:",LT="CBOR encode error:",dy=[];dy[23]=1;dy[24]=2;dy[25]=3;dy[26]=5;dy[27]=9;function Fu(r,e,t){if(r.length-e<t)throw new Error(`${nt} not enough data for type`)}var ei=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Lo(r,e,t){Fu(r,e,1);let n=r[e];if(t.strict===!0&&n<ei[0])throw new Error(`${nt} integer encoded in more bytes than necessary (strict decode)`);return n}function Bo(r,e,t){Fu(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<ei[1])throw new Error(`${nt} integer encoded in more bytes than necessary (strict decode)`);return n}function Mo(r,e,t){Fu(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<ei[2])throw new Error(`${nt} integer encoded in more bytes than necessary (strict decode)`);return n}function Uo(r,e,t){Fu(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&o<ei[3])throw new Error(`${nt} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${nt} integers outside of the safe integer range are not supported`)}function XK(r,e,t,n){return new Se(Q.uint,Lo(r,e+1,n),2)}function ZK(r,e,t,n){return new Se(Q.uint,Bo(r,e+1,n),3)}function JK(r,e,t,n){return new Se(Q.uint,Mo(r,e+1,n),5)}function e$(r,e,t,n){return new Se(Q.uint,Uo(r,e+1,n),9)}function Cs(r,e){return gi(r,0,e.value)}function gi(r,e,t){if(t<ei[0]){let n=Number(t);r.push([e|n])}else if(t<ei[1]){let n=Number(t);r.push([e|24,n])}else if(t<ei[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<ei[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<ei[4]){let i=[e|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,r.push(i)}else throw new Error(`${nt} encountered BigInt larger than allowable range`)}}Cs.encodedSize=function(e){return gi.encodedSize(e.value)};gi.encodedSize=function(e){return e<ei[0]?1:e<ei[1]?2:e<ei[2]?3:e<ei[3]?5:9};Cs.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function t$(r,e,t,n){return new Se(Q.negint,-1-Lo(r,e+1,n),2)}function r$(r,e,t,n){return new Se(Q.negint,-1-Bo(r,e+1,n),3)}function n$(r,e,t,n){return new Se(Q.negint,-1-Mo(r,e+1,n),5)}var BT=BigInt(-1),i$=BigInt(1);function o$(r,e,t,n){let i=Uo(r,e+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new Se(Q.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${nt} integers outside of the safe integer range are not supported`);return new Se(Q.negint,BT-BigInt(i),9)}function d8(r,e){let t=e.value,n=typeof t=="bigint"?t*BT-i$:t*-1-1;gi(r,e.type.majorEncoded,n)}d8.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*BT-i$:t*-1-1;return n<ei[0]?1:n<ei[1]?2:n<ei[2]?3:n<ei[3]?5:9};d8.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function hy(r,e,t,n){Fu(r,e,t+n);let i=h1(r,e+t,e+t+n);return new Se(Q.bytes,i,t+n)}function s$(r,e,t,n){return hy(r,e,1,t)}function a$(r,e,t,n){return hy(r,e,2,Lo(r,e+1,n))}function c$(r,e,t,n){return hy(r,e,3,Bo(r,e+1,n))}function u$(r,e,t,n){return hy(r,e,5,Mo(r,e+1,n))}function l$(r,e,t,n){let i=Uo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${nt} 64-bit integer bytes lengths not supported`);return hy(r,e,9,i)}function h8(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===Q.string?jK(r.value):r.value),r.encodedBytes}function p1(r,e){let t=h8(e);gi(r,e.type.majorEncoded,t.length),r.push(t)}p1.encodedSize=function(e){let t=h8(e);return gi.encodedSize(t.length)+t.length};p1.compareTokens=function(e,t){return b8e(h8(e),h8(t))};function b8e(r,e){return r.length<e.length?-1:r.length>e.length?1:QK(r,e)}function py(r,e,t,n,i){let o=t+n;Fu(r,e,o);let s=new Se(Q.string,GK(r,e+t,e+o),o);return i.retainStringBytes===!0&&(s.byteValue=h1(r,e+t,e+o)),s}function f$(r,e,t,n){return py(r,e,1,t,n)}function d$(r,e,t,n){return py(r,e,2,Lo(r,e+1,n),n)}function h$(r,e,t,n){return py(r,e,3,Bo(r,e+1,n),n)}function p$(r,e,t,n){return py(r,e,5,Mo(r,e+1,n),n)}function m$(r,e,t,n){let i=Uo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${nt} 64-bit integer string lengths not supported`);return py(r,e,9,i,n)}var g$=p1;function m1(r,e,t,n){return new Se(Q.array,n,t)}function y$(r,e,t,n){return m1(r,e,1,t)}function w$(r,e,t,n){return m1(r,e,2,Lo(r,e+1,n))}function b$(r,e,t,n){return m1(r,e,3,Bo(r,e+1,n))}function _$(r,e,t,n){return m1(r,e,5,Mo(r,e+1,n))}function E$(r,e,t,n){let i=Uo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${nt} 64-bit integer array lengths not supported`);return m1(r,e,9,i)}function v$(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${nt} indefinite length items not allowed`);return m1(r,e,1,1/0)}function p8(r,e){gi(r,Q.array.majorEncoded,e.value)}p8.compareTokens=Cs.compareTokens;p8.encodedSize=function(e){return gi.encodedSize(e.value)};function g1(r,e,t,n){return new Se(Q.map,n,t)}function x$(r,e,t,n){return g1(r,e,1,t)}function S$(r,e,t,n){return g1(r,e,2,Lo(r,e+1,n))}function A$(r,e,t,n){return g1(r,e,3,Bo(r,e+1,n))}function T$(r,e,t,n){return g1(r,e,5,Mo(r,e+1,n))}function I$(r,e,t,n){let i=Uo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${nt} 64-bit integer map lengths not supported`);return g1(r,e,9,i)}function R$(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${nt} indefinite length items not allowed`);return g1(r,e,1,1/0)}function m8(r,e){gi(r,Q.map.majorEncoded,e.value)}m8.compareTokens=Cs.compareTokens;m8.encodedSize=function(e){return gi.encodedSize(e.value)};function C$(r,e,t,n){return new Se(Q.tag,t,1)}function P$(r,e,t,n){return new Se(Q.tag,Lo(r,e+1,n),2)}function k$(r,e,t,n){return new Se(Q.tag,Bo(r,e+1,n),3)}function N$(r,e,t,n){return new Se(Q.tag,Mo(r,e+1,n),5)}function D$(r,e,t,n){return new Se(Q.tag,Uo(r,e+1,n),9)}function g8(r,e){gi(r,Q.tag.majorEncoded,e.value)}g8.compareTokens=Cs.compareTokens;g8.encodedSize=function(e){return gi.encodedSize(e.value)};var A8e=20,T8e=21,I8e=22,R8e=23;function O$(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${nt} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Se(Q.null,null,1):new Se(Q.undefined,void 0,1)}function L$(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${nt} indefinite length items not allowed`);return new Se(Q.break,void 0,1)}function MT(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${nt} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${nt} Infinity values are not supported`)}return new Se(Q.float,r,e)}function B$(r,e,t,n){return MT(UT(r,e+1),3,n)}function M$(r,e,t,n){return MT(FT(r,e+1),5,n)}function U$(r,e,t,n){return MT(K$(r,e+1),9,n)}function y8(r,e,t){let n=e.value;if(n===!1)r.push([Q.float.majorEncoded|A8e]);else if(n===!0)r.push([Q.float.majorEncoded|T8e]);else if(n===null)r.push([Q.float.majorEncoded|I8e]);else if(n===void 0)r.push([Q.float.majorEncoded|R8e]);else{let i,o=!1;(!t||t.float64!==!0)&&(z$(n),i=UT(Ca,1),n===i||Number.isNaN(n)?(Ca[0]=249,r.push(Ca.slice(0,3)),o=!0):(V$(n),i=FT(Ca,1),n===i&&(Ca[0]=250,r.push(Ca.slice(0,5)),o=!0))),o||(C8e(n),i=K$(Ca,1),Ca[0]=251,r.push(Ca.slice(0,9)))}}y8.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){z$(n);let i=UT(Ca,1);if(n===i||Number.isNaN(n))return 3;if(V$(n),i=FT(Ca,1),n===i)return 5}return 9};var F$=new ArrayBuffer(9),Ps=new DataView(F$,1),Ca=new Uint8Array(F$,0);function z$(r){if(r===1/0)Ps.setUint16(0,31744,!1);else if(r===-1/0)Ps.setUint16(0,64512,!1);else if(Number.isNaN(r))Ps.setUint16(0,32256,!1);else{Ps.setFloat32(0,r);let e=Ps.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Ps.setUint16(0,31744,!1);else if(t===0)Ps.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let i=t-127;i<-24?Ps.setUint16(0,0):i<-14?Ps.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Ps.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function UT(r,e){if(r.length-e<2)throw new Error(`${nt} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,i=t&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,t&32768?-o:o}function V$(r){Ps.setFloat32(0,r,!1)}function FT(r,e){if(r.length-e<4)throw new Error(`${nt} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function C8e(r){Ps.setFloat64(0,r,!1)}function K$(r,e){if(r.length-e<8)throw new Error(`${nt} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}y8.compareTokens=Cs.compareTokens;function er(r,e,t){throw new Error(`${nt} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function w8(r){return()=>{throw new Error(`${nt} ${r}`)}}var he=[];for(let r=0;r<=23;r++)he[r]=er;he[24]=XK;he[25]=ZK;he[26]=JK;he[27]=e$;he[28]=er;he[29]=er;he[30]=er;he[31]=er;for(let r=32;r<=55;r++)he[r]=er;he[56]=t$;he[57]=r$;he[58]=n$;he[59]=o$;he[60]=er;he[61]=er;he[62]=er;he[63]=er;for(let r=64;r<=87;r++)he[r]=s$;he[88]=a$;he[89]=c$;he[90]=u$;he[91]=l$;he[92]=er;he[93]=er;he[94]=er;he[95]=w8("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)he[r]=f$;he[120]=d$;he[121]=h$;he[122]=p$;he[123]=m$;he[124]=er;he[125]=er;he[126]=er;he[127]=w8("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)he[r]=y$;he[152]=w$;he[153]=b$;he[154]=_$;he[155]=E$;he[156]=er;he[157]=er;he[158]=er;he[159]=v$;for(let r=160;r<=183;r++)he[r]=x$;he[184]=S$;he[185]=A$;he[186]=T$;he[187]=I$;he[188]=er;he[189]=er;he[190]=er;he[191]=R$;for(let r=192;r<=215;r++)he[r]=C$;he[216]=P$;he[217]=k$;he[218]=N$;he[219]=D$;he[220]=er;he[221]=er;he[222]=er;he[223]=er;for(let r=224;r<=243;r++)he[r]=w8("simple values are not supported");he[244]=er;he[245]=er;he[246]=er;he[247]=O$;he[248]=w8("simple values are not supported");he[249]=B$;he[250]=M$;he[251]=U$;he[252]=er;he[253]=er;he[254]=er;he[255]=L$;var Pa=[];for(let r=0;r<24;r++)Pa[r]=new Se(Q.uint,r,1);for(let r=-1;r>=-24;r--)Pa[31-r]=new Se(Q.negint,r,1);Pa[64]=new Se(Q.bytes,new Uint8Array(0),1);Pa[96]=new Se(Q.string,"",1);Pa[128]=new Se(Q.array,0,1);Pa[160]=new Se(Q.map,0,1);Pa[244]=new Se(Q.false,!1,1);Pa[245]=new Se(Q.true,!0,1);Pa[246]=new Se(Q.null,null,1);function $$(r){switch(r.type){case Q.false:return vc([244]);case Q.true:return vc([245]);case Q.null:return vc([246]);case Q.bytes:return r.value.length?void 0:vc([64]);case Q.string:return r.value===""?vc([96]):void 0;case Q.array:return r.value===0?vc([128]):void 0;case Q.map:return r.value===0?vc([160]):void 0;case Q.uint:return r.value<24?vc([Number(r.value)]):void 0;case Q.negint:if(r.value>=-24)return vc([31-Number(r.value)])}}var k8e={float64:!1,mapSorter:O8e,quickEncodeToken:$$};function N8e(){let r=[];return r[Q.uint.major]=Cs,r[Q.negint.major]=d8,r[Q.bytes.major]=p1,r[Q.string.major]=g$,r[Q.array.major]=p8,r[Q.map.major]=m8,r[Q.tag.major]=g8,r[Q.float.major]=y8,r}var q$=N8e(),zT=new fy,y1=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${LT} object contains circular references`);return new y1(t,e)}},pf={null:new Se(Q.null,null),undefined:new Se(Q.undefined,void 0),true:new Se(Q.true,!0),false:new Se(Q.false,!1),emptyArray:new Se(Q.array,0),emptyMap:new Se(Q.map,0)},mf={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new Se(Q.float,r):r>=0?new Se(Q.uint,r):new Se(Q.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new Se(Q.uint,r):new Se(Q.negint,r)},Uint8Array(r,e,t,n){return new Se(Q.bytes,r)},string(r,e,t,n){return new Se(Q.string,r)},boolean(r,e,t,n){return r?pf.true:pf.false},null(r,e,t,n){return pf.null},undefined(r,e,t,n){return pf.undefined},ArrayBuffer(r,e,t,n){return new Se(Q.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new Se(Q.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[pf.emptyArray,new Se(Q.break)]:pf.emptyArray;n=y1.createCheck(n,r);let i=[],o=0;for(let s of r)i[o++]=b8(s,t,n);return t.addBreakTokens?[new Se(Q.array,r.length),i,new Se(Q.break)]:[new Se(Q.array,r.length),i]},Object(r,e,t,n){let i=e!=="Object",o=i?r.keys():Object.keys(r),s=i?r.size:o.length;if(!s)return t.addBreakTokens===!0?[pf.emptyMap,new Se(Q.break)]:pf.emptyMap;n=y1.createCheck(n,r);let a=[],c=0;for(let u of o)a[c++]=[b8(u,t,n),b8(i?r.get(u):r[u],t,n)];return D8e(a,t),t.addBreakTokens?[new Se(Q.map,s),a,new Se(Q.break)]:[new Se(Q.map,s),a]}};mf.Map=mf.Object;mf.Buffer=mf.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))mf[`${r}Array`]=mf.DataView;function b8(r,e={},t){let n=KK(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||mf[n];if(typeof i=="function"){let s=i(r,n,e,t);if(s!=null)return s}let o=mf[n];if(!o)throw new Error(`${LT} unsupported type: ${n}`);return o(r,n,e,t)}function D8e(r,e){e.mapSorter&&r.sort(e.mapSorter)}function O8e(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let i=t.type.major,o=q$[i].compareTokens(t,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function H$(r,e,t,n){if(Array.isArray(e))for(let i of e)H$(r,i,t,n);else t[e.type.major](r,e,n)}function L8e(r,e,t){let n=b8(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let i=t.quickEncodeToken(n);if(i)return i;let o=e[n.type.major];if(o.encodedSize){let s=o.encodedSize(n,t),a=new fy(s);if(o(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return OT(a.chunks[0])}}return zT.reset(),H$(zT,n,e,t),zT.toBytes(!0)}function zu(r,e){return e=Object.assign({},k8e,e),L8e(r,q$,e)}var B8e={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},VT=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Pa[e];if(t===void 0){let n=he[e];if(!n)throw new Error(`${nt} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}},my=Symbol.for("DONE"),_8=Symbol.for("BREAK");function M8e(r,e,t){let n=[];for(let i=0;i<r.value;i++){let o=gy(e,t);if(o===_8){if(r.value===1/0)break;throw new Error(`${nt} got unexpected break to lengthed array`)}if(o===my)throw new Error(`${nt} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=o}return n}function U8e(r,e,t){let n=t.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=gy(e,t);if(a===_8){if(r.value===1/0)break;throw new Error(`${nt} got unexpected break to lengthed map`)}if(a===my)throw new Error(`${nt} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${nt} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${nt} found repeat map key "${a}"`);let c=gy(e,t);if(c===my)throw new Error(`${nt} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?o.set(a,c):i[a]=c}return n?o:i}function gy(r,e){if(r.done())return my;let t=r.next();if(t.type===Q.break)return _8;if(t.type.terminal)return t.value;if(t.type===Q.array)return M8e(t,r,e);if(t.type===Q.map)return U8e(t,r,e);if(t.type===Q.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=gy(r,e);return e.tags[t.value](n)}throw new Error(`${nt} tag not supported (${t.value})`)}throw new Error("unsupported")}function ks(r,e){if(!(r instanceof Uint8Array))throw new Error(`${nt} data to decode must be a Uint8Array`);e=Object.assign({},B8e,e);let t=e.tokenizer||new VT(r,e),n=gy(t,e);if(n===my)throw new Error(`${nt} did not find any content to decode`);if(n===_8)throw new Error(`${nt} got unexpected break`);if(!t.done())throw new Error(`${nt} too many terminals, data makes no sense`);return n}var G$=42;function F8e(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=ce.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new Se(Q.tag,G$),new Se(Q.bytes,t)]}function z8e(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function V8e(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var K8e={float64:!0,typeEncoders:{Object:F8e,undefined:z8e,number:V8e}};function $8e(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return ce.decode(r.subarray(1))}var j$={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};j$.tags[G$]=$8e;var W$=113,Y$=r=>zu(r,K8e),E8=r=>ks(r,j$);var q8e="dag-jose",H8e=133;function Q$(r){return"payload"in r&&typeof r.payload=="string"&&"signatures"in r&&Array.isArray(r.signatures)}function G8e(r){return"payload"in r&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures)}function j8e(r){return"ciphertext"in r&&r.ciphertext instanceof Uint8Array&&"iv"in r&&r.iv instanceof Uint8Array&&"protected"in r&&r.protected instanceof Uint8Array&&"tag"in r&&r.tag instanceof Uint8Array}function X$(r){return"ciphertext"in r&&typeof r.ciphertext=="string"&&"iv"in r&&typeof r.iv=="string"&&"protected"in r&&typeof r.protected=="string"&&"tag"in r&&typeof r.tag=="string"}function Z$(r){if(typeof r=="string"){let e=r.split(".");if(e.length===3)return BK(e);if(e.length===5)return FK(e);throw new Error("Not a valid JOSE string")}if(Q$(r)||X$(r))return r;throw new Error("Not a valid unencoded JOSE object")}function W8e(r){typeof r=="string"&&(r=Z$(r));let e;if(Q$(r))e=MK(r);else if(X$(r))e=zK(r);else throw new Error("Not a valid JOSE object");return new Uint8Array(Y$(e))}function Y8e(r){let e;try{e=E8(r)}catch{throw new Error("Not a valid DAG-JOSE object")}if(G8e(e))return UK(e);if(j8e(e))return VK(e);throw new Error("Not a valid DAG-JOSE object")}var qT={};xe(qT,{identity:()=>Ii});var J$=0,Q8e="identity",eq=_a,X8e=r=>hc(J$,eq(r)),Ii={code:J$,name:Q8e,encode:eq,digest:X8e};var HT={};xe(HT,{identity:()=>Z8e});var Z8e=M0({prefix:"\0",name:"identity",encode:r=>WU(r),decode:r=>jU(r)});var GT={};xe(GT,{base2:()=>J8e});var J8e=Zr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jT={};xe(jT,{base8:()=>ebe});var ebe=Zr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var WT={};xe(WT,{base10:()=>tbe});var tbe=tf({prefix:"9",name:"base10",alphabet:"0123456789"});var YT={};xe(YT,{base16:()=>rbe,base16upper:()=>nbe});var rbe=Zr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nbe=Zr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var QT={};xe(QT,{base36:()=>w1,base36upper:()=>ibe});var w1=tf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ibe=tf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var XT={};xe(XT,{base256emoji:()=>ube});var tq=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),obe=tq.reduce((r,e,t)=>(r[t]=e,r),[]),sbe=tq.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function abe(r){return r.reduce((e,t)=>(e+=obe[t],e),"")}function cbe(r){let e=[];for(let t of r){let n=sbe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var ube=M0({prefix:"\u{1F680}",name:"base256emoji",encode:abe,decode:cbe});var yf={};xe(yf,{code:()=>gf,decode:()=>dbe,encode:()=>fbe,name:()=>lbe});var lbe="raw",gf=85,fbe=r=>_a(r),dbe=r=>_a(r);var Vu={...HT,...GT,...jT,...WT,...YT,...lA,...QT,...cA,...SA,...XT},v8={...mA,...qT},x8={raw:yf,json:Vg};var Ku=class extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=Ku.code}};Ku.code="ERR_NOT_INITIALIZED";var ZT=class extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=ka.code}};ZT.code="ERR_ALREADY_INITIALIZING";var ka=class extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=ka.code}};ka.code="ERR_ALREADY_INITIALIZED";var $u=class extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=$u.code}};$u.code="ERR_NOT_STARTED";var _h=class extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=_h.code}};_h.code="ERR_ALREADY_STARTING";var Eh=class extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=Eh.code}};Eh.code="ERR_ALREADY_STARTED";var Na=class extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=Na.code}};Na.code="ERR_NOT_ENABLED";function wf(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}var nI={};xe(nI,{base10:()=>wbe});function hbe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,x=p.length;_!==x&&p[_]===0;)_++,g++;for(var m=(x-_)*l+1>>>0,y=new Uint8Array(m);_!==x;){for(var b=p[_],E=0,v=m-1;(b!==0||E<w)&&v!==-1;v--,E++)b+=256*y[v]>>>0,y[v]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");w=E,_++}for(var S=m-w;S!==m&&y[S]===0;)S++;for(var A=c.repeat(g);S<m;++S)A+=r.charAt(y[S]);return A}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var x=(p.length-g)*u+1>>>0,m=new Uint8Array(x);p[g];){var y=t[p.charCodeAt(g)];if(y===255)return;for(var b=0,E=x-1;(y!==0||b<_)&&E!==-1;E--,b++)y+=a*m[E]>>>0,m[E]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");_=b,g++}if(p[g]!==" "){for(var v=x-_;v!==x&&m[v]===0;)v++;for(var S=new Uint8Array(w+(x-v)),A=w;v!==x;)S[A++]=m[v++];return S}}}function d(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:d}}var pbe=hbe,mbe=pbe,rq=mbe;var _Ze=new Uint8Array(0);var nq=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},qu=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var iq=r=>new TextEncoder().encode(r),oq=r=>new TextDecoder().decode(r);var JT=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},eI=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return aq(this,e)}},tI=class{constructor(e){this.decoders=e}or(e){return aq(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},aq=(r,e)=>new tI({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),rI=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new JT(e,t,n),this.decoder=new eI(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},b1=({name:r,prefix:e,encode:t,decode:n})=>new rI(r,e,t,n),bf=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=rq(t,e);return b1({prefix:r,name:e,encode:n,decode:o=>qu(i(o))})},gbe=(r,e,t,n)=>{let i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let o=r.length;for(;r[o-1]==="=";)--o;let s=new Uint8Array(o*t/8|0),a=0,c=0,u=0;for(let l=0;l<o;++l){let f=i[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},ybe=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,o="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o},rn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>b1({prefix:e,name:r,encode(i){return ybe(i,n,t)},decode(i){return gbe(i,n,t,r)}});var wbe=bf({prefix:"9",name:"base10",alphabet:"0123456789"});var iI={};xe(iI,{base16:()=>bbe,base16upper:()=>_be});var bbe=rn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_be=rn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var oI={};xe(oI,{base2:()=>Ebe});var Ebe=rn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var sI={};xe(sI,{base256emoji:()=>Tbe});var cq=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),vbe=cq.reduce((r,e,t)=>(r[t]=e,r),[]),xbe=cq.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Sbe(r){return r.reduce((e,t)=>(e+=vbe[t],e),"")}function Abe(r){let e=[];for(let t of r){let n=xbe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var Tbe=b1({prefix:"\u{1F680}",name:"base256emoji",encode:Sbe,decode:Abe});var aI={};xe(aI,{base32:()=>_f,base32hex:()=>Pbe,base32hexpad:()=>Nbe,base32hexpadupper:()=>Dbe,base32hexupper:()=>kbe,base32pad:()=>Rbe,base32padupper:()=>Cbe,base32upper:()=>Ibe,base32z:()=>Obe});var _f=rn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ibe=rn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rbe=rn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Cbe=rn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Pbe=rn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kbe=rn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Nbe=rn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Dbe=rn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Obe=rn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cI={};xe(cI,{base36:()=>Lbe,base36upper:()=>Bbe});var Lbe=bf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bbe=bf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var uI={};xe(uI,{base58btc:()=>Qi,base58flickr:()=>Mbe});var Qi=bf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Mbe=bf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fI={};xe(fI,{base64:()=>lI,base64pad:()=>Ube,base64url:()=>Fbe,base64urlpad:()=>zbe});var lI=rn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ube=rn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Fbe=rn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zbe=rn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var dI={};xe(dI,{base8:()=>Vbe});var Vbe=rn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var hI={};xe(hI,{identity:()=>Kbe});var Kbe=b1({prefix:"\0",name:"identity",encode:r=>oq(r),decode:r=>iq(r)});var LZe=new TextEncoder,BZe=new TextDecoder;var mI={};xe(mI,{identity:()=>A8});var Hbe=fq,uq=128,Gbe=127,jbe=~Gbe,Wbe=Math.pow(2,31);function fq(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Wbe;)e[t++]=r&255|uq,r/=128;for(;r&jbe;)e[t++]=r&255|uq,r>>>=7;return e[t]=r|0,fq.bytes=t-n+1,e}var Ybe=pI,Qbe=128,lq=127;function pI(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw pI.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&lq)<<i:(s&lq)*Math.pow(2,i),i+=7}while(s>=Qbe);return pI.bytes=o-n,t}var Xbe=Math.pow(2,7),Zbe=Math.pow(2,14),Jbe=Math.pow(2,21),e_e=Math.pow(2,28),t_e=Math.pow(2,35),r_e=Math.pow(2,42),n_e=Math.pow(2,49),i_e=Math.pow(2,56),o_e=Math.pow(2,63),s_e=function(r){return r<Xbe?1:r<Zbe?2:r<Jbe?3:r<e_e?4:r<t_e?5:r<r_e?6:r<n_e?7:r<i_e?8:r<o_e?9:10},a_e={encode:Hbe,decode:Ybe,encodingLength:s_e},c_e=a_e,wy=c_e;var by=(r,e=0)=>[wy.decode(r,e),wy.decode.bytes],_1=(r,e,t=0)=>(wy.encode(r,e,t),e),E1=r=>wy.encodingLength(r);var Ef=(r,e)=>{let t=e.byteLength,n=E1(r),i=n+E1(t),o=new Uint8Array(i+t);return _1(r,o,0),_1(t,o,n),o.set(e,i),new v1(r,t,e,o)},_y=r=>{let e=qu(r),[t,n]=by(e),[i,o]=by(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new v1(t,i,s,e)},dq=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&nq(r.bytes,t.bytes)}},v1=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var hq=0,u_e="identity",pq=qu,l_e=r=>Ef(hq,pq(r)),A8={code:hq,name:u_e,encode:pq,digest:l_e};var wI={};xe(wI,{sha256:()=>T8,sha512:()=>f_e});var yI=({name:r,code:e,encode:t})=>new gI(r,e,t),gI=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ef(this.code,t):t.then(n=>Ef(this.code,n))}else throw Error("Unknown type, must be binary type")}};var gq=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),T8=yI({name:"sha2-256",code:18,encode:gq("SHA-256")}),f_e=yI({name:"sha2-512",code:19,encode:gq("SHA-512")});var yq=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return h_e(t,bI(r),e||Qi.encoder);default:return p_e(t,bI(r),e||_f.encoder)}};var wq=new WeakMap,bI=r=>{let e=wq.get(r);if(e==null){let t=new Map;return wq.set(r,t),t}return e},Nr=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Ey)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==m_e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Nr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ef(e,t);return Nr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Nr.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&dq(e.multihash,n.multihash)}toString(e){return yq(this,e)}toJSON(){return{"/":yq(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof Nr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:i,multihash:o,bytes:s}=t;return new Nr(n,i,o,s||bq(n,i,o.bytes))}else if(t[g_e]===!0){let{version:n,multihash:i,code:o}=t,s=_y(i);return Nr.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ey)throw new Error(`Version 0 CID must use dag-pb (code: ${Ey}) block encoding`);return new Nr(e,t,n,n.bytes)}case 1:{let i=bq(e,t,n.bytes);return new Nr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Nr.create(0,Ey,e)}static createV1(e,t){return Nr.create(1,e,t)}static decode(e){let[t,n]=Nr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=Nr.inspectBytes(e),n=t.size-t.multihashSize,i=qu(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=i.subarray(t.multihashSize-t.digestSize),s=new v1(t.multihashCode,t.digestSize,o,i);return[t.version===0?Nr.createV0(s):Nr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=by(e.subarray(t));return t+=h,f},i=n(),o=Ey;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=t,a=n(),c=n(),u=t+c,l=u-s;return{version:i,codec:o,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[n,i]=d_e(e,t),o=Nr.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return bI(o).set(n,e),o}},d_e=(r,e)=>{switch(r[0]){case"Q":{let t=e||Qi;return[Qi.prefix,t.decode(`${Qi.prefix}${r}`)]}case Qi.prefix:{let t=e||Qi;return[Qi.prefix,t.decode(r)]}case _f.prefix:{let t=e||_f;return[_f.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},h_e=(r,e,t)=>{let{prefix:n}=t;if(n!==Qi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return i},p_e=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let o=t.encode(r);return e.set(n,o),o}else return i},Ey=112,m_e=18,bq=(r,e,t)=>{let n=E1(r),i=n+E1(e),o=new Uint8Array(i+t.byteLength);return _1(r,o,0),_1(e,o,n),o.set(t,i),o},g_e=Symbol.for("@ipld/js-cid/CID");var S1={...hI,...oI,...dI,...nI,...iI,...aI,...cI,...uI,...fI,...sI},ZZe={...wI,...mI};function vf(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?wf(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Eq(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var _q=Eq("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),_I=Eq("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=vf(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),y_e={utf8:_q,"utf-8":_q,hex:S1.base16,latin1:_I,ascii:_I,binary:_I,...S1},I8=y_e;function Ie(r,e="utf8"){let t=I8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wf(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var kye=C(Kn(),1);function C8(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var xI={};xe(xI,{base10:()=>__e});var __e=cf({prefix:"9",name:"base10",alphabet:"0123456789"});var SI={};xe(SI,{base16:()=>E_e,base16upper:()=>v_e});var E_e=Jr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),v_e=Jr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var AI={};xe(AI,{base2:()=>x_e});var x_e=Jr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var TI={};xe(TI,{base256emoji:()=>R_e});var Iq=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),S_e=Iq.reduce((r,e,t)=>(r[t]=e,r),[]),A_e=Iq.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function T_e(r){return r.reduce((e,t)=>(e+=S_e[t],e),"")}function I_e(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let i=A_e[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}var R_e=j0({prefix:"\u{1F680}",name:"base256emoji",encode:T_e,decode:I_e});var II={};xe(II,{base8:()=>C_e});var C_e=Jr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var RI={};xe(RI,{identity:()=>P_e});var P_e=j0({prefix:"\0",name:"identity",encode:r=>VA(r),decode:r=>zA(r)});var bJe=new TextEncoder,_Je=new TextDecoder;var CI={};xe(CI,{identity:()=>L_e});var Rq=0,D_e="identity",Cq=yc;function O_e(r){return ph(Rq,Cq(r))}var L_e={code:Rq,name:D_e,encode:Cq,digest:O_e};var PI={};xe(PI,{sha256:()=>B_e,sha512:()=>M_e});function Pq(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}var B_e=gh({name:"sha2-256",code:18,encode:Pq("SHA-256")}),M_e=gh({name:"sha2-512",code:19,encode:Pq("SHA-512")});var xy={...RI,...AI,...II,...xI,...SI,...GA,...jA,...WA,...yT,...TI},AJe={...PI,...CI};function Hu(r=0){return new Uint8Array(r)}function Ri(r=0){return new Uint8Array(r)}function Nq(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var kq=Nq("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),kI=Nq("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Ri(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),U_e={utf8:kq,"utf-8":kq,hex:xy.base16,latin1:kI,ascii:kI,binary:kI,...xy},P8=U_e;function $n(r,e="utf8"){let t=P8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var F_e=Math.pow(2,7),z_e=Math.pow(2,14),V_e=Math.pow(2,21),NI=Math.pow(2,28),DI=Math.pow(2,35),OI=Math.pow(2,42),LI=Math.pow(2,49),ar=128,Ci=127;function ti(r){if(r<F_e)return 1;if(r<z_e)return 2;if(r<V_e)return 3;if(r<NI)return 4;if(r<DI)return 5;if(r<OI)return 6;if(r<LI)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function BI(r,e,t=0){switch(ti(r)){case 8:e[t++]=r&255|ar,r/=128;case 7:e[t++]=r&255|ar,r/=128;case 6:e[t++]=r&255|ar,r/=128;case 5:e[t++]=r&255|ar,r/=128;case 4:e[t++]=r&255|ar,r>>>=7;case 3:e[t++]=r&255|ar,r>>>=7;case 2:e[t++]=r&255|ar,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function K_e(r,e,t=0){switch(ti(r)){case 8:e.set(t++,r&255|ar),r/=128;case 7:e.set(t++,r&255|ar),r/=128;case 6:e.set(t++,r&255|ar),r/=128;case 5:e.set(t++,r&255|ar),r/=128;case 4:e.set(t++,r&255|ar),r>>>=7;case 3:e.set(t++,r&255|ar),r>>>=7;case 2:e.set(t++,r&255|ar),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function MI(r,e){let t=r[e],n=0;if(n+=t&Ci,t<ar||(t=r[e+1],n+=(t&Ci)<<7,t<ar)||(t=r[e+2],n+=(t&Ci)<<14,t<ar)||(t=r[e+3],n+=(t&Ci)<<21,t<ar)||(t=r[e+4],n+=(t&Ci)*NI,t<ar)||(t=r[e+5],n+=(t&Ci)*DI,t<ar)||(t=r[e+6],n+=(t&Ci)*OI,t<ar)||(t=r[e+7],n+=(t&Ci)*LI,t<ar))return n;throw new RangeError("Could not decode varint")}function $_e(r,e){let t=r.get(e),n=0;if(n+=t&Ci,t<ar||(t=r.get(e+1),n+=(t&Ci)<<7,t<ar)||(t=r.get(e+2),n+=(t&Ci)<<14,t<ar)||(t=r.get(e+3),n+=(t&Ci)<<21,t<ar)||(t=r.get(e+4),n+=(t&Ci)*NI,t<ar)||(t=r.get(e+5),n+=(t&Ci)*DI,t<ar)||(t=r.get(e+6),n+=(t&Ci)*OI,t<ar)||(t=r.get(e+7),n+=(t&Ci)*LI,t<ar))return n;throw new RangeError("Could not decode varint")}function xf(r,e,t=0){return e==null&&(e=Ri(ti(r))),e instanceof Uint8Array?BI(r,e,t):K_e(r,e,t)}function Gu(r,e=0){return r instanceof Uint8Array?MI(r,e):$_e(r,e)}function yi(r,e){e==null&&(e=r.reduce((i,o)=>i+o.length,0));let t=Ri(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}var N8=class{constructor(){B(this,"index",0);B(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let o=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*i)-1;for(;;){let l=this.readAtomically(()=>{let f=this.readChar();if(f===void 0)return;let h=Number.parseInt(f,e);if(!Number.isNaN(h))return h});if(l===void 0)break;if(o*=e,o+=l,o>u||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:o})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let i=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],[i+4,!0]}let o=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(o===void 0)return[i,!1];t[i]=o>>8,t[i+1]=o&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let o=new Uint8Array(14),s=16-(n+2),[a]=e(o.subarray(0,s));return t.set(o.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Dq=45,q_e=15,A1=new N8;function UI(r){if(!(r.length>q_e))return A1.new(r).parseWith(()=>A1.readIPv4Addr())}function FI(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Dq))return A1.new(r).parseWith(()=>A1.readIPv6Addr())}function D8(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Dq))return A1.new(r).parseWith(()=>A1.readIPAddr())}var YJe=parseInt("0xFFFF",16),QJe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function cr(r,e="utf8"){let t=P8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function O8(r){return!!UI(r)}function L8(r){return!!FI(r)}function xc(r){return!!D8(r)}var Bq=O8,Y_e=L8,zI=function(r){let e=0;if(r=r.toString().trim(),Bq(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Y_e(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let o=Bq(t[n]),s;o&&(s=zI(t[n]),t[n]=$n(s.slice(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,$n(s.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let o=[n,1];for(n=9-t.length;n>0;n--)o.push("0");t.splice.apply(t,o)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let o=parseInt(t[n],16);i[e++]=o>>8&255,i[e++]=o&255}return i}throw new Error("invalid ip address")},Mq=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let o=0;o<t;o++)i.push(r[e+o]);return i.join(".")}if(t===16){let i=[];for(let o=0;o<t;o+=2)i.push(n.getUint16(e+o).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var T1={},VI={},X_e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]];X_e.forEach(r=>{let e=Z_e(...r);VI[e.code]=e,T1[e.name]=e});function Z_e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function Lt(r){if(typeof r=="number"){if(VI[r]!=null)return VI[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(T1[r]!=null)return T1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Met=Lt("ip4"),Uet=Lt("ip6"),Fet=Lt("ipcidr");function Sy(r,e){switch(Lt(r).code){case 4:case 41:return eEe(e);case 42:return qI(e);case 6:case 273:case 33:case 132:return zq(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return qI(e);case 421:return iEe(e);case 444:return Fq(e);case 445:return Fq(e);case 466:return nEe(e);case 481:return globalThis.encodeURIComponent(qI(e));default:return $n(e,"base16")}}function HI(r,e){switch(Lt(r).code){case 4:return Uq(e);case 41:return Uq(e);case 42:return $I(e);case 6:case 273:case 33:case 132:return GI(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return $I(e);case 421:return tEe(e);case 444:return oEe(e);case 445:return sEe(e);case 466:return rEe(e);case 481:return $I(globalThis.decodeURIComponent(e));default:return cr(e,"base16")}}var KI=Object.values(xy).map(r=>r.decoder),J_e=function(){let r=KI[0].or(KI[1]);return KI.slice(2).forEach(e=>r=r.or(e)),r}();function Uq(r){if(!xc(r))throw new Error("invalid ip address");return zI(r)}function eEe(r){let e=Mq(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!xc(e))throw new Error("invalid ip address");return e}function GI(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function zq(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function $I(r){let e=cr(r),t=Uint8Array.from(xf(e.length));return yi([t,e],t.length+e.length)}function qI(r){let e=Gu(r);if(r=r.slice(ti(e)),r.length!==e)throw new Error("inconsistent lengths");return $n(r)}function tEe(r){let e;r[0]==="Q"||r[0]==="1"?e=uf(Yi.decode(`z${r}`)).bytes:e=Xe.parse(r).multihash.bytes;let t=Uint8Array.from(xf(e.length));return yi([t,e],t.length+e.length)}function rEe(r){let e=J_e.decode(r),t=Uint8Array.from(xf(e.length));return yi([t,e],t.length+e.length)}function nEe(r){let e=Gu(r),t=r.slice(ti(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+$n(t,"base64url")}function iEe(r){let e=Gu(r),t=r.slice(ti(e));if(t.length!==e)throw new Error("inconsistent lengths");return $n(t,"base58btc")}function oEe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=wc.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=GI(n);return yi([t,i],t.length+i.length)}function sEe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=wc.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=GI(n);return yi([t,i],t.length+i.length)}function Fq(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=$n(e,"base32"),i=zq(t);return`${n}:${i}`}function Vq(r){r=jI(r);let e=[],t=[],n=null,i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let o=0;o<i.length;o++){let s=i[o],a=Lt(s);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(o++,o>=i.length)throw $q("invalid address: "+r);if(a.path===!0){n=jI(i.slice(o).join("/")),e.push([a.code,HI(a.code,n)]),t.push([a.code,n]);break}let c=HI(a.code,i[o]);e.push([a.code,c]),t.push([a.code,Sy(a.code,c)])}return{string:Kq(t),bytes:YI(e),tuples:e,stringTuples:t,path:n}}function WI(r){let e=[],t=[],n=null,i=0;for(;i<r.length;){let o=Gu(r,i),s=ti(o),a=Lt(o),c=aEe(a,r.slice(i+s));if(c===0){e.push([o]),t.push([o]),i+=s;continue}let u=r.slice(i+s,i+s+c);if(i+=c+s,i>r.length)throw $q("Invalid address Uint8Array: "+$n(r,"base16"));e.push([o,u]);let l=Sy(o,u);if(t.push([o,l]),a.path===!0){n=l;break}}return{bytes:Uint8Array.from(r),string:Kq(t),tuples:e,stringTuples:t,path:n}}function Kq(r){let e=[];return r.map(t=>{let n=Lt(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),jI(e.join("/"))}function YI(r){return yi(r.map(e=>{let t=Lt(e[0]),n=Uint8Array.from(xf(t.code));return e.length>1&&e[1]!=null&&(n=yi([n,e[1]])),n}))}function aEe(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let t=Gu(e instanceof Uint8Array?e:Uint8Array.from(e));return t+ti(t)}}function jI(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function $q(r){return new Error("Error parsing address: "+r)}var cEe=Symbol.for("nodejs.util.inspect.custom"),XI=Symbol.for("@multiformats/js-multiaddr/multiaddr"),uEe=[Lt("dns").code,Lt("dns4").code,Lt("dns6").code,Lt("dnsaddr").code],QI=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}},R1,Sf,Ay,Ty,lEe,I1=class{constructor(e){B(this,"bytes");bt(this,R1,void 0);bt(this,Sf,void 0);bt(this,Ay,void 0);bt(this,Ty,void 0);B(this,lEe,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=WI(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=Vq(e)}else if(Hq(e))t=WI(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,Dt(this,R1,t.string),Dt(this,Sf,t.tuples),Dt(this,Ay,t.stringTuples),Dt(this,Ty,t.path)}toString(){return ge(this,R1)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,o="",s=Lt("tcp"),a=Lt("udp"),c=Lt("ip4"),u=Lt("ip6"),l=Lt("dns6"),f=Lt("ip6zone");for(let[d,p]of this.stringTuples())d===f.code&&(o=`%${p??""}`),uEe.includes(d)&&(t=s.name,i=443,n=`${p??""}${o}`,e=d===l.code?6:4),(d===s.code||d===a.code)&&(t=Lt(d).name,i=parseInt(p??"")),(d===c.code||d===u.code)&&(t=Lt(d).name,n=`${p??""}${o}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return ge(this,Sf).map(([e])=>Object.assign({},Lt(e)))}protoCodes(){return ge(this,Sf).map(([e])=>e)}protoNames(){return ge(this,Sf).map(([e])=>Lt(e).name)}tuples(){return ge(this,Sf)}stringTuples(){return ge(this,Ay)}encapsulate(e){return e=new I1(e),new I1(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new I1(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new I1(YI(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===T1.p2p.code&&e.push([n,i]),n===T1["p2p-circuit"].code&&(e=[])});let t=e.pop();if((t==null?void 0:t[1])!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?$n(Yi.decode(`z${n}`),"base58btc"):$n(Xe.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ge(this,Ty)}equals(e){return C8(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(o=>o.resolvable);if(t==null)return[this];let n=qq.get(t.name);if(n==null)throw new QI(`no available resolver for ${t.name}`);return(await n(this,e)).map(o=>Xi(o))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(lEe=XI,cEe)](){return`Multiaddr(${ge(this,R1)})`}},B8=I1;R1=new WeakMap,Sf=new WeakMap,Ay=new WeakMap,Ty=new WeakMap;var qq=new Map;function Hq(r){return!!(r!=null&&r[XI])}function Xi(r){return new B8(r)}var fEe=_e("dns4"),dEe=_e("dns6"),hEe=_e("dnsaddr"),Tf=mn(_e("dns"),hEe,fEe,dEe),M8=mn(_e("ip4"),_e("ip6")),C1=mn(qe(M8,_e("tcp")),qe(Tf,_e("tcp"))),U8=qe(M8,_e("udp")),pEe=qe(U8,_e("utp")),mEe=qe(U8,_e("quic")),gEe=qe(U8,_e("quic-v1")),ZI=mn(qe(C1,_e("ws")),qe(Tf,_e("ws"))),P1=mn(qe(ZI,_e("p2p")),ZI),JI=mn(qe(C1,_e("wss")),qe(Tf,_e("wss")),qe(C1,_e("tls"),_e("ws")),qe(Tf,_e("tls"),_e("ws"))),xh=mn(qe(JI,_e("p2p")),JI),eR=mn(qe(C1,_e("http")),qe(M8,_e("http")),qe(Tf,_e("http"))),tR=mn(qe(C1,_e("https")),qe(M8,_e("https")),qe(Tf,_e("https"))),Gq=qe(U8,_e("webrtc-direct"),_e("certhash")),Yq=mn(qe(Gq,_e("p2p")),Gq),jq=qe(gEe,_e("webtransport"),_e("certhash"),_e("certhash")),Qq=mn(qe(jq,_e("p2p")),jq),Xq=mn(qe(P1,_e("p2p-webrtc-star"),_e("p2p")),qe(xh,_e("p2p-webrtc-star"),_e("p2p")),qe(P1,_e("p2p-webrtc-star")),qe(xh,_e("p2p-webrtc-star"))),dtt=mn(qe(P1,_e("p2p-websocket-star"),_e("p2p")),qe(xh,_e("p2p-websocket-star"),_e("p2p")),qe(P1,_e("p2p-websocket-star")),qe(xh,_e("p2p-websocket-star"))),Zq=mn(qe(eR,_e("p2p-webrtc-direct"),_e("p2p")),qe(tR,_e("p2p-webrtc-direct"),_e("p2p")),qe(eR,_e("p2p-webrtc-direct")),qe(tR,_e("p2p-webrtc-direct"))),Sh=mn(ZI,JI,eR,tR,Xq,Zq,C1,pEe,mEe,Tf,Yq,Qq),htt=mn(qe(Sh,_e("p2p-stardust"),_e("p2p")),qe(Sh,_e("p2p-stardust"))),Af=mn(qe(Sh,_e("p2p")),Xq,Zq,Yq,Qq,_e("p2p")),Wq=mn(qe(Af,_e("p2p-circuit"),Af),qe(Af,_e("p2p-circuit")),qe(_e("p2p-circuit"),Af),qe(Sh,_e("p2p-circuit")),qe(_e("p2p-circuit"),Sh),_e("p2p-circuit")),Jq=()=>mn(qe(Wq,Jq),Wq),vh=Jq(),rR=mn(qe(vh,Af,vh),qe(Af,vh),qe(vh,Af),vh,Af);var ptt=mn(qe(vh,_e("webrtc"),_e("p2p")),qe(vh,_e("webrtc")),qe(Sh,_e("webrtc"),_e("p2p")),qe(Sh,_e("webrtc")),_e("webrtc"));function eH(r){function e(t){let n;try{n=Xi(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function qe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:eH(e),partialMatch:e}}function mn(...r){function e(n){let i=null;return r.some(o=>{let s=typeof o=="function"?o().partialMatch(n):o.partialMatch(n);return s!=null?(i=s,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:eH(e),partialMatch:e}}function _e(r){let e=r;function t(i){let o;try{o=Xi(i)}catch{return!1}let s=o.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var cH=C(F8(),1);var z8=/^\/(ip[fn]s)\/([^/?#]+)/,uH=1,lH=2,fH=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/;var TEe=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function V8(r){try{return pH(r)?!!Xe.parse(r):r instanceof Uint8Array?!!Xe.decode(r):!!Xe.asCID(r)}catch{return!1}}function dH(r,e,t=uH,n=lH){let i=mH(r);if(i===!1)return!1;let o=i.match(e);if(o==null||o[t]!=="ipfs")return!1;let s=o[n];return s!=null&&e===fH&&(s=s.toLowerCase()),V8(s)}function hH(r,e,t=uH,n=lH){let i=mH(r);if(i===!1)return!1;let o=i.match(e);if(o==null||o[t]!=="ipns")return!1;let s=o[n];if(s!=null&&e===fH){if(s=s.toLowerCase(),V8(s))return!0;try{!s.includes(".")&&s.includes("-")&&(s=s.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));let{hostname:a}=new cH.URL(`http://${s}`);return TEe.test(a)}catch{return!1}}return!0}function pH(r){return typeof r=="string"}function mH(r){return r instanceof Uint8Array?$n(r,"base58btc"):pH(r)?r:!1}var K8=r=>dH(r,z8)||hH(r,z8);var gH=r=>dH(r,z8),$8=r=>hH(r,z8);var k1=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");var oR={};xe(oR,{identity:()=>IEe});var IEe=c1({prefix:"\0",name:"identity",encode:r=>xT(r),decode:r=>vT(r)});var sR={};xe(sR,{base2:()=>REe});var REe=tn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var aR={};xe(aR,{base8:()=>CEe});var CEe=tn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var cR={};xe(cR,{base10:()=>PEe});var PEe=hf({prefix:"9",name:"base10",alphabet:"0123456789"});var uR={};xe(uR,{base16:()=>kEe,base16upper:()=>NEe});var kEe=tn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),NEe=tn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var lR={};xe(lR,{base36:()=>DEe,base36upper:()=>OEe});var DEe=hf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),OEe=hf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fR={};xe(fR,{base256emoji:()=>FEe});var yH=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),LEe=yH.reduce((r,e,t)=>(r[t]=e,r),[]),BEe=yH.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function MEe(r){return r.reduce((e,t)=>(e+=LEe[t],e),"")}function UEe(r){let e=[];for(let t of r){let n=BEe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var FEe=c1({prefix:"\u{1F680}",name:"base256emoji",encode:MEe,decode:UEe});var hR={};xe(hR,{sha256:()=>mr,sha512:()=>zEe});var Ah=({name:r,code:e,encode:t})=>new dR(r,e,t),dR=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ec(this.code,t):t.then(n=>Ec(this.code,n))}else throw Error("Unknown type, must be binary type")}};var bH=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),mr=Ah({name:"sha2-256",code:18,encode:bH("SHA-256")}),zEe=Ah({name:"sha2-512",code:19,encode:bH("SHA-512")});var pR={};xe(pR,{identity:()=>Ns});var _H=0,VEe="identity",EH=_c,KEe=r=>Ec(_H,EH(r)),Ns={code:_H,name:VEe,encode:EH,digest:KEe};var Sc=85;var Ltt=new TextEncoder,Btt=new TextDecoder;var If={...oR,...sR,...aR,...cR,...uR,...NT,...lR,...PT,...RT,...fR},Vtt={...hR,...pR};function Rf(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function ju(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.alloc)!=null?Rf(globalThis.Buffer.alloc(r)):new Uint8Array(r)}function Ac(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?Rf(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function xH(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var vH=xH("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),mR=xH("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Ac(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),qEe={utf8:vH,"utf-8":vH,hex:If.base16,latin1:mR,ascii:mR,binary:mR,...If},H8=qEe;function Ee(r,e="utf8"){let t=H8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function fe(r,e="utf8"){let t=H8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Rf(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var Wu="/",SH=new TextEncoder().encode(Wu),G8=SH[0],pe=class{constructor(e,t){if(typeof e=="string")this._buf=fe(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==G8)throw new Error("Invalid key")}toString(e="utf8"){return Ee(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new pe(e.join(Wu))}static random(){return new pe(k1().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new pe(e):typeof e.uint8Array=="function"?new pe(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=SH),this._buf[0]!==G8){let e=new Uint8Array(this._buf.byteLength+1);e.fill(G8,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===G8;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;let o=t[i],s=n[i];if(o<s)return!0;if(o>s)return!1}return t.length<n.length}reverse(){return pe.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Wu).slice(1)}type(){return HEe(this.baseNamespace())}name(){return GEe(this.baseNamespace())}instance(e){return new pe(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Wu)||(e+=Wu),e+=this.type(),new pe(e)}parent(){let e=this.list();return e.length===1?new pe(Wu):new pe(e.slice(0,-1).join(Wu))}child(e){return this.toString()===Wu?e:e.toString()===Wu?this:new pe(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return pe.withNamespaces([...this.namespaces(),...jEe(e.map(t=>t.namespaces()))])}};function HEe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function GEe(r){let e=r.split(":");return e[e.length-1]}function jEe(r){return[].concat(...r)}var j8=C(ee(),1);var IH=C(Kn(),1),RH=C(Da(),1);var WEe=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;Et.nanosecond=Et.ns=1/1e6;Et.\u00B5s=Et.\u03BCs=Et.us=Et.microsecond=1/1e3;Et.millisecond=Et.ms=Et[""]=1;Et.second=Et.sec=Et.s=Et.ms*1e3;Et.minute=Et.min=Et.m=Et.s*60;Et.hour=Et.hr=Et.h=Et.m*60;Et.day=Et.d=Et.h*24;Et.week=Et.wk=Et.w=Et.d*7;Et.month=Et.b=Et.d*(365.25/12);Et.year=Et.yr=Et.y=Et.d*365.25;function Et(r="",e="ms"){var t=null;r=(r+"").replace(/(\d)[,_](\d)/g,"$1$2");var n=r[0]==="-";return r.replace(WEe,function(i,o,s){s=TH(s),s&&(t=(t||0)+Math.abs(parseFloat(o,10))*s)}),t&&t/(TH(e)||1)*(n?-1:1)}function TH(r){return Et[r]||Et[r.toLowerCase().replace(/s$/,"")]}var Cf=Et;var Yu=class extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=Yu.code}};Yu.code="ERR_TIMEOUT";function $(r,e){return(...t)=>{let n=t[e??t.length-1];if(!n||!n.timeout)return r(...t);let i=typeof n.timeout=="string"?Cf(n.timeout):n.timeout,o=new IH.TimeoutController(i);n.signal=(0,RH.anySignal)([n.signal,o.signal]);let s=r(...t),a=new Promise((l,f)=>{o.signal.addEventListener("abort",()=>{f(new Yu)})}),c=Date.now(),u=()=>{if(o.signal.aborted)throw new Yu;if(Date.now()-c>i)throw o.abort(),new Yu};return s[Symbol.asyncIterator]?async function*(){let l=s[Symbol.asyncIterator]();try{for(;;){let{value:f,done:h}=await Promise.race([l.next(),a]);if(h)break;u(),yield f}}catch(f){throw u(),f}finally{o.clear(),l.return&&l.return()}}():(async()=>{try{let l=await Promise.race([s,a]);return u(),l}catch(l){throw u(),l}finally{o.clear()}})()}}var yR=C(ee(),1),CH="/ipfs/";function Qu(r){if(r instanceof Uint8Array)try{r=z.decode(r)}catch(i){throw(0,yR.default)(i,"ERR_INVALID_CID")}let e=z.asCID(r);if(e)return{cid:e,path:void 0};r=r.toString(),r.startsWith(CH)&&(r=r.substring(CH.length));let t=r.split("/"),n;try{e=z.parse(t.shift()||"")}catch(i){throw(0,yR.default)(i,"ERR_INVALID_CID")}return t.length&&(n=`/${t.join("/")}`),{cid:e,path:n}}var YEe="ERR_BAD_PATH",W8="This command must be run in online mode. Try running 'ipfs daemon' first.",Ry=new pe("/local/filesroot"),PH=262144;var kH=r=>{if(z.asCID(r))return`/ipfs/${r}`;let t=r.toString();try{return`/ipfs/${z.parse(t)}`}catch{}if(K8(t))return t;throw(0,j8.default)(new Error(`invalid path: ${r}`),YEe)},N1=r=>r instanceof Uint8Array?z.decode(r).toString():(r=r.toString(),r.indexOf("/ipfs/")===0&&(r=r.substring(6)),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1)),r),Pf=async function(r,e,t,n={}){let{cid:i,path:o}=Qu(t);o&&(n.path=o);let s=i,a=n.path||"";if(a.startsWith("/")&&(a=a.substring(1)),n.path)try{for await(let{value:c,remainderPath:u}of kf(i,n.path,e,r,{signal:n.signal})){if(!z.asCID(c))break;a=u,s=c}}catch(c){throw c.message.startsWith("Object has no property")&&(c.message=`no link named "${a.split("/")[0]}" under ${s}`,c.code="ERR_NO_LINK"),c}return{cid:s,remainderPath:a||""}},wR=r=>{if(r.type!=="file"&&r.type!=="directory"&&r.type!=="raw")throw new Error(`Unknown node type '${r.type}'`);let e={cid:r.cid,path:r.path,name:r.name,size:r.size,type:"file"};return r.type==="directory"&&(e.type="dir"),r.type==="file"&&(e.size=r.unixfs.fileSize()),(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,r.unixfs.mtime!==void 0&&(e.mtime=r.unixfs.mtime)),e},NH=$(async(r,e)=>await r),kf=async function*(r,e,t,n,i){let o=async u=>{let l=await t.getCodec(u.code),f=await n.blocks.get(u,i);return l.decode(f)},s=e.split("/").filter(Boolean),a=await o(r),c=r;for(;s.length;){let u=s.shift();if(!u)throw(0,j8.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(r.code===kr&&Array.isArray(a.Links)){let l=a.Links.find(f=>f.Name===u);if(l){yield{value:l.Hash,remainderPath:s.join("/")},a=await o(l.Hash),c=l.Hash;continue}}if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:s.join("/")};else throw(0,j8.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");z.asCID(a)&&(c=a,a=await o(a))}yield{value:a,remainderPath:""}};var Pi=class{static create({start:e,stop:t}){return new Pi(e,t)}static async start(e,t){let{state:n,activate:i}=e;switch(n.status){case"stopped":try{let o=i(t);e.state={status:"starting",ready:o};let s=await o;return e.state={status:"started",value:s},s}catch(o){throw e.state={status:"stopped"},o}case"starting":throw new _h;case"started":throw new Eh;case"stopping":return await n.ready,await Pi.start(e,t);default:return Pi.panic(e)}}static async stop(e){let{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":{try{await t.ready}catch{}return await Pi.stop(e)}case"stopping":return await t.ready;case"started":{n&&await n(t.value),e.state={status:"stopped"};break}default:Pi.panic(t)}}static try({state:e}){switch(e.status){case"started":return e.value;default:return null}}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await NH(e.ready,t);default:throw new $u}}static panic({state:e}){let t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await Pi.use(this,e)}try(){return Pi.try(this)}};function DH({network:r,preload:e,peerId:t,keychain:n,repo:i,ipns:o,mfsPreload:s,print:a,hashers:c,options:u}){return async()=>{let{libp2p:f}=await Pi.start(r,{peerId:t,repo:i,print:a,hashers:c,options:u});await Promise.all([o.startOnline({keychain:n,libp2p:f,peerId:t,repo:i}),e.start(),s.start()])}}function OH({network:r,preload:e,ipns:t,repo:n,mfsPreload:i}){return async()=>{await Promise.all([e.stop(),t.stop(),i.stop()]),await Pi.stop(r),await n.close()}}var BH=C(Cy(),1),Y8=class{constructor(e){this.lru=(0,BH.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var ky=C(UH(),1);var Nf=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},_R=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},FH=r=>globalThis.DOMException===void 0?new _R(r):new DOMException(r),zH=r=>{let e=r.reason===void 0?FH("This operation was aborted."):r.reason;return e instanceof Error?e:FH(e)};function Ih(r,e,t,n){let i,o=new Promise((s,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){s(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(zH(c)),c.addEventListener("abort",()=>{a(zH(c))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{s(t())}catch(l){a(l)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,u=t instanceof Error?t:new Nf(c);typeof r.cancel=="function"&&r.cancel(),a(u)},e),(async()=>{try{s(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return o.clear=()=>{clearTimeout(i),i=void 0},o}function ER(r,e,t){let n=0,i=r.length;for(;i>0;){let o=Math.trunc(i/2),s=n+o;t(r[s],e)<=0?(n=++s,i-=o+1):i=o}return n}var Rh=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Xu,vR=class{constructor(){Xu.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&Rh(this,Xu,"f")[this.size-1].priority>=t.priority){Rh(this,Xu,"f").push(n);return}let i=ER(Rh(this,Xu,"f"),n,(o,s)=>s.priority-o.priority);Rh(this,Xu,"f").splice(i,0,n)}dequeue(){let e=Rh(this,Xu,"f").shift();return e==null?void 0:e.run}filter(e){return Rh(this,Xu,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return Rh(this,Xu,"f").length}};Xu=new WeakMap;var VH=vR;var Wr=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},ke=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},gn,Dy,Oy,Of,rb,Ly,X8,Oa,Ny,Fo,Z8,zo,By,Df,J8,KH,$H,GH,qH,HH,eb,xR,SR,nb,jH,tb,ib=class extends Error{},AR=class extends ky.default{constructor(e){var t,n,i,o;if(super(),gn.add(this),Dy.set(this,void 0),Oy.set(this,void 0),Of.set(this,0),rb.set(this,void 0),Ly.set(this,void 0),X8.set(this,0),Oa.set(this,void 0),Ny.set(this,void 0),Fo.set(this,void 0),Z8.set(this,void 0),zo.set(this,0),By.set(this,void 0),Df.set(this,void 0),J8.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:VH,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(o=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""}\` (${typeof e.interval})`);Wr(this,Dy,e.carryoverConcurrencyCount,"f"),Wr(this,Oy,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),Wr(this,rb,e.intervalCap,"f"),Wr(this,Ly,e.interval,"f"),Wr(this,Fo,new e.queueClass,"f"),Wr(this,Z8,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Wr(this,J8,e.throwOnTimeout===!0,"f"),Wr(this,Df,e.autoStart===!1,"f")}get concurrency(){return ke(this,By,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Wr(this,By,e,"f"),ke(this,gn,"m",nb).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:ke(this,J8,"f"),...t},new Promise((n,i)=>{ke(this,Fo,"f").enqueue(async()=>{var o,s,a;Wr(this,zo,(s=ke(this,zo,"f"),s++,s),"f"),Wr(this,Of,(a=ke(this,Of,"f"),a++,a),"f");try{if(!((o=t.signal)===null||o===void 0)&&o.aborted)throw new ib("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=Ih(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,ke(this,gn,"m",jH).call(this,t.signal)]));let u=await c;n(u),this.emit("completed",u)}catch(c){if(c instanceof Nf&&!t.throwOnTimeout){n();return}i(c),this.emit("error",c)}finally{ke(this,gn,"m",GH).call(this)}},t),this.emit("add"),ke(this,gn,"m",eb).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return ke(this,Df,"f")?(Wr(this,Df,!1,"f"),ke(this,gn,"m",nb).call(this),this):this}pause(){Wr(this,Df,!0,"f")}clear(){Wr(this,Fo,new(ke(this,Z8,"f")),"f")}async onEmpty(){ke(this,Fo,"f").size!==0&&await ke(this,gn,"m",tb).call(this,"empty")}async onSizeLessThan(e){ke(this,Fo,"f").size<e||await ke(this,gn,"m",tb).call(this,"next",()=>ke(this,Fo,"f").size<e)}async onIdle(){ke(this,zo,"f")===0&&ke(this,Fo,"f").size===0||await ke(this,gn,"m",tb).call(this,"idle")}get size(){return ke(this,Fo,"f").size}sizeBy(e){return ke(this,Fo,"f").filter(e).length}get pending(){return ke(this,zo,"f")}get isPaused(){return ke(this,Df,"f")}};Dy=new WeakMap,Oy=new WeakMap,Of=new WeakMap,rb=new WeakMap,Ly=new WeakMap,X8=new WeakMap,Oa=new WeakMap,Ny=new WeakMap,Fo=new WeakMap,Z8=new WeakMap,zo=new WeakMap,By=new WeakMap,Df=new WeakMap,J8=new WeakMap,gn=new WeakSet,KH=function(){return ke(this,Oy,"f")||ke(this,Of,"f")<ke(this,rb,"f")},$H=function(){return ke(this,zo,"f")<ke(this,By,"f")},GH=function(){var e;Wr(this,zo,(e=ke(this,zo,"f"),e--,e),"f"),ke(this,gn,"m",eb).call(this),this.emit("next")},qH=function(){ke(this,gn,"m",SR).call(this),ke(this,gn,"m",xR).call(this),Wr(this,Ny,void 0,"f")},HH=function(){let e=Date.now();if(ke(this,Oa,"f")===void 0){let t=ke(this,X8,"f")-e;if(t<0)Wr(this,Of,ke(this,Dy,"f")?ke(this,zo,"f"):0,"f");else return ke(this,Ny,"f")===void 0&&Wr(this,Ny,setTimeout(()=>{ke(this,gn,"m",qH).call(this)},t),"f"),!0}return!1},eb=function(){if(ke(this,Fo,"f").size===0)return ke(this,Oa,"f")&&clearInterval(ke(this,Oa,"f")),Wr(this,Oa,void 0,"f"),this.emit("empty"),ke(this,zo,"f")===0&&this.emit("idle"),!1;if(!ke(this,Df,"f")){let e=!ke(this,gn,"a",HH);if(ke(this,gn,"a",KH)&&ke(this,gn,"a",$H)){let t=ke(this,Fo,"f").dequeue();return t?(this.emit("active"),t(),e&&ke(this,gn,"m",xR).call(this),!0):!1}}return!1},xR=function(){ke(this,Oy,"f")||ke(this,Oa,"f")!==void 0||(Wr(this,Oa,setInterval(()=>{ke(this,gn,"m",SR).call(this)},ke(this,Ly,"f")),"f"),Wr(this,X8,Date.now()+ke(this,Ly,"f"),"f"))},SR=function(){ke(this,Of,"f")===0&&ke(this,zo,"f")===0&&ke(this,Oa,"f")&&(clearInterval(ke(this,Oa,"f")),Wr(this,Oa,void 0,"f")),Wr(this,Of,ke(this,Dy,"f")?ke(this,zo,"f"):0,"f"),ke(this,gn,"m",nb).call(this)},nb=function(){for(;ke(this,gn,"m",eb).call(this););},jH=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new ib("The task was aborted."))},{once:!0})})},tb=async function(e,t){return new Promise(n=>{let i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};var qn=AR;var dG=C(O1(),1),OR=new Y8(1e3),x7e=60*1e3,S7e=qn.default?qn.default:qn,A7e=new S7e({concurrency:4}),fG=r=>{if(r.Path)return r.Path;throw new Error(r.Message)};async function hG(r,e){return(async(n,i={})=>{let o=new URLSearchParams(i);o.set("arg",n);let s=o.toString();if(!i.nocache&&OR.has(s)){let c=OR.get(s);return fG(c)}let a=await A7e.add(async()=>{let c=await dG.default.get("https://ipfs.io/api/v0/dns",{searchParams:o}),u=new URL(c.url).search.slice(1),l=await c.json();return OR.set(u,l,x7e),l});return fG(a)})(r,e)}function T7e(r){return r.endsWith(".eth")&&(r=r.replace(/.eth$/,".eth.link")),r}function pG(){return $(async(e,t={recursive:!0})=>{if(typeof e!="string")throw new Error("Invalid arguments, domain must be a string");return e=T7e(e),hG(e,t)})}function mG({network:r}){return()=>{let e=r.try();return e!=null&&!!e.libp2p.isStarted()}}var LR=Symbol.for("@libp2p/peer-id");function Lf(r){return r!=null&&!!r[LR]}var sb=class extends Error{constructor(t="The operation was aborted"){super(t);B(this,"code");B(this,"type");this.code=sb.code,this.type=sb.type}},Ph=sb;B(Ph,"code","ABORT_ERR"),B(Ph,"type","aborted");var J=class extends Error{constructor(t,n,i){super(t);B(this,"code");B(this,"props");this.code=n,this.name=(i==null?void 0:i.name)??"CodeError",this.props=i??{}}};function mt(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var I7e=Symbol.for("nodejs.util.inspect.custom"),gG=Object.values(Vu).map(r=>r.decoder).reduce((r,e)=>r.or(e),Vu.identity.decoder),yG=114,BR=36,MR=37,C7e,Uy=class{constructor(e){B(this,"type");B(this,"multihash");B(this,"privateKey");B(this,"publicKey");B(this,"string");B(this,C7e,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=pr.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return z.createV1(yG,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return mt(this.multihash.bytes,e);if(typeof e=="string")return Oe(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return mt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(C7e=LR,I7e)](){return`PeerId(${this.toString()})`}},L1=class extends Uy{constructor(t){super({...t,type:"RSA"});B(this,"type","RSA");B(this,"publicKey");this.publicKey=t.publicKey}},B1=class extends Uy{constructor(t){super({...t,type:"Ed25519"});B(this,"type","Ed25519");B(this,"publicKey");this.publicKey=t.multihash.digest}},M1=class extends Uy{constructor(t){super({...t,type:"secp256k1"});B(this,"type","secp256k1");B(this,"publicKey");this.publicKey=t.multihash.digest}};function Oe(r,e){if(e=e??gG,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=Ea(pr.decode(`z${r}`));return r.startsWith("12D")?new B1({multihash:t}):r.startsWith("16U")?new M1({multihash:t}):new L1({multihash:t})}return Di(gG.decode(r))}function Di(r){try{let e=Ea(r);if(e.code===Ii.code){if(e.digest.length===BR)return new B1({multihash:e});if(e.digest.length===MR)return new M1({multihash:e})}if(e.code===dt.code)return new L1({multihash:e})}catch{return R7e(z.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function R7e(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==yG)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===dt.code)return new L1({multihash:r.multihash});if(e.code===Ii.code){if(e.digest.length===BR)return new B1({multihash:r.multihash});if(e.digest.length===MR)return new M1({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function Hn(r,e){return r.length===BR?new B1({multihash:hc(Ii.code,r),privateKey:e}):r.length===MR?new M1({multihash:hc(Ii.code,r),privateKey:e}):new L1({multihash:await dt.digest(r),publicKey:r,privateKey:e})}function wG({repo:r,codecs:e,bases:t,name:n}){async function i(o,s={}){if(!K8(o))throw new Error("invalid argument "+o);if($8(o))for await(let w of n.resolve(o,s))o=w;let[,a,c,...u]=o.split("/"),l=s.cidBase?await t.getBase(s.cidBase):void 0,f=P7e(c);if(u.length===0){let w=l?l.encoder.encode(f):c;return`/${a}/${w}`}let h=z.decode(f);o=u.join("/");let d=kf(h,o,e,r,s),p=h,g=o;for await(let w of d)z.asCID(w.value)&&(p=w.value,g=w.remainderPath);return`/ipfs/${p.toString(l&&l.encoder)}${g?"/"+g:""}`}return $(i)}function P7e(r){try{return Oe(r).toBytes()}catch{return z.parse(r).bytes}}async function Dr(r){let e;for await(let t of r)e=t;return e}function bG({addAll:r}){return(e,t={})=>{let n,i=z.asCID(e);return i?n=r([{cid:i,...t}],t):n=r([{path:e.toString(),...t}],t),Dr(n)}}var U1=C(ee(),1);function k7e(r){return Symbol.iterator in r}function N7e(r){return Symbol.asyncIterator in r}function _G(r){return z.asCID(r)!=null}async function*Tc(r){if(r==null)throw(0,U1.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");let e=z.asCID(r);if(e){yield Ji({cid:e});return}if(r instanceof String||typeof r=="string"){yield Ji({path:r});return}if(r.cid!=null||r.path!=null)return yield Ji(r);if(k7e(r)){let t=r[Symbol.iterator](),n=t.next();if(n.done)return t;if(_G(n.value)){yield Ji({cid:n.value});for(let i of t)yield Ji({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield Ji({path:n.value});for(let i of t)yield Ji({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield Ji(n.value);for(let i of t)yield Ji(i);return}throw(0,U1.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}if(N7e(r)){let t=r[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(_G(n.value)){yield Ji({cid:n.value});for await(let i of t)yield Ji({cid:i});return}if(n.value instanceof String||typeof n.value=="string"){yield Ji({path:n.value});for await(let i of t)yield Ji({path:i});return}if(n.value.cid!=null||n.value.path!=null){yield Ji(n.value);for await(let i of t)yield Ji(i);return}throw(0,U1.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}throw(0,U1.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}function Ji(r){let e=r.cid||`${r.path}`;if(!e)throw(0,U1.default)(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");let t={path:e,recursive:r.recursive!==!1};return r.metadata!=null&&(t.metadata=r.metadata),t}var Pt={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function EG({repo:r,codecs:e}){async function*t(n,i={}){let o=async function*(){for await(let{path:c,recursive:u,metadata:l}of Tc(n)){let{cid:f}=await Pf(r,e,c),{reason:h}=await r.pins.isPinnedWithType(f,[Pt.recursive,Pt.direct]);if(h==="recursive"&&!u)throw new Error(`${f} already pinned recursively`);u?await r.pins.pinRecursively(f,{metadata:l}):await r.pins.pinDirectly(f,{metadata:l}),yield f}};if(!!!i.lock){yield*o();return}let a=await r.gcLock.readLock();try{yield*o()}finally{a()}}return $(t)}var UR=C(ee(),1);function Fy(r,e,t){let n={type:r,cid:e};return t&&(n.metadata=t),n}function vG({repo:r,codecs:e}){async function*t(n={}){let i=Pt.all;if(n.type&&(i=n.type,!Object.keys(Pt).includes(i)))throw(0,UR.default)(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let o=!1;for await(let{path:s}of Tc(n.paths)){let{cid:a}=await Pf(r,e,s),{reason:c,pinned:u,parent:l,metadata:f}=await r.pins.isPinnedWithType(a,i);if(!u)throw(0,UR.default)(new Error(`path '${s}' is not pinned`),"ERR_NOT_PINNED");switch(c){case Pt.direct:case Pt.recursive:o=!0,yield Fy(c,a,f);break;default:o=!0,yield Fy(`${Pt.indirect} through ${l}`,a,f)}}if(!o)throw new Error("No match found");return}if(i===Pt.recursive||i===Pt.all)for await(let{cid:o,metadata:s}of r.pins.recursiveKeys())yield Fy(Pt.recursive,o,s);if(i===Pt.indirect||i===Pt.all)for await(let o of r.pins.indirectKeys(n))yield Fy(Pt.indirect,o);if(i===Pt.direct||i===Pt.all)for await(let{cid:o,metadata:s}of r.pins.directKeys())yield Fy(Pt.direct,o,s)}return $(t)}function xG({rmAll:r}){async function e(t,n={}){let i=await Dr(r([{path:t,...n}],n));if(!i)throw new Error("CID expected");return i}return e}function SG({repo:r,codecs:e}){async function*t(n,i={}){let o=await r.gcLock.readLock();try{for await(let{path:s,recursive:a}of Tc(n)){let{cid:c}=await Pf(r,e,s),{pinned:u,reason:l}=await r.pins.isPinnedWithType(c,Pt.all);if(!u)throw new Error(`${c} is not pinned`);switch(l){case Pt.recursive:if(!a)throw new Error(`${c} is pinned recursively`);await r.pins.unpin(c),yield c;break;case Pt.direct:await r.pins.unpin(c),yield c;break;default:throw new Error(`${c} is pinned indirectly under ${l}`)}}}finally{o()}}return $(t)}var ab=class{constructor({codecs:e,repo:t}){let n=EG({codecs:e,repo:t});this.addAll=n,this.add=bG({addAll:n});let i=SG({codecs:e,repo:t});this.rmAll=i,this.rm=xG({rmAll:i}),this.ls=vG({codecs:e,repo:t}),this.remote={add:(o,s={})=>Promise.reject(new Error("Not implemented")),ls:async function*(o,s={}){return Promise.reject(new Error("Not implemented"))},rm:(o,s={})=>Promise.reject(new Error("Not implemented")),rmAll:(o,s={})=>Promise.reject(new Error("Not implemented")),service:{add:(o,s)=>Promise.reject(new Error("Not implemented")),rm:(o,s={})=>Promise.reject(new Error("Not implemented")),ls:(o={})=>Promise.reject(new Error("Not implemented"))}}}};var WQ=C(ee(),1);var Vo={};xe(Vo,{abortedError:()=>D7e,dbDeleteFailedError:()=>ub,dbOpenFailedError:()=>cb,dbWriteFailedError:()=>lb,notFoundError:()=>Gn});var F1=C(ee(),1);function cb(r){return r=r||new Error("Cannot open database"),(0,F1.default)(r,"ERR_DB_OPEN_FAILED")}function ub(r){return r=r||new Error("Delete failed"),(0,F1.default)(r,"ERR_DB_DELETE_FAILED")}function lb(r){return r=r||new Error("Write failed"),(0,F1.default)(r,"ERR_DB_WRITE_FAILED")}function Gn(r){return r=r||new Error("Not Found"),(0,F1.default)(r,"ERR_NOT_FOUND")}function D7e(r){return r=r||new Error("Aborted"),(0,F1.default)(r,"ERR_ABORTED")}var Vs=C(ee(),1);function re(r,e="utf8"){let t=I8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var MQ=C(AG(),1);var Zb={};xe(Zb,{generateEphemeralKeyPair:()=>fW,generateKeyPair:()=>Xb,generateKeyPairFromSeed:()=>dSe,importKey:()=>c3,keyStretcher:()=>yW,keysPBM:()=>Q1,marshalPrivateKey:()=>HC,marshalPublicKey:()=>a3,supportedKeys:()=>Uc,unmarshalPrivateKey:()=>Li,unmarshalPublicKey:()=>Bs});var xst=C(Ic(),1),Sst=C(Rb(),1);var Qb=C(at(),1);var RC={};xe(RC,{Ed25519PrivateKey:()=>Vh,Ed25519PublicKey:()=>Xy,generateKeyPair:()=>kxe,generateKeyPairFromSeed:()=>IC,unmarshalEd25519PrivateKey:()=>Cxe,unmarshalEd25519PublicKey:()=>Pxe});var ixe=C(Ju(),1);var oi=BigInt(0),zt=BigInt(1),$f=BigInt(2),oxe=BigInt(8),Uj=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Lr=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:Uj,n:Uj,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var $j=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Hy=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),_it=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),sxe=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),axe=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),cxe=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),uxe=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Bt=class{constructor(e,t,n,i){this.x=e,this.y=t,this.z=n,this.t=i}static fromAffine(e){if(!(e instanceof Vr))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Vr.ZERO)?Bt.ZERO:new Bt(e.x,e.y,zt,ie(e.x*e.y))}static toAffineBatch(e){let t=dxe(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){zj(e);let{x:t,y:n,z:i}=this,{x:o,y:s,z:a}=e,c=ie(t*a),u=ie(o*i),l=ie(n*a),f=ie(s*i);return c===u&&l===f}negate(){return new Bt(ie(-this.x),this.y,this.z,ie(-this.t))}double(){let{x:e,y:t,z:n}=this,{a:i}=Lr,o=ie(e*e),s=ie(t*t),a=ie($f*ie(n*n)),c=ie(i*o),u=e+t,l=ie(ie(u*u)-o-s),f=c+s,h=f-a,d=c-s,p=ie(l*h),g=ie(f*d),w=ie(l*d),_=ie(h*f);return new Bt(p,g,_,w)}add(e){zj(e);let{x:t,y:n,z:i,t:o}=this,{x:s,y:a,z:c,t:u}=e,l=ie((n-t)*(a+s)),f=ie((n+t)*(a-s)),h=ie(f-l);if(h===oi)return this.double();let d=ie(i*$f*u),p=ie(o*$f*c),g=p+d,w=f+l,_=p-d,x=ie(g*h),m=ie(w*_),y=ie(g*_),b=ie(h*w);return new Bt(x,m,b,y)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let t=1+256/e,n=[],i=this,o=i;for(let s=0;s<t;s++){o=i,n.push(o);for(let a=1;a<2**(e-1);a++)o=o.add(i),n.push(o);i=o.double()}return n}wNAF(e,t){!t&&this.equals(Bt.BASE)&&(t=Vr.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&fC.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=Bt.normalizeZ(i),fC.set(t,i)));let o=Bt.ZERO,s=Bt.BASE,a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<a;h++){let d=h*c,p=Number(e&u);e>>=f,p>c&&(p-=l,e+=zt);let g=d,w=d+Math.abs(p)-1,_=h%2!==0,x=p<0;p===0?s=s.add(Fj(_,i[g])):o=o.add(Fj(x,i[w]))}return Bt.normalizeZ([o,s])[0]}multiply(e,t){return this.wNAF(Pb(e,Lr.l),t)}multiplyUnsafe(e){let t=Pb(e,Lr.l,!1),n=Bt.BASE,i=Bt.ZERO;if(t===oi)return i;if(this.equals(i)||t===zt)return this;if(this.equals(n))return this.wNAF(t);let o=i,s=this;for(;t>oi;)t&zt&&(o=o.add(s)),s=s.double(),t>>=zt;return o}isSmallOrder(){return this.multiplyUnsafe(Lr.h).equals(Bt.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(Lr.l/$f).double();return Lr.l%$f&&(e=e.add(this)),e.equals(Bt.ZERO)}toAffine(e){let{x:t,y:n,z:i}=this,o=this.equals(Bt.ZERO);e==null&&(e=o?oxe:kb(i));let s=ie(t*e),a=ie(n*e),c=ie(i*e);if(o)return Vr.ZERO;if(c!==zt)throw new Error("invZ was invalid");return new Vr(s,a)}fromRistrettoBytes(){cC()}toRistrettoBytes(){cC()}fromRistrettoHash(){cC()}};Bt.BASE=new Bt(Lr.Gx,Lr.Gy,zt,ie(Lr.Gx*Lr.Gy));Bt.ZERO=new Bt(oi,zt,zt,oi);function Fj(r,e){let t=e.negate();return r?t:e}function zj(r){if(!(r instanceof Bt))throw new TypeError("ExtendedPoint expected")}function aC(r){if(!(r instanceof po))throw new TypeError("RistrettoPoint expected")}function cC(){throw new Error("Legacy method: switch to RistrettoPoint")}var po=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:t}=Lr,n=ie(Hy*e*e),i=ie((n+zt)*cxe),o=BigInt(-1),s=ie((o-t*n)*ie(n+t)),{isValid:a,value:c}=hC(i,s),u=ie(c*e);Kf(u)||(u=ie(-u)),a||(c=u),a||(o=n);let l=ie(o*(n-zt)*uxe-s),f=c*c,h=ie((c+c)*s),d=ie(l*sxe),p=ie(zt-f),g=ie(zt+f);return new Bt(ie(h*g),ie(p*d),ie(d*g),ie(h*p))}static hashToCurve(e){e=qf(e,64);let t=uC(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),i=uC(e.slice(32,64)),o=this.calcElligatorRistrettoMap(i);return new po(n.add(o))}static fromHex(e){e=qf(e,32);let{a:t,d:n}=Lr,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",o=uC(e);if(!pxe(Gy(o),e)||Kf(o))throw new Error(i);let s=ie(o*o),a=ie(zt+t*s),c=ie(zt-t*s),u=ie(a*a),l=ie(c*c),f=ie(t*n*u-l),{isValid:h,value:d}=Kj(ie(f*l)),p=ie(d*c),g=ie(d*p*f),w=ie((o+o)*p);Kf(w)&&(w=ie(-w));let _=ie(a*g),x=ie(w*_);if(!h||Kf(x)||_===oi)throw new Error(i);return new po(new Bt(w,_,zt,x))}toRawBytes(){let{x:e,y:t,z:n,t:i}=this.ep,o=ie(ie(n+t)*ie(n-t)),s=ie(e*t),a=ie(s*s),{value:c}=Kj(ie(o*a)),u=ie(c*o),l=ie(c*s),f=ie(u*l*i),h;if(Kf(i*f)){let p=ie(t*Hy),g=ie(e*Hy);e=p,t=g,h=ie(u*axe)}else h=l;Kf(e*f)&&(t=ie(-t));let d=ie((n-t)*h);return Kf(d)&&(d=ie(-d)),Gy(d)}toHex(){return jy(this.toRawBytes())}toString(){return this.toHex()}equals(e){aC(e);let t=this.ep,n=e.ep,i=ie(t.x*n.y)===ie(t.y*n.x),o=ie(t.y*n.y)===ie(t.x*n.x);return i||o}add(e){return aC(e),new po(this.ep.add(e.ep))}subtract(e){return aC(e),new po(this.ep.subtract(e.ep))}multiply(e){return new po(this.ep.multiply(e))}multiplyUnsafe(e){return new po(this.ep.multiplyUnsafe(e))}};po.BASE=new po(Bt.BASE);po.ZERO=new po(Bt.ZERO);var fC=new WeakMap,Vr=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,fC.delete(this)}static fromHex(e,t=!0){let{d:n,P:i}=Lr;e=qf(e,32);let o=e.slice();o[31]=e[31]&-129;let s=Wy(o);if(t&&s>=i)throw new Error("Expected 0 < hex < P");if(!t&&s>=$j)throw new Error("Expected 0 < hex < 2**256");let a=ie(s*s),c=ie(a-zt),u=ie(n*a+zt),{isValid:l,value:f}=hC(c,u);if(!l)throw new Error("Point.fromHex: invalid y coordinate");let h=(f&zt)===zt;return(e[31]&128)!==0!==h&&(f=ie(-f)),new Vr(f,s)}static async fromPrivateKey(e){return(await Nb(e)).point}toRawBytes(){let e=Gy(this.y);return e[31]|=this.x&zt?128:0,e}toHex(){return jy(this.toRawBytes())}toX25519(){let{y:e}=this,t=ie((zt+e)*kb(zt-e));return Gy(t)}isTorsionFree(){return Bt.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Vr(ie(-this.x),this.y)}add(e){return Bt.fromAffine(this).add(Bt.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Bt.fromAffine(this).multiply(e,this).toAffine()}};Vr.BASE=new Vr(Lr.Gx,Lr.Gy);Vr.ZERO=new Vr(oi,zt);var Uh=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){let t=qf(e,64),n=Vr.fromHex(t.slice(0,32),!1),i=Wy(t.slice(32,64));return new Uh(n,i)}assertValidity(){let{r:e,s:t}=this;if(!(e instanceof Vr))throw new Error("Expected Point instance");return Pb(t,Lr.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Gy(this.s),32),e}toHex(){return jy(this.toRawBytes())}};function Vj(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let o=r[n];t.set(o,i),i+=o.length}return t}var lxe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function jy(r){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=lxe[r[t]];return e}function dC(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[t]=o}return e}function qj(r){let t=r.toString(16).padStart(64,"0");return dC(t)}function Gy(r){return qj(r).reverse()}function Kf(r){return(ie(r)&zt)===zt}function Wy(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+jy(Uint8Array.from(r).reverse()))}var fxe=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function uC(r){return ie(Wy(r)&fxe)}function ie(r,e=Lr.P){let t=r%e;return t>=oi?t:e+t}function kb(r,e=Lr.P){if(r===oi||e<=oi)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=ie(r,e),n=e,i=oi,o=zt,s=zt,a=oi;for(;t!==oi;){let u=n/t,l=n%t,f=i-s*u,h=o-a*u;n=t,t=l,i=s,o=a,s=f,a=h}if(n!==zt)throw new Error("invert: does not exist");return ie(i,e)}function dxe(r,e=Lr.P){let t=new Array(r.length),n=r.reduce((o,s,a)=>s===oi?o:(t[a]=o,ie(o*s,e)),zt),i=kb(n,e);return r.reduceRight((o,s,a)=>s===oi?o:(t[a]=ie(o*t[a],e),ie(o*s,e)),i),t}function Oc(r,e){let{P:t}=Lr,n=r;for(;e-- >oi;)n*=n,n%=t;return n}function hxe(r){let{P:e}=Lr,t=BigInt(5),n=BigInt(10),i=BigInt(20),o=BigInt(40),s=BigInt(80),c=r*r%e*r%e,u=Oc(c,$f)*c%e,l=Oc(u,zt)*r%e,f=Oc(l,t)*l%e,h=Oc(f,n)*f%e,d=Oc(h,i)*h%e,p=Oc(d,o)*d%e,g=Oc(p,s)*p%e,w=Oc(g,s)*p%e,_=Oc(w,n)*f%e;return{pow_p_5_8:Oc(_,$f)*r%e,b2:c}}function hC(r,e){let t=ie(e*e*e),n=ie(t*t*e),i=hxe(r*n).pow_p_5_8,o=ie(r*t*i),s=ie(e*o*o),a=o,c=ie(o*Hy),u=s===r,l=s===ie(-r),f=s===ie(-r*Hy);return u&&(o=a),(l||f)&&(o=c),Kf(o)&&(o=ie(-o)),{isValid:u||l,value:o}}function Kj(r){return hC(zt,r)}function Cb(r){return ie(Wy(r),Lr.l)}function pxe(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function qf(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):dC(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Pb(r,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof r=="number"&&Number.isSafeInteger(r)&&(r=BigInt(r)),typeof r=="bigint"&&r<e){if(t){if(oi<r)return r}else if(oi<=r)return r}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function mxe(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function gxe(r){if(r=typeof r=="bigint"||typeof r=="number"?qj(Pb(r,$j)):qf(r),r.length!==32)throw new Error("Expected 32 bytes");return r}function yxe(r){let e=mxe(r.slice(0,32)),t=r.slice(32,64),n=Cb(e),i=Vr.BASE.multiply(n),o=i.toRawBytes();return{head:e,prefix:t,scalar:n,point:i,pointBytes:o}}var lC;async function Nb(r){return yxe(await Lc.sha512(gxe(r)))}async function H1(r){return(await Nb(r)).pointBytes}async function Db(r,e){r=qf(r);let{prefix:t,scalar:n,pointBytes:i}=await Nb(e),o=Cb(await Lc.sha512(t,r)),s=Vr.BASE.multiply(o),a=Cb(await Lc.sha512(s.toRawBytes(),i,r)),c=ie(o+a*n,Lr.l);return new Uh(s,c).toRawBytes()}function wxe(r,e,t){e=qf(e),t instanceof Vr||(t=Vr.fromHex(t,!1));let{r:n,s:i}=r instanceof Uh?r.assertValidity():Uh.fromHex(r),o=Bt.BASE.multiplyUnsafe(i);return{r:n,s:i,SB:o,pub:t,msg:e}}function bxe(r,e,t,n){let i=Cb(n),o=Bt.fromAffine(r).multiplyUnsafe(i);return Bt.fromAffine(e).add(o).subtract(t).multiplyUnsafe(Lr.h).equals(Bt.ZERO)}async function Ob(r,e,t){let{r:n,SB:i,msg:o,pub:s}=wxe(r,e,t),a=await Lc.sha512(n.toRawBytes(),s.toRawBytes(),o);return bxe(s,n,i,a)}Vr.BASE._setWindowSize(8);var Vf={node:ixe,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Lc={bytesToHex:jy,hexToBytes:dC,concatBytes:Vj,getExtendedPublicKey:Nb,mod:ie,invert:kb,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:r=>{if(r=qf(r),r.length<40||r.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return ie(Wy(r),Lr.l-zt)+zt},randomBytes:(r=32)=>{if(Vf.web)return Vf.web.getRandomValues(new Uint8Array(r));if(Vf.node){let{randomBytes:e}=Vf.node;return new Uint8Array(e(r).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Lc.randomBytes(32),sha512:async(...r)=>{let e=Vj(...r);if(Vf.web){let t=await Vf.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}else{if(Vf.node)return Uint8Array.from(Vf.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(r=8,e=Vr.BASE){let t=e.equals(Vr.BASE)?e:new Vr(e.x,e.y);return t._setWindowSize(r),t.multiply($f),t},sha512Sync:void 0};Object.defineProperties(Lc,{sha512Sync:{configurable:!1,get(){return lC},set(r){lC||(lC=r)}}});var G1=32,rl=64,Lb=32;async function Gj(){let r=Lc.randomPrivateKey(),e=await H1(r);return{privateKey:Qj(r,e),publicKey:e}}async function jj(r){if(r.length!==Lb)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=r,t=await H1(e);return{privateKey:Qj(e,t),publicKey:t}}async function Wj(r,e){let t=r.subarray(0,Lb);return Db(e,t)}async function Yj(r,e,t){return Ob(e,t,r)}function Qj(r,e){let t=new Uint8Array(rl);for(let n=0;n<Lb;n++)t[n]=r[n],t[Lb+n]=e[n];return t}function rt(r,e){e==null&&(e=r.reduce((i,o)=>i+o.length,0));let t=vf(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return wf(t)}var yn={get(r=globalThis){let e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var pC={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Bb(r){let e=(r==null?void 0:r.algorithm)??"AES-GCM",t=(r==null?void 0:r.keyLength)??16,n=(r==null?void 0:r.nonceLength)??12,i=(r==null?void 0:r.digest)??"SHA-256",o=(r==null?void 0:r.saltLength)??16,s=(r==null?void 0:r.iterations)??32767,a=yn.get();t*=8;async function c(f,h){let d=a.getRandomValues(new Uint8Array(o)),p=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:p};typeof h=="string"&&(h=Ie(h));let w;if(h.length===0){w=await a.subtle.importKey("jwk",pC,{name:"AES-GCM"},!0,["encrypt"]);try{let x={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},m=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(x,m,{name:e,length:t},!0,["encrypt"])}catch{w=await a.subtle.importKey("jwk",pC,{name:"AES-GCM"},!0,["encrypt"])}}else{let x={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},m=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(x,m,{name:e,length:t},!0,["encrypt"])}let _=await a.subtle.encrypt(g,w,f);return rt([d,g.iv,new Uint8Array(_)])}async function u(f,h){let d=f.subarray(0,o),p=f.subarray(o,o+n),g=f.subarray(o+n),w={name:e,iv:p};typeof h=="string"&&(h=Ie(h));let _;if(h.length===0)try{let m={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},y=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);_=await a.subtle.deriveKey(m,y,{name:e,length:t},!0,["decrypt"])}catch{_=await a.subtle.importKey("jwk",pC,{name:"AES-GCM"},!0,["decrypt"])}else{let m={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},y=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);_=await a.subtle.deriveKey(m,y,{name:e,length:t},!0,["decrypt"])}let x=await a.subtle.decrypt(w,_,g);return new Uint8Array(x)}return{encrypt:c,decrypt:u}}async function j1(r,e){let n=await Bb().encrypt(r,e);return fh.encode(n)}var Q1={};xe(Q1,{KeyType:()=>Br,PrivateKey:()=>Fa,PublicKey:()=>Ua});var mC=new Float32Array([-0]),Hf=new Uint8Array(mC.buffer);function Zj(r,e,t){mC[0]=r,e[t]=Hf[0],e[t+1]=Hf[1],e[t+2]=Hf[2],e[t+3]=Hf[3]}function Jj(r,e){return Hf[0]=r[e],Hf[1]=r[e+1],Hf[2]=r[e+2],Hf[3]=r[e+3],mC[0]}var gC=new Float64Array([-0]),Oi=new Uint8Array(gC.buffer);function eW(r,e,t){gC[0]=r,e[t]=Oi[0],e[t+1]=Oi[1],e[t+2]=Oi[2],e[t+3]=Oi[3],e[t+4]=Oi[4],e[t+5]=Oi[5],e[t+6]=Oi[6],e[t+7]=Oi[7]}function tW(r,e){return Oi[0]=r[e],Oi[1]=r[e+1],Oi[2]=r[e+2],Oi[3]=r[e+3],Oi[4]=r[e+4],Oi[5]=r[e+5],Oi[6]=r[e+6],Oi[7]=r[e+7],gC[0]}var Exe=BigInt(Number.MAX_SAFE_INTEGER),vxe=BigInt(Number.MIN_SAFE_INTEGER),Rn=class{constructor(e,t){B(this,"lo");B(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Fh;if(e<Exe&&e>vxe)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>rW&&(i=0n,++n>rW&&(n=0n))),new Rn(Number(i),Number(n))}static fromNumber(e){if(e===0)return Fh;let t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Rn(n,i)}static from(e){return typeof e=="number"?Rn.fromNumber(e):typeof e=="bigint"?Rn.fromBigInt(e):typeof e=="string"?Rn.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Rn(e.low>>>0,e.high>>>0):Fh}},Fh=new Rn(0,0);Fh.toBigInt=function(){return 0n};Fh.zzEncode=Fh.zzDecode=function(){return this};Fh.length=function(){return 1};var rW=4294967296n;function nW(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function iW(r,e,t){if(t-e<1)return"";let i,o=[],s=0,a;for(;e<t;)a=r[e++],a<128?o[s++]=a:a>191&&a<224?o[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,o[s++]=55296+(a>>10),o[s++]=56320+(a&1023)):o[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i!=null?(s>0&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))}function yC(r,e,t){let n=t,i,o;for(let s=0;s<r.length;++s)i=r.charCodeAt(s),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((o=r.charCodeAt(s+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++s,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function Ma(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function Mb(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var wC=class{constructor(e){B(this,"buf");B(this,"pos");B(this,"len");B(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ma(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Ma(this,4);return Mb(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ma(this,4);return Mb(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Ma(this,4);let e=Jj(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Ma(this,4);let e=tW(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Ma(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return iW(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Ma(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Ma(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Rn(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ma(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ma(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ma(this,8);let e=Mb(this.buf,this.pos+=4),t=Mb(this.buf,this.pos+=4);return new Rn(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=MI(this.buf,this.pos);return this.pos+=ti(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function bC(r){return new wC(r instanceof Uint8Array?r:r.subarray())}function Cn(r,e,t){let n=bC(r);return e.decode(n,void 0,t)}function _C(r){let e=r??8192,t=e>>>1,n,i=e;return function(s){if(s<1||s>t)return Ri(s);i+s>e&&(n=Ri(e),i=0);let a=n.subarray(i,i+=s);return i&7&&(i=(i|7)+1),a}}var zh=class{constructor(e,t,n){B(this,"fn");B(this,"len");B(this,"next");B(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}};function EC(){}var xC=class{constructor(e){B(this,"head");B(this,"tail");B(this,"len");B(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},xxe=_C();function Sxe(r){return globalThis.Buffer!=null?Ri(r):xxe(r)}var Qy=class{constructor(){B(this,"len");B(this,"head");B(this,"tail");B(this,"states");this.len=0,this.head=new zh(EC,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new zh(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new SC((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Ub,10,Rn.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Rn.fromBigInt(e);return this._push(Ub,t.length(),t)}uint64Number(e){return this._push(BI,ti(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Rn.fromBigInt(e).zzEncode();return this._push(Ub,t.length(),t)}sint64Number(e){let t=Rn.fromNumber(e).zzEncode();return this._push(Ub,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(vC,1,e?1:0)}fixed32(e){return this._push(Yy,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Rn.fromBigInt(e);return this._push(Yy,4,t.lo)._push(Yy,4,t.hi)}fixed64Number(e){let t=Rn.fromNumber(e);return this._push(Yy,4,t.lo)._push(Yy,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Zj,4,e)}double(e){return this._push(eW,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(vC,1,0):this.uint32(t)._push(Txe,t,e)}string(e){let t=nW(e);return t!==0?this.uint32(t)._push(yC,t,e):this._push(vC,1,0)}fork(){return this.states=new xC(this),this.head=this.tail=new zh(EC,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new zh(EC,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=Sxe(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function vC(r,e,t){e[t]=r&255}function Axe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var SC=class extends zh{constructor(t,n){super(Axe,t,n);B(this,"next");this.next=void 0}};function Ub(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Yy(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Txe(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Qy.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(Ixe,e,r),this},Qy.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Rxe,e,r),this});function Ixe(r,e,t){e.set(r,t)}function Rxe(r,e,t){r.length<40?yC(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(cr(r),t)}function AC(){return new Qy}function Pn(r,e){let t=AC();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var W1;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(W1||(W1={}));function Fb(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Y1(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(o,s){let a=e(o);s.int32(a)},n=function(o){let s=o.int32();return e(s)};return Fb("enum",W1.VARINT,t,n)}function kn(r,e){return Fb("message",W1.LENGTH_DELIMITED,r,e)}var Br;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(Br||(Br={}));var TC;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(TC||(TC={}));(function(r){r.codec=()=>Y1(TC)})(Br||(Br={}));var Ua;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Br.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.Type=Br.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(Ua||(Ua={}));var Fa;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Br.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.Type=Br.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(Fa||(Fa={}));var Xy=class{constructor(e){B(this,"_key");this._key=X1(e,G1)}async verify(e,t){return Yj(this._key,t,e)}marshal(){return this._key}get bytes(){return Ua.encode({Type:Br.Ed25519,Data:this.marshal()}).subarray()}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}},Vh=class{constructor(e,t){B(this,"_key");B(this,"_publicKey");this._key=X1(e,rl),this._publicKey=X1(t,G1)}async sign(e){return Wj(this._key,e)}get public(){return new Xy(this._publicKey)}marshal(){return this._key}get bytes(){return Fa.encode({Type:Br.Ed25519,Data:this.marshal()}).subarray()}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}async id(){let e=Ii.digest(this.public.bytes);return pr.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return j1(this.bytes,e);throw new J(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Cxe(r){if(r.length>rl){r=X1(r,rl+G1);let n=r.subarray(0,rl),i=r.subarray(rl,r.length);return new Vh(n,i)}r=X1(r,rl);let e=r.subarray(0,rl),t=r.subarray(G1);return new Vh(e,t)}function Pxe(r){return r=X1(r,G1),new Xy(r)}async function kxe(){let{privateKey:r,publicKey:e}=await Gj();return new Vh(r,e)}async function IC(r){let{privateKey:e,publicKey:t}=await jj(r);return new Vh(e,t)}function X1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new J(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}var bot=C(gr(),1),_ot=C(qy(),1),sW=C(at(),1);function za(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=rt([new Uint8Array(e-t.length),t])}return re(t,"base64url")}function Ko(r){let e=zb(r);return new sW.default.jsbn.BigInteger(re(e,"base16"),16)}function zb(r,e){let t=Ie(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=rt([new Uint8Array(e-t.length),t])}return t}var aW={"P-256":256,"P-384":384,"P-521":521},Nxe=Object.keys(aW),CC=Nxe.join(" / ");async function cW(r){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new J(`Unknown curve: ${r}. Must be ${CC}`,"ERR_INVALID_CURVE");let e=await yn.get().subtle.generateKey({name:"ECDH",namedCurve:r},!0,["deriveBits"]),t=async(o,s)=>{let a;s!=null?a=await yn.get().subtle.importKey("jwk",Oxe(r,s),{name:"ECDH",namedCurve:r},!1,["deriveBits"]):a=e.privateKey;let c=await yn.get().subtle.importKey("jwk",lW(r,o),{name:"ECDH",namedCurve:r},!1,[]),u=await yn.get().subtle.deriveBits({name:"ECDH",namedCurve:r,public:c},a,aW[r]);return new Uint8Array(u,0,u.byteLength)},n=await yn.get().subtle.exportKey("jwk",e.publicKey);return{key:Dxe(n),genSharedKey:t}}var uW={"P-256":32,"P-384":48,"P-521":66};function Dxe(r){if(r.crv==null||r.x==null||r.y==null)throw new J("JWK was missing components","ERR_INVALID_PARAMETERS");if(r.crv!=="P-256"&&r.crv!=="P-384"&&r.crv!=="P-521")throw new J(`Unknown curve: ${r.crv}. Must be ${CC}`,"ERR_INVALID_CURVE");let e=uW[r.crv];return rt([Uint8Array.from([4]),zb(r.x,e),zb(r.y,e)],1+e*2)}function lW(r,e){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new J(`Unknown curve: ${r}. Must be ${CC}`,"ERR_INVALID_CURVE");let t=uW[r];if(!mt(e.subarray(0,1),Uint8Array.from([4])))throw new J("Cannot unmarshal public key - invalid key format","ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:r,x:re(e.subarray(1,t+1),"base64url"),y:re(e.subarray(1+t),"base64url"),ext:!0}}var Oxe=(r,e)=>({...lW(r,e.public),d:re(e.private,"base64url")});var fW=cW;async function dW(r,e){let t=fh.decode(r);return Bb().decrypt(t,e)}var hW={SHA1:20,SHA256:32,SHA512:64};var Lxe={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},Bxe=async(r,e)=>{let t=await yn.get().subtle.sign({name:"HMAC"},r,e);return new Uint8Array(t,0,t.byteLength)};async function pW(r,e){let t=Lxe[r],n=await yn.get().subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!1,["sign"]);return{async digest(i){return Bxe(n,i)},length:hW[r]}}var gW={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function yW(r,e,t){let n=gW[r];if(n==null){let x=Object.keys(gW).join(" / ");throw new J(`unknown cipher type '${r}'. Must be ${x}`,"ERR_INVALID_CIPHER_TYPE")}if(e==null)throw new J("missing hash type","ERR_MISSING_HASH_TYPE");let i=n.keySize,o=n.ivSize,s=20,a=Ie("key expansion"),c=2*(o+i+s),u=await pW(e,t),l=await u.digest(a),f=[],h=0;for(;h<c;){let x=await u.digest(rt([l,a])),m=x.length;h+m>c&&(m=c-h),f.push(x),h+=m,l=await u.digest(l)}let d=c/2,p=rt(f),g=p.subarray(0,d),w=p.subarray(d,c),_=x=>({iv:x.subarray(0,o),cipherKey:x.subarray(o,o+i),macKey:x.subarray(o+i)});return{k1:_(g),k2:_(w)}}var zC={};xe(zC,{RsaPrivateKey:()=>om,RsaPublicKey:()=>i3,fromJwk:()=>sSe,generateKeyPair:()=>aSe,unmarshalRsaPrivateKey:()=>iSe,unmarshalRsaPublicKey:()=>oSe});var n3=C(at(),1);var fst=C(NC(),1);var Uxe=C(Ju(),1);var Vt=BigInt(0),Ur=BigInt(1),jf=BigInt(2),e3=BigInt(3),vW=BigInt(8),nn=Object.freeze({a:Vt,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:Ur,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),xW=(r,e)=>(r+e/jf)/e,Vb={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=nn,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Ur*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,s=BigInt("0x100000000000000000000000000000000"),a=xW(o*r,e),c=xW(-n*r,e),u=Te(r-a*t-c*i,e),l=Te(-a*n-c*o,e),f=u>s,h=l>s;if(f&&(u=e-u),h&&(l=e-l),u>s||l>s)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:f,k1:u,k2neg:h,k2:l}}},Va=32,em=32,Fxe=32,SW=Va+1,AW=2*Va+1;function TW(r){let{a:e,b:t}=nn,n=Te(r*r),i=Te(n*r);return Te(i+e*r+t)}var Kb=nn.a===Vt,Hb=class extends Error{constructor(e){super(e)}};function IW(r){if(!(r instanceof jt))throw new TypeError("JacobianPoint expected")}var jt=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof Kt))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(Kt.ZERO)?jt.ZERO:new jt(e.x,e.y,Ur)}static toAffineBatch(e){let t=qxe(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return jt.toAffineBatch(e).map(jt.fromAffine)}equals(e){IW(e);let{x:t,y:n,z:i}=this,{x:o,y:s,z:a}=e,c=Te(i*i),u=Te(a*a),l=Te(t*u),f=Te(o*c),h=Te(Te(n*a)*u),d=Te(Te(s*i)*c);return l===f&&h===d}negate(){return new jt(this.x,Te(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,i=Te(e*e),o=Te(t*t),s=Te(o*o),a=e+o,c=Te(jf*(Te(a*a)-i-s)),u=Te(e3*i),l=Te(u*u),f=Te(l-jf*c),h=Te(u*(c-f)-vW*s),d=Te(jf*t*n);return new jt(f,h,d)}add(e){IW(e);let{x:t,y:n,z:i}=this,{x:o,y:s,z:a}=e;if(o===Vt||s===Vt)return this;if(t===Vt||n===Vt)return e;let c=Te(i*i),u=Te(a*a),l=Te(t*u),f=Te(o*c),h=Te(Te(n*a)*u),d=Te(Te(s*i)*c),p=Te(f-l),g=Te(d-h);if(p===Vt)return g===Vt?this.double():jt.ZERO;let w=Te(p*p),_=Te(p*w),x=Te(l*w),m=Te(g*g-_-jf*x),y=Te(g*(x-m)-h*_),b=Te(i*a*p);return new jt(m,y,b)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=jt.ZERO;if(typeof e=="bigint"&&e===Vt)return t;let n=PW(e);if(n===Ur)return this;if(!Kb){let f=t,h=this;for(;n>Vt;)n&Ur&&(f=f.add(h)),h=h.double(),n>>=Ur;return f}let{k1neg:i,k1:o,k2neg:s,k2:a}=Vb.splitScalar(n),c=t,u=t,l=this;for(;o>Vt||a>Vt;)o&Ur&&(c=c.add(l)),a&Ur&&(u=u.add(l)),l=l.double(),o>>=Ur,a>>=Ur;return i&&(c=c.negate()),s&&(u=u.negate()),u=new jt(Te(u.x*Vb.beta),u.y,u.z),c.add(u)}precomputeWindow(e){let t=Kb?128/e+1:256/e+1,n=[],i=this,o=i;for(let s=0;s<t;s++){o=i,n.push(o);for(let a=1;a<2**(e-1);a++)o=o.add(i),n.push(o);i=o.double()}return n}wNAF(e,t){!t&&this.equals(jt.BASE)&&(t=Kt.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&OC.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=jt.normalizeZ(i),OC.set(t,i)));let o=jt.ZERO,s=jt.BASE,a=1+(Kb?128/n:256/n),c=2**(n-1),u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<a;h++){let d=h*c,p=Number(e&u);e>>=f,p>c&&(p-=l,e+=Ur);let g=d,w=d+Math.abs(p)-1,_=h%2!==0,x=p<0;p===0?s=s.add($b(_,i[g])):o=o.add($b(x,i[w]))}return{p:o,f:s}}multiply(e,t){let n=PW(e),i,o;if(Kb){let{k1neg:s,k1:a,k2neg:c,k2:u}=Vb.splitScalar(n),{p:l,f}=this.wNAF(a,t),{p:h,f:d}=this.wNAF(u,t);l=$b(s,l),h=$b(c,h),h=new jt(Te(h.x*Vb.beta),h.y,h.z),i=l.add(h),o=f.add(d)}else{let{p:s,f:a}=this.wNAF(n,t);i=s,o=a}return jt.normalizeZ([i,o])[0]}toAffine(e){let{x:t,y:n,z:i}=this,o=this.equals(jt.ZERO);e==null&&(e=o?vW:nm(i));let s=e,a=Te(s*s),c=Te(a*s),u=Te(t*a),l=Te(n*c),f=Te(i*s);if(o)return Kt.ZERO;if(f!==Ur)throw new Error("invZ was invalid");return new Kt(u,l)}};jt.BASE=new jt(nn.Gx,nn.Gy,Ur);jt.ZERO=new jt(Vt,Ur,Vt);function $b(r,e){let t=e.negate();return r?t:e}var OC=new WeakMap,Kt=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,OC.delete(this)}hasEvenY(){return this.y%jf===Vt}static fromCompressedHex(e){let t=e.length===32,n=Wf(t?e:e.subarray(1));if(!DC(n))throw new Error("Point is not on curve");let i=TW(n),o=$xe(i),s=(o&Ur)===Ur;t?s&&(o=Te(-o)):(e[0]&1)===1!==s&&(o=Te(-o));let a=new Kt(n,o);return a.assertValidity(),a}static fromUncompressedHex(e){let t=Wf(e.subarray(1,Va+1)),n=Wf(e.subarray(Va+1,Va*2+1)),i=new Kt(t,n);return i.assertValidity(),i}static fromHex(e){let t=rm(e),n=t.length,i=t[0];if(n===Va)return this.fromCompressedHex(t);if(n===SW&&(i===2||i===3))return this.fromCompressedHex(t);if(n===AW&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${SW} compressed bytes or ${AW} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return Kt.BASE.multiply(jb(e))}static fromSignature(e,t,n){let{r:i,s:o}=kW(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let s=MC(rm(e)),{n:a}=nn,c=n===2||n===3?i+a:i,u=nm(c,a),l=Te(-s*u,a),f=Te(o*u,a),h=n&1?"03":"02",d=Kt.fromHex(h+Z1(c)),p=Kt.BASE.multiplyAndAddUnsafe(d,l,f);if(!p)throw new Error("Cannot recover signature: point at infinify");return p.assertValidity(),p}toRawBytes(e=!1){return $h(this.toHex(e))}toHex(e=!1){let t=Z1(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Z1(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!DC(t)||!DC(n))throw new Error(e);let i=Te(n*n),o=TW(t);if(Te(i-o)!==Vt)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Kt(this.x,Te(-this.y))}double(){return jt.fromAffine(this).double().toAffine()}add(e){return jt.fromAffine(this).add(jt.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return jt.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let i=jt.fromAffine(this),o=t===Vt||t===Ur||this!==Kt.BASE?i.multiplyUnsafe(t):i.multiply(t),s=jt.fromAffine(e).multiplyUnsafe(n),a=o.add(s);return a.equals(jt.ZERO)?void 0:a.toAffine()}};Kt.BASE=new Kt(nn.Gx,nn.Gy);Kt.ZERO=new Kt(Vt,Vt);function RW(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function CW(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${tm(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Wf(t),left:r.subarray(e+2)}}function zxe(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${tm(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=CW(r.subarray(2)),{data:n,left:i}=CW(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${tm(i)}`);return{r:e,s:n}}var Bc=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=t?tm(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Bc(Gb(i.slice(0,64)),Gb(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=zxe(t?e:$h(e));return new Bc(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!r3(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!r3(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=nn.n>>Ur;return this.s>e}normalizeS(){return this.hasHighS()?new Bc(this.r,Te(-this.s,nn.n)):this}toDERRawBytes(){return $h(this.toDERHex())}toDERHex(){let e=RW(Jy(this.s)),t=RW(Jy(this.r)),n=e.length/2,i=t.length/2,o=Jy(n),s=Jy(i);return`30${Jy(i+n+4)}02${s}${t}02${o}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return $h(this.toCompactHex())}toCompactHex(){return Z1(this.r)+Z1(this.s)}};function Gf(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let o=r[n];t.set(o,i),i+=o.length}return t}var Vxe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function tm(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=Vxe[r[t]];return e}var Kxe=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Z1(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(Vt<=r&&r<Kxe))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function LC(r){let e=$h(Z1(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Jy(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function Gb(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function $h(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[t]=o}return e}function Wf(r){return Gb(tm(r))}function rm(r){return r instanceof Uint8Array?Uint8Array.from(r):$h(r)}function PW(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&r3(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function Te(r,e=nn.P){let t=r%e;return t>=Vt?t:e+t}function Ls(r,e){let{P:t}=nn,n=r;for(;e-- >Vt;)n*=n,n%=t;return n}function $xe(r){let{P:e}=nn,t=BigInt(6),n=BigInt(11),i=BigInt(22),o=BigInt(23),s=BigInt(44),a=BigInt(88),c=r*r*r%e,u=c*c*r%e,l=Ls(u,e3)*u%e,f=Ls(l,e3)*u%e,h=Ls(f,jf)*c%e,d=Ls(h,n)*h%e,p=Ls(d,i)*d%e,g=Ls(p,s)*p%e,w=Ls(g,a)*g%e,_=Ls(w,s)*p%e,x=Ls(_,e3)*u%e,m=Ls(x,o)*d%e,y=Ls(m,t)*c%e,b=Ls(y,jf);if(b*b%e!==r)throw new Error("Cannot find square root");return b}function nm(r,e=nn.P){if(r===Vt||e<=Vt)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=Te(r,e),n=e,i=Vt,o=Ur,s=Ur,a=Vt;for(;t!==Vt;){let u=n/t,l=n%t,f=i-s*u,h=o-a*u;n=t,t=l,i=s,o=a,s=f,a=h}if(n!==Ur)throw new Error("invert: does not exist");return Te(i,e)}function qxe(r,e=nn.P){let t=new Array(r.length),n=r.reduce((o,s,a)=>s===Vt?o:(t[a]=o,Te(o*s,e)),Ur),i=nm(n,e);return r.reduceRight((o,s,a)=>s===Vt?o:(t[a]=Te(o*t[a],e),Te(o*s,e)),i),t}function Hxe(r){let e=r.length*8-em*8,t=Wf(r);return e>0?t>>BigInt(e):t}function MC(r,e=!1){let t=Hxe(r);if(e)return t;let{n}=nn;return t>=n?t-n:t}var J1,t3,BC=class{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return ro.hmacSha256(this.k,...e)}hmacSync(...e){return t3(this.k,...e)}checkSync(){if(typeof t3!="function")throw new Hb("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return Gf(...t)}generateSync(){this.checkSync(),this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return Gf(...t)}};function r3(r){return Vt<r&&r<nn.n}function DC(r){return Vt<r&&r<nn.P}function Gxe(r,e,t,n=!0){let{n:i}=nn,o=MC(r,!0);if(!r3(o))return;let s=nm(o,i),a=Kt.BASE.multiply(o),c=Te(a.x,i);if(c===Vt)return;let u=Te(s*Te(e+t*c,i),i);if(u===Vt)return;let l=new Bc(c,u),f=(a.x===l.r?0:2)|Number(a.y&Ur);return n&&l.hasHighS()&&(l=l.normalizeS(),f^=1),{sig:l,recovery:f}}function jb(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*em)throw new Error("Expected 32 bytes of private key");e=Gb(r)}else if(r instanceof Uint8Array){if(r.length!==em)throw new Error("Expected 32 bytes of private key");e=Wf(r)}else throw new TypeError("Expected valid private key");if(!r3(e))throw new Error("Expected private key: 0 < key < n");return e}function jxe(r){return r instanceof Kt?(r.assertValidity(),r):Kt.fromHex(r)}function kW(r){if(r instanceof Bc)return r.assertValidity(),r;try{return Bc.fromDER(r)}catch{return Bc.fromCompact(r)}}function im(r,e=!1){return Kt.fromPrivateKey(r).toRawBytes(e)}function NW(r){let e=r.length>Va?r.slice(0,Va):r;return Wf(e)}function Wxe(r){let e=NW(r),t=Te(e,nn.n);return DW(t<Vt?e:t)}function DW(r){return LC(r)}function Yxe(r,e,t){if(r==null)throw new Error(`sign: expected valid message hash, not "${r}"`);let n=rm(r),i=jb(e),o=[DW(i),Wxe(n)];if(t!=null){t===!0&&(t=ro.randomBytes(Va));let c=rm(t);if(c.length!==Va)throw new Error(`sign: Expected ${Va} bytes of extra data`);o.push(c)}let s=Gf(...o),a=NW(n);return{seed:s,m:a,d:i}}function Qxe(r,e){let{sig:t,recovery:n}=r,{der:i,recovered:o}=Object.assign({canonical:!0,der:!0},e),s=i?t.toDERRawBytes():t.toCompactRawBytes();return o?[s,n]:s}async function Wb(r,e,t={}){let{seed:n,m:i,d:o}=Yxe(r,e,t.extraEntropy),s=new BC(Fxe,em);await s.reseed(n);let a;for(;!(a=Gxe(await s.generate(),i,o,t.canonical));)await s.reseed();return Qxe(a,t)}var Xxe={strict:!0};function Yb(r,e,t,n=Xxe){let i;try{i=kW(r),e=rm(e)}catch{return!1}let{r:o,s}=i;if(n.strict&&i.hasHighS())return!1;let a=MC(e),c;try{c=jxe(t)}catch{return!1}let{n:u}=nn,l=nm(s,u),f=Te(a*l,u),h=Te(o*l,u),d=Kt.BASE.multiplyAndAddUnsafe(c,f,h);return d?Te(d.x,u)===o:!1}Kt.BASE._setWindowSize(8);var $o={node:Uxe,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var qb={},ro={bytesToHex:tm,hexToBytes:$h,concatBytes:Gf,mod:Te,invert:nm,isValidPrivateKey(r){try{return jb(r),!0}catch{return!1}},_bigintTo32Bytes:LC,_normalizePrivateKey:jb,hashToPrivateKey:r=>{r=rm(r);let e=em+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=Te(Wf(r),nn.n-Ur)+Ur;return LC(t)},randomBytes:(r=32)=>{if($o.web)return $o.web.getRandomValues(new Uint8Array(r));if($o.node){let{randomBytes:e}=$o.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ro.hashToPrivateKey(ro.randomBytes(em+8)),precompute(r=8,e=Kt.BASE){let t=e===Kt.BASE?e:new Kt(e.x,e.y);return t._setWindowSize(r),t.multiply(e3),t},sha256:async(...r)=>{if($o.web){let e=await $o.web.subtle.digest("SHA-256",Gf(...r));return new Uint8Array(e)}else if($o.node){let{createHash:e}=$o.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if($o.web){let t=await $o.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Gf(...e),i=await $o.web.subtle.sign("HMAC",t,n);return new Uint8Array(i)}else if($o.node){let{createHmac:t}=$o.node,n=t("sha256",r);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=qb[r];if(t===void 0){let n=await ro.sha256(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Gf(n,n),qb[r]=t}return ro.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof J1!="function")throw new Hb("sha256Sync is undefined, you need to set it");let t=qb[r];if(t===void 0){let n=J1(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Gf(n,n),qb[r]=t}return J1(t,...e)},_JacobianPoint:jt};Object.defineProperties(ro,{sha256Sync:{configurable:!1,get(){return J1},set(r){J1||(J1=r)}},hmacSha256Sync:{configurable:!1,get(){return t3},set(r){t3||(t3=r)}}});function Mc(r){if(isNaN(r)||r<=0)throw new J("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ro.randomBytes(r)}var jot=C(Bh(),1),UC=C(at(),1);function LW(r,e){return e.map(t=>Ko(r[t]))}function BW(r){return UC.default.pki.setRsaPrivateKey(...LW(r,["n","e","d","p","q","dp","dq","qi"]))}function MW(r){return UC.default.pki.setRsaPublicKey(...LW(r,["n","e"]))}var qh={};xe(qh,{jwkToPkcs1:()=>Jxe,jwkToPkix:()=>tSe,pkcs1ToJwk:()=>Zxe,pkixToJwk:()=>eSe});var Qot=C(Ic(),1),Xot=C(Bh(),1);var nl=C(at(),1);function Zxe(r){let e=nl.default.asn1.fromDer(re(r,"ascii")),t=nl.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:za(t.n),e:za(t.e),d:za(t.d),p:za(t.p),q:za(t.q),dp:za(t.dP),dq:za(t.dQ),qi:za(t.qInv),alg:"RS256"}}function Jxe(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new J("JWK was missing components","ERR_INVALID_PARAMETERS");let e=nl.default.pki.privateKeyToAsn1({n:Ko(r.n),e:Ko(r.e),d:Ko(r.d),p:Ko(r.p),q:Ko(r.q),dP:Ko(r.dp),dQ:Ko(r.dq),qInv:Ko(r.qi)});return Ie(nl.default.asn1.toDer(e).getBytes(),"ascii")}function eSe(r){let e=nl.default.asn1.fromDer(re(r,"ascii")),t=nl.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:za(t.n),e:za(t.e)}}function tSe(r){if(r.n==null||r.e==null)throw new J("JWK was missing components","ERR_INVALID_PARAMETERS");let e=nl.default.pki.publicKeyToAsn1({n:Ko(r.n),e:Ko(r.e)});return Ie(nl.default.asn1.toDer(e).getBytes(),"ascii")}async function UW(r){let e=await yn.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await VW(e);return{privateKey:t[0],publicKey:t[1]}}async function FC(r){let t=[await yn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await rSe(r)],n=await VW({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function FW(r,e){let t=await yn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await yn.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function zW(r,e,t){let n=await yn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return yn.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function VW(r){if(r.privateKey==null||r.publicKey==null)throw new J("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([yn.get().subtle.exportKey("jwk",r.privateKey),yn.get().subtle.exportKey("jwk",r.publicKey)])}async function rSe(r){return yn.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function KW(r,e,t,n){let i=e?MW(r):BW(r),o=re(Uint8Array.from(t),"ascii"),s=n(o,i);return Ie(s,"ascii")}function $W(r,e){return KW(r,!0,e,(t,n)=>n.encrypt(t))}function qW(r,e){return KW(r,!1,e,(t,n)=>n.decrypt(t))}var i3=class{constructor(e){B(this,"_key");this._key=e}async verify(e,t){return zW(this._key,t,e)}marshal(){return qh.jwkToPkix(this._key)}get bytes(){return Ua.encode({Type:Br.RSA,Data:this.marshal()}).subarray()}encrypt(e){return $W(this._key,e)}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}},om=class{constructor(e,t){B(this,"_key");B(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return Mc(16)}async sign(e){return FW(this._key,e)}get public(){if(this._publicKey==null)throw new J("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new i3(this._publicKey)}decrypt(e){return qW(this._key,e)}marshal(){return qh.jwkToPkcs1(this._key)}get bytes(){return Fa.encode({Type:Br.RSA,Data:this.marshal()}).subarray()}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}async id(){let e=await this.public.hash();return re(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){let n=new n3.default.util.ByteBuffer(this.marshal()),i=n3.default.asn1.fromDer(n),o=n3.default.pki.privateKeyFromAsn1(i),s={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return n3.default.pki.encryptRsaPrivateKey(o,e,s)}else{if(t==="libp2p-key")return j1(this.bytes,e);throw new J(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function iSe(r){let e=qh.pkcs1ToJwk(r),t=await FC(e);return new om(t.privateKey,t.publicKey)}function oSe(r){let e=qh.pkixToJwk(r);return new i3(e)}async function sSe(r){let e=await FC(r);return new om(e.privateKey,e.publicKey)}async function aSe(r){let e=await UW(r);return new om(e.privateKey,e.publicKey)}var KC={};xe(KC,{Secp256k1PrivateKey:()=>s3,Secp256k1PublicKey:()=>o3,generateKeyPair:()=>fSe,unmarshalSecp256k1PrivateKey:()=>uSe,unmarshalSecp256k1PublicKey:()=>lSe});function HW(){return ro.randomPrivateKey()}async function GW(r,e){let{digest:t}=await dt.digest(e);try{return await Wb(t,r)}catch(n){throw new J(String(n),"ERR_INVALID_INPUT")}}async function jW(r,e,t){try{let{digest:n}=await dt.digest(t);return Yb(e,n,r)}catch(n){throw new J(String(n),"ERR_INVALID_INPUT")}}function WW(r){return Kt.fromHex(r).toRawBytes(!0)}function YW(r){try{im(r,!0)}catch(e){throw new J(String(e),"ERR_INVALID_PRIVATE_KEY")}}function VC(r){try{Kt.fromHex(r)}catch(e){throw new J(String(e),"ERR_INVALID_PUBLIC_KEY")}}function QW(r){try{return im(r,!0)}catch(e){throw new J(String(e),"ERR_INVALID_PRIVATE_KEY")}}var o3=class{constructor(e){B(this,"_key");VC(e),this._key=e}async verify(e,t){return jW(this._key,t,e)}marshal(){return WW(this._key)}get bytes(){return Ua.encode({Type:Br.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}},s3=class{constructor(e,t){B(this,"_key");B(this,"_publicKey");this._key=e,this._publicKey=t??QW(e),YW(this._key),VC(this._publicKey)}async sign(e){return GW(this._key,e)}get public(){return new o3(this._publicKey)}marshal(){return this._key}get bytes(){return Fa.encode({Type:Br.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return mt(this.bytes,e.bytes)}async hash(){let{bytes:e}=await dt.digest(this.bytes);return e}async id(){let e=await this.public.hash();return re(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return j1(this.bytes,e);throw new J(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function uSe(r){return new s3(r)}function lSe(r){return new o3(r)}async function fSe(){let r=HW();return new s3(r)}var Uc={rsa:zC,ed25519:RC,secp256k1:KC};function $C(r){let e=Object.keys(Uc).join(" / ");return new J(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function qC(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return Uc[r];throw $C(r)}async function Xb(r,e){return qC(r).generateKeyPair(e??2048)}async function dSe(r,e,t){if(r.toLowerCase()!=="ed25519")throw new J("Seed key derivation is unimplemented for RSA or secp256k1","ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return IC(e)}function Bs(r){let e=Ua.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Br.RSA:return Uc.rsa.unmarshalRsaPublicKey(t);case Br.Ed25519:return Uc.ed25519.unmarshalEd25519PublicKey(t);case Br.Secp256k1:return Uc.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw $C(e.Type??"RSA")}}function a3(r,e){return e=(e??"rsa").toLowerCase(),qC(e),r.bytes}async function Li(r){let e=Fa.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Br.RSA:return Uc.rsa.unmarshalRsaPrivateKey(t);case Br.Ed25519:return Uc.ed25519.unmarshalEd25519PrivateKey(t);case Br.Secp256k1:return Uc.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw $C(e.Type??"RSA")}}function HC(r,e){return e=(e??"rsa").toLowerCase(),qC(e),r.bytes}async function c3(r,e){try{let i=await dW(r,e);return await Li(i)}catch{}let t=Qb.default.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new J("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=Qb.default.asn1.toDer(Qb.default.pki.privateKeyToAsn1(t));return n=Ie(n.getBytes(),"ascii"),Uc.rsa.unmarshalRsaPrivateKey(n)}var AP=C(ee(),1);var hm=C(ee(),1);var XW="ERR_IPNS_EXPIRED_RECORD",u3="ERR_UNRECOGNIZED_VALIDITY",ZW="ERR_SIGNATURE_CREATION",Yf="ERR_SIGNATURE_VERIFICATION",JW="ERR_UNRECOGNIZED_FORMAT";var GC="ERR_UNDEFINED_PARAMETER",eY="ERR_INVALID_RECORD_DATA",tY="ERR_INVALID_EMBEDDED_KEY",rY="ERR_MISSING_PRIVATE_KEY";var oP=C(XC(),1),xY=C(mY(),1),sP=C(iP(),1),SY=C(vY(),1),AY=C(Gh(),1);function bSe(){AY.default._configure(),oP.default._configure(xY.default),sP.default._configure(SY.default)}bSe();var TY=["uint64","int64","sint64","fixed64","sfixed64"];function _Se(r){for(let e of TY){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function aP(r){return _Se(new oP.default(r))}function ESe(r){for(let e of TY){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function cP(){return ESe(sP.default.create())}function uP(r,e){let t=aP(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function lP(r,e){let t=cP();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var sm;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(sm||(sm={}));function t_(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function fP(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(o,s){let a=e(o);s.int32(a)},n=function(o){let s=o.int32();return e(s)};return t_("enum",sm.VARINT,t,n)}function dP(r,e){return t_("message",sm.LENGTH_DELIMITED,r,e)}var mo;(function(r){let e;(function(i){i.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(i){i[i.EOL=0]="EOL"})(t||(t={})),function(i){i.codec=()=>fP(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=dP((i,o,s={})=>{s.lengthDelimited!==!1&&o.fork(),i.value!=null&&(o.uint32(10),o.bytes(i.value)),i.signature!=null&&(o.uint32(18),o.bytes(i.signature)),i.validityType!=null&&(o.uint32(24),r.ValidityType.codec().encode(i.validityType,o)),i.validity!=null&&(o.uint32(34),o.bytes(i.validity)),i.sequence!=null&&(o.uint32(40),o.uint64(i.sequence)),i.ttl!=null&&(o.uint32(48),o.uint64(i.ttl)),i.pubKey!=null&&(o.uint32(58),o.bytes(i.pubKey)),i.signatureV2!=null&&(o.uint32(66),o.bytes(i.signatureV2)),i.data!=null&&(o.uint32(74),o.bytes(i.data)),s.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let s={},a=o==null?i.len:i.pos+o;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:s.value=i.bytes();break;case 2:s.signature=i.bytes();break;case 3:s.validityType=r.ValidityType.codec().decode(i);break;case 4:s.validity=i.bytes();break;case 5:s.sequence=i.uint64();break;case 6:s.ttl=i.uint64();break;case 7:s.pubKey=i.bytes();break;case 8:s.signatureV2=i.bytes();break;case 9:s.data=i.bytes();break;default:i.skipType(c&7);break}}return s})),n),r.encode=i=>lP(i,r.codec()),r.decode=i=>uP(i,r.codec())})(mo||(mo={}));var vSe=["string","number","bigint","symbol"],xSe=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function IY(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(vSe.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(SSe(r))return"Buffer";let t=ASe(r);return t||"Object"}function SSe(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function ASe(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(xSe.includes(e))return e}var Z=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};Z.uint=new Z(0,"uint",!0);Z.negint=new Z(1,"negint",!0);Z.bytes=new Z(2,"bytes",!0);Z.string=new Z(3,"string",!0);Z.array=new Z(4,"array",!1);Z.map=new Z(5,"map",!1);Z.tag=new Z(6,"tag",!1);Z.float=new Z(7,"float",!0);Z.false=new Z(7,"false",!0);Z.true=new Z(7,"true",!0);Z.null=new Z(7,"null",!0);Z.undefined=new Z(7,"undefined",!0);Z.break=new Z(7,"break",!0);var Re=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var am=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",TSe=new TextDecoder,ISe=new TextEncoder;function r_(r){return am&&globalThis.Buffer.isBuffer(r)}function hP(r){return r instanceof Uint8Array?r_(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var kY=am?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):CY(r,e,t):(r,e,t)=>t-e>64?TSe.decode(r.subarray(e,t)):CY(r,e,t),NY=am?r=>r.length>64?globalThis.Buffer.from(r):RY(r):r=>r.length>64?ISe.encode(r):RY(r),zc=r=>Uint8Array.from(r),cm=am?(r,e,t)=>r_(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),DY=am?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),hP(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},OY=am?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function LY(r,e){if(r_(r)&&r_(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function RY(r,e=1/0){let t,n=r.length,i=null,o=[];for(let s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function CY(r,e,t){let n=[];for(;e<t;){let i=r[e],o=null,s=i>239?4:i>223?3:i>191?2:1;if(e+s<=t){let a,c,u,l;switch(s){case 1:i<128&&(o=i);break;case 2:a=r[e+1],(a&192)===128&&(l=(i&31)<<6|a&63,l>127&&(o=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(i&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(i&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(o=l))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=s}return RSe(n)}var PY=4096;function RSe(r){let e=r.length;if(e<=PY)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=PY));return t}var CSe=256,d3=class{constructor(e=CSe){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){let i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=OY(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=cm(n,0,this.cursor)}else t=DY(this.chunks,this.cursor);return e&&this.reset(),t}};var it="CBOR decode error:",pP="CBOR encode error:",h3=[];h3[23]=1;h3[24]=2;h3[25]=3;h3[26]=5;h3[27]=9;function il(r,e,t){if(r.length-e<t)throw new Error(`${it} not enough data for type`)}var ai=[24,256,65536,4294967296,BigInt("18446744073709551616")];function qo(r,e,t){il(r,e,1);let n=r[e];if(t.strict===!0&&n<ai[0])throw new Error(`${it} integer encoded in more bytes than necessary (strict decode)`);return n}function Ho(r,e,t){il(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<ai[1])throw new Error(`${it} integer encoded in more bytes than necessary (strict decode)`);return n}function Go(r,e,t){il(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<ai[2])throw new Error(`${it} integer encoded in more bytes than necessary (strict decode)`);return n}function jo(r,e,t){il(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&o<ai[3])throw new Error(`${it} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${it} integers outside of the safe integer range are not supported`)}function BY(r,e,t,n){return new Re(Z.uint,qo(r,e+1,n),2)}function MY(r,e,t,n){return new Re(Z.uint,Ho(r,e+1,n),3)}function UY(r,e,t,n){return new Re(Z.uint,Go(r,e+1,n),5)}function FY(r,e,t,n){return new Re(Z.uint,jo(r,e+1,n),9)}function Us(r,e){return wi(r,0,e.value)}function wi(r,e,t){if(t<ai[0]){let n=Number(t);r.push([e|n])}else if(t<ai[1]){let n=Number(t);r.push([e|24,n])}else if(t<ai[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<ai[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<ai[4]){let i=[e|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,r.push(i)}else throw new Error(`${it} encountered BigInt larger than allowable range`)}}Us.encodedSize=function(e){return wi.encodedSize(e.value)};wi.encodedSize=function(e){return e<ai[0]?1:e<ai[1]?2:e<ai[2]?3:e<ai[3]?5:9};Us.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function zY(r,e,t,n){return new Re(Z.negint,-1-qo(r,e+1,n),2)}function VY(r,e,t,n){return new Re(Z.negint,-1-Ho(r,e+1,n),3)}function KY(r,e,t,n){return new Re(Z.negint,-1-Go(r,e+1,n),5)}var mP=BigInt(-1),$Y=BigInt(1);function qY(r,e,t,n){let i=jo(r,e+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new Re(Z.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${it} integers outside of the safe integer range are not supported`);return new Re(Z.negint,mP-BigInt(i),9)}function n_(r,e){let t=e.value,n=typeof t=="bigint"?t*mP-$Y:t*-1-1;wi(r,e.type.majorEncoded,n)}n_.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*mP-$Y:t*-1-1;return n<ai[0]?1:n<ai[1]?2:n<ai[2]?3:n<ai[3]?5:9};n_.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function p3(r,e,t,n){il(r,e,t+n);let i=cm(r,e+t,e+t+n);return new Re(Z.bytes,i,t+n)}function HY(r,e,t,n){return p3(r,e,1,t)}function GY(r,e,t,n){return p3(r,e,2,qo(r,e+1,n))}function jY(r,e,t,n){return p3(r,e,3,Ho(r,e+1,n))}function WY(r,e,t,n){return p3(r,e,5,Go(r,e+1,n))}function YY(r,e,t,n){let i=jo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${it} 64-bit integer bytes lengths not supported`);return p3(r,e,9,i)}function i_(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===Z.string?NY(r.value):r.value),r.encodedBytes}function um(r,e){let t=i_(e);wi(r,e.type.majorEncoded,t.length),r.push(t)}um.encodedSize=function(e){let t=i_(e);return wi.encodedSize(t.length)+t.length};um.compareTokens=function(e,t){return kSe(i_(e),i_(t))};function kSe(r,e){return r.length<e.length?-1:r.length>e.length?1:LY(r,e)}function m3(r,e,t,n,i){let o=t+n;il(r,e,o);let s=new Re(Z.string,kY(r,e+t,e+o),o);return i.retainStringBytes===!0&&(s.byteValue=cm(r,e+t,e+o)),s}function QY(r,e,t,n){return m3(r,e,1,t,n)}function XY(r,e,t,n){return m3(r,e,2,qo(r,e+1,n),n)}function ZY(r,e,t,n){return m3(r,e,3,Ho(r,e+1,n),n)}function JY(r,e,t,n){return m3(r,e,5,Go(r,e+1,n),n)}function eQ(r,e,t,n){let i=jo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${it} 64-bit integer string lengths not supported`);return m3(r,e,9,i,n)}var tQ=um;function lm(r,e,t,n){return new Re(Z.array,n,t)}function rQ(r,e,t,n){return lm(r,e,1,t)}function nQ(r,e,t,n){return lm(r,e,2,qo(r,e+1,n))}function iQ(r,e,t,n){return lm(r,e,3,Ho(r,e+1,n))}function oQ(r,e,t,n){return lm(r,e,5,Go(r,e+1,n))}function sQ(r,e,t,n){let i=jo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${it} 64-bit integer array lengths not supported`);return lm(r,e,9,i)}function aQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${it} indefinite length items not allowed`);return lm(r,e,1,1/0)}function o_(r,e){wi(r,Z.array.majorEncoded,e.value)}o_.compareTokens=Us.compareTokens;o_.encodedSize=function(e){return wi.encodedSize(e.value)};function fm(r,e,t,n){return new Re(Z.map,n,t)}function cQ(r,e,t,n){return fm(r,e,1,t)}function uQ(r,e,t,n){return fm(r,e,2,qo(r,e+1,n))}function lQ(r,e,t,n){return fm(r,e,3,Ho(r,e+1,n))}function fQ(r,e,t,n){return fm(r,e,5,Go(r,e+1,n))}function dQ(r,e,t,n){let i=jo(r,e+1,n);if(typeof i=="bigint")throw new Error(`${it} 64-bit integer map lengths not supported`);return fm(r,e,9,i)}function hQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${it} indefinite length items not allowed`);return fm(r,e,1,1/0)}function s_(r,e){wi(r,Z.map.majorEncoded,e.value)}s_.compareTokens=Us.compareTokens;s_.encodedSize=function(e){return wi.encodedSize(e.value)};function pQ(r,e,t,n){return new Re(Z.tag,t,1)}function mQ(r,e,t,n){return new Re(Z.tag,qo(r,e+1,n),2)}function gQ(r,e,t,n){return new Re(Z.tag,Ho(r,e+1,n),3)}function yQ(r,e,t,n){return new Re(Z.tag,Go(r,e+1,n),5)}function wQ(r,e,t,n){return new Re(Z.tag,jo(r,e+1,n),9)}function a_(r,e){wi(r,Z.tag.majorEncoded,e.value)}a_.compareTokens=Us.compareTokens;a_.encodedSize=function(e){return wi.encodedSize(e.value)};var MSe=20,USe=21,FSe=22,zSe=23;function bQ(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${it} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Re(Z.null,null,1):new Re(Z.undefined,void 0,1)}function _Q(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${it} indefinite length items not allowed`);return new Re(Z.break,void 0,1)}function gP(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${it} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${it} Infinity values are not supported`)}return new Re(Z.float,r,e)}function EQ(r,e,t,n){return gP(yP(r,e+1),3,n)}function vQ(r,e,t,n){return gP(wP(r,e+1),5,n)}function xQ(r,e,t,n){return gP(IQ(r,e+1),9,n)}function c_(r,e,t){let n=e.value;if(n===!1)r.push([Z.float.majorEncoded|MSe]);else if(n===!0)r.push([Z.float.majorEncoded|USe]);else if(n===null)r.push([Z.float.majorEncoded|FSe]);else if(n===void 0)r.push([Z.float.majorEncoded|zSe]);else{let i,o=!1;(!t||t.float64!==!0)&&(AQ(n),i=yP(qa,1),n===i||Number.isNaN(n)?(qa[0]=249,r.push(qa.slice(0,3)),o=!0):(TQ(n),i=wP(qa,1),n===i&&(qa[0]=250,r.push(qa.slice(0,5)),o=!0))),o||(VSe(n),i=IQ(qa,1),qa[0]=251,r.push(qa.slice(0,9)))}}c_.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){AQ(n);let i=yP(qa,1);if(n===i||Number.isNaN(n))return 3;if(TQ(n),i=wP(qa,1),n===i)return 5}return 9};var SQ=new ArrayBuffer(9),Fs=new DataView(SQ,1),qa=new Uint8Array(SQ,0);function AQ(r){if(r===1/0)Fs.setUint16(0,31744,!1);else if(r===-1/0)Fs.setUint16(0,64512,!1);else if(Number.isNaN(r))Fs.setUint16(0,32256,!1);else{Fs.setFloat32(0,r);let e=Fs.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Fs.setUint16(0,31744,!1);else if(t===0)Fs.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let i=t-127;i<-24?Fs.setUint16(0,0):i<-14?Fs.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Fs.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function yP(r,e){if(r.length-e<2)throw new Error(`${it} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,i=t&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,t&32768?-o:o}function TQ(r){Fs.setFloat32(0,r,!1)}function wP(r,e){if(r.length-e<4)throw new Error(`${it} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function VSe(r){Fs.setFloat64(0,r,!1)}function IQ(r,e){if(r.length-e<8)throw new Error(`${it} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}c_.compareTokens=Us.compareTokens;function tr(r,e,t){throw new Error(`${it} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function u_(r){return()=>{throw new Error(`${it} ${r}`)}}var me=[];for(let r=0;r<=23;r++)me[r]=tr;me[24]=BY;me[25]=MY;me[26]=UY;me[27]=FY;me[28]=tr;me[29]=tr;me[30]=tr;me[31]=tr;for(let r=32;r<=55;r++)me[r]=tr;me[56]=zY;me[57]=VY;me[58]=KY;me[59]=qY;me[60]=tr;me[61]=tr;me[62]=tr;me[63]=tr;for(let r=64;r<=87;r++)me[r]=HY;me[88]=GY;me[89]=jY;me[90]=WY;me[91]=YY;me[92]=tr;me[93]=tr;me[94]=tr;me[95]=u_("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)me[r]=QY;me[120]=XY;me[121]=ZY;me[122]=JY;me[123]=eQ;me[124]=tr;me[125]=tr;me[126]=tr;me[127]=u_("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)me[r]=rQ;me[152]=nQ;me[153]=iQ;me[154]=oQ;me[155]=sQ;me[156]=tr;me[157]=tr;me[158]=tr;me[159]=aQ;for(let r=160;r<=183;r++)me[r]=cQ;me[184]=uQ;me[185]=lQ;me[186]=fQ;me[187]=dQ;me[188]=tr;me[189]=tr;me[190]=tr;me[191]=hQ;for(let r=192;r<=215;r++)me[r]=pQ;me[216]=mQ;me[217]=gQ;me[218]=yQ;me[219]=wQ;me[220]=tr;me[221]=tr;me[222]=tr;me[223]=tr;for(let r=224;r<=243;r++)me[r]=u_("simple values are not supported");me[244]=tr;me[245]=tr;me[246]=tr;me[247]=bQ;me[248]=u_("simple values are not supported");me[249]=EQ;me[250]=vQ;me[251]=xQ;me[252]=tr;me[253]=tr;me[254]=tr;me[255]=_Q;var Ha=[];for(let r=0;r<24;r++)Ha[r]=new Re(Z.uint,r,1);for(let r=-1;r>=-24;r--)Ha[31-r]=new Re(Z.negint,r,1);Ha[64]=new Re(Z.bytes,new Uint8Array(0),1);Ha[96]=new Re(Z.string,"",1);Ha[128]=new Re(Z.array,0,1);Ha[160]=new Re(Z.map,0,1);Ha[244]=new Re(Z.false,!1,1);Ha[245]=new Re(Z.true,!0,1);Ha[246]=new Re(Z.null,null,1);function RQ(r){switch(r.type){case Z.false:return zc([244]);case Z.true:return zc([245]);case Z.null:return zc([246]);case Z.bytes:return r.value.length?void 0:zc([64]);case Z.string:return r.value===""?zc([96]):void 0;case Z.array:return r.value===0?zc([128]):void 0;case Z.map:return r.value===0?zc([160]):void 0;case Z.uint:return r.value<24?zc([Number(r.value)]):void 0;case Z.negint:if(r.value>=-24)return zc([31-Number(r.value)])}}var $Se={float64:!1,mapSorter:GSe,quickEncodeToken:RQ};function qSe(){let r=[];return r[Z.uint.major]=Us,r[Z.negint.major]=n_,r[Z.bytes.major]=um,r[Z.string.major]=tQ,r[Z.array.major]=o_,r[Z.map.major]=s_,r[Z.tag.major]=a_,r[Z.float.major]=c_,r}var CQ=qSe(),bP=new d3,dm=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${pP} object contains circular references`);return new dm(t,e)}},Zf={null:new Re(Z.null,null),undefined:new Re(Z.undefined,void 0),true:new Re(Z.true,!0),false:new Re(Z.false,!1),emptyArray:new Re(Z.array,0),emptyMap:new Re(Z.map,0)},Jf={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new Re(Z.float,r):r>=0?new Re(Z.uint,r):new Re(Z.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new Re(Z.uint,r):new Re(Z.negint,r)},Uint8Array(r,e,t,n){return new Re(Z.bytes,r)},string(r,e,t,n){return new Re(Z.string,r)},boolean(r,e,t,n){return r?Zf.true:Zf.false},null(r,e,t,n){return Zf.null},undefined(r,e,t,n){return Zf.undefined},ArrayBuffer(r,e,t,n){return new Re(Z.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new Re(Z.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[Zf.emptyArray,new Re(Z.break)]:Zf.emptyArray;n=dm.createCheck(n,r);let i=[],o=0;for(let s of r)i[o++]=l_(s,t,n);return t.addBreakTokens?[new Re(Z.array,r.length),i,new Re(Z.break)]:[new Re(Z.array,r.length),i]},Object(r,e,t,n){let i=e!=="Object",o=i?r.keys():Object.keys(r),s=i?r.size:o.length;if(!s)return t.addBreakTokens===!0?[Zf.emptyMap,new Re(Z.break)]:Zf.emptyMap;n=dm.createCheck(n,r);let a=[],c=0;for(let u of o)a[c++]=[l_(u,t,n),l_(i?r.get(u):r[u],t,n)];return HSe(a,t),t.addBreakTokens?[new Re(Z.map,s),a,new Re(Z.break)]:[new Re(Z.map,s),a]}};Jf.Map=Jf.Object;Jf.Buffer=Jf.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Jf[`${r}Array`]=Jf.DataView;function l_(r,e={},t){let n=IY(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||Jf[n];if(typeof i=="function"){let s=i(r,n,e,t);if(s!=null)return s}let o=Jf[n];if(!o)throw new Error(`${pP} unsupported type: ${n}`);return o(r,n,e,t)}function HSe(r,e){e.mapSorter&&r.sort(e.mapSorter)}function GSe(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let i=t.type.major,o=CQ[i].compareTokens(t,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function PQ(r,e,t,n){if(Array.isArray(e))for(let i of e)PQ(r,i,t,n);else t[e.type.major](r,e,n)}function jSe(r,e,t){let n=l_(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let i=t.quickEncodeToken(n);if(i)return i;let o=e[n.type.major];if(o.encodedSize){let s=o.encodedSize(n,t),a=new d3(s);if(o(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return hP(a.chunks[0])}}return bP.reset(),PQ(bP,n,e,t),bP.toBytes(!0)}function _P(r,e){return e=Object.assign({},$Se,e),jSe(r,CQ,e)}var WSe={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},EP=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Ha[e];if(t===void 0){let n=me[e];if(!n)throw new Error(`${it} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}},g3=Symbol.for("DONE"),f_=Symbol.for("BREAK");function YSe(r,e,t){let n=[];for(let i=0;i<r.value;i++){let o=y3(e,t);if(o===f_){if(r.value===1/0)break;throw new Error(`${it} got unexpected break to lengthed array`)}if(o===g3)throw new Error(`${it} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=o}return n}function QSe(r,e,t){let n=t.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=y3(e,t);if(a===f_){if(r.value===1/0)break;throw new Error(`${it} got unexpected break to lengthed map`)}if(a===g3)throw new Error(`${it} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${it} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${it} found repeat map key "${a}"`);let c=y3(e,t);if(c===g3)throw new Error(`${it} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?o.set(a,c):i[a]=c}return n?o:i}function y3(r,e){if(r.done())return g3;let t=r.next();if(t.type===Z.break)return f_;if(t.type.terminal)return t.value;if(t.type===Z.array)return YSe(t,r,e);if(t.type===Z.map)return QSe(t,r,e);if(t.type===Z.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=y3(r,e);return e.tags[t.value](n)}throw new Error(`${it} tag not supported (${t.value})`)}throw new Error("unsupported")}function vP(r,e){if(!(r instanceof Uint8Array))throw new Error(`${it} data to decode must be a Uint8Array`);e=Object.assign({},WSe,e);let t=e.tokenizer||new EP(r,e),n=y3(t,e);if(n===g3)throw new Error(`${it} did not find any content to decode`);if(n===f_)throw new Error(`${it} got unexpected break`);if(!t.done())throw new Error(`${it} too many terminals, data makes no sense`);return n}var kQ=j("ipns:utils"),NQ=Ie("/ipns/");function w3(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,o=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,o,s,a,c,u))}var DQ=async(r,e)=>{if(e==null||r==null){let n=new Error("one or more of the provided parameters are not defined");throw kQ.error(n),(0,hm.default)(n,GC)}let t;if(e.pubKey!=null){try{t=Bs(e.pubKey)}catch(i){throw kQ.error(i),i}if(!(await Hn(e.pubKey)).equals(r))throw(0,hm.default)(new Error("Embedded public key did not match PeerID"),tY)}else r.publicKey!=null&&(t=Bs(r.publicKey));if(t!=null)return t;throw(0,hm.default)(new Error("no public key is available"),GC)},OQ=(r,e,t)=>{let n=Ie(e);return rt([r,t,n])},d_=r=>{let e=Ie("ipns-signature:");return rt([e,r])},xP=r=>mo.encode(r),ol=r=>{let e=mo.decode(r);return e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??mo.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}},ed=r=>rt([NQ,r.toBytes()]),SP=r=>Di(r.slice(NQ.length)),LQ=(r,e,t,n,i)=>{let o;if(t===mo.ValidityType.EOL)o=0;else throw(0,hm.default)(new Error("Unknown validity type"),u3);return _P({Value:r,Validity:e,ValidityType:o,Sequence:n,TTL:i})},BQ=r=>{let e=vP(r);if(e.ValidityType===0)e.ValidityType=mo.ValidityType.EOL;else throw(0,hm.default)(new Error("Unknown validity type"),u3);return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e};var UQ=j("ipns"),ZSe=Ii.code,b3="/ipns/",h_=b3.length,FQ=async(r,e,t,n)=>{let i=new MQ.default(Date.now()+Number(n)),o=mo.ValidityType.EOL,[s,a]=n.toString().split("."),c=BigInt(s)*BigInt(1e5)+BigInt(a??"0");return await JSe(r,e,t,o,i,c)};var JSe=async(r,e,t,n,i,o)=>{t=BigInt(t);let s=Ie(i.toString());if(r.privateKey==null)throw(0,AP.default)(new Error("Missing private key"),rY);let a=await Li(r.privateKey),c=await tAe(a,e,n,s),u=LQ(e,s,n,t,o),l=d_(u),f=await a.sign(l),h={value:e,signature:c,validityType:n,validity:s,sequence:t,ttl:o,signatureV2:f,data:u};if(r.publicKey!=null){let d=Ea(r.toBytes());(d.code!==ZSe||!mt(r.publicKey,d.digest))&&(h.pubKey=r.publicKey)}return UQ("ipns entry for %b created",e),h},eAe=r=>uA.encode(r).slice(1),_3=r=>new pe(`/ipns/${eAe(r)}`),tAe=async(r,e,t,n)=>{try{let i=OQ(e,t,n);return await r.sign(i)}catch(i){throw UQ.error("record signature creation failed",i),(0,AP.default)(new Error("record signature creation failed"),ZW)}};var zs=j("ipfs:ipns:publisher"),zQ=Gn().code,VQ=60*60*1e3,Yh=class{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,i){let o=await this._updateOrCreateRecord(e,t,n,i);return this._putRecordToRouting(o,e,i)}publish(e,t,n){return this.publishWithEOL(e,t,VQ,n)}async _putRecordToRouting(e,t,n){if(!Lf(t)){let o="peerId received is not valid";throw zs.error(o),(0,Vs.default)(new Error(o),"ERR_INVALID_PEER_ID")}if(t.publicKey==null)throw(0,Vs.default)(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");let i=ed(t);return await this._publishEntry(i,e,n),e}async _publishEntry(e,t,n){try{let i=await this._routing.put(e,t,n);return zs(`ipns record for ${re(e,"base32")} was stored in the routing`),i}catch(i){let o=`ipns record for ${re(e,"base32")} could not be stored in the routing - ${i.stack}`;throw zs.error(o),zs.error(i),(0,Vs.default)(new Error(o),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!Lf(e)){let i="peerId received is not valid";throw zs.error(i),(0,Vs.default)(new Error(i),"ERR_INVALID_PEER_ID")}let n=t.checkRouting!==!1;try{let i=await this._datastore.get(_3(e.toBytes()));return this._unmarshalData(i)}catch(i){if(i.code!==zQ){let o=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw zs.error(o),(0,Vs.default)(new Error(o),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw(0,Vs.default)(i,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{let o=ed(e),s=await this._routing.get(o);return this._unmarshalData(s)}catch(o){throw zs.error(o),o}}}_unmarshalData(e){try{return ol(e)}catch(t){throw(0,Vs.default)(t,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,i){if(!Lf(e)){let u="peerId received is not valid";throw zs.error(u),(0,Vs.default)(new Error(u),"ERR_INVALID_PEER_ID")}let o={checkRouting:!0},s;try{s=await this._getPublished(e,o)}catch(u){if(u.code!==zQ){let l=`unexpected error when determining the last published IPNS record for ${e.toString()} ${u.stack}`;throw zs.error(l),(0,Vs.default)(new Error(l),"ERR_DETERMINING_PUBLISHED_RECORD")}}let a=0n;s&&s.sequence!==void 0&&(a=mt(s.value,t)?s.sequence:s.sequence+BigInt(1));let c;try{c=await FQ(e,t,a,n)}catch(u){let l=`ipns record for ${t} could not be created`;throw zs.error(u),(0,Vs.default)(new Error(l),"ERR_CREATING_IPNS_RECORD")}try{let u=xP(c);return await this._datastore.put(_3(e.toBytes()),u,i),zs(`ipns record for ${re(t,"base32")} was stored in the datastore`),u}catch{let l=`ipns record for ${t} could not be stored in the datastore`;throw zs.error(l),(0,Vs.default)(new Error(l),"ERR_STORING_IN_DATASTORE")}}};Yh.defaultRecordLifetime=VQ;var Qh=C(ee(),1);var KQ=C(Kn(),1),p_=j("ipfs:ipns:republisher"),$Q=60*1e3,qQ=60*$Q,rAe=4*qQ,nAe=24*qQ,m_=class{constructor(e,t,n,i,o={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=i,this._options=o,this._republishHandle=null}async start(){if(this._republishHandle)throw(0,Qh.default)(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");let e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:i=>{e._timeoutId=setTimeout(async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(i)}catch(o){p_.error(o)}},i())},cancel:async()=>{e._timeoutId!=null&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options,n=!0;e._task=async()=>{let i=new KQ.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:i.signal})}finally{i.clear()}},e.runPeriodically(()=>n?(n=!1,this._options.initialBroadcastInterval||$Q):this._options.broadcastInterval||rAe),this._republishHandle=e}async stop(){let e=this._republishHandle;if(!e)throw(0,Qh.default)(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch{let o="cannot republish entry for the node's private key";p_.error(o);return}if(t)try{let i=await this._keychain.listKeys();for(let o of i){if(o.name==="self")continue;let s=await this._keychain.exportKey(o.name,t),a=await c3(s,t),c=await Hn(a.public.bytes,a.bytes);await this._republishEntry(c,n)}}catch(i){p_.error(i)}}async _republishEntry(e,t){try{let n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,nAe,t)}catch(n){if(n.code==="ERR_NO_ENTRY_FOUND")return;throw n}}async _getPreviousValue(e){if(!Lf(e))throw(0,Qh.default)(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{let t=await this._datastore.get(_3(e.toBytes()));if(!(t instanceof Uint8Array))throw(0,Qh.default)(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return ol(t).value}catch(n){throw p_.error(n),(0,Qh.default)(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){throw t&&t.notFound?(0,Qh.default)(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND"):t}}};var mm=C(ee(),1);var Ks=C(ee(),1);var E3=j("ipns:validator"),iAe=async(r,e)=>{let{value:t,validityType:n,validity:i}=e,o,s;if(e.signatureV2!=null&&e.data!=null)s=e.signatureV2,o=d_(e.data),oAe(e);else throw(0,Ks.default)(new Error("missing data or signatureV2"),Yf);let a;try{a=await r.verify(o,s)}catch{a=!1}if(!a)throw E3.error("record signature verification failed"),(0,Ks.default)(new Error("record signature verification failed"),Yf);if(i!=null&&n===mo.ValidityType.EOL){let c;try{c=w3(re(i))}catch{throw E3.error("unrecognized validity format (not an rfc3339 format)"),(0,Ks.default)(new Error("unrecognized validity format (not an rfc3339 format)"),JW)}if(c.getTime()<Date.now())throw E3.error("record has expired"),(0,Ks.default)(new Error("record has expired"),XW)}else if(n!=null)throw E3.error("unrecognized validity type"),(0,Ks.default)(new Error("unrecognized validity type"),u3);E3("ipns entry for %b is valid",t)},oAe=r=>{if(r.data==null)throw(0,Ks.default)(new Error("Record data is missing"),eY);let e=BQ(r.data);if(!mt(e.Value,r.value))throw(0,Ks.default)(new Error('Field "value" did not match between protobuf and CBOR'),Yf);if(!mt(e.Validity,r.validity))throw(0,Ks.default)(new Error('Field "validity" did not match between protobuf and CBOR'),Yf);if(e.ValidityType!==r.validityType)throw(0,Ks.default)(new Error('Field "validityType" did not match between protobuf and CBOR'),Yf);if(e.Sequence!==r.sequence)throw(0,Ks.default)(new Error('Field "sequence" did not match between protobuf and CBOR'),Yf);if(e.TTL!==r.ttl)throw(0,Ks.default)(new Error('Field "ttl" did not match between protobuf and CBOR'),Yf)},pm=async(r,e)=>{let t=SP(r),n=ol(e),i=await DQ(t,n);await iAe(i,n)};var IP=j("ipfs:ipns:resolver"),sAe=Gn().code,HQ=32,g_=class{constructor(e){this._routing=e}async resolve(e,t={}){if(typeof e!="string")throw(0,mm.default)(new Error("invalid name"),"ERR_INVALID_NAME");let n=t.recursive&&t.recursive.toString()==="true",i=e.split("/");if(i.length!==3||i[0]!=="")throw(0,mm.default)(new Error("invalid name"),"ERR_INVALID_NAME");let o=i[2],s=1/0;n&&(s=HQ);let a=await this.resolver(o,s,t);return IP(`${e} was locally resolved correctly`),a}async resolver(e,t,n){if(t===0){let s=`could not resolve name (recursion limit of ${HQ} exceeded)`;throw IP.error(s),(0,mm.default)(new Error(s),"ERR_RESOLVE_RECURSION_LIMIT")}let i=await this._resolveName(e,n),o=i.split("/");return o[1]==="ipfs"||!t?i:this.resolver(o[2],t-1,n)}async _resolveName(e,t){let n=Oe(e),i=ed(n),o;try{o=await this._routing.get(i,t)}catch(s){throw IP.error("could not get record from routing",s),s.code===sAe?(0,mm.default)(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND"):(0,mm.default)(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,o)}async _validateRecord(e,t){await pm(rt([Ie("/ipns/"),e.toBytes()]),t);let n=ol(t);return re(n.value)}};var GQ=C(Cy(),1),y_=class{constructor(e){this.lru=(0,GQ.default)(e)}get(e){let t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var v3=j("ipfs:ipns"),jQ=60*1e3,x3=class{constructor(e,t,n,i,o){this.publisher=new Yh(e,t),this.republisher=new m_(this.publisher,t,n,i,o),this.resolver=new g_(e),this.cache=new y_(1e3),this.routing=e}async publish(e,t,n=Yh.defaultRecordLifetime,i){try{await this.publisher.publishWithEOL(e,t,n,i),v3(`IPNS value ${re(t,"base32")} was published correctly`);let o=e.toString(),s=parseFloat(n),a=s<jQ?s:jQ;return this.cache.set(o,t,a),v3(`IPNS value ${re(t,"base32")} was cached correctly`),{name:o,value:t}}catch(o){throw v3.error(o),o}}async resolve(e,t={}){if(typeof e!="string")throw(0,WQ.default)(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){let n=e.split("/")[2],i=this.cache.get(n);if(i)return i}try{let n=await this.resolver.resolve(e,t);return v3(`IPNS record from ${e} was resolved correctly`),n}catch(n){throw v3.error(n),n}}async initializeKeyspace(e,t,n){return this.publish(e,t,Yh.defaultRecordLifetime,n)}};async function Wo(r){let e=[];for await(let t of r)e.push(t);return e}var w_=(r,e)=>async function*(){yield*(await Wo(r)).sort(e)}();async function on(r){for await(let e of r);}async function*Yt(r,e){for await(let t of r)await e(t)&&(yield t)}async function*Ga(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}}var go=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await on(this.putMany(e,n)),e=[],await on(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=Yt(n,i=>i.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>Yt(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>w_(i,o),n)),e.offset!=null){let i=0;n=Yt(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ga(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=Yt(n,i=>i.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>Yt(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>w_(i,o),n)),e.offset!=null){let i=0;n=Yt(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ga(n,e.limit)),n}};var Vc=C($s(),1);Vc.default.formatters.b=r=>r==null?"undefined":tt.baseEncode(r);Vc.default.formatters.t=r=>r==null?"undefined":Ot.baseEncode(r);Vc.default.formatters.m=r=>r==null?"undefined":wh.baseEncode(r);Vc.default.formatters.p=r=>r==null?"undefined":r.toString();Vc.default.formatters.c=r=>r==null?"undefined":r.toString();Vc.default.formatters.k=r=>r==null?"undefined":r.toString();function ue(r){return Object.assign((0,Vc.default)(r),{error:(0,Vc.default)(`${r}:error`),trace:(0,Vc.default)(`${r}:trace`)})}var E_=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},bm=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new E_(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new E_(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function jn(r={}){return bAe(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function bAe(r,e){e=e??{};let t=e.onEnd,n=new bm,i,o,s,a=async()=>n.isEmpty()?s?{done:!0}:await new Promise((g,w)=>{o=_=>{o=null,n.push(_);try{g(r(n))}catch(x){w(x)}return i}}):r(n),c=g=>o!=null?o(g):(n.push(g),i),u=g=>(n=new bm,o!=null?o({error:g}):(n.push({error:g}),i)),l=g=>{if(s)return i;if((e==null?void 0:e.objectMode)!==!0&&(g==null?void 0:g.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:g})},f=g=>s?i:(s=!0,g!=null?u(g):c({done:!0})),h=()=>(n=new bm,f(),{done:!0}),d=g=>(f(g),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:h,throw:d,push:l,end:f,get readableLength(){return n.size}},t==null)return i;let p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(g){return p.throw(g),t!=null&&(t(g),t=void 0),{done:!0}},return(){return p.return(),t!=null&&(t(),t=void 0),{done:!0}},push:l,end(g){return p.end(g),t!=null&&(t(g),t=void 0),i},get readableLength(){return p.readableLength}},i}var _Ae=ue("datastore:core:tiered"),S3=class extends go{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map(e=>e.open()))}catch(e){throw cb(e)}}async put(e,t,n){try{await Promise.all(this.stores.map(i=>i.put(e,t,n)))}catch(i){throw lb(i)}}async get(e,t){for(let n of this.stores)try{let i=await n.get(e,t);if(i)return i}catch(i){_Ae.error(i)}throw Gn()}async has(e,t){for(let n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map(n=>n.delete(e,t)))}catch(n){throw ub(n)}}async*putMany(e,t={}){let n,i=this.stores.map(o=>{let s=jn({objectMode:!0});return on(o.putMany(s,t)).catch(a=>{n=a}),s});try{for await(let o of e){if(n)throw n;i.forEach(s=>s.push(o)),yield o}}finally{i.forEach(o=>o.end())}}async*deleteMany(e,t={}){let n,i=this.stores.map(o=>{let s=jn({objectMode:!0});return on(o.deleteMany(s,t)).catch(a=>{n=a}),s});try{for await(let o of e){if(n)throw n;i.forEach(s=>s.push(o)),yield o}}finally{i.forEach(o=>o.end())}}async close(){await Promise.all(this.stores.map(e=>e.close()))}batch(){let e=this.stores.map(t=>t.batch());return{put:(t,n)=>{e.forEach(i=>i.put(t,n))},delete:t=>{e.forEach(n=>n.delete(t))},commit:async t=>{for(let n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}};var R3=C(v_(),1);var x_=(r,e)=>{let t=e.map((n,i)=>({entry:mo.decode(n),index:i}));return t.sort((n,i)=>{if(n.entry.signatureV2!=null&&i.entry.signatureV2==null)return-1;if(n.entry.signatureV2==null&&i.entry.signatureV2!=null)return 1;let o=n.entry.sequence??0n,s=i.entry.sequence??0n;if(o>s)return-1;if(o<s)return 1;let a=n.entry.validity??new Uint8Array(0),c=i.entry.validity??new Uint8Array(0),u=w3(re(a)),l=w3(re(c));return u.getTime()>l.getTime()?-1:u.getTime()<l.getTime()?1:0}),t[0].index};var JQ="SHARDING",eX="_README";var A3=class extends go{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw Gn();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new pe(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new pe(e))}};async function*Bi(r,e){for await(let t of r)yield e(t)}async function*Qo(...r){let e=jn({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}var xAe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},tX=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),PP=r=>r!=null&&typeof r.sink=="function"&&tX(r.source),SAe=r=>e=>{let t=r.sink(e);if(t.then!=null){let n=jn({objectMode:!0});return t.then(()=>{n.end()},o=>{n.end(o)}),Qo(n,async function*(){yield*r.source,n.end()}())}return r.source};function Ne(r,...e){if(PP(r)){let n=r;r=()=>n.source}else if(tX(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&PP(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)PP(t[n])&&(t[n]=SAe(t[n]));return xAe(...t)}var Yut=new pe(JQ),Qut=new pe(eX);var We=class extends Error{constructor(e,t,n){super(e),this.code=t,this.name=(n==null?void 0:n.name)??"CodeError",this.props=n??{}}};var S_="/record/";function kP(r){return Ee(r,"base32")}function T3(r){(typeof r=="string"||r instanceof String)&&(r=fe(r.toString()));let e=Ee(r,"base64url");return`${S_}${e}`}function nX(r){if(r.substring(0,S_.length)!==S_)throw new We("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");let e=r.substring(S_.length);return fe(e,"base64url")}function rr(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var bi=ue("datastore-pubsub:publisher"),A_=class extends go{constructor(e,t,n,i,o,s){if(super(),!i)throw new We("missing validator","ERR_INVALID_PARAMETERS");if(typeof i!="function")throw new We("missing validate function","ERR_INVALID_PARAMETERS");if(typeof o!="function")throw new We("missing select function","ERR_INVALID_PARAMETERS");if(s&&typeof s!="function")throw new We("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=i,this._selector=o,this._handleSubscriptionKeyFn=s,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){let o="datastore key does not have a valid format";throw bi.error(o),new We(o,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){let o="received value is not a Uint8Array";throw bi.error(o),new We(o,"ERR_INVALID_VALUE_RECEIVED")}let i=T3(e);bi(`publish value for topic ${i}`),await this._pubsub.publish(i,t)}async get(e,t){if(!(e instanceof Uint8Array)){let o="datastore key does not have a valid format";throw bi.error(o),new We(o,"ERR_INVALID_DATASTORE_KEY")}let n=T3(e),i=await this._pubsub.getTopics();if(i&&Array.isArray(i)&&i.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch{let s=`cannot subscribe topic ${n}`;throw bi.error(s),new We(s,"ERR_SUBSCRIBING_TOPIC")}return bi(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){let t=T3(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){let n=new pe("/"+kP(e),!1),i;try{i=await this._datastore.get(n,t)}catch(o){if(o.code!=="ERR_NOT_FOUND"){let a=`unexpected error getting the ipns record for ${n.toString()}`;throw bi.error(a),new We(a,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}let s=`local record requested was not found for ${n.toString()}`;throw bi.error(s),new We(s,"ERR_NOT_FOUND")}if(!(i instanceof Uint8Array)){let o="found record that we couldn't convert to a value";throw bi.error(o),new We(o,"ERR_INVALID_RECORD_RECEIVED")}return i}async _onMessage(e){let t=e.detail;if(t.type!=="signed"){bi.error("unsigned message received, this module can only work with signed messages");return}let{data:n,from:i,topic:o}=t,s;try{s=nX(o)}catch(a){bi.error(a);return}if(bi(`message received for topic ${o}`),this._peerId.equals(i)){bi("message discarded as it is from the same peer");return}if(this._handleSubscriptionKeyFn){let a;try{a=await this._handleSubscriptionKeyFn(s)}catch{bi.error("message discarded by the subscriptionKeyFn");return}s=a}try{await this._storeIfSubscriptionIsBetter(s,n)}catch(a){bi.error(a)}}async _storeIfSubscriptionIsBetter(e,t,n){let i=!1;try{i=await this._isBetter(e,t)}catch(o){if(o.code!=="ERR_NOT_VALID_RECORD")throw o}i&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return await this._selector(e,t)===0}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch{let s="record received through pubsub is not valid";throw bi.error(s),new We(s,"ERR_NOT_VALID_RECORD")}let n=new pe(e),i;try{i=await this._getLocal(n.uint8Array())}catch{return!0}return rr(i,t)?!1:this._selectRecord(e,[i,t])}async _storeRecord(e,t,n){let i=new pe("/"+kP(e),!1);await this._datastore.put(i,t,n),bi(`record for ${T3(e)} was stored in the datastore`)}};var NP=C(ee(),1);var T_=j("ipfs:ipns:pubsub"),Zh=class{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new A_(e,t,n,pm,x_,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(i){throw T_.error(i),i}}async get(e,t){let n,i;try{n=await this._pubsubDs.get(e,t)}catch(s){i=s}let o=e.slice(0,h_);if(re(o)===b3){let s=pr.encode(e).substring(1),a=pr.encode(e.slice(h_)).substring(1);this._subscriptions[s]=a,T_(`subscribed to pubsub topic ${s}, id ${a}`)}if(i)throw i;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=re(e,"base58btc"));let t=this._subscriptions[e];if(!t)throw(0,NP.default)(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return ed(Oe(t))}catch(n){throw T_.error(n),n}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map(t=>`${b3}${t}`)}async cancel(e){if(typeof e!="string")throw(0,NP.default)(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(b3)&&(e=e.substring(h_));let t=Object.keys(this._subscriptions).find(i=>this._subscriptions[i]===e);if(!t)return{canceled:!1};let n=Ie(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],T_(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}};var I3;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(I3||(I3={}));function iX(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),o=String(r.getUTCMinutes()).padStart(2,"0"),s=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${o}:${s}.${c}Z`}function oX(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),i=parseInt(t[2],10)-1,o=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,o,s,a,c,u))}var Yr=class{constructor(e,t,n){B(this,"key");B(this,"value");B(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return I3.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:iX(this.timeReceived)}}static deserialize(e){let t=I3.decode(e);return new Yr(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=oX(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Yr(e.key,e.value,t)}};var _m=C(ee(),1);var DP=j("ipfs:ipns:offline-datastore"),Em=class{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw(0,_m.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw(0,_m.default)(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let i;try{i=this._routingKey(e)}catch(s){throw DP.error(s),(0,_m.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let o=new Yr(e,t,new Date);await this._datastore.put(i,o.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw(0,_m.default)(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(s){throw DP.error(s),(0,_m.default)(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}let i=await this._datastore.get(n,t),o;try{o=Yr.deserialize(i)}catch(s){throw DP.error(s),s}return o.value}_routingKey(e){return new pe("/dht/record/"+re(e,"base32"),!1)}};async function sl(r){for await(let e of r);}var TAe=j("ipfs:ipns:dht-datastore"),I_=class{constructor(e){this._dht=e}async put(e,t,n){try{await sl(this._dht.put(e,t,n))}catch(i){throw TAe.error(i),i}}async get(e,t){for await(let n of this._dht.get(e,t))if(n.name==="VALUE")return n.value;throw Gn()}};function sX({libp2p:r,repo:e,peerId:t,options:n}){let i=[],o;if((0,R3.default)(n,"EXPERIMENTAL.ipnsPubsub",!1)&&(o=new Zh(r.pubsub,e.datastore,t),i.push(o)),(0,R3.default)(n,"offline",!1)!==!0&&["dht","dhtclient","dhtserver"].includes((0,R3.default)(n,"config.Routing.Type","none"))&&i.push(new I_(r.dht)),(0,R3.default)(n,"offline",!1)||i.length===0){let s=new Em(e.datastore);i.push(s)}return new S3(i)}var IAe=j("ipfs:components:ipns"),R_=class{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){let e=this.online||this.offline;if(e)return e;throw new Ku}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(this.offline!=null)throw new ka;IAe("initializing IPNS keyspace (offline)");let i=new Em(e.datastore),o=new x3(i,e.datastore,t,n,this.options);this.offline=o}async startOnline({libp2p:e,repo:t,peerId:n,keychain:i}){if(this.online!=null)throw new ka;let o=sX({libp2p:e,repo:t,peerId:n,options:this.options}),s=new x3(o,t.datastore,n,i,this.options);await s.republisher.start(),this.online=s}async stop(){let e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,i){return this.getIPNS().publish(e,t,n,i)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}};var LP=C(ee(),1);async function aX({ipns:r,repo:e,codecs:t},n,i){if($8(n))return r.resolve(n);let{cid:o,path:s}=Qu(n);await sl(kf(o,s||"",t,e,i))}var OP=j("ipfs:name:publish");function cX({ipns:r,repo:e,codecs:t,peerId:n,isOnline:i,keychain:o}){let s=async c=>{let u;if(c==="self"&&n.privateKey!=null)u=await Li(n.privateKey);else try{let l=await o.exportKey(c,"temp");u=await c3(l,"temp")}catch(l){throw OP.error(l),(0,LP.default)(l,"ERR_CANNOT_GET_KEY")}return Hn(u.public.bytes,u.bytes)};async function a(c,u={}){let l=u.resolve!==!1,f=u.lifetime||"24h",h=u.key||"self";if(!i())throw(0,LP.default)(new Error(W8),"OFFLINE_ERROR");try{c=kH(c)}catch(_){throw OP.error(_),_}let d=0;try{d=Cf(f)||0,d=parseFloat(d.toFixed(6))}catch(_){throw OP.error(_),_}let p=await Promise.all([s(h),l?aX({ipns:r,repo:e,codecs:t},c):Promise.resolve()]),g=Ie(c),w=await r.publish(p[0],g,d,u);return{name:w.name,value:re(w.value)}}return $(a)}var C_=C(ee(),1);var dX=C(lX(),1);var CAe=et.bind({ignoreUndefined:!0}),PAe=j("ipfs:name:resolve"),fX=(r,e)=>e.length>0?r+"/"+e.join("/"):r;function hX({dns:r,ipns:e,isOnline:t,options:{offline:n}}){async function*i(o,s={}){if(s=CAe({nocache:!1,recursive:!0},s),n&&s&&s.nocache)throw(0,C_.default)(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!t()&&!n)throw(0,C_.default)(new Error(W8),"OFFLINE_ERROR");let a=o.toString();a.startsWith("/ipns/")||(a=`/ipns/${a}`);let[c,u,...l]=a.slice(1).split("/");try{if(u.substring(0,1)==="1"){let h=Oe(u),d=Ea(h.toBytes());u=z.createV1(114,d).toString(w1)}else{let h=z.parse(u);h.version===1&&(u=h.toString(w1))}}catch(h){if((0,dX.default)(u)){yield fX(await r(u,s),l);return}throw PAe.error(h),(0,C_.default)(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}let f=await e.resolve(`/${c}/${u}`,s);yield fX(f instanceof Uint8Array?re(f):f,l)}return $(i)}var BP=C(ee(),1);function vm(r,e){if(!r||!(e&&e.ipnsPubsub))throw(0,BP.default)(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(r.routing instanceof Zh)return r.routing;let t=(r.routing.stores||[]).find(n=>n instanceof Zh);if(!t)throw(0,BP.default)(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return t}function pX({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i,o={}){return vm(r,t).cancel(i,o)}return $(n)}function mX({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){try{return{enabled:!!vm(r,t)}}catch{return{enabled:!1}}}return $(n)}function gX({ipns:r,options:e}){let t=e.EXPERIMENTAL;async function n(i={}){return vm(r,t).getSubscriptions(i)}return $(n)}var P_=class{constructor({ipns:e,options:t}){this.cancel=pX({ipns:e,options:t}),this.state=mX({ipns:e,options:t}),this.subs=gX({ipns:e,options:t})}};var k_=class{constructor({dns:e,ipns:t,repo:n,codecs:i,peerId:o,isOnline:s,keychain:a,options:c}){this.publish=cX({ipns:t,repo:n,codecs:i,peerId:o,isOnline:s,keychain:a}),this.resolve=hX({dns:e,ipns:t,isOnline:s,options:c}),this.pubsub=new P_({ipns:t,options:c})}};var yX=C(Kn(),1),wX=C(Da(),1),kAe=Gn().code,MP={default:"<dst>",edges:"<src> -> <dst>"};function bX({repo:r,codecs:e,resolve:t,preload:n}){async function*i(o,s={}){if(s.maxDepth===0)return;if(s.edges&&s.format&&s.format!==MP.default)throw new Error("Cannot set edges to true and also specify format");if(s.format=s.edges?MP.edges:s.format,typeof s.maxDepth!="number"&&(s.maxDepth=s.recursive?1/0:1),s.timeout){let l=[new yX.TimeoutController(s.timeout).signal];s.signal&&l.push(s.signal),s.signal=(0,wX.anySignal)(l)}let c=(Array.isArray(o)?o:[o]).map(u=>NAe(n,u,s));for(let u of c)try{yield*DAe(t,r,e,u,s)}catch(l){yield{ref:"",err:l.message}}}return i}function NAe(r,e,t){let{cid:n,path:i}=Qu(e);return t.preload!==!1&&r(n),`/ipfs/${n}${i||""}`}async function*DAe(r,e,t,n,i){let o=await r(n,i),{cid:s}=Qu(o),a=i.maxDepth!=null?i.maxDepth:1/0,c=i.unique||!1;for await(let u of LAe(e,t,s,a,c,i))u.parent&&(u.isDuplicate||(yield{ref:OAe(u.parent.cid,u.node.cid,u.node.name,i.format)}))}function OAe(r,e,t="",n=MP.default){let i=n.replace(/<src>/g,r.toString());return i=i.replace(/<dst>/g,e.toString()),i=i.replace(/<linkname>/g,t),i}async function*LAe(r,e,t,n,i,o){let s=new Set;async function*a(c,u){let l=u+1;if(!(l>n))try{for await(let f of BAe(r,e,c.cid,o))yield{parent:c,node:f,isDuplicate:i&&s.has(f.cid.toString())},i&&s.add(f.cid.toString()),yield*a(f,l)}catch(f){throw f.code===kAe&&(f.message=`Could not find object with CID: ${c.cid}`),f}}yield*a({cid:t},0)}async function*BAe(r,e,t,n){let i=await r.blocks.get(t,n),s=(await e.getCodec(t.code)).decode(i),a=t.code===kr,c=[];for(let[u,l]of UP(s,c)){if(a){let f=u.match(/^Links\/(\d+)\/Hash$/);if(f){let h=Number(f[1]);if(h<s.Links.length){yield{name:s.Links[h].Name,cid:l};continue}}}yield{name:u,cid:l}}}var UP=function*(r,e){if(r!=null&&!(r instanceof Uint8Array)){for(let[t,n]of Object.entries(r)){let i=[...e,t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let[o,s]of n.entries()){let a=[...i,o],c=z.asCID(s);c?yield[a.join("/"),c]:typeof s=="object"&&(yield*UP(s,a))}else{let o=z.asCID(n);o?yield[i.join("/"),o]:yield*UP(n,i)}}return[]}};function _X({repo:r}){async function*e(t={}){for await(let n of r.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}return $(e)}function EX({network:r}){async function e(t={}){let{bitswap:n}=await r.use(t),i=n.getWantlist();return Array.from(i).map(o=>o[1].cid)}return $(e)}function vX({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n),o=i.wantlistForPeer(t);return Array.from(o).map(s=>s[1].cid)}return $(e)}function xX({network:r}){async function e(t,n={}){let{bitswap:i}=await r.use(n);return Array.isArray(t)||(t=[t]),i.unwant(t)}return $(e)}function N_({network:r}){async function e(t={}){let n=(await r.use(t)).bitswap,i=n.stat().snapshot;return{provideBufLen:parseInt(i.providesBufferLength.toString()),blocksReceived:BigInt(i.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map(o=>o[1].cid),peers:n.peers(),dupBlksReceived:BigInt(i.dupBlksReceived.toString()),dupDataReceived:BigInt(i.dupDataReceived.toString()),dataReceived:BigInt(i.dataReceived.toString()),blocksSent:BigInt(i.blocksSent.toString()),dataSent:BigInt(i.dataSent.toString())}}return $(e)}var D_=class{constructor({network:e}){this.wantlist=EX({network:e}),this.wantlistForPeer=vX({network:e}),this.unwant=xX({network:e}),this.stat=N_({network:e})}};var MAe=Me("dns4"),UAe=Me("dns6"),FAe=Me("dnsaddr"),Jh=_i(Me("dns"),FAe,MAe,UAe),O_=_i(Me("ip4"),Me("ip6")),xm=_i(ut(O_,Me("tcp")),ut(Jh,Me("tcp"))),VP=ut(O_,Me("udp")),zAe=ut(VP,Me("utp")),VAe=ut(VP,Me("quic")),P3=_i(ut(xm,Me("ws")),ut(Jh,Me("ws"))),k3=_i(ut(xm,Me("wss")),ut(Jh,Me("wss")),ut(xm,Me("tls"),Me("ws")),ut(Jh,Me("tls"),Me("ws"))),FP=_i(ut(xm,Me("http")),ut(O_,Me("http")),ut(Jh,Me("http"))),zP=_i(ut(xm,Me("https")),ut(O_,Me("https")),ut(Jh,Me("https"))),SX=ut(VP,Me("webrtc"),Me("certhash")),TX=_i(ut(SX,Me("p2p")),SX),IX=_i(ut(P3,Me("p2p-webrtc-star"),Me("p2p")),ut(k3,Me("p2p-webrtc-star"),Me("p2p")),ut(P3,Me("p2p-webrtc-star")),ut(k3,Me("p2p-webrtc-star"))),vdt=_i(ut(P3,Me("p2p-websocket-star"),Me("p2p")),ut(k3,Me("p2p-websocket-star"),Me("p2p")),ut(P3,Me("p2p-websocket-star")),ut(k3,Me("p2p-websocket-star"))),RX=_i(ut(FP,Me("p2p-webrtc-direct"),Me("p2p")),ut(zP,Me("p2p-webrtc-direct"),Me("p2p")),ut(FP,Me("p2p-webrtc-direct")),ut(zP,Me("p2p-webrtc-direct"))),N3=_i(P3,k3,FP,zP,IX,RX,xm,zAe,VAe,Jh,TX),xdt=_i(ut(N3,Me("p2p-stardust"),Me("p2p")),ut(N3,Me("p2p-stardust"))),td=_i(ut(N3,Me("p2p")),IX,RX,TX,Me("p2p")),AX=_i(ut(td,Me("p2p-circuit"),td),ut(td,Me("p2p-circuit")),ut(Me("p2p-circuit"),td),ut(N3,Me("p2p-circuit")),ut(Me("p2p-circuit"),N3),Me("p2p-circuit")),CX=()=>_i(ut(AX,CX),AX),C3=CX(),KAe=_i(ut(C3,td,C3),ut(td,C3),ut(C3,td),C3,td),PX=KAe;function kX(r){function e(t){let n;try{n=Xi(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function ut(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:kX(e),partialMatch:e}}function _i(...r){function e(n){let i=null;return r.some(o=>{let s=typeof o=="function"?o().partialMatch(n):o.partialMatch(n);return s!=null?(i=s,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:kX(e),partialMatch:e}}function Me(r){let e=r;function t(i){let o;try{o=Xi(i)}catch{return!1}let s=o.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}function L_(r){try{return PX.matches(r)}catch{return!1}}function NX({repo:r}){async function e(t,n={}){if(!L_(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n),o=i.Bootstrap||[];return o.push(t.toString()),i.Bootstrap=Array.from(new Set(o)).sort((s,a)=>s.localeCompare(a)),await r.config.replace(i),{Peers:[t]}}return $(e)}var DX=O8,$Ae=L8,KP=function(r){let e=0;if(r=r.toString().trim(),DX(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if($Ae(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let o=DX(t[n]),s;o&&(s=KP(t[n]),t[n]=re(s.slice(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,re(s.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let o=[n,1];for(n=9-t.length;n>0;n--)o.push("0");t.splice.apply(t,o)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let o=parseInt(t[n],16);i[e++]=o>>8&255,i[e++]=o&255}return i}throw new Error("invalid ip address")},OX=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let o=0;o<t;o++)i.push(r[e+o]);return i.join(".")}if(t===16){let i=[];for(let o=0;o<t;o+=2)i.push(n.getUint16(e+o).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var D3={},$P={},HAe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];HAe.forEach(r=>{let e=GAe(...r);$P[e.code]=e,D3[e.name]=e});function GAe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function Fr(r){if(typeof r=="number"){if($P[r]!=null)return $P[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(D3[r]!=null)return D3[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Kc=C(Xo(),1);function WX(r,e){switch(Fr(r).code){case 4:case 41:return aTe(e);case 42:return GX(e);case 6:case 273:case 33:case 132:return QX(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return GX(e);case 421:return fTe(e);case 444:return jX(e);case 445:return jX(e);case 466:return lTe(e);default:return re(e,"base16")}}function YX(r,e){switch(Fr(r).code){case 4:return qX(e);case 41:return qX(e);case 42:return HX(e);case 6:case 273:case 33:case 132:return jP(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return HX(e);case 421:return cTe(e);case 444:return dTe(e);case 445:return hTe(e);case 466:return uTe(e);default:return Ie(e,"base16")}}var GP=Object.values(Vu).map(r=>r.decoder),sTe=function(){let r=GP[0].or(GP[1]);return GP.slice(2).forEach(e=>r=r.or(e)),r}();function qX(r){if(!xc(r))throw new Error("invalid ip address");return KP(r)}function aTe(r){let e=OX(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!xc(e))throw new Error("invalid ip address");return e}function jP(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function QX(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function HX(r){let e=Ie(r),t=Uint8Array.from(Kc.default.encode(e.length));return rt([t,e],t.length+e.length)}function GX(r){let e=Kc.default.decode(r);if(r=r.slice(Kc.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return re(r)}function cTe(r){let e;r[0]==="Q"||r[0]==="1"?e=Ea(pr.decode(`z${r}`)).bytes:e=z.parse(r).multihash.bytes;let t=Uint8Array.from(Kc.default.encode(e.length));return rt([t,e],t.length+e.length)}function uTe(r){let e=sTe.decode(r),t=Uint8Array.from(Kc.default.encode(e.length));return rt([t,e],t.length+e.length)}function lTe(r){let e=Kc.default.decode(r),t=r.slice(Kc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+re(t,"base64url")}function fTe(r){let e=Kc.default.decode(r),t=r.slice(Kc.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return re(t,"base58btc")}function dTe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=va.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=jP(n);return rt([t,i],t.length+i.length)}function hTe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=va.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=jP(n);return rt([t,i],t.length+i.length)}function jX(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=re(e,"base32"),i=QX(t);return`${n}:${i}`}var Sm=C(Xo(),1);function pTe(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],o=Fr(i);if(o.size===0){e.push([i]);continue}if(n++,n>=t.length)throw ZX("invalid address: "+r);if(o.path===!0){e.push([i,ZP(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function mTe(r){let e=[];return r.map(t=>{let n=U_(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),ZP(e.join("/"))}function gTe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=U_(e);return e.length>1?[t.code,YX(t.code,e[1])]:[t.code]})}function WP(r){return r.map(e=>{let t=U_(e);return e[1]!=null?[t.code,WX(t.code,e[1])]:[t.code]})}function YP(r){return M_(rt(r.map(e=>{let t=U_(e),n=Uint8Array.from(Sm.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=rt([n,e[1]])),n})))}function QP(r,e){return r.size>0?r.size/8:r.size===0?0:Sm.default.decode(e)+(Sm.default.decode.bytes??0)}function B_(r){let e=[],t=0;for(;t<r.length;){let n=Sm.default.decode(r,t),i=Sm.default.decode.bytes??0,o=Fr(n),s=QP(o,r.slice(t+i));if(s===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+s);if(t+=s+i,t>r.length)throw ZX("Invalid address Uint8Array: "+re(r,"base16"));e.push([n,a])}return e}function XP(r){let e=B_(r),t=WP(e);return mTe(t)}function yTe(r){r=ZP(r);let e=pTe(r),t=gTe(e);return YP(t)}function XX(r){return yTe(r)}function M_(r){let e=wTe(r);if(e!=null)throw e;return Uint8Array.from(r)}function wTe(r){try{B_(r)}catch(e){return e}}function ZP(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function ZX(r){return new Error("Error parsing address: "+r)}function U_(r){return Fr(r[0])}var ek=C(Xo(),1);var eZ=C(ee(),1);var Am=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},JP=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},O3,L3,B3,JX,_Te=Symbol.for("nodejs.util.inspect.custom"),ETe=[Fr("dns").code,Fr("dns4").code,Fr("dns6").code,Fr("dnsaddr").code],vTe=new Map,tZ=Symbol.for("@multiformats/js-multiaddr/multiaddr");function F_(r){return!!(r!=null&&r[tZ])}var al=class{constructor(e){if(O3.set(this,void 0),L3.set(this,void 0),B3.set(this,void 0),this[JX]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=M_(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=XX(e)}else if(F_(e))this.bytes=M_(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Am(this,O3,"f")==null&&JP(this,O3,XP(this.bytes),"f"),Am(this,O3,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,i,o="",s=Fr("tcp"),a=Fr("udp"),c=Fr("ip4"),u=Fr("ip6"),l=Fr("dns6"),f=Fr("ip6zone");for(let[d,p]of this.stringTuples())d===f.code&&(o=`%${p??""}`),ETe.includes(d)&&(t=s.name,i=443,n=`${p??""}${o}`,e=d===l.code?6:4),(d===s.code||d===a.code)&&(t=Fr(d).name,i=parseInt(p??"")),(d===c.code||d===u.code)&&(t=Fr(d).name,n=`${p??""}${o}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},Fr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=ek.default.decode(t,n),o=ek.default.decode.bytes??0,s=Fr(i),a=QP(s,t.slice(n+o));n+=a+o,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Am(this,L3,"f")==null&&JP(this,L3,B_(this.bytes),"f"),Am(this,L3,"f")}stringTuples(){return Am(this,B3,"f")==null&&JP(this,B3,WP(this.tuples()),"f"),Am(this,B3,"f")}encapsulate(e){return e=new al(e),new al(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new al(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new al(YP(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===D3.ipfs.code).pop();if((t==null?void 0:t[1])!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?re(pr.decode(`z${n}`),"base58btc"):re(z.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>Fr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return mt(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(o=>o.resolvable);if(t==null)return[this];let n=vTe.get(t.name);if(n==null)throw(0,eZ.default)(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(o=>new al(o))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(O3=new WeakMap,L3=new WeakMap,B3=new WeakMap,JX=tZ,_Te)](){return`Multiaddr(${XP(this.bytes)})`}};function yt(r){return new al(r)}function rZ({repo:r}){async function e(t={}){let n=await r.config.getAll(t),i=n.Bootstrap||[];return n.Bootstrap=[],await r.config.replace(n),{Peers:i.map(o=>yt(o))}}return $(e)}function nZ({repo:r}){async function e(t={}){return{Peers:(await r.config.get("Bootstrap",t)||[]).map(i=>yt(i))}}return $(e)}var cl=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function iZ({repo:r}){async function e(t={}){let n=await r.config.getAll(t);return n.Bootstrap=cl().Bootstrap,await r.config.replace(n),{Peers:cl().Bootstrap.map(i=>yt(i))}}return $(e)}function oZ({repo:r}){async function e(t,n={}){if(!L_(t))throw new Error(`${t} is not a valid Multiaddr`);let i=await r.config.getAll(n);return i.Bootstrap=(i.Bootstrap||[]).filter(o=>o.toString()!==t.toString()),await r.config.replace(i),{Peers:[t]}}return $(e)}var z_=class{constructor({repo:e}){this.add=NX({repo:e}),this.list=nZ({repo:e}),this.rm=oZ({repo:e}),this.clear=rZ({repo:e}),this.reset=iZ({repo:e})}};function sZ({preload:r,repo:e}){async function t(n,i={}){return i.preload!==!1&&r(n),e.blocks.get(n,i)}return $(t)}function aZ({codecs:r,hashers:e,repo:t,preload:n}){async function i(o,s={}){let a=s.pin?await t.gcLock.readLock():null;try{let c=s.version!=null?s.version:0,u=s.format||(c===0?"dag-pb":"raw"),f=await(await e.getHasher(s.mhtype||"sha2-256")).digest(o),h=await r.getCodec(u),d=z.create(c,h.code,f);return await t.blocks.put(d,o,{signal:s.signal}),s.preload!==!1&&n(d),s.pin===!0&&await t.pins.pinRecursively(d,{signal:s.signal}),d}finally{a&&a()}}return $(i)}var cZ=C(ee(),1);function Qt(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var V_=globalThis.CustomEvent??Event;async function*ep(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);let n=e.ordered==null?!1:e.ordered,i=new EventTarget,o=[],s=Qt(),a=Qt(),c=!1,u,l=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let p of r){if(o.length===t&&(s=Qt(),await s.promise),l)break;let g={done:!1};o.push(g),p().then(w=>{g.done=!0,g.ok=!0,g.value=w,i.dispatchEvent(new V_("task-complete"))},w=>{g.done=!0,g.err=w,i.dispatchEvent(new V_("task-complete"))})}c=!0,i.dispatchEvent(new V_("task-complete"))}catch(p){u=p,i.dispatchEvent(new V_("task-complete"))}});function f(){var p;return n?(p=o[0])==null?void 0:p.done:!!o.find(g=>g.done)}function*h(){for(;o.length>0&&o[0].done;){let p=o[0];if(o.shift(),p.ok)yield p.value;else throw l=!0,s.resolve(),p.err;s.resolve()}}function*d(){for(;f();)for(let p=0;p<o.length;p++)if(o[p].done){let g=o[p];if(o.splice(p,1),p--,g.ok)yield g.value;else throw l=!0,s.resolve(),g.err;s.resolve()}}for(;;){if(f()||(a=Qt(),await a.promise),u!=null)throw u;if(n?yield*h():yield*d(),c&&o.length===0)break}}async function*Mi(r,e){for await(let t of r)yield e(t)}async function*M3(r,e){for await(let t of r)await e(t)&&(yield t)}function K_(r){return r instanceof Uint8Array?z.decode(r):z.parse(r.toString())}var xTe=8;function uZ({repo:r}){async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.gcLock.writeLock();try{yield*Ne(t,o=>Mi(o,s=>async()=>{s=K_(s);let a={cid:s};try{if(!await r.blocks.has(s))throw(0,cZ.default)(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await r.blocks.delete(s)}catch(c){n.force||(c.message=`cannot remove ${s}: ${c.message}`,a.error=c)}return a}),o=>ep(o,{concurrency:xTe}),o=>M3(o,()=>!n.quiet))}finally{i()}}return $(e)}function lZ({repo:r,preload:e}){async function t(n,i={}){n=K_(n),i.preload!==!1&&e(n);let o=await r.blocks.get(n);return{cid:n,size:o.length}}return $(t)}var $_=class{constructor({codecs:e,hashers:t,preload:n,repo:i}){this.get=sZ({preload:n,repo:i}),this.put=aZ({codecs:e,hashers:t,preload:n,repo:i}),this.rm=uZ({repo:i}),this.stat=lZ({preload:n,repo:i})}};var fZ=C(ee(),1);async function*yo(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}function tk(r){return typeof r.stream=="function"?yo(r.stream()):yo(new Response(r).body)}function ja(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}async function tp(r){let e=[];for await(let t of r)e.push(t);return e}function qs(r){return ArrayBuffer.isView(r)||r instanceof ArrayBuffer}function ul(r){return r.constructor&&(r.constructor.name==="Blob"||r.constructor.name==="File")&&typeof r.stream=="function"}function U3(r){return typeof r=="object"&&(r.path||r.content)}var ll=r=>r&&typeof r.getReader=="function";async function*q_(r){yield r}async function H_(r){if(qs(r))return q_(rk(r));if(typeof r=="string"||r instanceof String)return q_(rk(r.toString()));if(ul(r))return tk(r);if(ll(r)&&(r=yo(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=ja(r),{value:t,done:n}=await e.peek();if(n)return q_(new Uint8Array(0));if(e.push(t),Number.isInteger(t))return q_(Uint8Array.from(await tp(e)));if(qs(t)||typeof t=="string"||t instanceof String)return Mi(e,rk)}throw(0,fZ.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}function rk(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Array.isArray(r)?Uint8Array.from(r):Ie(r.toString())}var j_=C(ee(),1);async function*dZ(r,e){if(r==null)throw(0,j_.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");if(typeof r=="string"||r instanceof String){yield G_(r.toString(),e);return}if(qs(r)||ul(r)){yield G_(r,e);return}if(ll(r)&&(r=yo(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=ja(r),{value:n,done:i}=await t.peek();if(i){yield{content:[]};return}if(t.push(n),Number.isInteger(n)||qs(n)||typeof n=="string"||n instanceof String){yield G_(t,e);return}throw(0,j_.default)(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(U3(r)){yield G_(r,e);return}throw(0,j_.default)(new Error('Unexpected input: cannot convert "'+typeof r+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT")}async function G_(r,e){let{path:t,mode:n,mtime:i,content:o}=r,s={path:t||"",mode:Bu(n),mtime:af(i)};return o?s.content=await e(o):t||(s.content=await e(r)),s}function W_(r){return dZ(r,H_)}function hZ({addAll:r}){async function e(t,n={}){let i=await Dr(r(W_(t),n));if(i==null)throw Error("Failed to add a file, if you see this please report a bug");return i}return e}async function*rp(r,e=1){let t=[];e<1&&(e=1);for await(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*F3(r,e=1){for await(let t of rp(r,e)){let n=t.map(async i=>await i().then(o=>({ok:!0,value:o}),o=>({ok:!1,err:o})));for(let i=0;i<n.length;i++){let o=await n[i];if(o.ok)yield o.value;else throw o.err}}}var Q_=C(nk(),1);function STe(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var Ipt=gh({name:"murmur3-32",code:35,encode:r=>STe(Q_.default.x86.hash32(r))}),V3=gh({name:"murmur3-128",code:34,encode:r=>G0.fromHex(Q_.default.x64.hash128(r))}),Rpt=gh({name:"murmur3-x64-64",code:34,encode:r=>G0.fromHex(Q_.default.x64.hash128(r)).subarray(0,8)});async function ATe(r){return(await V3.encode(r)).slice(0,8).reverse()}var TTe={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:dt,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:ATe,hamtHashCode:34,hamtBucketBits:8},gZ=(r={})=>et.bind({ignoreUndefined:!0})(TTe,r);var ITe=async(r,e,t)=>{t.codec||(t.codec=sr),t.hasher||(t.hasher=dt),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===sr&&t.hasher!==dt&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=z.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i},Wa=ITe;var RTe=async(r,e,t)=>{let n=new st({type:"directory",mtime:r.mtime,mode:r.mode}),i=pt(Xn({Data:n.marshal()})),o=await Wa(i,e,t),s=r.path;return{cid:o,path:s,unixfs:n,size:i.length}},yZ=RTe;var xZ=C(ee(),1);async function CTe(r,e){return e(await tp(r))}var wZ=CTe;function PTe(r,e,t){return bZ(r,e,t)}async function bZ(r,e,t){let n=[];for await(let i of rp(r,t.maxChildrenPerNode))n.push(await e(i));return n.length>1?bZ(n,e,t):n[0]}var _Z=PTe;async function kTe(r,e,t){let n=new ik(t.layerRepeat),i=0,o=1,s=n;for await(let a of rp(r,t.maxChildrenPerNode))s.isFull()&&(s!==n&&n.addChild(await s.reduce(e)),i&&i%t.layerRepeat===0&&o++,s=new X_(o,t.layerRepeat,i),i++),s.append(a);return s&&s!==n&&n.addChild(await s.reduce(e)),n.reduce(e)}var EZ=kTe,X_=class{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;let e=this._findParent(this.node,this.currentDepth);return e?(this._addNextNodeToParent(e),!1):!0}_addNextNodeToParent(e){this.parent=e;let t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter(i=>i.data).map(i=>this._reduce(i,t)))),t((e.data||[]).concat(n))}_findParent(e,t){let n=e.parent;if(!(!n||n.depth===0))return n.children.length===n.maxChildren||!n.maxChildren?this._findParent(n,t):n}},ik=class extends X_{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}};async function*NTe(r,e,t){for await(let n of r.content)yield async()=>{t.progress(n.length,r.path);let i,o={codec:sr,cidVersion:t.cidVersion,hasher:t.hasher,onlyHash:t.onlyHash};return t.rawLeaves?(o.codec=yf,o.cidVersion=1):(i=new st({type:t.leafType,data:n}),n=pt({Data:i.marshal(),Links:[]})),{cid:await Wa(n,e,o),unixfs:i,size:n.length}}}var vZ=NTe;var DTe={flat:wZ,balanced:_Z,trickle:EZ};async function*OTe(r,e,t){let n=-1,i,o;typeof t.bufferImporter=="function"?o=t.bufferImporter:o=vZ;for await(let s of F3(o(r,e,t),t.blockWriteConcurrency)){if(n++,n===0){i=s;continue}else n===1&&i&&(yield i,i=null);yield s}i&&(i.single=!0,yield i)}var LTe=(r,e,t)=>{async function n(i){if(i.length===1&&i[0].single&&t.reduceSingleLeafToSelf){let l=i[0];if(r.mtime!==void 0||r.mode!==void 0){let f=await e.get(l.cid);l.unixfs=new st({type:"file",mtime:r.mtime,mode:r.mode,data:f}),f=pt(Xn({Data:l.unixfs.marshal()})),l.cid=await Wa(f,e,{...t,codec:sr,hasher:t.hasher,cidVersion:t.cidVersion}),l.size=f.length}return{cid:l.cid,path:r.path,unixfs:l.unixfs,size:l.size}}let o=new st({type:"file",mtime:r.mtime,mode:r.mode}),s=i.filter(l=>l.cid.code===gf&&l.size||l.unixfs&&!l.unixfs.data&&l.unixfs.fileSize()?!0:!!(l.unixfs&&l.unixfs.data&&l.unixfs.data.length)).map(l=>l.cid.code===gf?(o.addBlockSize(l.size),{Name:"",Tsize:l.size,Hash:l.cid}):(!l.unixfs||!l.unixfs.data?o.addBlockSize(l.unixfs&&l.unixfs.fileSize()||0):o.addBlockSize(l.unixfs.data.length),{Name:"",Tsize:l.size,Hash:l.cid})),a={Data:o.marshal(),Links:s},c=pt(Xn(a));return{cid:await Wa(c,e,t),path:r.path,unixfs:o,size:c.length+a.Links.reduce((l,f)=>l+f.Tsize,0)}}return n};function BTe(r,e,t){let n=DTe[t.strategy];if(!n)throw(0,xZ.default)(new Error(`Unknown importer build strategy name: ${t.strategy}`),"ERR_BAD_STRATEGY");return n(OTe(r,e,t),LTe(r,e,t),t)}var SZ=BTe;var fk=C(ee(),1);var TZ=Symbol.for("@achingbrain/uint8arraylist");function AZ(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function $c(r){return!!(r!=null&&r[TZ])}var MTe,vt=class{constructor(...e){B(this,"bufs");B(this,"length");B(this,MTe,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(MTe=TZ,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if($c(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if($c(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=AZ(this.bufs,e);return t.buf[t.index]}set(e,t){let n=AZ(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if($c(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:i}=this._subList(e,t);return yi(n,i)}subarray(e,t){let{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:yi(n,i)}sublist(e,t){let{bufs:n,length:i}=this._subList(e,t),o=new vt;return o.length=i,o.bufs=[...n],o}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],i=0;for(let o=0;o<this.bufs.length;o++){let s=this.bufs[o],a=i,c=a+s.byteLength;if(i=c,e>=c)continue;let u=e>=a&&e<c,l=t>a&&t<=c;if(u&&l){if(e===a&&t===c){n.push(s);break}let f=e-a;n.push(s.subarray(f,f+(t-e)));break}if(u){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(l){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!$c(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");let o=256,s=new Int32Array(o);for(let f=0;f<o;f++)s[f]=-1;for(let f=0;f<i;f++)s[n[f]]=f;let a=s,c=this.byteLength-n.byteLength,u=n.byteLength-1,l;for(let f=t;f<=c;f+=l){l=0;for(let h=u;h>=0;h--){let d=this.get(f+h);if(n[h]!==d){l=Math.max(1,h-a[d]);break}}if(l===0)return f}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=Ri(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let i=Hu(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let i=Hu(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let i=Hu(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=Ri(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let i=Hu(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let i=Hu(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let i=Hu(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let i=Hu(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let i=Hu(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof vt)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!C8(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new vt;return n.bufs=e,t==null&&(t=e.reduce((i,o)=>i+o.byteLength,0)),n.length=t,n}};var zZ=C(FZ(),1),uk=C(ee(),1);async function*$Te(r,e){let t,n,i;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)i=e.avgChunkSize,t=e.minChunkSize,n=e.maxChunkSize;else if(e.avgChunkSize)i=e.avgChunkSize,t=i/3,n=i+i/2;else throw(0,uk.default)(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");if(t<16)throw(0,uk.default)(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<t&&(n=t),i<t&&(i=t);let o=Math.floor(Math.log2(i));for await(let s of qTe(r,{min:t,max:n,bits:o,window:e.window,polynomial:e.polynomial}))yield s}var VZ=$Te;async function*qTe(r,e){let t=await(0,zZ.create)(e.bits,e.min,e.max,e.window),n=new vt;for await(let i of r){n.append(i);let o=t.fingerprint(i);for(let s=0;s<o.length;s++){let a=o[s],c=n.slice(0,a);n.consume(a),yield c}}n.length&&(yield n.subarray(0))}async function*HTe(r,e){let t=new vt,n=0,i=!1,o=e.maxChunkSize;for await(let s of r)for(t.append(s),n+=s.length;n>=o;)if(yield t.slice(0,o),i=!0,o===t.length)t=new vt,n=0;else{let a=new vt;a.append(t.sublist(o)),t=a,n-=o}(!i||n)&&(yield t.subarray(0,n))}var KZ=HTe;var lk=C(ee(),1);async function*GTe(r){for await(let e of r){if(e.length===void 0)throw(0,lk.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof e=="string"||e instanceof String)yield Ie(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else if(e instanceof Uint8Array)yield e;else throw(0,lk.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}}var $Z=GTe;function jTe(r){return Symbol.iterator in r}function WTe(r){return Symbol.asyncIterator in r}function YTe(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(jTe(r))return async function*(){yield*r}();if(WTe(r))return r}catch{throw(0,fk.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw(0,fk.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*QTe(r,e,t){for await(let n of r)if(n.path&&(n.path.substring(0,2)==="./"&&(t.wrapWithDirectory=!0),n.path=n.path.split("/").filter(i=>i&&i!==".").join("/")),n.content){let i;typeof t.chunker=="function"?i=t.chunker:t.chunker==="rabin"?i=VZ:i=KZ;let o;typeof t.chunkValidator=="function"?o=t.chunkValidator:o=$Z;let s={path:n.path,mtime:n.mtime,mode:n.mode,content:i(o(YTe(n.content),t),t)};yield()=>SZ(s,e,t)}else if(n.path){let i={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>yZ(i,e,t)}else throw new Error("Import candidate must have content or path or both")}var qZ=QTe;var dk=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},rd=dk;var hk=class extends rd{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){let e=Object.keys(this._children);for(let t=0;t<e.length;t++){let n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){let t=Object.keys(this._children),n=[];for(let u=0;u<t.length;u++){let l=this._children[t[u]];if(l instanceof rd)for await(let f of l.flush(e))l=f,yield l;l.size!=null&&l.cid&&n.push({Name:t[u],Tsize:l.size,Hash:l.cid})}let i=new st({type:"directory",mtime:this.mtime,mode:this.mode}),o={Data:i.marshal(),Links:n},s=pt(Xn(o)),a=await Wa(s,e,this.options),c=s.length+o.Links.reduce((u,l)=>u+(l.Tsize==null?0:l.Tsize),0);this.cid=a,this.size=c,yield{cid:a,unixfs:i,path:this.path,size:c}}},H3=hk;var jZ=C(pk(),1);var bn=class{constructor(e,t,n=0){B(this,"_options");B(this,"_popCount");B(this,"_parent");B(this,"_posAtParent");B(this,"_children");B(this,"key");this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new jZ.default,this.key=null}async put(e,t){let n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)}async get(e){let t=await this._findChild(e);if(t!=null)return t.value}async del(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof bn?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof bn?yield*t.eachLeafSeries():yield t}serialize(e,t){let n=[];return t(this._children.reduce((i,o,s)=>(o!=null&&(o instanceof bn?i.push(o.serialize(e,t)):i.push(e(o,s))),i),n))}async asyncTransform(e,t){return WZ(this,e,t)}toJSON(){return this.serialize(tIe,rIe)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof bn)&&n!=null&&n.key===e)return n}async _findPlace(e){let t=this._options.hash(typeof e=="string"?cr(e):e),n=await t.take(this._options.bits),i=this._children.get(n);return i instanceof bn?i._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:i}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new bn(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let i=await n._findPlace(t.existingChild.hash);return i.bucket._putAt(i,t.existingChild.key,t.existingChild.value),n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(eIe);if(e!=null&&!(e instanceof bn)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function eIe(r){return!!r}function tIe(r,e){return r.key}function rIe(r){return r}async function WZ(r,e,t){let n=[];for(let i of r._children.compactArray())if(i instanceof bn)await WZ(i,e,t);else{let o=await e(i);n.push({bitField:r._children.bitField(),children:o})}return t(n)}var nIe=[255,254,252,248,240,224,192,128],iIe=[1,3,7,15,31,63,127,255],Z_=class{constructor(e){B(this,"_value");B(this,"_currentBytePos");B(this,"_currentBitPos");this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let i=this._value[this._currentBytePos],o=this._currentBitPos+1,s=Math.min(o,t),a=oIe(i,o-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function oIe(r,e,t){let n=sIe(e,t);return(r&n)>>>e}function sIe(r,e){return nIe[r]&iIe[Math.min(e+r-1,7)]}function YZ(r){function e(t){return t instanceof J_?t:new J_(t,r)}return e}var J_=class{constructor(e,t){B(this,"_value");B(this,"_hashFn");B(this,"_depth");B(this,"_availableBits");B(this,"_currentBufferIndex");B(this,"_buffers");if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let i=this._buffers[this._currentBufferIndex],o=Math.min(i.availableBits(),t),s=i.take(o);n=(n<<o)+s,t-=o,this._availableBits-=o,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),t);n.untake(i),t-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?yi([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Z_(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function Tm(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:YZ(r.hashFn)};return new bn(e)}var mk=class extends rd{constructor(e,t){super(e,t),this._bucket=Tm({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(let t of XZ(this._bucket,e,this,this.options))yield{...t,path:this.path}}},QZ=mk;async function*XZ(r,e,t,n){let i=r._children,o=[],s=0;for(let d=0;d<i.length;d++){let p=i.get(d);if(!p)continue;let g=d.toString(16).toUpperCase().padStart(2,"0");if(p instanceof bn){let w;for await(let _ of await XZ(p,e,null,n))w=_;if(!w)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:g,Tsize:w.size,Hash:w.cid}),s+=w.size}else if(typeof p.value.flush=="function"){let w=p.value,_;for await(let m of w.flush(e))_=m,yield _;let x=g+p.key;o.push({Name:x,Tsize:_.size,Hash:_.cid}),s+=_.size}else{let w=p.value;if(!w.cid)continue;let _=g+p.key,x=w.size;o.push({Name:_,Tsize:x,Hash:w.cid}),s+=x}}let a=Uint8Array.from(i.bitField().reverse()),c=new st({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:n.hamtHashCode,mtime:t&&t.mtime,mode:t&&t.mode}),u={Data:c.marshal(),Links:o},l=pt(Xn(u)),f=await Wa(l,e,n),h=l.length+s;yield{cid:f,unixfs:c,size:h}}async function ZZ(r,e,t,n){let i=e;e instanceof H3&&e.directChildrenCount()>=t&&(i=await aIe(e,n));let o=i.parent;if(o){if(i!==e){if(r&&(r.parent=i),!i.parentKey)throw new Error("No parent key found");await o.put(i.parentKey,i)}return ZZ(i,o,t,n)}return i}async function aIe(r,e){let t=new QZ({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for await(let{key:n,child:i}of r.eachChildSeries())await t.put(n,i);return t}var JZ=ZZ;var cIe=(r="")=>(r.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean),eJ=cIe;async function uIe(r,e,t){let n=eJ(r.path||""),i=n.length-1,o=e,s="";for(let a=0;a<n.length;a++){let c=n[a];s+=`${s?"/":""}${c}`;let u=a===i;if(o.dirty=!0,o.cid=void 0,o.size=void 0,u)await o.put(c,r),e=await JZ(null,o,t.shardSplitThreshold,t);else{let l=await o.get(c);(!l||!(l instanceof rd))&&(l=new H3({root:!1,dir:!0,parent:o,parentKey:c,path:s,dirty:!0,flat:!0,mtime:l&&l.unixfs&&l.unixfs.mtime,mode:l&&l.unixfs&&l.unixfs.mode},t)),await o.put(c,l),o=l}}return e}async function*tJ(r,e){if(!(r instanceof rd)){r&&r.unixfs&&r.unixfs.isDirectory()&&(yield r);return}yield*r.flush(e)}async function*lIe(r,e,t){let n=new H3({root:!0,dir:!0,path:"",dirty:!0,flat:!0},t);for await(let i of r)i&&(n=await uIe(i,n,t),(!i.unixfs||!i.unixfs.isDirectory())&&(yield i));if(t.wrapWithDirectory)yield*tJ(n,e);else for await(let i of n.eachChildSeries())i&&(yield*tJ(i.child,e))}var rJ=lIe;async function*Im(r,e,t={}){let n=gZ(t),i;typeof t.dagBuilder=="function"?i=t.dagBuilder:i=qZ;let o;typeof t.treeBuilder=="function"?o=t.treeBuilder:o=rJ;let s;Symbol.asyncIterator in r||Symbol.iterator in r?s=r:s=[r];for await(let a of o(F3(i(s,e,n),n.fileImportConcurrency),e,n))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}var G3=C(ee(),1);async function*eE(r,e){if(typeof r=="string"||r instanceof String||qs(r)||ul(r)||r._readableState)throw(0,G3.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(ll(r)&&(r=yo(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let t=ja(r),{value:n,done:i}=await t.peek();if(i){yield*[];return}if(t.push(n),Number.isInteger(n))throw(0,G3.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState){yield*Mi(t,o=>gk({content:o},e));return}if(qs(n)){yield gk({content:t},e);return}if(U3(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||ll(n)||ul(n)){yield*Mi(t,o=>gk(o,e));return}}throw U3(r)?(0,G3.default)(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT"):(0,G3.default)(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}async function gk(r,e){let{path:t,mode:n,mtime:i,content:o}=r,s={path:t||"",mode:Bu(n),mtime:af(i)};return o?s.content=await e(o):t||(s.content=await e(r)),s}function nJ(r){return eE(r,H_)}var iJ=r=>{if(r)if(r.startsWith("size-")){let e=r.split("-")[1],t=parseInt(e);if(isNaN(t))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:t}}else{if(r.startsWith("rabin"))return{chunker:"rabin",...fIe(r)};throw new Error(`Unrecognized chunker option: ${r}`)}else return{chunker:"fixed"}},fIe=r=>{let e={},t=r.split("-");switch(t.length){case 1:e.avgChunkSize=262144;break;case 2:e.avgChunkSize=tE(t[1],"avg");break;case 4:e.minChunkSize=tE(t[1],"min"),e.avgChunkSize=tE(t[2],"avg"),e.maxChunkSize=tE(t[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return e},tE=(r,e)=>{let t=parseInt(r);if(isNaN(t))throw new Error(`Chunker parameter ${e} must be an integer`);return t};var dIe=et.bind({ignoreUndefined:!0});function oJ({repo:r,preload:e,hashers:t,options:n}){let i=n&&n.sharding;async function*o(s,a={}){let c=dIe({shardSplitThreshold:i?1e3:1/0,strategy:"balanced"},a,{...iJ(a.chunker)});c.hashAlg&&c.hashAlg!=="sha2-256"&&c.cidVersion!==1&&(c.cidVersion=1),c.trickle&&(c.strategy="trickle"),c.strategy==="trickle"&&(c.leafType="raw",c.reduceSingleLeafToSelf=!1),c.cidVersion>0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),c.hashAlg!==void 0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),delete c.trickle;let u={};if(c.progress){let d=c.progress;c.progress=(p,g)=>{u[g]||(u[g]=0),u[g]+=p,d(u[g],g)}}let l;c.hashAlg!=null&&(l=await t.getHasher(c.hashAlg));let f=Ne(nJ(s),d=>Im(d,r.blocks,{...c,hasher:l,pin:!1}),hIe(c),pIe(e,c),mIe(r,c)),h=await r.gcLock.readLock();try{for await(let d of f){let p=d.path??d.cid.toString();delete u[p],yield{...d,path:p}}}finally{h()}}return $(o)}function hIe(r){async function*e(t){for await(let n of t){let i=n.cid;r.cidVersion===1&&(i=i.toV1());let o=n.path?n.path:i.toString();r.wrapWithDirectory&&!n.path&&(o=""),yield{path:o,cid:i,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return e}function pIe(r,e){async function*t(n){for await(let i of n)(!i.path||e.wrapWithDirectory?i.path==="":!i.path.includes("/"))&&!e.onlyHash&&e.preload!==!1&&r(i.cid),yield i}return t}function mIe(r,e){async function*t(n){for await(let i of n){let o=!(i.path&&i.path.includes("/"));(e.pin==null?!0:e.pin)&&o&&!e.onlyHash&&await r.pins.pinRecursively(i.cid),yield i}}return t}var bE=C(ee(),1);var KJ=C(ee(),1);var gIe=new TextDecoder;function yk(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function rE(r,e){let t;[t,e]=yk(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function sJ(r,e){let t;return[t,e]=yk(r,e),[t&7,t>>3,e]}function yIe(r){let e={},t=r.length,n=0;for(;n<t;){let i,o;if([i,o,n]=sJ(r,n),o===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=rE(r,n)}else if(o===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=rE(r,n),e.Name=gIe.decode(s)}else if(o===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=yk(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function aJ(r){let e=r.length,t=0,n,i=!1,o;for(;t<e;){let a,c;if([a,c,t]=sJ(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,t]=rE(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,t]=rE(r,t),n.push(yIe(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return o&&(s.Data=o),s.Links=n||[],s}var uJ=new TextEncoder,cJ=2**32,wIe=2**31;function bIe(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=j3(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=uJ.encode(r.Name);t-=n.length,e.set(n,t),t=j3(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=j3(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function lJ(r){let e=EIe(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=j3(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){let o=bIe(r.Links[i],t.subarray(0,n));n-=o,n=j3(t,n,o)-1,t[n]=18}return t}function _Ie(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+Rm(t)}if(typeof r.Name=="string"){let t=uJ.encode(r.Name).length;e+=1+t+Rm(t)}return typeof r.Tsize=="number"&&(e+=1+Rm(r.Tsize)),e}function EIe(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+Rm(t)}if(r.Links)for(let t of r.Links){let n=_Ie(t);e+=1+n+Rm(n)}return e}function j3(r,e,t){e-=Rm(t);let n=e;for(;t>=wIe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function Rm(r){return r%2===0&&r++,Math.floor((vIe(r)+6)/7)}function vIe(r){let e=0;return r>=cJ&&(r=Math.floor(r/cJ),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+xIe[r]}var xIe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var SIe=["Data","Links"],AIe=["Hash","Name","Tsize"],fJ=new TextEncoder;function TIe(r,e){if(r===e)return 0;let t=r.Name?fJ.encode(r.Name):[],n=e.Name?fJ.encode(e.Name):[],i=t.length,o=n.length;for(let s=0,a=Math.min(i,o);s<a;++s)if(t[s]!==n[s]){i=t[s],o=n[s];break}return i<o?-1:o<i?1:0}function dJ(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function hJ(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!dJ(r,SIe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!dJ(t,AIe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&TIe(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var Zo=112;function W3(r){hJ(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),lJ(e)}function Jo(r){let e=aJ(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{let i={};try{i.Hash=ce.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),t}var wE=C(ee(),1);var pJ=C(pk(),1);var no=class{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new pJ.default,this.key=null}async put(e,t){let n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){let t=await this._findChild(e);if(t!=null)return t.value}async del(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof no?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof no?yield*t.eachLeafSeries():yield t}serialize(e,t){let n=[];return t(this._children.reduce((i,o,s)=>(o!=null&&(o instanceof no?i.push(o.serialize(e,t)):i.push(e(o,s))),i),n))}async asyncTransform(e,t){return await mJ(this,e,t)}toJSON(){return this.serialize(RIe,CIe)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof no)&&n!=null&&n.key===e)return n}async _findPlace(e){let t=this._options.hash(typeof e=="string"?fe(e):e),n=await t.take(this._options.bits),i=this._children.get(n);return i instanceof no?await i._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:i}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new no(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let i=await n._findPlace(t.existingChild.hash);return i.bucket._putAt(i,t.existingChild.key,t.existingChild.value),await n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(IIe);if(e!=null&&!(e instanceof no)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function IIe(r){return!!r}function RIe(r,e){return r.key}function CIe(r){return r}async function mJ(r,e,t){let n=[];for(let i of r._children.compactArray())if(i instanceof no)await mJ(i,e,t);else{let o=await e(i);n.push({bitField:r._children.bitField(),children:o})}return await t(n)}var PIe=[255,254,252,248,240,224,192,128],kIe=[1,3,7,15,31,63,127,255],nE=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let i=this._value[this._currentBytePos],o=this._currentBitPos+1,s=Math.min(o,t),a=NIe(i,o-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function NIe(r,e,t){let n=DIe(e,t);return(r&n)>>>e}function DIe(r,e){return PIe[r]&kIe[Math.min(e+r-1,7)]}function yr(r,e){e==null&&(e=r.reduce((i,o)=>i+o.length,0));let t=Ac(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return Rf(t)}function gJ(r){function e(t){return t instanceof iE?t:new iE(t,r)}return e}var iE=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let i=this._buffers[this._currentBufferIndex],o=Math.min(i.availableBits(),t),s=i.take(o);n=(n<<o)+s,t-=o,this._availableBits-=o,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),t);n.untake(i),t-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?yr([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new nE(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function yJ(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:gJ(r.hashFn)};return new no(e)}var oE=C(nk(),1);function OIe(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var emt=Ah({name:"murmur3-32",code:35,encode:r=>OIe(oE.default.x86.hash32(r))}),wJ=Ah({name:"murmur3-128",code:34,encode:r=>yh.fromHex(oE.default.x64.hash128(r))}),tmt=Ah({name:"murmur3-x64-64",code:34,encode:r=>yh.fromHex(oE.default.x64.hash128(r)).subarray(0,8)});var LIe=async function(r){return(await wJ.encode(r)).slice(0,8).reverse()},BIe=(r,e,t)=>Promise.all(r.map(n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);return e._putObjectAt(i,new no({hash:t._options.hash,bits:t._options.bits},e,i))}return t.put(n.Name.substring(2),!0)})),bJ=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),MIe=r=>{let e=r.bucket,t=[];for(;e._parent;)t.push(e),e=e._parent;return t.push(e),t.reverse()},_J=async(r,e,t,n,i)=>{if(!n){let l=yJ({hashFn:LIe});n={rootBucket:l,hamtDepth:1,lastBucket:l}}await BIe(r.Links,n.lastBucket,n.rootBucket);let o=await n.rootBucket._findNewBucketAndPos(e),s=bJ(o.pos),a=MIe(o);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],s=bJ(n.lastBucket._posAtParent));let c=r.Links.find(l=>{if(l.Name==null)return!1;let f=l.Name.substring(0,2),h=l.Name.substring(2);return!(f!==s||h&&h!==e)});if(!c)return null;if(c.Name!=null&&c.Name.substring(2)===e)return c.Hash;n.hamtDepth++;let u=await t.get(c.Hash,i);return r=Jo(u),_J(r,e,t,n,i)},EJ=_J;function UIe(r,e,t,n){let i=r.length,o=e+i;return t>=o||n<e?new Uint8Array(0):(n>=e&&n<o&&(r=r.subarray(0,n-e)),t>=e&&t<o&&(r=r.subarray(t-e)),r)}var np=UIe;var sE=C(ee(),1),FIe=(r,e,t)=>{if(e||(e=0),e<0)throw(0,sE.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>r)throw(0,sE.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(!t&&t!==0&&(t=r-e),t<0)throw(0,sE.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+t>r&&(t=r-e),{offset:e,length:t}},Cm=FIe;var yE=C(ee(),1);function io(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var aE=globalThis.CustomEvent??Event;async function*wk(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);let n=e.ordered==null?!1:e.ordered,i=new EventTarget,o=[],s=io(),a=io(),c=!1,u,l=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let p of r){if(o.length===t&&(s=io(),await s.promise),l)break;let g={done:!1};o.push(g),p().then(w=>{g.done=!0,g.ok=!0,g.value=w,i.dispatchEvent(new aE("task-complete"))},w=>{g.done=!0,g.err=w,i.dispatchEvent(new aE("task-complete"))})}c=!0,i.dispatchEvent(new aE("task-complete"))}catch(p){u=p,i.dispatchEvent(new aE("task-complete"))}});function f(){var p;return n?(p=o[0])==null?void 0:p.done:!!o.find(g=>g.done)}function*h(){for(;o.length>0&&o[0].done;){let p=o[0];if(o.shift(),p.ok)yield p.value;else throw l=!0,s.resolve(),p.err;s.resolve()}}function*d(){for(;f();)for(let p=0;p<o.length;p++)if(o[p].done){let g=o[p];if(o.splice(p,1),p--,g.ok)yield g.value;else throw l=!0,s.resolve(),g.err;s.resolve()}}for(;;){if(f()||(a=io(),await a.promise),u!=null)throw u;if(n?yield*h():yield*d(),c&&o.length===0)break}}var PJ=C(xJ(),1);function _k(r,e,t){let n=0,i=r.length;for(;i>0;){let o=Math.trunc(i/2),s=n+o;t(r[s],e)<=0?(n=++s,i-=o+1):i=o}return n}var ip=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},fl,X3=class{constructor(){fl.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&ip(this,fl,"f")[this.size-1].priority>=t.priority){ip(this,fl,"f").push(n);return}let i=_k(ip(this,fl,"f"),n,(o,s)=>s.priority-o.priority);ip(this,fl,"f").splice(i,0,n)}dequeue(){let e=ip(this,fl,"f").shift();return e==null?void 0:e.run}filter(e){return ip(this,fl,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ip(this,fl,"f").length}};fl=new WeakMap;var Qr=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},De=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_n,J3,ew,id,pE,tw,uE,Ya,Z3,es,lE,ts,rw,nd,fE,SJ,AJ,RJ,TJ,IJ,dE,Ek,vk,mE,CJ,hE,gE=class extends Error{},Hs=class extends PJ.default{constructor(e){var t,n,i,o;if(super(),_n.add(this),J3.set(this,void 0),ew.set(this,void 0),id.set(this,0),pE.set(this,void 0),tw.set(this,void 0),uE.set(this,0),Ya.set(this,void 0),Z3.set(this,void 0),es.set(this,void 0),lE.set(this,void 0),ts.set(this,0),rw.set(this,void 0),nd.set(this,void 0),fE.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:X3,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(o=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""}\` (${typeof e.interval})`);Qr(this,J3,e.carryoverConcurrencyCount,"f"),Qr(this,ew,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),Qr(this,pE,e.intervalCap,"f"),Qr(this,tw,e.interval,"f"),Qr(this,es,new e.queueClass,"f"),Qr(this,lE,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Qr(this,fE,e.throwOnTimeout===!0,"f"),Qr(this,nd,e.autoStart===!1,"f")}get concurrency(){return De(this,rw,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Qr(this,rw,e,"f"),De(this,_n,"m",mE).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:De(this,fE,"f"),...t},new Promise((n,i)=>{De(this,es,"f").enqueue(async()=>{var o,s,a;Qr(this,ts,(s=De(this,ts,"f"),s++,s),"f"),Qr(this,id,(a=De(this,id,"f"),a++,a),"f");try{if(!((o=t.signal)===null||o===void 0)&&o.aborted)throw new gE("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=Ih(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,De(this,_n,"m",CJ).call(this,t.signal)]));let u=await c;n(u),this.emit("completed",u)}catch(c){if(c instanceof Nf&&!t.throwOnTimeout){n();return}i(c),this.emit("error",c)}finally{De(this,_n,"m",RJ).call(this)}},t),this.emit("add"),De(this,_n,"m",dE).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return De(this,nd,"f")?(Qr(this,nd,!1,"f"),De(this,_n,"m",mE).call(this),this):this}pause(){Qr(this,nd,!0,"f")}clear(){Qr(this,es,new(De(this,lE,"f")),"f")}async onEmpty(){De(this,es,"f").size!==0&&await De(this,_n,"m",hE).call(this,"empty")}async onSizeLessThan(e){De(this,es,"f").size<e||await De(this,_n,"m",hE).call(this,"next",()=>De(this,es,"f").size<e)}async onIdle(){De(this,ts,"f")===0&&De(this,es,"f").size===0||await De(this,_n,"m",hE).call(this,"idle")}get size(){return De(this,es,"f").size}sizeBy(e){return De(this,es,"f").filter(e).length}get pending(){return De(this,ts,"f")}get isPaused(){return De(this,nd,"f")}};J3=new WeakMap,ew=new WeakMap,id=new WeakMap,pE=new WeakMap,tw=new WeakMap,uE=new WeakMap,Ya=new WeakMap,Z3=new WeakMap,es=new WeakMap,lE=new WeakMap,ts=new WeakMap,rw=new WeakMap,nd=new WeakMap,fE=new WeakMap,_n=new WeakSet,SJ=function(){return De(this,ew,"f")||De(this,id,"f")<De(this,pE,"f")},AJ=function(){return De(this,ts,"f")<De(this,rw,"f")},RJ=function(){var e;Qr(this,ts,(e=De(this,ts,"f"),e--,e),"f"),De(this,_n,"m",dE).call(this),this.emit("next")},TJ=function(){De(this,_n,"m",vk).call(this),De(this,_n,"m",Ek).call(this),Qr(this,Z3,void 0,"f")},IJ=function(){let e=Date.now();if(De(this,Ya,"f")===void 0){let t=De(this,uE,"f")-e;if(t<0)Qr(this,id,De(this,J3,"f")?De(this,ts,"f"):0,"f");else return De(this,Z3,"f")===void 0&&Qr(this,Z3,setTimeout(()=>{De(this,_n,"m",TJ).call(this)},t),"f"),!0}return!1},dE=function(){if(De(this,es,"f").size===0)return De(this,Ya,"f")&&clearInterval(De(this,Ya,"f")),Qr(this,Ya,void 0,"f"),this.emit("empty"),De(this,ts,"f")===0&&this.emit("idle"),!1;if(!De(this,nd,"f")){let e=!De(this,_n,"a",IJ);if(De(this,_n,"a",SJ)&&De(this,_n,"a",AJ)){let t=De(this,es,"f").dequeue();return t?(this.emit("active"),t(),e&&De(this,_n,"m",Ek).call(this),!0):!1}}return!1},Ek=function(){De(this,ew,"f")||De(this,Ya,"f")!==void 0||(Qr(this,Ya,setInterval(()=>{De(this,_n,"m",vk).call(this)},De(this,tw,"f")),"f"),Qr(this,uE,Date.now()+De(this,tw,"f"),"f"))},vk=function(){De(this,id,"f")===0&&De(this,ts,"f")===0&&De(this,Ya,"f")&&(clearInterval(De(this,Ya,"f")),Qr(this,Ya,void 0,"f")),Qr(this,id,De(this,J3,"f")?De(this,ts,"f"):0,"f"),De(this,_n,"m",mE).call(this)},mE=function(){for(;De(this,_n,"m",dE).call(this););},CJ=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new gE("The task was aborted."))},{once:!0})})},hE=async function(e,t){return new Promise(n=>{let i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};async function kJ(r,e,t,n,i,o,s,a){if(e instanceof Uint8Array){t.push(np(e,n,i,o));return}if(e.Data==null)throw(0,yE.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=st.unmarshal(e.Data)}catch(l){throw(0,yE.default)(l,"ERR_NOT_UNIXFS")}if(c.data!=null){let l=c.data,f=np(l,n,i,o);t.push(f),n+=f.byteLength}let u=[];for(let l=0;l<e.Links.length;l++){let f=e.Links[l],h=n,d=h+c.blockSizes[l];if((i>=h&&i<d||o>=h&&o<=d||i<h&&o>d)&&u.push({link:f,blockStart:n}),n=d,n>o)break}await Ne(u,l=>Bi(l,f=>async()=>{let h=await r.get(f.link.Hash,{signal:a.signal});return{...f,block:h}}),l=>wk(l,{ordered:!0}),async l=>{for await(let{link:f,block:h,blockStart:d}of l){let p;switch(f.Hash.code){case Zo:p=Jo(h);break;case Sc:p=h;break;default:t.end((0,yE.default)(new Error(`Unsupported codec: ${f.Hash.code}`),"ERR_NOT_UNIXFS"));return}s.add(async()=>{await kJ(r,p,t,d,i,o,s,a)})}})}var KIe=(r,e,t,n,i,o,s)=>{async function*a(c={}){let u=t.fileSize();if(u===void 0)throw new Error("File was a directory");let{offset:l,length:f}=Cm(u,c.offset,c.length);if(f===0)return;let h=new Hs({concurrency:1}),d=jn();h.add(async()=>{await kJ(s,e,d,0,l,l+f,h,c)}),h.on("error",g=>{d.end(g)});let p=0;for await(let g of d)g!=null&&(p+=g.byteLength,p===f&&d.end(),yield g)}return a},xk=KIe;var $Ie=(r,e,t,n,i,o,s)=>{async function*a(c={}){let u=c.offset||0,l=c.length||e.Links.length,f=e.Links.slice(u,l);for(let h of f){let d=await i(h.Hash,h.Name||"",`${n}/${h.Name||""}`,[],o+1,s,c);d.entry&&(yield d.entry)}}return a},NJ=$Ie;var qIe=(r,e,t,n,i,o,s)=>{function a(c={}){return DJ(e,n,i,o,s,c)}return a};async function*DJ(r,e,t,n,i,o){let s=r.Links;for(let a of s){let c=a.Name!=null?a.Name.substring(2):null;if(c)yield(await t(a.Hash,c,`${e}/${c}`,[],n+1,i,o)).entry;else{let u=await i.get(a.Hash);r=Jo(u);for await(let l of DJ(r,e,t,n,i,o))yield l}}}var OJ=qIe;var HIe=(r,e)=>{let t=r.Links.find(n=>n.Name===e);return t&&t.Hash},GIe={raw:xk,file:xk,directory:NJ,"hamt-sharded-directory":OJ,metadata:(r,e,t,n,i,o,s)=>()=>[],symlink:(r,e,t,n,i,o,s)=>()=>[]},jIe=async(r,e,t,n,i,o,s,a)=>{let c=await s.get(r,a),u=Jo(c),l,f;if(e||(e=r.toString()),u.Data==null)throw(0,wE.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=st.unmarshal(u.Data)}catch(h){throw(0,wE.default)(h,"ERR_NOT_UNIXFS")}if(t||(t=e),n.length){let h;if(l&&l.type==="hamt-sharded-directory"?h=await EJ(u,n[0],s):h=HIe(u,n[0]),!h)throw(0,wE.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let d=n.shift(),p=`${t}/${d}`;f={cid:h,toResolve:n,name:d||"",path:p}}return{entry:{type:l.isDirectory()?"directory":"file",name:e,path:t,cid:r,content:GIe[l.type](r,u,l,t,i,o,s),unixfs:l,depth:o,node:u,size:l.fileSize()},next:f}},LJ=jIe;var BJ=C(ee(),1);var WIe=r=>{async function*e(t={}){let{offset:n,length:i}=Cm(r.length,t.offset,t.length);yield np(r,0,n,n+i)}return e},YIe=async(r,e,t,n,i,o,s,a)=>{if(n.length)throw(0,BJ.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await s.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:WIe(c),depth:o,size:c.length,node:c}}},MJ=YIe;var UJ=C(ee(),1);var QIe=async(r,e,t,n,i,o,s,a)=>{let c=await s.get(r),u=E8(c),l=u,f=t;for(;n.length;){let h=n[0];if(h in l){n.shift(),f=`${f}/${h}`;let d=ce.asCID(l[h]);if(d)return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:o,size:c.length,content:async function*(){yield u}},next:{cid:d,name:h,path:f,toResolve:n}};l=l[h]}else throw(0,UJ.default)(new Error(`No property named ${h} found in cbor node ${r}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:o,size:c.length,content:async function*(){yield u}}}},FJ=QIe;var zJ=C(ee(),1);var XIe=r=>{async function*e(t={}){let{offset:n,length:i}=Cm(r.length,t.offset,t.length);yield np(r,0,n,n+i)}return e},ZIe=async(r,e,t,n,i,o,s,a)=>{if(n.length)throw(0,zJ.default)(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");let c=await Jn(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:XIe(c.digest),depth:o,size:c.digest.length,node:c.digest}}},VJ=ZIe;var JIe={[Zo]:LJ,[Sc]:MJ,[W$]:FJ,[Ns.code]:VJ};function $J(r,e,t,n,i,o,s){let a=JIe[r.code];if(!a)throw(0,KJ.default)(new Error(`No resolver for code ${r.code}`),"ERR_NO_RESOLVER");return a(r,e,t,n,$J,i,o,s)}var qJ=$J;async function Sk(r){let e;for await(let t of r)e=t;return e}var eRe=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),tRe=r=>{if(r instanceof Uint8Array)return{cid:ce.decode(r),toResolve:[]};let e=ce.asCID(r);if(e)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));let t=eRe(r);return{cid:ce.parse(t[0]),toResolve:t.slice(1)}}throw(0,bE.default)(new Error(`Unknown path type ${r}`),"ERR_BAD_PATH")};async function*Ak(r,e,t={}){let{cid:n,toResolve:i}=tRe(r),o=n.toString(),s=o,a=i.length;for(;;){let c=await qJ(n,o,s,i,a,e,t);if(!c.entry&&!c.next)throw(0,bE.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;i=c.next.toResolve,n=c.next.cid,o=c.next.name,s=c.next.path}}async function Ei(r,e,t={}){let n=await Sk(Ak(r,e,t));if(!n)throw(0,bE.default)(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");return n}async function*_E(r,e,t={}){let n=await Ei(r,e,t);if(!n)return;if(yield n,n.type==="directory")for await(let o of i(n,t))yield o;async function*i(o,s){for await(let a of o.content(s))yield a,!(a instanceof Uint8Array)&&a.type==="directory"&&(yield*i(a,s))}}function HJ({repo:r,preload:e}){async function*t(n,i={}){if(n=N1(n),i.preload!==!1){let s=n.split("/");e(z.parse(s[0]))}let o=await Ei(n,r.blocks,i);if(o.type==="directory")throw new Error("this dag node is a directory");if(!o.content)throw new Error("this dag node has no content");yield*o.content(i)}return $(t)}var Um=C(ee(),1);var p2t="0".charCodeAt(0),m2t=cr("ustar\0","binary"),g2t=cr("ustar ","binary"),y2t=cr(" \0","binary");var QJ=C(jJ(),1);function nRe(r){return r[Symbol.asyncIterator]!=null}function iRe(r){if(nRe(r))return(async()=>{let n=new Uint8Array(0);for await(let i of r)n=yi([n,i],n.length+i.length);return n})();let e=[],t=0;for(let n of r)e.push(n),t+=n.byteLength;return yi(e,t)}var WJ=iRe;var oRe="0000000000000000000",sRe="7777777777777777777",aRe="0".charCodeAt(0),cRe=cr("ustar\0","binary"),uRe=cr("00","binary"),lRe=parseInt("7777",8),fRe=257,dRe=263,hRe=function(r){switch(r){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},pRe=function(r){let e=256;for(let t=0;t<148;t++)e+=r[t];for(let t=156;t<512;t++)e+=r[t];return e},od=function(r,e){let t=r.toString(8);return t.length>e?cr(sRe.slice(0,e)+" "):cr(oRe.slice(0,e-t.length)+t+" ")},Tk=function(r){let e=cr(r).byteLength,t=Math.floor(Math.log(e)/Math.log(10))+1;return e+t>=Math.pow(10,t)&&t++,`${e+t}${r}`};function YJ(r){let e="";r.name!=null&&(e+=Tk(" path="+r.name+`
`)),r.linkname!=null&&(e+=Tk(" linkpath="+r.linkname+`
`));let t=r.pax;if(t!=null)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e+=Tk(" "+n+"="+t[n]+`
`));return cr(e)}function EE(r){let e=new Uint8Array(512),t=r.name,n="";if(r.typeflag===5&&t[t.length-1]!=="/"&&(t+="/"),cr(t).byteLength!==t.length)return null;for(;cr(t).byteLength>100;){let i=t.indexOf("/");if(i===-1)return null;n+=n!==""?"/"+t.slice(0,i):t.slice(0,i),t=t.slice(i+1)}return cr(t).byteLength>100||cr(n).byteLength>155||r.linkname!=null&&cr(r.linkname).byteLength>100?null:(e.set(cr(t),0),e.set(od(r.mode&lRe,6),100),e.set(od(r.uid,6),108),e.set(od(r.gid,6),116),e.set(od(r.size,11),124),e.set(od(r.mtime.getTime()/1e3|0,11),136),e[156]=aRe+hRe(r.type),r.linkname!=null&&e.set(cr(r.linkname),157),e.set(cRe,fRe),e.set(uRe,dRe),r.uname!=null&&e.set(cr(r.uname),265),r.gname!=null&&e.set(cr(r.gname),297),e.set(od(r.devmajor??0,6),329),e.set(od(r.devminor??0,6),337),n!=null&&e.set(cr(n),345),e.set(od(pRe(e),6),148),e)}var{S_IFMT:gRe,S_IFBLK:yRe,S_IFCHR:wRe,S_IFDIR:bRe,S_IFIFO:_Re,S_IFLNK:ERe}=QJ.default,vRe=parseInt("755",8),xRe=parseInt("644",8),XJ=new Uint8Array(1024);function SRe(r=0){switch(r&gRe){case yRe:return"block-device";case wRe:return"character-device";case bRe:return"directory";case _Re:return"fifo";case ERe:return"symlink";default:return"file"}}function Rk(r){return r&=511,r!==0?XJ.subarray(0,512-r):new Uint8Array(0)}function Ik(r){if(r.pax==null){let e=EE(r);if(e!=null)return e}return ARe(r)}function ARe(r){let e=YJ(r),t={name:"PaxHeader",mode:r.mode,uid:r.uid,gid:r.gid,size:e.length,mtime:r.mtime,type:"pax-header",linkname:r.linkname,uname:r.uname,gname:r.gname,devmajor:r.devmajor,devminor:r.devminor};return new vt(EE(t)??new Uint8Array(0),e,Rk(e.length),EE({...t,size:r.size,type:r.type})??new Uint8Array(0)).subarray()}function vE(){return async function*(r){for await(let{header:e,body:t}of r){let n={...e,size:e.type==="symlink"?0:e.size??0,type:e.type??SRe(e.mode),mode:e.mode??(e.type==="directory"?vRe:xRe),uid:e.uid??0,gid:e.gid??0,mtime:e.mtime??new Date};if(typeof t=="string"&&(t=cr(t)),t instanceof Uint8Array||$c(t)){n.size=t.length,yield Ik(n),yield $c(t)?t.subarray():t,yield Rk(n.size);continue}if(n.type==="symlink"&&n.linkname==null){if(t==null)throw new Error("type was symlink but no linkname or body specified");n.linkname=$n(await WJ(t)),yield Ik(n);continue}if(yield Ik(n),n.type!=="file"&&n.type!=="contiguous-file")continue;let i=0;for await(let o of t??[])i+=o.length,yield $c(o)?o.subarray():o;if(i!==n.size)throw new Error(`size mismatch, wrote ${i} of ${n.size} bytes`);yield Rk(n.size)}yield XJ}}function Lm(r){let e=r.length;for(;--e>=0;)r[e]=0}var TRe=0,Bee=1,IRe=2,RRe=3,CRe=258,Zk=29,yw=256,uw=yw+1+Zk,Nm=30,Jk=19,Mee=2*uw+1,op=15,Ck=16,PRe=7,eN=256,Uee=16,Fee=17,zee=18,$k=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),RE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),kRe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Vee=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),NRe=512,hl=new Array((uw+2)*2);Lm(hl);var sw=new Array(Nm*2);Lm(sw);var lw=new Array(NRe);Lm(lw);var fw=new Array(CRe-RRe+1);Lm(fw);var tN=new Array(Zk);Lm(tN);var CE=new Array(Nm);Lm(CE);function Pk(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}var Kee,$ee,qee;function kk(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var Hee=r=>r<256?lw[r]:lw[256+(r>>>7)],dw=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},wo=(r,e,t)=>{r.bi_valid>Ck-t?(r.bi_buf|=e<<r.bi_valid&65535,dw(r,r.bi_buf),r.bi_buf=e>>Ck-r.bi_valid,r.bi_valid+=t-Ck):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Hc=(r,e,t)=>{wo(r,t[e*2],t[e*2+1])},Gee=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},DRe=r=>{r.bi_valid===16?(dw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},ORe=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length,u,l,f,h,d,p,g=0;for(h=0;h<=op;h++)r.bl_count[h]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<Mee;u++)l=r.heap[u],h=t[t[l*2+1]*2+1]+1,h>c&&(h=c,g++),t[l*2+1]=h,!(l>n)&&(r.bl_count[h]++,d=0,l>=a&&(d=s[l-a]),p=t[l*2],r.opt_len+=p*(h+d),o&&(r.static_len+=p*(i[l*2+1]+d)));if(g!==0){do{for(h=c-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[c]--,g-=2}while(g>0);for(h=c;h!==0;h--)for(l=r.bl_count[h];l!==0;)f=r.heap[--u],!(f>n)&&(t[f*2+1]!==h&&(r.opt_len+=(h-t[f*2+1])*t[f*2],t[f*2+1]=h),l--)}},jee=(r,e,t)=>{let n=new Array(op+1),i=0,o,s;for(o=1;o<=op;o++)i=i+t[o-1]<<1,n[o]=i;for(s=0;s<=e;s++){let a=r[s*2+1];a!==0&&(r[s*2]=Gee(n[a]++,a))}},LRe=()=>{let r,e,t,n,i,o=new Array(op+1);for(t=0,n=0;n<Zk-1;n++)for(tN[n]=t,r=0;r<1<<$k[n];r++)fw[t++]=n;for(fw[t-1]=n,i=0,n=0;n<16;n++)for(CE[n]=i,r=0;r<1<<RE[n];r++)lw[i++]=n;for(i>>=7;n<Nm;n++)for(CE[n]=i<<7,r=0;r<1<<RE[n]-7;r++)lw[256+i++]=n;for(e=0;e<=op;e++)o[e]=0;for(r=0;r<=143;)hl[r*2+1]=8,r++,o[8]++;for(;r<=255;)hl[r*2+1]=9,r++,o[9]++;for(;r<=279;)hl[r*2+1]=7,r++,o[7]++;for(;r<=287;)hl[r*2+1]=8,r++,o[8]++;for(jee(hl,uw+1,o),r=0;r<Nm;r++)sw[r*2+1]=5,sw[r*2]=Gee(r,5);Kee=new Pk(hl,$k,yw+1,uw,op),$ee=new Pk(sw,RE,0,Nm,op),qee=new Pk(new Array(0),kRe,0,Jk,PRe)},Wee=r=>{let e;for(e=0;e<uw;e++)r.dyn_ltree[e*2]=0;for(e=0;e<Nm;e++)r.dyn_dtree[e*2]=0;for(e=0;e<Jk;e++)r.bl_tree[e*2]=0;r.dyn_ltree[eN*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},Yee=r=>{r.bi_valid>8?dw(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},ZJ=(r,e,t,n)=>{let i=e*2,o=t*2;return r[i]<r[o]||r[i]===r[o]&&n[e]<=n[t]},Nk=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&ZJ(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!ZJ(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},JJ=(r,e,t)=>{let n,i,o=0,s,a;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+o++]&255,n+=(r.pending_buf[r.sym_buf+o++]&255)<<8,i=r.pending_buf[r.sym_buf+o++],n===0?Hc(r,i,e):(s=fw[i],Hc(r,s+yw+1,e),a=$k[s],a!==0&&(i-=tN[s],wo(r,i,a)),n--,s=Hee(n),Hc(r,s,t),a=RE[s],a!==0&&(n-=CE[s],wo(r,n,a)));while(o<r.sym_next);Hc(r,eN,e)},qk=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems,s,a,c=-1,u;for(r.heap_len=0,r.heap_max=Mee,s=0;s<o;s++)t[s*2]!==0?(r.heap[++r.heap_len]=c=s,r.depth[s]=0):t[s*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=c<2?++c:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,i&&(r.static_len-=n[u*2+1]);for(e.max_code=c,s=r.heap_len>>1;s>=1;s--)Nk(r,t,s);u=o;do s=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Nk(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=s,r.heap[--r.heap_max]=a,t[u*2]=t[s*2]+t[a*2],r.depth[u]=(r.depth[s]>=r.depth[a]?r.depth[s]:r.depth[a])+1,t[s*2+1]=t[a*2+1]=u,r.heap[1]=u++,Nk(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],ORe(r,e),jee(t,c,r.bl_count)},eee=(r,e,t)=>{let n,i=-1,o,s=e[0*2+1],a=0,c=7,u=4;for(s===0&&(c=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)o=s,s=e[(n+1)*2+1],!(++a<c&&o===s)&&(a<u?r.bl_tree[o*2]+=a:o!==0?(o!==i&&r.bl_tree[o*2]++,r.bl_tree[Uee*2]++):a<=10?r.bl_tree[Fee*2]++:r.bl_tree[zee*2]++,a=0,i=o,s===0?(c=138,u=3):o===s?(c=6,u=3):(c=7,u=4))},tee=(r,e,t)=>{let n,i=-1,o,s=e[0*2+1],a=0,c=7,u=4;for(s===0&&(c=138,u=3),n=0;n<=t;n++)if(o=s,s=e[(n+1)*2+1],!(++a<c&&o===s)){if(a<u)do Hc(r,o,r.bl_tree);while(--a!==0);else o!==0?(o!==i&&(Hc(r,o,r.bl_tree),a--),Hc(r,Uee,r.bl_tree),wo(r,a-3,2)):a<=10?(Hc(r,Fee,r.bl_tree),wo(r,a-3,3)):(Hc(r,zee,r.bl_tree),wo(r,a-11,7));a=0,i=o,s===0?(c=138,u=3):o===s?(c=6,u=3):(c=7,u=4)}},BRe=r=>{let e;for(eee(r,r.dyn_ltree,r.l_desc.max_code),eee(r,r.dyn_dtree,r.d_desc.max_code),qk(r,r.bl_desc),e=Jk-1;e>=3&&r.bl_tree[Vee[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},MRe=(r,e,t,n)=>{let i;for(wo(r,e-257,5),wo(r,t-1,5),wo(r,n-4,4),i=0;i<n;i++)wo(r,r.bl_tree[Vee[i]*2+1],3);tee(r,r.dyn_ltree,e-1),tee(r,r.dyn_dtree,t-1)},URe=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<yw;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},ree=!1,FRe=r=>{ree||(LRe(),ree=!0),r.l_desc=new kk(r.dyn_ltree,Kee),r.d_desc=new kk(r.dyn_dtree,$ee),r.bl_desc=new kk(r.bl_tree,qee),r.bi_buf=0,r.bi_valid=0,Wee(r)},Qee=(r,e,t,n)=>{wo(r,(TRe<<1)+(n?1:0),3),Yee(r),dw(r,t),dw(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},zRe=r=>{wo(r,Bee<<1,3),Hc(r,eN,hl),DRe(r)},VRe=(r,e,t,n)=>{let i,o,s=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=URe(r)),qk(r,r.l_desc),qk(r,r.d_desc),s=BRe(r),i=r.opt_len+3+7>>>3,o=r.static_len+3+7>>>3,o<=i&&(i=o)):i=o=t+5,t+4<=i&&e!==-1?Qee(r,e,t,n):r.strategy===4||o===i?(wo(r,(Bee<<1)+(n?1:0),3),JJ(r,hl,sw)):(wo(r,(IRe<<1)+(n?1:0),3),MRe(r,r.l_desc.max_code+1,r.d_desc.max_code+1,s+1),JJ(r,r.dyn_ltree,r.dyn_dtree)),Wee(r),n&&Yee(r)},KRe=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(fw[t]+yw+1)*2]++,r.dyn_dtree[Hee(e)*2]++),r.sym_next===r.sym_end),$Re=FRe,qRe=Qee,HRe=VRe,GRe=KRe,jRe=zRe,WRe={_tr_init:$Re,_tr_stored_block:qRe,_tr_flush_block:HRe,_tr_tally:GRe,_tr_align:jRe},YRe=(r,e,t,n)=>{let i=r&65535|0,o=r>>>16&65535|0,s=0;for(;t!==0;){s=t>2e3?2e3:t,t-=s;do i=i+e[n++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0},hw=YRe,QRe=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},XRe=new Uint32Array(QRe()),ZRe=(r,e,t,n)=>{let i=XRe,o=n+t;r^=-1;for(let s=n;s<o;s++)r=r>>>8^i[(r^e[s])&255];return r^-1},ci=ZRe,cp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},fp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:JRe,_tr_stored_block:Hk,_tr_flush_block:eCe,_tr_tally:cd,_tr_align:tCe}=WRe,{Z_NO_FLUSH:ud,Z_PARTIAL_FLUSH:rCe,Z_FULL_FLUSH:nCe,Z_FINISH:Gs,Z_BLOCK:nee,Z_OK:vi,Z_STREAM_END:iee,Z_STREAM_ERROR:Gc,Z_DATA_ERROR:iCe,Z_BUF_ERROR:Dk,Z_DEFAULT_COMPRESSION:oCe,Z_FILTERED:sCe,Z_HUFFMAN_ONLY:xE,Z_RLE:aCe,Z_FIXED:cCe,Z_DEFAULT_STRATEGY:uCe,Z_UNKNOWN:lCe,Z_DEFLATED:NE}=fp,fCe=9,dCe=15,hCe=8,pCe=29,mCe=256,Gk=mCe+1+pCe,gCe=30,yCe=19,wCe=2*Gk+1,bCe=15,Mt=3,ad=258,jc=ad+Mt+1,_Ce=32,Dm=42,rN=57,jk=69,Wk=73,Yk=91,Qk=103,sp=113,iw=666,so=1,Bm=2,up=3,Mm=4,ECe=3,ap=(r,e)=>(r.msg=cp[e],e),oee=r=>r*2-(r>4?9:0),sd=r=>{let e=r.length;for(;--e>=0;)r[e]=0},vCe=r=>{let e,t,n,i=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=i?t-i:0;while(--e);e=i,n=e;do t=r.prev[--n],r.prev[n]=t>=i?t-i:0;while(--e)},xCe=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,ld=xCe,rs=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ns=(r,e)=>{eCe(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,rs(r.strm)},or=(r,e)=>{r.pending_buf[r.pending++]=e},nw=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},Xk=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=hw(r.adler,e,i,t):r.state.wrap===2&&(r.adler=ci(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},Xee=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,o,s=r.prev_length,a=r.nice_match,c=r.strstart>r.w_size-jc?r.strstart-(r.w_size-jc):0,u=r.window,l=r.w_mask,f=r.prev,h=r.strstart+ad,d=u[n+s-1],p=u[n+s];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(u[i+s]!==p||u[i+s-1]!==d||u[i]!==u[n]||u[++i]!==u[n+1])){n+=2,i++;do;while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<h);if(o=ad-(h-n),n=h-ad,o>s){if(r.match_start=e,s=o,o>=a)break;d=u[n+s-1],p=u[n+s]}}while((e=f[e&l])>c&&--t!==0);return s<=r.lookahead?s:r.lookahead},Om=r=>{let e=r.w_size,t,n,i;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-jc)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),vCe(r),n+=e),r.strm.avail_in===0)break;if(t=Xk(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=Mt)for(i=r.strstart-r.insert,r.ins_h=r.window[i],r.ins_h=ld(r,r.ins_h,r.window[i+1]);r.insert&&(r.ins_h=ld(r,r.ins_h,r.window[i+Mt-1]),r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,r.insert--,!(r.lookahead+r.insert<Mt)););}while(r.lookahead<jc&&r.strm.avail_in!==0)},Zee=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,i,o,s=0,a=r.strm.avail_in;do{if(n=65535,o=r.bi_valid+42>>3,r.strm.avail_out<o||(o=r.strm.avail_out-o,i=r.strstart-r.block_start,n>i+r.strm.avail_in&&(n=i+r.strm.avail_in),n>o&&(n=o),n<t&&(n===0&&e!==Gs||e===ud||n!==i+r.strm.avail_in)))break;s=e===Gs&&n===i+r.strm.avail_in?1:0,Hk(r,0,0,s),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,rs(r.strm),i&&(i>n&&(i=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+i),r.strm.next_out),r.strm.next_out+=i,r.strm.avail_out-=i,r.strm.total_out+=i,r.block_start+=i,n-=i),n&&(Xk(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(s===0);return a-=r.strm.avail_in,a&&(a>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=a&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-a,r.strm.next_in),r.strstart),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),s?Mm:e!==ud&&e!==Gs&&r.strm.avail_in===0&&r.strstart===r.block_start?Bm:(o=r.window_size-r.strstart,r.strm.avail_in>o&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,o+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),o>r.strm.avail_in&&(o=r.strm.avail_in),o&&(Xk(r.strm,r.window,r.strstart,o),r.strstart+=o,r.insert+=o>r.w_size-r.insert?r.w_size-r.insert:o),r.high_water<r.strstart&&(r.high_water=r.strstart),o=r.bi_valid+42>>3,o=r.pending_buf_size-o>65535?65535:r.pending_buf_size-o,t=o>r.w_size?r.w_size:o,i=r.strstart-r.block_start,(i>=t||(i||e===Gs)&&e!==ud&&r.strm.avail_in===0&&i<=o)&&(n=i>o?o:i,s=e===Gs&&r.strm.avail_in===0&&n===i?1:0,Hk(r,r.block_start,n,s),r.block_start+=n,rs(r.strm)),s?up:so)},Ok=(r,e)=>{let t,n;for(;;){if(r.lookahead<jc){if(Om(r),r.lookahead<jc&&e===ud)return so;if(r.lookahead===0)break}if(t=0,r.lookahead>=Mt&&(r.ins_h=ld(r,r.ins_h,r.window[r.strstart+Mt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-jc&&(r.match_length=Xee(r,t)),r.match_length>=Mt)if(n=cd(r,r.strstart-r.match_start,r.match_length-Mt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=Mt){r.match_length--;do r.strstart++,r.ins_h=ld(r,r.ins_h,r.window[r.strstart+Mt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=ld(r,r.ins_h,r.window[r.strstart+1]);else n=cd(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(ns(r,!1),r.strm.avail_out===0))return so}return r.insert=r.strstart<Mt-1?r.strstart:Mt-1,e===Gs?(ns(r,!0),r.strm.avail_out===0?up:Mm):r.sym_next&&(ns(r,!1),r.strm.avail_out===0)?so:Bm},Pm=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<jc){if(Om(r),r.lookahead<jc&&e===ud)return so;if(r.lookahead===0)break}if(t=0,r.lookahead>=Mt&&(r.ins_h=ld(r,r.ins_h,r.window[r.strstart+Mt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=Mt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-jc&&(r.match_length=Xee(r,t),r.match_length<=5&&(r.strategy===sCe||r.match_length===Mt&&r.strstart-r.match_start>4096)&&(r.match_length=Mt-1)),r.prev_length>=Mt&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-Mt,n=cd(r,r.strstart-1-r.prev_match,r.prev_length-Mt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=ld(r,r.ins_h,r.window[r.strstart+Mt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=Mt-1,r.strstart++,n&&(ns(r,!1),r.strm.avail_out===0))return so}else if(r.match_available){if(n=cd(r,0,r.window[r.strstart-1]),n&&ns(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return so}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=cd(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<Mt-1?r.strstart:Mt-1,e===Gs?(ns(r,!0),r.strm.avail_out===0?up:Mm):r.sym_next&&(ns(r,!1),r.strm.avail_out===0)?so:Bm},SCe=(r,e)=>{let t,n,i,o,s=r.window;for(;;){if(r.lookahead<=ad){if(Om(r),r.lookahead<=ad&&e===ud)return so;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=Mt&&r.strstart>0&&(i=r.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){o=r.strstart+ad;do;while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);r.match_length=ad-(o-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=Mt?(t=cd(r,1,r.match_length-Mt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=cd(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(ns(r,!1),r.strm.avail_out===0))return so}return r.insert=0,e===Gs?(ns(r,!0),r.strm.avail_out===0?up:Mm):r.sym_next&&(ns(r,!1),r.strm.avail_out===0)?so:Bm},ACe=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(Om(r),r.lookahead===0)){if(e===ud)return so;break}if(r.match_length=0,t=cd(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(ns(r,!1),r.strm.avail_out===0))return so}return r.insert=0,e===Gs?(ns(r,!0),r.strm.avail_out===0?up:Mm):r.sym_next&&(ns(r,!1),r.strm.avail_out===0)?so:Bm};function qc(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var ow=[new qc(0,0,0,0,Zee),new qc(4,4,8,4,Ok),new qc(4,5,16,8,Ok),new qc(4,6,32,32,Ok),new qc(4,4,16,16,Pm),new qc(8,16,32,32,Pm),new qc(8,16,128,128,Pm),new qc(8,32,128,256,Pm),new qc(32,128,258,1024,Pm),new qc(32,258,258,4096,Pm)],TCe=r=>{r.window_size=2*r.w_size,sd(r.head),r.max_lazy_match=ow[r.level].max_lazy,r.good_match=ow[r.level].good_length,r.nice_match=ow[r.level].nice_length,r.max_chain_length=ow[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=Mt-1,r.match_available=0,r.ins_h=0};function ICe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=NE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(wCe*2),this.dyn_dtree=new Uint16Array((2*gCe+1)*2),this.bl_tree=new Uint16Array((2*yCe+1)*2),sd(this.dyn_ltree),sd(this.dyn_dtree),sd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(bCe+1),this.heap=new Uint16Array(2*Gk+1),sd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Gk+1),sd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ww=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.status!==Dm&&e.status!==rN&&e.status!==jk&&e.status!==Wk&&e.status!==Yk&&e.status!==Qk&&e.status!==sp&&e.status!==iw?1:0},Jee=r=>{if(ww(r))return ap(r,Gc);r.total_in=r.total_out=0,r.data_type=lCe;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?rN:e.wrap?Dm:sp,r.adler=e.wrap===2?0:1,e.last_flush=-2,JRe(e),vi},ete=r=>{let e=Jee(r);return e===vi&&TCe(r.state),e},RCe=(r,e)=>ww(r)||r.state.wrap!==2?Gc:(r.state.gzhead=e,vi),tte=(r,e,t,n,i,o)=>{if(!r)return Gc;let s=1;if(e===oCe&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>fCe||t!==NE||n<8||n>15||e<0||e>9||o<0||o>cCe||n===8&&s!==1)return ap(r,Gc);n===8&&(n=9);let a=new ICe;return r.state=a,a.strm=r,a.status=Dm,a.wrap=s,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Mt-1)/Mt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=o,a.method=t,ete(r)},CCe=(r,e)=>tte(r,e,NE,dCe,hCe,uCe),PCe=(r,e)=>{if(ww(r)||e>nee||e<0)return r?ap(r,Gc):Gc;let t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===iw&&e!==Gs)return ap(r,r.avail_out===0?Dk:Gc);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(rs(r),r.avail_out===0)return t.last_flush=-1,vi}else if(r.avail_in===0&&oee(e)<=oee(n)&&e!==Gs)return ap(r,Dk);if(t.status===iw&&r.avail_in!==0)return ap(r,Dk);if(t.status===Dm&&t.wrap===0&&(t.status=sp),t.status===Dm){let i=NE+(t.w_bits-8<<4)<<8,o=-1;if(t.strategy>=xE||t.level<2?o=0:t.level<6?o=1:t.level===6?o=2:o=3,i|=o<<6,t.strstart!==0&&(i|=_Ce),i+=31-i%31,nw(t,i),t.strstart!==0&&(nw(t,r.adler>>>16),nw(t,r.adler&65535)),r.adler=1,t.status=sp,rs(r),t.pending!==0)return t.last_flush=-1,vi}if(t.status===rN){if(r.adler=0,or(t,31),or(t,139),or(t,8),t.gzhead)or(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),or(t,t.gzhead.time&255),or(t,t.gzhead.time>>8&255),or(t,t.gzhead.time>>16&255),or(t,t.gzhead.time>>24&255),or(t,t.level===9?2:t.strategy>=xE||t.level<2?4:0),or(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(or(t,t.gzhead.extra.length&255),or(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=ci(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=jk;else if(or(t,0),or(t,0),or(t,0),or(t,0),or(t,0),or(t,t.level===9?2:t.strategy>=xE||t.level<2?4:0),or(t,ECe),t.status=sp,rs(r),t.pending!==0)return t.last_flush=-1,vi}if(t.status===jk){if(t.gzhead.extra){let i=t.pending,o=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+o>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex+=a,rs(r),t.pending!==0)return t.last_flush=-1,vi;i=0,o-=a}let s=new Uint8Array(t.gzhead.extra);t.pending_buf.set(s.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending+=o,t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=Wk}if(t.status===Wk){if(t.gzhead.name){let i=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i)),rs(r),t.pending!==0)return t.last_flush=-1,vi;i=0}t.gzindex<t.gzhead.name.length?o=t.gzhead.name.charCodeAt(t.gzindex++)&255:o=0,or(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=Yk}if(t.status===Yk){if(t.gzhead.comment){let i=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i)),rs(r),t.pending!==0)return t.last_flush=-1,vi;i=0}t.gzindex<t.gzhead.comment.length?o=t.gzhead.comment.charCodeAt(t.gzindex++)&255:o=0,or(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>i&&(r.adler=ci(r.adler,t.pending_buf,t.pending-i,i))}t.status=Qk}if(t.status===Qk){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(rs(r),t.pending!==0))return t.last_flush=-1,vi;or(t,r.adler&255),or(t,r.adler>>8&255),r.adler=0}if(t.status=sp,rs(r),t.pending!==0)return t.last_flush=-1,vi}if(r.avail_in!==0||t.lookahead!==0||e!==ud&&t.status!==iw){let i=t.level===0?Zee(t,e):t.strategy===xE?ACe(t,e):t.strategy===aCe?SCe(t,e):ow[t.level].func(t,e);if((i===up||i===Mm)&&(t.status=iw),i===so||i===up)return r.avail_out===0&&(t.last_flush=-1),vi;if(i===Bm&&(e===rCe?tCe(t):e!==nee&&(Hk(t,0,0,!1),e===nCe&&(sd(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),rs(r),r.avail_out===0))return t.last_flush=-1,vi}return e!==Gs?vi:t.wrap<=0?iee:(t.wrap===2?(or(t,r.adler&255),or(t,r.adler>>8&255),or(t,r.adler>>16&255),or(t,r.adler>>24&255),or(t,r.total_in&255),or(t,r.total_in>>8&255),or(t,r.total_in>>16&255),or(t,r.total_in>>24&255)):(nw(t,r.adler>>>16),nw(t,r.adler&65535)),rs(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?vi:iee)},kCe=r=>{if(ww(r))return Gc;let e=r.state.status;return r.state=null,e===sp?ap(r,iCe):vi},NCe=(r,e)=>{let t=e.length;if(ww(r))return Gc;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==Dm||n.lookahead)return Gc;if(i===1&&(r.adler=hw(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(sd(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}let o=r.avail_in,s=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,Om(n);n.lookahead>=Mt;){let c=n.strstart,u=n.lookahead-(Mt-1);do n.ins_h=ld(n,n.ins_h,n.window[c+Mt-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--u);n.strstart=c,n.lookahead=Mt-1,Om(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Mt-1,n.match_available=0,r.next_in=s,r.input=a,r.avail_in=o,n.wrap=i,vi},DCe=CCe,OCe=tte,LCe=ete,BCe=Jee,MCe=RCe,UCe=PCe,FCe=kCe,zCe=NCe,VCe="pako deflate (from Nodeca project)",aw={deflateInit:DCe,deflateInit2:OCe,deflateReset:LCe,deflateResetKeep:BCe,deflateSetHeader:MCe,deflate:UCe,deflateEnd:FCe,deflateSetDictionary:zCe,deflateInfo:VCe},KCe=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),$Ce=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)KCe(t,n)&&(r[n]=t[n])}}return r},qCe=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,o=r.length;n<o;n++){let s=r[n];t.set(s,i),i+=s.length}return t},DE={assign:$Ce,flattenChunks:qCe},rte=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{rte=!1}var pw=new Uint8Array(256);for(let r=0;r<256;r++)pw[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;pw[254]=pw[254]=1;var HCe=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,o,s=r.length,a=0;for(i=0;i<s;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<s&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<s&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e},GCe=(r,e)=>{if(e<65534&&r.subarray&&rte)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},jCe=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,o=new Array(t*2);for(i=0,n=0;n<t;){let s=r[n++];if(s<128){o[i++]=s;continue}let a=pw[s];if(a>4){o[i++]=65533,n+=a-1;continue}for(s&=a===2?31:a===3?15:7;a>1&&n<t;)s=s<<6|r[n++]&63,a--;if(a>1){o[i++]=65533;continue}s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|s&1023)}return GCe(o,i)},WCe=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+pw[r[t]]>e?t:e},mw={string2buf:HCe,buf2string:jCe,utf8border:WCe};function YCe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var nte=YCe,ite=Object.prototype.toString,{Z_NO_FLUSH:QCe,Z_SYNC_FLUSH:XCe,Z_FULL_FLUSH:ZCe,Z_FINISH:JCe,Z_OK:PE,Z_STREAM_END:ePe,Z_DEFAULT_COMPRESSION:tPe,Z_DEFAULT_STRATEGY:rPe,Z_DEFLATED:nPe}=fp;function bw(r){this.options=DE.assign({level:tPe,method:nPe,chunkSize:16384,windowBits:15,memLevel:8,strategy:rPe},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nte,this.strm.avail_out=0;let t=aw.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==PE)throw new Error(cp[t]);if(e.header&&aw.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=mw.string2buf(e.dictionary):ite.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=aw.deflateSetDictionary(this.strm,n),t!==PE)throw new Error(cp[t]);this._dict_set=!0}}bw.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?JCe:QCe,typeof r=="string"?t.input=mw.string2buf(r):ite.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(o===XCe||o===ZCe)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(i=aw.deflate(t,o),i===ePe)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=aw.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===PE;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};bw.prototype.onData=function(r){this.chunks.push(r)};bw.prototype.onEnd=function(r){r===PE&&(this.result=DE.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function nN(r,e){let t=new bw(e);if(t.push(r,!0),t.err)throw t.msg||cp[t.err];return t.result}function iPe(r,e){return e=e||{},e.raw=!0,nN(r,e)}function oPe(r,e){return e=e||{},e.gzip=!0,nN(r,e)}var sPe=bw,aPe=nN,cPe=iPe,uPe=oPe,lPe=fp,fPe={Deflate:sPe,deflate:aPe,deflateRaw:cPe,gzip:uPe,constants:lPe},SE=16209,dPe=16191,hPe=function(e,t){let n,i,o,s,a,c,u,l,f,h,d,p,g,w,_,x,m,y,b,E,v,S,A,I,k=e.state;n=e.next_in,A=e.input,i=n+(e.avail_in-5),o=e.next_out,I=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),c=k.dmax,u=k.wsize,l=k.whave,f=k.wnext,h=k.window,d=k.hold,p=k.bits,g=k.lencode,w=k.distcode,_=(1<<k.lenbits)-1,x=(1<<k.distbits)-1;e:do{p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),m=g[d&_];t:for(;;){if(y=m>>>24,d>>>=y,p-=y,y=m>>>16&255,y===0)I[o++]=m&65535;else if(y&16){b=m&65535,y&=15,y&&(p<y&&(d+=A[n++]<<p,p+=8),b+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),m=w[d&x];r:for(;;){if(y=m>>>24,d>>>=y,p-=y,y=m>>>16&255,y&16){if(E=m&65535,y&=15,p<y&&(d+=A[n++]<<p,p+=8,p<y&&(d+=A[n++]<<p,p+=8)),E+=d&(1<<y)-1,E>c){e.msg="invalid distance too far back",k.mode=SE;break e}if(d>>>=y,p-=y,y=o-s,E>y){if(y=E-y,y>l&&k.sane){e.msg="invalid distance too far back",k.mode=SE;break e}if(v=0,S=h,f===0){if(v+=u-y,y<b){b-=y;do I[o++]=h[v++];while(--y);v=o-E,S=I}}else if(f<y){if(v+=u+f-y,y-=f,y<b){b-=y;do I[o++]=h[v++];while(--y);if(v=0,f<b){y=f,b-=y;do I[o++]=h[v++];while(--y);v=o-E,S=I}}}else if(v+=f-y,y<b){b-=y;do I[o++]=h[v++];while(--y);v=o-E,S=I}for(;b>2;)I[o++]=S[v++],I[o++]=S[v++],I[o++]=S[v++],b-=3;b&&(I[o++]=S[v++],b>1&&(I[o++]=S[v++]))}else{v=o-E;do I[o++]=I[v++],I[o++]=I[v++],I[o++]=I[v++],b-=3;while(b>2);b&&(I[o++]=I[v++],b>1&&(I[o++]=I[v++]))}}else if(y&64){e.msg="invalid distance code",k.mode=SE;break e}else{m=w[(m&65535)+(d&(1<<y)-1)];continue r}break}}else if(y&64)if(y&32){k.mode=dPe;break e}else{e.msg="invalid literal/length code",k.mode=SE;break e}else{m=g[(m&65535)+(d&(1<<y)-1)];continue t}break}}while(n<i&&o<a);b=p>>3,n-=b,p-=b<<3,d&=(1<<p)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=o<a?257+(a-o):257-(o-a),k.hold=d,k.bits=p},km=15,see=852,aee=592,cee=0,Lk=1,uee=2,pPe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mPe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gPe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),yPe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),wPe=(r,e,t,n,i,o,s,a)=>{let c=a.bits,u=0,l=0,f=0,h=0,d=0,p=0,g=0,w=0,_=0,x=0,m,y,b,E,v,S=null,A,I=new Uint16Array(km+1),k=new Uint16Array(km+1),N=null,O,G,R;for(u=0;u<=km;u++)I[u]=0;for(l=0;l<n;l++)I[e[t+l]]++;for(d=c,h=km;h>=1&&I[h]===0;h--);if(d>h&&(d=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<h&&I[f]===0;f++);for(d<f&&(d=f),w=1,u=1;u<=km;u++)if(w<<=1,w-=I[u],w<0)return-1;if(w>0&&(r===cee||h!==1))return-1;for(k[1]=0,u=1;u<km;u++)k[u+1]=k[u]+I[u];for(l=0;l<n;l++)e[t+l]!==0&&(s[k[e[t+l]]++]=l);if(r===cee?(S=N=s,A=20):r===Lk?(S=pPe,N=mPe,A=257):(S=gPe,N=yPe,A=0),x=0,l=0,u=f,v=o,p=d,g=0,b=-1,_=1<<d,E=_-1,r===Lk&&_>see||r===uee&&_>aee)return 1;for(;;){O=u-g,s[l]+1<A?(G=0,R=s[l]):s[l]>=A?(G=N[s[l]-A],R=S[s[l]-A]):(G=32+64,R=0),m=1<<u-g,y=1<<p,f=y;do y-=m,i[v+(x>>g)+y]=O<<24|G<<16|R|0;while(y!==0);for(m=1<<u-1;x&m;)m>>=1;if(m!==0?(x&=m-1,x+=m):x=0,l++,--I[u]===0){if(u===h)break;u=e[t+s[l]]}if(u>d&&(x&E)!==b){for(g===0&&(g=d),v+=f,p=u-g,w=1<<p;p+g<h&&(w-=I[p+g],!(w<=0));)p++,w<<=1;if(_+=1<<p,r===Lk&&_>see||r===uee&&_>aee)return 1;b=x&E,i[b]=d<<24|p<<16|v-o|0}}return x!==0&&(i[v+x]=u-g<<24|64<<16|0),a.bits=d,0},cw=wPe,bPe=0,ote=1,ste=2,{Z_FINISH:lee,Z_BLOCK:_Pe,Z_TREES:AE,Z_OK:lp,Z_STREAM_END:EPe,Z_NEED_DICT:vPe,Z_STREAM_ERROR:js,Z_DATA_ERROR:ate,Z_MEM_ERROR:cte,Z_BUF_ERROR:xPe,Z_DEFLATED:fee}=fp,OE=16180,dee=16181,hee=16182,pee=16183,mee=16184,gee=16185,yee=16186,wee=16187,bee=16188,_ee=16189,kE=16190,dl=16191,Bk=16192,Eee=16193,Mk=16194,vee=16195,xee=16196,See=16197,Aee=16198,TE=16199,IE=16200,Tee=16201,Iee=16202,Ree=16203,Cee=16204,Pee=16205,Uk=16206,kee=16207,Nee=16208,Kr=16209,ute=16210,lte=16211,SPe=852,APe=592,TPe=15,IPe=TPe,Dee=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function RPe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var dp=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.mode<OE||e.mode>lte?1:0},fte=r=>{if(dp(r))return js;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=OE,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(SPe),e.distcode=e.distdyn=new Int32Array(APe),e.sane=1,e.back=-1,lp},dte=r=>{if(dp(r))return js;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,fte(r)},hte=(r,e)=>{let t;if(dp(r))return js;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?js:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,dte(r))},pte=(r,e)=>{if(!r)return js;let t=new RPe;r.state=t,t.strm=r,t.window=null,t.mode=OE;let n=hte(r,e);return n!==lp&&(r.state=null),n},CPe=r=>pte(r,IPe),Oee=!0,Fk,zk,PPe=r=>{if(Oee){Fk=new Int32Array(512),zk=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(cw(ote,r.lens,0,288,Fk,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;cw(ste,r.lens,0,32,zk,0,r.work,{bits:5}),Oee=!1}r.lencode=Fk,r.lenbits=9,r.distcode=zk,r.distbits=5},mte=(r,e,t,n)=>{let i,o=r.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(t-n,t-n+i),o.wnext),n-=i,n?(o.window.set(e.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},kPe=(r,e)=>{let t,n,i,o,s,a,c,u,l,f,h,d,p,g,w=0,_,x,m,y,b,E,v,S,A=new Uint8Array(4),I,k,N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(dp(r)||!r.output||!r.input&&r.avail_in!==0)return js;t=r.state,t.mode===dl&&(t.mode=Bk),s=r.next_out,i=r.output,c=r.avail_out,o=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,f=a,h=c,S=lp;e:for(;;)switch(t.mode){case OE:if(t.wrap===0){t.mode=Bk;break}for(;l<16;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,A[0]=u&255,A[1]=u>>>8&255,t.check=ci(t.check,A,2,0),u=0,l=0,t.mode=dee;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=Kr;break}if((u&15)!==fee){r.msg="unknown compression method",t.mode=Kr;break}if(u>>>=4,l-=4,v=(u&15)+8,t.wbits===0&&(t.wbits=v),v>15||v>t.wbits){r.msg="invalid window size",t.mode=Kr;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=u&512?_ee:dl,u=0,l=0;break;case dee:for(;l<16;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(t.flags=u,(t.flags&255)!==fee){r.msg="unknown compression method",t.mode=Kr;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Kr;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&(A[0]=u&255,A[1]=u>>>8&255,t.check=ci(t.check,A,2,0)),u=0,l=0,t.mode=hee;case hee:for(;l<32;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&(A[0]=u&255,A[1]=u>>>8&255,A[2]=u>>>16&255,A[3]=u>>>24&255,t.check=ci(t.check,A,4,0)),u=0,l=0,t.mode=pee;case pee:for(;l<16;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&(A[0]=u&255,A[1]=u>>>8&255,t.check=ci(t.check,A,2,0)),u=0,l=0,t.mode=mee;case mee:if(t.flags&1024){for(;l<16;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&(A[0]=u&255,A[1]=u>>>8&255,t.check=ci(t.check,A,2,0)),u=0,l=0}else t.head&&(t.head.extra=null);t.mode=gee;case gee:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(v=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+d),v)),t.flags&512&&t.wrap&4&&(t.check=ci(t.check,n,d,o)),a-=d,o+=d,t.length-=d),t.length))break e;t.length=0,t.mode=yee;case yee:if(t.flags&2048){if(a===0)break e;d=0;do v=n[o+d++],t.head&&v&&t.length<65536&&(t.head.name+=String.fromCharCode(v));while(v&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=ci(t.check,n,d,o)),a-=d,o+=d,v)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=wee;case wee:if(t.flags&4096){if(a===0)break e;d=0;do v=n[o+d++],t.head&&v&&t.length<65536&&(t.head.comment+=String.fromCharCode(v));while(v&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=ci(t.check,n,d,o)),a-=d,o+=d,v)break e}else t.head&&(t.head.comment=null);t.mode=bee;case bee:if(t.flags&512){for(;l<16;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(t.wrap&4&&u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Kr;break}u=0,l=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=dl;break;case _ee:for(;l<32;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}r.adler=t.check=Dee(u),u=0,l=0,t.mode=kE;case kE:if(t.havedict===0)return r.next_out=s,r.avail_out=c,r.next_in=o,r.avail_in=a,t.hold=u,t.bits=l,vPe;r.adler=t.check=1,t.mode=dl;case dl:if(e===_Pe||e===AE)break e;case Bk:if(t.last){u>>>=l&7,l-=l&7,t.mode=Uk;break}for(;l<3;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}switch(t.last=u&1,u>>>=1,l-=1,u&3){case 0:t.mode=Eee;break;case 1:if(PPe(t),t.mode=TE,e===AE){u>>>=2,l-=2;break e}break;case 2:t.mode=xee;break;case 3:r.msg="invalid block type",t.mode=Kr}u>>>=2,l-=2;break;case Eee:for(u>>>=l&7,l-=l&7;l<32;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Kr;break}if(t.length=u&65535,u=0,l=0,t.mode=Mk,e===AE)break e;case Mk:t.mode=vee;case vee:if(d=t.length,d){if(d>a&&(d=a),d>c&&(d=c),d===0)break e;i.set(n.subarray(o,o+d),s),a-=d,o+=d,c-=d,s+=d,t.length-=d;break}t.mode=dl;break;case xee:for(;l<14;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(t.nlen=(u&31)+257,u>>>=5,l-=5,t.ndist=(u&31)+1,u>>>=5,l-=5,t.ncode=(u&15)+4,u>>>=4,l-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Kr;break}t.have=0,t.mode=See;case See:for(;t.have<t.ncode;){for(;l<3;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.lens[N[t.have++]]=u&7,u>>>=3,l-=3}for(;t.have<19;)t.lens[N[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,I={bits:t.lenbits},S=cw(bPe,t.lens,0,19,t.lencode,0,t.work,I),t.lenbits=I.bits,S){r.msg="invalid code lengths set",t.mode=Kr;break}t.have=0,t.mode=Aee;case Aee:for(;t.have<t.nlen+t.ndist;){for(;w=t.lencode[u&(1<<t.lenbits)-1],_=w>>>24,x=w>>>16&255,m=w&65535,!(_<=l);){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(m<16)u>>>=_,l-=_,t.lens[t.have++]=m;else{if(m===16){for(k=_+2;l<k;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(u>>>=_,l-=_,t.have===0){r.msg="invalid bit length repeat",t.mode=Kr;break}v=t.lens[t.have-1],d=3+(u&3),u>>>=2,l-=2}else if(m===17){for(k=_+3;l<k;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}u>>>=_,l-=_,v=0,d=3+(u&7),u>>>=3,l-=3}else{for(k=_+7;l<k;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}u>>>=_,l-=_,v=0,d=11+(u&127),u>>>=7,l-=7}if(t.have+d>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Kr;break}for(;d--;)t.lens[t.have++]=v}}if(t.mode===Kr)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Kr;break}if(t.lenbits=9,I={bits:t.lenbits},S=cw(ote,t.lens,0,t.nlen,t.lencode,0,t.work,I),t.lenbits=I.bits,S){r.msg="invalid literal/lengths set",t.mode=Kr;break}if(t.distbits=6,t.distcode=t.distdyn,I={bits:t.distbits},S=cw(ste,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,I),t.distbits=I.bits,S){r.msg="invalid distances set",t.mode=Kr;break}if(t.mode=TE,e===AE)break e;case TE:t.mode=IE;case IE:if(a>=6&&c>=258){r.next_out=s,r.avail_out=c,r.next_in=o,r.avail_in=a,t.hold=u,t.bits=l,hPe(r,h),s=r.next_out,i=r.output,c=r.avail_out,o=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,t.mode===dl&&(t.back=-1);break}for(t.back=0;w=t.lencode[u&(1<<t.lenbits)-1],_=w>>>24,x=w>>>16&255,m=w&65535,!(_<=l);){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(x&&!(x&240)){for(y=_,b=x,E=m;w=t.lencode[E+((u&(1<<y+b)-1)>>y)],_=w>>>24,x=w>>>16&255,m=w&65535,!(y+_<=l);){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}u>>>=y,l-=y,t.back+=y}if(u>>>=_,l-=_,t.back+=_,t.length=m,x===0){t.mode=Pee;break}if(x&32){t.back=-1,t.mode=dl;break}if(x&64){r.msg="invalid literal/length code",t.mode=Kr;break}t.extra=x&15,t.mode=Tee;case Tee:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Iee;case Iee:for(;w=t.distcode[u&(1<<t.distbits)-1],_=w>>>24,x=w>>>16&255,m=w&65535,!(_<=l);){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(!(x&240)){for(y=_,b=x,E=m;w=t.distcode[E+((u&(1<<y+b)-1)>>y)],_=w>>>24,x=w>>>16&255,m=w&65535,!(y+_<=l);){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}u>>>=y,l-=y,t.back+=y}if(u>>>=_,l-=_,t.back+=_,x&64){r.msg="invalid distance code",t.mode=Kr;break}t.offset=m,t.extra=x&15,t.mode=Ree;case Ree:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Kr;break}t.mode=Cee;case Cee:if(c===0)break e;if(d=h-c,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Kr;break}d>t.wnext?(d-=t.wnext,p=t.wsize-d):p=t.wnext-d,d>t.length&&(d=t.length),g=t.window}else g=i,p=s-t.offset,d=t.length;d>c&&(d=c),c-=d,t.length-=d;do i[s++]=g[p++];while(--d);t.length===0&&(t.mode=IE);break;case Pee:if(c===0)break e;i[s++]=t.length,c--,t.mode=IE;break;case Uk:if(t.wrap){for(;l<32;){if(a===0)break e;a--,u|=n[o++]<<l,l+=8}if(h-=c,r.total_out+=h,t.total+=h,t.wrap&4&&h&&(r.adler=t.check=t.flags?ci(t.check,i,h,s-h):hw(t.check,i,h,s-h)),h=c,t.wrap&4&&(t.flags?u:Dee(u))!==t.check){r.msg="incorrect data check",t.mode=Kr;break}u=0,l=0}t.mode=kee;case kee:if(t.wrap&&t.flags){for(;l<32;){if(a===0)break e;a--,u+=n[o++]<<l,l+=8}if(t.wrap&4&&u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Kr;break}u=0,l=0}t.mode=Nee;case Nee:S=EPe;break e;case Kr:S=ate;break e;case ute:return cte;case lte:default:return js}return r.next_out=s,r.avail_out=c,r.next_in=o,r.avail_in=a,t.hold=u,t.bits=l,(t.wsize||h!==r.avail_out&&t.mode<Kr&&(t.mode<Uk||e!==lee))&&mte(r,r.output,r.next_out,h-r.avail_out),f-=r.avail_in,h-=r.avail_out,r.total_in+=f,r.total_out+=h,t.total+=h,t.wrap&4&&h&&(r.adler=t.check=t.flags?ci(t.check,i,h,r.next_out-h):hw(t.check,i,h,r.next_out-h)),r.data_type=t.bits+(t.last?64:0)+(t.mode===dl?128:0)+(t.mode===TE||t.mode===Mk?256:0),(f===0&&h===0||e===lee)&&S===lp&&(S=xPe),S},NPe=r=>{if(dp(r))return js;let e=r.state;return e.window&&(e.window=null),r.state=null,lp},DPe=(r,e)=>{if(dp(r))return js;let t=r.state;return t.wrap&2?(t.head=e,e.done=!1,lp):js},OPe=(r,e)=>{let t=e.length,n,i,o;return dp(r)||(n=r.state,n.wrap!==0&&n.mode!==kE)?js:n.mode===kE&&(i=1,i=hw(i,e,t,0),i!==n.check)?ate:(o=mte(r,e,t,t),o?(n.mode=ute,cte):(n.havedict=1,lp))},LPe=dte,BPe=hte,MPe=fte,UPe=CPe,FPe=pte,zPe=kPe,VPe=NPe,KPe=DPe,$Pe=OPe,qPe="pako inflate (from Nodeca project)",pl={inflateReset:LPe,inflateReset2:BPe,inflateResetKeep:MPe,inflateInit:UPe,inflateInit2:FPe,inflate:zPe,inflateEnd:VPe,inflateGetHeader:KPe,inflateSetDictionary:$Pe,inflateInfo:qPe};function HPe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var GPe=HPe,gte=Object.prototype.toString,{Z_NO_FLUSH:jPe,Z_FINISH:WPe,Z_OK:gw,Z_STREAM_END:Vk,Z_NEED_DICT:Kk,Z_STREAM_ERROR:YPe,Z_DATA_ERROR:Lee,Z_MEM_ERROR:QPe}=fp;function _w(r){this.options=DE.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nte,this.strm.avail_out=0;let t=pl.inflateInit2(this.strm,e.windowBits);if(t!==gw)throw new Error(cp[t]);if(this.header=new GPe,pl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=mw.string2buf(e.dictionary):gte.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=pl.inflateSetDictionary(this.strm,e.dictionary),t!==gw)))throw new Error(cp[t])}_w.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,o,s,a;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?WPe:jPe,gte.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=pl.inflate(t,s),o===Kk&&i&&(o=pl.inflateSetDictionary(t,i),o===gw?o=pl.inflate(t,s):o===Lee&&(o=Kk));t.avail_in>0&&o===Vk&&t.state.wrap>0&&r[t.next_in]!==0;)pl.inflateReset(t),o=pl.inflate(t,s);switch(o){case YPe:case Lee:case Kk:case QPe:return this.onEnd(o),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||o===Vk))if(this.options.to==="string"){let c=mw.utf8border(t.output,t.next_out),u=t.next_out-c,l=mw.buf2string(t.output,c);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(c,c+u),0),this.onData(l)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===gw&&a===0)){if(o===Vk)return o=pl.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};_w.prototype.onData=function(r){this.chunks.push(r)};_w.prototype.onEnd=function(r){r===gw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=DE.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function iN(r,e){let t=new _w(e);if(t.push(r),t.err)throw t.msg||cp[t.err];return t.result}function XPe(r,e){return e=e||{},e.raw=!0,iN(r,e)}var ZPe=_w,JPe=iN,eke=XPe,tke=iN,rke=fp,nke={Inflate:ZPe,inflate:JPe,inflateRaw:eke,ungzip:tke,constants:rke},{Deflate:ike,deflate:oke,deflateRaw:ske,gzip:ake}=fPe,{Inflate:cke,inflate:uke,inflateRaw:lke,ungzip:fke}=nke,dke=ike,hke=oke,pke=ske,mke=ake,gke=cke,yke=uke,wke=lke,bke=fke,_ke=fp,oN={Deflate:dke,deflate:hke,deflateRaw:pke,gzip:mke,Inflate:gke,inflate:yke,inflateRaw:wke,ungzip:bke,constants:_ke};async function LE(r){let e=new Uint8Array(0);for await(let t of r)e=rt([e,t],e.length+t.length);return e}var yte=6;function wte({repo:r,preload:e}){async function*t(n,i={}){if(i.compressionLevel!=null&&(i.compressionLevel<-1||i.compressionLevel>9))throw(0,Um.default)(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(i.preload!==!1){let a;try{a=N1(n).split("/")}catch(c){throw(0,Um.default)(c,"ERR_INVALID_PATH")}e(z.parse(a[0]))}let o=z.asCID(n)||n,s=await Ei(o,r.blocks,i);if(s.type==="file"||s.type==="raw"){let a=[];!i.compress||i.archive===!0?a.push([{header:{name:s.path,mode:s.type==="file"&&s.unixfs.mode,mtime:s.type==="file"&&s.unixfs.mtime?new Date(s.unixfs.mtime.secs*1e3):void 0,size:s.size,type:"file"},body:s.content()}],vE()):a.push(s.content),i.compress&&a.push(async function*(c){let u=await LE(c);yield oN.gzip(u,{level:i.compressionLevel||yte})}),yield*Ne(...a);return}if(s.type==="directory"){let a=[_E(o,r.blocks,i),async function*(c){for await(let u of c){let l={header:{name:u.path,size:u.size}};if(u.type==="file")l.header.type="file",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0,l.body=u.content();else if(u.type==="raw")l.header.type="file",l.body=u.content();else if(u.type==="directory")l.header.type="directory",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0;else throw(0,Um.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");yield l}},vE()];if(i.compress){if(!i.archive)throw(0,Um.default)(new Error("file is not regular"),"ERR_INVALID_PATH");i.compress&&a.push(async function*(c){let u=await LE(c);yield oN.gzip(u,{level:i.compressionLevel||yte})})}yield*Ne(...a);return}throw(0,Um.default)(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS")}return $(t)}var bte=C(ee(),1);function _te({repo:r,preload:e}){async function*t(n,i={}){let o=N1(n),s=o.split("/");i.preload!==!1&&e(z.parse(s[0]));let a=z.asCID(o)||o,c=await Ei(a,r.blocks,i);if(c.type==="file"){yield wR(c);return}if(c.type==="directory"){for await(let u of c.content())yield wR(u);return}throw(0,bte.default)(new Error(`Unknown UnixFS type ${c.type}`),"ERR_UNKNOWN_UNIXFS_TYPE")}return $(t)}var BE=class{constructor({preload:e,repo:t,hashers:n,options:i}){let o=oJ({preload:e,repo:t,options:i,hashers:n});this.addAll=o,this.add=hZ({addAll:o}),this.cat=HJ({repo:t,preload:e}),this.get=wte({repo:t,preload:e}),this.ls=_te({repo:t,preload:e})}};var hp="0.18.1",Ete="",vte="^0.158.1";function xte({repo:r}){async function e(t={}){let n=await r.version.get();return{version:hp,commit:Ete,repo:`${n}`,"ipfs-core":hp,"interface-ipfs-core":vte}}return $(e)}var ME=C(ee(),1);var Eke=j("ipfs:components:id");function Ste({peerId:r,network:e}){async function t(n={}){let i=e.try();if(!i){if(n.peerId)throw new $u;if(r.publicKey==null)throw(0,ME.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:r,publicKey:re(r.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${hp}`,protocolVersion:"9000",protocols:[]}}let{libp2p:o}=i,s=n.peerId?n.peerId:r,a=await vke(s,o,n),c=re(a.metadata.get("AgentVersion")||new Uint8Array),u=re(a.metadata.get("ProtocolVersion")||new Uint8Array),l=a.id.toString(),f=a.publicKey?re(a.publicKey,"base64pad"):"";return{id:s,publicKey:f,addresses:(a.addresses||[]).map(h=>{let d=h.toString();return d.endsWith(`/p2p/${l}`)?d:`${d}/p2p/${l}`}).sort().map(h=>yt(h)),agentVersion:c,protocolVersion:u,protocols:(a.protocols||[]).sort()}}return $(t)}async function vke(r,e,t){let n=await e.peerStore.get(r);n||(n=await xke(r,e,t));let i=r.publicKey?r.publicKey:await e.peerStore.keyBook.get(r);if(i==null)try{i=await e.getPublicKey(r,t)}catch(o){Eke.error("Could not load public key for",r.toString(),o)}return{...n,publicKey:i,metadata:n.metadata||new Map,addresses:n.addresses.map(o=>o.multiaddr)}}async function xke(r,e,t){if(e.dht==null)throw(0,ME.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(let i of e.dht.findPeer(r,t))if(i.name==="FINAL_PEER")break;let n=await e.peerStore.get(r);if(!n)throw(0,ME.default)(new Error("Could not find peer"),"ERR_NOT_FOUND");return n}var $r=Ske;function Ske(r,e,t){var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(i=n.pop(),!i)return!1;Ate(i);for(var o;o=n.shift();)if(Ate(o),typeof r[o]>"u"&&(r[o]={}),r=r[o],!r||typeof r!="object")return!1;return r[i]=t,!0}function Ate(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}var Fm={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:r=>($r(r,"Discovery.MDNS.Enabled",!1),$r(r,"Discovery.webRTCStar.Enabled",!1),r.Swarm={...r.Swarm||{},DisableNatPortMap:!0},r)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:r=>($r(r,"Discovery.MDNS.Enabled",!0),$r(r,"Discovery.webRTCStar.Enabled",!0),$r(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:r=>{let e=cl();return $r(r,"Addresses.API",e.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),$r(r,"Addresses.Gateway",e.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),$r(r,"Addresses.Swarm",e.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),$r(r,"Addresses.Delegates",[]),$r(r,"Bootstrap",[]),$r(r,"Discovery.MDNS.Enabled",!1),$r(r,"Discovery.webRTCStar.Enabled",!1),$r(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!0}),r}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:r=>{let e=cl();return $r(r,"Addresses.API",e.Addresses.API),$r(r,"Addresses.Gateway",e.Addresses.Gateway),$r(r,"Addresses.Swarm",e.Addresses.Swarm),$r(r,"Addresses.Delegates",e.Addresses.Delegates),$r(r,"Bootstrap",e.Bootstrap),$r(r,"Discovery.MDNS.Enabled",e.Discovery.MDNS.Enabled),$r(r,"Discovery.webRTCStar.Enabled",e.Discovery.webRTCStar.Enabled),$r(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:r=>{let e=r.Swarm||{},t=e.ConnMgr||{};return t.LowWater=20,t.HighWater=40,e.ConnMgr=t,r.Swarm=e,r}},"default-power":{description:'Inverse of "lowpower" profile.',transform:r=>{let e=cl();return r.Swarm=e.Swarm,r}}};var Ake=j("ipfs:core:config");function Tte({repo:r}){return{getAll:$(e),get:$(t),set:$(n),replace:$(i),profiles:{apply:$(o),list:$(Tke)}};async function e(s={}){return r.config.getAll(s)}async function t(s,a){return s?r.config.get(s,a):Promise.reject(new Error("key argument is required"))}async function n(s,a,c){return r.config.set(s,a,c)}async function i(s,a){return r.config.replace(s,a)}async function o(s,a={dryRun:!1}){let{dryRun:c}=a,u=Fm[s];if(!u)throw new Error(`No profile with name '${s}' exists`);try{let l=await r.config.getAll(a),f=JSON.parse(JSON.stringify(l));return f=u.transform(f),c||await r.config.replace(f,a),delete l.Identity.PrivKey,delete f.Identity.PrivKey,{original:l,updated:f}}catch(l){throw Ake(l),new Error(`Could not apply profile '${s}' to config: ${l.message}`)}}}async function Tke(r){return Object.keys(Fm).map(e=>({name:e,description:Fm[e].description}))}function UE({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Ike(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t],o=z.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*sN(n,i))}else{let t=z.asCID(e);t?yield[r.join("/"),t]:yield*sN(e,r)}}function*sN(r,e){if(r==null||r instanceof Uint8Array)return;let t=z.asCID(r);t&&(yield[e.join("/"),t]);for(let[n,i]of Object.entries(r)){let o=[...e,n];yield*Ike(o,i)}}function*Rke(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t];yield i.join("/"),typeof n=="object"&&!z.asCID(n)&&(yield*aN(n,i))}else yield*aN(e,r)}function*aN(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!z.asCID(n)&&(yield*Rke(i,n))}}function Cke(r,e){let t=r;for(let[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let o=z.asCID(t);if(o)return{value:o,remaining:e.slice(n+1).join("/")}}return{value:t}}var cN=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:UE(),bytes:UE(),value:UE(),asBlock:UE()})}links(){return sN(this.value,[])}tree(){return aN(this.value,[])}get(e="/"){return Cke(this.value,e.split("/").filter(Boolean))}};function Ite({bytes:r,cid:e,value:t,codec:n}){let i=t!==void 0?t:n&&n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new cN({cid:e,bytes:r,value:i})}var fd=C(Xo(),1),FE={SHA2_256:18,LENGTH:32,DAG_PB:112},Rte=16+8+8+8;function Ew(r,e){if(!r.length)throw new Error("Unexpected end of data");let t=fd.default.decode(r);return e.seek(fd.default.decode.bytes),t}function Cte(r){let e=new DataView(r.buffer,r.byteOffset,r.byteLength),t=0;return{version:2,characteristics:[e.getBigUint64(t,!0),e.getBigUint64(t+=8,!0)],dataOffset:Number(e.getBigUint64(t+=8,!0)),dataSize:Number(e.getBigUint64(t+=8,!0)),indexOffset:Number(e.getBigUint64(t+=8,!0))}}function Pte(r){fd.default.decode(r);let e=fd.default.decode.bytes,t=fd.default.decode(r.subarray(fd.default.decode.bytes)),n=fd.default.decode.bytes;return e+n+t}var dd={Null:r=>r===null?r:void 0,Int:r=>Number.isInteger(r)?r:void 0,Float:r=>typeof r=="number"&&Number.isFinite(r)?r:void 0,String:r=>typeof r=="string"?r:void 0,Bool:r=>typeof r=="boolean"?r:void 0,Bytes:r=>r instanceof Uint8Array?r:void 0,Link:r=>r!==null&&typeof r=="object"&&r.asCID===r?r:void 0,List:r=>Array.isArray(r)?r:void 0,Map:r=>r!==null&&typeof r=="object"&&r.asCID!==r&&!Array.isArray(r)&&!(r instanceof Uint8Array)?r:void 0},vw={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":dd.Link,"CarV1HeaderOrV2Pragma > roots (anon)":r=>{if(dd.List(r)!==void 0){for(let e=0;e<r.length;e++){let t=r[e];if(t=vw["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==r[e]){let n=r.slice(0,e);for(let i=e;i<r.length;i++){let o=r[i];if(o=vw["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;n.push(o)}return n}}return r}},Int:dd.Int,CarV1HeaderOrV2Pragma:r=>{if(dd.Map(r)===void 0)return;let e=Object.entries(r),t=r,n=1;for(let i=0;i<e.length;i++){let[o,s]=e[i];switch(o){case"roots":{let a=vw["CarV1HeaderOrV2Pragma > roots (anon)"](r[o]);if(a===void 0)return;if(a!==s||t!==r){if(t===r){t={};for(let c=0;c<i;c++)t[e[c][0]]=e[c][1]}t.roots=a}}break;case"version":{n--;let a=vw.Int(r[o]);if(a===void 0)return;if(a!==s||t!==r){if(t===r){t={};for(let c=0;c<i;c++)t[e[c][0]]=e[c][1]}t.version=a}}break;default:return}}if(!(n>0))return t}},xw={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":dd.Link,"CarV1HeaderOrV2Pragma > roots (anon)":r=>{if(dd.List(r)!==void 0){for(let e=0;e<r.length;e++){let t=r[e];if(t=xw["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==r[e]){let n=r.slice(0,e);for(let i=e;i<r.length;i++){let o=r[i];if(o=xw["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;n.push(o)}return n}}return r}},Int:dd.Int,CarV1HeaderOrV2Pragma:r=>{if(dd.Map(r)===void 0)return;let e=Object.entries(r),t=r,n=1;for(let i=0;i<e.length;i++){let[o,s]=e[i];switch(o){case"roots":{let a=xw["CarV1HeaderOrV2Pragma > roots (anon)"](s);if(a===void 0)return;if(a!==s||t!==r){if(t===r){t={};for(let c=0;c<i;c++)t[e[c][0]]=e[c][1]}t.roots=a}}break;case"version":{n--;let a=xw.Int(s);if(a===void 0)return;if(a!==s||t!==r){if(t===r){t={};for(let c=0;c<i;c++)t[e[c][0]]=e[c][1]}t.version=a}}break;default:return}}if(!(n>0))return t}},kte={toTyped:vw.CarV1HeaderOrV2Pragma,toRepresentation:xw.CarV1HeaderOrV2Pragma};async function zE(r,e){let t=Ew(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR header (zero length)");let n=await r.exactly(t,!0),i=dT(n);if(kte.toTyped(i)===void 0)throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||e!==void 0&&i.version!==e)throw new Error(`Invalid CAR version: ${i.version}${e!==void 0?` (expected ${e})`:""}`);if(i.version===1){if(!Array.isArray(i.roots))throw new Error("Invalid CAR header format");return i}if(i.roots!==void 0)throw new Error("Invalid CAR header format");let o=Cte(await r.exactly(Rte,!0));r.seek(o.dataOffset-r.pos);let s=await zE(r,1);return Object.assign(s,o)}async function Pke(r){let e=await r.exactly(2,!1);if(e[0]===FE.SHA2_256&&e[1]===FE.LENGTH){let s=await r.exactly(34,!0),a=uf(s);return Xe.create(0,FE.DAG_PB,a)}let t=Ew(await r.upTo(8),r);if(t!==1)throw new Error(`Unexpected CID version (${t})`);let n=Ew(await r.upTo(8),r),i=await r.exactly(Pte(await r.upTo(8)),!0),o=uf(i);return Xe.create(t,n,o)}async function Nte(r){let e=r.pos,t=Ew(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=r.pos-e;let n=await Pke(r),i=t-Number(r.pos-e);return{cid:n,length:t,blockLength:i}}async function kke(r){let{cid:e,blockLength:t}=await Nte(r);return{bytes:await r.exactly(t,!0),cid:e}}async function Nke(r){let e=r.pos,{cid:t,length:n,blockLength:i}=await Nte(r),o={cid:t,length:n,blockLength:i,offset:e,blockOffset:r.pos};return r.seek(o.blockLength),o}function Dte(r){let e=(async()=>{let t=await zE(r);if(t.version===2){let n=r.pos-t.dataOffset;r=Oke(r,t.dataSize-n)}return t})();return{header:()=>e,async*blocks(){for(await e;(await r.upTo(8)).length>0;)yield await kke(r)},async*blocksIndex(){for(await e;(await r.upTo(8)).length>0;)yield await Nke(r)}}}function VE(r){let e=0;return{async upTo(t){return r.subarray(e,e+Math.min(t,r.length-e))},async exactly(t,n=!1){if(t>r.length-e)throw new Error("Unexpected end of data");let i=r.subarray(e,e+t);return n&&(e+=t),i},seek(t){e+=t},get pos(){return e}}}function Dke(r){let e=0,t=0,n=0,i=new Uint8Array(0),o=async s=>{t=i.length-n;let a=[i.subarray(n)];for(;t<s;){let u=await r();if(u==null)break;t<0?u.length>t&&a.push(u.subarray(-t)):a.push(u),t+=u.length}i=new Uint8Array(a.reduce((u,l)=>u+l.length,0));let c=0;for(let u of a)i.set(u,c),c+=u.length;n=0};return{async upTo(s){return i.length-n<s&&await o(s),i.subarray(n,n+Math.min(i.length-n,s))},async exactly(s,a=!1){if(i.length-n<s&&await o(s),i.length-n<s)throw new Error("Unexpected end of data");let c=i.subarray(n,n+s);return a&&(e+=s,n+=s),c},seek(s){e+=s,n+=s},get pos(){return e}}}function Ote(r){let e=r[Symbol.asyncIterator]();async function t(){let n=await e.next();return n.done?null:n.value}return Dke(t)}function Oke(r,e){let t=0;return{async upTo(n){let i=await r.upTo(n);return i.length+t>e&&(i=i.subarray(0,e-t)),i},async exactly(n,i=!1){let o=await r.exactly(n,i);if(o.length+t>e)throw new Error("Unexpected end of data");return i&&(t+=n),o},seek(n){t+=n,r.seek(n)},get pos(){return r.pos}}}var uN=C(Xo(),1),Lte=1;function lN(r){let e=fT({version:Lte,roots:r}),t=uN.default.encode(e.length),n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function Bte(r){return{async setRoots(e){let t=lN(e);await r.write(t)},async writeBlock(e){let{cid:t,bytes:n}=e;await r.write(new Uint8Array(uN.default.encode(t.bytes.length+n.length))),await r.write(t.bytes),n.length&&await r.write(n)},async close(){await r.end()},version(){return Lte}}}function KE(){}function Mte(){let r=[],e=null,t=KE,n=!1,i=null,o=KE,s=()=>(e||(e=new Promise(u=>{t=()=>{e=null,t=KE,u()}})),e),a={write(u){r.push(u);let l=s();return o(),l},async end(){n=!0;let u=s();o(),await u}},c={async next(){let u=r.shift();return u?(r.length===0&&t(),{done:!1,value:u}):n?(t(),{done:!0,value:void 0}):(i||(i=new Promise(l=>{o=()=>(i=null,o=KE,l(c.next()))})),i)}};return{writer:a,iterator:c}}var pp=class{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");let t=Xe.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}version(){return this._encoder.version()}static create(e){e=Lke(e);let{encoder:t,iterator:n}=Ute(),i=new pp(e,t),o=new $E(n);return{writer:i,out:o}}static createAppender(){let{encoder:e,iterator:t}=Ute();e.setRoots=()=>Promise.resolve();let n=new pp([],e),i=new $E(t);return{writer:n,out:i}}static async updateRootsInBytes(e,t){let n=VE(e);await zE(n);let i=lN(t);if(Number(n.pos)!==i.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${i.length} bytes)`);return e.set(i,0),e}},$E=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}};function Ute(){let r=Mte(),{writer:e,iterator:t}=r;return{encoder:Bte(e),iterator:t}}function Lke(r){if(r===void 0)return[];if(!Array.isArray(r)){let t=Xe.asCID(r);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}let e=[];for(let t of r){let n=Xe.asCID(t);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(n)}return e}var fN=async({cid:r,load:e,seen:t})=>{t=t||new Set;let n=r.toString(pr);if(t.has(n))return;let i=await e(r);if(t.add(n),i!==null)for(let[,o]of i.links())await fN({cid:o,load:e,seen:t})};var Fte=j("ipfs:components:dag:import"),Bke=[gf,zg];function zte({repo:r,preload:e,codecs:t}){async function*n(i,o={}){o.preload!==!1&&e(i);let s=z.asCID(i);if(!s)throw new Error(`Unexpected error converting CID type: ${i}`);Fte(`Exporting ${s} as car`);let{writer:a,out:c}=await pp.create([s]),u=null;(async()=>{try{let l=Mke(r,a,{signal:o.signal,timeout:o.timeout},t);await fN({cid:s,load:l})}catch(l){u=l}finally{a.close()}})();for await(let l of c){if(u)break;yield l}if(u)throw u}return $(n)}function Mke(r,e,t,n){return async i=>{let o=await n.getCodec(i.code);if(!o)throw new Error(`Can't decode links in block with codec 0x${i.code.toString(16)} to form complete DAG`);let s=await r.blocks.get(i,t);return Fte(`Adding block ${i} to car`),await e.put({cid:i,bytes:s}),Bke.includes(i.code)?null:Ite({bytes:s,cid:i,codec:o})}}async function mp(r){for await(let e of r)return e}var Vte=C(ee(),1);function Kte({codecs:r,repo:e,preload:t}){return $(async function(o,s={}){if(s.preload!==!1&&t(o),s.path){let f=s.localResolve?await mp(kf(o,s.path,r,e,s)):await Dr(kf(o,s.path,r,e,s));if(!f)throw(0,Vte.default)(new Error("Not found"),"ERR_NOT_FOUND");return f}let a=await r.getCodec(o.code),c=await e.blocks.get(o,s);return{value:a.decode(c),remainderPath:""}})}var qE=class{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},gp=class extends qE{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await $te(e);return new gp(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await qte(e);return new gp(t,n,i)}},Sw=class extends qE{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;let e=this._iterable[Symbol.asyncIterator]();return{async next(){let t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){let{version:t,roots:n,iterator:i}=await $te(e);return new Sw(t,n,i)}static async fromIterable(e){let{version:t,roots:n,iterator:i}=await qte(e);return new Sw(t,n,i)}};async function $te(r){if(!(r instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Hte(VE(r))}async function qte(r){if(!r||typeof r[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Hte(Ote(r))}async function Hte(r){let e=Dte(r),{version:t,roots:n}=await e.header();return{version:t,roots:n,iterator:e.blocks()}}var Gte=j("ipfs:components:dag:import");function jte({repo:r}){async function*e(t,n={}){let i=await r.gcLock.readLock();try{let o={signal:n.signal,timeout:n.timeout},s=ja(t),{value:a,done:c}=await s.peek();if(c)return;a&&s.push(a);let u;a instanceof Uint8Array?u=[s]:u=s;for await(let l of u){let f=await Uke(r,o,l);if(n.pinRoots!==!1)for(let h of f){let d="";try{await r.blocks.has(h)?(Gte(`Pinning root ${h}`),await r.pins.pinRecursively(h)):d="blockstore: block not found"}catch(p){d=p.message}yield{root:{cid:h,pinErrorMsg:d}}}}}finally{i()}}return $(e)}async function Uke(r,e,t){let n=await gp.fromIterable(t),i=await n.getRoots();return await sl(r.blocks.putMany(Mi(n,({cid:o,bytes:s})=>(Gte(`Import block ${o}`),{key:o,value:s})),{signal:e.signal})),i}function Wte({repo:r,codecs:e,hashers:t,preload:n}){async function i(o,s={}){let a=s.pin?await r.gcLock.readLock():null;try{let c=await e.getCodec(s.storeCodec||"dag-cbor");if(!c)throw new Error(`Unknown storeCodec ${s.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(s.inputCodec){if(!(o instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");let p=await e.getCodec(s.inputCodec);if(!p)throw new Error(`Unknown inputCodec ${s.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);o=p.decode(o)}let u=s.version!=null?s.version:1,l=await t.getHasher(s.hashAlg||"sha2-256");if(!l)throw new Error(`Unknown hash algorithm ${s.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);let f=c.encode(o),h=await l.digest(f),d=z.create(u,c.code,h);return await r.blocks.put(d,f,{signal:s.signal}),s.pin&&await r.pins.pinRecursively(d),s.preload!==!1&&n(d),d}finally{a&&a()}}return $(i)}function Yte({repo:r,codecs:e,preload:t}){async function n(i,o={}){let{cid:s}=Qu(i);return o.preload!==!1&&t(s),Pf(r,e,i,o)}return $(n)}var HE=class{constructor({repo:e,codecs:t,hashers:n,preload:i}){this.export=zte({repo:e,preload:i,codecs:t}),this.get=Kte({codecs:t,repo:e,preload:i}),this.import=jte({repo:e}),this.resolve=Yte({repo:e,codecs:t,preload:i}),this.put=Wte({repo:e,codecs:t,hashers:n,preload:i})}};function Qte(r){let e;try{e=Lt("sni").code}catch{return null}for(let[t,n]of r)if(t===e&&n!==void 0)return n;return null}function Xte(r){return r.some(([e,t])=>e===Lt("tls").code)}function is(r,e,t){let n=Zte[Lt(r).name];if(n===void 0)throw new Error(`Can't interpret protocol ${Lt(r).name}`);let i=n(e,t);return r===Lt("ip6").code?`[${i}]`:i}var Zte={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${is(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${is(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}/ipfs/${r}`},p2p:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}/p2p/${r}`},http:(r,e)=>{let t=Xte(e),n=Qte(e);if(t&&n!==null)return`https://${n}`;let i=t?"https://":"http://",o=e.pop();if(o===void 0)throw new Error("Unexpected end of multiaddr");let s=is(o[0],o[1]??"",e);return s=s.replace("tcp://",""),`${i}${s}`},tls:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return is(t[0],t[1]??"",e)},sni:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return is(t[0],t[1]??"",e)},https:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=is(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{let t=Xte(e),n=Qte(e);if(t&&n!==null)return`wss://${n}`;let i=t?"wss://":"ws://",o=e.pop();if(o===void 0)throw new Error("Unexpected end of multiaddr");let s=is(o[0],o[1]??"",e);return s=s.replace("tcp://",""),`${i}${s}`},wss:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=is(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`},"p2p-websocket-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}/p2p-webrtc-direct`}};function zm(r,e){let n=Xi(r).stringTuples(),i=n.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let o=Lt(i[0]),s=Zte[o.name];if(s==null)throw new Error(`No interpreter found for ${o.name}`);let a=s(i[1]??"",n);return(e==null?void 0:e.assumeHttp)!==!1&&i[0]===Lt("tcp").code&&(a=a.replace("tcp://","http://"),(i[1]==="443"||i[1]==="80")&&(i[1]==="443"&&(a=a.replace("http://","https://")),a=a.substring(0,a.lastIndexOf(":")))),a}function dN(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);r=[...r];for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}var Jte=C(O1(),1);var Fke=j("ipfs:preload"),zke=qn.default?qn.default:qn,Vke=new zke({concurrency:4});function ere(r,e={}){return Fke(r),Vke.add(async()=>{let n=(await Jte.default.post(r,{signal:e.signal})).body.getReader();try{for(;;){let{done:i}=await n.read();if(i)return}}finally{n.releaseLock()}})}var tre=C(Cy(),1),Aw=j("ipfs:preload");function rre(r={}){if(r.enabled=!!r.enabled,r.addresses=r.addresses||[],r.cache=r.cache||1e3,!r.enabled||!r.addresses.length)return Aw("preload disabled"),Object.assign(()=>{},{start:()=>{},stop:()=>{}});let e=!0,t=[],n=r.addresses.map(s=>zm(s)),i=(0,tre.default)(r.cache),o=async s=>{try{if(e)throw new Error(`preload ${s} but preloader is not started`);let a=s.toString();if(i.has(a))return;i.set(a,!0);let c=dN(n),u=!1,l=Date.now();for(let f of c){if(e)throw new Error(`preload aborted for ${a}`);let h;try{h=new AbortController,t=t.concat(h),await ere(`${f}/api/v0/refs?r=true&arg=${encodeURIComponent(a)}`,{signal:h.signal}),u=!0}catch(d){d.type!=="aborted"&&Aw.error(d)}finally{t=t.filter(d=>d!==h)}if(u)break}Aw(`${u?"":"un"}successfully preloaded ${a} in ${Date.now()-l}ms`)}catch(a){Aw.error(a)}};return o.start=()=>{e=!1},o.stop=()=>{e=!0,Aw(`aborting ${t.length} pending preload request(s)`),t.forEach(s=>s.abort()),t=[]},o}var GE=j("ipfs:mfs-preload");function nre({preload:r,files:e,options:t={}}){if(t.interval=t.interval||30*1e3,!t.enabled){GE("MFS preload disabled");let s=async()=>{};return{start:s,stop:s}}let n="",i,o=async()=>{try{let s=await e.stat("/"),a=s.cid.toString();n!==a&&(GE(`preloading updated MFS root ${n} -> ${s.cid}`),await r(s.cid),n=a)}catch(s){GE.error("failed to preload MFS root",s)}finally{i=setTimeout(o,t.interval)}};return{async start(){let s=await e.stat("/");n=s.cid.toString(),GE(`monitoring MFS root ${s.cid}`),i=setTimeout(o,t.interval)},stop(){clearTimeout(i)}}}var Tw=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},hN=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ire=r=>globalThis.DOMException===void 0?new hN(r):new DOMException(r),ore=r=>{let e=r.reason===void 0?ire("This operation was aborted."):r.reason;return e instanceof Error?e:ire(e)};function yp(r,e){let{milliseconds:t,fallback:n,message:i,customTimers:o={setTimeout,clearTimeout}}=e,s,c=new Promise((u,l)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:h}=e;h.aborted&&l(ore(h)),h.addEventListener("abort",()=>{l(ore(h))})}if(t===Number.POSITIVE_INFINITY){r.then(u,l);return}let f=new Tw;s=o.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(h){l(h)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?u():i instanceof Error?l(i):(f.message=i??`Promise timed out after ${t} milliseconds`,l(f))},t),(async()=>{try{u(await r)}catch(h){l(h)}})()}).finally(()=>{c.clear()});return c.clear=()=>{o.clearTimeout.call(void 0,s),s=void 0},c}function pN(r,e,t){let n=0,i=r.length;for(;i>0;){let o=Math.trunc(i/2),s=n+o;t(r[s],e)<=0?(n=++s,i-=o+1):i=o}return n}var Wc,Iw=class{constructor(){bt(this,Wc,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&ge(this,Wc)[this.size-1].priority>=t.priority){ge(this,Wc).push(n);return}let i=pN(ge(this,Wc),n,(o,s)=>s.priority-o.priority);ge(this,Wc).splice(i,0,n)}dequeue(){let e=ge(this,Wc).shift();return e==null?void 0:e.run}filter(e){return ge(this,Wc).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ge(this,Wc).length}};Wc=new WeakMap;var Vm,Km,hd,Rw,$m,Cw,Ws,qm,bo,Pw,Ys,Hm,ml,kw,QE,sre,XE,are,ZE,cre,JE,ure,e7,lre,Gm,jE,Nw,mN,Dw,gN,jm,WE,t7,fre,Wm,YE,Ym=class extends ky.default{constructor(t){var n,i;super();bt(this,QE);bt(this,XE);bt(this,ZE);bt(this,JE);bt(this,e7);bt(this,Gm);bt(this,Nw);bt(this,Dw);bt(this,jm);bt(this,t7);bt(this,Wm);bt(this,Vm,void 0);bt(this,Km,void 0);bt(this,hd,0);bt(this,Rw,void 0);bt(this,$m,void 0);bt(this,Cw,0);bt(this,Ws,void 0);bt(this,qm,void 0);bt(this,bo,void 0);bt(this,Pw,void 0);bt(this,Ys,0);bt(this,Hm,void 0);bt(this,ml,void 0);bt(this,kw,void 0);B(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Iw,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);Dt(this,Vm,t.carryoverConcurrencyCount),Dt(this,Km,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),Dt(this,Rw,t.intervalCap),Dt(this,$m,t.interval),Dt(this,bo,new t.queueClass),Dt(this,Pw,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,Dt(this,kw,t.throwOnTimeout===!0),Dt(this,ml,t.autoStart===!1)}get concurrency(){return ge(this,Hm)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);Dt(this,Hm,t),hi(this,jm,WE).call(this)}async add(t,n={}){return n={timeout:this.timeout,throwOnTimeout:ge(this,kw),...n},new Promise((i,o)=>{ge(this,bo).enqueue(async()=>{var s;uh(this,Ys)._++,uh(this,hd)._++;try{(s=n.signal)==null||s.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=yp(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,hi(this,t7,fre).call(this,n.signal)]));let c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof Tw&&!n.throwOnTimeout){i();return}o(a),this.emit("error",a)}finally{hi(this,ZE,cre).call(this)}},n),this.emit("add"),hi(this,Gm,jE).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return ge(this,ml)?(Dt(this,ml,!1),hi(this,jm,WE).call(this),this):this}pause(){Dt(this,ml,!0)}clear(){Dt(this,bo,new(ge(this,Pw)))}async onEmpty(){ge(this,bo).size!==0&&await hi(this,Wm,YE).call(this,"empty")}async onSizeLessThan(t){ge(this,bo).size<t||await hi(this,Wm,YE).call(this,"next",()=>ge(this,bo).size<t)}async onIdle(){ge(this,Ys)===0&&ge(this,bo).size===0||await hi(this,Wm,YE).call(this,"idle")}get size(){return ge(this,bo).size}sizeBy(t){return ge(this,bo).filter(t).length}get pending(){return ge(this,Ys)}get isPaused(){return ge(this,ml)}};Vm=new WeakMap,Km=new WeakMap,hd=new WeakMap,Rw=new WeakMap,$m=new WeakMap,Cw=new WeakMap,Ws=new WeakMap,qm=new WeakMap,bo=new WeakMap,Pw=new WeakMap,Ys=new WeakMap,Hm=new WeakMap,ml=new WeakMap,kw=new WeakMap,QE=new WeakSet,sre=function(){return ge(this,Km)||ge(this,hd)<ge(this,Rw)},XE=new WeakSet,are=function(){return ge(this,Ys)<ge(this,Hm)},ZE=new WeakSet,cre=function(){uh(this,Ys)._--,hi(this,Gm,jE).call(this),this.emit("next")},JE=new WeakSet,ure=function(){hi(this,Dw,gN).call(this),hi(this,Nw,mN).call(this),Dt(this,qm,void 0)},e7=new WeakSet,lre=function(){let t=Date.now();if(ge(this,Ws)===void 0){let n=ge(this,Cw)-t;if(n<0)Dt(this,hd,ge(this,Vm)?ge(this,Ys):0);else return ge(this,qm)===void 0&&Dt(this,qm,setTimeout(()=>{hi(this,JE,ure).call(this)},n)),!0}return!1},Gm=new WeakSet,jE=function(){if(ge(this,bo).size===0)return ge(this,Ws)&&clearInterval(ge(this,Ws)),Dt(this,Ws,void 0),this.emit("empty"),ge(this,Ys)===0&&this.emit("idle"),!1;if(!ge(this,ml)){let t=!ge(this,e7,lre);if(ge(this,QE,sre)&&ge(this,XE,are)){let n=ge(this,bo).dequeue();return n?(this.emit("active"),n(),t&&hi(this,Nw,mN).call(this),!0):!1}}return!1},Nw=new WeakSet,mN=function(){ge(this,Km)||ge(this,Ws)!==void 0||(Dt(this,Ws,setInterval(()=>{hi(this,Dw,gN).call(this)},ge(this,$m))),Dt(this,Cw,Date.now()+ge(this,$m)))},Dw=new WeakSet,gN=function(){ge(this,hd)===0&&ge(this,Ys)===0&&ge(this,Ws)&&(clearInterval(ge(this,Ws)),Dt(this,Ws,void 0)),Dt(this,hd,ge(this,Vm)?ge(this,Ys):0),hi(this,jm,WE).call(this)},jm=new WeakSet,WE=function(){for(;hi(this,Gm,jE).call(this););},t7=new WeakSet,fre=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},Wm=new WeakSet,YE=async function(t,n){return new Promise(i=>{let o=()=>{n&&!n()||(this.off(t,o),i())};this.on(t,o)})};var pd={},Qm=r=>{r.addEventListener("message",e=>{Qm.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Qm.dispatchEvent("message",r,e)})};Qm.addEventListener=(r,e)=>{pd[r]==null&&(pd[r]=[]),pd[r].push(e)};Qm.removeEventListener=(r,e)=>{pd[r]!=null&&(pd[r]=pd[r].filter(t=>t===e))};Qm.dispatchEvent=function(r,e,t){pd[r]!=null&&pd[r].forEach(n=>n(e,t))};var Xm=Qm;var yN="lock:worker:request-read",wN="lock:worker:release-read",bN="lock:master:grant-read",_N="lock:worker:request-write",EN="lock:worker:release-write",vN="lock:master:grant-write";var dre=(r=21)=>Math.random().toString().substring(2);var hre=(r,e,t,n,i)=>(o,s)=>{if(s.data.type!==t)return;let a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{o.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{let u=l=>{if(l==null||l.data==null)return;let f={type:l.data.type,name:l.data.name,identifier:l.data.identifier};f.type===n&&f.identifier===a.identifier&&(o.removeEventListener("message",u),c())};o.addEventListener("message",u)})}}}))},pre=(r,e,t,n)=>async()=>{let i=dre();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(o=>{let s=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",s),o(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",s)})},Kke={singleProcess:!1},mre=r=>{if(r=Object.assign({},Kke,r),!!globalThis.document||r.singleProcess){let t=new EventTarget;return Xm.addEventListener("message",hre(t,"requestReadLock",yN,wN,bN)),Xm.addEventListener("message",hre(t,"requestWriteLock",_N,EN,vN)),t}return{isWorker:!0,readLock:t=>pre(t,yN,bN,wN),writeLock:t=>pre(t,_N,vN,EN)}};var wp={},gd;async function xN(r,e){let t,n=new Promise(i=>{t=i});return r.add(async()=>yp((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}var $ke=(r,e)=>{if(gd.isWorker===!0)return{readLock:gd.readLock(r,e),writeLock:gd.writeLock(r,e)};let t=new Ym({concurrency:1}),n;return{async readLock(){if(n!=null)return xN(n,e);n=new Ym({concurrency:e.concurrency,autoStart:!1});let i=n,o=xN(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),o},async writeLock(){return n=null,xN(t,e)}}},qke={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function SN(r){let e=Object.assign({},qke,r);return gd==null&&(gd=mre(e),gd.isWorker!==!0&&(gd.addEventListener("requestReadLock",t=>{wp[t.data.name]!=null&&wp[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),gd.addEventListener("requestWriteLock",async t=>{wp[t.data.name]!=null&&wp[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),wp[e.name]==null&&(wp[e.name]=$ke(e.name,e)),wp[e.name]}var r7;function Ow(r=!1){if(r7)return r7;let e=SN({singleProcess:r});return r7={readLock:t=>async(...n)=>{let i=await e.readLock();try{return await t.apply(null,n)}finally{i()}},writeLock:t=>async(...n)=>{let i=await e.writeLock();try{return await t.apply(null,n)}finally{i()}}},r7}var AN=C(ee(),1);var gre=j("ipfs:mfs:utils:with-mfs-root");async function Zm(r,e){if(e&&e.signal&&e.signal.aborted)throw(0,AN.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.open();let t;try{let n=await r.repo.datastore.get(Ry);t=z.decode(n)}catch(n){if(n.code!=="ERR_NOT_FOUND")throw n;gre("Creating new MFS root");let i=pt({Data:new st({type:"directory"}).marshal(),Links:[]}),o=await dt.digest(i);if(t=z.createV0(o),await r.repo.blocks.put(t,i),e&&e.signal&&e.signal.aborted)throw(0,AN.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.put(Ry,t.bytes)}return gre(`Loaded MFS root /ipfs/${t}`),t}function Jm(r=""){return(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}var IN=C(ee(),1);var TN="ipfs",sn=async(r,e,t)=>{let n=await Zm(r,t),i={entryType:"file"},o="";if(z.asCID(e)?o=`/ipfs/${e}`:o=e.toString(),o=o.trim(),o=o.replace(/(\/\/+)/g,"/"),o.endsWith("/")&&o.length>1&&(o=o.substring(0,o.length-1)),!o)throw(0,IN.default)(new Error("paths must not be empty"),"ERR_NO_PATH");if(o.substring(0,1)!=="/")throw(0,IN.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");o.substring(o.length-1)==="/"&&(o=o.substring(0,o.length-1));let s=Jm(o);if(s[0]===TN){let c;s.length===2?c=`/${s.join("/")}`:c=`/${s.slice(0,s.length-1).join("/")}`,i={type:"ipfs",depth:s.length-2,entryType:"file",mfsPath:`/${s.join("/")}`,mfsDirectory:c,parts:s,path:`/${s.join("/")}`,name:s[s.length-1]}}else{let c=`/${TN}/${n}${s.length?"/"+s.join("/"):""}`,u=`/${TN}/${n}/${s.slice(0,s.length-1).join("/")}`;i={type:"mfs",depth:s.length,entryType:"file",mfsDirectory:u,mfsPath:c,parts:s,path:`/${s.join("/")}`,name:s[s.length-1]}}let a=i.type==="mfs"?i.mfsPath:i.path;try{let c=await Ei(a,r.repo.blocks,t);i.cid=c.cid,i.mfsPath=`/ipfs/${c.path}`,i.entryType=c.type,i.content=c.content,(i.entryType==="file"||i.entryType==="directory")&&(c.type==="file"||c.type==="directory")&&(i.unixfs=c.unixfs)}catch(c){if(c.code!=="ERR_NOT_FOUND")throw c}return i.exists=!!i.cid,i};var wre=C(ee(),1);var Hke=et.bind({ignoreUndefined:!0}),Gke=j("ipfs:mfs:stat"),jke={withLocal:!1};function yd(r){async function e(t,n={}){n=Hke(jke,n),Gke(`Fetching stats for ${t}`);let{type:i,cid:o,mfsPath:s}=await sn(r,t,n),a=i==="ipfs"&&o?o:s,c;try{c=await Ei(a,r.repo.blocks)}catch(u){throw u.code==="ERR_NOT_FOUND"?(0,wre.default)(new Error(`${t} does not exist`),"ERR_NOT_FOUND"):u}if(!yre[c.type])throw new Error(`Cannot stat codec ${c.cid.code}`);return yre[c.type](c)}return $(e)}var yre={raw:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:r=>{let e={cid:r.cid,type:"file",size:r.unixfs.fileSize(),cumulativeSize:pt(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},directory:r=>{let e={cid:r.cid,type:"directory",size:0,cumulativeSize:pt(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},object:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})};var i2=C(ee(),1);var Wke=j("ipfs:mfs:utils:to-trail");async function Yc(r,e){Wke(`Creating trail for path ${e}`);let t=[];for await(let n of Ak(e,r.repo.blocks))t.push({name:n.name,cid:n.cid,size:n.size,type:n.type});return t}var n7=async(r,e,t)=>{t.codec||(t.codec=sr),t.hasher||(t.hasher=dt),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===sr&&t.hasher!==dt&&(t.cidVersion=1);let n=await t.hasher.digest(r),i=z.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(i,r,{signal:t.signal}),i};var i7=V3.code,o7=8;async function s7(r){return(await V3.encode(r)).subarray(0,8).reverse()}var RN=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}},e2=class extends RN{constructor(e,t){super(e,t),this._bucket=Tm({hashFn:s7,bits:o7})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*bre(this._bucket,e,this,this.options)}};async function*bre(r,e,t,n){let i=r._children,o=[],s=0;for(let d=0;d<i.length;d++){let p=i.get(d);if(!p)continue;let g=d.toString(16).toUpperCase().padStart(2,"0");if(p instanceof bn){let w;for await(let _ of await bre(p,e,null,n))w=_;if(!w)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:g,Tsize:w.size,Hash:w.cid}),s+=w.size}else if(typeof p.value.flush=="function"){let w=p.value,_;for await(let m of w.flush(e))_=m,yield _;let x=g+p.key;o.push({Name:x,Tsize:_.size,Hash:_.cid}),s+=_.size}else{let w=p.value;if(!w.cid)continue;let _=g+p.key,x=w.size;o.push({Name:_,Tsize:x,Hash:w.cid}),s+=x}}let a=Uint8Array.from(i.bitField().reverse()),u={Data:new st({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:i7,mtime:t&&t.mtime,mode:t&&t.mode}).marshal(),Links:o},l=pt(Xn(u)),f=await n7(l,e,n),h=l.length+s;yield{cid:f,node:u,size:h}}var Lw=j("ipfs:mfs:core:utils:hamt-utils"),t2=async(r,e,t,n)=>{if(!n.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");let i=Uint8Array.from(t._children.bitField().reverse()),o=st.unmarshal(n.parent.Data),s=new st({type:"hamt-sharded-directory",data:i,fanout:t.tableSize(),hashType:i7,mode:o.mode,mtime:o.mtime}),a=await r.hashers.getHasher(n.hashAlg),c={Data:s.marshal(),Links:e.sort((h,d)=>(h.Name||"").localeCompare(d.Name||""))},u=pt(c),l=await a.digest(u),f=z.create(n.cidVersion,kr,l);return n.flush&&await r.repo.blocks.put(f,u),{node:c,cid:f,size:e.reduce((h,d)=>h+(d.Tsize||0),u.length)}},CN=async(r,e,t,n,i)=>{let o=new bn({hash:t._options.hash,bits:t._options.bits},n,i);return n._putObjectAt(i,o),await Bw(r,e,o,t),o},PN=async r=>{let e=Tm({hashFn:s7,bits:o7});return await Promise.all(r.map(async t=>{let n=t.Name||"";if(n.length===2){let i=parseInt(n,16),o=new bn({hash:e._options.hash,bits:e._options.bits},e,i);return e._putObjectAt(i,o),Promise.resolve()}return e.put(n.substring(2),{size:t.Tsize,cid:t.Hash})})),e},Bw=async(r,e,t,n)=>{await Promise.all(e.map(async i=>{let o=i.Name||"";if(o.length===2){Lw("Populating sub bucket",o);let s=parseInt(o,16),a=await r.repo.blocks.get(i.Hash),c=en(a),u=new bn({hash:n._options.hash,bits:n._options.bits},t,s);return t._putObjectAt(s,u),await Bw(r,c.Links,u,n),Promise.resolve()}return n.put(o.substring(2),{size:i.Tsize,cid:i.Hash})}))},bp=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),_re=async(r,e,t)=>{let n=await PN(t.Links),i=await n._findNewBucketAndPos(e),o=[{bucket:i.bucket,prefix:bp(i.pos)}],s=i.bucket;for(;s!==n;)o.push({bucket:s,prefix:bp(s._posAtParent)}),s=s._parent;o.reverse(),o[0].node=t;for(let a=0;a<o.length;a++){let c=o[a];if(!c.node)throw new Error("Could not generate HAMT path");let u=c.node.Links.filter(d=>(d.Name||"").substring(0,2)===c.prefix).pop();if(!u){Lw(`Link ${c.prefix}${e} will be added`);continue}if(u.Name===`${c.prefix}${e}`){Lw(`Link ${c.prefix}${e} will be replaced`);continue}Lw(`Found subshard ${c.prefix}`);let l=await r.repo.blocks.get(u.Hash),f=en(l);if(!o[a+1]){Lw(`Loaded new subshard ${c.prefix}`),await CN(r,f.Links,n,c.bucket,parseInt(c.prefix,16));let d=await n._findNewBucketAndPos(e);o.push({bucket:d.bucket,prefix:bp(d.pos),node:f});continue}let h=o[a+1];await Bw(r,f.Links,h.bucket,n),h.node=f}return await n.put(e,!0),o.reverse(),{rootBucket:n,path:o}},Ere=async(r,e,t={})=>{let n=new e2({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let o=0;o<e.length;o++)await n._bucket.put(e[o].name,{size:e[o].size,cid:e[o].cid});let i=await Dr(n.flush(r.repo.blocks));if(!i)throw new Error("Flushing shard yielded no result");return i};var Qc=C(ee(),1);var Xc=j("ipfs:mfs:core:utils:add-link");async function Qs(r,e){let t=e.parent;if(e.parentCid){let i=z.asCID(e.parentCid);if(i===null)throw(0,Qc.default)(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(i.code!==kr)throw(0,Qc.default)(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");Xc(`Loading parent node ${i}`);let o=await r.repo.blocks.get(i);t=en(o)}if(!t)throw(0,Qc.default)(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!e.cid)throw(0,Qc.default)(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!e.name)throw(0,Qc.default)(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!e.size&&e.size!==0)throw(0,Qc.default)(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!t.Data)throw(0,Qc.default)(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");let n=st.unmarshal(t.Data);return n.type==="hamt-sharded-directory"?(Xc("Adding link to sharded directory"),Xke(r,{...e,parent:t})):t.Links.length>=e.shardSplitThreshold?(Xc("Converting directory to sharded directory"),Yke(r,{...e,parent:t,mtime:n.mtime,mode:n.mode})):(Xc(`Adding ${e.name} (${e.cid}) to regular directory`),Qke(r,{...e,parent:t}))}var Yke=async(r,e)=>{let t=await Ere(r,e.parent.Links.map(n=>({name:n.Name||"",size:n.Tsize||0,cid:n.Hash})).concat({name:e.name,size:e.size,cid:e.cid}),e);return Xc(`Converted directory to sharded directory ${t.cid}`),t},Qke=async(r,e)=>{let t=e.parent.Links.filter(u=>u.Name!==e.name);if(t.push({Name:e.name,Tsize:e.size,Hash:e.cid}),!e.parent.Data)throw(0,Qc.default)(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");let n=st.unmarshal(e.parent.Data),i;if(n.mtime){let u=Date.now(),l=Math.floor(u/1e3);n.mtime={secs:l,nsecs:(u-l*1e3)*1e3},i=n.marshal()}else i=e.parent.Data;e.parent=Xn({Data:i,Links:t});let o=await r.hashers.getHasher(e.hashAlg),s=pt(e.parent),a=await o.digest(s),c=z.create(e.cidVersion,kr,a);return e.flush&&await r.repo.blocks.put(c,s),{node:e.parent,cid:c,size:s.length}},Xke=async(r,e)=>{let{shard:t,path:n}=await Zke(r,e),i=await Dr(t.flush(r.repo.blocks));if(!i)throw new Error("No result from flushing shard");let o=await r.repo.blocks.get(i.cid),s=en(o),a=e.parent.Links.filter(u=>(u.Name||"").substring(0,2)!==n[0].prefix),c=s.Links.find(u=>(u.Name||"").substring(0,2)===n[0].prefix);if(!c)throw new Error(`No link found with prefix ${n[0].prefix}`);return a.push(c),t2(r,a,n[0].bucket,e)},Zke=async(r,e)=>{let t={name:e.name,cid:e.cid,size:e.size};if(!e.parent.Data)throw(0,Qc.default)(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");let n=await PN(e.parent.Links),i=st.unmarshal(e.parent.Data),o=new e2({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:i.mode},e);o._bucket=n,i.mtime&&(o.mtime={secs:Math.round(Date.now()/1e3)});let s=await n._findNewBucketAndPos(t.name),a=Jke(s);a[0].node=e.parent;let c=0;for(;c<a.length;){let u=a[c];c++;let l=u.node;if(!l)throw new Error("Segment had no node");let f=l.Links.find(g=>(g.Name||"").substring(0,2)===u.prefix);if(!f){Xc(`Link ${u.prefix}${t.name} will be added`),c=a.length;break}if(f.Name===`${u.prefix}${t.name}`){Xc(`Link ${u.prefix}${t.name} will be replaced`),c=a.length;break}if((f.Name||"").length>2){Xc(`Link ${f.Name} ${f.Hash} will be replaced with a subshard`),c=a.length;break}Xc(`Found subshard ${u.prefix}`);let h=await r.repo.blocks.get(f.Hash),d=en(h);if(!a[c]){Xc(`Loaded new subshard ${u.prefix}`),await CN(r,d.Links,n,u.bucket,parseInt(u.prefix,16));let g=await n._findNewBucketAndPos(t.name);a.push({bucket:g.bucket,prefix:bp(g.pos),node:d});break}let p=a[c];await Bw(r,d.Links,p.bucket,n),p.node=d}return await o._bucket.put(t.name,{size:t.size,cid:t.cid}),{shard:o,path:a}},Jke=r=>{let e=[{bucket:r.bucket,prefix:bp(r.pos)}],t=r.bucket._parent,n=r.bucket._posAtParent;for(;t;)e.push({bucket:t,prefix:bp(n)}),n=t._posAtParent,t=t._parent;return e.reverse(),e};var vre=j("ipfs:mfs:utils:update-tree"),eNe={shardSplitThreshold:1e3};async function os(r,e,t){t=Object.assign({},eNe,t),vre("Trail",e),e=e.slice().reverse();let n=0,i;for await(let s of r.repo.blocks.getMany(e.map(a=>a.cid))){let a=en(s),c=e[n].cid,u=e[n].name;if(n++,!i){i={cid:c,name:u,size:s.length};continue}let l=await Qs(r,{parent:a,name:i.name,cid:i.cid,size:i.size,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold,hashAlg:t.hashAlg,cidVersion:t.cidVersion});i={cid:l.cid,name:u,size:l.size}}let{cid:o}=i;return vre(`Final CID ${o}`),o}var xre=C(ee(),1),tNe=j("ipfs:mfs:utils:update-mfs-root");async function ss(r,e,t){if(t&&t.signal&&t.signal.aborted)throw(0,xre.default)(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return tNe(`New MFS root will be ${e}`),await r.repo.datastore.put(Ry,e.bytes),e}var _p=C(ee(),1);async function Sre(r,e,t){let n=new st({type:e,mode:t.mode,mtime:t.mtime}),i=await r.hashers.getHasher(t.hashAlg),o={Data:n.marshal(),Links:[]},s=pt(o),a=await i.digest(s),c=z.create(t.cidVersion,kr,a);return t.flush&&await r.repo.blocks.put(c,s),{cid:c,node:o}}var rNe=et.bind({ignoreUndefined:!0}),Are=j("ipfs:mfs:mkdir"),nNe={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function Ep(r){async function e(t,n={}){let i=rNe(nNe,n);if(!t)throw new Error("no path given to Mkdir");if(t=t.trim(),t==="/"){if(i.parents)return;throw(0,_p.default)(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if(t.substring(0,1)!=="/")throw(0,_p.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");Are(`Creating ${t}`);let o=Jm(t);if(o[0]==="ipfs")throw(0,_p.default)(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");let s=await Zm(r,i),a,c=[],u=await Sre(r,"directory",i);for(let f=0;f<=o.length;f++){let h=o.slice(0,f),d=`/ipfs/${s}/${h.join("/")}`;try{if(a=await Ei(d,r.repo.blocks),a.type!=="file"&&a.type!=="directory")throw(0,_p.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(f===o.length){if(i.parents)return;throw(0,_p.default)(new Error("file already exists"),"ERR_ALREADY_EXISTS")}c.push({name:a.name,cid:a.cid})}catch(p){if(p.code==="ERR_NOT_FOUND"){if(f<o.length&&!i.parents)throw(0,_p.default)(new Error(`Intermediate directory path ${d} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await iNe(r,h[h.length-1],u,c[c.length-1],c,i)}else throw p}}let l=await os(r,c,i);await ss(r,l,i)}return $(e)}var iNe=async(r,e,t,n,i,o)=>{Are(`Adding empty dir called ${e} to ${n.cid}`);let s=await Qs(r,{parent:n.node,parentCid:n.cid,size:0,cid:t.cid,name:e,hashAlg:o.hashAlg,cidVersion:o.cidVersion,flush:o.flush,shardSplitThreshold:o.shardSplitThreshold});i[i.length-1].cid=s.cid,i.push({name:e,cid:t.cid})};var wd=C(ee(),1);var oNe=et.bind({ignoreUndefined:!0}),a7=j("ipfs:mfs:cp"),sNe={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function r2(r){async function e(t,n,i={}){let o=oNe(sNe,i);Array.isArray(t)||(t=[t]);let s=await Promise.all(t.map(h=>sn(r,h,o))),a=await sn(r,n,o);if(!s.length||!a)throw(0,wd.default)(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");let c=s.find(h=>!h.exists);if(c)throw(0,wd.default)(new Error(`${c.path} does not exist`),"ERR_INVALID_PARAMS");let u=Tre(a);if(a.exists){if(a7("Destination exists"),s.length===1&&!u)throw(0,wd.default)(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(a7("Destination does not exist"),s.length>1){if(!o.parents)throw(0,wd.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Ep(r)(a.path,o),a=await sn(r,a.path,o)}else if(a.parts.length>1){let h=`/${a.parts.slice(0,-1).join("/")}`;try{await yd(r)(h,o)}catch(d){if(d.code!=="ERR_NOT_FOUND")throw d;if(!o.parents)throw(0,wd.default)(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await Ep(r)(h,o),a=await sn(r,a.path,o)}}let l=Tre(a)?a.mfsPath:a.mfsDirectory,f=await Yc(r,l);if(s.length===1){let h=s.pop();if(!h)throw(0,wd.default)(new Error("could not find source"),"ERR_INVALID_PARAMS");let d=u?h.name:a.name;return a7(`Only one source, copying to destination ${u?"directory":"file"} ${d}`),aNe(r,h,d,f,o)}return a7("Multiple sources, wrapping in a directory"),cNe(r,s,a,f,o)}return $(e)}var Tre=r=>r.unixfs&&r.unixfs.type&&r.unixfs.type.includes("directory"),aNe=async(r,e,t,n,i)=>{let o=n.pop();if(!o)throw(0,wd.default)(new Error("destination had no parent"),"ERR_INVALID_PARAMS");o=await Ire(r,e,t,o,i),n.push(o);let s=await os(r,n,i);await ss(r,s,i)},cNe=async(r,e,t,n,i)=>{for(let s=0;s<e.length;s++){let a=e[s];t=await Ire(r,a,a.name,t,i)}n[n.length-1]=t;let o=await os(r,n,i);await ss(r,o,i)},Ire=async(r,e,t,n,i)=>{let o=await r.repo.blocks.get(e.cid),{node:s,cid:a,size:c}=await Qs(r,{parentCid:n.cid,size:o.length,cid:e.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});return n.node=s,n.cid=a,n.size=c,n};var Mw=C(ee(),1);var bd=C(ee(),1),_d=j("ipfs:mfs:core:utils:remove-link");async function Rre(r,e){let t=e.parent;if(e.parentCid){let i=z.asCID(e.parentCid);if(i===null)throw(0,bd.default)(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");_d(`Loading parent node ${i}`);let o=await r.repo.blocks.get(i);t=en(o)}if(!t)throw(0,bd.default)(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!e.name)throw(0,bd.default)(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!t.Data)throw(0,bd.default)(new Error("Parent node had no data"),"ERR_INVALID_NODE");return st.unmarshal(t.Data).type==="hamt-sharded-directory"?(_d(`Removing ${e.name} from sharded directory`),lNe(r,{...e,parent:t})):(_d(`Removing link ${e.name} regular directory`),uNe(r,{...e,parent:t}))}var uNe=async(r,e)=>{e.parent.Links=e.parent.Links.filter(s=>s.Name!==e.name);let t=await pt(e.parent),i=await(await r.hashers.getHasher(e.hashAlg)).digest(t),o=z.create(e.cidVersion,kr,i);return await r.repo.blocks.put(o,t),_d(`Updated regular directory ${o}`),{node:e.parent,cid:o}},lNe=async(r,e)=>{let{rootBucket:t,path:n}=await _re(r,e.name,e.parent);await t.del(e.name);let{node:i}=await Cre(r,n,e.name,e);return t2(r,i.Links,t,e)},Cre=async(r,e,t,n)=>{let i=e.pop();if(!i)throw(0,bd.default)(new Error("Could not find parent"),"EINVALIDPARENT");let{bucket:o,prefix:s,node:a}=i;if(!a)throw(0,bd.default)(new Error("Could not find parent"),"EINVALIDPARENT");let c=a.Links.find(d=>(d.Name||"").substring(0,2)===s);if(!c)throw(0,bd.default)(new Error(`No link found with prefix ${s} for file ${t}`),"ERR_NOT_FOUND");if(c.Name===`${s}${t}`){_d(`Removing existing link ${c.Name}`);let d=a.Links.filter(p=>p.Name!==c.Name);return await o.del(t),t2(r,d,o,n)}_d(`Descending into sub-shard ${c.Name} for ${s}${t}`);let u=await Cre(r,e,t,n),l=u.cid,f=u.size,h=s;if(u.node.Links.length===1){_d(`Removing subshard for ${s}`);let d=u.node.Links[0];h=`${s}${(d.Name||"").substring(2)}`,l=d.Hash,f=d.Tsize||0}return _d(`Updating shard ${s} with name ${h}`),fNe(r,o,a,s,h,f,l,n)},fNe=(r,e,t,n,i,o,s,a)=>{let c=t.Links.filter(u=>u.Name!==n);return c.push({Name:i,Tsize:o,Hash:s}),t2(r,c,e,a)};var dNe=et.bind({ignoreUndefined:!0}),hNe={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function n2(r){async function e(t,n={}){let i=dNe(hNe,n);Array.isArray(t)||(t=[t]);let o=await Promise.all(t.map(s=>sn(r,s,i)));if(!o.length)throw(0,Mw.default)(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");o.forEach(s=>{if(s.path==="/")throw(0,Mw.default)(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")});for(let s of o)await pNe(r,s.path,i)}return $(e)}var pNe=async(r,e,t)=>{let n=await sn(r,e,t),i=await Yc(r,n.mfsPath),o=i[i.length-1];i.pop();let s=i[i.length-1];if(!s)throw(0,Mw.default)(new Error(`${e} does not exist`),"ERR_NOT_FOUND");if(o.type==="directory"&&!t.recursive)throw(0,Mw.default)(new Error(`${e} is a directory, use -r to remove directories`),"ERR_WAS_DIR");let{cid:a}=await Rre(r,{parentCid:s.cid,name:o.name,hashAlg:t.hashAlg,cidVersion:t.cidVersion,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold});s.cid=a;let c=await os(r,i,t);await ss(r,c,t)};var mNe=et.bind({ignoreUndefined:!0}),gNe=j("ipfs:mfs:touch"),Pre={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function yNe(r,e,t){let n=0;return(r.includes("x")||r.includes("X")&&(t||e&1||e&8||e&64))&&(n+=1),r.includes("w")&&(n+=2),r.includes("r")&&(n+=4),n}function wNe(r,e){let t=0;return r.includes("u")&&(t+=e<<6),r.includes("g")&&(t+=e<<3),r.includes("o")&&(t+=e),t}function bNe(r,e,t){return e.includes("t")&&(t+=parseInt("1000",8)),e.includes("s")&&(r.includes("u")&&(t+=parseInt("4000",8)),r.includes("g")&&(t+=parseInt("2000",8))),t}function _Ne(r,e,t){e||(e=0);let n=r.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error(`Invalid file mode: ${r}`);let[,i,o,s]=n;(i==="a"||!i)&&(i="ugo");let a=yNe(s,e,t);return a=wNe(i,a),a=bNe(i,s,a),o==="="?(i.includes("u")&&(e=e&parseInt("7077",8),e=e|a),i.includes("g")&&(e=e&parseInt("7707",8),e=e|a),i.includes("o")&&(e=e&parseInt("7770",8),e=e|a),e):o==="+"?a|e:o==="-"?a^e:e}function kre(r,e){if(r instanceof String||typeof r=="string"){let t=`${r}`;t.match(/^\d+$/g)?r=parseInt(t,8):r=0+t.split(",").reduce((n,i)=>_Ne(i,n,e.isDirectory()),e.mode||0)}return r}function Nre(r){async function e(t,n,i={}){let o=mNe(Pre,i);gNe(`Fetching stats for ${t}`);let{cid:s,mfsDirectory:a,name:c}=await sn(r,t,o);if(s.code!==kr)throw(0,i2.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(o.recursive){let S=await Ne(async function*(){for await(let A of _E(s,r.repo.blocks)){if(A.type!=="file"&&A.type!=="directory")throw(0,i2.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");A.unixfs.mode=kre(n,A.unixfs);let I=Xn({Data:A.unixfs.marshal(),Links:A.node.Links});yield{path:A.path,content:I}}},A=>Im(A,r.repo.blocks,{...o,pin:!1,dagBuilder:async function*(I,k,N){for await(let O of I)yield async function(){let G=O.content,R=pt(G),K=await n7(R,k,N);if(!G.Data)throw(0,i2.default)(new Error(`${K} had no data`),"ERR_INVALID_NODE");let U=st.unmarshal(G.Data);return{cid:K,size:R.length,path:O.path,unixfs:U}}}}),A=>Dr(A));if(!S)throw(0,i2.default)(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");await n2(r)(t,o),await r2(r)(`/ipfs/${S.cid}`,t,o);return}let u=await r.repo.blocks.get(s),l=en(u);if(!l.Data)throw(0,i2.default)(new Error(`${s} had no data`),"ERR_INVALID_NODE");let f=st.unmarshal(l.Data);f.mode=kre(n,f);let h=pt({Data:f.marshal(),Links:l.Links}),d=o.hashAlg||Pre.hashAlg,g=await(await r.hashers.getHasher(d)).digest(h),w=z.create(o.cidVersion,kr,g);o.flush&&await r.repo.blocks.put(w,h);let _=await Yc(r,a),x=_[_.length-1],m=z.decode(x.cid.bytes),y=await r.repo.blocks.get(m),b=en(y),E=await Qs(r,{parent:b,name:c,cid:w,size:h.length,flush:o.flush,hashAlg:d,cidVersion:s.version,shardSplitThreshold:1/0});x.cid=E.cid;let v=await os(r,_,o);await ss(r,v,o)}return $(e)}var ENe=et.bind({ignoreUndefined:!0}),vNe={};function Dre(r){async function e(t,n={}){n=ENe(vNe,n);let{cid:i}=await yd(r)(t,n);return i}return $(e)}var xNe=et.bind({ignoreUndefined:!0}),SNe={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function Ore(r){async function e(t,n,i={}){let o=xNe(SNe,i);await r2(r)(t,n,o),await n2(r)(t,{...o,recursive:!0})}return $(e)}var kN=C(ee(),1);var ANe=et.bind({ignoreUndefined:!0}),TNe=j("ipfs:mfs:touch"),Lre={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function Bre(r){async function e(t,n={}){let i=ANe(Lre,n);i.mtime=i.mtime||new Date,TNe(`Touching ${t} mtime: ${i.mtime}`);let{cid:o,mfsDirectory:s,name:a,exists:c}=await sn(r,t,i),u=n.hashAlg||Lre.hashAlg,l=await r.hashers.getHasher(u),f,h,d=i.cidVersion;if(c){if(o.code!==kr)throw(0,kN.default)(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=o.version;let b=await r.repo.blocks.get(o),E=en(b);if(!E.Data)throw(0,kN.default)(new Error(`${t} had no data`),"ERR_INVALID_NODE");let v=st.unmarshal(E.Data);v.mtime=i.mtime,f=pt({Data:v.marshal(),Links:E.Links});let S=await l.digest(f);h=z.create(i.cidVersion,kr,S),i.flush&&await r.repo.blocks.put(h,f)}else{let b=new st({type:"file",mtime:i.mtime});f=pt({Data:b.marshal(),Links:[]});let E=await l.digest(f);h=z.create(i.cidVersion,kr,E),i.flush&&await r.repo.blocks.put(h,f)}let p=await Yc(r,s),g=p[p.length-1],w=g.cid,_=await r.repo.blocks.get(w),x=en(_),m=await Qs(r,{parent:x,name:a,cid:h,size:f.length,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:d});g.cid=m.cid;let y=await os(r,p,i);await ss(r,y,i)}return $(e)}var NN=C(ee(),1);var INe=et.bind({ignoreUndefined:!0}),RNe={offset:0,length:1/0};function Mre(r){function e(t,n={}){return n=INe(RNe,n),{[Symbol.asyncIterator]:async function*(){let o=await sn(r,t,n),s=await Ei(o.mfsPath,r.repo.blocks);if(s.type!=="file"&&s.type!=="raw")throw(0,NN.default)(new Error(`${t} was not a file or raw bytes`),"ERR_NOT_FILE");if(!s.content)throw(0,NN.default)(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(let a of s.content({offset:n.offset,length:n.length}))yield a}}}return $(e)}var DN=C(ee(),1);var Uw=j("ipfs:mfs:utils:to-async-iterator");function Ure(r){if(!r)throw(0,DN.default)(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if((typeof r=="string"||r instanceof String)&&(Uw("Content was a string"),r=Ie(r.toString())),r.length)return Uw("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield r}};if(r[Symbol.asyncIterator])return Uw("Content was an async iterator"),r;if(r[Symbol.iterator])return Uw("Content was an iterator"),r;if(globalThis.Blob&&r instanceof globalThis.Blob)return Uw("Content was an HTML5 Blob"),yo(r.stream());throw(0,DN.default)(new Error(`Don't know how to convert ${r} into an async iterator`),"ERR_INVALID_PARAMS")}var Jc=C(ee(),1);var CNe=et.bind({ignoreUndefined:!0}),Zc=j("ipfs:mfs:write"),PNe={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(r,e)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function zre(r){async function e(t,n,i={}){let o=CNe(PNe,i),s,a,c;if(Zc("Reading source, destination and parent"),await Ow().readLock(async()=>{s=await Ure(n),a=await sn(r,t,o),c=await sn(r,a.mfsDirectory,o)})(),Zc("Read source, destination and parent"),!o.parents&&!c.exists)throw(0,Jc.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(s==null)throw(0,Jc.default)(new Error("could not create source"),"ERR_NO_SOURCE");if(a==null)throw(0,Jc.default)(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!o.create&&!a.exists)throw(0,Jc.default)(new Error("file does not exist"),"ERR_NO_EXIST");if(a.entryType!=="file")throw(0,Jc.default)(new Error("not a file"),"ERR_NOT_A_FILE");return kNe(r,t,s,a,o)}return $(e)}var kNe=async(r,e,t,n,i)=>{let o=await NNe(r,t,n,i);await Ow().writeLock(async()=>{let s=Jm(e),a=s.pop();if(a==null)throw(0,Jc.default)(new Error("source does not exist"),"ERR_NO_EXIST");let c=!1;try{await yd(r)(`/${s.join("/")}`,i),c=!0}catch(w){if(w.code!=="ERR_NOT_FOUND")throw w}c||await Ep(r)(`/${s.join("/")}`,i);let u=await sn(r,e,i),l=await Yc(r,u.mfsDirectory),f=l[l.length-1];if(!f)throw(0,Jc.default)(new Error("directory does not exist"),"ERR_NO_EXIST");if(!f.type||!f.type.includes("directory"))throw(0,Jc.default)(new Error(`cannot write to ${f.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");let h=await r.repo.blocks.get(f.cid),d=en(h),p=await Qs(r,{parent:d,name:a,cid:o.cid,size:o.size,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:i.cidVersion});f.cid=p.cid;let g=await os(r,l,i);await ss(r,g,i)})()},NNe=async(r,e,t,n)=>{t.exists?Zc(`Overwriting file ${t.cid} offset ${n.offset} length ${n.length}`):Zc(`Writing file offset ${n.offset} length ${n.length}`);let i=[];if(n.offset>0)if(t.unixfs){if(Zc(`Writing first ${n.offset} bytes of original file`),i.push(()=>t.content({offset:0,length:n.offset})),t.unixfs.fileSize()<n.offset){let l=n.offset-t.unixfs.fileSize();Zc(`Writing zeros for extra ${l} bytes`),i.push(Fre(l))}}else Zc(`Writing zeros for first ${n.offset} bytes`),i.push(Fre(n.offset));i.push(Vre(e,n.length));let o=ONe(DNe(i),l=>{if(t.unixfs&&!n.truncate){let f=t.unixfs.fileSize();if(f>l)return Zc(`Writing last ${f-l} of ${f} bytes from original file starting at offset ${l}`),t.content({offset:l});Zc("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}),s;n.mode!==void 0&&n.mode!==null?s=Bu(n.mode):t&&t.unixfs&&(s=t.unixfs.mode);let a;n.mtime!=null?a=af(n.mtime):t&&t.unixfs&&(a=t.unixfs.mtime);let c=await r.hashers.getHasher(n.hashAlg),u=await Dr(Im([{content:o,mode:s,mtime:a}],r.repo.blocks,{progress:n.progress,hasher:c,cidVersion:n.cidVersion,strategy:n.strategy,rawLeaves:n.rawLeaves,reduceSingleLeafToSelf:n.reduceSingleLeafToSelf,leafType:n.leafType}));if(!u)throw(0,Jc.default)(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return Zc(`Wrote ${u.cid}`),{cid:u.cid,size:u.size}},Vre=(r,e)=>async function*(){let n=0;for await(let i of r){if(n+=i.length,n>e){yield i.subarray(0,e-n);return}yield i}},Fre=(r,e=PH)=>{let t=new Uint8Array(e);async function*n(){for(;;)yield t}return Vre(n(),r)},DNe=async function*(r){for(let e=0;e<r.length;e++)yield*r[e]()},ONe=async function*(r,e){let t=0;for await(let n of r)t+=n.length,yield n;for await(let n of e(t))t+=n.length,yield n};var Kre=r=>{let e={cid:r.cid,name:r.name,type:r.type==="directory"?"directory":"file",size:r.size};return(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,e.mtime=r.unixfs.mtime),e};function $re(r){async function*e(t,n={}){let i=await sn(r,t,n),o=await Ei(i.mfsPath,r.repo.blocks);if(o.type==="directory"){yield*Mi(o.content(n),Kre);return}yield Kre(o)}return $(e)}var LNe={stat:yd},BNe={chmod:Nre,cp:r2,flush:Dre,mkdir:Ep,mv:Ore,rm:n2,touch:Bre},qre={write:zre,read:Mre,ls:$re},Hre=({options:r,mfs:e,operations:t,lock:n})=>{Object.keys(t).forEach(i=>{e[i]=n(t[i](r))})},MNe={repoOwner:!0,repo:null};function UNe(r){let{repoOwner:e}=Object.assign({},MNe||{},r),t=Ow(e),n=s=>t.readLock(s),i=s=>t.writeLock(s),o={};return Hre({options:r,mfs:o,operations:LNe,lock:n}),Hre({options:r,mfs:o,operations:BNe,lock:i}),Object.keys(qre).forEach(s=>{o[s]=qre[s](r)}),o}function Gre({repo:r,preload:e,hashers:t,options:n}){let i=UNe({repo:r,repoOwner:n.repoOwner!==!1,hashers:t}),o=s=>(...c)=>{let u=c.filter(l=>gH(l)||V8(l));if(u.length){let l=c[c.length-1];l&&l.preload!==!1&&u.forEach(f=>e(f))}return s(...c)};return{...i,chmod:i.chmod,cp:o(i.cp),mkdir:i.mkdir,stat:o(i.stat),rm:i.rm,read:o(i.read),touch:i.touch,write:i.write,mv:o(i.mv),flush:i.flush,ls:o(async function*(...s){for await(let a of i.ls(...s))yield{...a,size:a.size||0}})}}function jre({keychain:r}){return $((t,n)=>r.exportKey(t,n))}var Wre="Ed25519",Yre=2048;function Qre({keychain:r}){return $((t,n={type:Wre,size:Yre})=>r.createKey(t,n.type||Wre,n.size||Yre))}function Xre({keychain:r}){return $((t,n,i)=>r.importKey(t,n,i))}function Zre({keychain:r}){return $(t=>r.findKeyByName(t))}function Jre({keychain:r}){return $(()=>r.listKeys())}function ene({keychain:r}){return $(async(t,n)=>{let i=await r.renameKey(t,n);return{was:t,now:i.name,id:i.id,overwrite:!1}})}function tne({keychain:r}){return $(t=>r.removeKey(t))}var c7=class{constructor({keychain:e}){this.gen=Qre({keychain:e}),this.list=Jre({keychain:e}),this.rm=tne({keychain:e}),this.rename=ene({keychain:e}),this.export=jre({keychain:e}),this.import=Xre({keychain:e}),this.info=Zre({keychain:e})}};function _o({repo:r,preload:e}){async function t(n,i={}){i.preload!==!1&&e(n);let o=await r.blocks.get(n,i);return en(o)}return $(t)}function rne({repo:r,preload:e}){let t=_o({repo:r,preload:e});async function n(i,o={}){return(await t(i,o)).Data||new Uint8Array(0)}return $(n)}function ON(r,e=[]){for(let t in r){let n=r[t];if(t==="/"&&Object.keys(r).length===1)try{e.push({Name:"",Tsize:0,Hash:z.parse(n)});continue}catch{}let i=z.asCID(n);if(i){e.push({Name:"",Tsize:0,Hash:i});continue}Array.isArray(n)&&ON(n,e),n&&typeof n=="object"&&ON(n,e)}return e}function nne({repo:r,codecs:e}){async function t(n,i={}){let o=await e.getCodec(n.code),s=await r.blocks.get(n,i),a=o.decode(s);switch(n.code){case gf:return[];case kr:return a.Links;case lT:case _T:return ON(a);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return $(t)}function ine({repo:r,preload:e}){async function t(n={}){let i;if(n.template)if(n.template==="unixfs-dir")i=new st({type:"directory"}).marshal();else throw new Error("unknown template");let o=pt({Data:i,Links:[]}),s=await dt.digest(o),a=z.createV0(s);return await r.blocks.put(a,o,{signal:n.signal}),n.preload!==!1&&e(a),a}return $(t)}function eu({repo:r,preload:e}){async function t(n,i={}){let o=await r.gcLock.readLock();try{let s=pt(n),a=await dt.digest(s),c=z.createV1(kr,a);return await r.blocks.put(c,s,{signal:i.signal}),i.preload!==!1&&e(c),i.pin&&await r.pins.pinRecursively(c,{signal:i.signal}),c}finally{o()}}return $(t)}function one({repo:r,preload:e}){let t=_o({repo:r,preload:e});async function n(i,o={}){let s=await t(i,o),c=pt(s).length,u=s.Links.reduce((l,f)=>l+(f.Tsize||0),0);return{Hash:i,NumLinks:s.Links.length,BlockSize:c,LinksSize:c-(s.Data||[]).length,DataSize:(s.Data||[]).length,CumulativeSize:c+u}}return $(n)}function sne({repo:r,preload:e}){let t=_o({repo:r,preload:e}),n=eu({repo:r,preload:e});async function i(o,s,a={}){let c=await t(o,a);return n({...c,Links:c.Links.concat([s])},a)}return $(i)}function ane({repo:r,preload:e}){let t=_o({repo:r,preload:e}),n=eu({repo:r,preload:e});async function i(o,s,a={}){let c=await t(o,a),u=rt([c.Data||[],s]);return n({...c,Data:u},a)}return $(i)}function cne({repo:r,preload:e}){let t=_o({repo:r,preload:e}),n=eu({repo:r,preload:e});async function i(o,s,a={}){let c=await t(o,a),u=(typeof s=="string"?s:s.Name)||"";return c.Links=c.Links.filter(l=>l.Name!==u),n(c,a)}return $(i)}function une({repo:r,preload:e}){let t=_o({repo:r,preload:e}),n=eu({repo:r,preload:e});async function i(o,s,a={}){let c=await t(o,a);return n({...c,Data:s},a)}return $(i)}var u7=class{constructor({repo:e,preload:t}){this.addLink=sne({repo:e,preload:t}),this.appendData=ane({repo:e,preload:t}),this.rmLink=cne({repo:e,preload:t}),this.setData=une({repo:e,preload:t})}};var l7=class{constructor({repo:e,codecs:t,preload:n}){this.data=rne({repo:e,preload:n}),this.get=_o({repo:e,preload:n}),this.links=nne({repo:e,codecs:t}),this.new=ine({repo:e,preload:n}),this.put=eu({repo:e,preload:n}),this.stat=one({repo:e,preload:n}),this.patch=new u7({repo:e,preload:n})}};var FNe=j("ipfs:repo:gc");function lne({repo:r,hashers:e}){async function*t(n={}){let i=Date.now(),o;try{o=await Zm({repo:r,hashers:e},n),await r.pins.pinRecursively(o),yield*r.gc()}finally{o&&await r.pins.unpin(o)}FNe(`Complete (${Date.now()-i}ms)`)}return $(t)}function f7({repo:r}){async function e(t={}){let n=await r.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return $(e)}function fne({repo:r}){async function e(t={}){try{await r._checkInitialized(t)}catch(n){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some(o=>o.test(n.message)))return 12;throw n}return r.version.get()}return $(e)}var d7=class{constructor({repo:e,hashers:t}){this.gc=lne({repo:e,hashers:t}),this.stat=f7({repo:e}),this.version=fne({repo:e}),this.setApiAddr=n=>e.apiAddr.set(n)}};var hne=C(ee(),1);function dne(r,e){return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0}}function pne({network:r}){return $(async function*(t={}){let{libp2p:n}=await r.use(t);if(!t.poll){yield dne(n,t);return}let i=t.interval||1e3,o=-1;try{if(o=typeof i=="string"?Cf(i)||-1:i,!o||o<0)throw new Error("invalid duration")}catch(a){throw(0,hne.default)(a,"ERR_INVALID_POLL_INTERVAL")}let s;try{for(;;)yield dne(n,t),await new Promise(a=>{s=setTimeout(a,o)})}finally{clearTimeout(s)}})}var h7=class{constructor({repo:e,network:t}){this.repo=f7({repo:e}),this.bw=pne({network:t}),this.bitswap=N_({network:t})}};var zw=VNe;function VNe(r,e,t){if(!r)return t;var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(i=n.shift(),!r||(r=r[i],r===void 0))return t;return r}var Gie=C($s(),1),Np=C(ee(),1);var gne=C($s(),1);async function vp(r){let e=0;for await(let t of r)e++;return e}var KNe=(0,gne.default)("ipfs:repo:migrator:migration-8");function yne(r){return r.child?yne(r.child):r}function $Ne(r){try{let e=Ot.decode(`b${r.toString().toLowerCase().slice(1)}`),t=ce.decode(e).multihash.bytes,n=Ot.encode(t).slice(1).toUpperCase();return new pe(`/${n}`,!1)}catch{return r}}function qNe(r){try{let e=Ot.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Jn(e),n=Ot.encode(ce.createV1(Sc,t).bytes).slice(1);return new pe(`/${n.toUpperCase()}`,!1)}catch{return r}}async function mne(r,e,t){let n=r.blocks;await n.open();let i=yne(n),o=await vp(i.queryKeys({filters:[s=>t(s).toString()!==s.toString()]}));try{let s=0;for await(let a of i.query({})){let c=t(a.key);c.toString()!==a.key.toString()&&(s+=1,KNe(`Migrating Block from ${a.key} to ${c}`,await i.has(a.key)),await i.delete(a.key),await i.put(c,a.value),e(s/o*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}var wne={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>mne(r,e,$Ne),revert:(r,e=()=>{})=>mne(r,e,qNe)};var xp=C(gc(),1),bne=xp.default.Reader,HNe=xp.default.Writer,w8t=xp.default.util,p7=xp.default.roots.default||(xp.default.roots.default={}),_ne=p7.ipfs=(()=>{let r={};return r.pin=function(){let e={};return e.Set=function(){function t(n){if(n)for(var i=Object.keys(n),o=0;o<i.length;++o)n[i[o]]!=null&&(this[i[o]]=n[i[o]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(i,o){return o||(o=HNe.create()),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&o.uint32(8).uint32(i.version),i.fanout!=null&&Object.hasOwnProperty.call(i,"fanout")&&o.uint32(16).uint32(i.fanout),i.seed!=null&&Object.hasOwnProperty.call(i,"seed")&&o.uint32(29).fixed32(i.seed),o},t.decode=function(i,o){i instanceof bne||(i=bne.create(i));for(var s=o===void 0?i.len:i.pos+o,a=new p7.ipfs.pin.Set;i.pos<s;){var c=i.uint32();switch(c>>>3){case 1:a.version=i.uint32();break;case 2:a.fanout=i.uint32();break;case 3:a.seed=i.fixed32();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof p7.ipfs.pin.Set)return i;var o=new p7.ipfs.pin.Set;return i.version!=null&&(o.version=i.version>>>0),i.fanout!=null&&(o.fanout=i.fanout>>>0),i.seed!=null&&(o.seed=i.seed>>>0),o},t.toObject=function(i,o){o||(o={});var s={};return o.defaults&&(s.version=0,s.fanout=0,s.seed=0),i.version!=null&&i.hasOwnProperty("version")&&(s.version=i.version),i.fanout!=null&&i.hasOwnProperty("fanout")&&(s.fanout=i.fanout),i.seed!=null&&i.hasOwnProperty("seed")&&(s.seed=i.seed),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,xp.default.util.toJSONOptions)},t}(),e}(),r})();var Sne=C(vne(),1),y7=C(Xo(),1);var Vw=new pe("/local/pins"),g7=256,xne=8192,BN=ce.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),Sp={direct:"direct",recursive:"recursive"};function MN(r){return new pe(`/${Ot.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}function UN(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}var FN=_ne.pin.Set;function GNe(r){let e=r.Data;if(!e)throw new Error("No data present");let t=y7.default.decode(e),n=y7.default.decode.bytes??0;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");let i=e.slice(n,t+n),o=FN.toObject(FN.decode(i),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(o.version!==1)throw new Error(`Unsupported Set version: ${o.version}`);if(o.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:o,data:e.slice(t+n)}}function jNe(r,e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);let i=fe(e.toString()),o=yr([t,i],t.byteLength+i.byteLength);return(0,Sne.default)(Ee(o))}async function*Ane(r,e){let t=GNe(e),n=0;for(let i of e.Links){if(n<t.header.fanout){let o=i.Hash;if(!BN.equals(o)){let s=await r.get(o),a=Jo(s);yield*Ane(r,a)}}else yield i.Hash;n++}}async function*Kw(r,e,t){let n=e.Links.find(s=>s.Name===t);if(!n)throw new Error("No link found with name "+t);let i=await r.get(n.Hash),o=Jo(i);yield*Ane(r,o)}function WNe(r,e){return t(e,0);async function t(n,i){let o=FN.encode({version:1,fanout:g7,seed:i}).finish(),s=y7.default.encode(o.length),a=yr([s,o]),c=[];for(let l=0;l<g7;l++)c.push({Name:"",Tsize:1,Hash:BN});if(n.length<=xne){let l=n.map(d=>({link:{Name:"",Tsize:1,Hash:d.key},data:d.data||new Uint8Array})).sort((d,p)=>UN(d.link.Hash.bytes,p.link.Hash.bytes)),f=c.concat(l.map(d=>d.link));return{Data:yr([a,...l.map(d=>d.data)]),Links:f}}else{let l=n.reduce((h,d)=>{let p=jNe(i,d.key)%g7;return h[p]=p in h?h[p].concat([d]):[d],h},[]),f=0;for(let h of l){let d=await t(h,i+1);await u(d,f),f++}return{Data:a,Links:c}}async function u(l,f){let h=W3(l),d=await mr.digest(h),p=ce.createV0(d);await r.put(p,h);let g=l.Links.reduce((w,_)=>w+(_.Tsize||0),0)+h.length;c[f]={Name:"",Tsize:g,Hash:p}}}}async function zN(r,e,t){let n=await WNe(r,t.map(c=>({key:c}))),i=W3(n),o=await mr.digest(i),s=ce.createV0(o);await r.put(s,i);let a=n.Links.reduce((c,u)=>c+u.Tsize,0)+i.length;return{Name:e,Tsize:a,Hash:s}}async function QNe(r,e,t,n){if(!await e.has(Vw))return;let i=await e.get(Vw),o=ce.decode(i),s=await r.get(o),a=Jo(s),c=0,u=await vp(Kw(r,a,Sp.recursive))+await vp(Kw(r,a,Sp.direct));for await(let l of Kw(r,a,Sp.recursive)){c++;let f={depth:1/0};l.version!==0&&(f.version=l.version),l.code!==Zo&&(f.codec=l.code),await t.put(MN(l),zu(f)),n(c/u*100,`Migrated recursive pin ${l}`)}for await(let l of Kw(r,a,Sp.direct)){c++;let f={depth:0};l.version!==0&&(f.version=l.version),l.code!==Zo&&(f.codec=l.code),await t.put(MN(l),zu(f)),n(c/u*100,`Migrated direct pin ${l}`)}await r.delete(o),await e.delete(Vw)}async function XNe(r,e,t,n){let i=[],o=[],s=0,a=await vp(t.queryKeys({}));for await(let{key:h,value:d}of t.query({})){s++;let p=ks(d),g=ce.create(p.version||0,p.codec||Zo,Jn(Ot.decode("b"+h.toString().toLowerCase().split("/").pop())));p.depth===0?(n(s/a*100,`Reverted direct pin ${g}`),o.push(g)):(n(s/a*100,`Reverted recursive pin ${g}`),i.push(g))}n(100,"Updating pin root");let c={Links:[await zN(r,Sp.direct,o),await zN(r,Sp.recursive,i)]},u=W3(c),l=await mr.digest(u),f=ce.createV0(l);await r.put(f,u),await e.put(Vw,f.bytes)}async function Tne(r,e,t){let n=r.blocks,i=r.datastore,o=r.pins;await n.open(),await i.open(),await o.open();try{await t(n,i,o,e)}finally{await o.close(),await i.close(),await n.close()}}var Ine={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>Tne(r,e,QNe),revert:(r,e=()=>{})=>Tne(r,e,XNe)};var Rne=new pe("/config"),$w=new pe("/version");function qw(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function ZNe(r,e,t){let n=await e(r);if(n)return n;let i=qw(t);return i?new Promise((o,s)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{o(!!a.result)}}):!1}async function JNe(r,e,t,n){if(await t(r))return e(r);let i=qw(n);if(!i)throw Gn();return new Promise((o,s)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return o(a.result);s(Gn())}})}function w7(r){let e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>JNe(n,e,t,r),r.has=n=>ZNe(n,t,r),r}function VN(r){return{...r,root:w7(r.root),datastore:w7(r.datastore),pins:w7(r.pins),keys:w7(r.keys)}}async function eDe(r,e,t=()=>{}){let n=qw(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await Nne(n,(o,s)=>[{type:"del",key:o},{type:"put",key:fe(o),value:s}])}async function tDe(r,e,t=()=>{}){let n=qw(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await Nne(n,(o,s)=>[{type:"del",key:o},{type:"put",key:Ee(o),value:s}])}function Pne(r){return r.child?Pne(r.child):r}async function Cne(r,e,t){let n=Object.entries(r).map(([s,a])=>({key:s,backend:Pne(a)})).filter(({key:s,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:s,backend:a})=>({name:s,store:a}));e(0,`Migrating ${n.length} dbs`);let i=0,o=s=>{e(Math.round(i/n.length*100),s)};for(let{name:s,store:a}of n){await a.open();try{await t(s,a,o)}finally{i++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}var kne={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>Cne(r,e,eDe),revert:(r,e=()=>{})=>Cne(r,e,tDe)};function Nne(r,e){function t(n,i){let o=r.store("readwrite"),s=o.transaction,a=0,c;s.onabort=()=>i(c||s.error||new Error("aborted by user")),s.oncomplete=()=>i();function u(){let l=n[a++],f=l.key,h;try{h=l.type==="del"?o.delete(f):o.put(l.value,f)}catch(d){c=d,s.abort();return}a<n.length&&(h.onsuccess=u)}u()}return new Promise((n,i)=>{let o=r.iterator(),s=c=>c;o._deserializeKey=o._deserializeValue=s,a();function a(){let c=(u,l,f)=>{if(u||l===void 0){let h=d=>{if(d){i(d);return}n()};o.end(h);return}t(e(l,f),a)};o.next(c)}})}var Ed=new pe("/local/filesroot");async function rDe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(Ed)){let t=await r.root.get(Ed);await r.datastore.put(Ed,t),await r.root.delete(Ed)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function nDe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(Ed)){let t=await r.datastore.get(Ed);await r.root.put(Ed,t),await r.datastore.delete(Ed)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}var Dne={version:11,description:"Store mfs root in the datastore",migrate:rDe,revert:nDe};var oD=C(gc(),1);var Ap=C(gc(),1),One=Ap.default.Reader,iDe=Ap.default.Writer,oDe=Ap.default.util,b7=Ap.default.roots.default||(Ap.default.roots.default={}),KN=b7.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=oDe.emptyArray,r.encode=function(t,n){if(n||(n=iDe.create()),t.protocols!=null&&t.protocols.length)for(var i=0;i<t.protocols.length;++i)n.uint32(10).string(t.protocols[i]);return n},r.decode=function(t,n){t instanceof One||(t=One.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new b7.Protocols;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.protocols&&o.protocols.length||(o.protocols=[]),o.protocols.push(t.string());break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof b7.Protocols)return t;var n=new b7.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var i=0;i<t.protocols.length;++i)n.protocols[i]=String(t.protocols[i])}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.protocols=[]),t.protocols&&t.protocols.length){i.protocols=[];for(var o=0;o<t.protocols.length;++o)i.protocols[o]=t.protocols[o]}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ap.default.util.toJSONOptions)},r})();var gl=C(gc(),1),o2=gl.default.Reader,$N=gl.default.Writer,qr=gl.default.util,ui=gl.default.roots.default||(gl.default.roots.default={}),qN=ui.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=qr.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=$N.create()),t.addrs!=null&&t.addrs.length)for(var i=0;i<t.addrs.length;++i)ui.Addresses.Address.encode(t.addrs[i],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&ui.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof o2||(t=o2.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new ui.Addresses;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.addrs&&o.addrs.length||(o.addrs=[]),o.addrs.push(ui.Addresses.Address.decode(t,t.uint32()));break;case 2:o.certifiedRecord=ui.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof ui.Addresses)return t;var n=new ui.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var i=0;i<t.addrs.length;++i){if(typeof t.addrs[i]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[i]=ui.Addresses.Address.fromObject(t.addrs[i])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=ui.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addrs=[]),n.defaults&&(i.certifiedRecord=null),t.addrs&&t.addrs.length){i.addrs=[];for(var o=0;o<t.addrs.length;++o)i.addrs[o]=ui.Addresses.Address.toObject(t.addrs[o],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(i.certifiedRecord=ui.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,gl.default.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var i=Object.keys(n),o=0;o<i.length;++o)n[i[o]]!=null&&(this[i[o]]=n[i[o]])}e.prototype.multiaddr=qr.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:qr.oneOfGetter(t=["isCertified"]),set:qr.oneOfSetter(t)}),e.encode=function(i,o){return o||(o=$N.create()),i.multiaddr!=null&&Object.hasOwnProperty.call(i,"multiaddr")&&o.uint32(10).bytes(i.multiaddr),i.isCertified!=null&&Object.hasOwnProperty.call(i,"isCertified")&&o.uint32(16).bool(i.isCertified),o},e.decode=function(i,o){i instanceof o2||(i=o2.create(i));for(var s=o===void 0?i.len:i.pos+o,a=new ui.Addresses.Address;i.pos<s;){var c=i.uint32();switch(c>>>3){case 1:a.multiaddr=i.bytes();break;case 2:a.isCertified=i.bool();break;default:i.skipType(c&7);break}}return a},e.fromObject=function(i){if(i instanceof ui.Addresses.Address)return i;var o=new ui.Addresses.Address;return i.multiaddr!=null&&(typeof i.multiaddr=="string"?qr.base64.decode(i.multiaddr,o.multiaddr=qr.newBuffer(qr.base64.length(i.multiaddr)),0):i.multiaddr.length&&(o.multiaddr=i.multiaddr)),i.isCertified!=null&&(o.isCertified=!!i.isCertified),o},e.toObject=function(i,o){o||(o={});var s={};return o.defaults&&(o.bytes===String?s.multiaddr="":(s.multiaddr=[],o.bytes!==Array&&(s.multiaddr=qr.newBuffer(s.multiaddr)))),i.multiaddr!=null&&i.hasOwnProperty("multiaddr")&&(s.multiaddr=o.bytes===String?qr.base64.encode(i.multiaddr,0,i.multiaddr.length):o.bytes===Array?Array.prototype.slice.call(i.multiaddr):i.multiaddr),i.isCertified!=null&&i.hasOwnProperty("isCertified")&&(s.isCertified=i.isCertified,o.oneofs&&(s._isCertified="isCertified")),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,gl.default.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.seq=qr.Long?qr.Long.fromBits(0,0,!0):0,e.prototype.raw=qr.newBuffer([]),e.encode=function(n,i){return i||(i=$N.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&i.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&i.uint32(18).bytes(n.raw),i},e.decode=function(n,i){n instanceof o2||(n=o2.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new ui.Addresses.CertifiedRecord;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:s.seq=n.uint64();break;case 2:s.raw=n.bytes();break;default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof ui.Addresses.CertifiedRecord)return n;var i=new ui.Addresses.CertifiedRecord;return n.seq!=null&&(qr.Long?(i.seq=qr.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?i.seq=parseInt(n.seq,10):typeof n.seq=="number"?i.seq=n.seq:typeof n.seq=="object"&&(i.seq=new qr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?qr.base64.decode(n.raw,i.raw=qr.newBuffer(qr.base64.length(n.raw)),0):n.raw.length&&(i.raw=n.raw)),i},e.toObject=function(n,i){i||(i={});var o={};if(i.defaults){if(qr.Long){var s=new qr.Long(0,0,!0);o.seq=i.longs===String?s.toString():i.longs===Number?s.toNumber():s}else o.seq=i.longs===String?"0":0;i.bytes===String?o.raw="":(o.raw=[],i.bytes!==Array&&(o.raw=qr.newBuffer(o.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?o.seq=i.longs===String?String(n.seq):n.seq:o.seq=i.longs===String?qr.Long.prototype.toString.call(n.seq):i.longs===Number?new qr.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(o.raw=i.bytes===String?qr.base64.encode(n.raw,0,n.raw.length):i.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,gl.default.util.toJSONOptions)},e}(),r})();var yl=C(gc(),1),s2=yl.default.Reader,HN=yl.default.Writer,dr=yl.default.util,Nn=yl.default.roots.default||(yl.default.roots.default={}),GN=Nn.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.addresses=dr.emptyArray,r.prototype.protocols=dr.emptyArray,r.prototype.metadata=dr.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:dr.oneOfGetter(e=["pubKey"]),set:dr.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:dr.oneOfGetter(e=["peerRecordEnvelope"]),set:dr.oneOfSetter(e)}),r.encode=function(n,i){if(i||(i=HN.create()),n.addresses!=null&&n.addresses.length)for(var o=0;o<n.addresses.length;++o)Nn.Address.encode(n.addresses[o],i.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var o=0;o<n.protocols.length;++o)i.uint32(18).string(n.protocols[o]);if(n.metadata!=null&&n.metadata.length)for(var o=0;o<n.metadata.length;++o)Nn.Metadata.encode(n.metadata[o],i.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&i.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&i.uint32(42).bytes(n.peerRecordEnvelope),i},r.decode=function(n,i){n instanceof s2||(n=s2.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new Nn.Peer;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push(Nn.Address.decode(n,n.uint32()));break;case 2:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(n.string());break;case 3:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(Nn.Metadata.decode(n,n.uint32()));break;case 4:s.pubKey=n.bytes();break;case 5:s.peerRecordEnvelope=n.bytes();break;default:n.skipType(a&7);break}}return s},r.fromObject=function(n){if(n instanceof Nn.Peer)return n;var i=new Nn.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");i.addresses=[];for(var o=0;o<n.addresses.length;++o){if(typeof n.addresses[o]!="object")throw TypeError(".Peer.addresses: object expected");i.addresses[o]=Nn.Address.fromObject(n.addresses[o])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");i.protocols=[];for(var o=0;o<n.protocols.length;++o)i.protocols[o]=String(n.protocols[o])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");i.metadata=[];for(var o=0;o<n.metadata.length;++o){if(typeof n.metadata[o]!="object")throw TypeError(".Peer.metadata: object expected");i.metadata[o]=Nn.Metadata.fromObject(n.metadata[o])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?dr.base64.decode(n.pubKey,i.pubKey=dr.newBuffer(dr.base64.length(n.pubKey)),0):n.pubKey.length&&(i.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?dr.base64.decode(n.peerRecordEnvelope,i.peerRecordEnvelope=dr.newBuffer(dr.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(i.peerRecordEnvelope=n.peerRecordEnvelope)),i},r.toObject=function(n,i){i||(i={});var o={};if((i.arrays||i.defaults)&&(o.addresses=[],o.protocols=[],o.metadata=[]),n.addresses&&n.addresses.length){o.addresses=[];for(var s=0;s<n.addresses.length;++s)o.addresses[s]=Nn.Address.toObject(n.addresses[s],i)}if(n.protocols&&n.protocols.length){o.protocols=[];for(var s=0;s<n.protocols.length;++s)o.protocols[s]=n.protocols[s]}if(n.metadata&&n.metadata.length){o.metadata=[];for(var s=0;s<n.metadata.length;++s)o.metadata[s]=Nn.Metadata.toObject(n.metadata[s],i)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(o.pubKey=i.bytes===String?dr.base64.encode(n.pubKey,0,n.pubKey.length):i.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,i.oneofs&&(o._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(o.peerRecordEnvelope=i.bytes===String?dr.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):i.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,i.oneofs&&(o._peerRecordEnvelope="peerRecordEnvelope")),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,yl.default.util.toJSONOptions)},r})(),Q8t=Nn.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.multiaddr=dr.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:dr.oneOfGetter(e=["isCertified"]),set:dr.oneOfSetter(e)}),r.encode=function(n,i){return i||(i=HN.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&i.uint32(16).bool(n.isCertified),i},r.decode=function(n,i){n instanceof s2||(n=s2.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new Nn.Address;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:s.multiaddr=n.bytes();break;case 2:s.isCertified=n.bool();break;default:n.skipType(a&7);break}}return s},r.fromObject=function(n){if(n instanceof Nn.Address)return n;var i=new Nn.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?dr.base64.decode(n.multiaddr,i.multiaddr=dr.newBuffer(dr.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),n.isCertified!=null&&(i.isCertified=!!n.isCertified),i},r.toObject=function(n,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.multiaddr="":(o.multiaddr=[],i.bytes!==Array&&(o.multiaddr=dr.newBuffer(o.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(o.multiaddr=i.bytes===String?dr.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(o.isCertified=n.isCertified,i.oneofs&&(o._isCertified="isCertified")),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,yl.default.util.toJSONOptions)},r})(),X8t=Nn.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=dr.newBuffer([]),r.encode=function(t,n){return n||(n=HN.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof s2||(t=s2.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new Nn.Metadata;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.key=t.string();break;case 2:o.value=t.bytes();break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof Nn.Metadata)return t;var n=new Nn.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?dr.base64.decode(t.value,n.value=dr.newBuffer(dr.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.key="",n.bytes===String?i.value="":(i.value=[],n.bytes!==Array&&(i.value=dr.newBuffer(i.value)))),t.key!=null&&t.hasOwnProperty("key")&&(i.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(i.value=n.bytes===String?dr.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,yl.default.util.toJSONOptions)},r})();var Tp=C(gc(),1),Lne=Tp.default.Reader,sDe=Tp.default.Writer,Hr=Tp.default.util,_7=Tp.default.roots.default||(Tp.default.roots.default={}),Bne=_7.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=Hr.newBuffer([]),r.prototype.payloadType=Hr.newBuffer([]),r.prototype.payload=Hr.newBuffer([]),r.prototype.signature=Hr.newBuffer([]),r.encode=function(t,n){return n||(n=sDe.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof Lne||(t=Lne.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new _7.Envelope;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.publicKey=t.bytes();break;case 2:o.payloadType=t.bytes();break;case 3:o.payload=t.bytes();break;case 5:o.signature=t.bytes();break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof _7.Envelope)return t;var n=new _7.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?Hr.base64.decode(t.publicKey,n.publicKey=Hr.newBuffer(Hr.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?Hr.base64.decode(t.payloadType,n.payloadType=Hr.newBuffer(Hr.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?Hr.base64.decode(t.payload,n.payload=Hr.newBuffer(Hr.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?Hr.base64.decode(t.signature,n.signature=Hr.newBuffer(Hr.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(n.bytes===String?i.publicKey="":(i.publicKey=[],n.bytes!==Array&&(i.publicKey=Hr.newBuffer(i.publicKey))),n.bytes===String?i.payloadType="":(i.payloadType=[],n.bytes!==Array&&(i.payloadType=Hr.newBuffer(i.payloadType))),n.bytes===String?i.payload="":(i.payload=[],n.bytes!==Array&&(i.payload=Hr.newBuffer(i.payload))),n.bytes===String?i.signature="":(i.signature=[],n.bytes!==Array&&(i.signature=Hr.newBuffer(i.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(i.publicKey=n.bytes===String?Hr.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(i.payloadType=n.bytes===String?Hr.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(i.payload=n.bytes===String?Hr.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(i.signature=n.bytes===String?Hr.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Tp.default.util.toJSONOptions)},r})();var vd=C(gc(),1),E7=vd.default.Reader,Mne=vd.default.Writer,an=vd.default.util,Qa=vd.default.roots.default||(vd.default.roots.default={}),Une=Qa.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=an.newBuffer([]),r.prototype.seq=an.Long?an.Long.fromBits(0,0,!0):0,r.prototype.addresses=an.emptyArray,r.encode=function(t,n){if(n||(n=Mne.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var i=0;i<t.addresses.length;++i)Qa.PeerRecord.AddressInfo.encode(t.addresses[i],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof E7||(t=E7.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new Qa.PeerRecord;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:o.peerId=t.bytes();break;case 2:o.seq=t.uint64();break;case 3:o.addresses&&o.addresses.length||(o.addresses=[]),o.addresses.push(Qa.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof Qa.PeerRecord)return t;var n=new Qa.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?an.base64.decode(t.peerId,n.peerId=an.newBuffer(an.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&(an.Long?(n.seq=an.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new an.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var i=0;i<t.addresses.length;++i){if(typeof t.addresses[i]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[i]=Qa.PeerRecord.AddressInfo.fromObject(t.addresses[i])}}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addresses=[]),n.defaults)if(n.bytes===String?i.peerId="":(i.peerId=[],n.bytes!==Array&&(i.peerId=an.newBuffer(i.peerId))),an.Long){var o=new an.Long(0,0,!0);i.seq=n.longs===String?o.toString():n.longs===Number?o.toNumber():o}else i.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(i.peerId=n.bytes===String?an.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?i.seq=n.longs===String?String(t.seq):t.seq:i.seq=n.longs===String?an.Long.prototype.toString.call(t.seq):n.longs===Number?new an.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){i.addresses=[];for(var s=0;s<t.addresses.length;++s)i.addresses[s]=Qa.PeerRecord.AddressInfo.toObject(t.addresses[s],n)}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,vd.default.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.multiaddr=an.newBuffer([]),e.encode=function(n,i){return i||(i=Mne.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),i},e.decode=function(n,i){n instanceof E7||(n=E7.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new Qa.PeerRecord.AddressInfo;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:s.multiaddr=n.bytes();break;default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof Qa.PeerRecord.AddressInfo)return n;var i=new Qa.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?an.base64.decode(n.multiaddr,i.multiaddr=an.newBuffer(an.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),i},e.toObject=function(n,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.multiaddr="":(o.multiaddr=[],i.bytes!==Array&&(o.multiaddr=an.newBuffer(o.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(o.multiaddr=i.bytes===String?an.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,vd.default.util.toJSONOptions)},e}(),r})();var v7=class{constructor(){B(this,"index",0);B(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let o=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*i)-1;for(;;){let l=this.readAtomically(()=>{let f=this.readChar();if(f===void 0)return;let h=Number.parseInt(f,e);if(!Number.isNaN(h))return h});if(l===void 0)break;if(o*=e,o+=l,o>u||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:o})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let i=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],[i+4,!0]}let o=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(o===void 0)return[i,!1];t[i]=o>>8,t[i+1]=o&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let o=new Uint8Array(14),s=16-(n+2),[a]=e(o.subarray(0,s));return t.set(o.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Fne=45,aDe=15,a2=new v7;function zne(r){if(!(r.length>aDe))return a2.new(r).parseWith(()=>a2.readIPv4Addr())}function Vne(r){if(!(r.length>Fne))return a2.new(r).parseWith(()=>a2.readIPv6Addr())}function Kne(r){if(!(r.length>Fne))return a2.new(r).parseWith(()=>a2.readIPAddr())}function $ne(r){return!!zne(r)}function qne(r){return!!Vne(r)}function c2(r){return!!Kne(r)}var Hne=$ne,cDe=qne,jN=function(r){let e=0;if(r=r.toString().trim(),Hne(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(cDe(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let o=Hne(t[n]),s;o&&(s=jN(t[n]),t[n]=Ee(s.slice(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,Ee(s.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let o=[n,1];for(n=9-t.length;n>0;n--)o.push("0");t.splice.apply(t,o)}let i=new Uint8Array(e+16);for(n=0;n<t.length;n++){let o=parseInt(t[n],16);i[e++]=o>>8&255,i[e++]=o&255}return i}throw new Error("invalid ip address")},Gne=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let i=[];for(let o=0;o<t;o++)i.push(r[e+o]);return i.join(".")}if(t===16){let i=[];for(let o=0;o<t;o+=2)i.push(n.getUint16(e+o).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var Hw={},WN={},lDe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];lDe.forEach(r=>{let e=fDe(...r);WN[e.code]=e,Hw[e.name]=e});function fDe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function hr(r){if(typeof r=="number"){if(WN[r]!=null)return WN[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Hw[r]!=null)return Hw[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var tu=C(Xo(),1);function Xne(r,e){switch(hr(r).code){case 4:case 41:return hDe(e);case 42:return Yne(e);case 6:case 273:case 33:case 132:return Jne(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return Yne(e);case 421:return yDe(e);case 444:return Qne(e);case 445:return Qne(e);case 466:return gDe(e);default:return Ee(e,"base16")}}function Zne(r,e){switch(hr(r).code){case 4:return jne(e);case 41:return jne(e);case 42:return Wne(e);case 6:case 273:case 33:case 132:return QN(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return Wne(e);case 421:return pDe(e);case 444:return wDe(e);case 445:return bDe(e);case 466:return mDe(e);default:return fe(e,"base16")}}var YN=Object.values(If).map(r=>r.decoder),dDe=function(){let r=YN[0].or(YN[1]);return YN.slice(2).forEach(e=>r=r.or(e)),r}();function jne(r){if(!c2(r))throw new Error("invalid ip address");return jN(r)}function hDe(r){let e=Gne(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!c2(e))throw new Error("invalid ip address");return e}function QN(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function Jne(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Wne(r){let e=fe(r),t=Uint8Array.from(tu.default.encode(e.length));return yr([t,e],t.length+e.length)}function Yne(r){let e=tu.default.decode(r);if(r=r.slice(tu.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return Ee(r)}function pDe(r){let e;r[0]==="Q"||r[0]==="1"?e=Jn(tt.decode(`z${r}`)).bytes:e=ce.parse(r).multihash.bytes;let t=Uint8Array.from(tu.default.encode(e.length));return yr([t,e],t.length+e.length)}function mDe(r){let e=dDe.decode(r),t=Uint8Array.from(tu.default.encode(e.length));return yr([t,e],t.length+e.length)}function gDe(r){let e=tu.default.decode(r),t=r.slice(tu.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+Ee(t,"base64url")}function yDe(r){let e=tu.default.decode(r),t=r.slice(tu.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return Ee(t,"base58btc")}function wDe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=Ot.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=QN(n);return yr([t,i],t.length+i.length)}function bDe(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=Ot.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=QN(n);return yr([t,i],t.length+i.length)}function Qne(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=Ee(e,"base32"),i=Jne(t);return`${n}:${i}`}var u2=C(Xo(),1);function _De(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let i=t[n],o=hr(i);if(o.size===0){e.push([i]);continue}if(n++,n>=t.length)throw tie("invalid address: "+r);if(o.path===!0){e.push([i,tD(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function EDe(r){let e=[];return r.map(t=>{let n=A7(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),tD(e.join("/"))}function vDe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=A7(e);return e.length>1?[t.code,Zne(t.code,e[1])]:[t.code]})}function XN(r){return r.map(e=>{let t=A7(e);return e[1]!=null?[t.code,Xne(t.code,e[1])]:[t.code]})}function ZN(r){return S7(yr(r.map(e=>{let t=A7(e),n=Uint8Array.from(u2.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=yr([n,e[1]])),n})))}function JN(r,e){return r.size>0?r.size/8:r.size===0?0:u2.default.decode(e)+(u2.default.decode.bytes??0)}function x7(r){let e=[],t=0;for(;t<r.length;){let n=u2.default.decode(r,t),i=u2.default.decode.bytes??0,o=hr(n),s=JN(o,r.slice(t+i));if(s===0){e.push([n]),t+=i;continue}let a=r.slice(t+i,t+i+s);if(t+=s+i,t>r.length)throw tie("Invalid address Uint8Array: "+Ee(r,"base16"));e.push([n,a])}return e}function eD(r){let e=x7(r),t=XN(e);return EDe(t)}function xDe(r){r=tD(r);let e=_De(r),t=vDe(e);return ZN(t)}function eie(r){return xDe(r)}function S7(r){let e=SDe(r);if(e!=null)throw e;return Uint8Array.from(r)}function SDe(r){try{x7(r)}catch(e){return e}}function tD(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function tie(r){return new Error("Error parsing address: "+r)}function A7(r){return hr(r[0])}var nD=C(Xo(),1);var nie=C(ee(),1);var l2=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},rD=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Gw,jw,Ww,rie,TDe=Symbol.for("nodejs.util.inspect.custom"),IDe=[hr("dns").code,hr("dns4").code,hr("dns6").code,hr("dnsaddr").code],iD=new Map,iie=Symbol.for("@multiformats/js-multiaddr/multiaddr");function oie(r,e){if(r==null)throw new Error("requires node address object");if(e==null)throw new Error("requires transport protocol");let t,n=r.address;switch(r.family){case 4:t="ip4";break;case 6:if(t="ip6",n.includes("%")){let i=n.split("%");if(i.length!==2)throw Error("Multiple ip6 zones in multiaddr");n=i[0],t=`/ip6zone/${i[1]}/ip6`}break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new ru("/"+[t,n,e,r.port].join("/"))}function sie(r){return as(r)?r.protos().some(e=>e.resolvable):!1}function as(r){return!!(r!=null&&r[iie])}var ru=class{constructor(e){if(Gw.set(this,void 0),jw.set(this,void 0),Ww.set(this,void 0),this[rie]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=S7(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=eie(e)}else if(as(e))this.bytes=S7(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return l2(this,Gw,"f")==null&&rD(this,Gw,eD(this.bytes),"f"),l2(this,Gw,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,i,o="",s=hr("tcp"),a=hr("udp"),c=hr("ip4"),u=hr("ip6"),l=hr("dns6"),f=hr("ip6zone");for(let[d,p]of this.stringTuples())d===f.code&&(o=`%${p??""}`),IDe.includes(d)&&(t=s.name,i=443,n=`${p??""}${o}`,e=d===l.code?6:4),(d===s.code||d===a.code)&&(t=hr(d).name,i=parseInt(p??"")),(d===c.code||d===u.code)&&(t=hr(d).name,n=`${p??""}${o}`,e=d===u.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},hr(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let i=nD.default.decode(t,n),o=nD.default.decode.bytes??0,s=hr(i),a=JN(s,t.slice(n+o));n+=a+o,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return l2(this,jw,"f")==null&&rD(this,jw,x7(this.bytes),"f"),l2(this,jw,"f")}stringTuples(){return l2(this,Ww,"f")==null&&rD(this,Ww,XN(this.tuples()),"f"),l2(this,Ww,"f")}encapsulate(e){return e=new ru(e),new ru(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ru(n.slice(0,i))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new ru(ZN(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===Hw.ipfs.code).pop();if((t==null?void 0:t[1])!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?Ee(tt.decode(`z${n}`),"base58btc"):Ee(ce.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>hr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return rr(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(o=>o.resolvable);if(t==null)return[this];let n=iD.get(t.name);if(n==null)throw(0,nie.default)(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(o=>new ru(o))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Gw=new WeakMap,jw=new WeakMap,Ww=new WeakMap,rie=iie,TDe)](){return`Multiaddr(${eD(this.bytes)})`}};function lt(r){return new ru(r)}oD.default.util.Long=void 0;oD.default.configure();async function RDe(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:o}of r.datastore.query({prefix:"/peers"})){n.push(i);let s=i.toString(),[,a,c,u,l]=s.split("/");if(a==="peers"&&["protos","addrs","metadata","keys"].includes(c)&&u)if(t[u]=t[u]||{addresses:[],protocols:[],metadata:[]},c==="protos"){let f=KN.decode(o);t[u].protocols=f.protocols.sort()}else if(c==="addrs"){let f=qN.decode(o);t[u].addresses=f.addrs.sort((h,d)=>lt(h.multiaddr).toString().localeCompare(lt(d.multiaddr).toString())),f.certifiedRecord&&f.certifiedRecord.raw&&(t[u].peerRecordEnvelope=f.certifiedRecord.raw)}else c==="metadata"?t[u].metadata.push({key:l,value:o}):c==="keys"&&(t[u].pubKey=o)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let i of Object.keys(t)){let o=t[i];o.metadata=o.metadata.sort((a,c)=>a.key.localeCompare(c.key));let s=GN.encode(o).finish();await r.datastore.put(new pe(`/peers/${i}`),s)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function CDe(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();let t={},n=[];for await(let{key:i,value:o}of r.datastore.query({prefix:"/peers"})){n.push(i);let s=i.toString(),[,,a]=s.split("/");t[a]=GN.decode(o)}e(33,"Read peer data from store");for(let i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(let[i,o]of Object.entries(t)){if(o.protocols&&o.protocols.length>0&&await r.datastore.put(new pe(`/peers/protos/${i}`),KN.encode({protocols:o.protocols}).finish()),o.addresses&&o.addresses.length>0){let s=o.peerRecordEnvelope,a;if(s){let c=Bne.decode(s),u=Une.decode(c.payload);a={raw:s,seq:u.seq}}await r.datastore.put(new pe(`/peers/addrs/${i}`),qN.encode({addrs:o.addresses,certifiedRecord:a}).finish())}if(o.metadata&&o.metadata.length>0)for(let{key:s,value:a}of o.metadata)await r.datastore.put(new pe(`/peers/metadata/${i}/${s}`),a);o.pubKey&&await r.datastore.put(new pe(`/peers/keys/${i}`),o.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}var aie={version:12,description:"Store each peerstore peer under a single datastore key",migrate:RDe,revert:CDe};var Ip={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},T7=[Object.assign({version:1},Ip),Object.assign({version:2},Ip),Object.assign({version:3},Ip),Object.assign({version:4},Ip),Object.assign({version:5},Ip),Object.assign({version:6},Ip),Object.assign({version:7},Ip),wne,Ine,kne,Dne,aie];var cie=C($s(),1);var sD={};xe(sD,{InvalidValueError:()=>h2,MissingRepoOptionsError:()=>nu,NonReversibleMigrationError:()=>f2,NotInitializedRepoError:()=>xd,RequiredParameterError:()=>d2});var f2=class extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=f2.code,this.message=e}};f2.code="ERR_NON_REVERSIBLE_MIGRATION";var xd=class extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=xd.code,this.message=e}};xd.code="ERR_NOT_INITIALIZED_REPO";var d2=class extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=d2.code,this.message=e}};d2.code="ERR_REQUIRED_PARAMETER";var h2=class extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=h2.code,this.message=e}};h2.code="ERR_INVALID_VALUE";var nu=class extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=nu.code,this.message=e}};nu.code="ERR_MISSING_REPO_OPTIONS";var aD=(0,cie.default)("ipfs:repo:migrator:repo:init");async function uie(r){if(!r)throw new nu("Please pass repo options when trying to open a repo");let e=r.root;try{await e.open();let t=await e.has($w),n=await e.has(Rne);return!t||!n?(aD(`Version entry present: ${t}`),aD(`Config entry present: ${n}`),!1):!0}catch(t){return aD("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function cD(r){if(!await uie(r))throw new xd("Repo is not initialized!");let e=r.root;await e.open();try{return parseInt(Ee(await e.get($w)))}finally{await e.close()}}async function Yw(r,e){if(!e)throw new nu("Please pass repo options when trying to open a repo");let t=e.root;await t.open(),await t.put($w,fe(String(r))),await t.close()}var lie=C($s(),1),Xa=(0,lie.default)("ipfs:repo:migrator");function kDe(r){return r=r||T7,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function fie(r,e,t,n,i={}){let o=i.ignoreLock??!1,s=i.onProgress,a=i.isDryRun??!1,c=i.migrations??T7;if(!r)throw new Xs.RequiredParameterError("Path argument is required!");if(!t)throw new Xs.RequiredParameterError("repoOptions argument is required!");if(!n)throw new Xs.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new Xs.InvalidValueError("Version has to be positive integer!");e=VN(e);let u=await cD(e);if(u===n){Xa("Nothing to migrate.");return}if(u>n)throw new Xs.InvalidValueError(`Current repo's version (${u}) is higher then toVersion (${n}), you probably wanted to revert it?`);hie(c,u,n);let l;!a&&!o&&(l=await t.repoLock.lock(r));try{for(let f of c){if(n!==void 0&&f.version>n)break;if(!(f.version<=u)){Xa(`Migrating version ${f.version}`);try{if(!a){let h=()=>{};s&&(h=(d,p)=>s(f.version,d.toFixed(2),p)),await f.migrate(e,h)}}catch(h){let d=f.version-1;throw Xa(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${d}`),await Yw(d,e),new Error(`During migration to version ${f.version} exception was raised: ${h.stack||h.message||h}`)}Xa(`Migrating to version ${f.version} finished`)}}a||await Yw(n||kDe(c),e),Xa("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!a&&!o&&l&&await l.close()}}async function die(r,e,t,n,i={}){let o=i.ignoreLock??!1,s=i.onProgress,a=i.isDryRun??!1,c=i.migrations??T7;if(!r)throw new Xs.RequiredParameterError("Path argument is required!");if(!t)throw new Xs.RequiredParameterError("repoOptions argument is required!");if(!n)throw new Xs.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new Xs.InvalidValueError("Version has to be positive integer!");e=VN(e);let u=await cD(e);if(u===n){Xa("Nothing to revert.");return}if(u<n)throw new Xs.InvalidValueError(`Current repo's version (${u}) is lower then toVersion (${n}), you probably wanted to migrate it?`);hie(c,n,u,!0);let l;!a&&!o&&(l=await t.repoLock.lock(r)),Xa(`Reverting from version ${u} to ${n}`);try{let f=c.slice().reverse();for(let h of f){if(h.version<=n)break;if(!(h.version>u)){Xa(`Reverting migration version ${h.version}`);try{if(!a){let d=()=>{};s&&(d=(p,g)=>s(h.version,p.toFixed(2),g)),await h.revert(e,d)}}catch(d){let p=h.version;throw Xa(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${p}`),await Yw(p,e),d.message=`During reversion to version ${h.version} exception was raised: ${d.message}`,d}Xa(`Reverting to version ${h.version} finished`)}}a||await Yw(n,e),Xa(`All migrations successfully reverted to version ${n}!`)}finally{!a&&!o&&l&&await l.close()}}function hie(r,e,t,n=!1){let i=0;for(let o of r){if(o.version>t)break;if(o.version>e){if(n&&!o.revert)throw new Xs.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${o.version} is not reversible. Cancelling reversion.`);i++}}if(i!==t-e)throw new Xs.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}var Xs=sD;var jie=C(gie(),1);var _ie=C($s(),1);var Rp=class extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=Rp.code}};Rp.code="ERR_LOCK_EXISTS";var cs=class extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=cs.code}};cs.code="ERR_NOT_FOUND";var Cp=class extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=Cp.code}};Cp.code="ERR_INVALID_REPO_VERSION";var Pp="ERR_REPO_NOT_INITIALIZED",yie="ERR_REPO_ALREADY_OPEN",wie="ERR_REPO_ALREADY_CLOSED";async function R7(r,e,t){let n=await e(r);if(n)return n;let i=bie(t);return i?new Promise((o,s)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{o(!!a.result)}}):!1}async function C7(r,e,t,n){if(await t(r))return e(r);let i=bie(n);if(!i)throw new cs;return new Promise((o,s)=>{let a=i.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return o(a.result);s(new cs)}})}function bie(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}var UDe=(0,_ie.default)("ipfs:repo:version"),uD=new pe("version");function Eie(r){return{async exists(){return R7(uD,r.has.bind(r),r)},async get(){let e=await C7(uD,r.get.bind(r),r.has.bind(r),r);return parseInt(Ee(e),10)},set(e){return r.put(uD,fe(String(e)))},async check(e){let t=await this.get();return UDe("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}var P7=C(ee(),1);var FDe=Hs.default?Hs.default:Hs,lD=new pe("config");function vie(r){let e=new FDe({concurrency:1}),t={async getAll(o={}){let s=await C7(lD,r.get.bind(r),r.has.bind(r),r);return JSON.parse(Ee(s))},async get(o,s={}){if(o==null)throw new cs(`Key ${o} does not exist in config`);let a=await this.getAll(s),c=zw(a,o);if(c===void 0)throw new cs(`Key ${o} does not exist in config`);return c},set(o,s,a={}){if(typeof o!="string"&&!(o instanceof String))throw(0,P7.default)(new Error("Invalid key type: "+typeof o),"ERR_INVALID_KEY");if(s===void 0||s instanceof Uint8Array)throw(0,P7.default)(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:o,value:s},a.signal))},replace(o,s={}){if(!o||o instanceof Uint8Array)throw(0,P7.default)(new Error("Invalid value type: "+typeof o),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:o},s.signal))},async exists(){return R7(lD,r.has.bind(r),r)}};return t;async function n(o,s){if(s&&s.aborted)return;let a=o.key,c=o.value;if(a){let u=await t.getAll();return typeof u=="object"&&u!==null&&$r(u,a,c),i(u)}return i(c)}function i(o){let s=fe(JSON.stringify(o,null,2));return r.put(lD,s)}}function Qw(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function fD(r,e={}){if(!Qw(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");let{deep:t,compare:n}=e,i=[],o=[],s=c=>{let u=i.indexOf(c);if(u!==-1)return o[u];let l=[];return i.push(c),o.push(l),l.push(...c.map(f=>Array.isArray(f)?s(f):Qw(f)?a(f):f)),l},a=c=>{let u=i.indexOf(c);if(u!==-1)return o[u];let l={},f=Object.keys(c).sort(n);i.push(c),o.push(l);for(let h of f){let d=c[h],p;t&&Array.isArray(d)?p=s(d):p=t&&Qw(d)?a(d):d,Object.defineProperty(l,h,{...Object.getOwnPropertyDescriptor(c,h),value:p})}return l};return Array.isArray(r)?t?s(r):r.slice():a(r)}var dD=new pe("datastore_spec");function xie(r){return{exists(){return r.has(dD)},async get(){let e=await r.get(dD);return JSON.parse(Ee(e))},async set(e){return r.put(dD,fe(JSON.stringify(fD(e,{deep:!0}))))}}}var hD=new pe("api");function Sie(r){return{async get(){let e=await r.get(hD);return e&&e.toString()},set(e){return r.put(hD,fe(e.toString()))},delete(){return r.delete(hD)}}}var Aie=C(ee(),1);function Tie(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){let n=Ad(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(let n of e)yield this.get(n,t)},async put(e,t,n){let{isIdentity:i}=Ad(e);i||await r.put(e,t,n)},async*putMany(e,t){let n=jn({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await on(r.putMany(async function*(){for await(let{key:o,value:s}of e)Ad(o).isIdentity||(yield{key:o,value:s}),n.push({key:o,value:s})}())),n.end()}catch(o){n.end(o)}}),yield*n},has(e,t){let{isIdentity:n}=Ad(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){let{isIdentity:n}=Ad(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(Yt(e,n=>!Ad(n).isIdentity),t)},batch(){let e=r.batch();return{put(t,n){let{isIdentity:i}=Ad(t);i||e.put(t,n)},delete(t){let{isIdentity:n}=Ad(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function Ad(r){let e=ce.asCID(r);if(e==null)throw(0,Aie.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==Ns.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}var Iie=C($s(),1),Rie=(0,Iie.default)("ipfs:repo:lock:memory"),Cie="repo.lock",Xw={};async function zDe(r){let e=r+"/"+Cie;if(Rie("locking %s",e),Xw[e]===!0)throw new Rp(`Lock already being held for file: ${e}`);return Xw[e]=!0,{async close(){Xw[e]&&delete Xw[e]}}}async function VDe(r){let e=r+"/"+Cie;return Rie(`checking lock: ${e}`),!!Xw[e]}var k7={lock:zDe,locked:VDe};var Pie={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:k7};var pD={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};var Die=C(ee(),1),Oie=C($s(),1);async function Fi(r){for await(let e of r)return e}function N7({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*KDe(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t],o=ce.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*mD(n,i))}else{let t=ce.asCID(e);t?yield[r.join("/"),t]:yield*mD(e,r)}}function*mD(r,e){if(r==null||r instanceof Uint8Array)return;let t=ce.asCID(r);t&&(yield[e.join("/"),t]);for(let[n,i]of Object.entries(r)){let o=[...e,n];yield*KDe(o,i)}}function*$De(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let i=[...r,t];yield i.join("/"),typeof n=="object"&&!ce.asCID(n)&&(yield*gD(n,i))}else yield*gD(e,r)}function*gD(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ce.asCID(n)&&(yield*$De(i,n))}}function qDe(r,e){let t=r;for(let[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let o=ce.asCID(t);if(o)return{value:o,remaining:e.slice(n+1).join("/")}}return{value:t}}var yD=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:N7(),bytes:N7(),value:N7(),asBlock:N7()})}links(){return mD(this.value,[])}tree(){return gD(this.value,[])}get(e="/"){return qDe(this.value,e.split("/").filter(Boolean))}};function D7({bytes:r,cid:e,value:t,codec:n}){let i=t!==void 0?t:n&&n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new yD({cid:e,bytes:r,value:i})}var kie=C(ee(),1);function Zw(r){let e=ce.asCID(r);if(e==null)throw(0,kie.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");let t=Ot.encode(e.multihash.bytes);return new pe("/"+t.slice(1).toUpperCase(),!1)}function wD(r){return Jn(Ot.decode(`b${r.toString().toLowerCase().substring(1)}`))}var Nie=C($s(),1);var HDe=(0,Nie.default)("ipfs:repo:utils:walk-dag");async function*p2(r,e,t,n){try{let i=await e.get(r,n),o=await t(r.code),s=D7({bytes:i,cid:r,codec:o});for(let[,a]of s.links())yield a,yield*p2(a,e,t,n)}catch(i){throw HDe("Could not walk DAG for CID",r.toString(),i),i}}var Jw=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(let[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){let i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,o]=n;this._deleteIfExpired(i,o)===!1&&(yield[i,o.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,o]=n;this.cache.has(i)||this._deleteIfExpired(i,o)===!1&&(yield[i,o.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};var GDe=2048;function jDe(r){let e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return(0,Die.default)(new Error(e),"ERR_INVALID_PIN_TYPE")}var O7=class{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=(0,Oie.default)("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);let n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==Zo&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(Zw(e),zu(n))}unpin(e,t){return this.pinstore.delete(Zw(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);let n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==Zo&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(Zw(e),zu(n))}async*directKeys(e){for await(let t of this.pinstore.query({filters:[n=>ks(n.value).depth===0]})){let n=ks(t.value),i=n.version||0,o=n.codec!=null?n.codec:Zo,s=wD(t.key);yield{cid:ce.create(i,o,s),metadata:n.metadata}}}async*recursiveKeys(e){for await(let t of this.pinstore.query({filters:[n=>ks(n.value).depth===1/0]})){let n=ks(t.value),i=n.version||0,o=n.codec!=null?n.codec:Zo,s=wD(t.key);yield{cid:ce.create(i,o,s),metadata:n.metadata}}}async*indirectKeys(e){for await(let{cid:t}of this.recursiveKeys())for await(let n of p2(t,this.blockstore,this.loadCodec,e)){let i=[Pt.recursive];(await this.isPinnedWithType(n,i)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);let i=t.includes(Pt.all),o=t.includes(Pt.direct),s=t.includes(Pt.recursive),a=t.includes(Pt.indirect);if(s||o||i){let l=await Fi(this.pinstore.query({prefix:Zw(e).toString(),filters:[f=>{if(i)return!0;let h=ks(f.value);return t.includes(h.depth===0?Pt.direct:Pt.recursive)}],limit:1}));if(l){let f=ks(l.value);return{cid:e,pinned:!0,reason:f.depth===0?Pt.direct:Pt.recursive,metadata:f.metadata}}}let c=this;async function*u(l,f){for await(let{cid:h}of f)for await(let d of p2(h,c.blockstore,c.loadCodec))if(d.equals(l)){yield h;return}}if(i||a){let l=await Fi(u(e,this.recursiveKeys()));if(l)return{cid:e,pinned:!0,reason:Pt.indirect,parent:l}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){let n=new Jw({maxSize:t.cidCacheMaxSize??GDe}),i=async(o,s)=>{if(n.has(o.toString()))return;n.set(o.toString(),!0);let a=await this.blockstore.get(o,s),c=await this.loadCodec(o.code),u=D7({bytes:a,cid:o,codec:c});await Promise.all([...u.links()].map(([,l])=>i(l,s)))};await i(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(Pt).includes(e))throw jDe(e);return!0}};var Bie=C(ee(),1);function Mie(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,i){await e.put(t,n,i)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await Lie(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(Bi(t,async i=>(await Lie(i,r),i)),n)},batch(){return e.batch()}}}async function Lie(r,e){let{pinned:t,reason:n}=await e.isPinnedWithType(r,Pt.all);if(t)throw(0,Bie.default)(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}var bD=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},_D=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Uie=r=>globalThis.DOMException===void 0?new _D(r):new DOMException(r),Fie=r=>{let e=r.reason===void 0?Uie("This operation was aborted."):r.reason;return e instanceof Error?e:Uie(e)};function ED(r,e){let{milliseconds:t,fallback:n,message:i,customTimers:o={setTimeout,clearTimeout}}=e,s,a=new Promise((c,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){c(r);return}if(e.signal){let{signal:f}=e;f.aborted&&u(Fie(f)),f.addEventListener("abort",()=>{u(Fie(f))})}let l=new bD;s=o.setTimeout.call(void 0,()=>{if(n){try{c(n())}catch(f){u(f)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?c():i instanceof Error?u(i):(l.message=i??`Promise timed out after ${t} milliseconds`,u(l))},t),(async()=>{try{c(await r)}catch(f){u(f)}finally{o.clearTimeout.call(void 0,s)}})()});return a.clear=()=>{o.clearTimeout.call(void 0,s),s=void 0},a}var vD="lock:worker:request-read",xD="lock:worker:release-read",SD="lock:master:grant-read",AD="lock:worker:request-write",TD="lock:worker:release-write",ID="lock:master:grant-write";var zie=(r,e,t,n,i)=>(o,s)=>{if(s.data.type!==t)return;let a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(o.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{let u=l=>{if(l==null||l.data==null)return;let f={type:l.data.type,name:l.data.name,identifier:l.data.identifier};f.type===n&&f.identifier===a.identifier&&(o.removeEventListener("message",u),c())};o.addEventListener("message",u)}))}}))},Vie=(r,e,t,n)=>async()=>{let i=k1();return globalThis.postMessage({type:e,identifier:i,name:r}),await new Promise(o=>{let s=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",s),o(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",s)})},WDe={singleProcess:!1},Kie=r=>{if(r=Object.assign({},WDe,r),!!globalThis.document||r.singleProcess){let t=new EventTarget;return Xm.addEventListener("message",zie(t,"requestReadLock",vD,xD,SD)),Xm.addEventListener("message",zie(t,"requestWriteLock",AD,TD,ID)),t}return{isWorker:!0,readLock:t=>Vie(t,vD,SD,xD),writeLock:t=>Vie(t,AD,ID,TD)}};var kp={},Td;async function RD(r,e){let t,n=new Promise(i=>{t=i});return r.add(async()=>await ED((async()=>await new Promise(i=>{t(()=>{i()})}))(),{milliseconds:e.timeout})),await n}var YDe=(r,e)=>{if(Td.isWorker===!0)return{readLock:Td.readLock(r,e),writeLock:Td.writeLock(r,e)};let t=new Hs({concurrency:1}),n;return{async readLock(){if(n!=null)return await RD(n,e);n=new Hs({concurrency:e.concurrency,autoStart:!1});let i=n,o=RD(n,e);return t.add(async()=>(i.start(),await i.onIdle().then(()=>{n===i&&(n=null)}))),await o},async writeLock(){return n=null,await RD(t,e)}}},QDe={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function e5(r){let e=Object.assign({},QDe,r);return Td==null&&(Td=Kie(e),Td.isWorker!==!0&&(Td.addEventListener("requestReadLock",t=>{kp[t.data.name]!=null&&kp[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),Td.addEventListener("requestWriteLock",async t=>{kp[t.data.name]!=null&&kp[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),kp[e.name]==null&&(kp[e.name]=YDe(e.name,e)),kp[e.name]}var $ie=C($s(),1);async function*CD(r,e=1){let t=[];e<1&&(e=1);for await(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*PD(r,e=1){for await(let t of CD(r,e)){let n=t.map(async i=>await i().then(o=>({ok:!0,value:o}),o=>({ok:!1,err:o})));for(let i=0;i<n.length;i++){let o=await n[i];if(o.ok)yield o.value;else throw o.err}}}var t5=(0,$ie.default)("ipfs:repo:gc"),XDe=Gn().code,ZDe=256,JDe=new pe("/local/filesroot");function qie({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:i}){async function*o(){let s=Date.now();t5("Creating set of marked blocks");let a=await r.writeLock();try{let c=await eOe({pins:e,blockstore:t,root:n,loadCodec:i}),u=t.queryKeys({});yield*tOe({blockstore:t},c,u),t5(`Complete (${Date.now()-s}ms)`)}finally{a()}}return o}async function eOe({pins:r,blockstore:e,loadCodec:t,root:n}){let i=async function*(){let a;try{a=await n.get(JDe)}catch(u){if(u.code===XDe){t5("No blocks in MFS");return}throw u}let c=ce.decode(a);yield c,yield*p2(c,e,t)}(),o=Qo(Bi(r.recursiveKeys(),({cid:a})=>a),r.indirectKeys(),Bi(r.directKeys(),({cid:a})=>a),i),s=new Set;for await(let a of Qo(o,i))s.add(Ot.encode(a.multihash.bytes));return s}async function*tOe({blockstore:r},e,t){let n=0,i=0;yield*Ne(PD(Bi(t,async s=>async function(){n++;try{let c=Ot.encode(s.multihash.bytes);if(e.has(c))return null;try{await r.delete(s),i++}catch(u){return{err:new Error(`Could not delete block with CID ${s}: ${u.message}`)}}return{cid:s}}catch(c){let u=`Could delete block with CID ${s}`;return t5(u,c),{err:new Error(u+`: ${c.message}`)}}}),ZDe),s=>Yt(s,Boolean)),t5(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${i} blocks.`)}var Eo=(0,Gie.default)("ipfs:repo"),rOe=Number.MAX_SAFE_INTEGER,nOe="repoAutoMigrate",kD=class{constructor(e,t,n,i){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=et(Pie,i),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;let o=n.blocks,s=n.pins;this.pins=new O7({pinstore:s,blockstore:o,loadCodec:t});let a=Mie(this.pins,o);this.blocks=Tie(a),this.version=Eie(this.root),this.config=vie(this.root),this.spec=xie(this.root),this.apiAddr=Sie(this.root),this.gcLock=e5({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=qie({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){Eo("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(iOe(e)),await this.spec.set(oOe(e)),await this.version.set(12)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw(0,Np.default)(new Error("repo is already open"),yie);Eo("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),Eo("acquired repo.lock"),!await this.version.check(12))if(await this._isAutoMigrationEnabled())await this._migrate(12,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new Cp("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");Eo("creating datastore"),await this.datastore.open(),Eo("creating blocks"),await this.blocks.open(),Eo("creating keystore"),await this.keys.open(),Eo("creating pins"),await this.pins.pinstore.open(),this.closed=!1,Eo("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){Eo("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){let e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw(0,Np.default)(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){Eo("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?(0,Np.default)(new Error("repo is not initialized yet"),Pp,{path:this.path}):t}if(!e)throw(0,Np.default)(new Error("repo is not initialized yet"),Pp,{path:this.path})}async close(){if(this.closed)throw(0,Np.default)(new Error("repo is already closed"),wie);Eo("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==Pp&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),Eo("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){let[e,t,n,i,o]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),Hie(this.datastore),Hie(this.keys)]),s=t.size+i+o;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:s}}throw(0,Np.default)(new Error("repo is not initialized yet"),Pp,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(nOe)}catch(t){if(t.code===cs.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(Eo(`reverting to version ${e}`),die(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(Eo(`migrating to version ${e}`),fie(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{let e=await this.config.get("Datastore.StorageMax");return BigInt((0,jie.default)(e))}catch{return BigInt(rOe)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(let{key:n,value:i}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(i.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}};async function Hie(r){let e=BigInt(0);for await(let t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function Wie(r,e,t,n){return new kD(r,e,t,n)}function iOe(r){return r.Datastore=Object.assign({},pD,zw(r,"datastore")),r}function oOe(r){let e={...pD.Spec,...zw(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}async function*Id(r,e){yield*(await Wo(r)).sort(e)}var Rse=C(Ise(),1),Ud=class extends go{constructor(e,t={}){super(),this.db=typeof e=="string"?new Rse.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw Vo.dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw Vo.dbWriteFailedError(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?Vo.notFoundError(n):Vo.dbWriteFailedError(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw Vo.dbDeleteFailedError(t)}}close(){return this.db&&this.db.close()}batch(){let e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((o,s)=>Yt(o,s),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((o,s)=>Id(o,s),t));let{offset:n,limit:i}=e;if(n){let o=0;t=Yt(t,()=>o++>=n)}return i&&(t=Ga(t,i)),t}queryKeys(e){let t=Bi(this._query({values:!1,prefix:e.prefix}),({key:o})=>o);Array.isArray(e.filters)&&(t=e.filters.reduce((o,s)=>Yt(o,s),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((o,s)=>Id(o,s),t));let{offset:n,limit:i}=e;if(n){let o=0;t=Yt(t,()=>o++>=n)}return i&&(t=Ga(t,i)),t}_query(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){let i=e.prefix.toString();t.gte=i,t.lt=i+"\xFF"}let n=this.db.iterator(t);if(n[Symbol.asyncIterator])return $Le(n);if(n.next!=null&&n.end!=null)return qLe(n);throw new Error("Level returned incompatible iterator")}};async function*$Le(r){for await(let[e,t]of r)yield{key:new pe(e,!1),value:t};await r.close()}function qLe(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,i,o)=>{if(n)return t(n);if(i==null)return r.end(s=>{if(s)return t(s);e({done:!0,value:void 0})});e({done:!1,value:{key:new pe(i,!1),value:o}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}var Pse=C(ee(),1);var Cse=(r,e)=>async function*(){yield*(await Wo(r)).sort(e)}(),uu=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await on(this.putMany(e,n)),e=[],await on(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=Yt(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>Yt(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>Cse(i,o),n)),e.offset!=null){let i=0;n=Yt(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=Ga(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=Yt(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>Yt(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>Cse(i,o),n)),e.offset!=null){let i=0;n=Yt(n,()=>i++>=e.offset)}return e.limit!=null&&(n=Ga(n,e.limit)),n}};function P2(r){let e=ce.asCID(r);if(!e)throw(0,Pse.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return new pe("/"+Ot.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function Fd(r){return ce.createV1(Sc,Jn(Ot.decode("b"+r.toString().slice(1).toLowerCase())))}function DO(r){let e=r.substring(0,1);if(e==="/")return DO(r.substring(1));let t;e.toLowerCase()==="b"?t=o=>Ot.decode(o.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=o=>kT.decode(o.toLowerCase()).subarray(2):e==="z"?t=o=>tt.decode(o).subarray(2):e==="Q"?t=o=>tt.decode("z"+o):t=o=>Ot.decode("b"+o.toLowerCase()).subarray(2);let n;for(let o=1;o<r.length;o++)try{n=t(r.substring(0,o))}catch(s){if(s.message!=="Unexpected end of data")throw s}let i="/C";return n&&(i=`/${Ot.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}function HLe(r){return{...r,prefix:r.prefix?DO(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:Fd(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:Fd(t.key),value:t.value},{key:Fd(n.key),value:n.value})):void 0}}function GLe(r){return{...r,prefix:r.prefix?DO(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(Fd(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(Fd(t),Fd(n))):void 0}}var fv=class extends uu{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(let{key:n,value:i}of this.child.query(HLe(e),t))yield{key:Fd(n),value:i}}async*queryKeys(e,t){for await(let n of this.child.queryKeys(GLe(e),t))yield Fd(n)}async get(e,t){return this.child.get(P2(e),t)}async*getMany(e,t){for await(let n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(P2(e),t,n)}async*putMany(e,t){let n=jn({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{let o=this.child;await on(this.child.putMany(async function*(){for await(let s of e){let a=P2(s.key);await o.has(a,t)||(yield{key:a,value:s.value}),n.push(s)}}())),n.end()}catch(o){n.end(o)}}),yield*n}has(e,t){return this.child.has(P2(e),t)}delete(e,t){return this.child.delete(P2(e),t)}deleteMany(e,t){let n=jn({objectMode:!0});return on(this.child.deleteMany(async function*(){for await(let i of e)yield P2(i),n.push(i);n.end()}(),t)).catch(i=>{n.end(i)}),n}};function kse(r,e,t){let n=t.path||"ipfs";return Wie(n,i=>e.getCodec(i),{root:new Ud(n,{prefix:"",version:2}),blocks:new fv(new Ud(`${n}/blocks`,{prefix:"",version:2})),datastore:new Ud(`${n}/datastore`,{prefix:"",version:2}),keys:new Ud(`${n}/keys`,{prefix:"",version:2}),pins:new Ud(`${n}/pins`,{prefix:"",version:2})},{autoMigrate:t.autoMigrate,onMigrationProgress:t.onMigrationProgress||r,repoLock:k7})}var lr=C(v_(),1);var Ige=C(ee(),1);function dv(r){return r instanceof Uint8Array?{get(e){return r[e]},set(e,t){r[e]=t}}:{get(e){return r.get(e)},set(e,t){r.set(e,t)}}}var Nse=4294967296,Vi=class{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Vi(n,t)}zzEncode(){let e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Vi(t,n)}toBytes(e,t=0){let n=dv(e);for(;this.hi>0;)n.set(t++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(t++,this.lo&127|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(e===0n)return new Vi;let t=e<0;t&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return t&&(n=~n>>>0,i=~i>>>0,++i>Nse&&(i=0,++n>Nse&&(n=0))),new Vi(n,i)}static fromNumber(e){if(e===0)return new Vi;let t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Vi(i,n)}static fromBytes(e,t=0){let n=dv(e),i=new Vi,o=0;if(e.length-t>4){for(;o<4;++o)if(i.lo=(i.lo|(n.get(t)&127)<<o*7)>>>0,n.get(t++)<128)return i;if(i.lo=(i.lo|(n.get(t)&127)<<28)>>>0,i.hi=(i.hi|(n.get(t)&127)>>4)>>>0,n.get(t++)<128)return i;o=0}else for(;o<4;++o){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.lo=(i.lo|(n.get(t)&127)<<o*7)>>>0,n.get(t++)<128)return i}if(e.length-t>4){for(;o<5;++o)if(i.hi=(i.hi|(n.get(t)&127)<<o*7+3)>>>0,n.get(t++)<128)return i}else if(t<e.byteLength)for(;o<5;++o){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.hi=(i.hi|(n.get(t)&127)<<o*7+3)>>>0,n.get(t++)<128)return i}throw RangeError("invalid varint encoding")}};var jLe=Math.pow(2,7),WLe=Math.pow(2,14),YLe=Math.pow(2,21),QLe=Math.pow(2,28),XLe=Math.pow(2,35),ZLe=Math.pow(2,42),JLe=Math.pow(2,49),eBe=Math.pow(2,56),tBe=Math.pow(2,63),Yp={encodingLength(r){return r<jLe?1:r<WLe?2:r<YLe?3:r<QLe?4:r<XLe?5:r<ZLe?6:r<JLe?7:r<eBe?8:r<tBe?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=vf(Yp.encodingLength(r))),Vi.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return Vi.fromBytes(r,e).toNumber(!0)}};var Dse={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var S5;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(S5||(S5={}));var A5=class{constructor(e){B(this,"peerId");B(this,"payloadType");B(this,"payload");B(this,"signature");B(this,"marshaled");let{peerId:t,payloadType:n,payload:i,signature:o}=e;this.peerId=t,this.payloadType=n,this.payload=i,this.signature=o}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=S5.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return mt(this.marshal(),e.marshal())}async validate(e){let t=Ose(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return Bs(this.peerId.publicKey).verify(t.subarray(),this.signature)}},zd=A5;B(zd,"createFromProtobuf",async e=>{let t=S5.decode(e),n=await Hn(t.publicKey);return new A5({peerId:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),B(zd,"seal",async(e,t)=>{if(t.privateKey==null)throw new Error("Missing private key");let n=e.domain,i=e.codec,o=e.marshal(),s=Ose(n,i,o),c=await(await Li(t.privateKey)).sign(s.subarray());return new A5({peerId:t,payloadType:i,payload:o,signature:c})}),B(zd,"openAndCertify",async(e,t)=>{let n=await A5.createFromProtobuf(e);if(!await n.validate(t))throw new J("envelope signature is not valid for the given domain",Dse.ERR_SIGNATURE_NOT_VALID);return n});var Ose=(r,e,t)=>{let n=Ie(r),i=Yp.encode(n.byteLength),o=Yp.encode(e.length),s=Yp.encode(t.length);return new vt(i,n,o,e,s,t)};var rBe=Uint8Array.from([3,1]);var OO;(function(r){let e;(function(n){let i;n.codec=()=>(i==null&&(i=kn((o,s,a={})=>{a.lengthDelimited!==!1&&s.fork(),o.multiaddr!=null&&o.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(o.multiaddr)),a.lengthDelimited!==!1&&s.ldelim()},(o,s)=>{let a={multiaddr:new Uint8Array(0)},c=s==null?o.len:o.pos+s;for(;o.pos<c;){let u=o.uint32();switch(u>>>3){case 1:a.multiaddr=o.bytes();break;default:o.skipType(u&7);break}}return a})),i),n.encode=o=>Pn(o,n.codec()),n.decode=o=>Cn(o,n.codec())})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=kn((n,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(i.uint32(10),i.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(i.uint32(16),i.uint64(n.seq)),n.addresses!=null)for(let s of n.addresses)i.uint32(26),r.AddressInfo.codec().encode(s,i);o.lengthDelimited!==!1&&i.ldelim()},(n,i)=>{let o={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=i==null?n.len:n.pos+i;for(;n.pos<s;){let a=n.uint32();switch(a>>>3){case 1:o.peerId=n.bytes();break;case 2:o.seq=n.uint64();break;case 3:o.addresses.push(r.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return o})),t),r.encode=n=>Pn(n,r.codec()),r.decode=n=>Cn(n,r.codec())})(OO||(OO={}));var LO=Symbol.for("@libp2p/topology");var Lse=()=>{},nBe,BO=class{constructor(e){B(this,"min");B(this,"max");B(this,"peers");B(this,"onConnect");B(this,"onDisconnect");B(this,"registrar");B(this,nBe,!0);this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??Lse,this.onDisconnect=e.onDisconnect??Lse}get[Symbol.toStringTag](){return LO.toString()}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};nBe=LO;function hv(r){return new BO(r)}var lu,Ki=class extends EventTarget{constructor(){super(...arguments);bt(this,lu,new Map)}listenerCount(t){let n=ge(this,lu).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let o=ge(this,lu).get(t);o==null&&(o=[],ge(this,lu).set(t,o)),o.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let o=ge(this,lu).get(t);o!=null&&(o=o.filter(({callback:s})=>s!==n),ge(this,lu).set(t,o))}dispatchEvent(t){let n=super.dispatchEvent(t),i=ge(this,lu).get(t.type);return i==null||(i=i.filter(({once:o})=>!o),ge(this,lu).set(t.type,i)),n}safeDispatchEvent(t,n){return this.dispatchEvent(new cn(t,n))}};lu=new WeakMap;var MO=class extends Event{constructor(t,n){super(t,n);B(this,"detail");this.detail=n==null?void 0:n.detail}},cn=globalThis.CustomEvent??MO;var pv=class{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){let{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){let n=this.msgs.get(e);if(!n)return null;let i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){let t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{let o=this.msgs.get(i.msgIdStr);if(o&&o.validated&&e.has(i.topic)){let s=t.get(i.topic);s||(s=[],t.set(i.topic,s)),s.push(i.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;let{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{let n=this.msgs.get(t.msgIdStr);n&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}};var pae=C(hae(),1),{RPC:P5}=pae.default;var XO="/floodsub/1.0.0",ZO="/meshsub/1.0.0",JO="/meshsub/1.1.0";var mae="ERR_TOPIC_VALIDATOR_REJECT",gae="ERR_TOPIC_VALIDATOR_IGNORE";function hu(r){if(r.length<=1)return r;let e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){let n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function yae(r){return re(r,"base64")}var Zp="StrictSign",k2="StrictNoSign",rc;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(rc||(rc={}));var wae;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(wae||(wae={}));var qd;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(qd||(qd={}));var ao;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(ao||(ao={}));var $i;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})($i||($i={}));var ra;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(ra||(ra={}));function eL(r){switch(r){case rc.Ignore:return ao.Ignore;case rc.Reject:return ao.Reject}}async function tL(r,e){switch(r){case Zp:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let t=await Li(e.privateKey);return{type:qd.Signing,author:e,key:e.publicKey,privateKey:t}}case k2:return{type:qd.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}var br="ERR_INVALID_PEER_SCORE_PARAMS";var dBe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},hBe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function bae(r={}){return{...dBe,...r,topics:r.topics?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=pBe(n),e),{}):{}}}function pBe(r={}){return{...hBe,...r}}function _ae(r){for(let[e,t]of Object.entries(r.topics))try{mBe(t)}catch(n){throw new J(`invalid score parameters for topic ${e}: ${n.message}`,br)}if(r.topicScoreCap<0)throw new J("invalid topic score cap; must be positive (or 0 for no cap)",br);if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new J("missing application specific score function",br);if(r.IPColocationFactorWeight>0)throw new J("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",br);if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new J("invalid IPColocationFactorThreshold; must be at least 1",br);if(r.behaviourPenaltyWeight>0)throw new J("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",br);if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new J("invalid BehaviourPenaltyDecay; must be between 0 and 1",br);if(r.decayInterval<1e3)throw new J("invalid DecayInterval; must be at least 1s",br);if(r.decayToZero<=0||r.decayToZero>=1)throw new J("invalid DecayToZero; must be between 0 and 1",br)}function mBe(r){if(r.topicWeight<0)throw new J("invalid topic weight; must be >= 0",br);if(r.timeInMeshQuantum===0)throw new J("invalid TimeInMeshQuantum; must be non zero",br);if(r.timeInMeshWeight<0)throw new J("invalid TimeInMeshWeight; must be positive (or 0 to disable)",br);if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new J("invalid TimeInMeshQuantum; must be positive",br);if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new J("invalid TimeInMeshCap; must be positive",br);if(r.firstMessageDeliveriesWeight<0)throw new J("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",br);if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new J("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",br);if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new J("invalid FirstMessageDeliveriesCap; must be positive",br);if(r.meshMessageDeliveriesWeight>0)throw new J("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",br);if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new J("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",br);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new J("invalid MeshMessageDeliveriesCap; must be positive",br);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new J("invalid MeshMessageDeliveriesThreshold; must be positive",br);if(r.meshMessageDeliveriesWindow<0)throw new J("invalid MeshMessageDeliveriesWindow; must be non-negative",br);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new J("invalid MeshMessageDeliveriesActivation; must be at least 1s",br);if(r.meshFailurePenaltyWeight>0)throw new J("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",br);if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new J("invalid MeshFailurePenaltyDecay; must be between 0 and 1",br);if(r.invalidMessageDeliveriesWeight>0)throw new J("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",br);if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new J("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",br)}var gBe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function Eae(r={}){return{...gBe,...r}}function vae(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([s,a])=>{let c=t.topics[s];if(c===void 0)return;let u=0;if(a.inMesh){let d=a.meshTime/c.timeInMeshQuantum;d>c.timeInMeshCap&&(d=c.timeInMeshCap),u+=d*c.timeInMeshWeight}let l=a.firstMessageDeliveries;if(l>c.firstMessageDeliveriesCap&&(l=c.firstMessageDeliveriesCap),u+=l*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){let d=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,p=d*d;u+=p*c.meshMessageDeliveriesWeight}let f=a.meshFailurePenalty;u+=f*c.meshFailurePenaltyWeight;let h=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=h*c.invalidMessageDeliveriesWeight,i+=u*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);let o=t.appSpecificScore(r);if(i+=o*t.appSpecificWeight,e.knownIPs.forEach(s=>{if(t.IPColocationFactorWhitelist.has(s))return;let a=n.get(s),c=a?a.size:0;if(c>t.IPColocationFactorThreshold){let u=c-t.IPColocationFactorThreshold,l=u*u;i+=l*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){let s=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=s*s;i+=a*t.behaviourPenaltyWeight}return i}var Aae=C(Sae(),1),co;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(co||(co={}));var yv=class{constructor(){this.records=new Map,this.queue=new Aae.default}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:co.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};function bv(r,e,t=()=>!0){let n=new Set;if(e<=0)return n;for(let i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function Tae(r,e){return bv(r,e,()=>!0)}var wv=class extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return t===void 0&&(t=this.getDefault(),this.set(e,t)),t}};var N2=j("libp2p:gossipsub:score"),_v=class{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new wv(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new yv,_ae(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??vae}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){N2("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),N2("started")}stop(){if(!this._backgroundInterval){N2("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),N2("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([o,s])=>{let a=this.params.topics[o];a!==void 0&&(s.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,s.firstMessageDeliveries<t&&(s.firstMessageDeliveries=0),s.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,s.meshMessageDeliveries<t&&(s.meshMessageDeliveries=0),s.meshFailurePenalty*=a.meshFailurePenaltyDecay,s.meshFailurePenalty<t&&(s.meshFailurePenalty=0),s.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,s.invalidMessageDeliveries<t&&(s.invalidMessageDeliveries=0),s.inMesh&&(s.meshTime=e-s.graftTime,s.meshTime>a.meshMessageDeliveriesActivation&&(s.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,u;(a=this.metrics)==null||a.scoreFnCalls.inc();let t=this.peerStats.get(e);if(!t)return 0;let n=Date.now(),i=this.scoreCache.get(e);if(i&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();let o=this.computeScore(e,t,this.params,this.peerIPs),s=n+this.scoreCacheValidityMs;return i?((u=this.metrics)==null||u.scoreCachedDelta.observe(Math.abs(o-i.score)),i.score=o,i.cacheUntil=s):this.scoreCache.set(e,{score:o,cacheUntil:s}),o}addPenalty(e,t,n){var o;let i=this.peerStats.get(e);i&&(i.behaviourPenalty+=t,(o=this.metrics)==null||o.onScorePenalty(n))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.delete(t);let i=this.peerIPs.get(t);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;let o=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<o){let s=o-i.meshMessageDeliveries;i.meshFailurePenalty+=s*s}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let o=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<o){let s=o-i.meshMessageDeliveries;i.meshFailurePenalty+=s*s}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);let i=this.deliveryRecords.ensureRecord(t),o=Date.now();if(i.status!==co.unknown){N2("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,o-i.firstSeen,co[i.status]);return}i.status=co.valid,i.validated=o,i.peers.forEach(s=>{s!==e.toString()&&this.markDuplicateMessageDelivery(s,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case ao.Error:this.markInvalidMessageDelivery(e,n);return;case ao.Blacklisted:return}let o=this.deliveryRecords.ensureRecord(t);if(o.status!==co.unknown){N2("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-o.firstSeen,co[o.status]);return}if(i===ao.Ignore){o.status=co.ignored,o.peers.clear();return}o.status=co.invalid,this.markInvalidMessageDelivery(e,n),o.peers.forEach(s=>{this.markInvalidMessageDelivery(s,n)}),o.peers.clear()}duplicateMessage(e,t,n){let i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case co.unknown:i.peers.add(e);break;case co.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case co.invalid:this.markInvalidMessageDelivery(e,n);break;case co.ignored:break}}markInvalidMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);i&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,t);if(i){let o=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(o,i.firstMessageDeliveries+1),i.inMesh&&(o=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(o,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var o;let i=this.peerStats.get(e);if(i){let s=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a&&a.inMesh){let c=this.params.topics[t];if(n!==void 0){let l=s-n,f=l>c.meshMessageDeliveriesWindow;if((o=this.metrics)==null||o.onDuplicateMsgDelivery(t,l,f),f)return}let u=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(u,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let n of t){let i=this.peerIPs.get(n);i&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}};var Ev=class{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let n=Math.floor(Math.random()*t.length),i=t[n],o=this.msgIdToStrFn(i),s=this.promises.get(o);s||(s=new Map,this.promises.set(o,s));let a=Date.now();s.has(e)||(s.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(o)||this.requestMsByMsg.set(o,a)))}getBrokenPromises(){var i;let e=Date.now(),t=new Map,n=0;return this.promises.forEach((o,s)=>{o.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),o.delete(c),n++)}),o.size||this.promises.delete(s)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);let n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case ao.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[i,o]of this.requestMsByMsg.entries())if(o<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){let t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}};var D2=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}};var Iae;(function(r){r.forward="forward",r.publish="publish"})(Iae||(Iae={}));var Tl;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Tl||(Tl={}));var Jp;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Unsub="unsubscribed",r.Excess="excess"})(Jp||(Jp={}));var L2;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(L2||(L2={}));var B2;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(B2||(B2={}));var O2;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(O2||(O2={}));function Rae(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:r.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:r.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:r.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),msgReceivedStatus:r.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,1*t.maxMeshMessageDeliveriesWindowSec,2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,1*t.behaviourPenaltyThreshold,2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,1*t.gossipPromiseExpireSec,2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,o){let s=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:s,reason:i},o)},onRemoveFromMesh(n,i,o){let s=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:s,reason:i},o)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,i){let o=this.toTopic(n);this.asyncValidationResult.inc({topic:o,acceptance:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,o){let s=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:s},i),this.ihaveRcvNotSeenMsgids.inc({topic:s},o)},onIwantRcv(n,i){for(let[o,s]of n){let a=this.toTopic(o);this.iwantRcvMsgids.inc({topic:a},s)}this.iwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){let o=this.toTopic(n);this.msgForwardCount.inc({topic:o},1),this.msgForwardPeers.inc({topic:o},i)},onPublishMsg(n,i,o,s){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},o*s),this.msgPublishPeers.inc({topic:a},o),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},i.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},i.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},i.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},i.fanout)},onMsgRecvPreValidation(n){let i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){let i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onMsgRecvResult(n,i){let o=this.toTopic(n);this.msgReceivedStatus.inc({topic:o,status:i})},onMsgRecvInvalid(n,i){let o=this.toTopic(n),s=i.reason===ao.Error?i.error:i.reason;this.msgReceivedInvalid.inc({topic:o,error:s},1)},onDuplicateMsgDelivery(n,i,o){if(this.duplicateMsgDeliveryDelay.observe(i/1e3),o){let s=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:s},1)}},onPublishDuplicateMsg(n){let i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var o,s,a,c;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let u=((o=n.control.ihave)==null?void 0:o.length)??0,l=((s=n.control.iwant)==null?void 0:s.length)??0,f=((a=n.control.graft)==null?void 0:a.length)??0,h=((c=n.control.prune)==null?void 0:c.length)??0;u>0&&this.rpcSentIHave.inc(u),l>0&&this.rpcSentIWant.inc(l),f>0&&this.rpcSentGraft.inc(f),h>0&&this.rpcSentPrune.inc(h),(u>0||l>0||f>0||h>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let o=0,s=0,a=0,c=0;for(let u of n)u>=i.graylistThreshold&&o++,u>=i.publishThreshold&&s++,u>=i.gossipThreshold&&a++,u>=0&&c++;this.peersByScoreThreshold.set({threshold:O2.graylist},o),this.peersByScoreThreshold.set({threshold:O2.publish},s),this.peersByScoreThreshold.set({threshold:O2.gossip},a),this.peersByScoreThreshold.set({threshold:O2.mesh},c),this.score.set(n)},registerScoreWeights(n){for(let[i,o]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},o.p1w),this.scoreWeights.set({topic:i,p:"p2"},o.p2w),this.scoreWeights.set({topic:i,p:"p3"},o.p3w),this.scoreWeights.set({topic:i,p:"p3b"},o.p3bw),this.scoreWeights.set({topic:i,p:"p4"},o.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){let o=new Map;n.forEach((s,a)=>{let c=this.topicStrToLabel.get(a)??"unknown",u=o.get(c);u||(u=new Set,o.set(c,u)),s.forEach(l=>u==null?void 0:u.add(l))});for(let[s,a]of o){let c=[];a.forEach(u=>{c.push(i.get(u)??0)}),this.scorePerMesh.set({topic:s},c)}}}}var G9t=C(Nh(),1),wBe=C(at(),1);var EBe=C(bb(),1),vBe=C(gr(),1);var Cae=Ie("libp2p-pubsub:");async function Pae(r,e,t,n){switch(r.type){case qd.Signing:{let i={from:r.author.toBytes(),data:n,seqno:Mc(8),topic:e,signature:void 0,key:void 0},o=rt([Cae,P5.Message.encode(i).finish()]);i.signature=await r.privateKey.sign(o),i.key=r.key;let s={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${re(i.seqno,"base16")}`),topic:e,signature:i.signature,key:i.key};return{raw:i,msg:s}}case qd.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}}}}async function kae(r,e){switch(r){case k2:return e.signature!=null?{valid:!1,error:$i.SignaturePresent}:e.seqno!=null?{valid:!1,error:$i.SeqnoPresent}:e.key!=null?{valid:!1,error:$i.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Zp:{if(e.seqno==null)return{valid:!1,error:$i.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:$i.InvalidSeqno};if(e.signature==null)return{valid:!1,error:$i.InvalidSignature};if(e.from==null)return{valid:!1,error:$i.InvalidPeerId};let t;try{t=Di(e.from)}catch{return{valid:!1,error:$i.InvalidPeerId}}let n;if(e.key){if(n=Bs(e.key),t.publicKey!==void 0&&!mt(n.bytes,t.publicKey))return{valid:!1,error:$i.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:$i.InvalidPeerId};n=Bs(t.publicKey)}let i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},o=rt([Cae,P5.Message.encode(i).finish()]);return await n.verify(o,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${re(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??a3(n)}}:{valid:!1,error:$i.InvalidSignature}}}}var Nae=(r,e)=>{let t=Ie(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n};function Dae(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return Nae(r.from.toBytes(),r.sequenceNumber)}async function Oae(r){return await dt.encode(r.data)}function xBe(r,e,t,n,i){let o=0,s=new Map;if(Object.entries(e.topics).forEach(([h,d])=>{let p=i.get(h)??"unknown",g=t.topics[h];if(g===void 0)return;let w=s.get(p);w||(w={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},s.set(p,w));let _=0,x=0,m=0,y=0,b=0;if(d.inMesh){let A=Math.max(d.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);_+=A*g.timeInMeshWeight}let E=d.firstMessageDeliveries;if(E>g.firstMessageDeliveriesCap&&(E=g.firstMessageDeliveriesCap),x+=E*g.firstMessageDeliveriesWeight,d.meshMessageDeliveriesActive&&d.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){let A=g.meshMessageDeliveriesThreshold-d.meshMessageDeliveries,I=A*A;m+=I*g.meshMessageDeliveriesWeight}let v=d.meshFailurePenalty;y+=v*g.meshFailurePenaltyWeight;let S=d.invalidMessageDeliveries*d.invalidMessageDeliveries;b+=S*g.invalidMessageDeliveriesWeight,o+=(_+x+m+y+b)*g.topicWeight,w.p1w+=_,w.p2w+=x,w.p3w+=m,w.p3bw+=y,w.p4w+=b}),t.topicScoreCap>0&&o>t.topicScoreCap){o=t.topicScoreCap;let h=t.topicScoreCap/o;for(let d of s.values())d.p1w*=h,d.p2w*=h,d.p3w*=h,d.p3bw*=h,d.p4w*=h}let a=0,c=0,u=0,l=t.appSpecificScore(r);a+=l*t.appSpecificWeight,e.knownIPs.forEach(h=>{if(t.IPColocationFactorWhitelist.has(h))return;let d=n.get(h),p=d?d.size:0;if(p>t.IPColocationFactorThreshold){let g=p-t.IPColocationFactorThreshold,w=g*g;c+=w*t.IPColocationFactorWeight}});let f=e.behaviourPenalty*e.behaviourPenalty;return u+=f*t.behaviourPenaltyWeight,o+=a+c+u,{byTopic:s,p5w:a,p6w:c,p7w:u,score:o}}function Lae(r,e,t,n,i){let o={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let s of r){let a=e.get(s);if(a){let c=xBe(s,a,t,n,i);for(let[u,l]of c.byTopic){let f=o.byTopic.get(u);f||(f={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},o.byTopic.set(u,f)),f.p1w.push(l.p1w),f.p2w.push(l.p2w),f.p3w.push(l.p3w),f.p3bw.push(l.p3bw),f.p4w.push(l.p4w)}o.p5w.push(c.p5w),o.p6w.push(c.p6w),o.p7w.push(c.p7w),o.score.push(c.score)}else o.p5w.push(0),o.p6w.push(0),o.p7w.push(0),o.score.push(0)}return o}var vv=class{constructor(e){B(this,"buffer");B(this,"mask");B(this,"top");B(this,"btm");B(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},M2=class{constructor(e={}){B(this,"size");B(this,"hwm");B(this,"head");B(this,"tail");this.hwm=e.splitLimit??16,this.head=new vv(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new vv(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var rL=class extends Error{constructor(t,n){super(t??"The operation was aborted");B(this,"type");B(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function Ao(r={}){return Mae(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Bae(r={}){return Mae(t=>{let n,i=[];for(;!t.isEmpty()&&(n=t.shift(),n!=null);){if(n.error!=null)throw n.error;n.done===!1&&i.push(n.value)}return n==null?{done:!0}:{done:n.done===!0,value:i}},r)}function Mae(r,e){e=e??{};let t=e.onEnd,n=new M2,i,o,s,a=Qt(),c=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((w,_)=>{o=x=>{o=null,n.push(x);try{w(r(n))}catch(m){_(m)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Qt()})}},u=w=>o!=null?o(w):(n.push(w),i),l=w=>(n=new M2,o!=null?o({error:w}):(n.push({error:w}),i)),f=w=>{if(s)return i;if((e==null?void 0:e.objectMode)!==!0&&(w==null?void 0:w.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:w})},h=w=>s?i:(s=!0,w!=null?l(w):u({done:!0})),d=()=>(n=new M2,h(),{done:!0}),p=w=>(h(w),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:d,throw:p,push:f,end:h,get readableLength(){return n.size},onEmpty:async w=>{let _=w==null?void 0:w.signal;if(_==null||_.throwIfAborted(),n.isEmpty())return;let x,m;_!=null&&(x=new Promise((y,b)=>{m=()=>{b(new rL)},_.addEventListener("abort",m)}));try{await Promise.race([a.promise,x])}finally{m!=null&&_!=null&&(_==null||_.removeEventListener("abort",m))}}},t==null)return i;let g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(w){return g.throw(w),t!=null&&(t(w),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:f,end(w){return g.end(w),t!=null&&(t(w),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:w=>g.onEmpty(w)},i}var k5=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Uae(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function na(r,e,t){let n=t??{},i=Uae(r);async function*o(){let s,a=()=>{s!=null&&s()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:l,abortCode:f}=n;throw new k5(l,f)}let u=new Promise((l,f)=>{s=()=>{let{abortMessage:h,abortCode:d}=n;f(new k5(h,d))}});c=await Promise.race([u,i.next()]),s=null}catch(u){e.removeEventListener("abort",a);let l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof i.return=="function")try{let f=i.return();f instanceof Promise&&f.catch(h=>{n.onReturnError!=null&&n.onReturnError(h)})}catch(f){n.onReturnError!=null&&n.onReturnError(f)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return o()}function SBe(r,e,t){return n=>r(na(n,e,t))}function nL(r,e,t){return{sink:SBe(r.sink,e,{...t,onAbort:void 0}),source:na(r.source,e,t)}}var zae=Symbol.for("@achingbrain/uint8arraylist");function Fae(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function xv(r){return!!(r!=null&&r[zae])}var ln=class{constructor(...e){Object.defineProperty(this,zae,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(xv(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(xv(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=Fae(this.bufs,e);return t.buf[t.index]}set(e,t){let n=Fae(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(xv(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:i}=this._subList(e,t);return yr(n,i)}subarray(e,t){let{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:yr(n,i)}sublist(e,t){let{bufs:n,length:i}=this._subList(e,t),o=new ln;return o.length=i,o.bufs=n,o}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],i=0;for(let o=0;o<this.bufs.length;o++){let s=this.bufs[o],a=i,c=a+s.byteLength;if(i=c,e>=c)continue;let u=e>=a&&e<c,l=t>a&&t<=c;if(u&&l){if(e===a&&t===c){n.push(s);break}let f=e-a;n.push(s.subarray(f,f+(t-e)));break}if(u){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(l){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!xv(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");let o=256,s=new Int32Array(o);for(let f=0;f<o;f++)s[f]=-1;for(let f=0;f<i;f++)s[n[f]]=f;let a=s,c=this.byteLength-n.byteLength,u=n.byteLength-1,l;for(let f=t;f<=c;f+=l){l=0;for(let h=u;h>=0;h--){let d=this.get(f+h);if(n[h]!==d){l=Math.max(1,h-a[d]);break}}if(l===0)return f}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=Ac(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let i=ju(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let i=ju(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let i=ju(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=Ac(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let i=ju(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let i=ju(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let i=ju(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let i=ju(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let i=ju(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof ln)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!rr(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new ln;return n.bufs=e,t==null&&(t=e.reduce((i,o)=>i+o.byteLength,0)),n.length=t,n}};var ABe=Math.pow(2,7),TBe=Math.pow(2,14),IBe=Math.pow(2,21),RBe=Math.pow(2,28),CBe=Math.pow(2,35),PBe=Math.pow(2,42),kBe=Math.pow(2,49),NBe=Math.pow(2,56),DBe=Math.pow(2,63),nc={encodingLength(r){return r<ABe?1:r<TBe?2:r<IBe?3:r<RBe?4:r<CBe?5:r<PBe?6:r<kBe?7:r<NBe?8:r<DBe?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=Ac(nc.encodingLength(r))),Vi.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return Vi.fromBytes(r,e).toNumber(!0)}};function Vae(r){var e;return((e=globalThis==null?void 0:globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}var Sv=r=>{let e=nc.encodingLength(r),t=Vae(e);return nc.encode(r,t),Sv.bytes=e,t};Sv.bytes=0;function vn(r){r=r??{};let e=r.lengthEncoder??Sv;return async function*(n){for await(let i of n){let o=e(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}}}vn.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??Sv;return new ln(t(r.byteLength),r)};var N5=C(ee(),1),OBe=8,LBe=1024*1024*4,e0;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(e0||(e0={}));var iL=r=>{let e=nc.decode(r);return iL.bytes=nc.encodingLength(e),e};iL.bytes=0;function Xr(r){return async function*(t){let n=new ln,i=e0.LENGTH,o=-1,s=(r==null?void 0:r.lengthDecoder)??iL,a=(r==null?void 0:r.maxLengthLength)??OBe,c=(r==null?void 0:r.maxDataLength)??LBe;for await(let u of t)for(n.append(u);n.byteLength>0;){if(i===e0.LENGTH)try{if(o=s(n),o<0)throw(0,N5.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(o>c)throw(0,N5.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let l=s.bytes;n.consume(l),(r==null?void 0:r.onLength)!=null&&r.onLength(o),i=e0.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw(0,N5.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(i===e0.DATA){if(n.byteLength<o)break;let l=n.sublist(0,o);n.consume(o),(r==null?void 0:r.onData)!=null&&r.onData(l),yield l,i=e0.LENGTH}}if(n.byteLength>0)throw(0,N5.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Xr.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:o,value:s}=await r.next(t);if(o===!0)return;s!=null&&(yield s)}catch(o){if(o.code==="ERR_UNDER_READ")return{done:!0,value:null};throw o}finally{t=1}}();return Xr({...e??{},onLength:o=>{t=o}})(n)};var Av=class{constructor(e,t,n){this.rawStream=e,this.pushable=Ao({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,Ne(na(this.pushable,this.closeController.signal,{returnOnAbort:!0}),vn(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},Tv=class{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=na(Ne(this.rawStream,Xr(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};var Kae=C(QO(),1),$ae={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function qae(r,e){e={...e};let t=Kae.default.Reader.create(r),n=r.length,i=n===void 0?t.len:t.pos+n,o={};for(;t.pos<i;){let s=t.uint32();switch(s>>>3){case 1:o.subscriptions&&o.subscriptions.length||(o.subscriptions=[]),o.subscriptions.length<e.maxSubscriptions?o.subscriptions.push(BBe(t,t.uint32())):t.skipType(s&7);break;case 2:o.messages&&o.messages.length||(o.messages=[]),o.messages.length<e.maxMessages?o.messages.push(MBe(t,t.uint32())):t.skipType(s&7);break;case 3:o.control=UBe(t,t.uint32(),e);break;default:t.skipType(s&7);break}}return o}function BBe(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.subscribe=r.bool();break;case 2:n.topic=r.string();break;default:r.skipType(i&7);break}}return n}function MBe(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.from=r.bytes();break;case 2:n.data=r.bytes();break;case 3:n.seqno=r.bytes();break;case 4:n.topic=r.string();break;case 5:n.signature=r.bytes();break;case 6:n.key=r.bytes();break;default:r.skipType(i&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function UBe(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let o=r.uint32();switch(o>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.length<t.maxControlMessages?i.ihave.push(FBe(r,r.uint32(),t)):r.skipType(o&7);break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.length<t.maxControlMessages?i.iwant.push(zBe(r,r.uint32(),t)):r.skipType(o&7);break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.length<t.maxControlMessages?i.graft.push(VBe(r,r.uint32())):r.skipType(o&7);break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.length<t.maxControlMessages?i.prune.push(KBe(r,r.uint32(),t)):r.skipType(o&7);break;default:r.skipType(o&7);break}}return i}function FBe(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let o=r.uint32();switch(o>>>3){case 1:i.topicID=r.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIhaveMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(o&7);break;default:r.skipType(o&7);break}}return i}function zBe(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let o=r.uint32();switch(o>>>3){case 1:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),t.maxIwantMessageIDs-- >0?i.messageIDs.push(r.bytes()):r.skipType(o&7);break;default:r.skipType(o&7);break}}return i}function VBe(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.topicID=r.string();break;default:r.skipType(i&7);break}}return n}function KBe(r,e,t){let n=e===void 0?r.len:r.pos+e,i={};for(;r.pos<n;){let o=r.uint32();switch(o>>>3){case 1:i.topicID=r.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),t.maxPeerInfos-- >0?i.peers.push($Be(r,r.uint32())):r.skipType(o&7);break;case 3:i.backoff=r.uint64();break;default:r.skipType(o&7);break}}return i}function $Be(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let i=r.uint32();switch(i>>>3){case 1:n.peerID=r.bytes();break;case 2:n.signedPeerRecord=r.bytes();break;default:r.skipType(i&7);break}}return n}var Iv;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(Iv||(Iv={}));function Hae(r){for(let e of r.tuples())switch(e[0]){case Iv.ip4:case Iv.ip6:return Sy(e[0],e[1])}return null}var ds;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(ds||(ds={}));var Rv=class extends Ki{constructor(e,t={}){super(),this.multicodecs=[JO,ZO],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=Ao({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:ds.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{var o;let i=(o=this.metrics)==null?void 0:o.heartbeatDuration.startTimer();this.heartbeat().catch(s=>{this.log("Error running heartbeat",s)}).finally(()=>{var s;if(i!=null&&i(),this.status.code===ds.started){clearTimeout(this.status.heartbeatTimeout);let a=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;a<this.opts.heartbeatInterval*.25&&(a+=this.opts.heartbeatInterval,(s=this.metrics)==null||s.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,a)}})};let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:bae(t.scoreParams),scoreThresholds:Eae(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??$ae,this.globalSignaturePolicy=n.globalSignaturePolicy??Zp,n.fallbackToFloodsub&&this.multicodecs.push(XO),this.log=j(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(i=>i.id.toString())),this.seenCache=new D2({validityMs:n.seenTTL}),this.publishedMessageIds=new D2({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Zp:this.msgIdFn=Dae;break;case k2:this.msgIdFn=Oae;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new D2({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??yae,this.mcache=t.messageCache||new pv(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let i=Math.max(...Object.values(n.scoreParams.topics).map(s=>s.meshMessageDeliveriesWindow),1e3),o=Rae(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:i/1e3});o.mcacheSize.addCollect(()=>this.onScrapeMetrics(o));for(let s of this.multicodecs)o.protocolsEnabled.set({protocol:s},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new Ev(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new _v(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>Oe(e))}isStarted(){return this.status.code===ds.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await tL(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=Ao({objectMode:!0}),Ne(this.outboundInflightQueue,async o=>{for await(let{peerId:s,connection:a}of o)await this.createOutboundStream(s,a)}).catch(o=>this.log.error("outbound inflight queue error",o)),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.addressBook.add(o.id,o.addrs)}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(o=>e.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let t=hv({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(o=>e.register(o,t))),i=setTimeout(this.runHeartbeat,100);this.status={code:ds.started,registrarTopologyIds:n,heartbeatTimeout:i,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>await this.connect(o)))}).catch(o=>{this.log(o)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==ds.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:ds.stopped};let t=this.components.registrar;e.forEach(n=>t.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){var n;(n=this.metrics)==null||n.newConnectionCount.inc({status:t.stat.status}),!(!this.isStarted()||t.stat.status!=="OPEN")&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){var i;if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let o=new Av(await t.newStream(this.multicodecs),a=>this.log.error("outbound pipe error",a),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,o);let s=o.protocol;s===XO&&this.floodsubPeers.add(n),(i=this.metrics)==null||i.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}async createInboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let i=this.streamsInbound.get(n);i!==void 0&&(this.log("replacing existing inbound steam %s",n),i.close()),this.log("create inbound stream %s",n);let o=new Tv(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,o),this.pipePeerReadStream(e,o.source).catch(s=>this.log(s))}addPeer(e,t,n){let i=e.toString();if(!this.peers.has(i)){this.log("new peer %p",e),this.peers.add(i),this.score.addPeer(i);let o=Hae(n);o!==null?this.score.addIP(i,o):this.log("Added peer has no IP in current address %s %s",i,n.toString()),this.outbound.has(i)||this.outbound.set(i,t==="outbound")}}removePeer(e){var o,s;let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let n=this.streamsOutbound.get(t),i=this.streamsInbound.get(t);n&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:n.protocol},-1)),n==null||n.close(),i==null||i.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(let a of this.topics.values())a.delete(t);for(let[a,c]of this.mesh)c.delete(t)===!0&&((s=this.metrics)==null||s.onRemoveFromMesh(a,Jp.Dc,1));for(let a of this.fanout.values())a.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===ds.started}getMeshPeers(e){let t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(t?Array.from(t):[]).map(n=>Oe(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){var n;try{await Ne(t,async i=>{var o,s,a;for await(let c of i)try{let u=c.subarray(),l=qae(u,this.decodeRpcLimits);if((o=this.metrics)==null||o.onRpcRecv(l,u.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,l)}catch(f){(s=this.metrics)==null||s.onRpcRecvError(),this.log(f)}else this.handleReceivedRpc(e,l).catch(f=>{var h;(h=this.metrics)==null||h.onRpcRecvError(),this.log(f)})}catch(u){(a=this.metrics)==null||a.onRpcDataError(),this.log(u)}})}catch(i){(n=this.metrics)==null||n.onPeerReadStreamError(),this.handlePeerReadStreamError(i,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){var u;if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),(u=this.metrics)==null||u.rpcRecvNotAccepted.inc();return}let n=t.subscriptions?t.subscriptions.length:0,i=t.messages?t.messages.length:0,o=0,s=0,a=0,c=0;if(t.control&&(t.control.ihave&&(o=t.control.ihave.length),t.control.iwant&&(s=t.control.iwant.length),t.control.graft&&(a=t.control.graft.length),t.control.prune&&(c=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${i} ihave ${o} iwant ${s} graft ${a} prune ${c}`),t.subscriptions&&t.subscriptions.length>0){let l=[];t.subscriptions.forEach(f=>{let h=f.topic,d=f.subscribe===!0;if(h!=null){if(this.allowedTopics&&!this.allowedTopics.has(h))return;this.handleReceivedSubscription(e,h,d),l.push({topic:h,subscribe:d})}}),this.dispatchEvent(new cn("subscription-change",{detail:{peerId:e,subscriptions:l}}))}if(t.messages)for(let l of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(l.topic))continue;let f=this.handleReceivedMessage(e,l).catch(h=>{var d;(d=this.metrics)==null||d.onMsgRecvError(l.topic),this.log(h)});this.opts.awaitRpcMessageHandler&&await f}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let i=this.topics.get(t);i==null&&(i=new Set,this.topics.set(t,i)),n?i.add(e.toString()):i.delete(e.toString())}async handleReceivedMessage(e,t){var i,o,s;(i=this.metrics)==null||i.onMsgRecvPreValidation(t.topic);let n=await this.validateReceivedMessage(e,t);switch((o=this.metrics)==null||o.onMsgRecvResult(t.topic,n.code),n.code){case ra.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case ra.invalid:if(n.msgIdStr){let a=n.msgIdStr;this.score.rejectMessage(e.toString(),a,t.topic,n.reason),this.gossipTracer.rejectMessage(a,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);(s=this.metrics)==null||s.onMsgRecvInvalid(t.topic,n);return;case ra.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new cn("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new cn("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){var f,h,d;let n=(f=this.fastMsgIdFn)==null?void 0:f.call(this,t),i=n!==void 0?(h=this.fastMsgIdCache)==null?void 0:h.get(n):void 0;if(i)return{code:ra.duplicate,msgIdStr:i};let o=await kae(this.globalSignaturePolicy,t);if(!o.valid)return{code:ra.invalid,reason:ao.Error,error:o.error};let s=o.message;try{this.dataTransform&&(s.data=this.dataTransform.inboundTransform(t.topic,s.data))}catch(p){return this.log("Invalid message, transform failed",p),{code:ra.invalid,reason:ao.Error,error:$i.TransformFailed}}let a=await this.msgIdFn(s),c=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:c};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,c)&&((d=this.metrics)==null||d.fastMsgIdCacheCollision.inc()),this.seenCache.has(c))return{code:ra.duplicate,msgIdStr:c};this.seenCache.put(c);let l=this.topicValidators.get(t.topic);if(l!=null){let p;try{p=await l(e,s)}catch(g){let w=g.code;w===gae&&(p=rc.Ignore),w===mae?p=rc.Reject:p=rc.Ignore}if(p!==rc.Accept)return{code:ra.invalid,reason:eL(p),msgIdStr:c}}return{code:ra.valid,messageId:u,msg:s}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map(i=>({topic:i,subscribe:n}))})}async handleControlMessage(e,t){var c,u;if(t===void 0)return;let n=t.ihave?this.handleIHave(e,t.ihave):[],i=t.iwant?this.handleIWant(e,t.iwant):[],o=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!n.length&&!i.length&&!o.length)return;let s=this.sendRpc(e,{messages:i,control:{iwant:n,prune:o}}),a=(c=n[0])==null?void 0:c.messageIDs;a&&(s?this.gossipTracer.addPromise(e,a):(u=this.metrics)==null||u.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;let i=this.score.score(e);return i>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){var u,l,f;if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),(u=this.metrics)==null||u.ihaveRcvIgnored.inc({reason:B2.LowScore}),[];let i=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,i),(l=this.metrics)==null||l.ihaveRcvIgnored.inc({reason:B2.MaxIhave}),[];let o=this.iasked.get(e)??0;if(o>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,o),(f=this.metrics)==null||f.ihaveRcvIgnored.inc({reason:B2.MaxIasked}),[];let s=new Map;if(t.forEach(({topicID:h,messageIDs:d})=>{var g;if(!h||!d||!this.mesh.has(h))return;let p=0;d.forEach(w=>{let _=this.msgIdToStrFn(w);this.seenCache.has(_)||(s.set(_,w),p++)}),(g=this.metrics)==null||g.onIhaveRcv(h,d.length,p)}),!s.size)return[];let a=s.size;a+o>5e3&&(a=5e3-o),this.log("IHAVE: Asking for %d out of %d messages from %s",a,s.size,e);let c=Array.from(s.values());return hu(c),c=c.slice(0,a),this.iasked.set(e,o+a),[{messageIDs:c}]}handleIWant(e,t){var a;if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let i=new Map,o=new Map,s=0;return t.forEach(({messageIDs:c})=>{c&&c.forEach(u=>{let l=this.msgIdToStrFn(u),f=this.mcache.getWithIWantCount(l,e);if(f==null){s++;return}if(o.set(f.msg.topic,1+(o.get(f.msg.topic)??0)),f.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,u);return}i.set(l,f.msg)})}),(a=this.metrics)==null||a.onIwantRcv(o,s),i.size?(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){let n=[],i=this.score.score(e),o=Date.now(),s=this.opts.doPX;return t.forEach(({topicID:a})=>{var l,f;if(!a)return;let c=this.mesh.get(a);if(!c){s=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),s=!1;return}let u=(l=this.backoff.get(a))==null?void 0:l.get(e);if(typeof u=="number"&&o<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,L2.GraftBackoff),s=!1;let h=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<h&&this.score.addPenalty(e,1,L2.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(i<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,i,a),n.push(a),s=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),(f=this.metrics)==null||f.onAddToMesh(a,Tl.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,s))):[]}async handlePrune(e,t){var i;let n=this.score.score(e);for(let{topicID:o,backoff:s,peers:a}of t){if(o==null)continue;let c=this.mesh.get(o);if(!c)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,o),this.score.prune(e,o),c.has(e)&&(c.delete(e),(i=this.metrics)==null||i.onRemoveFromMesh(o,Jp.Unsub,1)),typeof s=="number"&&s>0?this.doAddBackoff(e,o,s*1e3):this.addBackoff(e,o),a&&a.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,o);continue}await this.pxConnect(a)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let i=this.backoff.get(t);i||(i=new Map,this.backoff.set(t,i));let o=Date.now()+n;(i.get(e)??0)<o&&i.set(e,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,L2.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((t,n)=>{t.forEach((i,o)=>{i<e&&t.delete(o)}),t.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async t=>await this.connect(t)))}async pxConnect(e){e.length>this.opts.prunePeers&&(hu(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let i=Di(n.peerID).toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){t.push(i);return}try{let o=await zd.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),s=o.peerId;if(!o.peerId.equals(i)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",s,i);return}if(!await this.components.peerStore.addressBook.consumePeerRecord(o)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}t.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),t.length&&await Promise.all(t.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let t=Oe(e),n=await this.components.connectionManager.openConnection(t);for(let i of this.multicodecs)for(let o of this.components.registrar.getTopologies(i))o.onConnect(t,n)}subscribe(e){if(this.status.code!==ds.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==ds.started)throw new Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){var i,o,s;if(this.status.code!==ds.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),(i=this.metrics)==null||i.onJoin(e);let t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(a=>{!this.direct.has(a)&&this.score.score(a)>=0&&t.add(a)}),(o=this.metrics)==null||o.onAddToMesh(e,Tl.Fanout,t.size)),t.size<this.opts.D){let a=t.size;this.getRandomGossipPeers(e,this.opts.D,u=>!t.has(u)&&!this.direct.has(u)&&this.score.score(u)>=0).forEach(u=>{t.add(u)}),(s=this.metrics)==null||s.onAddToMesh(e,Tl.Random,t.size-a)}this.mesh.set(e,t),t.forEach(a=>{this.log("JOIN: Add mesh link to %s in %s",a,e),this.sendGraft(a,e)})}leave(e){var n;if(this.status.code!==ds.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),(n=this.metrics)==null||n.onLeave(e);let t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map(async i=>(this.log("LEAVE: Remove mesh link to %s in %s",i,e),await this.sendPrune(i,e)))).catch(i=>{this.log("Error sending prunes to mesh peers",i)}),this.mesh.delete(e))}selectPeersToForward(e,t,n){let i=new Set,o=this.topics.get(e);o&&(this.direct.forEach(a=>{o.has(a)&&t!==a&&!(n!=null&&n.has(a))&&i.add(a)}),this.floodsubPeers.forEach(a=>{o.has(a)&&t!==a&&!(n!=null&&n.has(a))&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&i.add(a)}));let s=this.mesh.get(e);return s&&s.size>0&&s.forEach(a=>{t!==a&&!(n!=null&&n.has(a))&&i.add(a)}),i}selectPeersToPublish(e){let t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(e);if(i)if(this.opts.floodPublish)i.forEach(o=>{this.direct.has(o)?(t.add(o),n.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(t.add(o),n.floodsub++)});else{this.direct.forEach(s=>{i.has(s)&&(t.add(s),n.direct++)}),this.floodsubPeers.forEach(s=>{i.has(s)&&this.score.score(s)>=this.opts.scoreThresholds.publishThreshold&&(t.add(s),n.floodsub++)});let o=this.mesh.get(e);if(o&&o.size>0)o.forEach(s=>{t.add(s),n.mesh++});else{let s=this.fanout.get(e);if(s&&s.size>0)s.forEach(a=>{t.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{t.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,i){var s;n&&this.score.deliverMessage(n,e,t.topic);let o=this.selectPeersToForward(t.topic,n,i);o.forEach(a=>{this.sendRpc(a,{messages:[t]})}),(s=this.metrics)==null||s.onForwardMsg(t.topic,o.size)}async publish(e,t,n){var p,g;let i=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:o,msg:s}=await Pae(this.publishConfig,e,t,i),a=await this.msgIdFn(s),c=this.msgIdToStrFn(a),u=(n==null?void 0:n.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return(p=this.metrics)==null||p.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:l,tosendCount:f}=this.selectPeersToPublish(e),h=this.opts.emitSelf===!0&&this.subscriptions.has(e),d=(n==null?void 0:n.allowPublishToZeroPeers)??this.opts.allowPublishToZeroPeers;if(l.size===0&&!d&&!h)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},o,!0),this.publishedMessageIds.put(c);for(let w of l)this.sendRpc(w,{messages:[o]})||l.delete(w);return(g=this.metrics)==null||g.onPublishMsg(e,f,l.size,o.data!=null?o.data.length:0),h&&(l.add(this.components.peerId.toString()),super.dispatchEvent(new cn("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:s}})),super.dispatchEvent(new cn("message",{detail:s}))),{recipients:Array.from(l.values()).map(w=>Oe(w))}}reportMessageValidationResult(e,t,n){var i,o,s,a;if(n===rc.Accept){let c=this.mcache.validate(e);if((i=this.metrics)==null||i.onReportValidationMcacheHit(c!==null),c!=null){let{message:u,originatingPeers:l}=c;this.score.deliverMessage(t.toString(),e,u.topic),this.forwardMessage(e,c.message,t.toString(),l),(o=this.metrics)==null||o.onReportValidation(u.topic,n)}}else{let c=this.mcache.remove(e);if((s=this.metrics)==null||s.onReportValidationMcacheHit(c!==null),c){let u=eL(n),{message:l,originatingPeers:f}=c;this.score.rejectMessage(t.toString(),e,l.topic,u);for(let h of f)this.score.rejectMessage(h,e,l.topic,u);(a=this.metrics)==null||a.onReportValidation(l.topic,n)}}}sendGraft(e,t){let n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){let n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){var a;let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let i=this.control.get(e);i&&(this.piggybackControl(e,t,i),this.control.delete(e));let o=this.gossip.get(e);o&&(this.piggybackGossip(e,t,o),this.gossip.delete(e));let s=P5.encode(t).finish();try{n.push(s)}catch(c){return this.log.error(`Cannot send rpc to ${e}`,c),i&&this.control.set(e,i),o&&this.gossip.set(e,o),!1}return(a=this.metrics)==null||a.onRpcSent(t,s.length),!0}piggybackControl(e,t,n){var i,o;if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(let s of n.graft)s.topicID&&((i=this.mesh.get(s.topicID))!=null&&i.has(e))&&t.control.graft.push(s)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(let s of n.prune)s.topicID&&!((o=this.mesh.get(s.topicID))!=null&&o.has(e))&&t.control.prune.push(s)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){let i=this.opts.doPX;for(let[o,s]of e){let a=s.map(l=>({topicID:l})),c=[],u=t.get(o);u&&(c=await Promise.all(u.map(async l=>await this.makePrune(o,l,i&&!(n.get(o)??!1)))),t.delete(o)),this.sendRpc(o,{control:{graft:a,prune:c}})}for(let[o,s]of t){let a=await Promise.all(s.map(async c=>await this.makePrune(o,c,i&&!(n.get(o)??!1))));this.sendRpc(o,{control:{prune:a}})}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,i]of e)this.doEmitGossip(n,i,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length||(hu(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size))return;let i=this.opts.Dlazy,o=.25*t.size,s=t;o>i&&(i=o),i>s.size?i=s.size:s=hu(Array.from(s)).slice(0,i),s.forEach(a=>{let c=n;n.length>5e3&&(c=hu(c.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(let[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===ZO)return{topicID:t,peers:[]};let i=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:i};let o=this.getRandomGossipPeers(t,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),s=await Promise.all(Array.from(o).map(async a=>{let c=Oe(a);return{peerID:c.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(c)}}));return{topicID:t,peers:s,backoff:i}}async heartbeat(){var p,g;let{D:e,Dlo:t,Dhi:n,Dscore:i,Dout:o,fanoutTTL:s}=this.opts;this.heartbeatTicks++;let a=new Map,c=w=>{let _=a.get(w);return _===void 0&&(_=this.score.score(w),a.set(w,_)),_},u=new Map,l=new Map,f=new Map;this.clearBackoff(),this.peerhave.clear(),(p=this.metrics)==null||p.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(g=this.fastMsgIdCache)==null||g.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let h=new Map;this.mesh.forEach((w,_)=>{let x=this.topics.get(_),m=new Set,y=new Set;if(h.set(_,y),x){let v=hu(Array.from(x)),S=this.backoff.get(_);for(let A of v){let I=this.streamsOutbound.get(A);if(I&&this.multicodecs.includes(I.protocol)&&!w.has(A)&&!this.direct.has(A)){let k=c(A);(!S||!S.has(A))&&k>=0&&m.add(A),k>=this.opts.scoreThresholds.gossipThreshold&&y.add(A)}}}let b=(v,S)=>{var I;this.log("HEARTBEAT: Remove mesh link to %s in %s",v,_),this.addBackoff(v,_),w.delete(v),c(v)>=this.opts.scoreThresholds.gossipThreshold&&y.add(v),(I=this.metrics)==null||I.onRemoveFromMesh(_,S,1);let A=l.get(v);A?A.push(_):l.set(v,[_])},E=(v,S)=>{var I;this.log("HEARTBEAT: Add mesh link to %s in %s",v,_),this.score.graft(v,_),w.add(v),y.delete(v),(I=this.metrics)==null||I.onAddToMesh(_,S,1);let A=u.get(v);A?A.push(_):u.set(v,[_])};if(w.forEach(v=>{let S=c(v);S<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",v,S,_),b(v,Jp.BadScore),f.set(v,!0))}),w.size<t){let v=e-w.size;Tae(m,v).forEach(A=>{E(A,Tl.NotEnough)})}if(w.size>n){let v=Array.from(w);v.sort((A,I)=>c(I)-c(A)),v=v.slice(0,i).concat(hu(v.slice(i)));let S=0;if(v.slice(0,e).forEach(A=>{this.outbound.get(A)&&S++}),S<o){let A=k=>{let N=v[k];for(let O=k;O>0;O--)v[O]=v[O-1];v[0]=N};if(S>0){let k=S;for(let N=1;N<e&&k>0;N++)this.outbound.get(v[N])&&(A(N),k--)}let I=e-S;for(let k=e;k<v.length&&I>0;k++)this.outbound.get(v[k])&&(A(k),I--)}v.slice(e).forEach(A=>{b(A,Jp.Excess)})}if(w.size>=t){let v=0;if(w.forEach(S=>{this.outbound.get(S)&&v++}),v<o){let S=o-v;bv(m,S,I=>this.outbound.get(I)===!0).forEach(I=>{E(I,Tl.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&w.size>1){let v=Array.from(w).sort((I,k)=>c(I)-c(k)),S=Math.floor(w.size/2),A=c(v[S]);if(A<this.opts.scoreThresholds.opportunisticGraftThreshold){let I=this.opts.opportunisticGraftPeers,k=bv(m,I,N=>c(N)>A);for(let N of k)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",N,_),E(N,Tl.Opportunistic)}}});let d=Date.now();this.fanoutLastpub.forEach((w,_)=>{w+s<d&&(this.fanout.delete(_),this.fanoutLastpub.delete(_))}),this.fanout.forEach((w,_)=>{let x=this.topics.get(_);w.forEach(E=>{(!x.has(E)||c(E)<this.opts.scoreThresholds.publishThreshold)&&w.delete(E)});let m=this.topics.get(_),y=[],b=new Set;if(h.set(_,b),m){let E=hu(Array.from(m));for(let v of E){let S=this.streamsOutbound.get(v);if(S&&this.multicodecs.includes(S.protocol)&&!w.has(v)&&!this.direct.has(v)){let A=c(v);A>=this.opts.scoreThresholds.publishThreshold&&y.push(v),A>=this.opts.scoreThresholds.gossipThreshold&&b.add(v)}}}if(w.size<e){let E=e-w.size;y.slice(0,E).forEach(v=>{w.add(v),b==null||b.delete(v)})}}),this.emitGossip(h),await this.sendGraftPrune(u,l,f),this.flush(),this.mcache.shift(),this.dispatchEvent(new cn("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=()=>!0){let i=this.topics.get(e);if(!i)return new Set;let o=[];return i.forEach(s=>{let a=this.streamsOutbound.get(s);a&&this.multicodecs.includes(a.protocol)&&n(s)&&o.push(s)}),o=hu(o),t>0&&o.length>t&&(o=o.slice(0,t)),new Set(o)}onScrapeMetrics(e){var s,a;e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},((s=this.fastMsgIdCache)==null?void 0:s.size)??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(let c of this.backoff.values())t+=c.size;e.cacheSize.set({cache:"backoff"},t);for(let[c,u]of this.topics)e.topicPeersCount.set({topicStr:c},u.size);for(let[c,u]of this.mesh)e.meshPeerCounts.set({topicStr:c},u.size);let n=[],i=new Map;e.behaviourPenalty.reset();for(let c of this.peers.keys()){let u=this.score.score(c);n.push(u),i.set(c,u),e.behaviourPenalty.observe(((a=this.score.peerStats.get(c))==null?void 0:a.behaviourPenalty)??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let o=Lae(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(o)}};Rv.multicodec=JO;function jae(r={}){return e=>new Rv(e,r)}var Wae=()=>({gossipsub:jae({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})});var hs=C(xA(),1);hs.default.formatters.b=r=>r==null?"undefined":Qi.baseEncode(r);hs.default.formatters.t=r=>r==null?"undefined":_f.baseEncode(r);hs.default.formatters.m=r=>r==null?"undefined":lI.baseEncode(r);hs.default.formatters.p=r=>r==null?"undefined":r.toString();hs.default.formatters.c=r=>r==null?"undefined":r.toString();hs.default.formatters.k=r=>r==null?"undefined":r.toString();hs.default.formatters.a=r=>r==null?"undefined":r.toString();function yMe(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Cv(r){let e=yMe(`${r}:trace`);return hs.default.enabled(`${r}:trace`)&&hs.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,hs.default)(`${r}:trace`)),Object.assign((0,hs.default)(r),{error:(0,hs.default)(`${r}:error`),trace:e})}var Yae=Symbol.for("@libp2p/peer-id");var wMe=Symbol.for("nodejs.util.inspect.custom"),Qae=Object.values(S1).map(r=>r.decoder).reduce((r,e)=>r.or(e),S1.identity.decoder),Xae=114,Zae=36,Jae=37,EMe,D5=class{constructor(e){B(this,"type");B(this,"multihash");B(this,"privateKey");B(this,"publicKey");B(this,"string");B(this,EMe,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Qi.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Nr.createV1(Xae,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return mt(this.multihash.bytes,e);if(typeof e=="string")return bMe(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return mt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(EMe=Yae,wMe)](){return`PeerId(${this.toString()})`}},O5=class extends D5{constructor(t){super({...t,type:"RSA"});B(this,"type","RSA");B(this,"publicKey");this.publicKey=t.publicKey}},L5=class extends D5{constructor(t){super({...t,type:"Ed25519"});B(this,"type","Ed25519");B(this,"publicKey");this.publicKey=t.multihash.digest}},B5=class extends D5{constructor(t){super({...t,type:"secp256k1"});B(this,"type","secp256k1");B(this,"publicKey");this.publicKey=t.multihash.digest}};function bMe(r,e){if(e=e??Qae,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=_y(Qi.decode(`z${r}`));return r.startsWith("12D")?new L5({multihash:t}):r.startsWith("16U")?new B5({multihash:t}):new O5({multihash:t})}return oL(Qae.decode(r))}function oL(r){try{let e=_y(r);if(e.code===A8.code){if(e.digest.length===Zae)return new L5({multihash:e});if(e.digest.length===Jae)return new B5({multihash:e})}if(e.code===T8.code)return new O5({multihash:e})}catch{return _Me(Nr.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function _Me(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==Xae)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===T8.code)return new O5({multihash:r.multihash});if(e.code===A8.code){if(e.digest.length===Zae)return new L5({multihash:r.multihash});if(e.digest.length===Jae)return new B5({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}function ia(r){let e=new globalThis.AbortController;function t(){e.abort();for(let o of r)(o==null?void 0:o.removeEventListener)!=null&&o.removeEventListener("abort",t)}for(let o of r){if((o==null?void 0:o.aborted)===!0){t();break}(o==null?void 0:o.addEventListener)!=null&&o.addEventListener("abort",t)}function n(){for(let o of r)(o==null?void 0:o.removeEventListener)!=null&&o.removeEventListener("abort",t)}let i=e.signal;return i.clear=n,i}var r0=Cv("libp2p:delegated-peer-routing"),ece=3e4,vMe=4,tce;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(tce||(tce={}));var rce;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(rce||(rce={}));var sL=class{constructor(e){B(this,"client");B(this,"httpQueue");B(this,"started");B(this,"abortController");if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new qn({concurrency:vMe});let{protocol:t,host:n,port:i}=e.getEndpointConfig();r0(`enabled DelegatedPeerRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){r0("findPeer starts: %p",e),t.timeout=t.timeout??ece;let n=ia([this.abortController.signal,t.signal]),i=Qt(),o=Qt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;for await(let s of this.client.dht.findPeer(e,{...t,signal:n}))if(s.name==="FINAL_PEER"&&s.peer.multiaddrs.length>0)return{id:s.peer.id,multiaddrs:s.peer.multiaddrs,protocols:[]};throw new J("Not found","ERR_NOT_FOUND")}catch(s){throw r0.error("findPeer errored: %o",s),s}finally{n.clear(),o.resolve(),r0("findPeer finished: %p",e)}}async*getClosestPeers(e,t={}){let n,i=Nr.asCID(e);i!=null?n=i:n=oL(e),r0("getClosestPeers starts: %s",n),t.timeout=t.timeout??ece;let o=ia([this.abortController.signal,t.signal]),s=Qt(),a=Qt();this.httpQueue.add(async()=>(s.resolve(),a.promise));try{await s.promise;for await(let c of this.client.dht.query(n,{...t,signal:o}))c.name==="PEER_RESPONSE"&&(yield*c.closer.map(u=>({id:u.id,multiaddrs:u.multiaddrs,protocols:[]})))}catch(c){throw r0.error("getClosestPeers errored:",c),c}finally{o.clear(),a.resolve(),r0("getClosestPeers finished: %b",e)}}};function nce(r){return()=>new sL(r)}var sce=C(ee(),1);function xMe(r){return r[Symbol.asyncIterator]!=null}function SMe(r){if(xMe(r))return(async()=>{for await(let e of r);})();for(let e of r);}var aL=SMe;var To=Cv("libp2p:delegated-content-routing"),Pv=3e4,AMe=4,TMe=2,ice;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(ice||(ice={}));var oce;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(oce||(oce={}));var cL=class{constructor(e){B(this,"client");B(this,"httpQueue");B(this,"httpQueueRefs");B(this,"started");B(this,"abortController");if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new qn({concurrency:AMe}),this.httpQueueRefs=new qn({concurrency:TMe});let{protocol:t,host:n,port:i}=e.getEndpointConfig();To(`enabled DelegatedContentRouting via ${t}://${n}:${i}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){To("findProviders starts: %c",e),t.timeout=t.timeout??Pv;let n=ia([this.abortController.signal,t.signal]),i=Qt(),o=Qt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;for await(let s of this.client.dht.findProvs(e,{...t,signal:n}))s.name==="PROVIDER"&&(yield*s.providers.map(a=>({id:a.id,protocols:[],multiaddrs:a.multiaddrs})))}catch(s){throw To.error("findProviders errored:",s),s}finally{n.clear(),o.resolve(),To("findProviders finished: %c",e)}}async provide(e,t={}){To("provide starts: %c",e),t.timeout=t.timeout??Pv;let n=ia([this.abortController.signal,t.signal]),i=Qt(),o=Qt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise,await this.client.block.stat(e,{...t,signal:n}),await aL(this.client.dht.provide(e,{...t,signal:n}))}catch(s){throw To.error("provide errored:",s),s}finally{n.clear(),o.resolve(),To("provide finished: %c",e)}}async put(e,t,n={}){To("put value start: %b",e),n.timeout=n.timeout??Pv;let i=ia([this.abortController.signal,n.signal]),o=Qt(),s=Qt();this.httpQueue.add(async()=>(o.resolve(),s.promise));try{await o.promise,await aL(this.client.dht.put(e,t,{...n,signal:i}))}catch(a){throw To.error("put errored:",a),a}finally{i.clear(),s.resolve(),To("put finished: %b",e)}}async get(e,t={}){To("get value start: %b",e),t.timeout=t.timeout??Pv;let n=ia([this.abortController.signal,t.signal]),i=Qt(),o=Qt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;for await(let s of this.client.dht.get(e,{...t,signal:n}))if(s.name==="VALUE")return To("get value finished: %b",e),s.value;throw(0,sce.default)(new Error("Not found"),"ERR_NOT_FOUND")}catch(s){throw To.error("put errored:",s),s}finally{n.clear(),o.resolve(),To("put finished: %b",e)}}};function ace(r){return()=>new cL(r)}var IMe=r=>Promise.reject(new Error(`No base found for "${r}"`)),F2=class{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||IMe;for(let t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];let t=await this._loadBase(e);return this._basesByName[t.name]==null&&this._basesByPrefix[t.prefix]==null&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}};var RMe=r=>Promise.reject(new Error(`No codec found for "${r}"`)),z2=class{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||RMe;for(let t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){let t=typeof e=="string"?this._codecsByName:this._codecsByCode;if(t[e])return t[e];let n=await this._loadCodec(e);return t[e]==null&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}};var CMe=r=>Promise.reject(new Error(`No hasher found for "${r}"`)),V2=class{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||CMe;for(let t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){let t=typeof e=="string"?this._hashersByName:this._hashersByCode;if(t[e])return t[e];let n=await this._loadHasher(e);return t[e]==null&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}};var pu=C(C6(),1);var n0=C(O1(),1);function uL(r){try{r=zm(yt(r))}catch{}return r=r.toString(),r}var cce=()=>{};var uce=j("ipfs-http-client:lib:error-handler"),PMe=et.bind({ignoreUndefined:!0}),kMe=pu.isBrowser||pu.isWebWorker?location.protocol:"http",NMe=pu.isBrowser||pu.isWebWorker?location.hostname:"localhost",DMe=pu.isBrowser||pu.isWebWorker?location.port:"5001",OMe=(r={})=>{let e,t={},n;if(typeof r=="string"||F_(r))e=new URL(uL(r));else if(r instanceof URL)e=r;else if(typeof r.url=="string"||F_(r.url))e=new URL(uL(r.url)),t=r;else if(r.url instanceof URL)e=r.url,t=r;else{t=r||{};let i=(t.protocol||kMe).replace(":",""),o=(t.host||NMe).split(":")[0],s=t.port||DMe;e=new URL(`${i}://${o}:${s}`)}if(t.apiPath?e.pathname=t.apiPath:(e.pathname==="/"||e.pathname===void 0)&&(e.pathname="api/v0"),pu.isNode){let i=cce(e);n=t.agent||new i({keepAlive:!0,maxSockets:6})}return{...t,host:e.host,protocol:e.protocol.replace(":",""),port:Number(e.port),apiPath:e.pathname,url:e,agent:n}},LMe=async r=>{let e;try{if((r.headers.get("Content-Type")||"").startsWith("application/json")){let n=await r.json();uce(n),e=n.Message||n.message}else e=await r.text()}catch(n){uce("Failed to parse error response",n),e=n.message}let t=new n0.default.HTTPError(r);throw e&&(e.includes("deadline has elapsed")&&(t=new n0.default.TimeoutError),e&&e.includes("context deadline exceeded")&&(t=new n0.default.TimeoutError)),e&&e.includes("request timed out")&&(t=new n0.default.TimeoutError),e&&(t.message=e),t},BMe=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,lce=r=>r.replace(BMe,function(e){return"-"+e.toLowerCase()}),MMe=r=>typeof r=="string"?Cf(r):r,Hd=class extends n0.default{constructor(e={}){let t=OMe(e);super({timeout:MMe(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:LMe,transformSearchParams:i=>{let o=new URLSearchParams;for(let[s,a]of i)a!=="undefined"&&a!=="null"&&s!=="signal"&&o.append(lce(s),a),s==="timeout"&&!isNaN(a)&&o.append(lce(s),a);return o},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;let n=this.fetch;this.fetch=(i,o={})=>(typeof i=="string"&&!i.startsWith("/")&&(i=`${t.url}/${i}`),n.call(this,i,PMe(o,{method:"POST"})))}},UAt=n0.default.HTTPError;var D=r=>e=>r(new Hd(e),e);function kv(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}var fce=C(ee(),1);function Nv(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){let t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw(0,fce.default)(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}function M({arg:r,searchParams:e,hashAlg:t,mtime:n,mode:i,...o}={}){e&&(o={...o,...e}),t&&(o.hash=t),n!=null&&(n=Nv(n),o.mtime=n.secs,o.mtimeNsecs=n.nsecs),i!=null&&(o.mode=kv(i)),o.timeout&&!isNaN(o.timeout)&&(o.timeout=`${o.timeout}ms`),r==null?r=[]:Array.isArray(r)||(r=[r]);let s=new URLSearchParams(o);return r.forEach(a=>s.append("arg",a)),s}var dce=D(r=>{async function e(t={}){return((await(await r.post("bitswap/wantlist",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).Keys||[]).map(i=>z.parse(i["/"]))}return e});var hce=D(r=>{async function e(t,n={}){return((await(await r.post("bitswap/wantlist",{signal:n.signal,searchParams:M({...n,peer:t.toString()}),headers:n.headers})).json()).Keys||[]).map(o=>z.parse(o["/"]))}return e});var Dv=D(r=>{async function e(t={}){let n=await r.post("bitswap/stat",{searchParams:M(t),signal:t.signal,headers:t.headers});return UMe(await n.json())}return e});function UMe(r){return{provideBufLen:r.ProvideBufLen,wantlist:(r.Wantlist||[]).map(e=>z.parse(e["/"])),peers:(r.Peers||[]).map(e=>Oe(e)),blocksReceived:BigInt(r.BlocksReceived),dataReceived:BigInt(r.DataReceived),blocksSent:BigInt(r.BlocksSent),dataSent:BigInt(r.DataSent),dupBlksReceived:BigInt(r.DupBlksReceived),dupDataReceived:BigInt(r.DupDataReceived)}}var pce=D(r=>{async function e(t,n={}){return(await r.post("bitswap/unwant",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers})).json()}return e});function mce(r){return{wantlist:dce(r),wantlistForPeer:hce(r),unwant:pce(r),stat:Dv(r)}}var Ov=D(r=>{async function e(t,n={}){let i=await r.post("block/get",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await i.arrayBuffer())}return e});var yce=C(ee(),1);async function wce(r){if(qs(r))return new Blob([r]);if(typeof r=="string"||r instanceof String)return new Blob([r.toString()]);if(ul(r))return r;if(ll(r)&&(r=yo(r)),Symbol.iterator in r||Symbol.asyncIterator in r){let e=ja(r),{value:t,done:n}=await e.peek();if(n)return gce(e);if(e.push(t),Number.isInteger(t))return new Blob([Uint8Array.from(await tp(e))]);if(qs(t)||typeof t=="string"||t instanceof String)return gce(e)}throw(0,yce.default)(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}async function gce(r){let e=[];for await(let t of r)e.push(t);return new Blob(e)}function bce(r){return eE(r,wce,!0)}function _ce(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}async function Dn(r,e,t={}){let n=[],i=new FormData,o=0,s=0;for await(let{content:a,path:c,mode:u,mtime:l}of bce(r)){let f="",h=a?"file":"dir";o>0&&(f=`-${o}`);let d=h+f,p=[];if(u!=null&&p.push(`mode=${_ce(u)}`),l!=null){let{secs:g,nsecs:w}=l;p.push(`mtime=${g}`),w!=null&&p.push(`mtime-nsecs=${w}`)}if(p.length&&(d=`${d}?${p.join("&")}`),a){i.set(d,a,c!=null?encodeURIComponent(c):void 0);let g=s+a.size;n.push({name:c,start:s,end:g}),s=g}else if(c!=null)i.set(d,new File([""],encodeURIComponent(c),{type:"application/x-directory"}));else throw new Error("path or content or both must be set");o++}return{total:s,parts:n,headers:t,body:i}}var Ece=C(Da(),1);function FMe(r){return r.filter(Boolean)}function On(...r){return(0,Ece.anySignal)(FMe(r))}var vce=D(r=>{async function e(t,n={}){let i=new AbortController,o=On(i.signal,n.signal),s;try{s=await(await r.post("block/put",{signal:o,searchParams:M(n),...await Dn([t],i,n.headers)})).json()}catch(a){if(n.format==="dag-pb")return e(t,{...n,format:"protobuf"});if(n.format==="dag-cbor")return e(t,{...n,format:"cbor"});throw a}return z.parse(s.Key)}return e});var xce=D(r=>{async function*e(t,n={}){Array.isArray(t)||(t=[t]);let i=await r.post("block/rm",{signal:n.signal,searchParams:M({arg:t.map(o=>o.toString()),"stream-channels":!0,...n}),headers:n.headers});for await(let o of i.ndjson())yield zMe(o)}return e});function zMe(r){let e={cid:z.parse(r.Hash)};return r.Error&&(e.error=new Error(r.Error)),e}var Sce=D(r=>{async function e(t,n={}){let o=await(await r.post("block/stat",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers})).json();return{cid:z.parse(o.Key),size:o.Size}}return e});function Ace(r){return{get:Ov(r),put:vce(r),rm:xce(r),stat:Sce(r)}}var Tce=D(r=>{async function e(t,n={}){let i=await r.post("bootstrap/add",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),{Peers:o}=await i.json();return{Peers:o.map(s=>yt(s))}}return e});var Ice=D(r=>{async function e(t={}){let n=await r.post("bootstrap/rm",{signal:t.signal,searchParams:M({...t,all:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(o=>yt(o))}}return e});var Rce=D(r=>{async function e(t={}){let n=await r.post("bootstrap/list",{signal:t.signal,searchParams:M(t),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(o=>yt(o))}}return e});var Cce=D(r=>{async function e(t={}){let n=await r.post("bootstrap/add",{signal:t.signal,searchParams:M({...t,default:!0}),headers:t.headers}),{Peers:i}=await n.json();return{Peers:i.map(o=>yt(o))}}return e});var Pce=D(r=>{async function e(t,n={}){let i=await r.post("bootstrap/rm",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),{Peers:o}=await i.json();return{Peers:o.map(s=>yt(s))}}return e});function kce(r){return{add:Tce(r),clear:Ice(r),list:Rce(r),reset:Cce(r),rm:Pce(r)}}var Nce=D(r=>{async function e(t,n={}){let o=await(await r.post("config/profile/apply",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json();return{original:o.OldCfg,updated:o.NewCfg}}return e});function kt(r){if(r==null)return r;let e=/^[A-Z]+$/,t={};return Object.keys(r).reduce((n,i)=>(e.test(i)?n[i.toLowerCase()]=r[i]:e.test(i[0])?n[i[0].toLowerCase()+i.slice(1)]=r[i]:n[i]=r[i],n),t)}var Dce=D(r=>{async function e(t={}){return(await(await r.post("config/profile/list",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).map(o=>kt(o))}return e});function Oce(r){return{apply:Nce(r),list:Dce(r)}}var Lce=D(r=>async(t,n={})=>{if(!t)throw new Error("key argument is required");return(await(await r.post("config",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json()).Value});var Bce=D(r=>async(t={})=>await(await r.post("config/show",{signal:t.signal,searchParams:M({...t}),headers:t.headers})).json());var Mce=D(r=>async(t,n={})=>{let i=new AbortController,o=On(i.signal,n.signal);await(await r.post("config/replace",{signal:o,searchParams:M(n),...await Dn([Ie(JSON.stringify(t))],i,n.headers)})).text()});var Uce=D(r=>async(t,n,i={})=>{if(typeof t!="string")throw new Error("Invalid key type");let o={...i,...VMe(t,n)};await(await r.post("config",{signal:i.signal,searchParams:M(o),headers:i.headers})).text()}),VMe=(r,e)=>{switch(typeof e){case"boolean":return{arg:[r,e.toString()],bool:!0};case"string":return{arg:[r,e]};default:return{arg:[r,JSON.stringify(e)],json:!0}}};function Fce(r){return{getAll:Bce(r),get:Lce(r),set:Uce(r),replace:Mce(r),profiles:Oce(r)}}var zce=D(r=>{async function*e(t,n={}){yield*(await r.post("dag/export",{signal:n.signal,searchParams:M({arg:t.toString()}),headers:n.headers})).iterator()}return e});var lL=C(ee(),1);async function*fL(r,e,t,n,i){let o=async u=>{let l=await t.getCodec(u.code),f=await n(u,i);return l.decode(f)},s=e.split("/").filter(Boolean),a=await o(r),c=r;for(;s.length;){let u=s.shift();if(!u)throw(0,lL.default)(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:s.join("/")};else throw(0,lL.default)(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");let l=z.asCID(a);l&&(c=l,a=await o(a))}yield{value:a,remainderPath:""}}var Vce=C(ee(),1);var Kce=(r,e)=>D((n,i)=>{let o=Ov(i);return async(a,c={})=>{if(c.path){let d=c.localResolve?await mp(fL(a,c.path,r,o,c)):await Dr(fL(a,c.path,r,o,c));if(!d)throw(0,Vce.default)(new Error("Not found"),"ERR_NOT_FOUND");return d}let u=await r.getCodec(a.code),l=await o(a,c);return{value:u.decode(l),remainderPath:""}}})(e);var $ce=D(r=>{async function*e(t,n={}){let i=new AbortController,o=On(i.signal,n.signal),{headers:s,body:a}=await Dn(t,i,n.headers),c=await r.post("dag/import",{signal:o,headers:s,body:a,searchParams:M({"pin-roots":n.pinRoots})});for await(let{Root:u}of c.ndjson())if(u!==void 0){let{Cid:{"/":l},PinErrorMsg:f}=u;yield{root:{cid:z.parse(l),pinErrorMsg:f}}}}return e});var Lv=(r,e)=>D(n=>async(o,s={})=>{let a={storeCodec:"dag-cbor",hashAlg:"sha2-256",...s},c;if(a.inputCodec){if(!(o instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");c=o}else c=(await r.getCodec(a.storeCodec)).encode(o),a.inputCodec=a.storeCodec;let u=new AbortController,l=On(u.signal,a.signal),h=await(await n.post("dag/put",{timeout:a.timeout,signal:l,searchParams:M(a),...await Dn([c],u,a.headers)})).json();return z.parse(h.Cid["/"])})(e);var qce=D(r=>async(t,n={})=>{let o=await(await r.post("dag/resolve",{signal:n.signal,searchParams:M({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers})).json();return{cid:z.parse(o.Cid["/"]),remainderPath:o.RemPath}});function Hce(r,e){return{export:zce(e),get:Kce(r,e),import:$ce(e),put:Lv(r,e),resolve:qce(e)}}var oa=r=>{if(r.Type===0)return{name:"SENDING_QUERY",type:r.Type};if(r.Type===1)return{from:Oe(r.ID),name:"PEER_RESPONSE",type:r.Type,messageType:0,messageName:"PUT_VALUE",closer:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:Oe(e),multiaddrs:t.map(n=>yt(n)),protocols:[]})),providers:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:Oe(e),multiaddrs:t.map(n=>yt(n)),protocols:[]}))};if(r.Type===2){let e={id:r.ID??Oe(r.ID),multiaddrs:[],protocols:[]};return r.Responses&&r.Responses.length&&(e={id:Oe(r.Responses[0].ID),multiaddrs:r.Responses[0].Addrs.map(t=>yt(t)),protocols:[]}),{name:"FINAL_PEER",type:r.Type,peer:e}}if(r.Type===3)return{name:"QUERY_ERROR",type:r.Type,error:new Error(r.Extra)};if(r.Type===4)return{name:"PROVIDER",type:r.Type,providers:r.Responses.map(({ID:e,Addrs:t})=>({id:Oe(e),multiaddrs:t.map(n=>yt(n)),protocols:[]}))};if(r.Type===5)return{name:"VALUE",type:r.Type,value:Ie(r.Extra,"base64pad")};if(r.Type===6){let e=r.Responses.map(({ID:t})=>Oe(t));if(!e.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:r.Type,peer:e[0]}}if(r.Type===7)return{name:"DIALING_PEER",type:r.Type,peer:Oe(r.ID)};throw new Error("Unknown DHT event type")};var Gce=D(r=>{async function*e(t,n={}){let i=await r.post("dht/findpeer",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers});for await(let o of i.ndjson())yield oa(o)}return e});var jce=D(r=>{async function*e(t,n={}){let i=await r.post("dht/findprovs",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers});for await(let o of i.ndjson())yield oa(o)}return e});var Wce=D(r=>{async function*e(t,n={}){let i=await r.post("dht/get",{signal:n.signal,searchParams:M({arg:t instanceof Uint8Array?re(t):t.toString(),...n}),headers:n.headers});for await(let o of i.ndjson())yield oa(o)}return e});var Yce=D(r=>{async function*e(t,n={recursive:!1}){let i=Array.isArray(t)?t:[t],o=await r.post("dht/provide",{signal:n.signal,searchParams:M({arg:i.map(s=>s.toString()),...n}),headers:n.headers});for await(let s of o.ndjson())yield oa(s)}return e});var Qce=D(r=>{async function*e(t,n,i={}){let o=new AbortController,s=On(o.signal,i.signal),a=await r.post("dht/put",{signal:s,searchParams:M({arg:t instanceof Uint8Array?re(t):t.toString(),...i}),...await Dn([n],o,i.headers)});for await(let c of a.ndjson())yield oa(c)}return e});var Xce=D(r=>{async function*e(t,n={}){let i=await r.post("dht/query",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers});for await(let o of i.ndjson())yield oa(o)}return e});function Zce(r){return{findPeer:Gce(r),findProvs:jce(r),get:Wce(r),provide:Yce(r),put:Qce(r),query:Xce(r)}}var Jce=D(r=>{async function e(t={}){return(await r.post("diag/cmds",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()}return e});var eue=D(r=>{async function e(t={}){return(await r.post("diag/net",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()}return e});var tue=D(r=>{async function e(t={}){return(await r.post("diag/sys",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()}return e});function rue(r){return{cmds:Jce(r),net:eue(r),sys:tue(r)}}var nue=D(r=>{async function e(t,n,i={}){await(await r.post("files/chmod",{signal:i.signal,searchParams:M({arg:t,mode:n,...i}),headers:i.headers})).text()}return e});var iue=D(r=>{async function e(t,n,i={}){let o=Array.isArray(t)?t:[t];await(await r.post("files/cp",{signal:i.signal,searchParams:M({arg:o.concat(n).map(a=>z.asCID(a)?`/ipfs/${a}`:a),...i}),headers:i.headers})).text()}return e});var oue=D(r=>{async function e(t,n={}){if(!t||typeof t!="string")throw new Error("ipfs.files.flush requires a path");let o=await(await r.post("files/flush",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json();return z.parse(o.Cid)}return e});function M5(r){let e=kt(r);return Object.prototype.hasOwnProperty.call(e,"mode")&&(e.mode=parseInt(e.mode,8)),Object.prototype.hasOwnProperty.call(e,"mtime")&&(e.mtime={secs:e.mtime,nsecs:e.mtimeNsecs||0},delete e.mtimeNsecs),e}var aue=D(r=>{async function*e(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");let i=await r.post("files/ls",{signal:n.signal,searchParams:M({arg:z.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(let o of i.ndjson())if("Entries"in o)for(let s of o.Entries||[])yield sue(M5(s));else yield sue(M5(o))}return e});function sue(r){return r.hash&&(r.cid=z.parse(r.hash)),delete r.hash,r.type=r.type===1?"directory":"file",r}var cue=D(r=>{async function e(t,n={}){await(await r.post("files/mkdir",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).text()}return e});var uue=D(r=>{async function e(t,n,i={}){Array.isArray(t)||(t=[t]),await(await r.post("files/mv",{signal:i.signal,searchParams:M({arg:t.concat(n),...i}),headers:i.headers})).text()}return e});var due=C(fue(),1),hue=D(r=>{async function*e(t,n={}){let i=await r.post("files/read",{signal:n.signal,searchParams:M({arg:t,count:n.length,...n}),headers:n.headers});yield*(0,due.default)(i.body)}return e});var pue=C(O1(),1),mue=D(r=>{async function e(t,n={}){let i=await r.post("files/rm",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),o=await i.text();if(o!==""){let s=new pue.default.HTTPError(i);throw s.message=o,s}}return e});var Bv=D(r=>{async function e(t,n={}){let o=await(await r.post("files/stat",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json();return o.WithLocality=o.WithLocality||!1,QMe(M5(o))}return e});function QMe(r){return r.cid=z.parse(r.hash),delete r.hash,r}var gue=D(r=>{async function e(t,n={}){await(await r.post("files/touch",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).text()}return e});var yue=D(r=>{async function e(t,n,i={}){let o=new AbortController,s=On(o.signal,i.signal);await(await r.post("files/write",{signal:s,searchParams:M({arg:t,streamChannels:!0,count:i.length,...i}),...await Dn([{content:n,path:"arg",mode:kv(i.mode),mtime:Nv(i.mtime)}],o,i.headers)})).text()}return e});function wue(r){return{chmod:nue(r),cp:iue(r),flush:oue(r),ls:aue(r),mkdir:cue(r),mv:uue(r),read:hue(r),rm:mue(r),stat:Bv(r),touch:gue(r),write:yue(r)}}var bue=C(ee(),1),_ue=D(r=>async(t,n,i={})=>{throw(0,bue.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var Eue=D(r=>{async function e(t,n){let i=n??{type:"Ed25519"},s=await(await r.post("key/gen",{signal:i.signal,searchParams:M({arg:t,...i}),headers:i.headers})).json();return kt(s)}return e});var vue=D(r=>{async function e(t,n,i,o={}){let a=await(await r.post("key/import",{signal:o.signal,searchParams:M({arg:t,pem:n,password:i,...o}),headers:o.headers})).json();return kt(a)}return e});var xue=C(ee(),1),Sue=D(r=>async(t,n={})=>{throw(0,xue.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var Aue=D(r=>{async function e(t={}){return((await(await r.post("key/list",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).Keys||[]).map(o=>kt(o))}return e});var Tue=D(r=>{async function e(t,n,i={}){let o=await r.post("key/rename",{signal:i.signal,searchParams:M({arg:[t,n],...i}),headers:i.headers});return kt(await o.json())}return e});var Iue=D(r=>{async function e(t,n={}){let o=await(await r.post("key/rm",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json();return kt(o.Keys[0])}return e});function Rue(r){return{export:_ue(r),gen:Eue(r),import:vue(r),info:Sue(r),list:Aue(r),rename:Tue(r),rm:Iue(r)}}var Cue=D(r=>{async function e(t,n,i={}){let o=await r.post("log/level",{signal:i.signal,searchParams:M({arg:[t,n],...i}),headers:i.headers});return kt(await o.json())}return e});var Pue=D(r=>{async function e(t={}){return(await(await r.post("log/ls",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).Strings}return e});var kue=D(r=>{async function*e(t={}){yield*(await r.post("log/tail",{signal:t.signal,searchParams:M(t),headers:t.headers})).ndjson()}return e});function Nue(r){return{level:Cue(r),ls:Pue(r),tail:kue(r)}}var Due=D(r=>{async function e(t,n={}){let i=await r.post("name/publish",{signal:n.signal,searchParams:M({arg:`${t}`,...n}),headers:n.headers});return kt(await i.json())}return e});var Oue=D(r=>{async function*e(t,n={}){let i=await r.post("name/resolve",{signal:n.signal,searchParams:M({arg:t,stream:!0,...n}),headers:n.headers});for await(let o of i.ndjson())yield o.Path}return e});var Lue=D(r=>{async function e(t,n={}){let i=await r.post("name/pubsub/cancel",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers});return kt(await i.json())}return e});var Bue=D(r=>{async function e(t={}){let n=await r.post("name/pubsub/state",{signal:t.signal,searchParams:M(t),headers:t.headers});return kt(await n.json())}return e});var Mue=D(r=>{async function e(t={}){return(await(await r.post("name/pubsub/subs",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).Strings||[]}return e});function Uue(r){return{cancel:Lue(r),state:Bue(r),subs:Mue(r)}}function Fue(r){return{publish:Due(r),resolve:Oue(r),pubsub:Uue(r)}}var zue=D(r=>{async function e(t,n={}){let o=await(await r.post("object/data",{signal:n.signal,searchParams:M({arg:`${t instanceof Uint8Array?z.decode(t):t}`,...n}),headers:n.headers})).arrayBuffer();return new Uint8Array(o,0,o.byteLength)}return e});var Vue=D(r=>{async function e(t,n={}){let o=await(await r.post("object/get",{signal:n.signal,searchParams:M({arg:`${t instanceof Uint8Array?z.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers})).json();return{Data:Ie(o.Data,"base64pad"),Links:(o.Links||[]).map(s=>({Name:s.Name,Hash:z.parse(s.Hash),Tsize:s.Size}))}}return e});var Kue=D(r=>{async function e(t,n={}){return((await(await r.post("object/links",{signal:n.signal,searchParams:M({arg:`${t instanceof Uint8Array?z.decode(t):t}`,...n}),headers:n.headers})).json()).Links||[]).map(s=>({Name:s.Name,Tsize:s.Size,Hash:z.parse(s.Hash)}))}return e});var $ue=D(r=>{async function e(t={}){let n=await r.post("object/new",{signal:t.signal,searchParams:M({arg:t.template,...t}),headers:t.headers}),{Hash:i}=await n.json();return z.parse(i)}return e});var que=(r,e)=>D(n=>{let i=Lv(r,e);async function o(s,a={}){return i(s,{...a,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return o})(e);var Hue=D(r=>{async function e(t,n={}){let o=await(await r.post("object/stat",{signal:n.signal,searchParams:M({arg:`${t}`,...n}),headers:n.headers})).json();return{...o,Hash:z.parse(o.Hash)}}return e});var Gue=D(r=>{async function e(t,n,i={}){let o=await r.post("object/patch/add-link",{signal:i.signal,searchParams:M({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...i}),headers:i.headers}),{Hash:s}=await o.json();return z.parse(s)}return e});var jue=D(r=>{async function e(t,n,i={}){let o=new AbortController,s=On(o.signal,i.signal),a=await r.post("object/patch/append-data",{signal:s,searchParams:M({arg:`${t}`,...i}),...await Dn([n],o,i.headers)}),{Hash:c}=await a.json();return z.parse(c)}return e});var Wue=D(r=>{async function e(t,n,i={}){let o=await r.post("object/patch/rm-link",{signal:i.signal,searchParams:M({arg:[`${t}`,n.Name||n.name||null],...i}),headers:i.headers}),{Hash:s}=await o.json();return z.parse(s)}return e});var Yue=D(r=>{async function e(t,n,i={}){let o=new AbortController,s=On(o.signal,i.signal),a=await r.post("object/patch/set-data",{signal:s,searchParams:M({arg:[`${t}`],...i}),...await Dn([n],o,i.headers)}),{Hash:c}=await a.json();return z.parse(c)}return e});function Que(r){return{addLink:Gue(r),appendData:jue(r),rmLink:Wue(r),setData:Yue(r)}}function Xue(r,e){return{data:zue(e),get:Vue(e),links:Kue(e),new:$ue(e),put:que(r,e),stat:Hue(e),patch:Que(e)}}var Mv=D(r=>{async function*e(t,n={}){for await(let{path:i,recursive:o,metadata:s}of Tc(t)){let a=await r.post("pin/add",{signal:n.signal,searchParams:M({...n,arg:i,recursive:o,metadata:s?JSON.stringify(s):void 0,stream:!0}),headers:n.headers});for await(let c of a.ndjson()){if(c.Pins){for(let u of c.Pins)yield z.parse(u);continue}yield z.parse(c)}}}return e});function Zue(r){let e=Mv(r);return D(()=>{async function t(n,i={}){return Dr(e([{path:n,...i}],i))}return t})(r)}function Jue(r,e,t){let n={type:r,cid:z.parse(e)};return t&&(n.metadata=t),n}var ele=D(r=>{async function*e(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);let i=await r.post("pin/ls",{signal:t.signal,searchParams:M({...t,arg:n.map(o=>`${o}`),stream:!0}),headers:t.headers});for await(let o of i.ndjson()){if(o.Keys){for(let s of Object.keys(o.Keys))yield Jue(o.Keys[s].Type,s,o.Keys[s].Metadata);return}yield Jue(o.Type,o.Cid,o.Metadata)}}return e});var Uv=D(r=>{async function*e(t,n={}){for await(let{path:i,recursive:o}of Tc(t)){let s=new URLSearchParams(n.searchParams);s.append("arg",`${i}`),o!=null&&s.set("recursive",String(o));let a=await r.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:M({...n,arg:`${i}`,recursive:o})});for await(let c of a.ndjson()){if(c.Pins){yield*c.Pins.map(u=>z.parse(u));continue}yield z.parse(c)}}}return e});var tle=r=>{let e=Uv(r);return D(()=>{async function t(n,i={}){return Dr(e([{path:n,...i}],i))}return t})(r)};var Fv=({Name:r,Status:e,Cid:t})=>({cid:z.parse(t),name:r,status:e}),rle=r=>{if(typeof r=="string"&&r!=="")return r;throw new TypeError("service name must be passed")},nle=r=>{if(z.asCID(r))return r.toString();throw new TypeError(`CID instance expected instead of ${typeof r}`)},K2=({service:r,cid:e,name:t,status:n,all:i})=>{let o=M({service:rle(r),name:t,force:i?!0:void 0});if(e)for(let s of e)o.append("cid",nle(s));if(n)for(let s of n)o.append("status",s);return o},ile=({cid:r,service:e,background:t,name:n,origins:i})=>{let o=M({arg:nle(r),service:rle(e),name:n,background:t?!0:void 0});if(i)for(let s of i)o.append("origin",s.toString());return o};function ole(r){async function e(t,{timeout:n,signal:i,headers:o,...s}){let a=await r.post("pin/remote/add",{timeout:n,signal:i,headers:o,searchParams:ile({cid:t,...s})});return Fv(await a.json())}return e}function sle(r){async function*e({timeout:t,signal:n,headers:i,...o}){let s=await r.post("pin/remote/ls",{timeout:t,signal:n,headers:i,searchParams:K2(o)});for await(let a of s.ndjson())yield Fv(a)}return e}function ale(r){async function e({timeout:t,signal:n,headers:i,...o}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:K2({...o,all:!1})})}return e}function cle(r){async function e({timeout:t,signal:n,headers:i,...o}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:i,searchParams:K2({...o,all:!0})})}return e}function ule(r){let e=String(r);if(e==="undefined")throw Error("endpoint is required");return e[e.length-1]==="/"?e.slice(0,-1):e}function lle(r){return{service:r.Service,endpoint:new URL(r.ApiEndpoint),...r.Stat&&{stat:XMe(r.Stat)}}}function XMe(r){switch(r.Status){case"valid":{let{Pinning:e,Pinned:t,Queued:n,Failed:i}=r.PinCount;return{status:"valid",pinCount:{queued:n,pinning:e,pinned:t,failed:i}}}case"invalid":return{status:"invalid"};default:return{status:r.Status}}}function fle(r){async function e(t,n){let{endpoint:i,key:o,headers:s,timeout:a,signal:c}=n;await r.post("pin/remote/service/add",{timeout:a,signal:c,searchParams:M({arg:[t,ule(i),o]}),headers:s})}return e}function dle(r){async function e(t={}){let{stat:n,headers:i,timeout:o,signal:s}=t,a=await r.post("pin/remote/service/ls",{timeout:o,signal:s,headers:i,searchParams:n===!0?M({stat:n}):void 0}),{RemoteServices:c}=await a.json();return c.map(lle)}return e}function hle(r){async function e(t,n={}){await r.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:M({arg:t})})}return e}function ple(r){let e=new Hd(r);return{add:fle(e),ls:dle(e),rm:hle(e)}}function mle(r){let e=new Hd(r);return{add:ole(e),ls:sle(e),rm:ale(e),rmAll:cle(e),service:ple(r)}}function gle(r){return{addAll:Mv(r),add:Zue(r),ls:ele(r),rmAll:Uv(r),rm:tle(r),remote:mle(r)}}var yle=r=>Array.isArray(r)?r.map(zv):r,zv=r=>re($2(r)),$2=r=>Gg.decode(r),wle=r=>BigInt(`0x${re(Gg.decode(r),"base16")}`),q2=r=>Gg.encode(Ie(r));var ble=D(r=>{async function e(t={}){let{Strings:n}=await(await r.post("pubsub/ls",{signal:t.signal,searchParams:M(t),headers:t.headers})).json();return yle(n)||[]}return e});var _le=D(r=>{async function e(t,n={}){let i=await r.post("pubsub/peers",{signal:n.signal,searchParams:M({arg:q2(t),...n}),headers:n.headers}),{Strings:o}=await i.json();return o||[]}return e});var Ele=D(r=>{async function e(t,n,i={}){let o=M({arg:q2(t),...i}),s=new AbortController,a=On(s.signal,i.signal);await(await r.post("pubsub/pub",{signal:a,searchParams:o,...await Dn([n],s,i.headers)})).text()}return e});var ZMe=j("ipfs-http-client:pubsub:subscribe"),vle=(r,e)=>D(t=>{async function n(i,o,s={}){s.signal=e.subscribe(i,o,s.signal);let a,c,u=new Promise((f,h)=>{a=f,c=h}),l=setTimeout(()=>a(),1e3);return t.post("pubsub/sub",{signal:s.signal,searchParams:M({arg:q2(i),...s}),headers:s.headers}).catch(f=>{e.unsubscribe(i,o),c(f)}).then(f=>{clearTimeout(l),f&&(JMe(f,{onMessage:h=>{if(o){if(typeof o=="function"){o(h);return}typeof o.handleEvent=="function"&&o.handleEvent(h)}},onEnd:()=>e.unsubscribe(i,o),onError:s.onError}),a())}),u}return n})(r);async function JMe(r,{onMessage:e,onEnd:t,onError:n}){n=n||ZMe;try{for await(let i of r.ndjson())try{if(!i.from)continue;i.from!=null&&i.seqno!=null?e({type:"signed",from:Oe(i.from),data:$2(i.data),sequenceNumber:wle(i.seqno),topic:zv(i.topicIDs[0]),key:$2(i.key??"u"),signature:$2(i.signature??"u")}):e({type:"unsigned",data:$2(i.data),topic:zv(i.topicIDs[0])})}catch(o){o.message=`Failed to parse pubsub message: ${o.message}`,n(o,!1,i)}}catch(i){eUe(i)||n(i,!0)}finally{t()}}var eUe=r=>{switch(r.type){case"aborted":return!0;case"abort":return!0;default:return r.name==="AbortError"}};var xle=(r,e)=>{async function t(n,i){e.unsubscribe(n,i)}return t};var Vv=class{constructor(){this._subs=new Map}subscribe(e,t,n){let i=this._subs.get(e)||[];if(i.find(s=>s.handler===t))throw new Error(`Already subscribed to ${e} with this handler`);let o=new AbortController;return this._subs.set(e,[{handler:t,controller:o}].concat(i)),n&&n.addEventListener("abort",()=>this.unsubscribe(e,t)),o.signal}unsubscribe(e,t){let n=this._subs.get(e)||[],i;t?(this._subs.set(e,n.filter(o=>o.handler!==t)),i=n.filter(o=>o.handler===t)):(this._subs.set(e,[]),i=n),(this._subs.get(e)||[]).length||this._subs.delete(e),i.forEach(o=>o.controller.abort())}};function Sle(r){let e=new Vv;return{ls:ble(r),peers:_le(r),publish:Ele(r),subscribe:vle(r,e),unsubscribe:xle(r,e)}}var Ale=D(r=>{async function*e(t={}){yield*(await r.post("refs/local",{signal:t.signal,transform:kt,searchParams:M(t),headers:t.headers})).ndjson()}return e});var Tle=D((r,e)=>Object.assign(async function*(n,i={}){let o=Array.isArray(n)?n:[n];yield*(await r.post("refs",{signal:i.signal,searchParams:M({arg:o.map(a=>`${a instanceof Uint8Array?z.decode(a):a}`),...i}),headers:i.headers,transform:kt})).ndjson()},{local:Ale(e)}));var Ile=D(r=>{async function*e(t={}){yield*(await r.post("repo/gc",{signal:t.signal,searchParams:M(t),headers:t.headers,transform:i=>({err:i.Error?new Error(i.Error):null,cid:(i.Key||{})["/"]?z.parse(i.Key["/"]):null})})).ndjson()}return e});var Kv=D(r=>{async function e(t={}){let i=await(await r.post("repo/stat",{signal:t.signal,searchParams:M(t),headers:t.headers})).json();return{numObjects:BigInt(i.NumObjects),repoSize:BigInt(i.RepoSize),repoPath:i.RepoPath,version:i.Version,storageMax:BigInt(i.StorageMax)}}return e});var Rle=D(r=>{async function e(t={}){return(await(await r.post("repo/version",{signal:t.signal,searchParams:M(t),headers:t.headers})).json()).Version}return e});function Cle(r){return{gc:Ile(r),stat:Kv(r),version:Rle(r)}}var Ple=D(r=>{async function*e(t={}){yield*(await r.post("stats/bw",{signal:t.signal,searchParams:M(t),headers:t.headers,transform:i=>({totalIn:BigInt(i.TotalIn),totalOut:BigInt(i.TotalOut),rateIn:parseFloat(i.RateIn),rateOut:parseFloat(i.RateOut)})})).ndjson()}return e});function kle(r){return{bitswap:Dv(r),repo:Kv(r),bw:Ple(r)}}var Nle=D(r=>{async function e(t={}){let n=await r.post("swarm/addrs",{signal:t.signal,searchParams:M(t),headers:t.headers}),{Addrs:i}=await n.json();return Object.keys(i).map(o=>({id:Oe(o),addrs:(i[o]||[]).map(s=>yt(s))}))}return e});var Dle=D(r=>{async function e(t,n={}){let i=await r.post("swarm/connect",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),{Strings:o}=await i.json();return o||[]}return e});var Ole=D(r=>{async function e(t,n={}){let i=await r.post("swarm/disconnect",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),{Strings:o}=await i.json();return o||[]}return e});var Lle=D(r=>{async function e(t={}){let n=await r.post("swarm/addrs/local",{signal:t.signal,searchParams:M(t),headers:t.headers}),{Strings:i}=await n.json();return(i||[]).map(o=>yt(o))}return e});var Ble=D(r=>{async function e(t={}){let n=await r.post("swarm/peers",{signal:t.signal,searchParams:M(t),headers:t.headers}),{Peers:i}=await n.json();return(i||[]).map(o=>({addr:yt(o.Addr),peer:Oe(o.Peer),muxer:o.Muxer,latency:o.Latency,streams:o.Streams,direction:o.Direction==null?void 0:o.Direction===0?"inbound":"outbound"}))}return e});function Mle(r){return{addrs:Nle(r),connect:Dle(r),disconnect:Ole(r),localAddrs:Lle(r),peers:Ble(r)}}var $v=D(r=>{async function*e(t,n={}){let i=new AbortController,o=On(i.signal,n.signal),{headers:s,body:a,total:c,parts:u}=await Dn(t,i,n.headers),[l,f]=typeof n.progress=="function"?tUe(c,u,n.progress):[void 0,void 0],h=await r.post("add",{searchParams:M({"stream-channels":!0,...n,progress:!!l}),onUploadProgress:f,signal:o,headers:s,body:a});for await(let d of h.ndjson())d=kt(d),d.hash!==void 0?yield nUe(d):l&&l(d.bytes||0,d.name)}return e}),tUe=(r,e,t)=>e?[void 0,rUe(r,e,t)]:[t,void 0],rUe=(r,e,t)=>{let n=0,i=e.length;return({loaded:o,total:s})=>{let a=Math.floor(o/s*r);for(;n<i;){let{start:c,end:u,name:l}=e[n];if(a<u){t(a-c,l);break}else t(u-c,l),n+=1}}};function nUe({name:r,hash:e,size:t,mode:n,mtime:i,mtimeNsecs:o}){let s={path:r,cid:z.parse(e),size:parseInt(t)};return n!=null&&(s.mode=parseInt(n,8)),i!=null&&(s.mtime={secs:i,nsecs:o||0}),s}function Ule(r){let e=$v(r);return D(()=>{async function t(n,i={}){return await Dr(e(W_(n),i))}return t})(r)}var Fle=D(r=>{async function*e(t,n={}){yield*(await r.post("cat",{signal:n.signal,searchParams:M({arg:t.toString(),...n}),headers:n.headers})).iterator()}return e});var zle=D(r=>async(t={})=>(await r.post("commands",{signal:t.signal,searchParams:M(t),headers:t.headers})).json());var Vle=D(r=>async(t,n={})=>(await(await r.post("dns",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers})).json()).Path);var Kle=D(r=>()=>{let e=new URL(r.opts.base||"");return{host:e.hostname,port:e.port,protocol:e.protocol,pathname:e.pathname,"api-path":e.pathname}});var $le=D(r=>{async function*e(t,n={}){let i={arg:`${t instanceof Uint8Array?z.decode(t):t}`,...n};i.compressionLevel&&(i["compression-level"]=i.compressionLevel,delete i.compressionLevel),yield*(await r.post("get",{signal:n.signal,searchParams:M(i),headers:n.headers})).iterator()}return e});var qv=D(r=>{async function e(t={}){let i=await(await r.post("id",{signal:t.signal,searchParams:M({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers})).json(),o={...kt(i)};return o.id=Oe(o.id),o.addresses&&(o.addresses=o.addresses.map(s=>yt(s))),o}return e});var qle=r=>{let e=qv(r);async function t(n={}){let i=await e(n);return!!(i&&i.addresses&&i.addresses.length)}return t};var Hle=D((r,e)=>{async function*t(n,i={}){let o=`${n instanceof Uint8Array?z.decode(n):n}`;async function s(c){let u=c.Hash;if(u.includes("/")){let f=u.startsWith("/ipfs/")?u:`/ipfs/${u}`;u=(await Bv(e)(f)).cid}else u=z.parse(u);let l={name:c.Name,path:o+(c.Name?`/${c.Name}`:""),size:c.Size,cid:u,type:iUe(c)};return c.Mode&&(l.mode=parseInt(c.Mode,8)),c.Mtime!==void 0&&c.Mtime!==null&&(l.mtime={secs:c.Mtime},c.MtimeNsecs!==void 0&&c.MtimeNsecs!==null&&(l.mtime.nsecs=c.MtimeNsecs)),l}let a=await r.post("ls",{signal:i.signal,searchParams:M({arg:o,...i}),headers:i.headers});for await(let c of a.ndjson()){if(c=c.Objects,!c)throw new Error("expected .Objects in results");if(c=c[0],!c)throw new Error("expected one array in results.Objects");let u=c.Links;if(!Array.isArray(u))throw new Error("expected one array in results.Objects[0].Links");if(!u.length){yield s(c);return}yield*u.map(s)}}return t});function iUe(r){switch(r.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}var Gle=D(r=>{async function e(t={}){let n=await r.post("dns",{signal:t.signal,searchParams:M(t),headers:t.headers});return kt(await n.json())}return e});var jle=D(r=>{async function*e(t,n={}){yield*(await r.post("ping",{signal:n.signal,searchParams:M({arg:`${t}`,...n}),headers:n.headers,transform:kt})).ndjson()}return e});var Wle=D(r=>{async function e(t,n={}){let i=await r.post("resolve",{signal:n.signal,searchParams:M({arg:t,...n}),headers:n.headers}),{Path:o}=await i.json();return o}return e});var Yle=C(ee(),1),Qle=D(r=>async(t={})=>{throw(0,Yle.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")});var Xle=D(r=>{async function e(t={}){await(await r.post("shutdown",{signal:t.signal,searchParams:M(t),headers:t.headers})).text()}return e});var Zle=D(r=>{async function e(t={}){let n=await r.post("version",{signal:t.signal,searchParams:M(t),headers:t.headers});return{...kt(await n.json()),"ipfs-http-client":"1.0.0"}}return e});var cUe=C(dL(),1);function efe(r={}){let e={name:Ii.name,code:Ii.code,encode:u=>u,decode:u=>u},t=Object.values(Vu);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach(u=>t.push(u));let n=new F2({bases:t,loadBase:r.ipld&&r.ipld.loadBase}),i=Object.values(x8);[sr,o1,a1,yy,e].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>i.push(u));let o=new z2({codecs:i,loadCodec:r.ipld&&r.ipld.loadCodec}),s=Object.values(v8);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach(u=>s.push(u));let a=new V2({hashers:s,loadHasher:r.ipld&&r.ipld.loadHasher});return{add:Ule(r),addAll:$v(r),bitswap:mce(r),block:Ace(r),bootstrap:kce(r),cat:Fle(r),commands:zle(r),config:Fce(r),dag:Hce(o,r),dht:Zce(r),diag:rue(r),dns:Vle(r),files:wue(r),get:$le(r),getEndpointConfig:Kle(r),id:qv(r),isOnline:qle(r),key:Rue(r),log:Nue(r),ls:Hle(r),mount:Gle(r),name:Fue(r),object:Xue(o,r),pin:gle(r),ping:jle(r),pubsub:Sle(r),refs:Tle(r),repo:Cle(r),resolve:Wle(r),start:Qle(r),stats:kle(r),stop:Xle(r),swarm:Mle(r),version:Zle(r),bases:n,codecs:o,hashers:a}}var t4=C(ee(),1);var Gd=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function tfe(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function sa(r,e,t){let n=t??{},i=tfe(r);async function*o(){let s,a=()=>{s!=null&&s()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:l,abortCode:f}=n;throw new Gd(l,f)}let u=new Promise((l,f)=>{s=()=>{let{abortMessage:h,abortCode:d}=n;f(new Gd(h,d))}});c=await Promise.race([u,i.next()]),s=null}catch(u){e.removeEventListener("abort",a);let l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof i.return=="function")try{let f=i.return();f instanceof Promise&&f.catch(h=>{n.onReturnError!=null&&n.onReturnError(h)})}catch(f){n.onReturnError!=null&&n.onReturnError(f)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return o()}function uUe(r,e,t){return n=>r(sa(n,e,t))}function ps(r,e,t){return{sink:uUe(r.sink,e,{...t,onAbort:void 0}),source:sa(r.source,e,t)}}var lUe=Ye("dns4"),fUe=Ye("dns6"),dUe=Ye("dnsaddr"),H2=qi(Ye("dns"),dUe,lUe,fUe),Hv=qi(Ye("ip4"),Ye("ip6")),V5=qi(_t(Hv,Ye("tcp")),_t(H2,Ye("tcp"))),nfe=_t(Hv,Ye("udp")),hUe=_t(nfe,Ye("utp")),pUe=_t(nfe,Ye("quic")),U5=qi(_t(V5,Ye("ws")),_t(H2,Ye("ws"))),F5=qi(_t(V5,Ye("wss")),_t(H2,Ye("wss"))),hL=qi(_t(V5,Ye("http")),_t(Hv,Ye("http")),_t(H2,Ye("http"))),pL=qi(_t(V5,Ye("https")),_t(Hv,Ye("https")),_t(H2,Ye("https"))),Gv=qi(_t(U5,Ye("p2p-webrtc-star"),Ye("p2p")),_t(F5,Ye("p2p-webrtc-star"),Ye("p2p")),_t(U5,Ye("p2p-webrtc-star")),_t(F5,Ye("p2p-webrtc-star"))),jMt=qi(_t(U5,Ye("p2p-websocket-star"),Ye("p2p")),_t(F5,Ye("p2p-websocket-star"),Ye("p2p")),_t(U5,Ye("p2p-websocket-star")),_t(F5,Ye("p2p-websocket-star"))),ife=qi(_t(hL,Ye("p2p-webrtc-direct"),Ye("p2p")),_t(pL,Ye("p2p-webrtc-direct"),Ye("p2p")),_t(hL,Ye("p2p-webrtc-direct")),_t(pL,Ye("p2p-webrtc-direct"))),z5=qi(U5,F5,hL,pL,Gv,ife,V5,hUe,pUe,H2),WMt=qi(_t(z5,Ye("p2p-stardust"),Ye("p2p")),_t(z5,Ye("p2p-stardust"))),jd=qi(_t(z5,Ye("p2p")),Gv,ife,Ye("p2p")),rfe=qi(_t(jd,Ye("p2p-circuit"),jd),_t(jd,Ye("p2p-circuit")),_t(Ye("p2p-circuit"),jd),_t(z5,Ye("p2p-circuit")),_t(Ye("p2p-circuit"),z5),Ye("p2p-circuit")),ofe=()=>qi(_t(rfe,ofe),rfe),i0=ofe(),YMt=qi(_t(i0,jd,i0),_t(jd,i0),_t(i0,jd),i0,jd);function sfe(r){function e(t){let n;try{n=lt(t)}catch{return!1}let i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function _t(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:sfe(e),partialMatch:e}}function qi(...r){function e(n){let i=null;return r.some(o=>{let s=typeof o=="function"?o().partialMatch(n):o.partialMatch(n);return s!=null?(i=s,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:sfe(e),partialMatch:e}}function Ye(r){let e=r;function t(i){let o;try{o=lt(i)}catch{return!1}let s=o.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var jfe=C(ee(),1);var ic=Object.create(null);ic.open="0";ic.close="1";ic.ping="2";ic.pong="3";ic.message="4";ic.upgrade="5";ic.noop="6";var K5=Object.create(null);Object.keys(ic).forEach(r=>{K5[ic[r]]=r});var cfe={type:"error",data:"parser error"};var mUe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",gUe=typeof ArrayBuffer=="function",yUe=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,wUe=({type:r,data:e},t,n)=>mUe&&e instanceof Blob?t?n(e):ufe(e,n):gUe&&(e instanceof ArrayBuffer||yUe(e))?t?n(e):ufe(new Blob([e]),n):n(ic[r]+(e||"")),ufe=(r,e)=>{let t=new FileReader;return t.onload=function(){let n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},jv=wUe;var lfe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$5=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<lfe.length;r++)$5[lfe.charCodeAt(r)]=r;var ffe=r=>{let e=r.length*.75,t=r.length,n,i=0,o,s,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);let u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)o=$5[r.charCodeAt(n)],s=$5[r.charCodeAt(n+1)],a=$5[r.charCodeAt(n+2)],c=$5[r.charCodeAt(n+3)],l[i++]=o<<2|s>>4,l[i++]=(s&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u};var bUe=typeof ArrayBuffer=="function",_Ue=(r,e)=>{if(typeof r!="string")return{type:"message",data:dfe(r,e)};let t=r.charAt(0);return t==="b"?{type:"message",data:EUe(r.substring(1),e)}:K5[t]?r.length>1?{type:K5[t],data:r.substring(1)}:{type:K5[t]}:cfe},EUe=(r,e)=>{if(bUe){let t=ffe(r);return dfe(t,e)}else return{base64:!0,data:r}},dfe=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},Wv=_Ue;var hfe=String.fromCharCode(30),pfe=(r,e)=>{let t=r.length,n=new Array(t),i=0;r.forEach((o,s)=>{jv(o,!1,a=>{n[s]=a,++i===t&&e(n.join(hfe))})})},mfe=(r,e)=>{let t=r.split(hfe),n=[];for(let i=0;i<t.length;i++){let o=Wv(t[i],e);if(n.push(o),o.type==="error")break}return n},mL=4;function Tr(r){if(r)return vUe(r)}function vUe(r){for(var e in Tr.prototype)r[e]=Tr.prototype[e];return r}Tr.prototype.on=Tr.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};Tr.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};Tr.prototype.off=Tr.prototype.removeListener=Tr.prototype.removeAllListeners=Tr.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};Tr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};Tr.prototype.emitReserved=Tr.prototype.emit;Tr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Tr.prototype.hasListeners=function(r){return!!this.listeners(r).length};var Hi=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Yv(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}var xUe=Hi.setTimeout,SUe=Hi.clearTimeout;function Il(r,e){e.useNativeTimers?(r.setTimeoutFn=xUe.bind(Hi),r.clearTimeoutFn=SUe.bind(Hi)):(r.setTimeoutFn=Hi.setTimeout.bind(Hi),r.clearTimeoutFn=Hi.clearTimeout.bind(Hi))}var AUe=1.33;function gfe(r){return typeof r=="string"?TUe(r):Math.ceil((r.byteLength||r.size)*AUe)}function TUe(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}var gL=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}},o0=class extends Tr{constructor(e){super(),this.writable=!1,Il(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new gL(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Wv(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}};var _fe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),yL=64,IUe={},yfe=0,Qv=0,wfe;function bfe(r){let e="";do e=_fe[r%yL]+e,r=Math.floor(r/yL);while(r>0);return e}function Xv(){let r=bfe(+new Date);return r!==wfe?(yfe=0,wfe=r):r+"."+bfe(yfe++)}for(;Qv<yL;Qv++)IUe[_fe[Qv]]=Qv;function Zv(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Efe(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}var vfe=!1;try{vfe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var xfe=vfe;function wL(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||xfe))return new XMLHttpRequest}catch{}if(!e)try{return new Hi[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function RUe(){}var CUe=function(){return new wL({xdomain:!1}).responseType!=null}(),Jv=class extends o0{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}let t=e&&e.forceBase64;this.supportsBinary=CUe&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};mfe(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,pfe(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{},t=this.opts.secure?"https":"http",n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Xv()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);let i=Zv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new aa(this.uri(),e)}doWrite(e,t){let n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}},aa=class extends Tr{constructor(e,t){super(),Il(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){let e=Yv(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;let t=this.xhr=new wL(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=aa.requestsCount++,aa.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=RUe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete aa.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};aa.requestsCount=0;aa.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Sfe);else if(typeof addEventListener=="function"){let r="onpagehide"in Hi?"pagehide":"unload";addEventListener(r,Sfe,!1)}}function Sfe(){for(let r in aa.requests)aa.requests.hasOwnProperty(r)&&aa.requests[r].abort()}var q5=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),H5=Hi.WebSocket||Hi.MozWebSocket,e9=!0,Afe="arraybuffer";var Tfe=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",t9=class extends o0{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,n=Tfe?{}:Yv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=e9&&!Tfe?t?new H5(e,t):new H5(e):new H5(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Afe,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],i=t===e.length-1;jv(n,this.supportsBinary,o=>{let s={};e9||(n.options&&(s.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof o=="string"?Buffer.byteLength(o):o.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1));try{e9?this.ws.send(o):this.ws.send(o,s)}catch{}i&&q5(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Xv()),this.supportsBinary||(e.b64=1);let i=Zv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!H5}};var bL={websocket:t9,polling:Jv};var PUe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,kUe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function G2(r){let e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=PUe.exec(r||""),o={},s=14;for(;s--;)o[kUe[s]]=i[s]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=NUe(o,o.path),o.queryKey=DUe(o,o.query),o}function NUe(r,e){let t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function DUe(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,o){i&&(t[i]=o)}),t}var ms=class extends Tr{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=G2(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=G2(t.host).host),Il(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Efe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=mL,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new bL[e](n)}open(){let e;if(this.opts.rememberUpgrade&&ms.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;ms.priorWebsocketSuccess=!1;let i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ms.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function o(){n||(n=!0,l(),t.close(),t=null)}let s=f=>{let h=new Error("probe error: "+f);h.transport=t.name,o(),this.emitReserved("upgradeError",h)};function a(){s("transport closed")}function c(){s("socket closed")}function u(f){t&&f.name!==t.name&&o()}let l=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",ms.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){let i=this.writeBuffer[n].data;if(i&&(t+=gfe(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){ms.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],n=0,i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};ms.protocol=mL;var XUt=ms.protocol;function Ife(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=G2(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}var SL={};xe(SL,{Decoder:()=>W5,Encoder:()=>vL,PacketType:()=>Nt,protocol:()=>kfe});var OUe=typeof ArrayBuffer=="function",LUe=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Rfe=Object.prototype.toString,BUe=typeof Blob=="function"||typeof Blob<"u"&&Rfe.call(Blob)==="[object BlobConstructor]",MUe=typeof File=="function"||typeof File<"u"&&Rfe.call(File)==="[object FileConstructor]";function j5(r){return OUe&&(r instanceof ArrayBuffer||LUe(r))||BUe&&r instanceof Blob||MUe&&r instanceof File}function G5(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(G5(r[t]))return!0;return!1}if(j5(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return G5(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&G5(r[t]))return!0;return!1}function Cfe(r){let e=[],t=r.data,n=r;return n.data=_L(t,e),n.attachments=e.length,{packet:n,buffers:e}}function _L(r,e){if(!r)return r;if(j5(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=_L(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=_L(r[n],e));return t}return r}function Pfe(r,e){return r.data=EL(r.data,e),delete r.attachments,r}function EL(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=EL(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=EL(r[t],e));return r}var kfe=5,Nt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Nt||(Nt={}));var vL=class{constructor(e){this.replacer=e}encode(e){return(e.type===Nt.EVENT||e.type===Nt.ACK)&&G5(e)?this.encodeAsBinary({type:e.type===Nt.EVENT?Nt.BINARY_EVENT:Nt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Nt.BINARY_EVENT||e.type===Nt.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=Cfe(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}},W5=class extends Tr{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let n=t.type===Nt.BINARY_EVENT;n||t.type===Nt.BINARY_ACK?(t.type=n?Nt.EVENT:Nt.ACK,this.reconstructor=new xL(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(j5(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,n={type:Number(e.charAt(0))};if(Nt[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Nt.BINARY_EVENT||n.type===Nt.BINARY_ACK){let o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(e.charAt(t+1)==="/"){let o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let o=t+1;for(;++t;){let s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){let o=this.tryParse(e.substr(t));if(W5.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Nt.CONNECT:return typeof t=="object";case Nt.DISCONNECT:return t===void 0;case Nt.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Nt.EVENT:case Nt.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case Nt.ACK:case Nt.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},xL=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Pfe(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function gs(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var UUe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),j2=class extends Tr{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[gs(e,"open",this.onopen.bind(this)),gs(e,"packet",this.onpacket.bind(this)),gs(e,"error",this.onerror.bind(this)),gs(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(UUe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:Nt.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let s=this.ids++,a=t.pop();this._registerAckCallback(s,a),n.id=s}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){let n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>n?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Nt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Nt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nt.EVENT:case Nt.BINARY_EVENT:this.onevent(e);break;case Nt.ACK:case Nt.BINARY_ACK:this.onack(e);break;case Nt.DISCONNECT:this.ondisconnect();break;case Nt.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...i){n||(n=!0,t.packet({type:Nt.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function s0(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}s0.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};s0.prototype.reset=function(){this.attempts=0};s0.prototype.setMin=function(r){this.ms=r};s0.prototype.setMax=function(r){this.max=r};s0.prototype.setJitter=function(r){this.jitter=r};var W2=class extends Tr{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Il(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new s0({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||SL;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ms(this.uri,this.opts);let t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=gs(t,"open",function(){n.onopen(),e&&e()}),o=gs(t,"error",s=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",s),e?e(s):n.maybeReconnectOnOpen()});if(this._timeout!==!1){let s=this._timeout;s===0&&i();let a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(gs(e,"ping",this.onping.bind(this)),gs(e,"data",this.ondata.bind(this)),gs(e,"error",this.onerror.bind(this)),gs(e,"close",this.onclose.bind(this)),gs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){q5(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new j2(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let n of t)if(this.nsps[n].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Y5={};function Q5(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=Ife(r,e.path||"/socket.io"),n=t.source,i=t.id,o=t.path,s=Y5[i]&&o in Y5[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s,c;return a?c=new W2(n,e):(Y5[i]||(Y5[i]=new W2(n,e)),c=Y5[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(Q5,{Manager:W2,Socket:j2,io:Q5,connect:Q5});var a0=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Rl,Zt=class extends EventTarget{constructor(){super(...arguments),Rl.set(this,new Map)}listenerCount(e){let t=a0(this,Rl,"f").get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let i=a0(this,Rl,"f").get(e);i==null&&(i=[],a0(this,Rl,"f").set(e,i)),i.push({callback:t,once:(n!==!0&&n!==!1&&(n==null?void 0:n.once))??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let i=a0(this,Rl,"f").get(e);i!=null&&(i=i.filter(({callback:o})=>o!==t),a0(this,Rl,"f").set(e,i))}dispatchEvent(e){let t=super.dispatchEvent(e),n=a0(this,Rl,"f").get(e.type);return n==null||(n=n.filter(({once:i})=>!i),a0(this,Rl,"f").set(e.type,n)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new ve(e,t))}};Rl=new WeakMap;var AL=class extends Event{constructor(e,t){super(e,t),this.detail=t==null?void 0:t.detail}},ve=globalThis.CustomEvent??AL;var X5=C(ee(),1),Ufe=C(r9(),1);var Ofe=C(ee(),1);var Dfe=64*1024,zUe=5*1e3,n9=class{constructor(e,t){this.label=e.label,this.open=io(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,typeof this.channel.bufferedAmountLowThreshold=="number"&&(this.channel.bufferedAmountLowThreshold=Dfe),e.addEventListener("message",i=>{t.onMessage(i)}),e.addEventListener("bufferedamountlow",()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()}),e.addEventListener("open",()=>{this.open.resolve(),t.onOpen()}),e.addEventListener("close",()=>{t.onClose()}),e.addEventListener("error",i=>{var s,a,c,u,l;if(((s=i.error)==null?void 0:s.message)==="Transport channel closed")return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,(a=i.error)==null?void 0:a.message,(c=i.error)==null?void 0:c.errorDetail);let o=i.error instanceof Error?i.error:new Error(`datachannel error: ${(u=i.error)==null?void 0:u.message} ${(l=i.error)==null?void 0:l.errorDetail}`);t.onError((0,Ofe.default)(o,"ERR_DATA_CHANNEL"))});let n=!1;this.closingInterval=setInterval(()=>{e.readyState==="closing"?(n&&t.onClose(),n=!0):n=!1},zUe)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>Dfe&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=io())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}};var Ffe=C(RL(),1),KUe={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function $Ue(){if(typeof globalThis>"u")throw(0,X5.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");let r={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(r.RTCPeerConnection==null)throw(0,X5.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return r}var c0=class extends Zt{constructor(e){super(),this.id=e.id??Ee((0,Ufe.default)(4),"hex").slice(0,7),this.log=ue(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??$Ue(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},KUe,e.peerConnectionConfig)),this.closed=!1,this.connected=io(),this.source=jn(),this.sink=async t=>{if(await this.connected.promise,this.channel==null)throw(0,X5.default)(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(let n of t)await this.channel.send(n);await this.close()}}handleDataChannelEvent(e){let t=e.channel;if(t==null){this.close((0,X5.default)(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch(n=>{this.log("Error closing after event channel was found to be null",n)});return}this.channel=new n9(t,{log:this.log,onMessage:n=>{this.source.push(new Uint8Array(n.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new ve("ready"))},onClose:()=>{this.close().catch(n=>{this.log("error closing connection after channel close",n)})},onError:n=>{this.close(n).catch(i=>{this.log("error closing connection after channel error",i)})}})}async close(e){var t;if(this.closed=!0,e==null&&this.channel!=null)for(;this.channel.bufferedAmount>0;)await(0,Ffe.default)(100);(t=this.channel)==null||t.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new ve("close"))}};var zfe=C(ee(),1),Y2=class extends Zt{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch(t=>{this.log.error("could not renegotiate %o",t)})})}async handleSignal(e){if(this.log('incoming signal "%s"',e.type),e.type==="offer")return await this.handleOffer(e);if(e.type==="answer")return await this.handleAnswer(e);if(e.type==="candidate")return await this.handleCandidate(e);if(e.type==="renegotiate")return await this.handleRenegotiate(e);if(e.type==="goodbye")return await this.handleGoodye(e);this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){let t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(n){if(t.address==null||t.address.endsWith(".local"))this.log("ignoring unsupported ICE candidate.");else throw(0,zfe.default)(n,"ERR_ADD_ICE_CANDIDATE")}}};var Vfe=ue("libp2p:webrtc-peer:receiver"),Z5=class extends c0{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new CL({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",t=>this.dispatchEvent(new ve("signal",{detail:t.detail}))),this.peerConnection.addEventListener("datachannel",t=>{this.handleDataChannelEvent(t)})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},CL=class extends Y2{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){Vfe.trace("renegotiate"),this.dispatchEvent(new ve("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(let n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];let t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),Vfe.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new ve("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){if(this.peerConnection.remoteDescription==null||this.peerConnection.remoteDescription.type==null){this.iceCandidates.push(e);return}await super.handleCandidate(e)}};var $fe=C(r9(),1);var qUe=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function HUe(r,e,t){let n,i=new Promise((o,s)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");let a=[e].flat(),c=[],{addListener:u,removeListener:l}=qUe(r),f=(...d)=>{let p=t.multiArgs?d:d[0];t.filter&&!t.filter(p)||(c.push(p),t.count===c.length&&(n(),o(c)))},h=d=>{n(),s(d)};n=()=>{for(let d of a)l(d,f);for(let d of t.rejectionEvents)l(d,h)};for(let d of a)u(d,f);for(let d of t.rejectionEvents)u(d,h);t.resolveImmediately&&o(c)});if(i.cancel=n,typeof t.timeout=="number"){let o=Ih(i,t.timeout);return o.cancel=n,o}return i}function Kfe(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=HUe(r,e,t),i=n.then(o=>o[0]);return i.cancel=n.cancel,i}var qfe=C(RL(),1);var PL=ue("libp2p:webrtc-peer:initator"),GUe=1e3,J5=class extends c0{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??Ee((0,$fe.default)(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new kL({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",t=>{this.dispatchEvent(new ve("signal",{detail:t.detail}))})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},kL=class extends Y2{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",t=>{if(t.candidate==null)return;let n={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};PL.trace("create candidate",n),this.dispatchEvent(new ve("signal",{detail:n})),this.dispatchEvent(new ve("ice-candidate"))})}async handleRenegotiate(){if(this.status==="negotiating"){this.log("already negotiating, queueing");return}this.status="negotiating";let e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await Kfe(this,"ice-candidate"),await(0,qfe.default)(GUe),PL.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new ve("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){PL.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}};var NL=ue("libp2p:webrtc-star:socket");function i9(r,e){let{sink:t,source:n}=r,i={remoteAddr:e.remoteAddr,async sink(o){e.signal!=null&&(o=sa(o,e.signal));try{await t(o)}catch(s){s.type!=="aborted"&&NL.error(s)}},source:e.signal!=null?sa(n,e.signal):n,timeline:{open:Date.now()},async close(){if(r.closed)return;let o=Date.now(),s=setTimeout(()=>{if(i.remoteAddr!=null){let{host:a,port:c}=i.remoteAddr.toOptions();NL("timeout closing socket to %s:%s after %dms, destroying it manually",a,c,Date.now()-o)}r.closed||r.close().catch(a=>{NL.error("could not close socket",a)})},2e3);try{await r.close()}finally{clearTimeout(s)}}};return r.addEventListener("close",()=>{i.timeline.close==null&&(i.timeline.close=Date.now())},{once:!0}),i}function o9(r){let e=r.toString().split("/"),t=r.protos()[1].name,n=r.protos()[2].name,i=r.stringTuples()[1][1];if(t!=="tcp"||n!=="ws"&&n!=="wss")throw new Error(`invalid multiaddr: ${r.toString()}`);if(!sie(r))return`http://${e[2]}:${e[4]}`;if(n==="ws")return`http://${e[2]}${i==null||i==="80"?"":`:${i}`}`;if(n==="wss")return`https://${e[2]}${i==null||i==="443"?"":`:${i}`}`;throw new Error("invalid multiaddr: "+r.toString())}function Hfe(r){let e="/libp2p-webrtc-star";if(r.startsWith(e)){r=r.substring(e.length,r.length);let t=lt(r),n=t.stringTuples().filter(i=>i[0]===421)[0];if(n[1]==null)throw new Error("invalid multiaddr: "+r);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${n[1]}`),r=t.toString()}return r}var Gi=ue("libp2p:webrtc-star:listener"),WUe={transports:["websocket"],path:"/socket.io-next/"},DL=class extends Zt{constructor(e,t,n,i,o){super(),this.signallingAddr=t,this.socket=Q5(e,WUe),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=i,this.channelOptions=o,this.handleWsHandshake=this.handleWsHandshake.bind(this);let s=!1;this.socket.on("connect_error",a=>{s&&a.type==="TransportError"||this.dispatchEvent(new ve("error",{detail:a}))}),this.socket.on("error",a=>{this.dispatchEvent(new ve("error",{detail:a}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",a=>{this.dispatchEvent(new ve("peer",{detail:a}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),s&&this.dispatchEvent(new ve("reconnect"))}),this.socket.once("connect",()=>{s=!0,this.dispatchEvent(new ve("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new ve("disconnect"))})}_createChannel(e,t,n){let i={...this.channelOptions},o=new Z5(i),s=a=>{let c=a.detail;Gi.error("incoming connection errored",c)};return o.addEventListener("error",s),o.addEventListener("close",()=>{o.removeEventListener("error",s)},{once:!0}),o.addEventListener("signal",a=>{let c=a.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:c})}),o.addEventListener("ready",()=>{let a=i9(o,{remoteAddr:this.signallingAddr});Gi("new inbound connection %s",a.remoteAddr);try{this.upgrader.upgradeInbound(a).then(c=>{Gi("inbound connection %s upgraded",a.remoteAddr),this.connections.push(a);let u=()=>{this.connections=this.connections.filter(l=>l!==a),this.channels.delete(e),this.pendingSignals.delete(e)};o.addEventListener("close",u,{once:!0}),this.dispatchEvent(new ve("connection",{detail:c})),this.handler(c)}).catch(c=>{Gi.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Gi.error("inbound connection failed to close after failing to upgrade",u)})})}catch(c){Gi.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Gi.error("inbound connection failed to close after failing to upgrade",u)})}},{once:!0}),o}handleWsHandshake(e){if(Gi('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;let t=e.intentId,n=this.pendingSignals.get(t);n==null&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let i=this.channels.get(t);if(i==null){if(e.signal.type!=="offer"){Gi("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}Gi("creating new channel to handle offer handshake"),i=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,i)}else Gi("channel already exists, using it to handle handshake");for(;n.length>0;){let o=n.shift();(o==null?void 0:o.signal)!=null&&i.handleSignal(o.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>await e.close()),...Array.from(this.channels.values()).map(async e=>await e.close())]),this.dispatchEvent(new ve("close"))}},OL=class extends Zt{constructor(e,t,n,i,o){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=i,this.options=o}async listen(e){if(this.listeningAddr!=null)throw(0,jfe.default)(new Error("listener already in use"),"ERR_ALREADY_LISTENING");let t=io();this.listeningAddr=e;let n;e.protoCodes().includes(421)?n=e:n=e.encapsulate(`/p2p/${this.peerId.toString()}`);let i=this.signallingUrl=o9(e);Gi("connecting to signalling server on: %s",this.signallingUrl);let o=new DL(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return o.addEventListener("error",s=>{let a=s.detail;Gi("error connecting to signalling server %o",a),o.close().catch(c=>{Gi.error("error closing server after error",c)}),t.reject(a)}),o.addEventListener("listening",()=>{Gi("connected to signalling server"),this.dispatchEvent(new ve("listening")),t.resolve()}),o.addEventListener("peer",s=>{this.transport.peerDiscovered(s.detail)}),o.addEventListener("connection",s=>{let a=s.detail;if(a.remoteAddr==null)try{a.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${a.remotePeer.toString()}`)}catch(c){Gi.error("could not determine remote address",c)}this.dispatchEvent(new ve("connection",{detail:a}))}),o.addEventListener("disconnect",()=>{this.transport.sigServers.delete(i)}),o.addEventListener("reconnect",()=>{this.transport.sigServers.set(i,o)}),this.transport.sigServers.set(this.signallingUrl,o),await t.promise}async close(){if(this.signallingUrl!=null){let e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new ve("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}};function Wfe(r,e,t,n,i){return new OL(r,e,t,n,i)}var Xfe=C(r9(),1);var LL=Symbol.for("@libp2p/peer-id");function u0(r){return r!=null&&!!r[LL]}var YUe=Symbol.for("nodejs.util.inspect.custom"),Yfe=Object.values(If).map(r=>r.decoder).reduce((r,e)=>r.or(e),If.identity.decoder),Qfe=114,BL=36,ML=37,e4=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[LL](){return!0}toString(){return this.string==null&&(this.string=tt.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return ce.createV1(Qfe,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return rr(this.multihash.bytes,e);if(typeof e=="string")return xt(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return rr(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[YUe](){return`PeerId(${this.toString()})`}},l0=class extends e4{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},f0=class extends e4{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},d0=class extends e4{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function xn(r){if(r.type==="RSA")return new l0(r);if(r.type==="Ed25519")return new f0(r);if(r.type==="secp256k1")return new d0(r);throw new We("Not a PeerId","ERR_INVALID_PARAMETERS")}function xt(r,e){if(e=e??Yfe,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=Jn(tt.decode(`z${r}`));return r.startsWith("12D")?new f0({multihash:t}):r.startsWith("16U")?new d0({multihash:t}):new l0({multihash:t})}return Wd(Yfe.decode(r))}function Wd(r){try{let e=Jn(r);if(e.code===Ns.code){if(e.digest.length===BL)return new f0({multihash:e});if(e.digest.length===ML)return new d0({multihash:e})}if(e.code===mr.code)return new l0({multihash:e})}catch{return QUe(ce.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function QUe(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==Qfe)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===mr.code)return new l0({multihash:r.multihash});if(e.code===Ns.code){if(e.digest.length===BL)return new f0({multihash:r.multihash});if(e.digest.length===ML)return new d0({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function Yd(r,e){return r.length===BL?new f0({multihash:Ec(Ns.code,r),privateKey:e}):r.length===ML?new d0({multihash:Ec(Ns.code,r),privateKey:e}):new l0({multihash:await mr.digest(r),publicKey:r,privateKey:e})}var s9=Symbol.for("@libp2p/transport");var Qd;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Qd||(Qd={}));var a9=Symbol.for("@libp2p/peer-discovery");var ZUe="RTCPeerConnection"in globalThis,h0=ue("libp2p:webrtc-star"),JUe=()=>{},UL=class extends Zt{constructor(){super(...arguments),this.started=!1}get[a9](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}},c9=class{constructor(e){(e==null?void 0:e.wrtc)!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new UL,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[s9](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){let n=await this._connect(e,t),i=i9(n,{remoteAddr:e,signal:t.signal});h0("new outbound connection %s",i.remoteAddr);let o=await t.upgrader.upgradeOutbound(i);return h0("outbound connection %s upgraded",i.remoteAddr),o}async _connect(e,t){var s;if(((s=t.signal)==null?void 0:s.aborted)===!0)throw new Gd;let n={...t.channelOptions??{}};this.wrtc!=null&&(n.wrtc=this.wrtc);let i=e.toOptions(),o=Ee((0,Xfe.default)(36),"hex");return await new Promise((a,c)=>{var w;let u=this.sigServers.get(o9(e));if((u==null?void 0:u.socket)==null)return c((0,t4.default)(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let l=!1;h0("dialing %s:%s",i.host,i.port);let f=new J5(n),h=_=>{let x=_.detail;if(!l){let m=`connection error ${i.host}:${i.port}: ${x.message}`;h0.error(m),g(x)}},d=()=>{l=!0,h0("connection opened %s:%s",i.host,i.port),g()},p=()=>{h0.error("connection aborted %s:%s",i.host,i.port),f.close().finally(()=>{g(new Gd)})},g=_=>{var x;f.removeEventListener("ready",d),(x=t.signal)==null||x.removeEventListener("abort",p),_==null?a(f):c(_)};f.addEventListener("ready",d,{once:!0}),f.addEventListener("close",()=>{f.removeEventListener("error",h)}),(w=t.signal)==null||w.addEventListener("abort",p),f.addEventListener("signal",_=>{let x=_.detail;u.socket.emit("ss-handshake",{intentId:o,srcMultiaddr:u.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:x})}),u.socket.on("ws-handshake",_=>{_.intentId===o&&_.err!=null&&f.close().finally(()=>{c((0,t4.default)(new Error(_.err),"ERR_SIGNALLING_FAILED"))}),!(_.intentId!==o||_.answer==null||f.closed)&&f.handleSignal(_.signal)})})}createListener(e){if(!ZUe&&this.wrtc==null)throw(0,t4.default)(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw(0,t4.default)(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return Wfe(e.upgrader,e.handler??JUe,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(290)?!1:Gv.matches(t))}peerDiscovered(e){h0("peer discovered: %s",e),e=Hfe(e);let t=lt(e),n=t.getPeerId();if(n==null)return;let i=xt(n);this._discovery.dispatchEvent(new ve("peer",{detail:{id:i,multiaddrs:[t],protocols:[]}}))}};function Zfe(r={}){let e=new c9(r);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}function Jfe(){let r=Zfe();return{transports:[r.transport],peerDiscovery:[r.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}function Cl(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}var n4=C(ee(),1);var Rt;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.DHT_DISABLED="DHT is not available",r.PUBSUB_DISABLED="PubSub is not available",r.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",r.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",r.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",r.NOT_FOUND="Not found"})(Rt||(Rt={}));var q;(function(r){r.DHT_DISABLED="ERR_DHT_DISABLED",r.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",r.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",r.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",r.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",r.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",r.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",r.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",r.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",r.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",r.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",r.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",r.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",r.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",r.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",r.ERR_DIALED_SELF="ERR_DIALED_SELF",r.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",r.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",r.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",r.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",r.ERR_INVALID_KEY="ERR_INVALID_KEY",r.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_PEER="ERR_INVALID_PEER",r.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",r.ERR_NOT_FOUND="ERR_NOT_FOUND",r.ERR_TIMEOUT="ERR_TIMEOUT",r.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",r.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",r.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",r.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",r.ERR_FIND_SELF="ERR_FIND_SELF",r.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",r.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",r.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",r.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",r.ERR_INVALID_CMS="ERR_INVALID_CMS",r.ERR_MISSING_KEYS="ERR_MISSING_KEYS",r.ERR_NO_KEY="ERR_NO_KEY",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",r.ERR_INVALID_RECORD="ERR_INVALID_RECORD",r.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",r.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED"})(q||(q={}));var ede=C(ee(),1);async function*r4(r,e){yield*Bi(r,async t=>(await e.addressBook.add(t.id,t.multiaddrs),t))}function u9(r){let e=new Set;return Yt(r,t=>e.has(t.id.toString())?!1:(e.add(t.id.toString()),!0))}async function*l9(r,e=1){let t=0;for await(let n of r)t++,yield n;if(t<e)throw(0,ede.default)(new Error("not found"),"NOT_FOUND")}var nde=C(Kn(),1);var d9=C(FL(),1),ide=C(xi(),1),rde=ue("libp2p:peer-routing"),f9=class{constructor(e,t){this.components=e,this.routers=t.routers??[],this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||this.routers.length===0||this.timeoutId!=null||this.refreshManagerInit.enabled===!1||(this.timeoutId=(0,d9.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){var e,t;if(this.abortController==null)try{this.abortController=new nde.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(e=ide.setMaxListeners)==null||e(1/0,this.abortController.signal)}catch{}await on(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(n){rde.error(n)}finally{(t=this.abortController)==null||t.clear(),this.abortController=void 0}}async stop(){var e;(0,d9.clearDelayedInterval)(this.timeoutId),(e=this.abortController)==null||e.abort(),this.started=!1}async findPeer(e,t){if(this.routers.length===0)throw(0,n4.default)(new Error("No peer routers available"),q.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw(0,n4.default)(new Error("Should not try to find self"),q.ERR_FIND_SELF);let n=await Ne(Qo(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(o){rde.error(o)}}())),i=>Yt(i,Boolean),i=>r4(i,this.components.peerStore),async i=>await Fi(i));if(n!=null)return n;throw(0,n4.default)(new Error(Rt.NOT_FOUND),q.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(this.routers.length===0)throw(0,n4.default)(new Error("No peer routers available"),q.ERR_NO_ROUTERS_AVAILABLE);yield*Ne(Qo(...this.routers.map(n=>n.getClosestPeers(e,t))),n=>r4(n,this.components.peerStore),n=>u9(n),n=>l9(n))}};var Xd=C(ee(),1);var h9=class{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw(0,Xd.default)(new Error("No content this.routers available"),q.ERR_NO_ROUTERS_AVAILABLE);yield*Ne(Qo(...this.routers.map(n=>n.findProviders(e,t))),n=>r4(n,this.components.peerStore),n=>u9(n),n=>l9(n))}async provide(e,t={}){if(this.routers.length===0)throw(0,Xd.default)(new Error("No content routers available"),q.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async n=>await n.provide(e,t)))}async put(e,t,n){if(!this.isStarted())throw(0,Xd.default)(new Error(Rt.NOT_STARTED_YET),q.DHT_NOT_STARTED);let i=this.components.dht;i!=null&&await on(i.put(e,t,n))}async get(e,t){if(!this.isStarted())throw(0,Xd.default)(new Error(Rt.NOT_STARTED_YET),q.DHT_NOT_STARTED);let n=this.components.dht;if(n!=null){for await(let i of n.get(e,t))if(i.name==="VALUE")return i.value}throw(0,Xd.default)(new Error(Rt.NOT_FOUND),q.ERR_NOT_FOUND)}async*getMany(e,t,n){if(!this.isStarted())throw(0,Xd.default)(new Error(Rt.NOT_STARTED_YET),q.DHT_NOT_STARTED);if(t==null||t===0)return;let i=0,o=this.components.dht;if(o!=null){for await(let s of o.get(e,n))if(s.name==="VALUE"&&(yield{from:s.from,val:s.value},i++,i===t))break}if(i===0)throw(0,Xd.default)(new Error(Rt.NOT_FOUND),q.ERR_NOT_FOUND)}};var iFe=r=>r,p9=class extends Zt{constructor(e,t){super();let{listen:n=[],announce:i=[]}=t;this.components=e,this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.observed=new Set,this.announceFilter=t.announceFilter??iFe}getListenAddrs(){return Array.from(this.listen).map(e=>lt(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>lt(e))}getObservedAddrs(){return Array.from(this.observed).map(e=>lt(e))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=lt(e),n=t.getPeerId();n!=null&&xt(n).equals(this.components.peerId)&&(t=t.decapsulate(lt(`/p2p/${this.components.peerId.toString()}`)));let i=t.toString();this.observed.has(i)||(this.observed.add(i),this.dispatchEvent(new ve("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map(n=>n.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(n=>n.toString())),e=e.concat(this.getObservedAddrs().map(n=>n.toString()));let t=new Set(e);return this.announceFilter(Array.from(t).map(n=>lt(n))).map(n=>{var i;return((i=n.protos().pop())==null?void 0:i.path)===!0||n.getPeerId()===this.components.peerId.toString()?n:n.encapsulate(`/p2p/${this.components.peerId.toString()}`)})}};var E9=C(ee(),1);var ode=ue("libp2p:connection-manager:latency-monitor:visibility-change-emitter"),m9=class extends Zt{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",globalThis.document!=null&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";typeof globalThis.document.hidden<"u"?(e="hidden",t="visibilitychange"):typeof globalThis.document.mozHidden<"u"?(e="mozHidden",t="mozvisibilitychange"):typeof globalThis.document.msHidden<"u"?(e="msHidden",t="msvisibilitychange"):typeof globalThis.document.webkitHidden<"u"&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){typeof globalThis.document.addEventListener>"u"||typeof document[this.hidden]>"u"?ode("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(!(this.hidden===void 0||document[this.hidden]===void 0))return document[this.hidden]==null}_handleVisibilityChange(){let e=globalThis.document[this.hidden]===!1;ode(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new ve("visibilityChange",{detail:e}))}};var Pl=ue("libp2p:connection-manager:latency-monitor"),g9=class extends Zt{constructor(e={}){var s,a;super();let{latencyCheckIntervalMs:t,dataEmitIntervalMs:n,asyncTestFn:i,latencyRandomPercentage:o}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=o??10,this.latencyCheckMultiply=2*(this.latencyRandomPercentage/100)*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=n===null||n===0?void 0:n??5*1e3,Pl("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),this.dataEmitIntervalMs!=null?Pl("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):Pl("Not emitting summaries"),this.asyncTestFn=i,((s=globalThis.process)==null?void 0:s.hrtime)!=null?(Pl("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=c=>{let u=this.now(c);return u[0]*1e3+u[1]/1e6}):typeof window<"u"&&((a=window.performance)==null?void 0:a.now)!=null?(Pl("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=c=>Math.round(this.now()-c)):(Pl("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=c=>this.now()-c),this.latencyData=this.initLatencyData()}start(){var e;oFe()&&(this.visibilityChangeEmitter=new m9,this.visibilityChangeEmitter.addEventListener("visibilityChange",t=>{let{detail:n}=t;n?this._startTimers():(this._emitSummary(),this._stopTimers())})),((e=this.visibilityChangeEmitter)==null?void 0:e.isVisible())===!0&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){this.checkLatencyID==null&&(this.checkLatency(),this.dataEmitIntervalMs!=null&&(this.emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this.emitIntervalID.unref=="function"&&this.emitIntervalID.unref()))}_stopTimers(){this.checkLatencyID!=null&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),this.emitIntervalID!=null&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){let e=this.getSummary();e.events>0&&this.dispatchEvent(new ve("data",{detail:e}))}getSummary(){let e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),Pl.trace("Summary: %O",e),e}checkLatency(){let e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},n=()=>{if(this.checkLatencyID==null)return;let i=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,i),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,i),this.latencyData.totalMs+=i,Pl.trace("MS: %s Data: %O",i,this.latencyData)};Pl.trace("localData: %O",t),this.checkLatencyID=setTimeout(()=>{this.asyncTestFn!=null?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(n)):(t.deltaOffset-=1,n())},t.deltaOffset),typeof this.checkLatencyID.unref=="function"&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}};function oFe(){return typeof globalThis.window<"u"}var v9=C(xi(),1);var y9="OPEN",zL="CLOSING",w9="CLOSED";function kl(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}var i4=class{constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return kl(this.map.entries(),e=>[xt(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,xt(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return kl(this.map.keys(),e=>xt(e))}values(){return this.map.values()}get size(){return this.map.size}};var Nl=class{constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return kl(this.set.entries(),e=>{let t=xt(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=xt(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return kl(this.set.values(),e=>xt(e))}intersection(e){let t=new Nl;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new Nl;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new Nl;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};var X2=class{constructor(e){if(this.list=[],e!=null)for(let t of e)this.list.push(t.toString())}[Symbol.iterator](){return kl(this.list.entries(),e=>xt(e[1]))}concat(e){let t=new X2(this);for(let n of e)t.push(n);return t}entries(){return kl(this.list.entries(),e=>[e[0],xt(e[1])])}every(e){return this.list.every((t,n)=>e(xt(t),n,this))}filter(e){let t=new X2;return this.list.forEach((n,i)=>{let o=xt(n);e(o,i,this)&&t.push(o)}),t}find(e){let t=this.list.find((n,i)=>e(xt(n),i,this));if(t!=null)return xt(t)}findIndex(e){return this.list.findIndex((t,n)=>e(xt(t),n,this))}forEach(e){this.list.forEach((t,n)=>{e(xt(t),n,this)})}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){let e=this.list.pop();if(e!=null)return xt(e)}push(...e){for(let t of e)this.list.push(t.toString())}shift(){let e=this.list.shift();if(e!=null)return xt(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)t=this.list.unshift(e[n].toString());return t}get length(){return this.list.length}};var tB=C(Kn(),1);var sde="keep-alive";var rhe=C(ehe(),1);var the=C(ee(),1);function _9(r){if(u0(r))return{peerId:r};if(as(r)){let e=r.getPeerId();return{multiaddr:r,peerId:e==null?void 0:xt(e)}}throw(0,the.default)(new Error(`${r} is not a PeerId or a Multiaddr`),q.ERR_INVALID_MULTIADDR)}var Ln=ue("libp2p:connection-manager"),KFe={maxConnections:1/0,minConnections:0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},$Fe=6e4,x9=class extends Zt{constructor(e,t){var n;if(super(),this.opts=et.call({ignoreUndefined:!0},KFe,t),this.opts.maxConnections<this.opts.minConnections)throw(0,E9.default)(new Error("Connection Manager maxConnections must be greater than minConnections"),q.ERR_INVALID_PARAMETERS);Ln("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,t.maxEventLoopDelay!=null&&t.maxEventLoopDelay>0&&t.maxEventLoopDelay!==1/0&&(this.latencyMonitor=new g9({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval}));try{(n=v9.setMaxListeners)==null||n(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??$Fe,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map(i=>lt(i)),this.deny=(t.deny??[]).map(i=>lt(i)),this.inboundConnectionRateLimiter=new rhe.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){var e,t,n,i,o;(e=this.components.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let s={inbound:0,outbound:0};for(let a of this.connections.values())for(let c of a)c.stat.direction==="inbound"?s.inbound++:s.outbound++;return s}}),(t=this.components.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let s={};for(let a of this.connections.values())for(let c of a)for(let u of c.streams){let l=`${u.stat.direction} ${u.stat.protocol??"unnegotiated"}`;s[l]=(s[l]??0)+1}return s}}),(n=this.components.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let s={};for(let c of this.connections.values())for(let u of c){let l={};for(let f of u.streams){let h=`${f.stat.direction} ${f.stat.protocol??"unnegotiated"}`;l[h]=(l[h]??0)+1}for(let[f,h]of Object.entries(l))s[f]=s[f]??[],s[f].push(h)}let a={};for(let[c,u]of Object.entries(s)){u=u.sort((f,h)=>f-h);let l=Math.floor(u.length*.9);a[c]=u[l]}return a}}),(i=this.latencyMonitor)==null||i.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),(o=this.latencyMonitor)==null||o.addEventListener("data",this._onLatencyMeasure),this.started=!0,Ln("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then(async()=>{var t,n;let e=[];for(let i of await this.components.peerStore.all())(await this.components.peerStore.getTags(i.id)).filter(a=>a.name===sde).length>0&&e.push(i.id);(t=this.connectOnStartupController)==null||t.clear(),this.connectOnStartupController=new tB.TimeoutController(this.startupReconnectTimeout);try{(n=v9.setMaxListeners)==null||n(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map(async i=>{var o;await this.openConnection(i,{signal:(o=this.connectOnStartupController)==null?void 0:o.signal}).catch(s=>{Ln.error(s)})}))}).catch(e=>{Ln.error(e)}).finally(()=>{var e;(e=this.connectOnStartupController)==null||e.clear()})}async beforeStop(){var e;(e=this.connectOnStartupController)==null||e.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){var e,t;(e=this.latencyMonitor)==null||e.removeEventListener("data",this._onLatencyMeasure),(t=this.latencyMonitor)==null||t.stop(),this.started=!1,await this._close(),Ln("stopped")}async _close(){let e=[];for(let t of this.connections.values())for(let n of t)e.push((async()=>{try{await n.close()}catch(i){Ln.error(i)}})());Ln("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}onConnect(e){this._onConnect(e).catch(t=>{Ln.error(t)})}async _onConnect(e){let{detail:t}=e;if(!this.started){await t.close();return}let n=t.remotePeer,i=n.toString(),o=this.connections.get(i);o!=null?o.push(t):this.connections.set(i,[t]),n.publicKey!=null&&await this.components.peerStore.keyBook.set(n,n.publicKey);let s=this.getConnections().length,a=s-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",s,a),this.dispatchEvent(new ve("peer:connect",{detail:t}))}onDisconnect(e){let{detail:t}=e;if(!this.started)return;let n=t.remotePeer.toString(),i=this.connections.get(n);i!=null&&i.length>1?(i=i.filter(o=>o.id!==t.id),this.connections.set(n,i)):i!=null&&(this.connections.delete(n),this.dispatchEvent(new ve("peer:disconnect",{detail:t})))}getConnections(e){if(e!=null)return this.connections.get(e.toString())??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}async openConnection(e,t={}){var s;let{peerId:n,multiaddr:i}=_9(e);if(n==null&&i==null)throw(0,E9.default)(new TypeError("Can only open connections to PeerIds or Multiaddrs"),q.ERR_INVALID_PARAMETERS);if(n!=null){Ln("dial to",n);let a=this.getConnections(n);if(a.length>0)return Ln("had an existing connection to %p",n),a[0]}let o;if((t==null?void 0:t.signal)==null){o=new tB.TimeoutController(this.dialTimeout),t.signal=o.signal;try{(s=v9.setMaxListeners)==null||s(1/0,o.signal)}catch{}}try{let a=await this.components.dialer.dial(e,t),c=this.connections.get(a.remotePeer.toString());c==null&&(c=[],this.connections.set(a.remotePeer.toString(),c));let u=!1;for(let l of c)l.id===a.id&&(u=!0);return u||c.push(a),a}finally{o!=null&&o.clear()}}async closeConnections(e){let t=this.connections.get(e.toString())??[];await Promise.all(t.map(async n=>await n.close()))}getAll(e){if(!u0(e))throw(0,E9.default)(new Error("peerId must be an instance of peer-id"),q.ERR_INVALID_PARAMETERS);let t=e.toString(),n=this.connections.get(t);return n!=null?n.filter(i=>i.stat.status===y9):[]}_onLatencyMeasure(e){let{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch(n=>{Ln.error(n)})}async _checkMaxLimit(e,t,n=1){let i=this.opts[e];if(i==null){Ln.trace("limit %s was not set so it cannot be applied",e);return}Ln.trace("checking limit of %s. current value: %d of %d",e,t,i),t>i&&(Ln("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,i,n),await this._pruneConnections(n))}async _pruneConnections(e){let t=this.getConnections(),n=new i4;for(let s of t){let a=s.remotePeer;if(n.has(a))continue;let c=await this.components.peerStore.getTags(a);n.set(a,c.reduce((u,l)=>u+l.value,0))}let i=t.sort((s,a)=>{let c=n.get(s.remotePeer)??0,u=n.get(a.remotePeer)??0;if(c>u)return 1;if(c<u)return-1;let l=s.stat.timeline.open,f=a.stat.timeline.open;return l<f?1:l>f?-1:0}),o=[];for(let s of i)if(Ln("too many connections open - closing a connection to %p",s.remotePeer),o.push(s),o.length===e)break;await Promise.all(o.map(async s=>{try{await s.close()}catch(a){Ln.error(a)}this.onDisconnect(new ve("connectionEnd",{detail:s}))}))}async acceptIncomingConnection(e){if(this.deny.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return Ln("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>e.remoteAddr.toString().startsWith(i.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return Ln("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return Ln("connection from %s refused - inboundConnectionThreshold exceeded by host %s",i,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(Ln("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}};var rB=C(vI(),1);var Zd=ue("libp2p:connection-manager:auto-dialler"),qFe={enabled:!0,minConnections:0,autoDialInterval:1e4},S9=class{constructor(e,t){this.components=e,this.options=et.call({ignoreUndefined:!0},qFe,t),this.running=!1,this._autoDial=this._autoDial.bind(this),Zd("options: %j",this.options)}isStarted(){return this.running}async start(){if(!this.options.enabled){Zd("not enabled");return}this.running=!0,this._autoDial().catch(e=>{Zd.error("could start autodial",e)}),Zd("started")}async stop(){if(!this.options.enabled){Zd("not enabled");return}this.running=!1,this.autoDialTimeout!=null&&this.autoDialTimeout.clear(),Zd("stopped")}async _autoDial(){this.autoDialTimeout!=null&&this.autoDialTimeout.clear();let e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e){this.autoDialTimeout=(0,rB.default)(this._autoDial,this.options.autoDialInterval);return}let t=await this.components.peerStore.all(),n=await Ne(t.sort(()=>Math.random()>.5?1:-1),i=>Yt(i,o=>!o.id.equals(this.components.peerId)),i=>Id(i,(o,s)=>s.protocols.length>o.protocols.length||s.id.publicKey!=null&&o.id.publicKey==null?1:-1),async i=>await Wo(i));for(let i=0;this.running&&i<n.length&&this.components.connectionManager.getConnections().length<e;i++){if(!this.running)return;let o=n[i];if(this.components.connectionManager.getConnections(o.id).length===0){Zd("connecting to a peerStore stored peer %p",o.id);try{await this.components.connectionManager.openConnection(o.id)}catch(s){Zd.error("could not connect to peerStore stored peer",s)}}}this.running&&(this.autoDialTimeout=(0,rB.default)(this._autoDial,this.options.autoDialInterval))}};var mhe=C(ee(),1);var nB=C(q6(),1),nhe=C(BA(),1),iB=C(K6(),1),ihe=C(DA(),1),ohe=C(Du(),1);function HFe(){ohe.default._configure(),nB.default._configure(nhe.default),iB.default._configure(ihe.default)}HFe();var she=["uint64","int64","sint64","fixed64","sfixed64"];function GFe(r){for(let e of she){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function oB(r){return GFe(new nB.default(r))}function jFe(r){for(let e of she){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function sB(){return jFe(iB.default.create())}function Ir(r,e){let t=oB(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function Rr(r,e){let t=sB();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var rg;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(rg||(rg={}));function A9(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Jd(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let t=function(o,s){let a=e(o);s.int32(a)},n=function(o){let s=o.int32();return e(s)};return A9("enum",rg.VARINT,t,n)}function Cr(r,e){return A9("message",rg.LENGTH_DELIMITED,r,e)}var ft;(function(r){let e;(function(a){a.SUCCESS="SUCCESS",a.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",a.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",a.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",a.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",a.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",a.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",a.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",a.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",a.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",a.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",a.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",a.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",a.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",a.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",a.MALFORMED_MESSAGE="MALFORMED_MESSAGE"})(e=r.Status||(r.Status={}));let t;(function(a){a[a.SUCCESS=100]="SUCCESS",a[a.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",a[a.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",a[a.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",a[a.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",a[a.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",a[a.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",a[a.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",a[a.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",a[a.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",a[a.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",a[a.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",a[a.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",a[a.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",a[a.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",a[a.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"})(t||(t={})),function(a){a.codec=()=>Jd(t)}(e=r.Status||(r.Status={}));let n;(function(a){a.HOP="HOP",a.STOP="STOP",a.STATUS="STATUS",a.CAN_HOP="CAN_HOP"})(n=r.Type||(r.Type={}));let i;(function(a){a[a.HOP=1]="HOP",a[a.STOP=2]="STOP",a[a.STATUS=3]="STATUS",a[a.CAN_HOP=4]="CAN_HOP"})(i||(i={})),function(a){a.codec=()=>Jd(i)}(n=r.Type||(r.Type={}));let o;(function(a){let c;a.codec=()=>(c==null&&(c=Cr((u,l,f={})=>{if(f.lengthDelimited!==!1&&l.fork(),(f.writeDefaults===!0||u.id!=null&&u.id.byteLength>0)&&(l.uint32(10),l.bytes(u.id)),u.addrs!=null)for(let h of u.addrs)l.uint32(18),l.bytes(h);f.lengthDelimited!==!1&&l.ldelim()},(u,l)=>{let f={id:new Uint8Array(0),addrs:[]},h=l==null?u.len:u.pos+l;for(;u.pos<h;){let d=u.uint32();switch(d>>>3){case 1:f.id=u.bytes();break;case 2:f.addrs.push(u.bytes());break;default:u.skipType(d&7);break}}return f})),c),a.encode=u=>Rr(u,a.codec()),a.decode=u=>Ir(u,a.codec())})(o=r.Peer||(r.Peer={}));let s;r.codec=()=>(s==null&&(s=Cr((a,c,u={})=>{u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.Type.codec().encode(a.type,c)),a.srcPeer!=null&&(c.uint32(18),r.Peer.codec().encode(a.srcPeer,c,{writeDefaults:!1})),a.dstPeer!=null&&(c.uint32(26),r.Peer.codec().encode(a.dstPeer,c,{writeDefaults:!1})),a.code!=null&&(c.uint32(32),r.Status.codec().encode(a.code,c)),u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={},l=c==null?a.len:a.pos+c;for(;a.pos<l;){let f=a.uint32();switch(f>>>3){case 1:u.type=r.Type.codec().decode(a);break;case 2:u.srcPeer=r.Peer.codec().decode(a,a.uint32());break;case 3:u.dstPeer=r.Peer.codec().decode(a,a.uint32());break;case 4:u.code=r.Status.codec().decode(a);break;default:a.skipType(f&7);break}}return u})),s),r.encode=a=>Rr(a,r.codec()),r.decode=a=>Ir(a,r.codec())})(ft||(ft={}));var WFe=ue("libp2p:stream:converter");function aB(r,e={}){let{stream:t,remoteAddr:n}=r,{sink:i,source:o}=t,s=async function*(){for await(let u of o)yield*u}(),a={async sink(u){e.signal!=null&&(u=sa(u,e.signal));try{await i(u),await c()}catch(l){l.type!=="aborted"&&WFe(l)}},source:e.signal!=null?sa(s,e.signal):s,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await i(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return a.timeline.close==null&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}var mu="/libp2p/circuit/relay/0.1.0";function ahe(r){let e=new Map;async function t(o){let s=o.toString().split("/p2p-circuit").find(h=>h!==""),a=lt(s),c=a.getPeerId();if(c==null)throw new Error("Could not determine relay peer from multiaddr");let u=xt(c);await r.peerStore.addressBook.add(u,[a]);let l=await r.connectionManager.openConnection(u),f=l.remoteAddr.encapsulate("/p2p-circuit");e.set(l.remotePeer.toString(),f),i.dispatchEvent(new ve("listening"))}function n(){let o=[];for(let s of e.values())o.push(s);return o}let i=Object.assign(new Zt,{close:async()=>await Promise.resolve(),listen:t,getAddrs:n});return r.connectionManager.addEventListener("peer:disconnect",o=>{let{detail:s}=o;e.delete(s.remotePeer.toString())&&i.dispatchEvent(new ve("close"))}),i}var uB=C(ee(),1);function che(r,e){r.write({type:ft.Type.STATUS,code:e})}function T9(r,e){var t,n;try{((t=r.dstPeer)==null?void 0:t.addrs)!=null&&r.dstPeer.addrs.forEach(i=>lt(i))}catch(i){throw che(e,r.type===ft.Type.HOP?ft.Status.HOP_DST_MULTIADDR_INVALID:ft.Status.STOP_DST_MULTIADDR_INVALID),i}try{((n=r.srcPeer)==null?void 0:n.addrs)!=null&&r.srcPeer.addrs.forEach(i=>lt(i))}catch(i){throw che(e,r.type===ft.Type.HOP?ft.Status.HOP_SRC_MULTIADDR_INVALID:ft.Status.STOP_SRC_MULTIADDR_INVALID),i}}function cB(r){let e=async function*(){let t=yield,n=new ln;for await(let i of r){if(t==null){n.append(i),t=yield n,n=new ln;continue}for(n.append(i);n.length>=t;){let o=n.sublist(0,t);if(n.consume(t),t=yield o,t==null){n.length>0&&(t=yield n,n=new ln);break}}}if(t!=null)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}function ng(r){let e=jn(),t=cB(r.source),n=io(),i,o=r.sink(async function*(){yield*e,yield*await n.promise}());return o.catch(a=>{i=a}),{reader:t,writer:e,stream:{sink:async a=>i!=null?await Promise.reject(i):(n.resolve(a),await o),source:t},rest:()=>e.end(),write:e.push,read:async()=>{let a=await t.next();if(a.value!=null)return a.value}}}var a4=ue("libp2p:circuit:stream-handler"),Dl=class{constructor(e){let{stream:t,maxLength:n=4096}=e;this.stream=t,this.shake=ng(this.stream),this.decoder=Xr.fromReader(this.shake.reader,{maxDataLength:n})}async read(){let e=await this.decoder.next();if(e.value!=null){let t=ft.decode(e.value);return a4("read message type",t.type),t}a4("read received no value, closing stream"),this.close()}write(e){a4("write message type %s",e.type),this.shake.write(vn.single(ft.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){a4("closing the stream"),this.rest().sink([]).catch(e=>{a4.error(e)})}};var c4=ue("libp2p:circuit:stop");function uhe(r){let{connection:e,request:t,streamHandler:n}=r;try{T9(t,n)}catch(i){c4.error("invalid stop request via peer %p %o",e.remotePeer,i);return}return c4("stop request is valid"),n.write({type:ft.Type.STATUS,code:ft.Status.SUCCESS}),n.rest()}async function lhe(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(mu,{signal:n});c4("starting stop request to %p",e.remotePeer);let o=new Dl({stream:i});o.write(t);let s=await o.read();if(s==null){o.close();return}if(s.code===ft.Status.SUCCESS)return c4("stop request to %p was successful",e.remotePeer),o.rest();c4("stop request failed with code %d",s.code),o.close()}var ua=ue("libp2p:circuit:hop");async function fhe(r){let{connection:e,request:t,streamHandler:n,circuit:i,connectionManager:o}=r;if(!i.hopEnabled())return ua("HOP request received but we are not acting as a relay"),n.end({type:ft.Type.STATUS,code:ft.Status.HOP_CANT_SPEAK_RELAY});try{T9(t,n)}catch(f){ua.error("invalid hop request via peer %p %o",e.remotePeer,f);return}if(t.dstPeer==null){ua("HOP request received but we do not receive a dstPeer");return}let s=Wd(t.dstPeer.id),a=o.getConnections(s);if(a.length===0&&!i.hopActive())return ua("HOP request received but we are not connected to the destination peer"),n.end({type:ft.Type.STATUS,code:ft.Status.HOP_NO_CONN_TO_DST});if(a.length===0)return ua("did not have connection to remote peer"),n.end({type:ft.Type.STATUS,code:ft.Status.HOP_NO_CONN_TO_DST});let c={type:ft.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer},u;try{ua("performing STOP request");let f=await lhe({connection:a[0],request:c});if(f==null)throw new Error("Could not stop");u=f}catch(f){ua.error(f);return}ua("hop request from %p is valid",e.remotePeer),n.write({type:ft.Type.STATUS,code:ft.Status.SUCCESS});let l=n.rest();return ua("creating related connections"),await Ne(l,u,l)}async function dhe(r){let{connection:e,request:t,signal:n}=r,i=await e.newStream(mu,{signal:n}),o=new Dl({stream:i});o.write(t);let s=await o.read();if(s==null)throw(0,uB.default)(new Error("HOP request had no response"),q.ERR_HOP_REQUEST_FAILED);if(s.code===ft.Status.SUCCESS)return ua("hop request was successful"),o.rest();throw ua("hop request failed with code %d, closing stream",s.code),o.close(),(0,uB.default)(new Error(`HOP request failed with code "${s.code??"unknown"}"`),q.ERR_HOP_REQUEST_FAILED)}async function hhe(r){let{connection:e,signal:t}=r,n=await e.newStream(mu,{signal:t}),i=new Dl({stream:n});i.write({type:ft.Type.CAN_HOP});let o=await i.read();return await i.close(),!(o==null||o.code!==ft.Status.SUCCESS)}function phe(r){let{connection:e,streamHandler:t,circuit:n}=r,i=n.hopEnabled();ua("can hop (%s) request from %p",i,e.remotePeer),t.end({type:ft.Type.STATUS,code:i?ft.Status.SUCCESS:ft.Status.HOP_CANT_SPEAK_RELAY})}var ghe=C(Kn(),1),yhe=C(xi(),1),la=ue("libp2p:circuit"),I9=class{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(mu,e=>{this._onProtocol(e).catch(t=>{la.error(t)})},{...this._init}).catch(e=>{la.error(e)}))}async stop(){await this.components.registrar.unhandle(mu)}hopEnabled(){return!0}hopActive(){return!0}get[s9](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){var o,s,a;let{connection:t,stream:n}=e,i=new ghe.TimeoutController(this._init.hop.timeout);try{(o=yhe.setMaxListeners)==null||o(1/0,i.signal)}catch{}try{let c=ps(n,i.signal),u=new Dl({stream:{...n,...c}}),l=await u.read();if(l==null){la("request was invalid, could not read from stream"),u.write({type:ft.Type.STATUS,code:ft.Status.MALFORMED_MESSAGE}),u.close();return}let f;switch(l.type){case ft.Type.CAN_HOP:{la("received CAN_HOP request from %p",t.remotePeer),await phe({circuit:this,connection:t,streamHandler:u});break}case ft.Type.HOP:{la("received HOP request from %p",t.remotePeer),await fhe({connection:t,request:l,streamHandler:u,circuit:this,connectionManager:this.components.connectionManager});break}case ft.Type.STOP:{la("received STOP request from %p",t.remotePeer),f=await uhe({connection:t,request:l,streamHandler:u});break}default:{la("Request of type %s not supported",l.type),u.write({type:ft.Type.STATUS,code:ft.Status.MALFORMED_MESSAGE}),u.close();return}}if(f!=null){let h=t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(lt((s=l.dstPeer)==null?void 0:s.addrs[0])),d=lt((a=l.srcPeer)==null?void 0:a.addrs[0]),p=aB({stream:f,remoteAddr:h,localAddr:d}),g=l.type===ft.Type.HOP?"relay":"inbound";la("new %s connection %s",g,p.remoteAddr);let w=await this.components.upgrader.upgradeInbound(p);la("%s connection %s upgraded",g,p.remoteAddr),this.handler!=null&&this.handler(w)}}finally{i.clear()}}async dial(e,t={}){let n=e.toString().split("/p2p-circuit"),i=lt(n[0]),o=lt(n[n.length-1]),s=i.getPeerId(),a=o.getPeerId();if(s==null||a==null){let d="Circuit relay dial failed as addresses did not have peer id";throw la.error(d),(0,mhe.default)(new Error(d),q.ERR_RELAYED_DIAL)}let c=xt(s),u=xt(a),l=!1,h=this.components.connectionManager.getConnections(c)[0];h==null&&(await this.components.peerStore.addressBook.add(c,[i]),h=await this.components.connectionManager.openConnection(c,t),l=!0);try{let d=await dhe({...t,connection:h,request:{type:ft.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map(w=>w.bytes)},dstPeer:{id:u.toBytes(),addrs:[lt(o).bytes]}}}),p=i.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),g=aB({stream:d,remoteAddr:e,localAddr:p});return la("new outbound connection %s",g.remoteAddr),await this.components.upgrader.upgradeOutbound(g)}catch(d){throw la.error("Circuit relay dial failed",d),l&&await h.close(),d}}createListener(e){return this.handler=e.handler,ahe({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>i0.matches(t))}};var B9=C(FL(),1);async function R9(r){let e=new TextEncoder().encode(r),t=await mr.digest(e);return ce.createV0(t)}var lB="hop_relay",fB="true",C9="/libp2p/relay";var vhe=C(dB(),1);var whe="[a-fA-F\\d:]",eh=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${whe})|(?<=${whe})(?=\\s|$))`:"",oc="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Bn="[a-fA-F\\d]{1,4}",P9=`
(?:
(?:${Bn}:){7}(?:${Bn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Bn}:){6}(?:${oc}|:${Bn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Bn}:){5}(?::${oc}|(?::${Bn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Bn}:){4}(?:(?::${Bn}){0,1}:${oc}|(?::${Bn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Bn}:){3}(?:(?::${Bn}){0,2}:${oc}|(?::${Bn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Bn}:){2}(?:(?::${Bn}){0,3}:${oc}|(?::${Bn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Bn}:){1}(?:(?::${Bn}){0,4}:${oc}|(?::${Bn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Bn}){0,5}:${oc}|(?::${Bn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),QFe=new RegExp(`(?:^${oc}$)|(?:^${P9}$)`),XFe=new RegExp(`^${oc}$`),ZFe=new RegExp(`^${P9}$`),hB=r=>r&&r.exact?QFe:new RegExp(`(?:${eh(r)}${oc}${eh(r)})|(?:${eh(r)}${P9}${eh(r)})`,"g");hB.v4=r=>r&&r.exact?XFe:new RegExp(`${eh(r)}${oc}${eh(r)}`,"g");hB.v6=r=>r&&r.exact?ZFe:new RegExp(`${eh(r)}${P9}${eh(r)}`,"g");var k9=hB;var xhe=C(_he(),1),{isValid:JFe,parse:eze}=xhe.default,tze=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],rze=tze.map(r=>new vhe.Netmask(r));function nze(r){for(let e of rze)if(e.contains(r))return!0;return!1}function Ehe(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}var She=r=>{if(JFe(r)){let e=eze(r);if(e.kind()==="ipv4")return nze(e.toNormalizedString());if(e.kind()==="ipv6")return Ehe(r)}else if(c2(r)&&k9.v6().test(r))return Ehe(r)};var D9=She;function pB(r){let{address:e}=r.nodeAddress();return!!D9(e)}function ig(r,e){let t=pB(r.multiaddr),n=pB(e.multiaddr);return t&&!n?1:!t&&n||r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}var l4=ue("libp2p:auto-relay"),oze=()=>{},O9=class{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??ig,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??oze,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",n=>{this._onProtocolChange(n).catch(i=>{l4.error(i)})}),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){let{peerId:t,protocols:n}=e.detail,i=t.toString();if(n.find(s=>s===mu)==null){this.listenRelays.has(i)&&await this._removeListenRelay(i);return}if(!this.listenRelays.has(i))try{let s=this.components.connectionManager.getConnections(t);if(s.length===0)return;let a=s[0];if(a.remoteAddr.protoCodes().includes(290)){l4(`relayed connection to ${i} will not be used to hop on`);return}await hhe({connection:a})&&(await this.components.peerStore.metadataBook.setValue(t,lB,fe(fB)),await this._addListenRelay(a,i))}catch(s){this.onError(s)}}_onPeerDisconnected(e){let i=e.detail.remotePeer.toString();this.listenRelays.has(i)&&this._removeListenRelay(i).catch(o=>{l4.error(o)})}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;let n=await Ne(await this.components.peerStore.addressBook.get(e.remotePeer),o=>Id(o,this.addressSorter),async o=>await Wo(o));(await Promise.all(n.map(async o=>{try{let s=o.multiaddr;return s.getPeerId()==null&&(s=s.encapsulate(`/p2p/${e.remotePeer.toString()}`)),s=s.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([s]),!0}catch(s){l4.error("error listening on circuit address",s),this.onError(s)}return!1}))).includes(!0)&&this.listenRelays.add(t)}catch(n){this.onError(n),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;let t=[],n=await this.components.peerStore.all();for(let{id:i,metadata:o}of n){let s=i.toString();if(this.listenRelays.has(s)||e.includes(s))continue;let a=o.get(lB);if(a==null||Ee(a)!==fB)continue;let c=this.components.connectionManager.getConnections(i);if(c.length===0){t.push(i);continue}if(await this._addListenRelay(c[0],s),this.listenRelays.size>=this.maxListeners)return}for(let i of t)if(await this._tryToListenOnRelay(i),this.listenRelays.size>=this.maxListeners)return;try{let i=await R9(C9);for await(let o of this.components.contentRouting.findProviders(i)){if(o.multiaddrs.length===0)continue;let s=o.id;if(!s.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(s,o.multiaddrs),await this._tryToListenOnRelay(s),this.listenRelays.size>=this.maxListeners))return}}catch(i){this.onError(i)}}async _tryToListenOnRelay(e){try{let t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){l4.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}};var Ahe=ue("libp2p:relay"),L9=class{constructor(e,t){var n;this.components=e,this.autoRelay=((n=t.autoRelay)==null?void 0:n.enabled)!==!1?new O9(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){this.init.hop.enabled!==!1&&this.init.advertise.enabled!==!1&&(this.timeout=(0,B9.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){this.timeout!=null&&(0,B9.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{let e=await R9(C9);await this.components.contentRouting.provide(e)}catch(e){e.code===q.ERR_NO_ROUTERS_AVAILABLE?(Ahe.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):Ahe.error(e)}}};var Lpe=C(Ohe(),1);var lHt=C(Zhe(),1),fHt=C(Rb(),1),Ol=C(at(),1);var cHt=C(gB(),1),epe=C(at(),1),Jhe=epe.default.pki,tpe=(r,e)=>{let t=Jhe.rsa.setPublicKey(e.n,e.e),n=Jhe.createCertificate();n.publicKey=t,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);let i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:r.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(e),n};async function rpe(r,e){let t=r.map(e),i=(await Promise.all(t)).findIndex(o=>o);return r[i]}var Ll=C(ee(),1);var Lze=ue("libp2p:keychain:cms"),bB=new WeakMap,z9=class{constructor(e,t){if(e==null)throw(0,Ll.default)(new Error("keychain is required"),q.ERR_KEYCHAIN_REQUIRED);this.keychain=e,bB.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw(0,Ll.default)(new Error("Plain data must be a Uint8Array"),q.ERR_INVALID_PARAMETERS);let n=await this.keychain.findKeyByName(e),i=await this.keychain.getPrivateKey(e),o=bB.get(this);if(o==null)throw(0,Ll.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let s=o.dek,a=Ol.default.pki.decryptRsaPrivateKey(i,s),c=await tpe(n,a),u=Ol.default.pkcs7.createEnvelopedData();u.addRecipient(c),u.content=Ol.default.util.createBuffer(t),u.encrypt();let l=Ol.default.asn1.toDer(u.toAsn1()).getBytes();return fe(l,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw(0,Ll.default)(new Error("CMS data is required"),q.ERR_INVALID_PARAMETERS);let t;try{let l=Ol.default.util.createBuffer(Ee(e,"ascii")),f=Ol.default.asn1.fromDer(l);t=Ol.default.pkcs7.messageFromAsn1(f)}catch(l){throw Lze.error(l),(0,Ll.default)(new Error("Invalid CMS"),q.ERR_INVALID_CMS)}let n=t.recipients.filter(l=>l.issuer.find(f=>f.shortName==="O"&&f.value==="ipfs")).filter(l=>l.issuer.find(f=>f.shortName==="CN")).map(l=>({recipient:l,keyId:l.issuer.find(f=>f.shortName==="CN").value})),i=await rpe(n,async l=>{try{if(await this.keychain.findKeyById(l.keyId)!=null)return!0}catch{return!1}return!1});if(i==null){let l=n.map(f=>f.keyId);throw(0,Ll.default)(new Error(`Decryption needs one of the key(s): ${l.join(", ")}`),q.ERR_MISSING_KEYS,{missingKeys:l})}let o=await this.keychain.findKeyById(i.keyId);if(o==null)throw(0,Ll.default)(new Error("No key available to decrypto"),q.ERR_NO_KEY);let s=await this.keychain.getPrivateKey(o.name),a=bB.get(this);if(a==null)throw(0,Ll.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let c=a.dek,u=Ol.default.pki.decryptRsaPrivateKey(s,c);return t.decrypt(i.recipient,u),fe(t.content.getBytes(),"ascii")}};var nr=C(ee(),1);var Gr;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(Gr||(Gr={}));var _B;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(_B||(_B={}));(function(r){r.codec=()=>Jd(_B)})(Gr||(Gr={}));var gu;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Gr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.Type=Gr.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(gu||(gu={}));var yu;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Gr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.Type=Gr.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(yu||(yu={}));var UGt=C(Ic(),1),FGt=C(Rb(),1),q9=C(at(),1);var Io={get(r=globalThis){let e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var CHt=C(gr(),1),PHt=C(qy(),1),ipe=C(at(),1);function sc(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=yr([new Uint8Array(e-t.length),t])}return Ee(t,"base64url")}function ws(r){let e=ope(r);return new ipe.default.jsbn.BigInteger(Ee(e,"base16"),16)}function ope(r,e){let t=fe(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=yr([new Uint8Array(e-t.length),t])}return t}var Bze={"P-256":256,"P-384":384,"P-521":521},Mze=Object.keys(Bze),VHt=Mze.join(" / ");function K9(r){let e=(r==null?void 0:r.algorithm)??"AES-GCM",t=(r==null?void 0:r.keyLength)??16,n=(r==null?void 0:r.nonceLength)??12,i=(r==null?void 0:r.digest)??"SHA-256",o=(r==null?void 0:r.saltLength)??16,s=(r==null?void 0:r.iterations)??32767,a=Io.get();t*=8;async function c(f,h){let d=a.getRandomValues(new Uint8Array(o)),p=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:p};typeof h=="string"&&(h=fe(h));let w={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},_=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),x=await a.subtle.deriveKey(w,_,{name:e,length:t},!0,["encrypt"]),m=await a.subtle.encrypt(g,x,f);return yr([d,g.iv,new Uint8Array(m)])}async function u(f,h){let d=f.subarray(0,o),p=f.subarray(o,o+n),g=f.subarray(o+n),w={name:e,iv:p};typeof h=="string"&&(h=fe(h));let _={name:"PBKDF2",salt:d,iterations:s,hash:{name:i}},x=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),m=await a.subtle.deriveKey(_,x,{name:e,length:t},!0,["decrypt"]),y=await a.subtle.decrypt(w,m,g);return new Uint8Array(y)}return{encrypt:c,decrypt:u}}async function ape(r,e){let t=wh.decode(r);return await K9().decrypt(t,e)}var xB={};xe(xB,{RsaPrivateKey:()=>ug,RsaPublicKey:()=>d4,fromJwk:()=>Gze,generateKeyPair:()=>jze,unmarshalRsaPrivateKey:()=>qze,unmarshalRsaPublicKey:()=>Hze});var EGt=C(NC(),1),f4=C(at(),1);function Bl(r){if(isNaN(r)||r<=0)throw new We("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ro.randomBytes(r)}var g0={};xe(g0,{jwkToPkcs1:()=>Fze,jwkToPkix:()=>Vze,pkcs1ToJwk:()=>Uze,pkixToJwk:()=>zze});var eGt=C(Ic(),1),tGt=C(Bh(),1),Ml=C(at(),1);function Uze(r){let e=Ml.default.asn1.fromDer(Ee(r,"ascii")),t=Ml.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:sc(t.n),e:sc(t.e),d:sc(t.d),p:sc(t.p),q:sc(t.q),dp:sc(t.dP),dq:sc(t.dQ),qi:sc(t.qInv),alg:"RS256"}}function Fze(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new We("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Ml.default.pki.privateKeyToAsn1({n:ws(r.n),e:ws(r.e),d:ws(r.d),p:ws(r.p),q:ws(r.q),dP:ws(r.dp),dQ:ws(r.dq),qInv:ws(r.qi)});return fe(Ml.default.asn1.toDer(e).getBytes(),"ascii")}function zze(r){let e=Ml.default.asn1.fromDer(Ee(r,"ascii")),t=Ml.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:sc(t.n),e:sc(t.e)}}function Vze(r){if(r.n==null||r.e==null)throw new We("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Ml.default.pki.publicKeyToAsn1({n:ws(r.n),e:ws(r.e)});return fe(Ml.default.asn1.toDer(e).getBytes(),"ascii")}var sGt=C(Bh(),1),EB=C(at(),1);function cpe(r,e){return e.map(t=>ws(r[t]))}function upe(r){return EB.default.pki.setRsaPrivateKey(...cpe(r,["n","e","d","p","q","dp","dq","qi"]))}function lpe(r){return EB.default.pki.setRsaPublicKey(...cpe(r,["n","e"]))}async function fpe(r){let e=await Io.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await ppe(e);return{privateKey:t[0],publicKey:t[1]}}async function vB(r){let t=[await Io.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Kze(r)],n=await ppe({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function dpe(r,e){let t=await Io.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Io.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function hpe(r,e,t){let n=await Io.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Io.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function ppe(r){if(r.privateKey==null||r.publicKey==null)throw new We("Private and public key are required","ERR_INVALID_PARAMETERS");return await Promise.all([Io.get().subtle.exportKey("jwk",r.privateKey),Io.get().subtle.exportKey("jwk",r.publicKey)])}async function Kze(r){return await Io.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function mpe(r,e,t,n){let i=e?lpe(r):upe(r),o=Ee(Uint8Array.from(t),"ascii"),s=n(o,i);return fe(s,"ascii")}function gpe(r,e){return mpe(r,!0,e,(t,n)=>n.encrypt(t))}function ype(r,e){return mpe(r,!1,e,(t,n)=>n.decrypt(t))}async function cg(r,e){let n=await K9().encrypt(r,e);return wh.encode(n)}var d4=class{constructor(e){this._key=e}async verify(e,t){return await hpe(this._key,t,e)}marshal(){return g0.jwkToPkix(this._key)}get bytes(){return gu.encode({Type:Gr.RSA,Data:this.marshal()}).subarray()}encrypt(e){return gpe(this._key,e)}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}},ug=class{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return Bl(16)}async sign(e){return await dpe(this._key,e)}get public(){if(this._publicKey==null)throw new We("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new d4(this._publicKey)}decrypt(e){return ype(this._key,e)}marshal(){return g0.jwkToPkcs1(this._key)}get bytes(){return yu.encode({Type:Gr.RSA,Data:this.marshal()}).subarray()}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}async id(){let e=await this.public.hash();return Ee(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){let n=new f4.default.util.ByteBuffer(this.marshal()),i=f4.default.asn1.fromDer(n),o=f4.default.pki.privateKeyFromAsn1(i),s={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return f4.default.pki.encryptRsaPrivateKey(o,e,s)}else{if(t==="libp2p-key")return await cg(this.bytes,e);throw new We(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function qze(r){let e=g0.pkcs1ToJwk(r),t=await vB(e);return new ug(t.privateKey,t.publicKey)}function Hze(r){let e=g0.pkixToJwk(r);return new d4(e)}async function Gze(r){let e=await vB(r);return new ug(e.privateKey,e.publicKey)}async function jze(r){let e=await fpe(r);return new ug(e.privateKey,e.publicKey)}var SB={};xe(SB,{Ed25519PrivateKey:()=>y0,Ed25519PublicKey:()=>h4,generateKeyPair:()=>Xze,generateKeyPairFromSeed:()=>xpe,unmarshalEd25519PrivateKey:()=>Yze,unmarshalEd25519PublicKey:()=>Qze});var lg=32,Ul=64,$9=32;async function wpe(){let r=Lc.randomPrivateKey(),e=await H1(r);return{privateKey:vpe(r,e),publicKey:e}}async function bpe(r){if(r.length!==$9)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=r,t=await H1(e);return{privateKey:vpe(e,t),publicKey:t}}async function _pe(r,e){let t=r.subarray(0,$9);return await Db(e,t)}async function Epe(r,e,t){return await Ob(e,t,r)}function vpe(r,e){let t=new Uint8Array(Ul);for(let n=0;n<$9;n++)t[n]=r[n],t[$9+n]=e[n];return t}var h4=class{constructor(e){this._key=fg(e,lg)}async verify(e,t){return await Epe(this._key,t,e)}marshal(){return this._key}get bytes(){return gu.encode({Type:Gr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}},y0=class{constructor(e,t){this._key=fg(e,Ul),this._publicKey=fg(t,lg)}async sign(e){return await _pe(this._key,e)}get public(){return new h4(this._publicKey)}marshal(){return this._key}get bytes(){return yu.encode({Type:Gr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}async id(){let e=await Ns.digest(this.public.bytes);return tt.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return await cg(this.bytes,e);throw new We(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Yze(r){if(r.length>Ul){r=fg(r,Ul+lg);let n=r.subarray(0,Ul),i=r.subarray(Ul,r.length);return new y0(n,i)}r=fg(r,Ul);let e=r.subarray(0,Ul),t=r.subarray(lg);return new y0(e,t)}function Qze(r){return r=fg(r,lg),new h4(r)}async function Xze(){let{privateKey:r,publicKey:e}=await wpe();return new y0(r,e)}async function xpe(r){let{privateKey:e,publicKey:t}=await bpe(r);return new y0(e,t)}function fg(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new We(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}var TB={};xe(TB,{Secp256k1PrivateKey:()=>m4,Secp256k1PublicKey:()=>p4,generateKeyPair:()=>tVe,unmarshalSecp256k1PrivateKey:()=>Jze,unmarshalSecp256k1PublicKey:()=>eVe});function Spe(){return ro.randomPrivateKey()}async function Ape(r,e){let{digest:t}=await mr.digest(e);try{return await Wb(t,r)}catch(n){throw new We(String(n),"ERR_INVALID_INPUT")}}async function Tpe(r,e,t){try{let{digest:n}=await mr.digest(t);return Yb(e,n,r)}catch(n){throw new We(String(n),"ERR_INVALID_INPUT")}}function Ipe(r){return Kt.fromHex(r).toRawBytes(!0)}function Rpe(r){try{im(r,!0)}catch(e){throw new We(String(e),"ERR_INVALID_PRIVATE_KEY")}}function AB(r){try{Kt.fromHex(r)}catch(e){throw new We(String(e),"ERR_INVALID_PUBLIC_KEY")}}function Cpe(r){try{return im(r,!0)}catch(e){throw new We(String(e),"ERR_INVALID_PRIVATE_KEY")}}var p4=class{constructor(e){AB(e),this._key=e}async verify(e,t){return await Tpe(this._key,t,e)}marshal(){return Ipe(this._key)}get bytes(){return gu.encode({Type:Gr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}},m4=class{constructor(e,t){this._key=e,this._publicKey=t??Cpe(e),Rpe(this._key),AB(this._publicKey)}async sign(e){return await Ape(this._key,e)}get public(){return new p4(this._publicKey)}marshal(){return this._key}get bytes(){return yu.encode({Type:Gr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return rr(this.bytes,e.bytes)}async hash(){let{bytes:e}=await mr.digest(this.bytes);return e}async id(){let e=await this.public.hash();return Ee(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return await cg(this.bytes,e);throw new We(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Jze(r){return new m4(r)}function eVe(r){return new p4(r)}async function tVe(){let r=await Spe();return new m4(r)}var Fl={rsa:xB,ed25519:SB,secp256k1:TB};function IB(r){let e=Object.keys(Fl).join(" / ");return new We(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function RB(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return Fl[r];throw IB(r)}async function H9(r,e){return await RB(r).generateKeyPair(e??2048)}function g4(r){let e=gu.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Gr.RSA:return Fl.rsa.unmarshalRsaPublicKey(t);case Gr.Ed25519:return Fl.ed25519.unmarshalEd25519PublicKey(t);case Gr.Secp256k1:return Fl.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw IB(e.Type??"RSA")}}function Ppe(r,e){return e=(e??"rsa").toLowerCase(),RB(e),r.bytes}async function dg(r){let e=yu.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Gr.RSA:return await Fl.rsa.unmarshalRsaPrivateKey(t);case Gr.Ed25519:return Fl.ed25519.unmarshalEd25519PrivateKey(t);case Gr.Secp256k1:return Fl.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw IB(e.Type??"RSA")}}function kpe(r,e){return e=(e??"rsa").toLowerCase(),RB(e),r.bytes}async function y4(r,e){try{let i=await ape(r,e);return await dg(i)}catch{}let t=q9.default.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new We("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=q9.default.asn1.toDer(q9.default.pki.privateKeyToAsn1(t));return n=fe(n.getBytes(),"ascii"),await Fl.rsa.unmarshalRsaPrivateKey(n)}var HGt=C(Nh(),1),nVe=C(at(),1);var Dpe=C(bb(),1),Ope=C(gr(),1);var Npe={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function w4(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){let a=Object.keys(Npe).join(" / ");throw new We(`Hash '${i}' is unknown or not supported. Must be ${a}`,"ERR_UNSUPPORTED_HASH_TYPE")}let o=Npe[i],s=(0,Dpe.default)(r,e,t,n,o);return Ope.default.encode64(s,null)}var G9=ue("libp2p:keychain"),sVe="/pkcs8/",Bpe="/info/",rh=new WeakMap,w0={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},CB={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function zl(r){return r==null||typeof r!="string"?!1:r===(0,Lpe.default)(r.trim())&&r.length>0}async function _r(){let t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function wu(r){return new pe(sVe+r)}function Vl(r){return new pe(Bpe+r)}var b0=class{constructor(e,t){var i,o,s,a,c,u,l,f,h,d;if(this.components=e,this.init=et(CB,t),this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((o=this.init.dek)==null?void 0:o.keyLength)!=null&&this.init.dek.keyLength<w0.minKeyLength)throw new Error(`dek.keyLength must be least ${w0.minKeyLength} bytes`);if(((a=(s=this.init.dek)==null?void 0:s.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<w0.minSaltLength)throw new Error(`dek.saltLength must be least ${w0.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<w0.minIterationCount)throw new Error(`dek.iterationCount must be least ${w0.minIterationCount}`);let n=this.init.pass!=null&&((u=this.init.dek)==null?void 0:u.salt)!=null?w4(this.init.pass,(l=this.init.dek)==null?void 0:l.salt,(f=this.init.dek)==null?void 0:f.iterationCount,(h=this.init.dek)==null?void 0:h.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";rh.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){let e=Vl("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){let e=rh.get(this);if(e==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let t=e.dek;return new z9(this,t)}static generateOptions(){let e=Object.assign({},CB),t=Math.ceil(w0.minSaltLength/3)*3;return e.dek.salt=Ee(Bl(t),"base64"),e}static get options(){return CB}async createKey(e,t,n=2048){if(!zl(e)||e==="self")throw await _r(),(0,nr.default)(new Error("Invalid key name"),q.ERR_INVALID_KEY_NAME);if(typeof t!="string")throw await _r(),(0,nr.default)(new Error("Invalid key type"),q.ERR_INVALID_KEY_TYPE);let i=wu(e);if(await this.components.datastore.has(i))throw await _r(),(0,nr.default)(new Error("Key name already exists"),q.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await _r(),(0,nr.default)(new Error("Invalid RSA key size"),q.ERR_INVALID_KEY_SIZE);break;default:break}let s;try{let a=await H9(t,n),c=await a.id(),u=rh.get(this);if(u==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let l=u.dek,f=await a.export(l);s={name:e,id:c};let h=this.components.datastore.batch();h.put(i,fe(f)),h.put(Vl(e),fe(JSON.stringify(s))),await h.commit()}catch(a){throw await _r(),a}return s}async listKeys(){let e={prefix:Bpe},t=[];for await(let n of this.components.datastore.query(e))t.push(JSON.parse(Ee(n.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find(n=>n.id===e)}catch(t){throw await _r(),t}}async findKeyByName(e){if(!zl(e))throw await _r(),(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);let t=Vl(e);try{let n=await this.components.datastore.get(t);return JSON.parse(Ee(n))}catch(n){throw await _r(),G9.error(n),(0,nr.default)(new Error(`Key '${e}' does not exist.`),q.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!zl(e)||e==="self")throw await _r(),(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);let t=wu(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(Vl(e)),await i.commit(),n}async renameKey(e,t){if(!zl(e)||e==="self")throw await _r(),(0,nr.default)(new Error(`Invalid old key name '${e}'`),q.ERR_OLD_KEY_NAME_INVALID);if(!zl(t)||t==="self")throw await _r(),(0,nr.default)(new Error(`Invalid new key name '${t}'`),q.ERR_NEW_KEY_NAME_INVALID);let n=wu(e),i=wu(t),o=Vl(e),s=Vl(t);if(await this.components.datastore.has(i))throw await _r(),(0,nr.default)(new Error(`Key '${t}' already exists`),q.ERR_KEY_ALREADY_EXISTS);try{let c=await this.components.datastore.get(n),u=await this.components.datastore.get(o),l=JSON.parse(Ee(u));l.name=t;let f=this.components.datastore.batch();return f.put(i,c),f.put(s,fe(JSON.stringify(l))),f.delete(n),f.delete(o),await f.commit(),l}catch(c){throw await _r(),c}}async exportKey(e,t){if(!zl(e))throw await _r(),(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);if(t==null)throw await _r(),(0,nr.default)(new Error("Password is required"),q.ERR_PASSWORD_REQUIRED);let n=wu(e);try{let i=await this.components.datastore.get(n),o=Ee(i),s=rh.get(this);if(s==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let a=s.dek;return await(await y4(o,a)).export(t)}catch(i){throw await _r(),i}}async exportPeerId(e){let t="temporary-password",n=await this.exportKey(e,t),i=await y4(n,t);return await Yd(i.public.bytes,i.bytes)}async importKey(e,t,n){if(!zl(e)||e==="self")throw await _r(),(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);if(t==null)throw await _r(),(0,nr.default)(new Error("PEM encoded key is required"),q.ERR_PEM_REQUIRED);let i=wu(e);if(await this.components.datastore.has(i))throw await _r(),(0,nr.default)(new Error(`Key '${e}' already exists`),q.ERR_KEY_ALREADY_EXISTS);let s;try{s=await y4(t,n)}catch{throw await _r(),(0,nr.default)(new Error("Cannot read the key, most likely the password is wrong"),q.ERR_CANNOT_READ_KEY)}let a;try{a=await s.id();let l=rh.get(this);if(l==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let f=l.dek;t=await s.export(f)}catch(l){throw await _r(),l}let c={name:e,id:a},u=this.components.datastore.batch();return u.put(i,fe(t)),u.put(Vl(e),fe(JSON.stringify(c))),await u.commit(),c}async importPeer(e,t){try{if(!zl(e))throw(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);if(t==null)throw(0,nr.default)(new Error("PeerId is required"),q.ERR_MISSING_PRIVATE_KEY);if(t.privateKey==null)throw(0,nr.default)(new Error("PeerId.privKey is required"),q.ERR_MISSING_PRIVATE_KEY);let n=await dg(t.privateKey),i=wu(e);if(await this.components.datastore.has(i))throw await _r(),(0,nr.default)(new Error(`Key '${e}' already exists`),q.ERR_KEY_ALREADY_EXISTS);let s=rh.get(this);if(s==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let a=s.dek,c=await n.export(a),u={name:e,id:t.toString()},l=this.components.datastore.batch();return l.put(i,fe(c)),l.put(Vl(e),fe(JSON.stringify(u))),await l.commit(),u}catch(n){throw await _r(),n}}async getPrivateKey(e){if(!zl(e))throw await _r(),(0,nr.default)(new Error(`Invalid key name '${e}'`),q.ERR_INVALID_KEY_NAME);try{let t=wu(e),n=await this.components.datastore.get(t);return Ee(n)}catch(t){throw await _r(),G9.error(t),(0,nr.default)(new Error(`Key '${e}' does not exist.`),q.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){var a,c,u,l;if(typeof e!="string")throw await _r(),(0,nr.default)(new Error(`Invalid old pass type '${typeof e}'`),q.ERR_INVALID_OLD_PASS_TYPE);if(typeof t!="string")throw await _r(),(0,nr.default)(new Error(`Invalid new pass type '${typeof t}'`),q.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await _r(),(0,nr.default)(new Error(`Invalid pass length ${t.length}`),q.ERR_INVALID_PASS_LENGTH);G9("recreating keychain");let n=rh.get(this);if(n==null)throw(0,nr.default)(new Error("dek missing"),q.ERR_INVALID_PARAMETERS);let i=n.dek;this.init.pass=t;let o=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?w4(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(u=this.init.dek)==null?void 0:u.keyLength,(l=this.init.dek)==null?void 0:l.hash):"";rh.set(this,{dek:o});let s=await this.listKeys();for(let f of s){let h=await this.components.datastore.get(wu(f.name)),d=Ee(h),p=await y4(d,i),g=o.toString(),w=await p.export(g),_=this.components.datastore.batch(),x={name:f.name,id:f.id};_.put(wu(f.name),fe(w)),_.put(Vl(f.name),fe(JSON.stringify(x))),await _.commit()}G9("keychain reconstructed")}};async function b4(r){try{return{status:"fulfilled",value:await r,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}var PB=class{constructor(e){B(this,"value");B(this,"next");this.value=e}},bu,_0,E0,_4=class{constructor(){bt(this,bu,void 0);bt(this,_0,void 0);bt(this,E0,void 0);this.clear()}enqueue(e){let t=new PB(e);ge(this,bu)?(ge(this,_0).next=t,Dt(this,_0,t)):(Dt(this,bu,t),Dt(this,_0,t)),uh(this,E0)._++}dequeue(){let e=ge(this,bu);if(e)return Dt(this,bu,ge(this,bu).next),uh(this,E0)._--,e.value}clear(){Dt(this,bu,void 0),Dt(this,_0,void 0),Dt(this,E0,0)}get size(){return ge(this,E0)}*[Symbol.iterator](){let e=ge(this,bu);for(;e;)yield e.value,e=e.next}};bu=new WeakMap,_0=new WeakMap,E0=new WeakMap;function kB(r){if(!((Number.isInteger(r)||r===Number.POSITIVE_INFINITY)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new _4,t=0,n=()=>{t--,e.size>0&&e.dequeue()()},i=async(a,c,u)=>{t++;let l=(async()=>a(...u))();c(l);try{await l}catch{}n()},o=(a,c,u)=>{e.enqueue(i.bind(void 0,a,c,u)),(async()=>(await Promise.resolve(),t<r&&e.size>0&&e.dequeue()()))()},s=(a,...c)=>new Promise(u=>{o(a,u,c)});return Object.defineProperties(s,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),s}async function NB(r,e={}){let{concurrency:t=Number.POSITIVE_INFINITY}=e,n=kB(t);return Promise.all(r.map(i=>i&&typeof i.then=="function"?b4(i):typeof i=="function"?b4(n(()=>i())):b4(Promise.resolve(i))))}var hg=C(ee(),1);var DB=class extends Map{constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function bs(r){let{name:e,metrics:t}=r,n;return t!=null?n=new DB({name:e,metrics:t}):n=new Map,n}var v0=ue("libp2p:transports"),j9=class extends Zt{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=bs({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Qd.FATAL_ALL}add(e){let t=e[Symbol.toStringTag];if(t==null)throw(0,hg.default)(new Error("Transport must have a valid tag"),q.ERR_INVALID_KEY);if(this.transports.has(t))throw(0,hg.default)(new Error("There is already a transport with this tag"),q.ERR_DUPLICATE_TRANSPORT);v0("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){let e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){let e=[];for(let[t,n]of this.listeners)for(v0("closing listeners for %s",t);n.length>0;){let i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),v0("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){let n=this.transportForMultiaddr(e);if(n==null)throw(0,hg.default)(new Error(`No transport available for address ${String(e)}`),q.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(i){throw i.code==null&&(i.code=q.ERR_TRANSPORT_DIAL_FAILED),i}}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(let t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(e==null||e.length===0){v0("no addresses were provided for listening, this node is dial only");return}let t=[];for(let[n,i]of this.transports.entries()){let o=i.filter(e),s=[];for(let u of o){v0("creating listener for %s on %s",n,u);let l=i.createListener({upgrader:this.components.upgrader}),f=this.listeners.get(n);f==null&&(f=[],this.listeners.set(n,f)),f.push(l),l.addEventListener("listening",()=>{this.dispatchEvent(new ve("listener:listening",{detail:l}))}),l.addEventListener("close",()=>{this.dispatchEvent(new ve("listener:close",{detail:l}))}),s.push(l.listen(u))}if(s.length===0){t.push(n);continue}if((await NB(s)).find(u=>u.isFulfilled)==null&&this.faultTolerance!==Qd.NO_FATAL)throw(0,hg.default)(new Error(`Transport (${n}) could not listen on any available address`),q.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){let n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===Qd.FATAL_ALL)throw(0,hg.default)(new Error(n),q.ERR_NO_VALID_ADDRESSES);v0(`libp2p in dial mode only: ${n}`)}}async remove(e){v0("removing %s",e);for(let t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}};var Wn=C(ee(),1);var Kl="/multistream/1.0.0";var zpe=C(ee(),1);var OB=C(ee(),1);var cVe=ue("libp2p:mss"),Mpe=fe(`
`);function E4(r){let e=new ln(r,Mpe);return vn.single(e)}function x0(r,e,t={}){let n=E4(e);t.writeBytes===!0?r.push(n.subarray()):r.push(n)}function Upe(r,e,t={}){let n=new ln;for(let i of e)n.append(E4(i));t.writeBytes===!0?r.push(n.subarray()):r.push(n)}async function uVe(r,e){let t=1,n={[Symbol.asyncIterator]:()=>n,next:async()=>await r.next(t)},i=n;(e==null?void 0:e.signal)!=null&&(i=sa(n,e.signal));let s=await Ne(i,Xr({onLength:a=>{t=a},maxDataLength:1024}),async a=>await Fi(a));if(s==null||s.length===0)throw(0,OB.default)(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(s.get(s.byteLength-1)!==Mpe[0])throw cVe.error("Invalid mss message - missing newline - %s",s.subarray()),(0,OB.default)(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return s.sublist(0,-1)}async function pg(r,e){let t=await uVe(r,e);return Ee(t.subarray())}var v4=ue("libp2p:mss:select");async function x4(r,e,t={}){e=Array.isArray(e)?[...e]:[e];let{reader:n,writer:i,rest:o,stream:s}=ng(r),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");v4('select: write ["%s", "%s"]',Kl,a);let c=fe(Kl),u=fe(a);Upe(i,[c,u],t);let l=await pg(n,t);if(v4('select: read "%s"',l),l===Kl&&(l=await pg(n,t),v4('select: read "%s"',l)),l===a)return o(),{stream:s,protocol:a};for(let f of e){v4('select: write "%s"',f),x0(i,fe(f),t);let h=await pg(n,t);if(v4('select: read "%s" for "%s"',h,f),h===f)return o(),{stream:s,protocol:f}}throw o(),(0,zpe.default)(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}var S4=ue("libp2p:mss:handle");async function A4(r,e,t){e=Array.isArray(e)?e:[e];let{writer:n,reader:i,rest:o,stream:s}=ng(r);for(;;){let a=await pg(i,t);if(S4('read "%s"',a),a===Kl){S4('respond with "%s" for "%s"',Kl,a),x0(n,fe(Kl),t);continue}if(e.includes(a))return x0(n,fe(a),t),S4('respond with "%s" for "%s"',a,a),o(),{stream:s,protocol:a};if(a==="ls"){x0(n,new ln(...e.map(c=>E4(fe(c)))),t),S4('respond with "%s" for %s',e,a);continue}x0(n,fe("na"),t),S4('respond with "na" for "%s"',a)}}var LB=C(ee(),1);var Vpe=Symbol.for("@libp2p/connection");var fVe=ue("libp2p:connection"),BB=class{constructor(e){let{remoteAddr:t,remotePeer:n,newStream:i,close:o,getStreams:s,stat:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...a,status:y9},this._newStream=i,this._close=o,this._getStreams=s,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[Vpe](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===zL)throw(0,LB.default)(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===w9)throw(0,LB.default)(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);let n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(!(this.stat.status===w9||this._closing)){this.stat.status=zL;try{this.streams.forEach(e=>e.close())}catch(e){fVe.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=w9}}};function Kpe(r){return new BB(r)}var Y9=C(ee(),1);var W9=Symbol.for("@libp2p/topology");function $pe(r){return r!=null&&!!r[W9]}var MB=ue("libp2p:registrar"),UB=32,FB=64,Q9=class{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this._onConnect=this._onConnect.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.connectionManager.addEventListener("peer:connect",this._onConnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw(0,Y9.default)(new Error(`No handler registered for protocol ${e}`),q.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw(0,Y9.default)(new Error(`Handler already registered for protocol ${e}`),q.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);let i=et.bind({ignoreUndefined:!0})({maxInboundStreams:UB,maxOutboundStreams:FB},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){let t=Array.isArray(e)?e:[e];t.forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(!$pe(t))throw MB.error("topology must be an instance of interfaces/topology"),(0,Y9.default)(new Error("topology must be an instance of interfaces/topology"),q.ERR_INVALID_PARAMETERS);let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),await t.setRegistrar(this),n}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let o=this.topologies.get(i);if(o!=null)for(let s of o.values())s.onDisconnect(t.remotePeer)}}).catch(n=>{MB.error(n)})}_onConnect(e){let t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(let i of n){let o=this.topologies.get(i);if(o!=null)for(let s of o.values())s.onConnect(t.remotePeer,t)}}).catch(n=>{MB.error(n)})}_onProtocolChange(e){let{peerId:t,protocols:n,oldProtocols:i}=e.detail,o=i.filter(a=>!n.includes(a)),s=n.filter(a=>!i.includes(a));for(let a of o){let c=this.topologies.get(a);if(c!=null)for(let u of c.values())u.onDisconnect(t)}for(let a of s){let c=this.topologies.get(a);if(c!=null)for(let u of c.values()){let l=this.components.connectionManager.getConnections(t)[0];l!=null&&u.onConnect(t,l)}}}};var zB=C(Kn(),1);var VB=C(xi(),1),Pr=ue("libp2p:upgrader");function dVe(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.code!==q.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return UB}function hVe(r,e){try{let{options:t}=e.getHandler(r);return t.maxOutboundStreams}catch(t){if(t.code!==q.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return FB}function qpe(r,e,t){let n=0;return t.streams.forEach(i=>{i.stat.direction===e&&i.stat.protocol===r&&n++}),n}var X9=class extends Zt{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(n=>{this.connectionEncryption.set(n.protocol,n)}),this.muxers=new Map,t.muxers.forEach(n=>{this.muxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e,t){var l,f;if(!await this.components.connectionManager.acceptIncomingConnection(e))throw(0,Wn.default)(new Error("connection denied"),q.ERR_CONNECTION_DENIED);let i,o,s,a,c,u=new zB.TimeoutController(this.inboundUpgradeTimeout);try{(l=VB.setMaxListeners)==null||l(1/0,u.signal)}catch{}try{let h=ps(e,u.signal);if(e.source=h.source,e.sink=h.sink,await this.components.connectionGater.denyInboundConnection(e))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by gater.acceptConnection"),q.ERR_CONNECTION_INTERCEPTED);(f=this.components.metrics)==null||f.trackMultiaddrConnection(e),Pr("starting the inbound connection upgrade");let d=e;if((t==null?void 0:t.skipProtection)!==!0){let p=this.components.connectionProtector;p!=null&&(Pr("protecting the inbound connection"),d=await p.protect(e))}try{if(i=d,(t==null?void 0:t.skipEncryption)!==!0){if({conn:i,remotePeer:o,protocol:c}=await this._encryptInbound(d),await this.components.connectionGater.denyInboundEncryptedConnection(o,{...d,...i}))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),q.ERR_CONNECTION_INTERCEPTED)}else{let p=e.remoteAddr.getPeerId();if(p==null)throw(0,Wn.default)(new Error("inbound connection that skipped encryption must have a peer id"),q.ERR_INVALID_MULTIADDR);let g=xt(p);c="native",o=g}if(s=i,(t==null?void 0:t.muxerFactory)!=null)a=t.muxerFactory;else if(this.muxers.size>0){let p=await this._multiplexInbound({...d,...i},this.muxers);a=p.muxerFactory,s=p.stream}}catch(p){throw Pr.error("Failed to upgrade inbound connection",p),p}if(await this.components.connectionGater.denyInboundUpgradedConnection(o,{...d,...i}))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),q.ERR_CONNECTION_INTERCEPTED);return Pr("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:c,direction:"inbound",maConn:e,upgradedConn:s,muxerFactory:a,remotePeer:o})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(e,t){var f;let n=e.remoteAddr.getPeerId(),i;if(n!=null&&(i=xt(n),await this.components.connectionGater.denyOutboundConnection(i,e)))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),q.ERR_CONNECTION_INTERCEPTED);let o,s,a,c,u;(f=this.components.metrics)==null||f.trackMultiaddrConnection(e),Pr("Starting the outbound connection upgrade");let l=e;if((t==null?void 0:t.skipProtection)!==!0){let h=this.components.connectionProtector;h!=null&&(l=await h.protect(e))}try{if(o=l,(t==null?void 0:t.skipEncryption)!==!0){if({conn:o,remotePeer:s,protocol:c}=await this._encryptOutbound(l,i),await this.components.connectionGater.denyOutboundEncryptedConnection(s,{...l,...o}))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),q.ERR_CONNECTION_INTERCEPTED)}else{if(i==null)throw(0,Wn.default)(new Error("Encryption was skipped but no peer id was passed"),q.ERR_INVALID_PEER);c="native",s=i}if(a=o,(t==null?void 0:t.muxerFactory)!=null)u=t.muxerFactory;else if(this.muxers.size>0){let h=await this._multiplexOutbound({...l,...o},this.muxers);u=h.muxerFactory,a=h.stream}}catch(h){throw Pr.error("Failed to upgrade outbound connection",h),await e.close(h),h}if(await this.components.connectionGater.denyOutboundUpgradedConnection(s,{...l,...o}))throw(0,Wn.default)(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),q.ERR_CONNECTION_INTERCEPTED);return Pr("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:c,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:u,remotePeer:s})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:o,remotePeer:s,muxerFactory:a}=e,c,u,l;a!=null&&(c=a.createStreamMuxer({direction:n,onIncomingStream:d=>{l!=null&&Promise.resolve().then(async()=>{var m;let p=this.components.registrar.getProtocols(),{stream:g,protocol:w}=await A4(d,p);if(Pr("%s: incoming stream opened on %s",n,w),l==null)return;let _=dVe(w,this.components.registrar);if(qpe(w,"inbound",l)===_){d.abort((0,Wn.default)(new Error(`Too many inbound protocol streams for protocol "${w}" - limit ${_}`),q.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS));return}d.source=g.source,d.sink=g.sink,d.stat.protocol=w,this.components.peerStore.protoBook.add(s,[w]).catch(y=>Pr.error(y)),l.addStream(d),(m=this.components.metrics)==null||m.trackProtocolStream(d,l),this._onStream({connection:l,stream:d,protocol:w})}).catch(p=>{Pr.error(p),d.stat.timeline.close==null&&d.close()})},onStreamEnd:d=>{l==null||l.removeStream(d.id)}}),u=async(d,p={})=>{var _,x;if(c==null)throw(0,Wn.default)(new Error("Stream is not multiplexed"),q.ERR_MUXER_UNAVAILABLE);Pr("%s: starting new stream on %s",n,d);let g=await c.newStream(),w;try{if(p.signal==null){Pr("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",d),w=new zB.TimeoutController(3e4),p.signal=w.signal;try{(_=VB.setMaxListeners)==null||_(1/0,w.signal)}catch{}}let{stream:m,protocol:y}=await x4(g,d,p),b=hVe(y,this.components.registrar);if(qpe(y,"outbound",l)===b){let v=(0,Wn.default)(new Error(`Too many outbound protocol streams for protocol "${y}" - limit ${b}`),q.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw g.abort(v),v}return this.components.peerStore.protoBook.add(s,[y]).catch(v=>Pr.error(v)),g.source=m.source,g.sink=m.sink,g.stat.protocol=y,(x=this.components.metrics)==null||x.trackProtocolStream(g,l),g}catch(m){throw Pr.error("could not create new stream",m),g.stat.timeline.close==null&&g.close(),m.code!=null?m:(0,Wn.default)(m,q.ERR_UNSUPPORTED_PROTOCOL)}finally{w!=null&&w.clear()}},Promise.all([c.sink(o.source),o.sink(c.source)]).catch(d=>{Pr.error(d)}));let f=i.timeline;i.timeline=new Proxy(f,{set:(...d)=>(l!=null&&d[1]==="close"&&d[2]!=null&&f.close==null&&(async()=>{try{l.stat.status==="OPEN"&&await l.close()}catch(p){Pr.error(p)}finally{this.dispatchEvent(new ve("connectionEnd",{detail:l}))}})().catch(p=>{Pr.error(p)}),Reflect.set(...d))}),i.timeline.upgraded=Date.now();let h=()=>{throw(0,Wn.default)(new Error("connection is not multiplexed"),q.ERR_CONNECTION_NOT_MULTIPLEXED)};return l=Kpe({remoteAddr:i.remoteAddr,remotePeer:s,stat:{status:"OPEN",direction:n,timeline:i.timeline,multiplexer:c==null?void 0:c.protocol,encryption:t},newStream:u??h,getStreams:()=>c!=null?c.streams:h(),close:async()=>{await i.close(),c!=null&&c.close()}}),this.dispatchEvent(new ve("connection",{detail:l})),l}_onStream(e){let{connection:t,stream:n,protocol:i}=e,{handler:o}=this.components.registrar.getHandler(i);o({connection:t,stream:n})}async _encryptInbound(e){let t=Array.from(this.connectionEncryption.keys());Pr("handling inbound crypto protocol selection",t);try{let{stream:n,protocol:i}=await A4(e,t,{writeBytes:!0}),o=this.connectionEncryption.get(i);if(o==null)throw new Error(`no crypto module found for ${i}`);return Pr("encrypting inbound connection..."),{...await o.secureInbound(this.components.peerId,n),protocol:i}}catch(n){throw(0,Wn.default)(n,q.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){let n=Array.from(this.connectionEncryption.keys());Pr("selecting outbound crypto protocol",n);try{let{stream:i,protocol:o}=await x4(e,n,{writeBytes:!0}),s=this.connectionEncryption.get(o);if(s==null)throw new Error(`no crypto module found for ${o}`);return Pr("encrypting outbound connection to %p",t),{...await s.secureOutbound(this.components.peerId,i,t),protocol:o}}catch(i){throw(0,Wn.default)(i,q.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){let n=Array.from(t.keys());Pr("outbound selecting muxer %s",n);try{let{stream:i,protocol:o}=await x4(e,n,{writeBytes:!0});Pr("%s selected as muxer protocol",o);let s=t.get(o);return{stream:i,muxerFactory:s}}catch(i){throw Pr.error("error multiplexing outbound stream",i),(0,Wn.default)(i,q.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){let n=Array.from(t.keys());Pr("inbound handling muxers %s",n);try{let{stream:i,protocol:o}=await A4(e,n,{writeBytes:!0}),s=t.get(o);return{stream:i,muxerFactory:s}}catch(i){throw Pr.error("error multiplexing inbound stream",i),(0,Wn.default)(i,q.ERR_MUXER_UNAVAILABLE)}}};var A0=C(ee(),1);var S0;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let o of t.listenAddrs)n.uint32(18),n.bytes(o);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let o of t.protocols)n.uint32(26),n.string(o);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 5:i.protocolVersion=t.string();break;case 6:i.agentVersion=t.string();break;case 1:i.publicKey=t.bytes();break;case 2:i.listenAddrs.push(t.bytes());break;case 4:i.observedAddr=t.bytes();break;case 3:i.protocols.push(t.string());break;case 8:i.signedPeerRecord=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(S0||(S0={}));var Gpe=C(ee(),1);var Hpe={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var T4;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.publicKey!=null&&t.publicKey.byteLength>0)&&(n.uint32(10),n.bytes(t.publicKey)),(i.writeDefaults===!0||t.payloadType!=null&&t.payloadType.byteLength>0)&&(n.uint32(18),n.bytes(t.payloadType)),(i.writeDefaults===!0||t.payload!=null&&t.payload.byteLength>0)&&(n.uint32(26),n.bytes(t.payload)),(i.writeDefaults===!0||t.signature!=null&&t.signature.byteLength>0)&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(T4||(T4={}));var pVe,Yn=class{constructor(e){let{peerId:t,payloadType:n,payload:i,signature:o}=e;this.peerId=t,this.payloadType=n,this.payload=i,this.signature=o}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=T4.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return rr(this.marshal(),e.marshal())}async validate(e){let t=jpe(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await g4(this.peerId.publicKey).verify(t.subarray(),this.signature)}};pVe=Yn;Yn.createFromProtobuf=async r=>{let e=T4.decode(r),t=await Yd(e.publicKey);return new Yn({peerId:t,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};Yn.seal=async(r,e)=>{if(e.privateKey==null)throw new Error("Missing private key");let t=r.domain,n=r.codec,i=r.marshal(),o=jpe(t,n,i),a=await(await dg(e.privateKey)).sign(o.subarray());return new Yn({peerId:e,payloadType:n,payload:i,signature:a})};Yn.openAndCertify=async(r,e)=>{let t=await Yn.createFromProtobuf(r);if(!await t.validate(e))throw(0,Gpe.default)(new Error("envelope signature is not valid for the given domain"),Hpe.ERR_SIGNATURE_NOT_VALID);return t};var jpe=(r,e,t)=>{let n=fe(r),i=nc.encode(n.byteLength),o=nc.encode(e.length),s=nc.encode(t.length);return new ln(i,n,o,e,s,t)};function Wpe(r,e){let t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}var I4;(function(r){let e;(function(n){let i;n.codec=()=>(i==null&&(i=Cr((o,s,a={})=>{a.lengthDelimited!==!1&&s.fork(),(a.writeDefaults===!0||o.multiaddr!=null&&o.multiaddr.byteLength>0)&&(s.uint32(10),s.bytes(o.multiaddr)),a.lengthDelimited!==!1&&s.ldelim()},(o,s)=>{let a={multiaddr:new Uint8Array(0)},c=s==null?o.len:o.pos+s;for(;o.pos<c;){let u=o.uint32();switch(u>>>3){case 1:a.multiaddr=o.bytes();break;default:o.skipType(u&7);break}}return a})),i),n.encode=o=>Rr(o,n.codec()),n.decode=o=>Ir(o,n.codec())})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=Cr((n,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),(o.writeDefaults===!0||n.peerId!=null&&n.peerId.byteLength>0)&&(i.uint32(10),i.bytes(n.peerId)),(o.writeDefaults===!0||n.seq!==0n)&&(i.uint32(16),i.uint64(n.seq)),n.addresses!=null)for(let s of n.addresses)i.uint32(26),r.AddressInfo.codec().encode(s,i,{writeDefaults:!0});o.lengthDelimited!==!1&&i.ldelim()},(n,i)=>{let o={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=i==null?n.len:n.pos+i;for(;n.pos<s;){let a=n.uint32();switch(a>>>3){case 1:o.peerId=n.bytes();break;case 2:o.seq=n.uint64();break;case 3:o.addresses.push(r.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return o})),t),r.encode=n=>Rr(n,r.codec()),r.decode=n=>Ir(n,r.codec())})(I4||(I4={}));var Ype="libp2p-peer-record",Qpe=Uint8Array.from([3,1]);var Mn=class{constructor(e){this.domain=Mn.DOMAIN,this.codec=Mn.CODEC;let{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=I4.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Mn)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!Wpe(this.multiaddrs,e.multiaddrs))}};Mn.createFromProtobuf=r=>{let e=I4.decode(r),t=Wd(e.peerId),n=(e.addresses??[]).map(o=>lt(o.multiaddr)),i=e.seq;return new Mn({peerId:t,multiaddrs:n,seqNumber:i})};Mn.DOMAIN=Ype;Mn.CODEC=Qpe;var Z9="0.0.0",Xpe="libp2p";var KB=`js-libp2p/${Z9}`;var Zpe="0.1.0",Jpe="id",e0e="id/push",t0e="1.0.0",r0e="1.0.0";var R4=C(Kn(),1);var C4=C(xi(),1),vr=ue("libp2p:identify"),n0e=1024*8,mg=class{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/${Jpe}/${t0e}`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/${e0e}/${r0e}`,this.host={protocolVersion:`${t.protocolPrefix}/${Zpe}`,...t.host},this.components.connectionManager.addEventListener("peer:connect",n=>{let i=n.detail;this.identify(i).catch(vr.error)}),this.components.peerStore.addEventListener("change:multiaddrs",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(o=>vr.error(o))}),this.components.peerStore.addEventListener("change:protocols",n=>{let{peerId:i}=n.detail;this.components.peerId.equals(i)&&this.pushToPeerStore().catch(o=>vr.error(o))})}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",fe(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",fe(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(t=>{vr.error(t)})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(t=>{vr.error(t)})},{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){let t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map(s=>s.bytes),i=await this.components.peerStore.protoBook.get(this.components.peerId),o=e.map(async s=>{var u;let a,c=new R4.TimeoutController(this.init.timeout);try{(u=C4.setMaxListeners)==null||u(1/0,c.signal)}catch{}try{a=await s.newStream([this.identifyPushProtocolStr],{signal:c.signal}),await ps(a,c.signal).sink(Ne([S0.encode({listenAddrs:n,signedPeerRecord:t,protocols:i})],vn()))}catch(l){vr.error("could not push identify update to peer",l)}finally{a!=null&&a.close(),c.clear()}});await Promise.all(o)}async pushToPeerStore(){if(!this.isStarted())return;let e=[];for(let t of this.components.connectionManager.getConnections()){let n=t.remotePeer;(await this.components.peerStore.get(n)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){var s;let n,i=t.signal,o;if(i==null){n=new R4.TimeoutController(this.init.timeout),i=n.signal;try{(s=C4.setMaxListeners)==null||s(1/0,n.signal)}catch{}}try{o=await e.newStream([this.identifyProtocolStr],{signal:i});let a=ps(o,i),c=await Ne([],a,Xr({maxDataLength:this.init.maxIdentifyMessageSize??n0e}),async u=>await Fi(u));if(c==null)throw(0,A0.default)(new Error("No data could be retrieved"),q.ERR_CONNECTION_ENDED);try{return S0.decode(c)}catch(u){throw(0,A0.default)(u,q.ERR_INVALID_MESSAGE)}}finally{n!=null&&n.clear(),o!=null&&o.close()}}async identify(e,t={}){let n=await this._identify(e,t),{publicKey:i,listenAddrs:o,protocols:s,observedAddr:a,signedPeerRecord:c,agentVersion:u,protocolVersion:l}=n;if(i==null)throw(0,A0.default)(new Error("public key was missing from identify message"),q.ERR_MISSING_PUBLIC_KEY);let f=await Yd(i);if(!e.remotePeer.equals(f))throw(0,A0.default)(new Error("identified peer does not match the expected peer"),q.ERR_INVALID_PEER);if(this.components.peerId.equals(f))throw(0,A0.default)(new Error("identified peer is our own peer id?"),q.ERR_INVALID_PEER);let h=mg.getCleanMultiaddr(a);if(c!=null){vr("received signed peer record from %p",f);try{let d=await Yn.openAndCertify(c,Mn.DOMAIN);if(!d.peerId.equals(f))throw(0,A0.default)(new Error("identified peer does not match the expected peer"),q.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(d)){await this.components.peerStore.protoBook.set(f,s),u!=null&&await this.components.peerStore.metadataBook.setValue(f,"AgentVersion",fe(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(f,"ProtocolVersion",fe(l)),vr("identify completed for peer %p and protocols %o",f,s);return}}catch(d){vr("received invalid envelope, discard it and fallback to listenAddrs is available",d)}}else vr("no signed peer record received from %p",f);vr("falling back to legacy addresses from %p",f);try{await this.components.peerStore.addressBook.set(f,o.map(d=>lt(d)))}catch(d){vr.error("received invalid addrs",d)}await this.components.peerStore.protoBook.set(f,s),u!=null&&await this.components.peerStore.metadataBook.setValue(f,"AgentVersion",fe(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(f,"ProtocolVersion",fe(l)),vr("identify completed for peer %p and protocols %o",f,s),vr("received observed address of %s",h==null?void 0:h.toString())}async _handleIdentify(e){var o;let{connection:t,stream:n}=e,i=new R4.TimeoutController(this.init.timeout);try{(o=C4.setMaxListeners)==null||o(1/0,i.signal)}catch{}try{let s=this.components.peerId.publicKey??new Uint8Array(0),a=await this.components.peerStore.get(this.components.peerId),c=this.components.addressManager.getAddresses().map(d=>d.decapsulateCode(hr("p2p").code)),u=a.peerRecordEnvelope;if(c.length>0&&u==null){let d=new Mn({peerId:this.components.peerId,multiaddrs:c}),p=await Yn.seal(d,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(p),u=p.marshal().subarray()}let l=S0.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:s,listenAddrs:c.map(d=>d.bytes),signedPeerRecord:u,observedAddr:t.remoteAddr.bytes,protocols:a.protocols}),f=ps(n,i.signal),h=Ne([l],vn());await f.sink(h)}catch(s){vr.error("could not respond to identify request",s)}finally{n.close(),i.clear()}}async _handlePush(e){var a;let{connection:t,stream:n}=e,i=new R4.TimeoutController(this.init.timeout);try{(a=C4.setMaxListeners)==null||a(1/0,i.signal)}catch{}let o;try{let c=ps(n,i.signal),u=await Ne([],c,Xr({maxDataLength:this.init.maxIdentifyMessageSize??n0e}),async l=>await Fi(l));u!=null&&(o=S0.decode(u))}catch(c){return vr.error("received invalid message",c)}finally{n.close(),i.clear()}if(o==null)return vr.error("received invalid message");let s=t.remotePeer;if(this.components.peerId.equals(s)){vr("received push from ourselves?");return}if(vr("received push from %p",s),o.signedPeerRecord!=null){vr("received signedPeerRecord in push");try{let c=await Yn.openAndCertify(o.signedPeerRecord,Mn.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(c)){vr("consumed signedPeerRecord sent in push"),await this.components.peerStore.protoBook.set(s,o.protocols);return}else vr("failed to consume signedPeerRecord sent in push")}catch(c){vr("received invalid envelope, discard it and fallback to listenAddrs is available",c)}}else vr("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(s,o.listenAddrs.map(c=>lt(c)))}catch(c){vr.error("received invalid addrs",c)}try{await this.components.peerStore.protoBook.set(s,o.protocols)}catch(c){vr.error("received invalid protocols",c)}vr("handled push from %p",s)}static getCleanMultiaddr(e){if(e!=null&&e.length>0)try{return lt(e)}catch{}}};var gg=C(ee(),1);var P4;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identifier!=="")&&(n.uint32(10),n.string(t.identifier)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identifier:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.identifier=t.string();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(P4||(P4={}));var ac;(function(r){let e;(function(i){i.OK="OK",i.NOT_FOUND="NOT_FOUND",i.ERROR="ERROR"})(e=r.StatusCode||(r.StatusCode={}));let t;(function(i){i[i.OK=0]="OK",i[i.NOT_FOUND=1]="NOT_FOUND",i[i.ERROR=2]="ERROR"})(t||(t={})),function(i){i.codec=()=>Jd(t)}(e=r.StatusCode||(r.StatusCode={}));let n;r.codec=()=>(n==null&&(n=Cr((i,o,s={})=>{s.lengthDelimited!==!1&&o.fork(),(s.writeDefaults===!0||i.status!=null&&t[i.status]!==0)&&(o.uint32(8),r.StatusCode.codec().encode(i.status,o)),(s.writeDefaults===!0||i.data!=null&&i.data.byteLength>0)&&(o.uint32(18),o.bytes(i.data)),s.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let s={status:e.OK,data:new Uint8Array(0)},a=o==null?i.len:i.pos+o;for(;i.pos<a;){let c=i.uint32();switch(c>>>3){case 1:s.status=r.StatusCode.codec().decode(i);break;case 2:s.data=i.bytes();break;default:i.skipType(c&7);break}}return s})),n),r.encode=i=>Rr(i,r.codec()),r.decode=i=>Ir(i,r.codec())})(ac||(ac={}));var i0e="0.0.1",o0e="fetch";var s0e=C(Kn(),1),a0e=C(xi(),1);var da=ue("libp2p:fetch"),J9=class{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${o0e}/${i0e}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,e=>{this.handleMessage(e).catch(t=>{da.error(t)}).finally(()=>{e.stream.close()})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,n={}){var c;da("dialing %s to %p",this.protocol,e);let i=await this.components.connectionManager.openConnection(e,n),o,s=n.signal,a;if(s==null){da("using default timeout of %d ms",this.init.timeout),o=new s0e.TimeoutController(this.init.timeout),s=o.signal;try{(c=a0e.setMaxListeners)==null||c(1/0,o.signal)}catch{}}try{a=await i.newStream(this.protocol,{signal:s});let u=ps(a,s);return da("fetch %s",t),await Ne([P4.encode({identifier:t})],vn(),u,Xr(),async function(f){let h=await Fi(f);if(h==null)throw(0,gg.default)(new Error("No data received"),q.ERR_INVALID_MESSAGE);let d=ac.decode(h);switch(d.status){case ac.StatusCode.OK:return da("received status for %s ok",t),d.data;case ac.StatusCode.NOT_FOUND:return da("received status for %s not found",t),null;case ac.StatusCode.ERROR:{da("received status for %s error",t);let p=Ee(d.data);throw(0,gg.default)(new Error("Error in fetch protocol response: "+p),q.ERR_INVALID_PARAMETERS)}default:throw da("received status for %s unknown",t),(0,gg.default)(new Error("Unknown response status"),q.ERR_INVALID_MESSAGE)}})??null}finally{o!=null&&o.clear(),a!=null&&a.close()}}async handleMessage(e){let{stream:t}=e,n=this;await Ne(t,Xr(),async function*(i){let o=await Fi(i);if(o==null)throw(0,gg.default)(new Error("No data received"),q.ERR_INVALID_MESSAGE);let s=P4.decode(o),a,c=n._getLookupFunction(s.identifier);if(c!=null){da("look up data with identifier %s",s.identifier);let u=await c(s.identifier);u!=null?(da("sending status for %s ok",s.identifier),a={status:ac.StatusCode.OK,data:u}):(da("sending status for %s not found",s.identifier),a={status:ac.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{da("sending status for %s error",s.identifier);let u=fe(`No lookup function registered for key: ${s.identifier}`);a={status:ac.StatusCode.ERROR,data:u}}yield ac.encode(a)},vn(),t)}_getLookupFunction(e){for(let t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw(0,gg.default)(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),q.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){t!=null&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}};var f0e=C(ee(),1);var c0e="1.0.0",u0e="ping";var d0e=C(Kn(),1),h0e=C(xi(),1),l0e=ue("libp2p:ping"),ex=class{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/${u0e}/${c0e}`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){let{stream:t}=e;Ne(t,t).catch(n=>{l0e.error(n)})}async ping(e,t={}){var u;l0e("dialing %s to %p",this.protocol,e);let n=Date.now(),i=Bl(32),o=await this.components.connectionManager.openConnection(e,t),s,a=t.signal,c;if(a==null){s=new d0e.TimeoutController(this.init.timeout),a=s.signal;try{(u=h0e.setMaxListeners)==null||u(1/0,s.signal)}catch{}}try{c=await o.newStream([this.protocol],{signal:a});let l=ps(c,a),f=await Ne([i],l,async d=>await Fi(d)),h=Date.now();if(f==null||!rr(i,f.subarray()))throw(0,f0e.default)(new Error("Received wrong ping ack"),q.ERR_WRONG_PING_ACK);return h-n}finally{s!=null&&s.clear(),c!=null&&c.close()}}};async function p0e(){throw new Error("Not supported in browsers")}var m0e=C(EA(),1),$B=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,tx=(0,m0e.default)(),T0=$B&&!tx,g0e=tx&&!$B,y0e=tx&&$B,w0e=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!tx,rx=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,UYt=typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"]==="test",b0e=typeof navigator<"u"&&navigator.product==="ReactNative";var v0e=C(ee(),1);function _0e(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function E0e(r){let{address:e}=r.nodeAddress();return _0e(e)}var qB=ue("libp2p:nat"),HB=7200;function yVe(r=1024,e=65535){return Math.floor(Math.random()*(e-r+1)+r)}var nx=class{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`${Xpe}@${Z9} ${this.components.peerId.toString()}`,this.ttl=t.ttl??HB,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<HB)throw(0,v0e.default)(new Error(`NatManager ttl should be at least ${HB} seconds`),q.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){T0||!this.enabled||this.started||(this.started=!0,this._start().catch(e=>{qB.error(e)}))}async _start(){let e=this.components.transportManager.getAddrs();for(let t of e){let{family:n,host:i,port:o,transport:s}=t.toOptions();if(!t.isThinWaistAddress()||s!=="tcp"||E0e(t)||n!==4)continue;let a=await this._getClient(),c=this.externalAddress??await a.externalIp(),u=D9(c);if(u===!0)throw new Error(`${c} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);if(u==null)throw new Error(`${c} is not an IP address`);let l=yVe();qB(`opening uPnP connection from ${c}:${l} to ${i}:${o}`),await a.map({publicPort:l,localPort:o,localAddress:this.localAddress,protocol:s.toUpperCase()==="TCP"?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(oie({family:4,address:c,port:l},s))}}async _getClient(){return this.client!=null?this.client:(this.client=await p0e({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway}),this.client)}async stop(){if(!(T0||this.client==null))try{await this.client.close(),this.client=void 0}catch(e){qB.error(e)}}};var wVe=ue("libp2p:peer-record-updater"),ix=class{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then(async()=>{let e=new Mn({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(n=>n.decapsulateCode(hr("p2p").code))}),t=await Yn.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)}).catch(e=>{wVe.error("Could not update self peer record: %o",e)})}};var x0e=C(ee(),1);var ox=class{constructor(e){this.dht=e}async findPeer(e,t={}){for await(let n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw(0,x0e.default)(new Error(Rt.NOT_FOUND),q.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(let n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}};var ax=C(ee(),1);var St={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"};async function*GB(r,e){for await(let t of r)await e(t),yield t}var Er=ue("libp2p:peer-store:address-book"),sx="change:multiaddrs";async function bVe(){return!0}var cx=class{constructor(e,t,n){this.dispatchEvent=e,this.store=t,this.addressFilter=n??bVe}async consumePeerRecord(e){Er.trace("consumePeerRecord await write lock");let t=await this.store.lock.writeLock();Er.trace("consumePeerRecord got write lock");let n,i,o;try{let s;try{s=Mn.createFromProtobuf(e.payload)}catch{return Er.error("invalid peer record received"),!1}n=s.peerId;let a=s.multiaddrs;if(!n.equals(e.peerId))return Er("signing key does not match PeerId in the PeerRecord"),!1;if(a==null||a.length===0)return!1;if(await this.store.has(n)&&(i=await this.store.load(n),i.peerRecordEnvelope!=null)){let u=await Yn.createFromProtobuf(i.peerRecordEnvelope),l=Mn.createFromProtobuf(u.payload);if(l.seqNumber>=s.seqNumber)return Er("sequence number was lower or equal to existing sequence number - stored: %d received: %d",l.seqNumber,s.seqNumber),!1}let c=await jB(n,a,this.addressFilter,!0);o=await this.store.patchOrCreate(n,{addresses:c,peerRecordEnvelope:e.marshal().subarray()}),Er("stored provided peer record for %p",s.peerId)}finally{Er.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new ve(sx,{detail:{peerId:n,multiaddrs:o.addresses.map(({multiaddr:s})=>s),oldMultiaddrs:i==null?[]:i.addresses.map(({multiaddr:s})=>s)}})),!0}async getRawEnvelope(e){Er.trace("getRawEnvelope await read lock");let t=await this.store.lock.readLock();Er.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(n){if(n.code!==St.ERR_NOT_FOUND)throw n}finally{Er.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){let t=await this.getRawEnvelope(e);if(t!=null)return await Yn.createFromProtobuf(t)}async get(e){e=xn(e),Er.trace("get wait for read lock");let t=await this.store.lock.readLock();Er.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(n){if(n.code!==St.ERR_NOT_FOUND)throw n}finally{Er.trace("get release read lock"),t()}return[]}async set(e,t){if(e=xn(e),!Array.isArray(t))throw Er.error("multiaddrs must be an array of Multiaddrs"),(0,ax.default)(new Error("multiaddrs must be an array of Multiaddrs"),St.ERR_INVALID_PARAMETERS);Er.trace("set await write lock");let n=await this.store.lock.writeLock();Er.trace("set got write lock");let i=!1,o,s;try{let a=await jB(e,t,this.addressFilter);if(a.length===0)return;try{if(o=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...o.addresses.map(({multiaddr:c})=>c.toString())]).size===o.addresses.length&&a.length===o.addresses.length)return}catch(c){if(c.code!==St.ERR_NOT_FOUND)throw c}s=await this.store.patchOrCreate(e,{addresses:a}),Er("set multiaddrs for %p",e)}finally{Er.trace("set multiaddrs for %p",e),Er("set release write lock"),n()}this.dispatchEvent(new ve(sx,{detail:{peerId:e,multiaddrs:s.addresses.map(a=>a.multiaddr),oldMultiaddrs:o==null?[]:o.addresses.map(({multiaddr:a})=>a)}})),i||this.dispatchEvent(new ve("peer",{detail:{id:e,multiaddrs:s.addresses.map(a=>a.multiaddr),protocols:s.protocols}}))}async add(e,t){if(e=xn(e),!Array.isArray(t))throw Er.error("multiaddrs must be an array of Multiaddrs"),(0,ax.default)(new Error("multiaddrs must be an array of Multiaddrs"),St.ERR_INVALID_PARAMETERS);Er.trace("add await write lock");let n=await this.store.lock.writeLock();Er.trace("add got write lock");let i,o,s;try{let a=await jB(e,t,this.addressFilter);if(a.length===0)return;try{if(o=await this.store.load(e),i=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...o.addresses.map(({multiaddr:c})=>c.toString())]).size===o.addresses.length)return}catch(c){if(c.code!==St.ERR_NOT_FOUND)throw c}s=await this.store.mergeOrCreate(e,{addresses:a}),Er("added multiaddrs for %p",e)}finally{Er.trace("set release write lock"),n()}this.dispatchEvent(new ve(sx,{detail:{peerId:e,multiaddrs:s.addresses.map(a=>a.multiaddr),oldMultiaddrs:o==null?[]:o.addresses.map(({multiaddr:a})=>a)}})),i===!0&&this.dispatchEvent(new ve("peer",{detail:{id:e,multiaddrs:s.addresses.map(a=>a.multiaddr),protocols:s.protocols}}))}async delete(e){e=xn(e),Er.trace("delete await write lock");let t=await this.store.lock.writeLock();Er.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{addresses:[]})}finally{Er.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ve(sx,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:n==null?[]:n.addresses.map(({multiaddr:i})=>i)}}))}};async function jB(r,e,t,n=!1){return await Ne(e,i=>GB(i,o=>{if(!as(o))throw Er.error("multiaddr must be an instance of Multiaddr"),(0,ax.default)(new Error("multiaddr must be an instance of Multiaddr"),St.ERR_INVALID_PARAMETERS)}),i=>Yt(i,async o=>await t(r,o)),i=>Bi(i,o=>({multiaddr:o,isCertified:n})),async i=>await Wo(i))}var A0e=C(ee(),1);var _u=ue("libp2p:peer-store:key-book"),S0e="change:pubkey",ux=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=xn(e),!(t instanceof Uint8Array))throw _u.error("publicKey must be an instance of Uint8Array to store data"),(0,A0e.default)(new Error("publicKey must be an instance of PublicKey"),St.ERR_INVALID_PARAMETERS);_u.trace("set await write lock");let n=await this.store.lock.writeLock();_u.trace("set got write lock");let i=!1,o;try{try{if(o=await this.store.load(e),o.pubKey!=null&&rr(o.pubKey,t))return}catch(s){if(s.code!==St.ERR_NOT_FOUND)throw s}await this.store.patchOrCreate(e,{pubKey:t}),i=!0}finally{_u.trace("set release write lock"),n()}i&&this.dispatchEvent(new ve(S0e,{detail:{peerId:e,publicKey:t,oldPublicKey:o==null?void 0:o.pubKey}}))}async get(e){e=xn(e),_u.trace("get await write lock");let t=await this.store.lock.readLock();_u.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(n){if(n.code!==St.ERR_NOT_FOUND)throw n}finally{_u("get release write lock"),t()}}async delete(e){e=xn(e),_u.trace("delete await write lock");let t=await this.store.lock.writeLock();_u.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}finally{_u.trace("delete release write lock"),t()}this.dispatchEvent(new ve(S0e,{detail:{peerId:e,publicKey:void 0,oldPublicKey:n==null?void 0:n.pubKey}}))}};var WB=C(ee(),1);var Un=ue("libp2p:peer-store:metadata-book"),lx="change:metadata",fx=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=xn(e),Un.trace("get await read lock");let t=await this.store.lock.readLock();Un.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(n){if(n.code!==St.ERR_NOT_FOUND)throw n}finally{Un.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=xn(e),Un.trace("getValue await read lock");let n=await this.store.lock.readLock();Un.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}finally{Un.trace("getValue release write lock"),n()}}async set(e,t){if(e=xn(e),!(t instanceof Map))throw Un.error("valid metadata must be provided to store data"),(0,WB.default)(new Error("valid metadata must be provided"),St.ERR_INVALID_PARAMETERS);Un.trace("set await write lock");let n=await this.store.lock.writeLock();Un.trace("set got write lock");let i;try{try{i=await this.store.load(e)}catch(o){if(o.code!==St.ERR_NOT_FOUND)throw o}await this.store.mergeOrCreate(e,{metadata:t})}finally{Un.trace("set release write lock"),n()}this.dispatchEvent(new ve(lx,{detail:{peerId:e,metadata:t,oldMetadata:i==null?new Map:i.metadata}}))}async setValue(e,t,n){if(e=xn(e),typeof t!="string"||!(n instanceof Uint8Array))throw Un.error("valid key and value must be provided to store data"),(0,WB.default)(new Error("valid key and value must be provided"),St.ERR_INVALID_PARAMETERS);Un.trace("setValue await write lock");let i=await this.store.lock.writeLock();Un.trace("setValue got write lock");let o,s;try{try{o=await this.store.load(e);let a=o.metadata.get(t);if(a!=null&&rr(n,a))return}catch(a){if(a.code!==St.ERR_NOT_FOUND)throw a}s=await this.store.mergeOrCreate(e,{metadata:new Map([[t,n]])})}finally{Un.trace("setValue release write lock"),i()}this.dispatchEvent(new ve(lx,{detail:{peerId:e,metadata:s.metadata,oldMetadata:o==null?new Map:o.metadata}}))}async delete(e){e=xn(e),Un.trace("delete await write lock");let t=await this.store.lock.writeLock();Un.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}n!=null&&await this.store.patch(e,{metadata:new Map})}finally{Un.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ve(lx,{detail:{peerId:e,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(e,t){e=xn(e),Un.trace("deleteValue await write lock");let n=await this.store.lock.writeLock();Un.trace("deleteValue got write lock");let i,o;try{o=await this.store.load(e),i=o.metadata,i.delete(t),await this.store.patch(e,{metadata:i})}catch(s){if(s.code!==St.ERR_NOT_FOUND)throw s}finally{Un.trace("deleteValue release write lock"),n()}i!=null&&this.dispatchEvent(new ve(lx,{detail:{peerId:e,metadata:i,oldMetadata:o==null?new Map:o.metadata}}))}};var hx=C(ee(),1);var Fn=ue("libp2p:peer-store:proto-book"),dx="change:protocols",px=class{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){Fn.trace("get wait for read lock");let t=await this.store.lock.readLock();Fn.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(n){if(n.code!==St.ERR_NOT_FOUND)throw n}finally{Fn.trace("get release read lock"),t()}return[]}async set(e,t){if(e=xn(e),!Array.isArray(t))throw Fn.error("protocols must be provided to store data"),(0,hx.default)(new Error("protocols must be provided"),St.ERR_INVALID_PARAMETERS);Fn.trace("set await write lock");let n=await this.store.lock.writeLock();Fn.trace("set got write lock");let i,o;try{try{if(i=await this.store.load(e),new Set([...t]).size===i.protocols.length)return}catch(s){if(s.code!==St.ERR_NOT_FOUND)throw s}o=await this.store.patchOrCreate(e,{protocols:t}),Fn("stored provided protocols for %p",e)}finally{Fn.trace("set release write lock"),n()}this.dispatchEvent(new ve(dx,{detail:{peerId:e,protocols:o.protocols,oldProtocols:i==null?[]:i.protocols}}))}async add(e,t){if(e=xn(e),!Array.isArray(t))throw Fn.error("protocols must be provided to store data"),(0,hx.default)(new Error("protocols must be provided"),St.ERR_INVALID_PARAMETERS);Fn.trace("add await write lock");let n=await this.store.lock.writeLock();Fn.trace("add got write lock");let i,o;try{try{if(i=await this.store.load(e),new Set([...i.protocols,...t]).size===i.protocols.length)return}catch(s){if(s.code!==St.ERR_NOT_FOUND)throw s}o=await this.store.mergeOrCreate(e,{protocols:t}),Fn("added provided protocols for %p",e)}finally{Fn.trace("add release write lock"),n()}this.dispatchEvent(new ve(dx,{detail:{peerId:e,protocols:o.protocols,oldProtocols:i==null?[]:i.protocols}}))}async remove(e,t){if(e=xn(e),!Array.isArray(t))throw Fn.error("protocols must be provided to store data"),(0,hx.default)(new Error("protocols must be provided"),St.ERR_INVALID_PARAMETERS);Fn.trace("remove await write lock");let n=await this.store.lock.writeLock();Fn.trace("remove got write lock");let i,o;try{try{i=await this.store.load(e);let s=new Set(i.protocols);for(let a of t)s.delete(a);if(i.protocols.length===s.size)return;t=Array.from(s)}catch(s){if(s.code!==St.ERR_NOT_FOUND)throw s}o=await this.store.patchOrCreate(e,{protocols:t})}finally{Fn.trace("remove release write lock"),n()}this.dispatchEvent(new ve(dx,{detail:{peerId:e,protocols:o.protocols,oldProtocols:i==null?[]:i.protocols}}))}async delete(e){e=xn(e),Fn.trace("delete await write lock");let t=await this.store.lock.writeLock();Fn.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i}await this.store.patchOrCreate(e,{protocols:[]})}finally{Fn.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new ve(dx,{detail:{peerId:e,protocols:[],oldProtocols:n.protocols}}))}};var YB=C(ee(),1);var k4;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(let o of t.addresses)n.uint32(10),mx.codec().encode(o,n,{writeDefaults:!0});if(t.protocols!=null)for(let o of t.protocols)n.uint32(18),n.string(o);if(t.metadata!=null)for(let o of t.metadata)n.uint32(26),gx.codec().encode(o,n,{writeDefaults:!0});t.pubKey!=null&&(n.uint32(34),n.bytes(t.pubKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={addresses:[],protocols:[],metadata:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.addresses.push(mx.codec().decode(t,t.uint32()));break;case 2:i.protocols.push(t.string());break;case 3:i.metadata.push(gx.codec().decode(t,t.uint32()));break;case 4:i.pubKey=t.bytes();break;case 5:i.peerRecordEnvelope=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(k4||(k4={}));var mx;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.multiaddr!=null&&t.multiaddr.byteLength>0)&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={multiaddr:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.multiaddr=t.bytes();break;case 2:i.isCertified=t.bool();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(mx||(mx={}));var gx;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.key!=="")&&(n.uint32(10),n.string(t.key)),(i.writeDefaults===!0||t.value!=null&&t.value.byteLength>0)&&(n.uint32(18),n.bytes(t.value)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={key:"",value:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(gx||(gx={}));var T0e=ue("libp2p:peer-store:store"),I0e="/peers/",yx=class{constructor(e){this.components=e,this.lock=e5({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(e.type==null)throw T0e.error("peerId must be an instance of peer-id to store data"),(0,YB.default)(new Error("peerId must be an instance of peer-id"),St.ERR_INVALID_PARAMETERS);let t=e.toCID().toString();return new pe(`${I0e}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){let t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),n=k4.decode(t),i=new Map;for(let o of n.metadata)i.set(o.key,o.value);return{...n,id:e,addresses:n.addresses.map(({multiaddr:o,isCertified:s})=>({multiaddr:lt(o),isCertified:s??!1})),metadata:i,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(e){if(e.pubKey!=null&&e.id.publicKey!=null&&!rr(e.pubKey,e.id.publicKey))throw T0e.error("peer publicKey bytes do not match peer id publicKey bytes"),(0,YB.default)(new Error("publicKey bytes do not match peer id publicKey bytes"),St.ERR_INVALID_PARAMETERS);let t=new Set,n=e.addresses.filter(s=>t.has(s.multiaddr.toString())?!1:(t.add(s.multiaddr.toString()),!0)).sort((s,a)=>s.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({multiaddr:s,isCertified:a})=>({multiaddr:s.bytes,isCertified:a})),i=[];[...e.metadata.keys()].sort().forEach(s=>{let a=e.metadata.get(s);a!=null&&i.push({key:s,value:a})});let o=k4.encode({addresses:n,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:i,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),o.subarray()),await this.load(e.id)}async patch(e,t){let n=await this.load(e);return await this._patch(e,t,n)}async patchOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,n)}async _patch(e,t,n){return await this.save({...n,...t,id:e})}async merge(e,t){let n=await this.load(e);return await this._merge(e,t,n)}async mergeOrCreate(e,t){let n;try{n=await this.load(e)}catch(i){if(i.code!==St.ERR_NOT_FOUND)throw i;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,n)}async _merge(e,t,n){var o,s;let i=new Map;return n.addresses.forEach(a=>{i.set(a.multiaddr.toString(),a.isCertified)}),(t.addresses??[]).forEach(a=>{let c=a.multiaddr.toString(),l=!!i.get(c)||a.isCertified;i.set(c,l)}),await this.save({id:e,addresses:Array.from(i.entries()).map(([a,c])=>({multiaddr:lt(a),isCertified:c})),protocols:Array.from(new Set([...n.protocols??[],...t.protocols??[]])),metadata:new Map([...((o=n.metadata)==null?void 0:o.entries())??[],...((s=t.metadata)==null?void 0:s.entries())??[]]),pubKey:t.pubKey??(n!=null?n.pubKey:void 0),peerRecordEnvelope:t.peerRecordEnvelope??(n!=null?n.peerRecordEnvelope:void 0)})}async*all(){for await(let e of this.components.datastore.queryKeys({prefix:I0e})){let t=e.toString().split("/")[2],n=Ot.decode(t);yield this.load(Wd(n))}}};var QB=C(ee(),1);var $l;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.tags!=null)for(let o of t.tags)n.uint32(10),wx.codec().encode(o,n,{writeDefaults:!0});i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={tags:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.tags.push(wx.codec().decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})($l||($l={}));var wx;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.name!=="")&&(n.uint32(10),n.string(t.name)),t.value!=null&&(n.uint32(16),n.uint32(t.value)),t.expiry!=null&&(n.uint32(24),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={name:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.name=t.string();break;case 2:i.value=t.uint32();break;case 3:i.expiry=t.uint64();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(wx||(wx={}));var ha=ue("libp2p:peer-store"),bx=class extends Zt{constructor(e,t={}){super(),this.components=e,this.store=new yx(e),this.addressBook=new cx(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new ux(this.dispatchEvent.bind(this),this.store),this.metadataBook=new fx(this.dispatchEvent.bind(this),this.store),this.protoBook=new px(this.dispatchEvent.bind(this),this.store)}async forEach(e){ha.trace("getPeers await read lock");let t=await this.store.lock.readLock();ha.trace("getPeers got read lock");try{for await(let n of this.store.all())n.id.equals(this.components.peerId)||e(n)}finally{ha.trace("getPeers release read lock"),t()}}async all(){let e=[];return await this.forEach(t=>{e.push(t)}),e}async delete(e){ha.trace("delete await write lock");let t=await this.store.lock.writeLock();ha.trace("delete got write lock");try{await this.store.delete(e)}finally{ha.trace("delete release write lock"),t()}}async get(e){ha.trace("get await read lock");let t=await this.store.lock.readLock();ha.trace("get got read lock");try{return await this.store.load(e)}finally{ha.trace("get release read lock"),t()}}async has(e){ha.trace("has await read lock");let t=await this.store.lock.readLock();ha.trace("has got read lock");try{return await this.store.has(e)}finally{ha.trace("has release read lock"),t()}}async tagPeer(e,t,n={}){let i=n.value??0,o=Math.round(i),s=n.ttl??void 0;if(o!==i||o<0||o>100)throw(0,QB.default)(new Error("Tag value must be between 0-100"),"ERR_TAG_VALUE_OUT_OF_BOUNDS");let a=await this.metadataBook.getValue(e,"tags"),c=[];a!=null&&(c=$l.decode(a).tags);for(let u of c)if(u.name===t)throw(0,QB.default)(new Error("Peer already tagged"),"ERR_DUPLICATE_TAG");c.push({name:t,value:o,expiry:s==null?void 0:BigInt(Date.now()+s)}),await this.metadataBook.setValue(e,"tags",$l.encode({tags:c}).subarray())}async unTagPeer(e,t){let n=await this.metadataBook.getValue(e,"tags"),i=[];n!=null&&(i=$l.decode(n).tags),i=i.filter(o=>o.name!==t),await this.metadataBook.setValue(e,"tags",$l.encode({tags:i}).subarray())}async getTags(e){let t=await this.metadataBook.getValue(e,"tags"),n=[];t!=null&&(n=$l.decode(t).tags);let i=BigInt(Date.now()),o=n.filter(s=>s.expiry==null||s.expiry>i);return o.length!==n.length&&await this.metadataBook.setValue(e,"tags",$l.encode({tags:o}).subarray()),o.map(s=>({name:s.name,value:s.value??0}))}};var R0e=C(ee(),1),_x=class{constructor(e){this.dht=e}async provide(e){await on(this.dht.provide(e))}async*findProviders(e,t={}){for await(let n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await on(this.dht.put(e,t,n))}async get(e,t){for await(let n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw(0,R0e.default)(new Error("Not found"),"ERR_NOT_FOUND")}};var _s=C(ee(),1);var Ex=class{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{await e.start()})),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{await e.stop()})),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>Cl(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}get peerId(){if(this._peerId==null)throw(0,_s.default)(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(this._addressManager==null)throw(0,_s.default)(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(this._peerStore==null)throw(0,_s.default)(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(this._upgrader==null)throw(0,_s.default)(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(this._registrar==null)throw(0,_s.default)(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(this._connectionManager==null)throw(0,_s.default)(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(this._transportManager==null)throw(0,_s.default)(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(this._connectionGater==null)throw(0,_s.default)(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(this._contentRouting==null)throw(0,_s.default)(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(this._peerRouting==null)throw(0,_s.default)(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(this._datastore==null)throw(0,_s.default)(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(this._dialer==null)throw(0,_s.default)(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}};var ZB=C($s(),1),JB=C(k0e(),1);var N0e=globalThis.fetch,D0e=globalThis.Headers,cXt=globalThis.Request,uXt=globalThis.Response;function vx(r,e,t){return`${r}?name=${e}&type=${t}`}async function O0e(r,e){return await(await N0e(r,{headers:new D0e({accept:"application/dns-json"}),signal:e})).json()}function I0(r,e){return`${e}_${r}`}var XB=Object.assign((0,ZB.default)("dns-over-http-resolver"),{error:(0,ZB.default)("dns-over-http-resolver:error")}),eM=class{constructor(e={}){this._cache=new JB.default({max:(e==null?void 0:e.maxCache)??100}),this._TXTcache=new JB.default({max:(e==null?void 0:e.maxCache)??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??O0e,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>e.abort())}getServers(){return this._servers}_getShuffledServers(){let e=[...this._servers];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t),i=e[t];e[t]=e[n],e[n]=i}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){let t="A",n=this._cache.get(I0(e,t));if(n!=null)return n;let i=!1;for(let o of this._getShuffledServers()){let s=new AbortController;this._abortControllers.push(s);try{let a=await this._request(vx(o,e,t),s.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(I0(e,t),c,{ttl:u}),c}catch{s.signal.aborted&&(i=!0),XB.error(`${o} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==s)}}throw i?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){let t="AAAA",n=this._cache.get(I0(e,t));if(n!=null)return n;let i=!1;for(let o of this._getShuffledServers()){let s=new AbortController;this._abortControllers.push(s);try{let a=await this._request(vx(o,e,t),s.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(I0(e,t),c,{ttl:u}),c}catch{s.signal.aborted&&(i=!0),XB.error(`${o} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==s)}}throw i?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){let t="TXT",n=this._TXTcache.get(I0(e,t));if(n!=null)return n;let i=!1;for(let o of this._getShuffledServers()){let s=new AbortController;this._abortControllers.push(s);try{let a=await this._request(vx(o,e,t),s.signal),c=a.Answer.map(l=>[l.data.replace(/['"]+/g,"")]),u=Math.min(...a.Answer.map(l=>l.TTL));return this._TXTcache.set(I0(e,t),c,{ttl:u}),c}catch{s.signal.aborted&&(i=!0),XB.error(`${o} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==s)}}throw i?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}},L0e=eM;var B0e=L0e;var{code:SVe}=hr("dnsaddr");async function M0e(r,e={}){let t=new B0e;e.signal!=null&&e.signal.addEventListener("abort",()=>{t.cancel()});let n=r.getPeerId(),[,i]=r.stringTuples().find(([a])=>a===SVe)??[];if(i==null)throw new Error("No hostname found in multiaddr");let s=(await t.resolveTxt(`_dnsaddr.${i}`)).flat().map(a=>a.split("=")[1]);return n!=null&&(s=s.filter(a=>a.includes(n))),s}var xx=C(ee(),1);var CVe={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:100,maxDialsPerPeer:4,dialTimeout:3e4,inboundUpgradeTimeout:3e4,resolvers:{dnsaddr:M0e},addressSorter:ig},connectionGater:{},transportManager:{faultTolerance:Qd.FATAL_ALL},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:9e5,enabled:!1,ttl:18e5},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:KB},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function U0e(r){var t,n;let e=et(CVe,r);if(e.transports==null||e.transports.length<1)throw(0,xx.default)(new Error(Rt.ERR_TRANSPORTS_REQUIRED),q.ERR_TRANSPORTS_REQUIRED);if(e.connectionEncryption==null||e.connectionEncryption.length===0)throw(0,xx.default)(new Error(Rt.CONN_ENCRYPTION_REQUIRED),q.CONN_ENCRYPTION_REQUIRED);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw(0,xx.default)(new Error(Rt.ERR_PROTECTOR_REQUIRED),q.ERR_PROTECTOR_REQUIRED);return e.identify.host.agentVersion===KB&&(w0e||g0e?e.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(T0||rx||y0e||b0e)&&(e.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),e}var iM;(function(r){let e;r.codec=()=>(e==null&&(e=Cr((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.id!=null&&t.id.byteLength>0)&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={id:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.id=t.bytes();break;case 2:i.pubKey=t.bytes();break;case 3:i.privKey=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Rr(t,r.codec()),r.decode=t=>Ir(t,r.codec())})(iM||(iM={}));var F0e=async()=>{let r=await H9("Ed25519"),e=await PVe(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function PVe(r){return await Yd(Ppe(r.public),kpe(r))}var D4=C(ee(),1);var pa=C(ee(),1);var Sx=class extends Zt{get[a9](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}get lan(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}get(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}findProviders(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}findPeer(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}getClosestPeers(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}provide(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}put(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}async getMode(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}async setMode(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}async refreshRoutingTable(){throw(0,pa.default)(new Error(Rt.DHT_DISABLED),q.DHT_DISABLED)}};var ql=C(ee(),1);var Ax=class extends Zt{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}get multicodecs(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}getPeers(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}getTopics(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}subscribe(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}unsubscribe(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}getSubscribers(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}async publish(){throw(0,ql.default)(new Error(Rt.PUBSUB_DISABLED),q.ERR_PUBSUB_DISABLED)}};var yg=C(ee(),1);var t1e=C(Kn(),1),sM=C(Da(),1),r1e=C(xi(),1);var N4=C(ee(),1),Z0e=C(Da(),1),J0e=C(Q0e(),1),oM=C(xi(),1);var X0e=ue("libp2p:dialer:dial-request"),Tx=class{constructor(e){let{addrs:t,dialAction:n,dialer:i}=e;this.addrs=t,this.dialer=i,this.dialAction=n}async run(e={}){var a;let t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw(0,N4.default)(new Error("No dial tokens available"),q.ERR_NO_DIAL_TOKENS);let n=new J0e.default;for(let c of t)n.push(c).catch(u=>{X0e.error(u)});let i=this.addrs.map(()=>{var u;let c=new AbortController;try{(u=oM.setMaxListeners)==null||u(1/0,c.signal)}catch{}return c});if(e.signal!=null)try{(a=oM.setMaxListeners)==null||a(1/0,e.signal)}catch{}let o=0,s=!1;try{return await Promise.any(this.addrs.map(async(c,u)=>{let l=await n.shift();if(s)throw this.dialer.releaseToken(t.splice(t.indexOf(l),1)[0]),(0,N4.default)(new Error("dialAction already succeeded"),q.ERR_ALREADY_SUCCEEDED);let f=i[u];if(f==null)throw(0,N4.default)(new Error("dialAction did not come with an AbortController"),q.ERR_INVALID_PARAMETERS);let h;try{let d=f.signal;h=await this.dialAction(c,{...e,signal:e.signal!=null?(0,Z0e.anySignal)([d,e.signal]):d}),i[u]=void 0}finally{o++,this.addrs.length-o>=t.length?n.push(l).catch(d=>{X0e.error(d)}):this.dialer.releaseToken(t.splice(t.indexOf(l),1)[0])}if(h==null)throw(0,N4.default)(new Error("dialAction led to empty object"),q.ERR_TRANSPORT_DIAL_FAILED);return s=!0,h}))}finally{i.forEach(c=>{c!==void 0&&c.abort()}),t.forEach(c=>this.dialer.releaseToken(c))}}};var Eu=ue("libp2p:dialer"),Ix=class{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??ig,this.maxAddrsToDial=t.maxAddrsToDial??25,this.timeout=t.dialTimeout??3e4,this.maxDialsPerPeer=t.maxDialsPerPeer??4,this.tokens=[...new Array(t.maxParallelDials??100)].map((n,i)=>i),this.components=e,this.pendingDials=bs({name:"libp2p_dialler_pending_dials",metrics:e.metrics}),this.pendingDialTargets=bs({name:"libp2p_dialler_pending_dial_targets",metrics:e.metrics});for(let[n,i]of Object.entries(t.resolvers??{}))iD.set(n,i)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(let e of this.pendingDials.values())try{e.controller.abort()}catch(t){Eu.error(t)}this.pendingDials.clear();for(let e of this.pendingDialTargets.values())e.abort();this.pendingDialTargets.clear()}async dial(e,t={}){let{peerId:n,multiaddr:i}=_9(e);if(n!=null){if(this.components.peerId.equals(n))throw(0,yg.default)(new Error("Tried to dial self"),q.ERR_DIALED_SELF);if(i!=null&&(Eu("storing multiaddrs %p",n,i),await this.components.peerStore.addressBook.add(n,[i])),await this.components.connectionGater.denyDialPeer(n))throw(0,yg.default)(new Error("The dial request is blocked by gater.allowDialPeer"),q.ERR_PEER_DIAL_INTERCEPTED)}Eu("creating dial target for %p",n);let o=new AbortController,s=e1e();this.pendingDialTargets.set(s,o);let a=o.signal;t.signal!=null&&(a=(0,sM.anySignal)([a,t.signal]));let c;try{c=await this._createDialTarget({peerId:n,multiaddr:i},{...t,signal:a})}finally{this.pendingDialTargets.delete(s)}if(c.addrs.length===0)throw(0,yg.default)(new Error("The dial request has no valid addresses"),q.ERR_NO_VALID_ADDRESSES);let u=this.pendingDials.get(c.id)??this._createPendingDial(c,t);try{let l=await u.promise;return Eu("dial succeeded to %s",c.id),l}catch(l){throw Eu("dial failed to %s",c.id,l),u.controller.signal.aborted&&(l.code=q.ERR_TIMEOUT),Eu.error(l),l}finally{u.destroy()}}async _createDialTarget(e,t){let n=[];if(as(e.multiaddr)&&n.push(e.multiaddr),!as(e.multiaddr)&&u0(e.peerId)&&n.push(...await this._loadAddresses(e.peerId)),n=(await Promise.all(n.map(async o=>await this._resolve(o,t)))).flat().filter(o=>!!this.components.transportManager.transportForMultiaddr(o)),n=[...new Set(n.map(o=>o.toString()))].map(o=>lt(o)),n.length>this.maxAddrsToDial)throw(0,yg.default)(new Error("dial with more addresses than allowed"),q.ERR_TOO_MANY_ADDRESSES);let i=u0(e.peerId)?e.peerId:void 0;if(i!=null){let o=`/p2p/${i.toString()}`;n=n.map(s=>{let a=s.getPeerId();return a==null||!i.equals(a)?s.encapsulate(o):s})}return{id:i==null?e1e():i.toString(),addrs:n}}async _loadAddresses(e){let t=await this.components.peerStore.addressBook.get(e);return(await Promise.all(t.map(async n=>await this.components.connectionGater.denyDialMultiaddr(e,n.multiaddr)?!1:n))).filter(DVe).sort(this.addressSorter).map(n=>n.multiaddr)}_createPendingDial(e,t={}){var u;let n=async(l,f={})=>{var h;if(((h=f.signal)==null?void 0:h.aborted)===!0)throw(0,yg.default)(new Error("already aborted"),q.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(l,f).catch(d=>{throw Eu.error("dial to %s failed",l,d),d})},i=new Tx({addrs:e.addrs,dialAction:n,dialer:this}),o=new t1e.TimeoutController(this.timeout),s=[o.signal];t.signal!=null&&s.push(t.signal);let a=(0,sM.anySignal)(s);try{(u=r1e.setMaxListeners)==null||u(1/0,a)}catch{}let c={dialRequest:i,controller:o,promise:i.run({...t,signal:a}),destroy:()=>{o.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,c),c}getTokens(e){let t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,t);return Eu("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),n}releaseToken(e){this.tokens.includes(e)||(Eu("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];let i=await this._resolveRecord(e,t);return(await Promise.all(i.map(async a=>await this._resolve(a,t)))).flat().reduce((a,c)=>(a.find(u=>u.equals(c))==null&&a.push(c),a),[])}async _resolveRecord(e,t){try{return e=lt(e.toString()),await e.resolve(t)}catch(n){return Eu.error(`multiaddr ${e.toString()} could not be resolved`,n),[]}}};function DVe(r){return!!r}function e1e(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var Hl=ue("libp2p"),aM=class extends Zt{constructor(e){super(),this.started=!1,this.peerId=e.peerId;let t=this.components=new Ex({peerId:e.peerId,datastore:e.datastore??new A3,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new bx(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics!=null&&(this.metrics=this.components.metrics=this.configureComponent(e.metrics(this.components))),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",s=>{let{detail:a}=s;this.dispatchEvent(new ve("peer:discovery",{detail:a}))}),e.connectionProtector!=null&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new X9(this.components,{connectionEncryption:(e.connectionEncryption??[]).map(s=>this.configureComponent(s(this.components))),muxers:(e.streamMuxers??[]).map(s=>this.configureComponent(s(this.components))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new Ix(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new x9(this.components,e.connectionManager),this.components.connectionManager.addEventListener("peer:disconnect",s=>{this.dispatchEvent(new ve("peer:disconnect",{detail:s.detail}))}),this.components.connectionManager.addEventListener("peer:connect",s=>{this.dispatchEvent(new ve("peer:connect",{detail:s.detail}))}),this.registrar=this.components.registrar=new Q9(this.components),this.components.transportManager=new j9(this.components,e.transportManager),this.components.addressManager=new p9(this.components,e.addresses),this.configureComponent(new ix(this.components)),this.configureComponent(new S9(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));let n=b0.generateOptions();this.keychain=this.configureComponent(new b0(this.components,{...n,...e.keychain})),this.services.push(new nx(this.components,e.nat)),e.transports.forEach(s=>{this.components.transportManager.add(this.configureComponent(s(this.components)))}),this.identifyService=new mg(this.components,{...e.identify}),this.configureComponent(this.identifyService),e.dht!=null?this.dht=this.components.dht=e.dht(this.components):this.dht=new Sx,e.pubsub!=null?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new Ax;let i=(e.peerRouters??[]).map(s=>this.configureComponent(s(this.components)));e.dht!=null&&(i.push(this.configureComponent(new ox(this.dht))),this.dht.addEventListener("peer",s=>{this.onDiscoveryPeer(s)})),this.peerRouting=this.components.peerRouting=this.configureComponent(new f9(this.components,{...e.peerRouting,routers:i}));let o=(e.contentRouters??[]).map(s=>this.configureComponent(s(this.components)));e.dht!=null&&o.push(this.configureComponent(new _x(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new h9(this.components,{routers:o})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new I9(this.components,e.relay))),this.configureComponent(new L9(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new J9(this.components,{...e.fetch})),this.pingService=this.configureComponent(new ex(this.components,{...e.ping}));for(let s of e.peerDiscovery??[])this.configureComponent(s(this.components)).addEventListener("peer",c=>{this.onDiscoveryPeer(c)})}configureComponent(e){return Cl(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,Hl("libp2p is starting");try{await Promise.all(this.services.map(async e=>{e.beforeStart!=null&&await e.beforeStart()})),await Promise.all(this.services.map(e=>e.start())),await Promise.all(this.services.map(async e=>{e.afterStart!=null&&await e.afterStart()})),Hl("libp2p has started")}catch(e){throw Hl.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(Hl("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map(async e=>{e.beforeStop!=null&&await e.beforeStop()})),await Promise.all(this.services.map(e=>e.stop())),await Promise.all(this.services.map(async e=>{e.afterStop!=null&&await e.afterStop()})),Hl("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){let e=new Nl;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return await this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,n={}){if(t==null)throw(0,D4.default)(new Error("no protocols were provided to open a stream"),q.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],t.length===0)throw(0,D4.default)(new Error("no protocols were provided to open a stream"),q.ERR_INVALID_PROTOCOLS_FOR_STREAM);return await(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){as(e)&&(e=xt(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(Hl("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;let n=await this.peerStore.get(e);if(n.pubKey!=null)return n.pubKey;if(this.dht==null)throw(0,D4.default)(new Error("Public key was not in the peer store and the DHT is not enabled"),q.ERR_NO_ROUTERS_AVAILABLE);let i=yr([fe("/pk/"),e.multihash.digest]);for await(let o of this.dht.get(i,t))if(o.name==="VALUE"){let s=g4(o.value);return await this.peerStore.keyBook.set(e,o.value),s.bytes}throw(0,D4.default)(new Error(`Node not responding with its public key: ${e.toString()}`),q.ERR_INVALID_RECORD)}async fetch(e,t,n={}){if(as(e)){let i=xt(e.getPeerId()??"");await this.components.peerStore.addressBook.add(i,[e]),e=i}return await this.fetchService.fetch(e,t,n)}async ping(e,t={}){if(as(e)){let n=xt(e.getPeerId()??"");await this.components.peerStore.addressBook.add(n,[e]),e=n}return await this.pingService.ping(e,t)}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async i=>{await this.components.registrar.handle(i,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return await this.registrar.register(e,t)}unregister(e){this.registrar.unregister(e)}onDiscoveryPeer(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){Hl.error(new Error(q.ERR_DISCOVERED_SELF));return}t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch(n=>Hl.error(n)),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch(n=>Hl.error(n)),this.dispatchEvent(new ve("peer:discovery",{detail:t}))}};async function n1e(r){if(r.peerId==null){let e=r.datastore;if(e!=null)try{let t=new b0({datastore:e},{...b0.generateOptions(),...r.keychain??{}});r.peerId=await t.exportPeerId("self")}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}}return r.peerId==null&&(r.peerId=await F0e()),new aM(U0e(r))}async function i1e(r){let e=await n1e(r);return r.start!==!1&&await e.start(),e}var I1e=C(f1e(),1);var m1e=C(dB(),1);var g1e=C(h1e(),1),{isValid:zVe,parse:VVe}=g1e.default,KVe=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],$Ve=KVe.map(r=>new m1e.Netmask(r));function qVe(r){for(let e of $Ve)if(e.contains(r))return!0;return!1}function p1e(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}var y1e=r=>{if(zVe(r)){let e=VVe(r);if(e.kind()==="ipv4")return qVe(e.toNormalizedString());if(e.kind()==="ipv6")return p1e(r)}else if(xc(r)&&k9.v6().test(r))return p1e(r)};var dM=y1e;var w1e="/lan",b1e="/ipfs",_1e="/kad/1.0.0",E1e="/dht/record",hM="/dht/provider";var HVe=Ie("/pk/");function bg(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let i=dM(n);return i==null?!0:!i})}}function _g(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(n==="localhost")return!0;if(t!==4&&t!==6||n==null)return!1;let i=dM(n);return i??!1})}}async function xu(r){return(await dt.digest(r)).digest}async function Es(r){return await xu(r.toBytes())}function Gl(r){return new pe(`${E1e}/${re(r,"base32")}`,!1)}function v1e(r){return rt([HVe,r.toBytes()])}function x1e(r){return re(r.subarray(0,4))==="/pk/"}function S1e(r){return Di(r.subarray(4))}function pM(r,e){let t=new Date;return new Yr(r,e,t).serialize()}function A1e(r,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{r()},e)}}var R1e=C(Kn(),1);function jl(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}var gM=class{constructor(e){B(this,"map");if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return jl(this.map.entries(),e=>[Oe(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,Oe(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return jl(this.map.keys(),e=>Oe(e))}values(){return this.map.values()}get size(){return this.map.size}};var ma=class{constructor(e){B(this,"set");if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return jl(this.set.entries(),e=>{let t=Oe(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=Oe(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return jl(this.set.values(),e=>Oe(e))}intersection(e){let t=new ma;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new ma;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new ma;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};var Eg=class{constructor(e){B(this,"list");if(this.list=[],e!=null)for(let t of e)this.list.push(t.toString())}[Symbol.iterator](){return jl(this.list.entries(),e=>Oe(e[1]))}concat(e){let t=new Eg(this);for(let n of e)t.push(n);return t}entries(){return jl(this.list.entries(),e=>[e[0],Oe(e[1])])}every(e){return this.list.every((t,n)=>e(Oe(t),n,this))}filter(e){let t=new Eg;return this.list.forEach((n,i)=>{let o=Oe(n);e(o,i,this)&&t.push(o)}),t}find(e){let t=this.list.find((n,i)=>e(Oe(n),i,this));if(t!=null)return Oe(t)}findIndex(e){return this.list.findIndex((t,n)=>e(Oe(t),n,this))}forEach(e){this.list.forEach((t,n)=>{e(Oe(t),n,this)})}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){let e=this.list.pop();if(e!=null)return Oe(e)}push(...e){for(let t of e)this.list.push(t.toString())}shift(){let e=this.list.shift();if(e!=null)return Oe(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)t=this.list.unshift(e[n].toString());return t}get length(){return this.list.length}};var GVe="kad-close",jVe=50,T1e=20,WVe=1e4,YVe=10,kx=class{constructor(e,t){let{kBucketSize:n,pingTimeout:i,lan:o,pingConcurrency:s,protocol:a,tagName:c,tagValue:u}=t;this.components=e,this.log=j(`libp2p:kad-dht:${o?"lan":"wan"}:routing-table`),this.kBucketSize=n??T1e,this.pingTimeout=i??WVe,this.pingConcurrency=s??YVe,this.lan=o,this.running=!1,this.protocol=a,this.tagName=c??GVe,this.tagValue=u??jVe;let l=()=>{var f,h;(f=this.metrics)==null||f.pingQueueSize.update(this.pingQueue.size),(h=this.metrics)==null||h.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new qn({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});let e=new I1e.default({localNodeId:await Es(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new ma,n=A1e(()=>{let i=new ma(e.closest(e.localNodeId,T1e).map(a=>a.peer)),o=i.difference(t),s=t.difference(i);Promise.resolve().then(async()=>{for(let a of o)await this.components.peerStore.tagPeer(a,this.tagName,{value:this.tagValue});for(let a of s)await this.components.peerStore.unTagPeer(a,this.tagName)}).catch(a=>{this.log.error("Could not update peer tags",a)}),t=i});e.on("added",()=>{n()}),e.on("removed",()=>{n()})}_onPing(e,t){this.pingQueue.add(async()=>{if(!this.running)return;let n=0;try{await Promise.all(e.map(async i=>{var s;let o;try{o=new R1e.TimeoutController(this.pingTimeout);let a={signal:o.signal};this.log("pinging old contact %p",i.peer),(await(await this.components.connectionManager.openConnection(i.peer,a)).newStream(this.protocol,a)).close(),n++}catch(a){this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",i.peer,a),this.log("evicting old contact after ping failed %p",i),this.kb.remove(i.id))}finally{o!=null&&o.clear(),(s=this.metrics)==null||s.routingTableSize.update(this.size)}})),this.running&&n<e.length&&this.kb!=null&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(i){this.log.error("could not process k-bucket ping event",i)}}).catch(n=>{this.log.error("could not process k-bucket ping event",n)})}get size(){return this.kb==null?0:this.kb.count()}async find(e){let t=await Es(e),n=this.closestPeer(t);if(n!=null&&e.equals(n))return n}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:this.kb.closest(e,t).map(i=>i.peer)}async add(e){var n;if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Es(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),(n=this.metrics)==null||n.routingTableSize.update(this.size)}async remove(e){var n;if(this.kb==null)throw new Error("RoutingTable is not started");let t=await Es(e);this.kb.remove(t),(n=this.metrics)==null||n.routingTableSize.update(this.size)}};function Wl(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=vf(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return wf(t)}var C1e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];async function L4(r){let e=0;for await(let t of r)e++;return e}var P1e=C(Kn(),1);var Nx=15,Dx=class{constructor(e){let{peerRouting:t,routingTable:n,refreshInterval:i,refreshQueryTimeout:o,lan:s}=e;this.log=j(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=i??3e5,this.refreshQueryTimeout=o??3e4,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,o)=>{try{if(await this._refreshCommonPrefixLength(o,i,e),this._numPeersForCpl(t)===0){let s=Math.min(2*(o+1),n.length-1);for(let a=o+1;a<s+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(s){this.log.error(s)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);let o=new P1e.TimeoutController(this.refreshQueryTimeout);try{let s=await L4(this.peerRouting.getClosestPeers(i.toBytes(),{signal:o.signal}));this.log(`found ${s} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{o.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>Nx&&(e=Nx);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");let t=Mc(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return Di(i)}async _makePeerId(e,t,n){if(n>Nx)throw new Error(`Cannot generate peer ID for common prefix length greater than ${Nx}`);let s=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=s&a|t&~a,u=C1e[c],l=new ArrayBuffer(34),f=new DataView(l,0,l.byteLength);return f.setUint8(0,dt.code),f.setUint8(1,32),f.setUint32(2,u,!1),new Uint8Array(f.buffer,f.byteOffset,f.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(let{id:e}of this.routingTable.kb.toIterable()){let t=Wl(this.routingTable.kb.localNodeId,e),n=0;for(let i of t)if(i===0)n++;else break;yield n}}};var k1e;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.key=t.bytes();break;case 2:i.value=t.bytes();break;case 3:i.author=t.bytes();break;case 4:i.signature=t.bytes();break;case 5:i.timeReceived=t.string();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(k1e||(k1e={}));var ih;(function(r){let e;(function(a){a.PUT_VALUE="PUT_VALUE",a.GET_VALUE="GET_VALUE",a.ADD_PROVIDER="ADD_PROVIDER",a.GET_PROVIDERS="GET_PROVIDERS",a.FIND_NODE="FIND_NODE",a.PING="PING"})(e=r.MessageType||(r.MessageType={}));let t;(function(a){a[a.PUT_VALUE=0]="PUT_VALUE",a[a.GET_VALUE=1]="GET_VALUE",a[a.ADD_PROVIDER=2]="ADD_PROVIDER",a[a.GET_PROVIDERS=3]="GET_PROVIDERS",a[a.FIND_NODE=4]="FIND_NODE",a[a.PING=5]="PING"})(t||(t={})),function(a){a.codec=()=>Y1(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(a){a.NOT_CONNECTED="NOT_CONNECTED",a.CONNECTED="CONNECTED",a.CAN_CONNECT="CAN_CONNECT",a.CANNOT_CONNECT="CANNOT_CONNECT"})(n=r.ConnectionType||(r.ConnectionType={}));let i;(function(a){a[a.NOT_CONNECTED=0]="NOT_CONNECTED",a[a.CONNECTED=1]="CONNECTED",a[a.CAN_CONNECT=2]="CAN_CONNECT",a[a.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(i||(i={})),function(a){a.codec=()=>Y1(i)}(n=r.ConnectionType||(r.ConnectionType={}));let o;(function(a){let c;a.codec=()=>(c==null&&(c=kn((u,l,f={})=>{if(f.lengthDelimited!==!1&&l.fork(),u.id!=null&&(l.uint32(10),l.bytes(u.id)),u.addrs!=null)for(let h of u.addrs)l.uint32(18),l.bytes(h);u.connection!=null&&(l.uint32(24),r.ConnectionType.codec().encode(u.connection,l)),f.lengthDelimited!==!1&&l.ldelim()},(u,l)=>{let f={addrs:[]},h=l==null?u.len:u.pos+l;for(;u.pos<h;){let d=u.uint32();switch(d>>>3){case 1:f.id=u.bytes();break;case 2:f.addrs.push(u.bytes());break;case 3:f.connection=r.ConnectionType.codec().decode(u);break;default:u.skipType(d&7);break}}return f})),c),a.encode=u=>Pn(u,a.codec()),a.decode=u=>Cn(u,a.codec())})(o=r.Peer||(r.Peer={}));let s;r.codec=()=>(s==null&&(s=kn((a,c,u={})=>{if(u.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.MessageType.codec().encode(a.type,c)),a.clusterLevelRaw!=null&&(c.uint32(80),c.int32(a.clusterLevelRaw)),a.key!=null&&(c.uint32(18),c.bytes(a.key)),a.record!=null&&(c.uint32(26),c.bytes(a.record)),a.closerPeers!=null)for(let l of a.closerPeers)c.uint32(66),r.Peer.codec().encode(l,c);if(a.providerPeers!=null)for(let l of a.providerPeers)c.uint32(74),r.Peer.codec().encode(l,c);u.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let u={closerPeers:[],providerPeers:[]},l=c==null?a.len:a.pos+c;for(;a.pos<l;){let f=a.uint32();switch(f>>>3){case 1:u.type=r.MessageType.codec().decode(a);break;case 10:u.clusterLevelRaw=a.int32();break;case 2:u.key=a.bytes();break;case 3:u.record=a.bytes();break;case 8:u.closerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;case 9:u.providerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;default:a.skipType(f&7);break}}return u})),s),r.encode=a=>Pn(a,r.codec()),r.decode=a=>Cn(a,r.codec())})(ih||(ih={}));var Sn=ih.MessageType,ZVe=ih.ConnectionType,O1e=Object.keys(Sn),jr=class{constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){let e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return ih.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(N1e),providerPeers:this.providerPeers.map(N1e),record:this.record==null?void 0:this.record.serialize().subarray()})}static deserialize(e){var i;let t=ih.decode(e),n=new jr(t.type??ih.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(D1e),n.providerPeers=t.providerPeers.map(D1e),((i=t.record)==null?void 0:i.length)!=null&&(n.record=Yr.deserialize(t.record)),n}};function N1e(r){return{id:r.id.toBytes(),addrs:(r.multiaddrs??[]).map(t=>t.bytes),connection:ZVe.CONNECTED}}function D1e(r){if(r.id==null)throw new Error("Invalid peer in message");return{id:Di(r.id),multiaddrs:(r.addrs??[]).map(e=>yt(e)),protocols:[]}}function yM(r){return{...r,name:"SENDING_QUERY",type:0,messageName:r.type,messageType:O1e.indexOf(r.type.toString())}}function B4(r){return{...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer!=null?r.closer:[],providers:r.providers!=null?r.providers:[]}}function M4(r){return{...r,name:"FINAL_PEER",type:2}}function lo(r){return{...r,name:"QUERY_ERROR",type:3}}function wM(r){return{...r,name:"PROVIDER",type:4}}function U4(r){return{...r,name:"VALUE",type:5}}function bM(r){return{...r,name:"DIALING_PEER",type:7}}var Ox=class extends Ki{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=j(`libp2p:kad-dht:${i?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield bM({peer:e}),yield yM({to:e,type:t.type});let i;try{let s=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),a=await this._writeReadMessage(s,t.serialize(),n);yield B4({from:e,messageType:a.type,closer:a.closerPeers,providers:a.providerPeers,record:a.record})}catch(o){yield lo({from:e,error:o})}finally{i!=null&&i.close()}}async*sendMessage(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield bM({peer:e}),yield yM({to:e,type:t.type});let i;try{let s=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);await this._writeMessage(s,t.serialize(),n),yield B4({from:e,messageType:t.type})}catch(o){yield lo({from:e,error:o})}finally{i!=null&&i.close()}}async _writeMessage(e,t,n){n.signal!=null&&(e=nL(e,n.signal)),await Ne([t],vn(),e,sl)}async _writeReadMessage(e,t,n){n.signal!=null&&(e=nL(e,n.signal));let i=await Ne([t],vn(),e,Xr(),async s=>{let a=await mp(s);if(a!=null)return a;throw new J("No message received","ERR_NO_MESSAGE_RECEIVED")}),o=jr.deserialize(i);return o.closerPeers.forEach(s=>{this.dispatchEvent(new cn("peer",{detail:s}))}),o.providerPeers.forEach(s=>{this.dispatchEvent(new cn("peer",{detail:s}))}),o}};async function vg(r,e){let t=e.key,i=re(t).split("/");if(i.length<3)return;let o=r[i[1].toString()];if(o==null){let s="Invalid record keytype";throw new J(s,"ERR_INVALID_RECORD_KEY_TYPE")}await o(t,e.value)}var JVe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new J('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(r.byteLength<5)throw new J("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(re(r.subarray(0,4))!=="/pk/")throw new J("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");let n=r.slice(4),i=await dt.digest(e);if(!mt(n,i.bytes))throw new J("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},L1e={pk:JVe};function B1e(r,e,t){if(t.length===0){let s="No records given";throw new J(s,"ERR_NO_RECORDS_RECEIVED")}let i=re(e).split("/");if(i.length<3){let s="Record key does not have a selector function";throw new J(s,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}let o=r[i[1].toString()];if(o==null){let s=`Unrecognized key prefix: ${i[1]}`;throw new J(s,"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:o(e,t)}function eKe(r,e){return 0}var M1e={pk:eKe};var Lx=class{constructor(e,t){let{validators:n,selectors:i,peerRouting:o,queryManager:s,routingTable:a,network:c,lan:u}=t;this.components=e,this.log=j(`libp2p:kad-dht:${u?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=i,this.peerRouting=o,this.queryManager=s,this.routingTable=a,this.network=c}async putLocal(e,t){let n=Gl(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);let t=Gl(e);this.log("fetching record for key %k",t);let n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let i=Yr.deserialize(n);return await vg(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);let o=pM(e,n);for(let{value:s,from:a}of t){if(mt(s,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{let l=Gl(e);this.log(`Storing corrected record for key ${l.toString()}`),await this.components.datastore.put(l,o.subarray())}catch(l){this.log.error("Failed error correcting self",l)}continue}let c=!1,u=new jr(Sn.PUT_VALUE,e,0);u.record=Yr.deserialize(o);for await(let l of this.network.sendRequest(a,u,i))l.name==="PEER_RESPONSE"&&l.record!=null&&mt(l.record.value,Yr.deserialize(o).value)&&(c=!0),yield l;c||(yield lo({from:a,error:new J("value not put correctly","ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);let i=pM(e,t),o=Gl(e);this.log(`storing record for key ${o.toString()}`),await this.components.datastore.put(o,i.subarray()),yield*Ne(this.peerRouting.getClosestPeers(e,{signal:n.signal}),s=>Mi(s,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[],u=new jr(Sn.PUT_VALUE,e,0);u.record=Yr.deserialize(i),this.log("send put to %p",a.peer.id);for await(let l of this.network.sendRequest(a.peer.id,u,n))c.push(l),l.name==="PEER_RESPONSE"&&(l.record!=null&&mt(l.record.value,Yr.deserialize(i).value)||c.push(lo({from:a.peer.id,error:new J("value not put correctly","ERR_PUT_VALUE_INVALID")})));return c}),s=>ep(s,{ordered:!1,concurrency:3}),async function*(s){for await(let a of s)yield*a})}async*get(e,t={}){this.log("get %b",e);let n=[];for await(let a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;let i=n.map(a=>a.value),o=0;try{o=B1e(this.selectors,e,i)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}let s=i[o];if(this.log("GetValue %b %b",e,s),s==null)throw new J("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,s,t),yield n[o]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{let a=await this.getLocal(e);yield U4({value:a.value,from:this.components.peerId})}catch(a){this.log("error getting local value for %b",e,a)}let n=await xu(e),i=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",i.length);let o=this,s=async function*({peer:a,signal:c}){for await(let u of o.peerRouting.getValueOrPeers(a,e,{signal:c}))yield u,u.name==="PEER_RESPONSE"&&u.record!=null&&(yield U4({from:a,value:u.record.value}))};yield*this.queryManager.run(e,i,s,t)}};var Bx=class{constructor(e,t){let{network:n,peerRouting:i,queryManager:o,routingTable:s,providers:a,lan:c}=t;this.components=e,this.log=j(`libp2p:kad-dht:${c?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=o,this.routingTable=s,this.providers=a}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);let i=new jr(Sn.ADD_PROVIDER,e.multihash.bytes,0);i.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let o=0,s=a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[];this.log("putProvider %s to %p",e,a.peer.id);try{this.log("sending provider record for %s to %p",e,a.peer.id);for await(let u of this.network.sendMessage(a.peer.id,i,n))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,a.peer.id),o++),c.push(u)}catch(u){this.log.error("error sending provide record to peer %p",a.peer.id,u),c.push(lo({from:a.peer.id,error:u}))}return c};yield*Ne(this.peerRouting.getClosestPeers(e.multihash.bytes,n),a=>Mi(a,c=>s(c)),a=>ep(a,{ordered:!1,concurrency:3}),async function*(a){for await(let c of a)yield*c}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){let n=this.routingTable.kBucketSize,i=e.multihash.bytes,o=await xu(i),s=this;this.log("findProviders %c",e);let a=await this.providers.getProviders(e);if(a.length>0){let l=[];for(let f of a.slice(0,n))l.push({id:f,multiaddrs:(await this.components.peerStore.addressBook.get(f)??[]).map(h=>h.multiaddr),protocols:[]});yield B4({from:this.components.peerId,messageType:Sn.GET_PROVIDERS,providers:l}),yield wM({from:this.components.peerId,providers:l})}if(a.length>=n)return;let c=async function*({peer:l,signal:f}){let h=new jr(Sn.GET_PROVIDERS,i,0);yield*s.network.sendRequest(l,h,{signal:f})},u=new Set(a.map(l=>l.toString()));for await(let l of this.queryManager.run(i,this.routingTable.closestPeers(o),c,t))if(yield l,l.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,e,l.closer.length);let f=[];for(let h of l.providers)u.has(h.id.toString())||(u.add(h.id.toString()),f.push(h));if(f.length>0&&(yield wM({from:l.from,providers:f})),u.size===n)return}}};function Mx(r,e){if(globalThis.Buffer!=null)return globalThis.Buffer.compare(r,e);for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}var Ux=class{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(i=>i.peerId.equals(e))!=null)return;let t=await Es(e),n={peerId:e,distance:Wl(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((i,o)=>Mx(i.distance,o.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(e.length===0)return!1;if(this.length===0)return!0;let t=await Promise.all(e.map(Es)),n=this.peerDistances[this.peerDistances.length-1].distance;for(let i of t){let o=Wl(this.originDhtKey,i);if(Mx(o,n)<0)return!0}return!1}};var Fx=class{constructor(e,t){let{routingTable:n,network:i,validators:o,queryManager:s,lan:a}=t;this.components=e,this.routingTable=n,this.network=i,this.validators=o,this.queryManager=s,this.log=j(`libp2p:kad-dht:${a?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t,n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}}if(t==null)try{t=await this.components.peerStore.get(e)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr),protocols:[]}}async*_getValueSingle(e,t,n={}){let i=new jr(Sn.GET_VALUE,t,0);yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){let n=v1e(e);for await(let i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){let o=await Hn(Zb.marshalPublicKey({bytes:i.record.value}));if(!o.equals(e))throw new J("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(o.publicKey==null)throw new J("public key missing","ERR_PUBLIC_KEY_MISSING");yield U4({from:e,value:o.publicKey})}throw new J(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);let n=await this.findPeerLocal(e);if(n!=null){this.log("found local"),yield M4({from:this.components.peerId,peer:n});return}let i=await Es(e),o=this.routingTable.closestPeers(i);if(o.find(l=>l.equals(e))!=null)try{let l=await this.components.peerStore.get(e);this.log("found in peerStore"),yield M4({from:this.components.peerId,peer:{id:l.id,multiaddrs:l.addresses.map(f=>f.multiaddr),protocols:[]}});return}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}let a=this,c=async function*({peer:l,signal:f}){let h=new jr(Sn.FIND_NODE,e.toBytes(),0);for await(let d of a.network.sendRequest(l,h,{signal:f}))if(yield d,d.name==="PEER_RESPONSE"){let p=d.closer.find(g=>g.id.equals(e));p!=null&&(yield M4({from:d.from,peer:p}))}},u=!1;for await(let l of this.queryManager.run(e.toBytes(),o,c,t))l.name==="FINAL_PEER"&&(u=!0),yield l;u||(yield lo({from:this.components.peerId,error:new J("Not found","ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let n=await xu(e),i=this.routingTable.closestPeers(n),o=this,s=new Ux(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await s.add(c)}));let a=async function*({peer:c,signal:u}){o.log("closerPeersSingle %s from %p",re(e,"base32"),c);let l=new jr(Sn.FIND_NODE,e,0);yield*o.network.sendRequest(c,l,{signal:u})};for await(let c of this.queryManager.run(e,i,a,t))yield c,c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async u=>{await s.add(u.id)}));this.log("found %d peers close to %b",s.length,e);for(let c of s.peers)yield M4({from:this.components.peerId,peer:{id:c,multiaddrs:(await this.components.peerStore.addressBook.get(c)??[]).map(u=>u.multiaddr),protocols:[]}})}async*getValueOrPeers(e,t,n={}){for await(let i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{let s="invalid record received, discarded";this.log(s),yield lo({from:i.from,error:new J(s,"ERR_INVALID_RECORD")});continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new J("invalid record received","ERR_INVALID_RECORD");await vg(this.validators,new Yr(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let n=await xu(e),i=this.routingTable.closestPeers(n),o=[];for(let s of i)if(!s.equals(t))try{let a=await this.components.peerStore.addressBook.get(s),c=await this.components.peerStore.protoBook.get(s);o.push({id:s,multiaddrs:a.map(u=>u.multiaddr),protocols:c})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return o.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",o.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),o}};var U1e=C(Cy(),1),_M=C(Xo(),1);var Yl=j("libp2p:kad-dht:providers"),zx=class{constructor(e,t={}){let{cacheSize:n,cleanupInterval:i,provideValidity:o}=t;this.components=e,this.cleanupInterval=i??36e5,this.provideValidity=o??864e5,this.cache=(0,U1e.default)(n??256),this.syncQueue=new qn({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{Yl.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{let e=Date.now(),t=0,n=0,i=new Map,o=this.components.datastore.batch(),s=this.components.datastore.query({prefix:hM});for await(let a of s)try{let{cid:c,peerId:u}=F1e(a.key),l=z1e(a.value).getTime(),f=Date.now(),h=f-l,d=h>this.provideValidity;if(Yl("comparing: %d - %d = %d > %d %s",f,l,h,this.provideValidity,d?"(expired)":""),d){n++,o.delete(a.key);let p=i.get(c)??new Set;p.add(u),i.set(c,p)}t++}catch(c){Yl.error(c.message)}i.size>0?(Yl("deleting %d / %d entries",n,t),await o.commit()):Yl("nothing to delete");for(let[a,c]of i){let u=F4(a),l=this.cache.get(u);if(l!=null){for(let f of c)l.delete(f);l.size===0?this.cache.remove(u):this.cache.set(u,l)}}Yl("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){let t=F4(e),n=this.cache.get(t);return n==null&&(n=await oKe(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){await this.syncQueue.add(async()=>{Yl("%p provides %s",t,e);let n=await this._getProvidersMap(e);Yl("loaded %s provs",n.size);let i=new Date;n.set(t.toString(),i);let o=F4(e);this.cache.set(o,n),await iKe(this.components.datastore,e,t,i)})}async getProviders(e){return await this.syncQueue.add(async()=>(Yl("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(n=>Oe(n))),{throwOnTimeout:!0})}};function F4(r){let e=typeof r=="string"?r:re(r.multihash.bytes,"base32");return`${hM}/${e}`}async function iKe(r,e,t,n){let i=[F4(e),"/",t.toString()].join(""),o=new pe(i),s=Uint8Array.from(_M.default.encode(n.getTime()));await r.put(o,s)}function F1e(r){let e=r.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:e[3],peerId:e[4]}}async function oKe(r,e){let t=new Map,n=r.query({prefix:F4(e)});for await(let i of n){let{peerId:o}=F1e(i.key);t.set(o,z1e(i.value))}return t}function z1e(r){return new Date(_M.default.decode(r))}var q1e=C(Kn(),1),H1e=C(Da(),1);var V1e=C(Kn(),1),K1e=C(Da(),1);var sKe=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*$1e(r){let{key:e,startingPeer:t,ourPeerId:n,signal:i,query:o,alpha:s,pathIndex:a,numPaths:c,cleanUp:u,queryFuncTimeout:l,log:f,peersSeen:h}=r,d=new qn({concurrency:s}),p=await xu(e);function g(w,_){if(w==null)return;h.add(w);let x=BigInt("0x"+re(Wl(_,p),"base16"));d.add(async()=>{let m,y=[i];l!=null&&(m=new V1e.TimeoutController(l),y.push(m.signal));let b=(0,K1e.anySignal)(y);try{for await(let E of o({key:e,peer:w,signal:b,pathIndex:a,numPaths:c})){if(b.aborted)return;if(E.name==="PEER_RESPONSE")for(let v of E.closer){if(h.has(v.id)){f("already seen %p in query",v.id);continue}if(n.equals(v.id)){f("not querying ourselves");continue}let S=await Es(v.id);if(BigInt("0x"+re(Wl(S,p),"base16"))>x){f("skipping %p as they are not closer to %b than %p",v.id,e,w);continue}f("querying closer peer %p",v.id),g(v.id,S)}d.emit("completed",E)}m==null||m.clear()}catch(E){i.aborted?d.emit("error",E):d.emit("completed",lo({from:w,error:E}))}finally{m==null||m.clear()}},{priority:sKe-x}).catch(m=>{f.error(m)})}g(t,await Es(t)),yield*aKe(d,i,u,f)}async function*aKe(r,e,t,n){let i=Qt(),o=!0,s=[],a=()=>{o&&(n("clean up queue, results %d, queue size %d, pending tasks %d",s.length,r.size,r.pending),o=!1,r.clear(),s.splice(0,s.length))};for(r.on("completed",c=>{s.push(c),i.resolve()}),r.on("error",c=>{n("queue error",c),a(),i.reject(c)}),r.on("idle",()=>{n("queue idle"),o=!1,i.resolve()}),e.addEventListener("abort",()=>{n("abort queue");let c=o;a(),c&&i.reject(new J("Query aborted","ERR_QUERY_ABORTED"))}),t.addEventListener("cleanup",()=>{a(),i.resolve()});o;)for(await i.promise,i=Qt();s.length>0;){let c=s.shift();c!=null&&(yield c)}yield*s}async function*ga(...r){let e=Ao({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}var z4=C(xi(),1);var Kx=class{constructor(e,t){let{lan:n=!1,disjointPaths:i=20,alpha:o=3}=t;this.components=e,this.disjointPaths=i??20,this.controllers=new Set,this.running=!1,this.alpha=o??3,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&this.metrics==null&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1;for(let e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,n,i={}){var p,g,w;if(!this.running)throw new Error("QueryManager not started");let o=(p=this.metrics)==null?void 0:p.queryTime.timer(),s;if(i.signal==null){s=new q1e.TimeoutController(3e4),i.signal=s.signal;try{z4.setMaxListeners!=null&&(0,z4.setMaxListeners)(1/0,s.signal)}catch{}}let a=new AbortController;this.controllers.add(a);let c=[a.signal];i.signal!=null&&c.push(i.signal);let u=(0,H1e.anySignal)(c);try{z4.setMaxListeners!=null&&(0,z4.setMaxListeners)(1/0,u)}catch{}let l=j(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+re(e,"base58btc")),f=t.slice(0,Math.min(this.disjointPaths,t.length)),h=Date.now(),d=new Ki;try{if(l("query:start"),this.queries++,(g=this.metrics)==null||g.runningQueries.update(this.queries),t.length===0){l.error("Running query with no peers");return}let _=new ma,x=f.map((m,y)=>$1e({key:e,startingPeer:m,ourPeerId:this.components.peerId,signal:u,query:n,pathIndex:y,numPaths:f.length,alpha:this.alpha,cleanUp:d,queryFuncTimeout:i.queryFuncTimeout,log:l,peersSeen:_}));for await(let m of ga(...x))yield m,m.name==="QUERY_ERROR"&&l("error",m.error)}catch(_){if(!(!this.running&&_.code==="ERR_QUERY_ABORTED"))throw _}finally{this.controllers.delete(a),s!=null&&s.clear(),this.queries--,(w=this.metrics)==null||w.runningQueries.update(this.queries),o!=null&&o(),d.dispatchEvent(new cn("cleanup")),l("query:done in %dms",Date.now()-h)}}};var V4=j("libp2p:kad-dht:rpc:handlers:add-provider"),$x=class{constructor(e){let{providers:t}=e;this.providers=t}async handle(e,t){if(V4("start"),t.key==null||t.key.length===0)throw new J("Missing key","ERR_MISSING_KEY");let n;try{n=z.decode(t.key)}catch{throw new J("Invalid CID","ERR_INVALID_CID")}(t.providerPeers==null||t.providerPeers.length===0)&&V4.error("no providers found in message"),await Promise.all(t.providerPeers.map(async i=>{if(!i.id.equals(e)){V4("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){V4("no valid addresses for provider %p. Ignore",e);return}V4("received provider %p for %s (addrs %s)",e,n,i.multiaddrs.map(o=>o.toString())),await this.providers.addProvider(n,i.id)}))}};var G1e=j("libp2p:kad-dht:rpc:handlers:find-node"),qx=class{constructor(e,t){let{peerRouting:n,lan:i}=t;this.components=e,this.peerRouting=n,this.lan=!!i}async handle(e,t){G1e("incoming request from %p for peers closer to %b",e,t.key);let n=[];mt(this.components.peerId.toBytes(),t.key)?n=[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(o=>o.decapsulateCode(Fr("p2p").code)),protocols:[]}]:n=await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?_g:bg).filter(({multiaddrs:o})=>o.length);let i=new jr(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?i.closerPeers=n:G1e("could not find any peers closer to %b than %p",t.key,e),i}};var j1e=j("libp2p:kad-dht:rpc:handlers:get-providers"),Hx=class{constructor(e,t){let{peerRouting:n,providers:i,lan:o}=t;this.components=e,this.peerRouting=n,this.providers=i,this.lan=!!o}async handle(e,t){let n;try{n=z.decode(t.key)}catch{throw new J("Invalid CID","ERR_INVALID_CID")}j1e("%p asking for providers for %s",e,n);let[i,o]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),s=await this._getPeers(i),a=await this._getPeers(o.map(({id:u})=>u)),c=new jr(t.type,t.key,t.clusterLevel);return s.length>0&&(c.providerPeers=s),a.length>0&&(c.closerPeers=a),j1e("got %s providers %s closerPeers",s.length,a.length),c}async _getAddresses(e){return(await this.components.peerStore.addressBook.get(e)).map(n=>n.multiaddr)}async _getPeers(e){let t=[],n=this.lan?_g:bg;for(let i of e){let o=n({id:i,multiaddrs:await this._getAddresses(i),protocols:[]});o.multiaddrs.length>0&&t.push(o)}return t}};var Sg=j("libp2p:kad-dht:rpc:handlers:get-value"),Gx=class{constructor(e,t){let{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){let n=t.key;if(Sg("%p asked for key %b",e,n),n==null||n.length===0)throw new J("Invalid key","ERR_INVALID_KEY");let i=new jr(Sn.GET_VALUE,n,t.clusterLevel);if(x1e(n)){Sg("is public key");let a=S1e(n),c;try{let u=await this.components.peerStore.keyBook.get(a);if(u==null)throw new J("No public key found in key book","ERR_NOT_FOUND");c=u}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u}if(c!=null)return Sg("returning found public key"),i.record=new Yr(n,c,new Date),i}let[o,s]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return o!=null&&(Sg("had record for %b in local datastore",n),i.record=o),s.length>0&&(Sg("had %s closer peers in routing table",s.length),i.closerPeers=s),i}async _checkLocalDatastore(e){Sg("checkLocalDatastore looking for %b",e);let t=Gl(e),n;try{n=await this.components.datastore.get(t)}catch(o){if(o.code==="ERR_NOT_FOUND")return;throw o}let i=Yr.deserialize(n);if(i==null)throw new J("Invalid record","ERR_INVALID_RECORD");if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>1296e5){await this.components.datastore.delete(t);return}return i}};var lKe=j("libp2p:kad-dht:rpc:handlers:ping"),jx=class{async handle(e,t){return lKe("ping from %p",e),t}};var Wx=class{constructor(e,t){let{validators:n}=t;this.components=e,this.log=j("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){let n=t.key;this.log("%p asked us to store value for key %b",e,n);let i=t.record;if(i==null){let o=`Empty record from: ${e.toString()}`;throw this.log.error(o),new J(o,"ERR_EMPTY_RECORD")}try{await vg(this.validators,i),i.timeReceived=new Date;let o=Gl(i.key);await this.components.datastore.put(o,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,o)}catch(o){this.log("did not put record for key %b into datastore %o",n,o)}return t}};var Yx=class{constructor(e,t){let{providers:n,peerRouting:i,validators:o,lan:s}=t;this.log=j("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[Sn.GET_VALUE]:new Gx(e,{peerRouting:i}),[Sn.PUT_VALUE]:new Wx(e,{validators:o}),[Sn.FIND_NODE]:new qx(e,{peerRouting:i,lan:s}),[Sn.ADD_PROVIDER]:new $x({providers:n}),[Sn.GET_PROVIDERS]:new Hx(e,{peerRouting:i,providers:n,lan:s}),[Sn.PING]:new jx}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(i){this.log.error("Failed to update the kbucket store",i)}let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}return await n.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{let{stream:t,connection:n}=e,i=n.remotePeer;try{await this.routingTable.add(i)}catch(s){this.log.error(s)}let o=this;await Ne(t,Xr(),async function*(s){for await(let a of s){let c=jr.deserialize(a);o.log("incoming %s from %p",c.type,i);let u=await o.handleMessage(i,c);u!=null&&(yield u.serialize())}},vn(),t)}).catch(t=>{this.log.error(t)})}};var Qx=class extends Ki{constructor(e,t){super();let{protocol:n,lan:i}=t;this.components=e,this.log=j(`libp2p:kad-dht:topology-listener:${i?"lan":"wan"}`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;let e=hv({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new cn("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}};var vM=C(xi(),1);async function*EM(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}}var W1e=C(Kn(),1),Y1e=C(Da(),1);var Xx=class{constructor(e,t){let{peerRouting:n,lan:i,count:o,interval:s,queryTimeout:a}=t;this.components=e,this.log=j(`libp2p:kad-dht:${i?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=o??20,this.interval=s??3e5,this.queryTimeout=a??3e4}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}_querySelf(){Promise.resolve().then(async()=>{let e=new W1e.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;let t=(0,Y1e.anySignal)([this.controller.signal,e.signal]);try{vM.setMaxListeners!=null&&(0,vM.setMaxListeners)(1/0,t)}catch{}let n=await Ne(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),i=>EM(i,this.count),async i=>await L4(i));this.log("query ran successfully - found %d peers",n)}catch(t){this.log("query error",t)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}}).catch(e=>{this.log("query error",e)})}};var Crr=Symbol.for("@libp2p/peer-discovery"),Ag=Symbol.for("@libp2p/peer-discovery");var hKe=32,pKe=64,K4=class extends Ki{constructor(e,t){super();let{kBucketSize:n,clientMode:i,validators:o,selectors:s,querySelfInterval:a,lan:c,protocolPrefix:u,pingTimeout:l,pingConcurrency:f,maxInboundStreams:h,maxOutboundStreams:d,providers:p}=t;this.running=!1,this.components=e,this.lan=!!c,this.log=j(`libp2p:kad-dht:${c===!0?"lan":"wan"}`),this.protocol=`${u??b1e}${c===!0?w1e:""}${_1e}`,this.kBucketSize=n??20,this.clientMode=i??!0,this.maxInboundStreams=h??hKe,this.maxOutboundStreams=d??pKe,this.routingTable=new kx(e,{kBucketSize:n,lan:this.lan,pingTimeout:l,pingConcurrency:f,protocol:this.protocol}),this.providers=new zx(e,p??{}),this.validators={...L1e,...o},this.selectors={...M1e,...s},this.network=new Ox(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new Kx(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:c}),this.peerRouting=new Fx(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new Lx(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new Bx(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new Dx({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new Yx(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new Qx(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new Xx(e,{peerRouting:this.peerRouting,interval:a,lan:this.lan}),this.network.addEventListener("peer",g=>{let w=g.detail;this.onPeerConnect(w).catch(_=>{this.log.error("could not add %p to routing table",w.id,_)}),this.dispatchEvent(new cn("peer",{detail:w}))}),this.topologyListener.addEventListener("peer",g=>{let w=g.detail;Promise.resolve().then(async()=>{let _=await this.components.peerStore.addressBook.get(w),x={id:w,multiaddrs:_.map(m=>m.multiaddr),protocols:[]};await this.onPeerConnect(x)}).catch(_=>{this.log.error("could not add %p to routing table",w,_)})})}get[Ag](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),this.lan?e=_g(e):e=bg(e),e.multiaddrs.length===0){this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),e==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}};var mKe=j("libp2p:kad-dht"),Zx=class extends Ki{constructor(e,t,n){super(),this.components=e,this.wan=t,this.lan=n,this.wan.addEventListener("peer",i=>{this.dispatchEvent(new cn("peer",{detail:i.detail}))}),this.lan.addEventListener("peer",i=>{this.dispatchEvent(new cn("peer",{detail:i.detail}))})}get[Ag](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(let i of ga(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield i}async*get(e,t={}){let n=!1,i=!1;for await(let o of ga(this.lan.get(e,t),this.wan.get(e,t)))yield o,o.name==="DIALING_PEER"&&(n=!0),o.name==="VALUE"&&(n=!0,o.value!=null&&(i=!0)),o.name==="SENDING_QUERY"&&(n=!0);if(!n)throw new J("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");i||(yield lo({from:this.components.peerId,error:new J("Not found","ERR_NOT_FOUND")}))}async*provide(e,t={}){let n=0,i=0,o=[],s=[this.lan];await this.wan.getMode()==="server"&&s.push(this.wan);for await(let a of ga(...s.map(c=>c.provide(e,t))))yield a,a.name==="SENDING_QUERY"&&n++,a.name==="QUERY_ERROR"&&o.push(a.error),a.name==="PEER_RESPONSE"&&a.messageName==="ADD_PROVIDER"&&(mKe("sent provider record for %s to %p",e,a.from),i++);if(i===0)throw o.length>0?new J(`Failed to provide to ${o.length} of ${n} peers`,"ERR_PROVIDES_FAILED",{errors:o}):new J("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}async*findProviders(e,t={}){yield*ga(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(let i of ga(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield i,(i.name==="SENDING_QUERY"||i.name==="FINAL_PEER")&&(n=!0);if(!n)throw new J("Peer lookup failed","ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*ga(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}};var xM=class extends Zx{constructor(e,t){super(e,new K4(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new K4(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}};function Q1e(r){return e=>new xM(e,r)}var Jx=j("libp2p:bootstrap"),gKe="bootstrap",yKe=50,wKe=12e4,bKe=1e3,eS=class extends Ki{constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??bKe,this.list=[];for(let n of t.list){if(!rR.matches(n)){Jx.error("Invalid multiaddr");continue}let i=Xi(n),o=i.getPeerId();if(o==null){Jx.error("Invalid bootstrap multiaddr without peer id");continue}let s={id:Oe(o),multiaddrs:[i],protocols:[]};this.list.push(s)}this._init=t}get[Ag](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return!!this.timer}start(){this.isStarted()||(Jx("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{Jx.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(let e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??gKe,{value:this._init.tagValue??yKe,ttl:this._init.tagTTL??wKe}),this.timer==null)return;this.dispatchEvent(new cn("peer",{detail:e}))}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}};eS.tag="bootstrap";function X1e(r){return e=>new eS(e,r)}var Z1e=WebSocket;var rme=C(eme(),1);function tme(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}var nme=r=>{r.binaryType="arraybuffer";let e=async()=>await new Promise((o,s)=>{if(n)return o();if(i!=null)return s(i);let a=l=>{r.removeEventListener("open",c),r.removeEventListener("error",u),l()},c=()=>a(o),u=l=>{a(()=>s(l.error??new Error(`connect ECONNREFUSED ${r.url}`)))};r.addEventListener("open",c),r.addEventListener("error",u)}),t=async function*(){let o=new rme.EventIterator(({push:s,stop:a,fail:c})=>{let u=f=>{let h=null;typeof f.data=="string"&&(h=fe(f.data)),tme(f.data)&&(h=new Uint8Array(f.data)),f.data instanceof Uint8Array&&(h=f.data),h!=null&&s(h)},l=f=>c(f.error??new Error("Socket error"));return r.addEventListener("message",u),r.addEventListener("error",l),r.addEventListener("close",a),()=>{r.removeEventListener("message",u),r.removeEventListener("error",l),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(let s of o)yield tme(s)?new Uint8Array(s):s}(),n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",o=>{n||(i=o.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};var ime=r=>{if(r.readyState>=2)throw new Error("socket closed");if(r.readyState!==1)return new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",o)}function i(){n(),e()}function o(s){n(),t(s.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",o)})};var ome=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(let i of n){try{await ime(r)}catch(o){if(o.message==="socket closed")break;throw o}r.send(i)}if(e.closeOnEnd!=null&&r.readyState<=1)return await new Promise((i,o)=>{r.addEventListener("close",s=>{if(s.wasClean||s.code===1006)i();else{let a=Object.assign(new Error("ws error"),{event:s});o(a)}}),setTimeout(()=>r.close())})});var sme=(r,e)=>{e=e??{};let t=nme(r),n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{let s=new URL(r.url);n=s.hostname,i=parseInt(s.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:ome(r,e),source:t,connected:async()=>await t.connected(),close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(s=>{r.addEventListener("close",()=>{s()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}};var ame=C(F8(),1),EKe={http:"ws",https:"wss"},vKe="ws",cme=(r,e)=>(0,ame.relative)(r,e,EKe,vKe);function ume(r,e){let t=typeof window>"u"?"":window.location;e=e??{};let n=cme(r,t.toString()),i=new Z1e(n,e.websocket);return sme(i,e)}function lme(){throw new Error("WebSocket Servers can not be created in the browser!")}var fme=j("libp2p:websockets:socket");function dme(r,e,t){t=t??{};let n={async sink(i){(t==null?void 0:t.signal)!=null&&(i=na(i,t.signal));try{await r.sink(i)}catch(o){o.type!=="aborted"&&fme.error(o)}},source:t.signal!=null?na(r.source,t.signal):r.source,remoteAddr:e,timeline:{open:Date.now()},async close(){let i=Date.now();try{await yp(r.close(),{milliseconds:2e3})}catch{let{host:s,port:a}=n.remoteAddr.toOptions();fme("timeout closing stream to %s:%s after %dms, destroying it manually",s,a,Date.now()-i),r.destroy()}finally{n.timeline.close=Date.now()}}};return r.socket.addEventListener("close",()=>{n.timeline.close==null&&(n.timeline.close=Date.now())},{once:!0}),n}function mme(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return P1.matches(t)||xh.matches(t)})}function gme(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return xh.matches(t)})}var wme=Symbol.for("@libp2p/transport");var yme;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(yme||(yme={}));var oh=j("libp2p:websockets"),TM=class{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[wme](){return!0}async dial(e,t){oh("dialing %s",e),t=t??{};let n=await this._connect(e,t),i=dme(n,e);oh("new outbound connection %s",i.remoteAddr);let o=await t.upgrader.upgradeOutbound(i);return oh("outbound connection %s upgraded",i.remoteAddr),o}async _connect(e,t){var u,l;if(((u=t==null?void 0:t.signal)==null?void 0:u.aborted)===!0)throw new Ph;let n=e.toOptions();oh("dialing %s:%s",n.host,n.port);let i=Qt(),o=f=>{oh.error("connection error:",f),i.reject(f)},s=ume(zm(e),this.init);if(s.socket.on!=null?s.socket.on("error",o):s.socket.onerror=o,t.signal==null)return await Promise.race([s.connected(),i.promise]),oh("connected %s",e),s;let a,c=new Promise((f,h)=>{var d,p;if(a=()=>{h(new Ph),s.close().catch(g=>{oh.error("error closing raw socket",g)})},((d=t==null?void 0:t.signal)==null?void 0:d.aborted)===!0){a();return}(p=t==null?void 0:t.signal)==null||p.addEventListener("abort",a)});try{await Promise.race([c,i.promise,s.connected()])}finally{a!=null&&((l=t==null?void 0:t.signal)==null||l.removeEventListener("abort",a))}return oh("connected %s",e),s}createListener(e){return lme({...this.init,...e})}filter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):T0||rx?gme(e):mme(e)}};function bme(r={}){return()=>new TM(r)}var Tg=C(Xo(),1);function IM(r){return new Uint8Array(r)}var Ut;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(Ut||(Ut={}));var q4=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),RM=Object.freeze({NEW_STREAM:Ut.NEW_STREAM,MESSAGE:Ut.MESSAGE_INITIATOR,CLOSE:Ut.CLOSE_INITIATOR,RESET:Ut.RESET_INITIATOR}),_me=Object.freeze({MESSAGE:Ut.MESSAGE_RECEIVER,CLOSE:Ut.CLOSE_RECEIVER,RESET:Ut.RESET_RECEIVER});var Eme=1024*1024,AKe=(r,e)=>{e.append(r)};async function*TKe(r,e={}){let t=new vt,n=!1,i=Qt(),o=Number(e.size??Eme);(isNaN(o)||o===0||o<0)&&(o=Eme);let s=e.yieldAfter??0,a=e.serialize??AKe;for(Promise.resolve().then(async()=>{try{let c;for await(let u of r){if(a(u,t),t.byteLength>=o){clearTimeout(c),i.resolve();continue}c=setTimeout(()=>{i.resolve()},s)}clearTimeout(c),i.resolve()}catch(c){i.reject(c)}finally{n=!0}});!n;)if(await i.promise,i=Qt(),t.byteLength>0){let c=t;t=new vt,yield c.subarray()}}var vme=TKe;var CM=10*1024,PM=class{constructor(){this._pool=IM(CM),this._poolOffset=0}write(e,t){let n=this._pool,i=this._poolOffset;Tg.default.encode(e.id<<3|e.type,n,i),i+=Tg.default.encode.bytes??0,(e.type===Ut.NEW_STREAM||e.type===Ut.MESSAGE_INITIATOR||e.type===Ut.MESSAGE_RECEIVER)&&e.data!=null?Tg.default.encode(e.data.length,n,i):Tg.default.encode(0,n,i),i+=Tg.default.encode.bytes??0;let o=n.subarray(this._poolOffset,i);CM-i<100?(this._pool=IM(CM),this._poolOffset=0):this._poolOffset=i,t.append(o),(e.type===Ut.NEW_STREAM||e.type===Ut.MESSAGE_INITIATOR||e.type===Ut.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},xme=new PM;async function*Sme(r,e=0){if(e==null||e===0){for await(let t of r){let n=new vt;for(let i of t)xme.write(i,n);yield n.subarray()}return}yield*vme(r,{size:e,serialize:(t,n)=>{for(let i of t)xme.write(i,n)}})}var kM=1<<20,IKe=4<<20,nS=class{constructor(e=kM,t=IKe){this._buffer=new vt,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(u){if(u.code==="ERR_MSG_TOO_BIG")throw u;break}let{id:n,type:i,length:o,offset:s}=this._headerInfo;if(this._buffer.length-s<o)break;let c={id:n,type:i};(i===Ut.NEW_STREAM||i===Ut.MESSAGE_INITIATOR||i===Ut.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(s,s+o)),t.push(c),this._buffer.consume(s+o),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=Tme(e),{value:i,offset:o}=Tme(e,n),s=t&7;if(q4[s]==null)throw new Error(`Invalid type received: ${s}`);if(i>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:s,offset:n+o,length:i}}},RKe=128,Ame=127;function Tme(r,e=0){let t=0,n=0,i=e,o,s=r.length;do{if(i>=s||n>49)throw e=0,new RangeError("Could not decode varint");o=r.get(i++),t+=n<28?(o&Ame)<<n:(o&Ame)*Math.pow(2,n),n+=7}while(o>=RKe);return e=i-e,{value:t,offset:e}}var cc=j("libp2p:mplex:stream"),NM="ERR_STREAM_RESET",CKe="ERR_STREAM_ABORT",PKe="ERR_SINK_ENDED",kKe="ERR_DOUBLE_SINK";function Ime(r){let{id:e,name:t,send:n,onEnd:i,type:o="initiator",maxMsgSize:s=kM}=r,a=new AbortController,c=new AbortController,u=new AbortController,l=o==="initiator"?RM:_me,f=o==="initiator"?`i${e}`:`r${e}`,h=`${t??e}`,d=!1,p=!1,g=!1,w,_={open:Date.now()},x=E=>{d||(d=!0,cc.trace("%s stream %s source end - err: %o",o,h,E),E!=null&&w==null&&(w=E),p&&(b.stat.timeline.close=Date.now(),i!=null&&i(w)))},m=E=>{p||(p=!0,cc.trace("%s stream %s sink end - err: %o",o,h,E),E!=null&&w==null&&(w=E),d&&(_.close=Date.now(),i!=null&&i(w)))},y=Ao({onEnd:x}),b={close:()=>{cc.trace("%s stream %s close",o,h),b.closeRead(),b.closeWrite()},closeRead:()=>{cc.trace("%s stream %s closeRead",o,h),!d&&y.end()},closeWrite:()=>{if(cc.trace("%s stream %s closeWrite",o,h),!p){u.abort();try{n({id:e,type:l.CLOSE})}catch(E){cc.trace("%s stream %s error sending close",o,t,E)}m()}},abort:E=>{cc.trace("%s stream %s abort",o,h,E),y.end(E),a.abort(),m(E)},reset:()=>{let E=new J("stream reset",NM);c.abort(),y.end(E),m(E)},sink:async E=>{if(g)throw new J("sink already called on stream",kKe);if(g=!0,p)throw new J("stream closed for writing",PKe);let v=ia([a.signal,c.signal,u.signal]);try{E=na(E,v),o==="initiator"&&n({id:e,type:RM.NEW_STREAM,data:new vt(Ie(h))});for await(let S of E)for(;S.length>0;){if(S.length<=s){n({id:e,type:l.MESSAGE,data:S instanceof Uint8Array?new vt(S):S});break}S=S instanceof Uint8Array?new vt(S):S,n({id:e,type:l.MESSAGE,data:S.sublist(0,s)}),S.consume(s)}}catch(S){if(S.type==="aborted"&&S.message==="The operation was aborted"){if(u.signal.aborted)return;c.signal.aborted&&(S.message="stream reset",S.code=NM),a.signal.aborted&&(S.message="stream aborted",S.code=CKe)}if(S.code===NM)cc.trace("%s stream %s reset",o,t);else{cc.trace("%s stream %s error",o,t,S);try{n({id:e,type:l.RESET})}catch(A){cc.trace("%s stream %s error sending reset",o,t,A)}}y.end(S),m(S);return}finally{v.clear()}try{n({id:e,type:l.CLOSE})}catch(S){cc.trace("%s stream %s error sending close",o,t,S)}m()},source:y,sourcePush:E=>{y.push(E)},sourceReadableLength(){return y.readableLength},stat:{direction:o==="initiator"?"outbound":"inbound",timeline:_},metadata:{},id:f};return b}var x2e=C(E2e(),1);var uc=j("libp2p:mplex"),h$e=1024,p$e=1024,m$e=1024*1024*4,g$e=5;function v2e(r){let e={...r,type:`${q4[r.type]} (${r.type})`};return r.type===Ut.NEW_STREAM&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===Ut.MESSAGE_INITIATOR||r.type===Ut.MESSAGE_RECEIVER)&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var oS=class{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();let t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new x2e.RateLimiterMemory({points:e.disconnectThreshold??g$e,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>{t.abort(e)}):this.streams.forEach(t=>{t.close()}),this.closeController.abort())}_newReceiverStream(e){let{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){let{id:t,name:n,type:i,registry:o}=e;if(uc("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??p$e))throw new J("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(o.has(t))throw new Error(`${i} stream ${t} already exists!`);let c=Ime({id:t,name:n,send:u=>{uc.enabled&&uc.trace("%s stream %s send",i,t,v2e(u)),this._source.push(u)},type:i,onEnd:()=>{uc("%s stream with id %s and protocol %s ended",i,t,c.stat.protocol),o.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return o.set(t,c),c}_createSink(){return async t=>{let n=ia([this.closeController.signal,this._init.signal]);try{t=na(t,n);let i=new nS(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let o of t)for(let s of i.write(o))await this._handleIncoming(s);this._source.end()}catch(i){uc("error in sink",i),this._source.end(i)}finally{n.clear()}}}_createSource(){let t=Bae({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(Sme(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){let{id:t,type:n}=e;if(uc.enabled&&uc.trace("incoming message",v2e(e)),e.type===Ut.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??h$e)){uc("too many inbound streams open"),this._source.push({id:t,type:Ut.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{uc("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:re(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let o=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(o==null){uc("missing stream %s for message type %s",t,q4[n]);return}let s=this._init.maxStreamBufferSize??m$e;switch(n){case Ut.MESSAGE_INITIATOR:case Ut.MESSAGE_RECEIVER:if(o.sourceReadableLength()>s){this._source.push({id:e.id,type:n===Ut.MESSAGE_INITIATOR?Ut.RESET_RECEIVER:Ut.RESET_INITIATOR});let a=new J("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");o.abort(a);return}o.sourcePush(e.data);break;case Ut.CLOSE_INITIATOR:case Ut.CLOSE_RECEIVER:o.closeRead();break;case Ut.RESET_INITIATOR:case Ut.RESET_RECEIVER:o.reset();break;default:uc("unknown message type %s",n)}}};var GM=class{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new oS({...e,...this._init})}};function S2e(r={}){return()=>new GM(r)}function sS(r){return r[Symbol.asyncIterator]!=null}var aS=r=>{let e=ti(r),t=Ri(e);return xf(r,t),aS.bytes=e,t};aS.bytes=0;function cS(r,e){e=e??{};let t=e.lengthEncoder??aS;function*n(i){let o=t(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}return sS(r)?async function*(){for await(let i of r)yield*n(i)}():function*(){for(let i of r)yield*n(i)}()}cS.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??aS;return new vt(t(r.byteLength),r)};var uS=class extends Error{constructor(){super(...arguments);B(this,"name","InvalidMessageLengthError");B(this,"code","ERR_INVALID_MSG_LENGTH")}},lS=class extends Error{constructor(){super(...arguments);B(this,"name","InvalidDataLengthError");B(this,"code","ERR_MSG_DATA_TOO_LONG")}},fS=class extends Error{constructor(){super(...arguments);B(this,"name","InvalidDataLengthLengthError");B(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},j4=class extends Error{constructor(){super(...arguments);B(this,"name","UnexpectedEOFError");B(this,"code","ERR_UNEXPECTED_EOF")}};var y$e=8,w$e=1024*1024*4,C0;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(C0||(C0={}));var WM=r=>{let e=Gu(r);return WM.bytes=ti(e),e};WM.bytes=0;function jM(r,e){let t=new vt,n=C0.LENGTH,i=-1,o=(e==null?void 0:e.lengthDecoder)??WM,s=(e==null?void 0:e.maxLengthLength)??y$e,a=(e==null?void 0:e.maxDataLength)??w$e;function*c(){for(;t.byteLength>0;){if(n===C0.LENGTH)try{if(i=o(t),i<0)throw new uS("Invalid message length");if(i>a)throw new lS("Message length too long");let u=o.bytes;t.consume(u),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=C0.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>s)throw new fS("Message length length too long");break}throw u}if(n===C0.DATA){if(t.byteLength<i)break;let u=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(u),yield u,n=C0.LENGTH}}}return sS(r)?async function*(){for await(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new j4("Unexpected end of input")}():function*(){for(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new j4("Unexpected end of input")}()}jM.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:o,value:s}=await r.next(t);if(o===!0)return;s!=null&&(yield s)}catch(o){if(o.code==="ERR_UNDER_READ")return{done:!0,value:null};throw o}finally{t=1}}();return jM(n,{...e??{},onLength:o=>{t=o}})};var dS=C(ee(),1),A2e=r=>Yp.decode(r);A2e.bytes=0;function YM(r,e={}){let t=Ao();r.sink(t).catch(s=>{t.end(s)}),r.sink=async s=>{for await(let a of s)t.push(a)};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let i=new vt,o={read:async s=>{if(s==null){let{done:c,value:u}=await n.next();return c===!0?new vt:u}for(;i.byteLength<s;){let{value:c,done:u}=await n.next();if(u===!0)throw(0,dS.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF");i.append(c)}let a=i.sublist(0,s);return i.consume(s),a},readLP:async()=>{let s=-1,a=new vt,c=(e==null?void 0:e.lengthDecoder)??A2e;for(;;){a.append(await o.read(1));try{s=c(a)}catch(u){if(u instanceof RangeError)continue;throw u}if(s>-1)break;if((e==null?void 0:e.maxLengthLength)!=null&&a.byteLength>e.maxLengthLength)throw(0,dS.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG")}if((e==null?void 0:e.maxDataLength)!=null&&s>e.maxDataLength)throw(0,dS.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");return await o.read(s)},readPB:async s=>{let a=await o.readLP();if(a==null)throw new Error("Value is null");let c=a instanceof Uint8Array?a:a.subarray();return s.decode(c)},write:s=>{s instanceof Uint8Array?t.push(s):t.push(s.subarray())},writeLP:s=>{o.write(cS.single(s,e))},writePB:(s,a)=>{o.writeLP(a.encode(s))},pb:s=>({read:async()=>await o.readPB(s),write:a=>{o.writePB(a,s)},unwrap:()=>o}),unwrap:()=>{let s=r.source;return r.source=async function*(){yield*i,yield*s}(),r}};return o}function QM(){let r=Qt(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function T2e(){let r=QM(),e=QM();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}var I2e,R2e,C2e=!!((R2e=(I2e=globalThis.process)==null?void 0:I2e.env)!=null&&R2e.DUMP_SESSION_KEYS);var uge=C(B2e(),1),Ng=C(ege(),1),TS=C(rge(),1),hU=C(dU(),1),lge={hashSHA256(r){return(0,TS.hash)(r)},getHKDF(r,e){let i=new uge.HKDF(TS.SHA256,e,r).expand(96),o=i.subarray(0,32),s=i.subarray(32,64),a=i.subarray(64,96);return[o,s,a]},generateX25519KeyPair(){let r=Ng.generateKeyPair();return{publicKey:r.publicKey,privateKey:r.secretKey}},generateX25519KeyPairFromSeed(r){let e=Ng.generateKeyPairFromSeed(r);return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519SharedKey(r,e){return Ng.sharedKey(r,e)},chaCha20Poly1305Encrypt(r,e,t,n){return new hU.ChaCha20Poly1305(n).seal(e,r,t)},chaCha20Poly1305Decrypt(r,e,t,n,i){return new hU.ChaCha20Poly1305(n).open(e,r,t,i)}};var pU=C(dU(),1);var Rqe=r=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r),Dg=r=>{let e=Rqe(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,r,!1),e};Dg.bytes=2;var J4=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");return r instanceof Uint8Array?new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,!1):r.getUint16(0)};J4.bytes=2;function fge(r){return rt([r.ne,r.ciphertext],r.ne.length+r.ciphertext.length)}function dge(r){return rt([r.ne,r.ns,r.ciphertext],r.ne.length+r.ns.length+r.ciphertext.length)}function hge(r){return rt([r.ns,r.ciphertext],r.ns.length+r.ciphertext.length)}function pge(r){if(r.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:r.subarray(0,32),ciphertext:r.subarray(32,r.length),ns:new Uint8Array(0)}}function mge(r){if(r.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:r.subarray(0,32),ns:r.subarray(32,80),ciphertext:r.subarray(80,r.length)}}function gge(r){if(r.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:r.subarray(0,48),ciphertext:r.subarray(48,r.length)}}function wge(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65519){let o=i+65519;o>n.length&&(o=n.length);let s=r.encrypt(n.subarray(i,o),r.session);e==null||e.encryptedPackets.increment(),yield Dg(s.byteLength),yield s}}}function bge(r,e){return async function*(t){for await(let n of t)for(let i=0;i<n.length;i+=65535){let o=i+65535;if(o>n.length&&(o=n.length),o-pU.TAG_LENGTH<i)throw new Error("Invalid chunk");let s=n.subarray(i,o),a=n.subarray(i,o-pU.TAG_LENGTH),{plaintext:c,valid:u}=r.decrypt(s,r.session,a);if(!u)throw e==null||e.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e==null||e.decryptedPackets.increment(),yield c}}}var P0=class extends Error{constructor(e="Unexpected Peer"){super(e),this.code=P0.code}static get code(){return"ERR_UNEXPECTED_PEER"}},Jl=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=Jl.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}};var IS;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let o of t.webtransportCerthashes)n.uint32(10),n.bytes(o);i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={webtransportCerthashes:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.webtransportCerthashes.push(t.bytes());break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(IS||(IS={}));var t6;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),(i.writeDefaults===!0||t.identityKey!=null&&t.identityKey.byteLength>0)&&(n.uint32(10),n.bytes(t.identityKey??new Uint8Array(0))),(i.writeDefaults===!0||t.identitySig!=null&&t.identitySig.byteLength>0)&&(n.uint32(18),n.bytes(t.identitySig??new Uint8Array(0))),t.extensions!=null&&(n.uint32(34),IS.codec().encode(t.extensions,n,{writeDefaults:!1})),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.identityKey=t.bytes();break;case 2:i.identitySig=t.bytes();break;case 4:i.extensions=IS.codec().decode(t,t.uint32());break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(t6||(t6={}));async function _ge(r,e,t){let n=await Pqe(r,Ege(e));if(r.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return Cqe(r.publicKey,n,t)}function Cqe(r,e,t){return t6.encode({identityKey:r,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function Pqe(r,e){if(r.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return await(await Li(r.privateKey)).sign(e)}async function mU(r){return await Hn(r.identityKey)}function gU(r){return t6.decode(r)}function Ege(r){let e=Ie("noise-libp2p-static-key:");return rt([e,r],e.length+r.length)}async function yU(r,e,t){let n=await Hn(e.identityKey);if(!n.equals(t))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${t.toString()}`);let i=Ege(r);if(n.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await Bs(n.publicKey).verify(i,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function r6(r){return!(!(r instanceof Uint8Array)||r.length!==32)}var di=j("libp2p:noise");var wa;C2e?wa=di:wa=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function vge(r){wa(`LOCAL_STATIC_PUBLIC_KEY ${re(r.publicKey,"hex")}`),wa(`LOCAL_STATIC_PRIVATE_KEY ${re(r.privateKey,"hex")}`)}function wU(r){r?(wa(`LOCAL_PUBLIC_EPHEMERAL_KEY ${re(r.publicKey,"hex")}`),wa(`LOCAL_PRIVATE_EPHEMERAL_KEY ${re(r.privateKey,"hex")}`)):wa("Missing local ephemeral keys.")}function xge(r){wa(`REMOTE_STATIC_PUBLIC_KEY ${re(r,"hex")}`)}function bU(r){wa(`REMOTE_EPHEMERAL_PUBLIC_KEY ${re(r,"hex")}`)}function Sge(r){r.cs1&&r.cs2?(wa(`CIPHER_STATE_1 ${r.cs1.n.getUint64()} ${re(r.cs1.k,"hex")}`),wa(`CIPHER_STATE_2 ${r.cs2.n.getUint64()} ${re(r.cs2.k,"hex")}`)):wa("Missing cipher state.")}var kqe="Cipherstate has reached maximum n, a new handshake must be performed",RS=class{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error(kqe)}};var CS=class{constructor(e){this.crypto=e}encryptWithAd(e,t,n){let i=this.encrypt(e.k,e.n,t,n);return e.n.increment(),i}decryptWithAd(e,t,n,i){let{plaintext:o,valid:s}=this.decrypt(e.k,e.n,t,n,i);return s&&e.n.increment(),{plaintext:o,valid:s}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){let t=this.createEmptyKey();return mt(t,e)}encrypt(e,t,n,i){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(i,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return this.hasKey(e.cs)?n=this.encryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,n),n}decrypt(e,t,n,i,o){t.assertValue();let s=this.crypto.chaCha20Poly1305Decrypt(i,t.getBytes(),n,e,o);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,i=!0;return this.hasKey(e.cs)?{plaintext:n,valid:i}=this.decryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,t),{plaintext:n,valid:i}}dh(e,t){try{let n=this.crypto.generateX25519SharedKey(e,t);return n.length===32?n:n.subarray(0,32)}catch(n){let i=n;return di.error(i),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(rt([e,t],e.length+t.length))}mixKey(e,t){let[n,i]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(i),e.ck=n}initializeKey(e){return{k:e,n:new RS}}initializeSymmetric(e){let t=Ie(e,"utf-8"),n=this.hashProtocolName(t),i=n,o=this.createEmptyKey();return{cs:this.initializeKey(o),ck:i,h:n}}hashProtocolName(e){if(e.length<=32){let t=new Uint8Array(32);return t.set(e),t}else return this.getHash(e,new Uint8Array(0))}split(e){let[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),i=this.initializeKey(t),o=this.initializeKey(n);return{cs1:i,cs2:o}}writeMessageRegular(e,t){let n=this.encryptWithAd(e,new Uint8Array(0),t),i=this.createEmptyKey(),o=new Uint8Array(0);return{ne:i,ns:o,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}};var PS=class extends CS{initializeInitiator(e,t,n,i){let o="Noise_XX_25519_ChaChaPoly_SHA256",s=this.initializeSymmetric(o);this.mixHash(s,e);let a=new Uint8Array(32);return{ss:s,s:t,rs:n,psk:i,re:a}}initializeResponder(e,t,n,i){let o="Noise_XX_25519_ChaChaPoly_SHA256",s=this.initializeSymmetric(o);this.mixHash(s,e);let a=new Uint8Array(32);return{ss:s,s:t,rs:n,psk:i,re:a}}writeMessageA(e,t,n){let i=new Uint8Array(0);n!==void 0?e.e=n:e.e=this.crypto.generateX25519KeyPair();let o=e.e.publicKey;this.mixHash(e.ss,o);let s=this.encryptAndHash(e.ss,t);return{ne:o,ns:i,ciphertext:s}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();let n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let i=e.s.publicKey,o=this.encryptAndHash(e.ss,i);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let s=this.encryptAndHash(e.ss,t);return{ne:n,ns:o,ciphertext:s}}writeMessageC(e,t){let n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let o=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:i,ciphertext:o},{cs1:c,cs2:u}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:c,cs2:u}}readMessageA(e,t){return r6(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(r6(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);i&&r6(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:o,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:o,valid:i&&s}}readMessageC(e,t){let{plaintext:n,valid:i}=this.decryptAndHash(e.ss,t.ns);if(i&&r6(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:o,valid:s}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,plaintext:o,valid:i&&s,cs1:a,cs2:c}}initSession(e,t,n){let i=this.createEmptyKey(),o=new Uint8Array(32),s;return e?s=this.initializeInitiator(t,n,o,i):s=this.initializeResponder(t,n,o,i),{hs:s,i:e,mc:0}}sendMessage(e,t,n){let i;if(e.mc===0)i=this.writeMessageA(e.hs,t,n);else if(e.mc===1)i=this.writeMessageB(e.hs,t);else if(e.mc===2){let{h:o,messageBuffer:s,cs1:a,cs2:c}=this.writeMessageC(e.hs,t);i=s,e.h=o,e.cs1=a,e.cs2=c}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");i=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");i=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,i}recvMessage(e,t){let n=new Uint8Array(0),i=!1;if(e.mc===0)({plaintext:n,valid:i}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:n,valid:i}=this.readMessageB(e.hs,t));else if(e.mc===2){let{h:o,plaintext:s,valid:a,cs1:c,cs2:u}=this.readMessageC(e.hs,t);n=s,i=a,e.h=o,e.cs1=c,e.cs2=u}return e.mc++,{plaintext:n,valid:i}}};var kS=class{constructor(e,t,n,i,o,s,a,c){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=o,this.connection=s,a&&(this.remotePeer=a),this.xx=c??new PS(i),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(vge(this.session.hs.s),this.isInitiator){di.trace("Stage 0 - Initiator starting to send first message.");let e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(fge(e)),di.trace("Stage 0 - Initiator finished sending first message."),wU(this.session.hs.e)}else{di.trace("Stage 0 - Responder waiting to receive first message...");let e=pge((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new Jl("xx handshake stage 0 validation fail");di.trace("Stage 0 - Responder received first message."),bU(this.session.hs.re)}}async exchange(){if(this.isInitiator){di.trace("Stage 1 - Initiator waiting to receive first message from responder...");let e=mge((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new Jl("xx handshake stage 1 validation fail");di.trace("Stage 1 - Initiator received the message."),bU(this.session.hs.re),xge(this.session.hs.rs),di.trace("Initiator going to check remote's signature...");try{let i=gU(t);this.remotePeer=this.remotePeer||await mU(i),await yU(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let o=i;throw new P0(`Error occurred while verifying signed payload: ${o.message}`)}di.trace("All good with the signature!")}else{di.trace("Stage 1 - Responder sending out first message with signed payload and static key.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(dge(e)),di.trace("Stage 1 - Responder sent the second handshake message with signed payload."),wU(this.session.hs.e)}}async finish(){if(this.isInitiator){di.trace("Stage 2 - Initiator sending third handshake message.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(hge(e)),di.trace("Stage 2 - Initiator sent message with signed payload.")}else{di.trace("Stage 2 - Responder waiting for third handshake message...");let e=gge((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new Jl("xx handshake stage 2 validation fail");di.trace("Stage 2 - Responder received the message, finished handshake.");try{let i=gU(t);this.remotePeer=this.remotePeer||await mU(i),await yU(this.session.hs.rs,i,this.remotePeer),this.setRemoteNoiseExtension(i.extensions)}catch(i){let o=i;throw new P0(`Error occurred while verifying signed payload: ${o.message}`)}}Sge(this.session)}encrypt(e,t){let n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){let i=this.getCS(t,!1);return this.xx.decryptWithAd(i,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new Jl("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}};function Age(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}var NS=class{constructor(e={}){this.protocol="/noise";let{staticNoiseKey:t,extensions:n,crypto:i,prologueBytes:o,metrics:s}=e;this.crypto=i??lge,this.extensions=n,this.metrics=s?Age(s):void 0,t?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(t):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=o??new Uint8Array(0)}async secureOutbound(e,t,n){let i=YM(t,{lengthEncoder:Dg,lengthDecoder:J4,maxDataLength:65535}),o=await this.performHandshake({connection:i,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,o),remoteExtensions:o.remoteExtensions,remotePeer:o.remotePeer}}async secureInbound(e,t,n){let i=YM(t,{lengthEncoder:Dg,lengthDecoder:J4,maxDataLength:65535}),o=await this.performHandshake({connection:i,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(i,o),remotePeer:o.remotePeer,remoteExtensions:o.remoteExtensions}}async performHandshake(e){let t=await _ge(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){var a,c;let{isInitiator:n,remotePeer:i,connection:o}=e,s=new kS(n,t,this.prologue,this.crypto,this.staticKeys,o,i);try{await s.propose(),await s.exchange(),await s.finish(),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(u){if((c=this.metrics)==null||c.xxHandshakeErrors.increment(),u instanceof Error)throw u.message=`Error occurred during XX handshake: ${u.message}`,u}return s}async createSecureConnection(e,t){let[n,i]=T2e(),o=e.unwrap();return await Ne(n,wge(t,this.metrics),o,Xr({lengthDecoder:J4}),bge(t,this.metrics),n),i}};function Tge(r={}){return()=>new NS(r)}var Nqe=et.bind({ignoreUndefined:!0,concatArrays:!0});function n6({options:r={},peerId:e,multiaddrs:t=[],repo:n,keychainConfig:i={},config:o={}}){let{datastore:s}=n,a=Dqe({options:r,config:o,datastore:s,keychainConfig:i,peerId:e,multiaddrs:t});return typeof r.libp2p=="function"?r.libp2p({libp2pOptions:a,options:r,config:o,datastore:s,peerId:e}):(a.start=!1,i1e(a))}function Dqe({options:r,config:e,datastore:t,keychainConfig:n,peerId:i,multiaddrs:o}){var d,p,g,w;let s=()=>{let _=(0,lr.default)(e,"Pubsub.Router")||"gossipsub",x=Wae();if(!x[_])throw(0,Ige.default)(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${_} router.`),"ERR_NOT_SUPPORTED");return x[_]},a={datastore:t,peerId:i},c={addresses:{listen:o.map(_=>_.toString()),announce:(0,lr.default)(r,"addresses.announce",(0,lr.default)(e,"Addresses.Announce",[])),noAnnounce:(0,lr.default)(r,"addresses.noAnnounce",(0,lr.default)(e,"Addresses.NoAnnounce",[]))},connectionManager:(0,lr.default)(r,"connectionManager",{maxConnections:(0,lr.default)(r,"config.Swarm.ConnMgr.HighWater",(0,lr.default)(e,"Swarm.ConnMgr.HighWater")),minConnections:(0,lr.default)(r,"config.Swarm.ConnMgr.LowWater",(0,lr.default)(e,"Swarm.ConnMgr.LowWater"))}),keychain:n,identify:{host:{agentVersion:`js-ipfs/${hp}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[S2e({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[Tge()],relay:{enabled:(0,lr.default)(r,"relay.enabled",(0,lr.default)(e,"relay.enabled",!0)),hop:{enabled:(0,lr.default)(r,"relay.hop.enabled",(0,lr.default)(e,"relay.hop.enabled",!1)),active:(0,lr.default)(r,"relay.hop.active",(0,lr.default)(e,"relay.hop.active",!1))}},nat:{enabled:!(0,lr.default)(e,"Swarm.DisableNatPortMap",!1)}};(0,lr.default)(r,"config.Pubsub.Enabled",(0,lr.default)(e,"Pubsub.Enabled",!0))&&(c.pubsub=s()),(0,lr.default)(e,"Routing.Type","dhtclient")!=="none"&&(c.dht=Q1e({clientMode:(0,lr.default)(e,"Routing.Type","dht")!=="dhtserver",kBucketSize:(0,lr.default)(r,"dht.kBucketSize",20),validators:{ipns:pm},selectors:{ipns:x_}}));let u=(0,lr.default)(r,"config.Bootstrap",(0,lr.default)(e,"Bootstrap",[]));u.length>0&&((d=c.peerDiscovery)==null||d.push(X1e({list:u})));let l=(0,lr.default)(r,"libp2p",void 0);typeof l=="function"&&(l=void 0);let f=Nqe(a,Jfe(),c,l),h=(0,lr.default)(r,"config.Addresses.Delegates",(0,lr.default)(e,"Addresses.Delegates",[]));if(h.length>0){let _=h[Math.floor(Math.random()*h.length)],x=yt(_).toOptions(),m={host:x.host,protocol:parseInt(x.port)===443?"https":"http",port:x.port},y=efe(m);(p=f.contentRouters)==null||p.push(ace(y)),(g=f.peerRouters)==null||g.push(nce(y))}return(0,lr.default)(r,"config.Discovery.MDNS.Enabled",(0,lr.default)(e,"Discovery.MDNS.Enabled",!0))||(f.peerDiscovery=(w=f.peerDiscovery)==null?void 0:w.filter(_=>{try{if(typeof _=="function")return _({})[Symbol.toStringTag]!=="@libp2p/mdns"}catch{}return!0})),f.transports==null&&(f.transports=[]),f.transports.find(_=>{try{if(typeof _=="function")return _({})[Symbol.toStringTag]==="@libp2p/websockets"}catch{}return!1})==null&&f.transports.push(bme()),f}var _U;(function(r){let e;r.codec=()=>(e==null&&(e=kn((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.id!=null&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){let s=t.uint32();switch(s>>>3){case 1:i.id=t.bytes();break;case 2:i.pubKey=t.bytes();break;case 3:i.privKey=t.bytes();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>Pn(t,r.codec()),r.decode=t=>Cn(t,r.codec())})(_U||(_U={}));var Rge=async()=>{let r=await Xb("Ed25519"),e=await Pge(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};var Cge=async r=>{let e=await Xb("RSA",(r==null?void 0:r.bits)??2048),t=await Pge(e);if(t.type==="RSA")return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function Pge(r){return Hn(a3(r.public),HC(r))}var EU=C(ee(),1);var Nge=et.bind({ignoreUndefined:!0}),i6=j("ipfs:components:peer:storage"),Og=class{constructor(e,t,n,i,o){this.print=i,this.peerId=e,this.keychain=t,this.repo=n,this.print=i,this.isNew=o}static async start(e,t,n){let{repoAutoMigrate:i,repo:o,onMigrationProgress:s}=n,a=typeof o=="string"||o==null?kse(e,t,{path:o,autoMigrate:i,onMigrationProgress:s}):o,{peerId:c,keychain:u,isNew:l}=await Oqe(e,a,n);return new Og(c,u,a,e,l)}},Oqe=async(r,e,t)=>{if(!e.closed)return{...await kge(e,t),isNew:!1};try{return await e.open(),{...await kge(e,t),isNew:!1}}catch(n){if(n.code!==Pp)throw n;if(t.init&&t.init.allowNew===!1)throw new Na("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await Lqe(r,e,t),isNew:!0}}},Lqe=async(r,e,t)=>{let n=t.init||{},i=await e.exists();if(i6("repo exists?",i),i===!0)throw new Error("repo already exists");let o=n.privateKey?await Bqe(n.privateKey):await Mqe(r,n),s=Uqe(o);i6("peer identity: %s",s.PeerID);let a={...Nge(Dge(cl(),n.profiles),t.config),Identity:s};await e.init(a),await e.open(),i6("repo opened");let c={pass:t.pass};try{c.dek=await e.config.get("Keychain.DEK")}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}let u=await n6({options:void 0,multiaddrs:void 0,peerId:o,repo:e,config:a,keychainConfig:c});return await e.datastore.has(new pe("/info/self"))||await u.keychain.importPeer("self",o),await e.config.set("Keychain",{DEK:u.keychain.init.dek}),{peerId:o,keychain:u.keychain}},Bqe=async r=>{if(i6("using user-supplied private-key"),Lf(r))return r;let e=Ie(r,"base64pad"),t=await Li(e);return await Hn(t.public.bytes,t.bytes)},Mqe=(r,{algorithm:e="Ed25519",bits:t=2048})=>{if(r("generating %s keypair...",e),e==="Ed25519")return Rge();if(e==="RSA")return Cge({bits:t});throw(0,EU.default)(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},Uqe=r=>{if(r.privateKey==null)throw(0,EU.default)(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:r.toString(),PrivKey:re(r.privateKey,"base64pad")}},kge=async(r,e)=>{let t=e.config,n=e.init&&e.init.profiles||[],i=e.pass,o=await r.config.getAll(),s=Fqe(Dge(o,n),t);if(o!==s&&await r.config.replace(s),!s.Identity||!s.Identity.PrivKey)throw new Ku("No private key was found in the config, please intialize the repo");let a=Ie(s.Identity.PrivKey,"base64pad"),c=await Li(a),u=await Hn(c.public.bytes,c.bytes),l=await n6({options:void 0,multiaddrs:void 0,peerId:u,repo:r,config:s,keychainConfig:{pass:i,...s.Keychain}});return{peerId:u,keychain:l.keychain}},Fqe=(r,e)=>e?Nge(r,e):r,Dge=(r,e)=>(e||[]).reduce((t,n)=>{let i=Fm[n];if(!i)throw new Error(`Could not find profile with name '${n}'`);return i6("applying profile %s",n),i.transform(t)},r);var Qge=C(jge(),1);var o6=C(Xo(),1);function Jqe(r){let e=new Uint8Array(r.reduce((n,i)=>n+o6.default.encodingLength(i),0)),t=0;for(let n of r)e=o6.encode(n,e,t),t+=o6.default.encodingLength(n);return e}var Wge=Jqe;var s6=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(tt)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};var lc=C(gc(),1),Iu=lc.default.Reader,a6=lc.default.Writer,ir=lc.default.util,qt=lc.default.roots["ipfs-bitswap"]||(lc.default.roots["ipfs-bitswap"]={}),Ss=qt.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=ir.emptyArray,r.prototype.payload=ir.emptyArray,r.prototype.blockPresences=ir.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=a6.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&qt.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)qt.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)qt.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof Iu||(t=Iu.create(t));for(var i=n===void 0?t.len:t.pos+n,o=new qt.Message;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:{o.wantlist=qt.Message.Wantlist.decode(t,t.uint32());break}case 2:{o.blocks&&o.blocks.length||(o.blocks=[]),o.blocks.push(t.bytes());break}case 3:{o.payload&&o.payload.length||(o.payload=[]),o.payload.push(qt.Message.Block.decode(t,t.uint32()));break}case 4:{o.blockPresences&&o.blockPresences.length||(o.blockPresences=[]),o.blockPresences.push(qt.Message.BlockPresence.decode(t,t.uint32()));break}case 5:{o.pendingBytes=t.int32();break}default:t.skipType(s&7);break}}return o},r.fromObject=function(t){if(t instanceof qt.Message)return t;var n=new qt.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=qt.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?ir.base64.decode(t.blocks[i],n.blocks[i]=ir.newBuffer(ir.base64.length(t.blocks[i])),0):t.blocks[i].length>=0&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=qt.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=qt.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=qt.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var o=0;o<t.blocks.length;++o)i.blocks[o]=n.bytes===String?ir.base64.encode(t.blocks[o],0,t.blocks[o].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[o]):t.blocks[o]}if(t.payload&&t.payload.length){i.payload=[];for(var o=0;o<t.payload.length;++o)i.payload[o]=qt.Message.Block.toObject(t.payload[o],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var o=0;o<t.blockPresences.length;++o)i.blockPresences[o]=qt.Message.BlockPresence.toObject(t.blockPresences[o],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,lc.default.util.toJSONOptions)},r.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Message"},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=ir.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=a6.create()),n.entries!=null&&n.entries.length)for(var o=0;o<n.entries.length;++o)qt.Message.Wantlist.Entry.encode(n.entries[o],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof Iu||(n=Iu.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new qt.Message.Wantlist;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:{s.entries&&s.entries.length||(s.entries=[]),s.entries.push(qt.Message.Wantlist.Entry.decode(n,n.uint32()));break}case 2:{s.full=n.bool();break}default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof qt.Message.Wantlist)return n;var i=new qt.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var o=0;o<n.entries.length;++o){if(typeof n.entries[o]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[o]=qt.Message.Wantlist.Entry.fromObject(n.entries[o])}}return n.full!=null&&(i.full=!!n.full),i},e.toObject=function(n,i){i||(i={});var o={};if((i.arrays||i.defaults)&&(o.entries=[]),i.defaults&&(o.full=!1),n.entries&&n.entries.length){o.entries=[];for(var s=0;s<n.entries.length;++s)o.entries[s]=qt.Message.Wantlist.Entry.toObject(n.entries[s],i)}return n.full!=null&&n.hasOwnProperty("full")&&(o.full=n.full),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,lc.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Wantlist"},e.WantType=function(){let t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),o=0;o<i.length;++o)n[i[o]]!=null&&(this[i[o]]=n[i[o]])}return t.prototype.block=ir.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,o){return o||(o=a6.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&o.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&o.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&o.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&o.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&o.uint32(40).bool(i.sendDontHave),o},t.decode=function(i,o){i instanceof Iu||(i=Iu.create(i));for(var s=o===void 0?i.len:i.pos+o,a=new qt.Message.Wantlist.Entry;i.pos<s;){var c=i.uint32();switch(c>>>3){case 1:{a.block=i.bytes();break}case 2:{a.priority=i.int32();break}case 3:{a.cancel=i.bool();break}case 4:{a.wantType=i.int32();break}case 5:{a.sendDontHave=i.bool();break}default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof qt.Message.Wantlist.Entry)return i;var o=new qt.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?ir.base64.decode(i.block,o.block=ir.newBuffer(ir.base64.length(i.block)),0):i.block.length>=0&&(o.block=i.block)),i.priority!=null&&(o.priority=i.priority|0),i.cancel!=null&&(o.cancel=!!i.cancel),i.wantType){case"Block":case 0:o.wantType=0;break;case"Have":case 1:o.wantType=1;break}return i.sendDontHave!=null&&(o.sendDontHave=!!i.sendDontHave),o},t.toObject=function(i,o){o||(o={});var s={};return o.defaults&&(o.bytes===String?s.block="":(s.block=[],o.bytes!==Array&&(s.block=ir.newBuffer(s.block))),s.priority=0,s.cancel=!1,s.wantType=o.enums===String?"Block":0,s.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(s.block=o.bytes===String?ir.base64.encode(i.block,0,i.block.length):o.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(s.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(s.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(s.wantType=o.enums===String?qt.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(s.sendDontHave=i.sendDontHave),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,lc.default.util.toJSONOptions)},t.getTypeUrl=function(i){return i===void 0&&(i="type.googleapis.com"),i+"/Message.Wantlist.Entry"},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=ir.newBuffer([]),e.prototype.data=ir.newBuffer([]),e.encode=function(n,i){return i||(i=a6.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof Iu||(n=Iu.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new qt.Message.Block;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:{s.prefix=n.bytes();break}case 2:{s.data=n.bytes();break}default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof qt.Message.Block)return n;var i=new qt.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?ir.base64.decode(n.prefix,i.prefix=ir.newBuffer(ir.base64.length(n.prefix)),0):n.prefix.length>=0&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?ir.base64.decode(n.data,i.data=ir.newBuffer(ir.base64.length(n.data)),0):n.data.length>=0&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.prefix="":(o.prefix=[],i.bytes!==Array&&(o.prefix=ir.newBuffer(o.prefix))),i.bytes===String?o.data="":(o.data=[],i.bytes!==Array&&(o.data=ir.newBuffer(o.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(o.prefix=i.bytes===String?ir.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(o.data=i.bytes===String?ir.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,lc.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Block"},e}(),r.BlockPresenceType=function(){let e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=ir.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=a6.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof Iu||(n=Iu.create(n));for(var o=i===void 0?n.len:n.pos+i,s=new qt.Message.BlockPresence;n.pos<o;){var a=n.uint32();switch(a>>>3){case 1:{s.cid=n.bytes();break}case 2:{s.type=n.int32();break}default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof qt.Message.BlockPresence)return n;var i=new qt.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?ir.base64.decode(n.cid,i.cid=ir.newBuffer(ir.base64.length(n.cid)),0):n.cid.length>=0&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.cid="":(o.cid=[],i.bytes!==Array&&(o.cid=ir.newBuffer(o.cid))),o.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(o.cid=i.bytes===String?ir.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(o.type=i.enums===String?qt.Message.BlockPresenceType[n.type]:n.type),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,lc.default.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.BlockPresence"},e}(),r})();var Yge={Block:Ss.Wantlist.WantType.Block,Have:Ss.Wantlist.WantType.Have},eHe=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),o=r(n);return i<o?-1:i>o?1:0}),fc=class{constructor(e,t){this.set=t?bs({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=e.toString(tt),o=this.set.get(i);o?(o.inc(),o.priority=t,o.wantType===Yge.Have&&n===Yge.Block&&(o.wantType=n)):(this.set.set(i,new s6(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(tt),n=this.set.get(t);n&&(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(eHe(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(tt);return this.set.has(t)}get(e){let t=e.toString(tt);return this.set.get(t)}};fc.Entry=s6;var tHe=fc.Entry,ah=class{constructor(e,t,n,i,o){this.entry=new tHe(e,t,n),this.cancel=!!i,this.sendDontHave=!!o}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(tt)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var ba=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toString().slice(0,8)}`),ue(t.join(":"))};var DS=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!rr(n,i)||n instanceof ah&&i instanceof ah&&!n.equals(i))return!1}return!0};var fr=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,o){n==null&&(n=fr.WantType.Block);let s=e.toString(tt),a=this.wantlist.get(s);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=!!i),o&&(a.sendDontHave=!!o),n===fr.WantType.Block&&a.wantType===fr.WantType.Have&&(a.wantType=n)):this.wantlist.set(s,new ah(e,t,n,i,o))}addBlock(e,t){let n=e.toString(tt);this.blocks.set(n,t)}addHave(e){let t=e.toString(tt);this.blockPresences.has(t)||this.blockPresences.set(t,fr.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(tt);this.blockPresences.has(t)||this.blockPresences.set(t,fr.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(tt);this.wantlist.delete(t),this.addEntry(e,0,fr.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:!!t.cancel})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return Ss.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:!!t.cancel,sendDontHave:!!t.sendDontHave})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=ce.parse(t),o=i.version,s=i.code,a=i.multihash.code,c=i.multihash.digest.length,u=Wge([o,s,a,c]);e.payload.push(new Ss.Block({prefix:u,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new Ss.BlockPresence({cid:ce.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),Ss.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!DS(this.wantlist,e.wantlist)||!DS(this.blocks,e.blocks)||!DS(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};fr.deserialize=async(r,e)=>{let t=Ss.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new fr(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(o=>{if(!o.block)return;let s=ce.decode(o.block);i.addEntry(s,o.priority||0,o.wantType,!!o.cancel,!!o.sendDontHave)}),t.blockPresences&&t.blockPresences.forEach(o=>{if(!o.cid)return;let s=ce.decode(o.cid);o.type===fr.BlockPresenceType.Have?i.addHave(s):i.addDontHave(s)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async o=>{let s=await mr.digest(o),a=ce.createV0(s);i.addBlock(a,o)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async o=>{if(!o.prefix||!o.data)return;let s=(0,Qge.default)(o.prefix),a=s[0],c=s[1],u=s[2],l=u===mr.code?mr:e&&await e.getHasher(u);if(!l)throw new We("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");let f=await l.digest(o.data),h=ce.create(a,c,f);i.addBlock(h,o.data)})),i.setPendingBytes(t.pendingBytes)),i)};fr.blockPresenceSize=r=>r.bytes.length+1;fr.Entry=ah;fr.WantType={Block:Ss.Wantlist.WantType.Block,Have:Ss.Wantlist.WantType.Have};fr.BlockPresenceType={Have:Ss.BlockPresenceType.Have,DontHave:Ss.BlockPresenceType.DontHave};var Xge=Math.pow(2,31)-1,Zge=1e3,Jge=1;var eye=rHe;function rHe(r,e,t){var n=null,i=null,o=function(){n&&(clearTimeout(n),i=null,n=null)},s=function(){var c=i;o(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,u=arguments,l=t&&!n;if(o(),i=function(){r.apply(c,u)},n=setTimeout(function(){if(n=null,!l){var f=i;return i=null,f()}},e),l)return i()};return a.cancel=o,a.flush=s,a}var OS=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=ba(e,"msgqueue"),this.sendEntries=eye(this._sendEntries.bind(this),Jge)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new fr(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toString(),t.message);return}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}};var LS=class{constructor(e,t,n,i){this.peers=bs({name:"ipfs_bitswap_want_manager_peers",metrics:i.metrics}),this.wantlist=new fc(n,i),this.network=t,this._stats=n,this._peerId=e,this._log=ba(e,"want")}_addEntries(e,t,n){let i=e.map((o,s)=>new fr.Entry(o,Xge-s,fr.WantType.Block,t));i.forEach(o=>{o.cancel?n?this.wantlist.removeForce(o.cid.toString(tt)):this.wantlist.remove(o.cid):(this._log("adding to wl"),this.wantlist.add(o.cid,o.priority))});for(let o of this.peers.values())o.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t){t.refcnt++;return}t=new OS(this._peerId,e,this.network);let n=new fr(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toString());t&&(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}};var tye=()=>{},SU=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??tye,this.onDisconnect=e.onDisconnect??tye}get[Symbol.toStringTag](){return W9.toString()}get[W9](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function rye(r){return new SU(r)}var nye=C(Kn(),1);var AU="/ipfs/bitswap/1.0.0",TU="/ipfs/bitswap/1.1.0",IU="/ipfs/bitswap/1.2.0",iHe=32,oHe=128,sHe=3e4,BS=class{constructor(e,t,n,i={}){this._log=ba(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[AU],i.b100Only||(this._protocols.unshift(TU),this._protocols.unshift(IU)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=i.hashLoader,this._maxInboundStreams=i.maxInboundStreams??iHe,this._maxOutboundStreams=i.maxOutboundStreams??oHe,this._incomingStreamTimeout=i.incomingStreamTimeout??sHe}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});let e=rye({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(let t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach(t=>{this._onPeerConnect(t.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarIds!=null){for(let e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;let n=new nye.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await Ne(sa(e.source,n.signal),Xr(),async i=>{for await(let o of i){try{let s=await fr.deserialize(o.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,s)}catch(s){this._bitswap._receiveError(s);break}n.reset()}})}).catch(i=>{this._log(i),e.abort(i)}).finally(()=>{n.clear(),e.close()})}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){let n=[],i=0;for await(let o of this.findProviders(e,t))if(this._log(`connecting to provider ${o.id}`),n.push(this.connectTo(o.id,t).catch(s=>{this._log.error(s)})),i++,i===3)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toString();this._log("sendMessage to %s",n,t);let o=await(await this._libp2p.dial(e)).newStream([IU,TU,AU]);await aHe(o,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toString();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function aHe(r,e,t){try{let n;switch(r.stat.protocol){case AU:n=e.serializeToBitswap100();break;case TU:case IU:n=e.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+r.stat.protocol)}await Ne([n],vn(),r)}catch(n){t(n)}finally{r.close()}}var MS=class{constructor(e){this.partner=e,this.wantlist=new fc,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};var c6=class extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,o=this._kCmp(this._keys[i],e);if(o<0)t=i+1;else if(o>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var cHe={hasNewInfo(){return!1},merge(){}},US=class{constructor(e=cHe){this._taskMerger=e,this._byPeer=new c6([],FS.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new FS(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let o=t.peerId;return t.isIdle()?this._byPeer.delete(o.toString()):this._byPeer.update(0),{peerId:o,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toString());if(!n)return;let i=this._byPeer.indexOf(e.toString());for(let o of t)n.taskDone(o);this._byPeer.update(i)}},FS=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new RU,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let o=0;o<i.length&&t<e;o++){let s=i[o];n.push(s),t+=s.size,this._pending.delete(s.topic),this._activeTotalSize+=s.size,this._active.add(s)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},RU=class{constructor(){this._tasks=new c6([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};var iye={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var oye=fr.WantType,uHe=16*1024,lHe=1024,zS=class{constructor(e,t,n,i,o,s={}){this._log=ba(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(s),this.ledgerMap=bs({name:"ipfs_bitswap_ledger_map",metrics:o.metrics}),this._running=!1,this._requestQueue=new US(iye)}_processOpts(e){return{maxSizeReplaceHasWithBlock:lHe,targetMessageSize:uHe,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new fr(!1);i.setPendingBytes(n);let o=[],s=new Map;for(let c of t){let u=ce.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(o.push(u),s.set(c.topic,c.data)):i.addHave(u):i.addDontHave(u)}let a=await this._getBlocks(o);for(let[c,u]of s){let l=ce.parse(c),f=a.get(c);f?i.addBlock(l,f):u.sendDontHave&&i.addDontHave(l)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,u]of a.entries())e&&this.messageSent(e,ce.parse(c),u)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let o=n.data.length,s=this._sendAsBlock(i.wantType,o),a=o;s||(a=fr.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(tt),priority:i.priority,size:a,data:{blockSize:o,isWantBlock:s,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new fc),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],o=[];t.wantlist.forEach(s=>{s.cancel?(n.cancelWant(s.cid),i.push(s.cid)):(n.wants(s.cid,s.priority,s.wantType),o.push(s))}),this._cancelWants(e,i),await this._addWants(e,o),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(tt),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(o=>o.cid)),i=[];for(let o of t){let s=o.cid.toString(tt),a=n.get(s);if(a==null)o.sendDontHave&&i.push({topic:s,priority:o.priority,size:fr.blockPresenceSize(o.cid),data:{isWantBlock:o.wantType===oye.Block,blockSize:0,haveBlock:!1,sendDontHave:o.sendDontHave}});else{let c=this._sendAsBlock(o.wantType,a),u=a;c||(u=fr.blockPresenceSize(o.cid)),i.push({topic:s,priority:o.priority,size:u,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:o.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===oye.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(tt),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){let t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;let i=new MS(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};var cye=C(xi(),1);var sye=r=>`unwant:${Ee(r.multihash.bytes,"base64")}`,aye=r=>`block:${Ee(r.multihash.bytes,"base64")}`,VS=class extends cye.EventEmitter{constructor(e){super(),this.setMaxListeners(Zge),this._log=ba(e,"notif")}hasBlock(e,t){let n=aye(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=aye(e),i=sye(e);return this._log(`wantBlock:${e}`),new Promise((o,s)=>{let a=()=>{this.removeListener(n,c),s(new Error(`Block for ${e} unwanted`))},c=u=>{this.removeListener(i,a),o(u)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),s(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=sye(e);this._log(t),this.emit(t)}};var pye=C(xi(),1);var dye=C(xi(),1),CU=C(fye(),1),u6=class extends dye.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=(0,CU.default)(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let o=i/t*1e3,s=this._movingAverages[e];s||(s=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=s[a];c||(c=s[a]=(0,CU.default)(a)),c.push(n,o)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var hye={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},KS=class extends pye.EventEmitter{constructor(e,t=[],n=hye){super();let i=Object.assign({},hye,n);if(typeof i.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof i.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=i,this._enabled=this._options.enabled,this._global=new u6(t,i),this._global.on("update",o=>this.emit("update",o)),this._peers=bs({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new u6(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};var mye=C(Da(),1);var dHe={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},hHe=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],$S=class extends uu{constructor(e,t,n={}){super(),this._libp2p=e,this._log=ba(this.peerId),this._options=Object.assign({},dHe,n),this._stats=new KS(e,hHe,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new BS(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new zS(this.peerId,t,this.network,this._stats,e),this.wm=new LS(this.peerId,this.network,this._stats,e),this.notifications=new VS(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch{this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,o]of t.blocks.entries()){let s=ce.parse(i);n.push({wasWanted:this.wm.wantlist.contains(s),cid:s,data:o})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:o,data:s})=>this._handleReceivedBlock(e,i,s,o)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let o=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,o),i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(c,u)=>(this.wm.wantBlocks([c],u),this.notifications.wantBlock(c,u)),i=!1,o=async(c,u)=>{try{return await this.blockstore.get(c,u)}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l;return i||(i=!0,this.network.findAndConnect(c,u).catch(f=>this._log.error(f))),n(c,u)}},s=new AbortController,a=t.signal?(0,mye.anySignal)([t.signal,s.signal]):s.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:a}),o(e,{signal:a})])}finally{s.abort()}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}has(e){return this.blockstore.has(e)}};var gye=(r,e,t={})=>new $S(r,e,t);var wye=C(ee(),1);var qS={};xe(qS,{abortedError:()=>pHe,notFoundError:()=>yye});var PU=C(ee(),1);function yye(r){return r=r||new Error("Not Found"),(0,PU.default)(r,"ERR_NOT_FOUND")}function pHe(r){return r=r||new Error("Aborted"),(0,PU.default)(r,"ERR_ABORTED")}var yur={...qS};var HS=class extends uu{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){let n=M3(e,async({key:i})=>!await this.has(i));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){let n=Ao({objectMode:!0}),i=Ao({objectMode:!0});Promise.resolve().then(async()=>{for await(let o of e)!await this.has(o)&&this.bitswap.isStarted()?n.push(o):i.push(o);n.end(),i.end()}),yield*ga(this.bitswap.getMany(n,t),this.child.getMany(i,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}};var Lg=class{constructor(e,t,n,i,o){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=i,this.blockstore=o}static async start({peerId:e,repo:t,print:n,hashers:i,options:o}){t.closed&&await t.open();let s=await t.config.getAll(),a=await n6({options:o,repo:t,peerId:e,multiaddrs:mHe(e,s),config:s,keychainConfig:void 0});await a.start();for(let l of a.getMultiaddrs())n(`Swarm listening on ${l.toString()}`);let c=gye(a,t.blocks,{statsEnabled:!0,hashLoader:i,maxInboundStreams:1024,maxOutboundStreams:1024});await c.start();let u=new HS(t.blocks,c);return t.blocks=u,t.pins.blockstore=u,new Lg(e,a,c,t,u)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}},mHe=(r,e)=>{let t=r.toString(),n=[],i=e.Addresses&&e.Addresses.Swarm||[];for(let o of i){let s=yt(o);if(s.protoCodes().includes(gHe))throw(0,wye.default)(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");let a=s.getPeerId();a&&a!==t&&(s=s.encapsulate(`/p2p/${t}`)),n.push(s)}return n},gHe=479;function bye({network:r}){async function e(t={}){let n=[],{libp2p:i}=await r.use(t);return await i.peerStore.forEach(o=>{n.push({id:o.id,addrs:o.addresses.map(s=>s.multiaddr)})}),n}return $(e)}function _ye({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.dial(t,n)}return $(e)}function Eye({network:r}){async function e(t,n={}){let{libp2p:i}=await r.use(n);await i.hangUp(t)}return $(e)}function vye({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);return n.getMultiaddrs()}return $(e)}function xye({network:r}){async function e(t={}){let{libp2p:n}=await r.use(t);if(t.verbose){let o=[];for(let s of n.getConnections()){let a={addr:s.remoteAddr,peer:s.remotePeer};(t.verbose||t.direction)&&(a.direction=s.stat.direction),t.verbose&&(a.muxer=s.stat.multiplexer,a.latency="n/a",a.streams=[]),o.push(a)}return o}let i=new Map;for(let o of n.getConnections()){let s={addr:o.remoteAddr,peer:o.remotePeer};i.set(o.remotePeer.toString(),s)}return Array.from(i.values())}return $(e)}var GS=class{constructor({network:e}){this.addrs=bye({network:e}),this.connect=_ye({network:e}),this.disconnect=Eye({network:e}),this.localAddrs=vye({network:e}),this.peers=xye({network:e})}};var l6={success:!0,time:0,text:""};function Sye({network:r}){async function*e(t,n={}){let{libp2p:i}=await r.use();n.count=n.count||10;let o=await i.peerStore.get(t),s=o&&o.id;if(!s){yield{...l6,text:`Looking up peer ${t}`};let u=await i.peerRouting.findPeer(t);s=u&&u.id}if(!s)throw new Error("Peer was not found");yield{...l6,text:`PING ${s.toString()}`};let a=0,c=0;for(let u=0;u<n.count;u++)try{let l=await i.ping(s);c+=l,a++,yield{...l6,time:l}}catch(l){yield{...l6,success:!1,text:l.toString()}}if(a){let u=c/a;yield{...l6,text:`Average latency: ${u}ms`}}}return $(e)}var ef=C(ee(),1);var kU="/ipns/";function Aye(r){r.startsWith(kU)&&(r=r.substring(kU.length));let e;if((r[0]==="1"||r[0]==="Q")&&(r=`z${r}`),r[0]==="z"&&(e=pr.decode(r)),r[0]==="k"&&(e=w1.decode(r)),!e)throw new Error("Could not parse string");if(e[0]!==1&&e[1]!==114&&(e=rt([[1,114],e])),e.length!==40)throw new Error("Incorrect length "+e.length);return rt([Ie(kU),e.subarray(2)])}function Tye({network:r,repo:e,peerId:t}){let{get:n,put:i,findProvs:o,findPeer:s,provide:a,query:c}={async*get(u,l={}){let{libp2p:f}=await Bg(r,t,l),h=u instanceof Uint8Array?u:Aye(u);if(f.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.get(h,l)},async*put(u,l,f){let{libp2p:h}=await Bg(r,t,f),d=u instanceof Uint8Array?u:Aye(u);if(h.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.put(d,l,f)},async*findProvs(u,l={}){let{libp2p:f}=await Bg(r,t,l);if(f.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.findProviders(u,{signal:l.signal})},async*findPeer(u,l={}){let{libp2p:f}=await Bg(r,t,l);if(f.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.findPeer(u,{signal:l.signal})},async*provide(u,l={recursive:!1}){let{libp2p:f}=await Bg(r,t,l);if(!await e.blocks.has(u))throw(0,ef.default)(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(l.recursive)throw(0,ef.default)(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(f.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.provide(u)},async*query(u,l={}){let{libp2p:f}=await Bg(r,t,l),h,d=z.asCID(u);if(d!=null?h=d.multihash.bytes:h=Oe(u.toString()).toBytes(),f.dht==null)throw(0,ef.default)(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.getClosestPeers(h,l)}};return{get:$(n),put:$(i),findProvs:$(o),findPeer:$(s),provide:$(a),query:$(c)}}var Bg=async(r,e,t)=>{let n=await r.use(t);if(n.libp2p.dht!=null)return n;{let i=async function*(){yield{from:e,name:"QUERY_ERROR",type:3,error:new Na("dht not enabled")}};return{libp2p:{dht:{get:i,put:i,findProviders:i,findPeer:i,provide:i,getClosestPeers:i}}}}};var Iye=C(ee(),1);var Rye=C(v_(),1);function Cye({network:r,config:e}){let t=(0,Rye.default)(e||{},"Pubsub.Enabled",!0),n={},i;return{subscribe:t?$(o):f6,unsubscribe:t?$(s):f6,publish:t?$(a):f6,ls:t?$(c):f6,peers:t?$(u):f6};async function o(l,f,h={}){let{libp2p:d}=await r.use(h);d.pubsub.subscribe(l),i==null&&(i=p=>{let g=p.detail;n[g.topic]&&n[g.topic].forEach(w=>{if(typeof w=="function"){w(g);return}w!=null&&w.handleEvent!=null&&w.handleEvent(g)})},d.pubsub.addEventListener("message",i)),f!=null&&(n[l]==null&&(n[l]=[]),n[l].push(f))}async function s(l,f,h={}){let{libp2p:d}=await r.use(h);f!=null&&n[l]!=null&&(n[l]=n[l].filter(p=>p!==f),n[l].length===0&&delete n[l]),typeof f!="function"&&delete n[l],n[l]==null&&d.pubsub.unsubscribe(l),Object.keys(n).length===0&&(d.pubsub.removeEventListener("message",i),i=void 0)}async function a(l,f,h={}){let{libp2p:d}=await r.use(h);if(!f)throw(0,Iye.default)(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await d.pubsub.publish(l,f)}async function c(l={}){let{libp2p:f}=await r.use(l);return f.pubsub.getTopics()}async function u(l,f={}){let{libp2p:h}=await r.use(f);return h.pubsub.getSubscribers(l)}}var f6=async()=>{throw new Na("pubsub not enabled")};var yHe=et.bind({ignoreUndefined:!0}),ch=j("ipfs"),wHe=3e4,NU=class{constructor({print:e,storage:t,codecs:n,options:i}){let{peerId:o,repo:s,keychain:a}=t,c=Pi.create(Lg),u=rre(i.preload),l=pG(),f=mG({network:c}),h=new R_(i),d=Object.values(v8);(i.ipld&&i.ipld.hashers?i.ipld.hashers:[]).forEach(G=>d.push(G)),this.hashers=new V2({hashers:d,loadHasher:i.ipld&&i.ipld.loadHasher});let p=Object.values(Vu);(i.ipld&&i.ipld.bases?i.ipld.bases:[]).forEach(G=>p.push(G)),this.bases=new F2({bases:p,loadBase:i.ipld&&i.ipld.loadBase});let g=new ab({repo:s,codecs:n}),w=new $_({codecs:n,hashers:this.hashers,preload:u,repo:s}),_=new k_({dns:l,ipns:h,repo:s,codecs:n,peerId:o,isOnline:f,keychain:a,options:i}),x=wG({repo:s,codecs:n,bases:this.bases,name:_}),m=new HE({repo:s,codecs:n,hashers:this.hashers,preload:u}),y=Object.assign(bX({repo:s,codecs:n,resolve:x,preload:u}),{local:_X({repo:t.repo})}),{add:b,addAll:E,cat:v,get:S,ls:A}=new BE({preload:u,repo:s,options:i.EXPERIMENTAL,hashers:this.hashers}),I=Gre({repo:s,preload:u,hashers:this.hashers,options:i}),k=nre({files:I,preload:u,options:i.preload});this.preload=u,this.name=_,this.ipns=h,this.pin=g,this.resolve=x,this.block=w,this.refs=y,this.start=DH({network:c,peerId:o,repo:s,preload:u,ipns:h,mfsPreload:k,print:e,keychain:a,hashers:this.hashers,options:i}),this.stop=OH({network:c,preload:u,mfsPreload:k,ipns:h,repo:s}),this.dht=Tye({network:c,repo:s,peerId:o}),this.pubsub=Cye({network:c,config:i.config}),this.dns=l,this.isOnline=f,this.id=Ste({network:c,peerId:o}),this.version=xte({repo:s}),this.bitswap=new D_({network:c}),this.bootstrap=new z_({repo:s}),this.config=Tte({repo:s}),this.ping=Sye({network:c}),this.add=b,this.addAll=E,this.cat=v,this.get=S,this.ls=A,this.dag=m,this.files=I,this.key=new c7({keychain:a}),this.object=new l7({preload:u,codecs:n,repo:s}),this.repo=new d7({repo:s,hashers:this.hashers}),this.stats=new h7({repo:s,network:c}),this.swarm=new GS({network:c}),Object.defineProperty(this,"libp2p",{get(){let G=c.try();return G?G.libp2p:void 0}});let N=()=>Promise.reject((0,jS.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),O=async function*(){throw(0,jS.default)(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=N,this.diag={cmds:N,net:N,sys:N},this.log={level:N,ls:N,tail:O},this.mount=N,this.codecs=n}async init(){throw new ka}},bHe=async r=>{let e=pt({Data:new st({type:"directory"}).marshal(),Links:[]}),t=await r.block.put(e,{mhtype:"sha2-256",format:"dag-pb"});return await r.pin.add(t),t},_He=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!Pye.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function Nye(r={}){r=yHe(_He(),r);let e=r.init||{},t={name:Ii.name,code:Ii.code,encode:u=>u,decode:u=>u},n=Object.values(x8);[sr,o1,a1,yy,t].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>n.push(u));let i=new z2({codecs:n,loadCodec:r.ipld&&r.ipld.loadCodec}),o=r.silent?ch:console.log;ch("creating repo");let s=await Og.start(o,i,r);ch("getting repo config");let a=await s.repo.config.getAll(),c=new NU({storage:s,print:o,codecs:i,options:{...r,config:a}});if(ch("starting preload"),await c.preload.start(),ch("starting storage"),c.ipns.startOffline(s),s.isNew&&!e.emptyRepo){let u=await bHe(c);if(ch("adding default assets"),await(c.addAll,void 0),ch("initializing IPNS keyspace"),s.peerId.publicKey==null)throw(0,jS.default)(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");let l=new kye.TimeoutController(wHe);try{await c.ipns.initializeKeyspace(s.peerId,Ie(`/ipfs/${u}`),{signal:l.signal})}finally{l.clear()}}return r.start!==!1&&(ch("starting node"),await c.start()),c}var EHe=C(dL(),1),Dye=Nye;var Oye=(()=>({toString:function(r){return r.toV1().toString()},fromString:function(r){return z.parse(r)}}))();var WS=(()=>{let r;return{init:async()=>{r||(r=await Dye({repo:String(Math.random()+Date.now())}))},store:async function(e,t){await this.init();let n={path:e,content:t},i=await r.add(n),{cid:o}=i;return Oye.toString(o)},retrieve:async function(e){await this.init();let t=new TextDecoder,n="";for await(let i of r.cat(e))n+=t.decode(i,{stream:!0});return n}}})();var vHe=()=>{let r=Fe.get("gistId");return Fe.get("authToken")?r?"Sync: Notes with my GitHub Gist":"Sync: Pick your Gist to sync with":"Sync: Authorize your GitHub account for synchronisation"},xHe={title:"Share note",icon:Sr(wA,"share note"),sortTitle:"Share",call:qF},SHe={title:"Share public link",key:null,icon:Sr(wA,"share public link"),sortTitle:"Share public link",call:async()=>{Ct.hide(),await Kg(X(".terminal").getValue());let r=hn(),t=(await KU({note:r})).history[0].url,n=await fetch(t).then(l=>l.json()),{files:i}=n,o=Object.values(i),[s]=o,{raw_url:a}=s,c=`${ht.baseUrl}?raw=${a}`;Nu(c,"MiroPad public link copied to clipboard \u{1F4CB}!")}},DU=()=>[{title:"New note",icon:Sr(KF,"new note"),sortTitle:"New",key:"n",call:E6},{title:"Save",key:"s",icon:Sr(TF,"save"),sortTitle:"Save",call:async()=>{Ct.hide(),await Kg(X(".terminal").getValue());let r=hn(),{disableSync:e=!1}=r;e||tA([r]),Pu()}},...navigator.share?[xHe]:[],{title:"Toggle MarkDown Viewer",icon:Sr(LF,"toggle markdown viewer","rotate90"),sortTitle:"Split",key:"m",call:()=>{nf.toggle(),Ct.hide()}},{title:"Full MarkDown view",icon:Sr(BF,"full view"),sortTitle:"Full view",key:"shift m",call:()=>{nf.toggle("full"),Ct.hide()}},{title:"Save to IPFS",key:"i",icon:Sr(zF,"save"),sortTitle:"save->ipfs",call:async()=>{Ct.hide(),await Kg(X(".terminal").getValue());let r=hn(),{disableSync:e=!1}=r;if(e||tA([r]),r){let t=await WS.store(r.title,r.text);Nu(`${ht.baseUrl}#?cid=${t}`)}}},...uF()?[SHe]:[],{title:"Zen mode",icon:Sr($F,"zen mode"),sortTitle:"Zen mode",key:"shift z",call:()=>{!!ht.getSearchParam("zen")?ht.deleteParam("zen"):ht.set(void 0,{zen:!0}),Ct.hide()}},{title:"List saved notes",icon:Sr(AF,"list notes"),sortTitle:"Notes",key:"p",call:()=>Ct.toggle(Ct.getModes().notes)},{title:"Delete note",key:"shift d",icon:Sr(qg,"delete note"),sortTitle:"Delete",call:v6},{title:vHe(),icon:Sr(IF,"sync with github"),key:null,call:async()=>{let r=Fe.get("authToken");if(!r)return await hF();if(!Fe.get("gistId"))return await pF(r);Ct.hide(),await $g()}},{title:"Sync: Reset Gist settings",icon:Sr(RF,"reset github settings"),key:null,call:async()=>{localStorage.removeItem("authToken"),localStorage.removeItem("gistId"),localStorage.removeItem("lastLocalUpdate"),localStorage.removeItem("lastSync"),ze.info("Gist setting have been reset!"),Ct.hide()}},{title:"Toggle sidebar",experimental:!0,key:"shift l",call:()=>{X("aside").toggle()}},{title:"Save to File System...",experimental:!0,icon:Sr(CF,"save file"),key:"shift s",call:async()=>{let{text:r,title:e}=hn();gF(r,e),Ct.hide()}},{title:"Email note to...",experimental:!0,icon:Sr(kF,"email"),key:"e",call:()=>{let r=document.querySelector(".terminal").value;vF(r),Ct.hide()}},{title:"Toggle experimental features",experimental:!1,icon:Sr(NF,"lab"),key:null,call:()=>{let r=!!Fe.get("__experimental__");r?Fe.remove("__experimental__"):Fe.set("__experimental__",!0),ze.showNotification(`Experimental features turned ${r?"off":"on"}`),Ct.hide()}},{title:"Toggle Autocompletion",experimental:!1,icon:Sr(MF,"autocompletion"),key:null,call:()=>{let r=!!Fe.get("__autocomplete__");r?Fe.remove("__autocomplete__"):Fe.set("__autocomplete__",!0),ze.showNotification(`Autocomplete feature turned ${r?"off":"on"}`),Ct.hide(),X(".terminal").focus()}},{title:"Add a cover picture",experimental:!0,icon:Sr(DF,"cover picture"),key:null,call:async()=>{let r=prompt("Paste the image URL in here...");Ct.hide(),await SF(200),Nu(`<div class="cover" style="background-image: url('${r}')"></div>`,"\u{1F44C}Copied! Paste the code on the MiroPad editor"),X(".terminal").focus(),ze.info("Paste the cover picture wherever you prefer on the MirPad editor")}},{title:"Print MarkDown output",experimental:!0,icon:Sr(OF,"print"),key:null,call:()=>{X(".preview").show(),nf.init(),window.print(),Ct.hide()}},{key:"j",title:"Prettify JSON document",icon:Sr(UF,"prettify json"),call:()=>{xF(".terminal"),Ct.hide()}},{title:"Toggle command palette",icon:Sr(FF,"toggle command palette"),key:["shift p","k"],call:()=>Ct.toggle(Ct.getModes().commands)},{title:"Find and Replace...",experimental:!0,icon:Sr(VF,"find and replace"),key:"shift f",call:()=>{let r=X(".terminal").getValue().slice(X(".terminal").el.selectionStart,X(".terminal").el.selectionEnd),e=prompt("What do you wanna find?",r);if(!e)return ze.info("Value not found");let t=X(".terminal").getValue().indexOf(e);X(".terminal").el.setSelectionRange(t,t+e.length);let n=prompt(`Replace ${e} with...`);n&&X(".terminal").el.setRangeText(n)}},{title:"Download all notes!",icon:Sr(PF,"Download all notes on your local file system"),call:()=>{let r=Ru({includeDeleted:!0});yF(r),Ct.hide()}},{title:"Permanently delete ALL notes \u2757",icon:Sr(qg,"delete note"),call:()=>{confirm("Are you sure you want do delete ALL your notes?")&&(Ru({includeDeleted:!0}).forEach(t=>{Fe.remove(t.id)}),E6()),Ct.hide()}}];var AHe={events:[],on(r,e){return Array.isArray(r)?(r.forEach(t=>{let n=t.key||t,i=t.call||e;this.on(n,i)}),this):(r&&typeof r=="string"&&e&&typeof e=="function"&&(this.events=[...this.events,{key:r.includes("shift")?r.replace("shift","").trim():r,shift:r.includes("shift"),fn(){e()}}]),this)},listen(){return document.addEventListener("keydown",r=>{this.handleEvent(r)}),this},handleEvent(r){this.events.map(e=>(e.key===r.key&&(r.ctrlKey===!0||r.metaKey===!0)&&r.shiftKey===e.shift&&(r.preventDefault(),e.fn()),!0))}},Lye=AHe;var Bye=(r,e)=>{let t=document.createElement("a");return t.href=e,t.appendChild(D0(r)?r:document.createTextNode(r)),t};var OU=(r,e=new Date)=>{let t=new Date(r).getFullYear(),n=new Date(e).getFullYear();return t===n},Fye=(r,e=new Date)=>{let t=new Date(r).getMonth(),n=new Date(e).getMonth();return t===n},THe=(r,e=new Date)=>{let t=new Date(r).getDate(),n=new Date(e).getDate();return t===n},Mye=(r,e=new Date)=>OU(r,e)&&Fye(r,e)&&THe(r,e),IHe=["January","February","March","April","May","June","July","August","September","October","November","December"],RHe=IHe.map(r=>r.slice(0,3)),Uye=(r=new Date)=>{let e=new Date(r),t=new Date().getDate()-1;return Fye(e)&&OU(e)&&e.getDate()===t},d6=r=>{let e=new Date(r),t=Uye(r)?"":RHe[e.getMonth()],n=OU(e)?"":e.getFullYear(),i=Uye(e)?"Yesterday":e.getDate();return`${Mye(e)?"":`${i} ${t} ${n}`} ${Mye(e)?e.toLocaleTimeString():""}`};var zye=r=>r.reduce((t,n)=>{if(t.length===0)return[n];let i=Math.max(...t);return[...t,...n>=i?[n]:[]]},[]).length===r.length;var LU=(r,e)=>{let t=r.split(" ").map(o=>o.toLowerCase()),i=e.split(" ").map(o=>o.toLowerCase()).map(o=>t.map((c,u)=>c.includes(o)?u:-1).reduce((c,u)=>u>-1?u:c,-1));return i.includes(-1)?!1:zye(i)};var Vye=async()=>{if(!Fe.get("__notification-permission__")){let r=await window.Notification.requestPermission();Fe.set("__notification-permission__",r)}},Kye=async()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(`${window.location.pathname}service-worker.js?v=2.15.15`)};var $ye=r=>Array.isArray(r)?r.map(e=>$ye(e)).join(", "):r?`\u2318+${r.toUpperCase()}`:"",CHe=(()=>{let r={off:"off",notes:"notes",revisions:"revisions",commands:"commands",gists:"gists"},e={input:"",mode:r.off,options:{selected:0,length:0}};return{getState:function(){return e},getModes:function(){return r},setState:function(t){return e={...e,...t},e},show:function(t=r.commands){switch(X("#commander").show(),X("#commander input").focus(),t){case r.commands:this.generateCommands(),X("#commander input").setValue("> "),this.setState({mode:r.commands});break;case r.notes:this.generateNotes(),X("#commander input").setValue(""),this.setState({mode:r.notes});break;case r.revisions:this.generateRevisions(),X("#commander input").setValue(""),this.setState({mode:r.revisions});break;default:break}return this},hide:function(){return X("#commander").hide(),e.mode=r.off,this},toggle:function(t){return Vye(),e.mode===r.off||e.mode!==t?this.show(t):this.hide(),this},commands:function(){return DU()},selectOption:function(t,n){let i=e.options.selected,o=e.options.length-1,u=n==="down"?i===o?0:i+1:i===0?o:i-1;e.options={...e.options,selected:u}},initCommander:function(){return DU().slice(0,5).map(t=>{X(".mobile-dock").append(A6([t.icon,document.createTextNode(t.sortTitle)],t.call,t.title.toLowerCase().replace(/\s/g,"-")))}),X("#commander button").listen("click",()=>{this.hide()}),X("#commander input").listen("keydown",t=>{t.keyCode===40&&(e.mode===r.revisions&&X("#commands li.selected").click(),this.selectOption(t,"down")),t.keyCode===38&&(e.mode===r.revisions&&X("#commands li.selected").click(),this.selectOption(t,"up"))}).listen("keyup",t=>{t.keyCode===13&&(e.mode===r.commands?X("#commands li.selected div").click():X("#commands li.selected a").click()),t.keyCode===27&&X(".terminal").focus(),e.input!==t.target.value&&(e.options.selected=0),e.input=t.target.value,this.generateOptions(t.target.value)}),this},init:function(){return this.initCommander(),Lye.listen().on(this.commands()),X(".menu").listen("click",()=>this.toggle()),X("#revisions").listen("click",()=>this.generateRevisions()),this},generateRevisions:function(){this.show(),e.mode=r.revisions;let{revisions:t}=hn(),n=e.options.selected,i=Object.keys(t).sort((o,s)=>{let{dateCreated:a}=t[o],{dateCreated:c}=t[s];return c-a}).map((o,s)=>({title:ku({content:`...${o.slice(-10)}`}),secondary:`${d6(t[o].dateCreated)}`,onclick:()=>{ht.set(void 0,{v:o}),e.options.selected=s,this.generateRevisions()}})).map((o,s)=>rf(o,s===n));return X("#commands").html(i),e.options={...e.options,length:i.length},this},generateOptions:function(t){switch(e.mode){case r.commands:case r.notes:t.slice(0,1)===">"?(e.mode=r.commands,this.generateCommands(t.slice(1).trim()),X("#commander input").placeholder("Search for commands...")):(e.mode=r.notes,this.generateNotes(t));return;case r.revisions:return this.generateRevisions();case r.off:break;default:break}},generateNotes:function(t=""){let n=e.options.selected,i=Ru().filter(({title:o})=>LU(o,t)).filter(({id:o,deleted:s})=>!s&&o!==ht.getPageId()).sort((o,s)=>{let a=b6(o.title);return b6(s.title)-a}).map(({id:o,title:s,cid:a},c)=>{let u=b6(s),l=a?`?cid=${a}`:"",f=`${window.location.origin}${window.location.pathname}#${o}${l}`,h=Bye(ku({content:s,highlight:t}),f);return rf({title:h,secondary:d6(u),onclick:()=>{this.hide(),X(".terminal").focus()}},c===n)});return X("#commands").html(i),X("#commander input").placeholder(`Search from ${i.length} saved notes...`),e.options={...e.options,length:i.length},this},generateCommands:async function(t=""){let n=e.options.selected,i=this.commands().filter(({title:o})=>LU(o,t)).filter(({experimental:o=!1})=>Fe.get("__experimental__")?!0:!o).map(({title:o,key:s,call:a,icon:c},u)=>rf({title:ku({content:o,highlight:t}),icon:c,secondary:$ye(s),onclick:a},u===n));return X("#commands").html(i),e.options={...e.options,length:i.length},this}}})(),Ct=CHe;var jye=C(qye());var Hye=(r,e)=>r.split(`
`).reduce((i,o)=>{let{isFound:s}=i;if(s)return i;let a=`${i.text}${o}
`,c=a.length;return e>=c?{text:a,isFound:!1}:{text:o,isFound:!0}},{text:"",isFound:!1}).text;var Gye=r=>{let e=Hye(r.target.value,r.target.selectionEnd),t={"* [":`
* [] `,"* ":`
* `," * [":`
 * [] `," * ":`
 * `};for(let[n,i]of Object.entries(t))if(e.startsWith(n)){r.preventDefault(),X(".terminal").insertAtCaret(i);break}};var PHe=(r,e)=>r[e]===void 0||r[e].trim()==="",kHe=r=>{let e=(0,jye.default)(r,r.selectionEnd),{top:t,left:n}=e,i=X(".terminal").el.scrollHeight,o=X("main").el;o.style.height=`${i}px`,X(".suggestion").el.style.top=`${t}px`,X(".suggestion").el.style.left=`${n}px`},NHe=(r,e)=>{let t="",n=e-1;do{let i=r[n]||"";n=i.trim()===""?-1:n-1,t=i.trim()!==""?`${i}${t}`:t}while(n>=0);return t},DHe=r=>{let e=r.replace(/[\r\n\t]+/g,"").toLowerCase();return QS.getMatchingWords(e)},xr=(()=>{let r={matches:[],currentWord:null,prediction:null,options:{selected:0,length:0}},e=r;return{el:X(".terminal"),setState:function(t){return e={...e,...t},e},resetState:function(){xr.setState(r)},selectOption:function(t,n){let i=e.options.selected,o=e.options.length-1,u=n==="down"?i===o?0:i+1:i===0?o:i-1;e.options={...e.options,selected:u},xr.setState({prediction:e.matches[e.options.selected]}),xr.renderInlineSuggestion(),xr.renderOptions()},acceptCompletion:t=>{let n=(s,a)=>{let c=s.replace(a.toLowerCase(),"");c?X(".terminal").insertAtCaret(`${c} `):X(".terminal").insertAtCaret("  "),X(".suggestion").hide(),xr.resetState()},{prediction:i,currentWord:o}=e;if(t)return n(t,o);i&&(n(i,o),QS.insert(i))},renderInlineSuggestion:()=>{let{prediction:t,currentWord:n}=e,i=ku({content:`${t.slice(n.length)}`});i.setAttribute("id","inlineSuggestion"),X(".suggestion").show().html(i)},renderOptions:()=>{let t=X(".suggestion .options");t&&t.el&&t.el.remove();let n=e.options.selected,i=e.matches.map((s,a)=>rf({title:ku({content:s}),secondary:Sr(qg,"delete word"),onSecondaryClick:()=>{Fe.removeFromDictionary(s),xr.setState({matches:e.matches.filter(c=>c!==s)}),xr.renderOptions()},onclick:()=>{xr.acceptCompletion(s)}},a===n)),o=document.createElement("ul");o.classList.add("options"),o.classList.add("frost"),i.forEach(s=>o.append(s)),X(".suggestion").el.append(o)},onFocus:()=>{Ct.hide(),X(".note-info").hide()},onInput:t=>{if(!!!Fe.get("__autocomplete__"))return;let i=t.target.selectionEnd,o=xr.el.getValue(),s=o[i-1];if(t.inputType==="deleteContentBackward"||s===" ")return xr.setState({prediction:r.prediction,currentWord:r.currentWord}),X(".suggestion").hide();if(t.inputType==="insertText"&&PHe(o,i)){kHe(t.target);let c=NHe(o,i),u=DHe(c),[l]=u,f=l||"";xr.setState({prediction:f,currentWord:c,matches:u.slice(0,10),options:{selected:0,length:u.length}}),e.currentWord.length>1&&e.prediction?(xr.renderInlineSuggestion(),xr.renderOptions()):X(".suggestion").hide()}},onArrowDown:t=>{e.matches.length>0&&(t.preventDefault(),xr.selectOption(t,"down"))},onArrowUp:t=>{e.matches.length>0&&(t.preventDefault(),xr.selectOption(t,"up"))},setValue:()=>{},onEnter:t=>{e.matches.length>0&&(t.preventDefault(),xr.acceptCompletion()),Gye(t)},onEscape:()=>{xr.resetState(),X(".suggestion").hide()},onTab:t=>{t.preventDefault(),xr.acceptCompletion()},onKeyDown:t=>{t.keyCode===13&&xr.onEnter(t),t.keyCode===40&&xr.onArrowDown(t),t.keyCode===38&&xr.onArrowUp(t),t.keyCode===9&&xr.onTab(t),t.keyCode===32&&xr.setState({prediction:""}),t.keyCode===27&&xr.onEscape(t)},onKeyUp:t=>{let n=hn(),i=U0(t.target.value);X(".title h3").html(i);let{text:o=""}=n||{},s=n&&xr.el.getValue()===o;Pu(s)},onPaste:async()=>{var n;let t=await navigator.clipboard.read();for(let i of t){let o=(n=i.types)==null?void 0:n.filter(s=>s.startsWith("image/"));for(let s of o){let a=await i.getType(s),c=Fe.get("MIROPAD_SECRET_TOKEN");if(c){let[u,l]=s.split("/"),f=`${k1()}.${l}`;X("#logo").addClass("loading");try{let{url:h}=await fetch(`${dc.file_service.api}?fileName=${f}`,{method:"POST",headers:{"x-secret-token":c,accept:"application/json","content-type":"application/octet-stream"},body:a}).then(yA).then(d=>d.json());X(".terminal").insertAtCaret(`![image](${h})`)}catch(h){ze.error(`Uploading file failed \u{1F4A5}! Error$ ${h.message}`)}X("#logo").removeClass("loading")}else{let u=URL.createObjectURL(a);X(".terminal").insertAtCaret(`![image](${u})`)}nf.update()}}},init:function(){this.el.listen("focus",this.onFocus).listen("input",this.onInput).listen("keydown",this.onKeyDown).listen("keyup",this.onKeyUp).listen("paste",this.onPaste)}}})();var Wye=()=>{let{authToken:r,gistId:e}=Fe.get(["authToken","gistId"]);return!!(r&&e)};var OHe=r=>Object.entries(r).reduce((e,[t,n])=>{let i=e[n]||[];return{...e,[n]:[t,...i]}},{}),Yye=()=>({char:null,children:{},frequency:0,hasChildren:function(){return Object.keys(this.children).length>0},isWord:function(){return this.frequency>0},contains:function(r){return Object.keys(this.children).includes(r)},getWords:function(r,e={}){let t=this;if(t.isWord()&&(e={...e,[r]:this.frequency}),t.hasChildren())for(let n of Object.values(t.children))e=n.getWords(`${r}${n.char}`,e);return e},increaseFrequency:function(){this.frequency=this.frequency+1},insert:function(r){let[e,...t]=r;if(e){let n=t.length===0;if(this.contains(e)){let i=this.children[e];return i.char=e,n&&i.increaseFrequency(),i.insert(t)}else return this.insertNode(e,n).insert(t)}},insertNode:function(r,e=!1){let t=Yye();return e&&t.increaseFrequency(),t.char=r,this.children={...this.children,[r]:t},t}}),Qye=()=>{let r=Yye();return{insert:function(e=[]){return(Array.isArray(e)?e:[e]).forEach(n=>r.insert(n)),this},search:function(e=""){let t=r;return e.split("").forEach(n=>{t&&(t=t.children[n])}),t?t.getWords(e):{}},getMatchingWords:function(e=""){let t=OHe(this.search(e));return Object.keys(t).sort((n,i)=>parseInt(i,10)-parseInt(n,10)).flatMap(n=>t[n].sort())}}};var LHe=r=>{let{message:e="Unexpected error occurred!"}=r;ze.error(e)},Xye=LHe;var Zye=async r=>{X(".anchor").show(),X("#logo").addClass("loading");let e=await WS.retrieve(r);X("#logo").removeClass("loading"),Pu(!1),X(".terminal").setValue(e)};var BHe=async r=>{if(r){let e=await fetch(r).then(t=>{if(t.ok)return t.text();throw new Error(`Remote note could not be retrieved! code: ${t.status}`)});X(".terminal").setValue(e)}},MHe=async r=>{if(r)try{let e=await p6(r),{files:t}=e,n=Object.values(t),[i]=n,{content:o}=i;X(".terminal").setValue(o)}catch{ze.error("MiroPad note not found! \u{1F937}\u200D\u2642\uFE0F")}},BU=async(r={})=>{try{let{oldURL:i,newURL:o}=r,s=ht.getPageId(i),a=ht.getPageId(o),c=s!==a,{v:u}=ht.getParamsObject(i),{v:l}=ht.getParamsObject(o);[c,u!==l].some(g=>g)&&_6();let{gistId:d,raw:p}=ht.getParamsObject(o);await MHe(d),await BHe(p)}catch(i){ze.error(i.message)}let e=!ht.getPageId();X("#note-info-button").show(!e),X("#new-note").disable(e),ht.getSearchParam("md")==="full"?X(".terminal").hide():X(".terminal").show(),ht.getSearchParam("zen")==="true"?X(".header").hide():X(".header").show(),ht.getSearchParam("cid")?await Zye(ht.getSearchParam("cid")):X(".anchor").hide(),X(".note-info").hide();let t=ht.getSearchParam("q"),n=cF(t);n&&X(".terminal").setValue(n.text)};var UHe=()=>"production"==="development",Jye=()=>{UHe()&&new EventSource("/esbuild").addEventListener("change",()=>location.reload())};var e3e=()=>{X(".task-list-item").listenAll("click",r=>{r.firstChild.checked=!r.firstChild.checked})};var QS=Qye(),FHe=()=>{X("#note-info-close").listen("click",()=>{X(".note-info").hide()}),X("#note-info-button").listen("click",()=>{let r=hn();if(X(".note-info").show(),X(".note-info .details").innerHTML(`<p>
      <label>
      Title
      </label>
      ${r.title}
      </p>
      <p>
        <label>
        Modified
        </label>
        ${d6(r.dateCreated)}
      </p>
      <p>
        <label>
        No. of revisions
        </label>
        ${r.numberOfRevisions}
      </p>
      `),Wye()&&r){let n=(()=>{let{disableSync:i}=r,o=document.createElement("P");return o.innerHTML=`
          <label>Sync</label>
            <label class="switch" title="Cloud Sync">
              <input id="sync" type="checkbox" ${!i&&"checked"}>
            <span class="slider round"></span>
          </label>
        `,o})();X(".note-info .details").append(n),X("#sync").listen("click",i=>{oF(!i.target.checked)})}let t=(()=>{let n=document.createElement("P");return n.innerHTML=`
          <button
            class="icon-button"
            type="button"
            id="delete-note"
          >
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="-3 -3 27.5 27.5">
              <path  d="M15.5 2h-3.5v-0.5c0-0.827-0.673-1.5-1.5-1.5h-2c-0.827 0-1.5 0.673-1.5 1.5v0.5h-3.5c-0.827 0-1.5 0.673-1.5 1.5v1c0 0.652 0.418 1.208 1 1.414v12.586c0 0.827 0.673 1.5 1.5 1.5h10c0.827 0 1.5-0.673 1.5-1.5v-12.586c0.582-0.206 1-0.762 1-1.414v-1c0-0.827-0.673-1.5-1.5-1.5zM8 1.5c0-0.276 0.224-0.5 0.5-0.5h2c0.276 0 0.5 0.224 0.5 0.5v0.5h-3v-0.5zM14.5 19h-10c-0.276 0-0.5-0.224-0.5-0.5v-12.5h11v12.5c0 0.276-0.224 0.5-0.5 0.5zM16 4.5c0 0.276-0.224 0.5-0.5 0.5h-12c-0.276 0-0.5-0.224-0.5-0.5v-1c0-0.276 0.224-0.5 0.5-0.5h12c0.276 0 0.5 0.224 0.5 0.5v1z"></path>
              <path  d="M12.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M9.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M6.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
            </svg>
            Delete
          </button>
        `,n})();X(".note-info .details").append(t),X("#delete-note").listen("click",()=>{v6()})})},zHe=async()=>{let r=Fe.getDictionary();QS.insert(r),window.addEventListener("error",Xye),MU(),Ct.init(),FHe(),xr.init(),w6(),_6(ht.getPageId()),X(".logo").listen("click",()=>{Ct.toggle(Ct.getModes().notes)}),X("#permalink").listen("click",async()=>{await Nu(ht.get())}),nf.init(),window.addEventListener("hashchange",BU),BU(),Kye(),e3e(),await $g(),await mF(),Jye()},t3e=zHe;t3e();})();
/*! Bundled license information:

showdown/dist/showdown.js:
  (*! showdown v 2.1.0 - 21-04-2022 *)

bytes/index.js:
  (*!
   * bytes
   * Copyright(c) 2012-2014 TJ Holowaychuk
   * Copyright(c) 2015 Jed Watson
   * MIT Licensed
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=index.js.map
