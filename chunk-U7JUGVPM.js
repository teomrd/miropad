import{a as Wt}from"./chunk-SRM5CHDV.js";import{c as ft}from"./chunk-YW5DPG3L.js";import{d as ct}from"./chunk-SO7LSWKM.js";import{i as cs,k as os,o as ut,q as J}from"./chunk-MGXIVZEI.js";import{D as Nt,H as At,I as Q,K as Tt,M as is,N as ls,Z as X,aa as ns,h as S,ia as Y,j as q,v as rs}from"./chunk-HJPNRYHP.js";function Ht(n,t,r){if(n&&n.length){let[a,e]=t,i=Math.PI/180*r,o=Math.cos(i),s=Math.sin(i);for(let h of n){let[l,c]=h;h[0]=(l-a)*o-(c-e)*s+a,h[1]=(l-a)*s+(c-e)*o+e}}}function je(n,t){return n[0]===t[0]&&n[1]===t[1]}function Ge(n,t,r,a=1){let e=r,i=Math.max(t,.1),o=n[0]&&n[0][0]&&typeof n[0][0]=="number"?[n]:n,s=[0,0];if(e)for(let l of o)Ht(l,s,e);let h=function(l,c,g){let f=[];for(let x of l){let b=[...x];je(b[0],b[b.length-1])||b.push([b[0][0],b[0][1]]),b.length>2&&f.push(b)}let p=[];c=Math.max(c,.1);let u=[];for(let x of f)for(let b=0;b<x.length-1;b++){let k=x[b],w=x[b+1];if(k[1]!==w[1]){let v=Math.min(k[1],w[1]);u.push({ymin:v,ymax:Math.max(k[1],w[1]),x:v===k[1]?k[0]:w[0],islope:(w[0]-k[0])/(w[1]-k[1])})}}if(u.sort((x,b)=>x.ymin<b.ymin?-1:x.ymin>b.ymin?1:x.x<b.x?-1:x.x>b.x?1:x.ymax===b.ymax?0:(x.ymax-b.ymax)/Math.abs(x.ymax-b.ymax)),!u.length)return p;let y=[],d=u[0].ymin,m=0;for(;y.length||u.length;){if(u.length){let x=-1;for(let b=0;b<u.length&&!(u[b].ymin>d);b++)x=b;u.splice(0,x+1).forEach(b=>{y.push({s:d,edge:b})})}if(y=y.filter(x=>!(x.edge.ymax<=d)),y.sort((x,b)=>x.edge.x===b.edge.x?0:(x.edge.x-b.edge.x)/Math.abs(x.edge.x-b.edge.x)),(g!==1||m%c==0)&&y.length>1)for(let x=0;x<y.length;x+=2){let b=x+1;if(b>=y.length)break;let k=y[x].edge,w=y[b].edge;p.push([[Math.round(k.x),d],[Math.round(w.x),d]])}d+=g,y.forEach(x=>{x.edge.x=x.edge.x+g*x.edge.islope}),m++}return p}(o,i,a);if(e){for(let l of o)Ht(l,s,-e);(function(l,c,g){let f=[];l.forEach(p=>f.push(...p)),Ht(f,c,g)})(h,s,-e)}return h}function xt(n,t){var r;let a=t.hachureAngle+90,e=t.hachureGap;e<0&&(e=4*t.strokeWidth),e=Math.round(Math.max(e,.1));let i=1;return t.roughness>=1&&(((r=t.randomizer)===null||r===void 0?void 0:r.next())||Math.random())>.7&&(i=e),Ge(n,e,a,i||1)}var dt=class{constructor(t){this.helper=t}fillPolygons(t,r){return this._fillPolygons(t,r)}_fillPolygons(t,r){let a=xt(t,r);return{type:"fillSketch",ops:this.renderLines(a,r)}}renderLines(t,r){let a=[];for(let e of t)a.push(...this.helper.doubleLineOps(e[0][0],e[0][1],e[1][0],e[1][1],r));return a}};function Bt(n){let t=n[0],r=n[1];return Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))}var zt=class extends dt{fillPolygons(t,r){let a=r.hachureGap;a<0&&(a=4*r.strokeWidth),a=Math.max(a,.1);let e=xt(t,Object.assign({},r,{hachureGap:a})),i=Math.PI/180*r.hachureAngle,o=[],s=.5*a*Math.cos(i),h=.5*a*Math.sin(i);for(let[l,c]of e)Bt([l,c])&&o.push([[l[0]-s,l[1]+h],[...c]],[[l[0]+s,l[1]-h],[...c]]);return{type:"fillSketch",ops:this.renderLines(o,r)}}},jt=class extends dt{fillPolygons(t,r){let a=this._fillPolygons(t,r),e=Object.assign({},r,{hachureAngle:r.hachureAngle+90}),i=this._fillPolygons(t,e);return a.ops=a.ops.concat(i.ops),a}},Gt=class{constructor(t){this.helper=t}fillPolygons(t,r){let a=xt(t,r=Object.assign({},r,{hachureAngle:0}));return this.dotsOnLines(a,r)}dotsOnLines(t,r){let a=[],e=r.hachureGap;e<0&&(e=4*r.strokeWidth),e=Math.max(e,.1);let i=r.fillWeight;i<0&&(i=r.strokeWidth/2);let o=e/4;for(let s of t){let h=Bt(s),l=h/e,c=Math.ceil(l)-1,g=h-c*e,f=(s[0][0]+s[1][0])/2-e/4,p=Math.min(s[0][1],s[1][1]);for(let u=0;u<c;u++){let y=p+g+u*e,d=f-o+2*Math.random()*o,m=y-o+2*Math.random()*o,x=this.helper.ellipse(d,m,i,i,r);a.push(...x.ops)}}return{type:"fillSketch",ops:a}}},Ft=class{constructor(t){this.helper=t}fillPolygons(t,r){let a=xt(t,r);return{type:"fillSketch",ops:this.dashedLine(a,r)}}dashedLine(t,r){let a=r.dashOffset<0?r.hachureGap<0?4*r.strokeWidth:r.hachureGap:r.dashOffset,e=r.dashGap<0?r.hachureGap<0?4*r.strokeWidth:r.hachureGap:r.dashGap,i=[];return t.forEach(o=>{let s=Bt(o),h=Math.floor(s/(a+e)),l=(s+e-h*(a+e))/2,c=o[0],g=o[1];c[0]>g[0]&&(c=o[1],g=o[0]);let f=Math.atan((g[1]-c[1])/(g[0]-c[0]));for(let p=0;p<h;p++){let u=p*(a+e),y=u+a,d=[c[0]+u*Math.cos(f)+l*Math.cos(f),c[1]+u*Math.sin(f)+l*Math.sin(f)],m=[c[0]+y*Math.cos(f)+l*Math.cos(f),c[1]+y*Math.sin(f)+l*Math.sin(f)];i.push(...this.helper.doubleLineOps(d[0],d[1],m[0],m[1],r))}}),i}},qt=class{constructor(t){this.helper=t}fillPolygons(t,r){let a=r.hachureGap<0?4*r.strokeWidth:r.hachureGap,e=r.zigzagOffset<0?a:r.zigzagOffset,i=xt(t,r=Object.assign({},r,{hachureGap:a+e}));return{type:"fillSketch",ops:this.zigzagLines(i,e,r)}}zigzagLines(t,r,a){let e=[];return t.forEach(i=>{let o=Bt(i),s=Math.round(o/(2*r)),h=i[0],l=i[1];h[0]>l[0]&&(h=i[1],l=i[0]);let c=Math.atan((l[1]-h[1])/(l[0]-h[0]));for(let g=0;g<s;g++){let f=2*g*r,p=2*(g+1)*r,u=Math.sqrt(2*Math.pow(r,2)),y=[h[0]+f*Math.cos(c),h[1]+f*Math.sin(c)],d=[h[0]+p*Math.cos(c),h[1]+p*Math.sin(c)],m=[y[0]+u*Math.cos(c+Math.PI/4),y[1]+u*Math.sin(c+Math.PI/4)];e.push(...this.helper.doubleLineOps(y[0],y[1],m[0],m[1],a),...this.helper.doubleLineOps(m[0],m[1],d[0],d[1],a))}}),e}},U={},Xt=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}},Fe=0,It=1,hs=2,St={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Et(n,t){return n.type===t}function Ut(n){let t=[],r=function(o){let s=new Array;for(;o!=="";)if(o.match(/^([ \t\r\n,]+)/))o=o.substr(RegExp.$1.length);else if(o.match(/^([aAcChHlLmMqQsStTvVzZ])/))s[s.length]={type:Fe,text:RegExp.$1},o=o.substr(RegExp.$1.length);else{if(!o.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];s[s.length]={type:It,text:`${parseFloat(RegExp.$1)}`},o=o.substr(RegExp.$1.length)}return s[s.length]={type:hs,text:""},s}(n),a="BOD",e=0,i=r[e];for(;!Et(i,hs);){let o=0,s=[];if(a==="BOD"){if(i.text!=="M"&&i.text!=="m")return Ut("M0,0"+n);e++,o=St[i.text],a=i.text}else Et(i,It)?o=St[a]:(e++,o=St[i.text],a=i.text);if(!(e+o<r.length))throw new Error("Path data ended short");for(let h=e;h<e+o;h++){let l=r[h];if(!Et(l,It))throw new Error("Param not a number: "+a+","+l.text);s[s.length]=+l.text}if(typeof St[a]!="number")throw new Error("Bad segment: "+a);{let h={key:a,data:s};t.push(h),e+=o,i=r[e],a==="M"&&(a="L"),a==="m"&&(a="l")}}return t}function xs(n){let t=0,r=0,a=0,e=0,i=[];for(let{key:o,data:s}of n)switch(o){case"M":i.push({key:"M",data:[...s]}),[t,r]=s,[a,e]=s;break;case"m":t+=s[0],r+=s[1],i.push({key:"M",data:[t,r]}),a=t,e=r;break;case"L":i.push({key:"L",data:[...s]}),[t,r]=s;break;case"l":t+=s[0],r+=s[1],i.push({key:"L",data:[t,r]});break;case"C":i.push({key:"C",data:[...s]}),t=s[4],r=s[5];break;case"c":{let h=s.map((l,c)=>c%2?l+r:l+t);i.push({key:"C",data:h}),t=h[4],r=h[5];break}case"Q":i.push({key:"Q",data:[...s]}),t=s[2],r=s[3];break;case"q":{let h=s.map((l,c)=>c%2?l+r:l+t);i.push({key:"Q",data:h}),t=h[2],r=h[3];break}case"A":i.push({key:"A",data:[...s]}),t=s[5],r=s[6];break;case"a":t+=s[5],r+=s[6],i.push({key:"A",data:[s[0],s[1],s[2],s[3],s[4],t,r]});break;case"H":i.push({key:"H",data:[...s]}),t=s[0];break;case"h":t+=s[0],i.push({key:"H",data:[t]});break;case"V":i.push({key:"V",data:[...s]}),r=s[0];break;case"v":r+=s[0],i.push({key:"V",data:[r]});break;case"S":i.push({key:"S",data:[...s]}),t=s[2],r=s[3];break;case"s":{let h=s.map((l,c)=>c%2?l+r:l+t);i.push({key:"S",data:h}),t=h[2],r=h[3];break}case"T":i.push({key:"T",data:[...s]}),t=s[0],r=s[1];break;case"t":t+=s[0],r+=s[1],i.push({key:"T",data:[t,r]});break;case"Z":case"z":i.push({key:"Z",data:[]}),t=a,r=e}return i}function bs(n){let t=[],r="",a=0,e=0,i=0,o=0,s=0,h=0;for(let{key:l,data:c}of n){switch(l){case"M":t.push({key:"M",data:[...c]}),[a,e]=c,[i,o]=c;break;case"C":t.push({key:"C",data:[...c]}),a=c[4],e=c[5],s=c[2],h=c[3];break;case"L":t.push({key:"L",data:[...c]}),[a,e]=c;break;case"H":a=c[0],t.push({key:"L",data:[a,e]});break;case"V":e=c[0],t.push({key:"L",data:[a,e]});break;case"S":{let g=0,f=0;r==="C"||r==="S"?(g=a+(a-s),f=e+(e-h)):(g=a,f=e),t.push({key:"C",data:[g,f,...c]}),s=c[0],h=c[1],a=c[2],e=c[3];break}case"T":{let[g,f]=c,p=0,u=0;r==="Q"||r==="T"?(p=a+(a-s),u=e+(e-h)):(p=a,u=e);let y=a+2*(p-a)/3,d=e+2*(u-e)/3,m=g+2*(p-g)/3,x=f+2*(u-f)/3;t.push({key:"C",data:[y,d,m,x,g,f]}),s=p,h=u,a=g,e=f;break}case"Q":{let[g,f,p,u]=c,y=a+2*(g-a)/3,d=e+2*(f-e)/3,m=p+2*(g-p)/3,x=u+2*(f-u)/3;t.push({key:"C",data:[y,d,m,x,p,u]}),s=g,h=f,a=p,e=u;break}case"A":{let g=Math.abs(c[0]),f=Math.abs(c[1]),p=c[2],u=c[3],y=c[4],d=c[5],m=c[6];g===0||f===0?(t.push({key:"C",data:[a,e,d,m,d,m]}),a=d,e=m):(a!==d||e!==m)&&(ws(a,e,d,m,g,f,p,u,y).forEach(function(x){t.push({key:"C",data:x})}),a=d,e=m);break}case"Z":t.push({key:"Z",data:[]}),a=i,e=o}r=l}return t}function yt(n,t,r){return[n*Math.cos(r)-t*Math.sin(r),n*Math.sin(r)+t*Math.cos(r)]}function ws(n,t,r,a,e,i,o,s,h,l){let c=(g=o,Math.PI*g/180);var g;let f=[],p=0,u=0,y=0,d=0;if(l)[p,u,y,d]=l;else{[n,t]=yt(n,t,-c),[r,a]=yt(r,a,-c);let D=(n-r)/2,C=(t-a)/2,N=D*D/(e*e)+C*C/(i*i);N>1&&(N=Math.sqrt(N),e*=N,i*=N);let B=e*e,I=i*i,z=B*I-B*C*C-I*D*D,V=B*C*C+I*D*D,tt=(s===h?-1:1)*Math.sqrt(Math.abs(z/V));y=tt*e*C/i+(n+r)/2,d=tt*-i*D/e+(t+a)/2,p=Math.asin(parseFloat(((t-d)/i).toFixed(9))),u=Math.asin(parseFloat(((a-d)/i).toFixed(9))),n<y&&(p=Math.PI-p),r<y&&(u=Math.PI-u),p<0&&(p=2*Math.PI+p),u<0&&(u=2*Math.PI+u),h&&p>u&&(p-=2*Math.PI),!h&&u>p&&(u-=2*Math.PI)}let m=u-p;if(Math.abs(m)>120*Math.PI/180){let D=u,C=r,N=a;u=h&&u>p?p+120*Math.PI/180*1:p+120*Math.PI/180*-1,f=ws(r=y+e*Math.cos(u),a=d+i*Math.sin(u),C,N,e,i,o,0,h,[u,D,y,d])}m=u-p;let x=Math.cos(p),b=Math.sin(p),k=Math.cos(u),w=Math.sin(u),v=Math.tan(m/4),$=4/3*e*v,P=4/3*i*v,E=[n,t],A=[n+$*b,t-P*x],R=[r+$*w,a-P*k],_=[r,a];if(A[0]=2*E[0]-A[0],A[1]=2*E[1]-A[1],l)return[A,R,_].concat(f);{f=[A,R,_].concat(f);let D=[];for(let C=0;C<f.length;C+=3){let N=yt(f[C][0],f[C][1],c),B=yt(f[C+1][0],f[C+1][1],c),I=yt(f[C+2][0],f[C+2][1],c);D.push([N[0],N[1],B[0],B[1],I[0],I[1]])}return D}}var qe={randOffset:function(n,t){return O(n,t)},randOffsetWithRange:function(n,t,r){return Dt(n,t,r)},ellipse:function(n,t,r,a,e){let i=Ms(r,a,e);return Yt(n,t,e,i).opset},doubleLineOps:function(n,t,r,a,e){return it(n,t,r,a,e,!0)}};function Ss(n,t,r,a,e){return{type:"path",ops:it(n,t,r,a,e)}}function vt(n,t,r){let a=(n||[]).length;if(a>2){let e=[];for(let i=0;i<a-1;i++)e.push(...it(n[i][0],n[i][1],n[i+1][0],n[i+1][1],r));return t&&e.push(...it(n[a-1][0],n[a-1][1],n[0][0],n[0][1],r)),{type:"path",ops:e}}return a===2?Ss(n[0][0],n[0][1],n[1][0],n[1][1],r):{type:"path",ops:[]}}function Xe(n,t,r,a,e){return function(i,o){return vt(i,!0,o)}([[n,t],[n+r,t],[n+r,t+a],[n,t+a]],e)}function gs(n,t){if(n.length){let r=typeof n[0][0]=="number"?[n]:n,a=Mt(r[0],1*(1+.2*t.roughness),t),e=t.disableMultiStroke?[]:Mt(r[0],1.5*(1+.22*t.roughness),us(t));for(let i=1;i<r.length;i++){let o=r[i];if(o.length){let s=Mt(o,1*(1+.2*t.roughness),t),h=t.disableMultiStroke?[]:Mt(o,1.5*(1+.22*t.roughness),us(t));for(let l of s)l.op!=="move"&&a.push(l);for(let l of h)l.op!=="move"&&e.push(l)}}return{type:"path",ops:a.concat(e)}}return{type:"path",ops:[]}}function Ms(n,t,r){let a=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(n/2,2)+Math.pow(t/2,2))/2)),e=Math.ceil(Math.max(r.curveStepCount,r.curveStepCount/Math.sqrt(200)*a)),i=2*Math.PI/e,o=Math.abs(n/2),s=Math.abs(t/2),h=1-r.curveFitting;return o+=O(o*h,r),s+=O(s*h,r),{increment:i,rx:o,ry:s}}function Yt(n,t,r,a){let[e,i]=ys(a.increment,n,t,a.rx,a.ry,1,a.increment*Dt(.1,Dt(.4,1,r),r),r),o=Pt(e,null,r);if(!r.disableMultiStroke&&r.roughness!==0){let[s]=ys(a.increment,n,t,a.rx,a.ry,1.5,0,r),h=Pt(s,null,r);o=o.concat(h)}return{estimatedPoints:i,opset:{type:"path",ops:o}}}function ps(n,t,r,a,e,i,o,s,h){let l=n,c=t,g=Math.abs(r/2),f=Math.abs(a/2);g+=O(.01*g,h),f+=O(.01*f,h);let p=e,u=i;for(;p<0;)p+=2*Math.PI,u+=2*Math.PI;u-p>2*Math.PI&&(p=0,u=2*Math.PI);let y=2*Math.PI/h.curveStepCount,d=Math.min(y/2,(u-p)/2),m=ms(d,l,c,g,f,p,u,1,h);if(!h.disableMultiStroke){let x=ms(d,l,c,g,f,p,u,1.5,h);m.push(...x)}return o&&(s?m.push(...it(l,c,l+g*Math.cos(p),c+f*Math.sin(p),h),...it(l,c,l+g*Math.cos(u),c+f*Math.sin(u),h)):m.push({op:"lineTo",data:[l,c]},{op:"lineTo",data:[l+g*Math.cos(p),c+f*Math.sin(p)]})),{type:"path",ops:m}}function fs(n,t){let r=bs(xs(Ut(n))),a=[],e=[0,0],i=[0,0];for(let{key:o,data:s}of r)switch(o){case"M":i=[s[0],s[1]],e=[s[0],s[1]];break;case"L":a.push(...it(i[0],i[1],s[0],s[1],t)),i=[s[0],s[1]];break;case"C":{let[h,l,c,g,f,p]=s;a.push(...Ye(h,l,c,g,f,p,i,t)),i=[f,p];break}case"Z":a.push(...it(i[0],i[1],e[0],e[1],t)),i=[e[0],e[1]]}return{type:"path",ops:a}}function Ot(n,t){let r=[];for(let a of n)if(a.length){let e=t.maxRandomnessOffset||0,i=a.length;if(i>2){r.push({op:"move",data:[a[0][0]+O(e,t),a[0][1]+O(e,t)]});for(let o=1;o<i;o++)r.push({op:"lineTo",data:[a[o][0]+O(e,t),a[o][1]+O(e,t)]})}}return{type:"fillPath",ops:r}}function ot(n,t){return function(r,a){let e=r.fillStyle||"hachure";if(!U[e])switch(e){case"zigzag":U[e]||(U[e]=new zt(a));break;case"cross-hatch":U[e]||(U[e]=new jt(a));break;case"dots":U[e]||(U[e]=new Gt(a));break;case"dashed":U[e]||(U[e]=new Ft(a));break;case"zigzag-line":U[e]||(U[e]=new qt(a));break;default:e="hachure",U[e]||(U[e]=new dt(a))}return U[e]}(t,qe).fillPolygons(n,t)}function us(n){let t=Object.assign({},n);return t.randomizer=void 0,n.seed&&(t.seed=n.seed+1),t}function ks(n){return n.randomizer||(n.randomizer=new Xt(n.seed||0)),n.randomizer.next()}function Dt(n,t,r,a=1){return r.roughness*a*(ks(r)*(t-n)+n)}function O(n,t,r=1){return Dt(-n,n,t,r)}function it(n,t,r,a,e,i=!1){let o=i?e.disableMultiStrokeFill:e.disableMultiStroke,s=Vt(n,t,r,a,e,!0,!1);if(o)return s;let h=Vt(n,t,r,a,e,!0,!0);return s.concat(h)}function Vt(n,t,r,a,e,i,o){let s=Math.pow(n-r,2)+Math.pow(t-a,2),h=Math.sqrt(s),l=1;l=h<200?1:h>500?.4:-.0016668*h+1.233334;let c=e.maxRandomnessOffset||0;c*c*100>s&&(c=h/10);let g=c/2,f=.2+.2*ks(e),p=e.bowing*e.maxRandomnessOffset*(a-t)/200,u=e.bowing*e.maxRandomnessOffset*(n-r)/200;p=O(p,e,l),u=O(u,e,l);let y=[],d=()=>O(g,e,l),m=()=>O(c,e,l),x=e.preserveVertices;return i&&(o?y.push({op:"move",data:[n+(x?0:d()),t+(x?0:d())]}):y.push({op:"move",data:[n+(x?0:O(c,e,l)),t+(x?0:O(c,e,l))]})),o?y.push({op:"bcurveTo",data:[p+n+(r-n)*f+d(),u+t+(a-t)*f+d(),p+n+2*(r-n)*f+d(),u+t+2*(a-t)*f+d(),r+(x?0:d()),a+(x?0:d())]}):y.push({op:"bcurveTo",data:[p+n+(r-n)*f+m(),u+t+(a-t)*f+m(),p+n+2*(r-n)*f+m(),u+t+2*(a-t)*f+m(),r+(x?0:m()),a+(x?0:m())]}),y}function Mt(n,t,r){if(!n.length)return[];let a=[];a.push([n[0][0]+O(t,r),n[0][1]+O(t,r)]),a.push([n[0][0]+O(t,r),n[0][1]+O(t,r)]);for(let e=1;e<n.length;e++)a.push([n[e][0]+O(t,r),n[e][1]+O(t,r)]),e===n.length-1&&a.push([n[e][0]+O(t,r),n[e][1]+O(t,r)]);return Pt(a,null,r)}function Pt(n,t,r){let a=n.length,e=[];if(a>3){let i=[],o=1-r.curveTightness;e.push({op:"move",data:[n[1][0],n[1][1]]});for(let s=1;s+2<a;s++){let h=n[s];i[0]=[h[0],h[1]],i[1]=[h[0]+(o*n[s+1][0]-o*n[s-1][0])/6,h[1]+(o*n[s+1][1]-o*n[s-1][1])/6],i[2]=[n[s+1][0]+(o*n[s][0]-o*n[s+2][0])/6,n[s+1][1]+(o*n[s][1]-o*n[s+2][1])/6],i[3]=[n[s+1][0],n[s+1][1]],e.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}if(t&&t.length===2){let s=r.maxRandomnessOffset;e.push({op:"lineTo",data:[t[0]+O(s,r),t[1]+O(s,r)]})}}else a===3?(e.push({op:"move",data:[n[1][0],n[1][1]]}),e.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):a===2&&e.push(...Vt(n[0][0],n[0][1],n[1][0],n[1][1],r,!0,!0));return e}function ys(n,t,r,a,e,i,o,s){let h=[],l=[];if(s.roughness===0){n/=4,l.push([t+a*Math.cos(-n),r+e*Math.sin(-n)]);for(let c=0;c<=2*Math.PI;c+=n){let g=[t+a*Math.cos(c),r+e*Math.sin(c)];h.push(g),l.push(g)}l.push([t+a*Math.cos(0),r+e*Math.sin(0)]),l.push([t+a*Math.cos(n),r+e*Math.sin(n)])}else{let c=O(.5,s)-Math.PI/2;l.push([O(i,s)+t+.9*a*Math.cos(c-n),O(i,s)+r+.9*e*Math.sin(c-n)]);let g=2*Math.PI+c-.01;for(let f=c;f<g;f+=n){let p=[O(i,s)+t+a*Math.cos(f),O(i,s)+r+e*Math.sin(f)];h.push(p),l.push(p)}l.push([O(i,s)+t+a*Math.cos(c+2*Math.PI+.5*o),O(i,s)+r+e*Math.sin(c+2*Math.PI+.5*o)]),l.push([O(i,s)+t+.98*a*Math.cos(c+o),O(i,s)+r+.98*e*Math.sin(c+o)]),l.push([O(i,s)+t+.9*a*Math.cos(c+.5*o),O(i,s)+r+.9*e*Math.sin(c+.5*o)])}return[l,h]}function ms(n,t,r,a,e,i,o,s,h){let l=i+O(.1,h),c=[];c.push([O(s,h)+t+.9*a*Math.cos(l-n),O(s,h)+r+.9*e*Math.sin(l-n)]);for(let g=l;g<=o;g+=n)c.push([O(s,h)+t+a*Math.cos(g),O(s,h)+r+e*Math.sin(g)]);return c.push([t+a*Math.cos(o),r+e*Math.sin(o)]),c.push([t+a*Math.cos(o),r+e*Math.sin(o)]),Pt(c,null,h)}function Ye(n,t,r,a,e,i,o,s){let h=[],l=[s.maxRandomnessOffset||1,(s.maxRandomnessOffset||1)+.3],c=[0,0],g=s.disableMultiStroke?1:2,f=s.preserveVertices;for(let p=0;p<g;p++)p===0?h.push({op:"move",data:[o[0],o[1]]}):h.push({op:"move",data:[o[0]+(f?0:O(l[0],s)),o[1]+(f?0:O(l[0],s))]}),c=f?[e,i]:[e+O(l[p],s),i+O(l[p],s)],h.push({op:"bcurveTo",data:[n+O(l[p],s),t+O(l[p],s),r+O(l[p],s),a+O(l[p],s),c[0],c[1]]});return h}function mt(n){return[...n]}function ds(n,t=0){let r=n.length;if(r<3)throw new Error("A curve must have at least three points.");let a=[];if(r===3)a.push(mt(n[0]),mt(n[1]),mt(n[2]),mt(n[2]));else{let e=[];e.push(n[0],n[0]);for(let s=1;s<n.length;s++)e.push(n[s]),s===n.length-1&&e.push(n[s]);let i=[],o=1-t;a.push(mt(e[0]));for(let s=1;s+2<e.length;s++){let h=e[s];i[0]=[h[0],h[1]],i[1]=[h[0]+(o*e[s+1][0]-o*e[s-1][0])/6,h[1]+(o*e[s+1][1]-o*e[s-1][1])/6],i[2]=[e[s+1][0]+(o*e[s][0]-o*e[s+2][0])/6,e[s+1][1]+(o*e[s][1]-o*e[s+2][1])/6],i[3]=[e[s+1][0],e[s+1][1]],a.push(i[1],i[2],i[3])}}return a}function $t(n,t){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function Ve(n,t,r){let a=$t(t,r);if(a===0)return $t(n,t);let e=((n[0]-t[0])*(r[0]-t[0])+(n[1]-t[1])*(r[1]-t[1]))/a;return e=Math.max(0,Math.min(1,e)),$t(n,nt(t,r,e))}function nt(n,t,r){return[n[0]+(t[0]-n[0])*r,n[1]+(t[1]-n[1])*r]}function Zt(n,t,r,a){let e=a||[];if(function(s,h){let l=s[h+0],c=s[h+1],g=s[h+2],f=s[h+3],p=3*c[0]-2*l[0]-f[0];p*=p;let u=3*c[1]-2*l[1]-f[1];u*=u;let y=3*g[0]-2*f[0]-l[0];y*=y;let d=3*g[1]-2*f[1]-l[1];return d*=d,p<y&&(p=y),u<d&&(u=d),p+u}(n,t)<r){let s=n[t+0];e.length?(i=e[e.length-1],o=s,Math.sqrt($t(i,o))>1&&e.push(s)):e.push(s),e.push(n[t+3])}else{let h=n[t+0],l=n[t+1],c=n[t+2],g=n[t+3],f=nt(h,l,.5),p=nt(l,c,.5),u=nt(c,g,.5),y=nt(f,p,.5),d=nt(p,u,.5),m=nt(y,d,.5);Zt([h,f,y,m],0,r,e),Zt([m,d,u,g],0,r,e)}var i,o;return e}function Ze(n,t){return Ct(n,0,n.length,t)}function Ct(n,t,r,a,e){let i=e||[],o=n[t],s=n[r-1],h=0,l=1;for(let c=t+1;c<r-1;++c){let g=Ve(n[c],o,s);g>h&&(h=g,l=c)}return Math.sqrt(h)>a?(Ct(n,t,l+1,a,i),Ct(n,l,r,a,i)):(i.length||i.push(o),i.push(s)),i}function _t(n,t=.15,r){let a=[],e=(n.length-1)/3;for(let i=0;i<e;i++)Zt(n,3*i,t,a);return r&&r>0?Ct(a,0,a.length,r):a}var K="none",ht=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,r,a){return{shape:t,sets:r||[],options:a||this.defaultOptions}}line(t,r,a,e,i){let o=this._o(i);return this._d("line",[Ss(t,r,a,e,o)],o)}rectangle(t,r,a,e,i){let o=this._o(i),s=[],h=Xe(t,r,a,e,o);if(o.fill){let l=[[t,r],[t+a,r],[t+a,r+e],[t,r+e]];o.fillStyle==="solid"?s.push(Ot([l],o)):s.push(ot([l],o))}return o.stroke!==K&&s.push(h),this._d("rectangle",s,o)}ellipse(t,r,a,e,i){let o=this._o(i),s=[],h=Ms(a,e,o),l=Yt(t,r,o,h);if(o.fill)if(o.fillStyle==="solid"){let c=Yt(t,r,o,h).opset;c.type="fillPath",s.push(c)}else s.push(ot([l.estimatedPoints],o));return o.stroke!==K&&s.push(l.opset),this._d("ellipse",s,o)}circle(t,r,a,e){let i=this.ellipse(t,r,a,a,e);return i.shape="circle",i}linearPath(t,r){let a=this._o(r);return this._d("linearPath",[vt(t,!1,a)],a)}arc(t,r,a,e,i,o,s=!1,h){let l=this._o(h),c=[],g=ps(t,r,a,e,i,o,s,!0,l);if(s&&l.fill)if(l.fillStyle==="solid"){let f=Object.assign({},l);f.disableMultiStroke=!0;let p=ps(t,r,a,e,i,o,!0,!1,f);p.type="fillPath",c.push(p)}else c.push(function(f,p,u,y,d,m,x){let b=f,k=p,w=Math.abs(u/2),v=Math.abs(y/2);w+=O(.01*w,x),v+=O(.01*v,x);let $=d,P=m;for(;$<0;)$+=2*Math.PI,P+=2*Math.PI;P-$>2*Math.PI&&($=0,P=2*Math.PI);let E=(P-$)/x.curveStepCount,A=[];for(let R=$;R<=P;R+=E)A.push([b+w*Math.cos(R),k+v*Math.sin(R)]);return A.push([b+w*Math.cos(P),k+v*Math.sin(P)]),A.push([b,k]),ot([A],x)}(t,r,a,e,i,o,l));return l.stroke!==K&&c.push(g),this._d("arc",c,l)}curve(t,r){let a=this._o(r),e=[],i=gs(t,a);if(a.fill&&a.fill!==K)if(a.fillStyle==="solid"){let o=gs(t,Object.assign(Object.assign({},a),{disableMultiStroke:!0,roughness:a.roughness?a.roughness+a.fillShapeRoughnessGain:0}));e.push({type:"fillPath",ops:this._mergedShape(o.ops)})}else{let o=[],s=t;if(s.length){let h=typeof s[0][0]=="number"?[s]:s;for(let l of h)l.length<3?o.push(...l):l.length===3?o.push(..._t(ds([l[0],l[0],l[1],l[2]]),10,(1+a.roughness)/2)):o.push(..._t(ds(l),10,(1+a.roughness)/2))}o.length&&e.push(ot([o],a))}return a.stroke!==K&&e.push(i),this._d("curve",e,a)}polygon(t,r){let a=this._o(r),e=[],i=vt(t,!0,a);return a.fill&&(a.fillStyle==="solid"?e.push(Ot([t],a)):e.push(ot([t],a))),a.stroke!==K&&e.push(i),this._d("polygon",e,a)}path(t,r){let a=this._o(r),e=[];if(!t)return this._d("path",e,a);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");let i=a.fill&&a.fill!=="transparent"&&a.fill!==K,o=a.stroke!==K,s=!!(a.simplification&&a.simplification<1),h=function(c,g,f){let p=bs(xs(Ut(c))),u=[],y=[],d=[0,0],m=[],x=()=>{m.length>=4&&y.push(..._t(m,g)),m=[]},b=()=>{x(),y.length&&(u.push(y),y=[])};for(let{key:w,data:v}of p)switch(w){case"M":b(),d=[v[0],v[1]],y.push(d);break;case"L":x(),y.push([v[0],v[1]]);break;case"C":if(!m.length){let $=y.length?y[y.length-1]:d;m.push([$[0],$[1]])}m.push([v[0],v[1]]),m.push([v[2],v[3]]),m.push([v[4],v[5]]);break;case"Z":x(),y.push([d[0],d[1]])}if(b(),!f)return u;let k=[];for(let w of u){let v=Ze(w,f);v.length&&k.push(v)}return k}(t,1,s?4-4*(a.simplification||1):(1+a.roughness)/2),l=fs(t,a);if(i)if(a.fillStyle==="solid")if(h.length===1){let c=fs(t,Object.assign(Object.assign({},a),{disableMultiStroke:!0,roughness:a.roughness?a.roughness+a.fillShapeRoughnessGain:0}));e.push({type:"fillPath",ops:this._mergedShape(c.ops)})}else e.push(Ot(h,a));else e.push(ot(h,a));return o&&(s?h.forEach(c=>{e.push(vt(c,!1,a))}):e.push(l)),this._d("path",e,a)}opsToPath(t,r){let a="";for(let e of t.ops){let i=typeof r=="number"&&r>=0?e.data.map(o=>+o.toFixed(r)):e.data;switch(e.op){case"move":a+=`M${i[0]} ${i[1]} `;break;case"bcurveTo":a+=`C${i[0]} ${i[1]}, ${i[2]} ${i[3]}, ${i[4]} ${i[5]} `;break;case"lineTo":a+=`L${i[0]} ${i[1]} `}}return a.trim()}toPaths(t){let r=t.sets||[],a=t.options||this.defaultOptions,e=[];for(let i of r){let o=null;switch(i.type){case"path":o={d:this.opsToPath(i),stroke:a.stroke,strokeWidth:a.strokeWidth,fill:K};break;case"fillPath":o={d:this.opsToPath(i),stroke:K,strokeWidth:0,fill:a.fill||K};break;case"fillSketch":o=this.fillSketch(i,a)}o&&e.push(o)}return e}fillSketch(t,r){let a=r.fillWeight;return a<0&&(a=r.strokeWidth/2),{d:this.opsToPath(t),stroke:r.fill||K,strokeWidth:a,fill:K}}_mergedShape(t){return t.filter((r,a)=>a===0||r.op!=="move")}},Qt=class{constructor(t,r){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new ht(r)}draw(t){let r=t.sets||[],a=t.options||this.getDefaultOptions(),e=this.ctx,i=t.options.fixedDecimalPlaceDigits;for(let o of r)switch(o.type){case"path":e.save(),e.strokeStyle=a.stroke==="none"?"transparent":a.stroke,e.lineWidth=a.strokeWidth,a.strokeLineDash&&e.setLineDash(a.strokeLineDash),a.strokeLineDashOffset&&(e.lineDashOffset=a.strokeLineDashOffset),this._drawToContext(e,o,i),e.restore();break;case"fillPath":{e.save(),e.fillStyle=a.fill||"";let s=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(e,o,i,s),e.restore();break}case"fillSketch":this.fillSketch(e,o,a)}}fillSketch(t,r,a){let e=a.fillWeight;e<0&&(e=a.strokeWidth/2),t.save(),a.fillLineDash&&t.setLineDash(a.fillLineDash),a.fillLineDashOffset&&(t.lineDashOffset=a.fillLineDashOffset),t.strokeStyle=a.fill||"",t.lineWidth=e,this._drawToContext(t,r,a.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,r,a,e="nonzero"){t.beginPath();for(let i of r.ops){let o=typeof a=="number"&&a>=0?i.data.map(s=>+s.toFixed(a)):i.data;switch(i.op){case"move":t.moveTo(o[0],o[1]);break;case"bcurveTo":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"lineTo":t.lineTo(o[0],o[1])}}r.type==="fillPath"?t.fill(e):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,r,a,e,i){let o=this.gen.line(t,r,a,e,i);return this.draw(o),o}rectangle(t,r,a,e,i){let o=this.gen.rectangle(t,r,a,e,i);return this.draw(o),o}ellipse(t,r,a,e,i){let o=this.gen.ellipse(t,r,a,e,i);return this.draw(o),o}circle(t,r,a,e){let i=this.gen.circle(t,r,a,e);return this.draw(i),i}linearPath(t,r){let a=this.gen.linearPath(t,r);return this.draw(a),a}polygon(t,r){let a=this.gen.polygon(t,r);return this.draw(a),a}arc(t,r,a,e,i,o,s=!1,h){let l=this.gen.arc(t,r,a,e,i,o,s,h);return this.draw(l),l}curve(t,r){let a=this.gen.curve(t,r);return this.draw(a),a}path(t,r){let a=this.gen.path(t,r);return this.draw(a),a}},kt="http://www.w3.org/2000/svg",Jt=class{constructor(t,r){this.svg=t,this.gen=new ht(r)}draw(t){let r=t.sets||[],a=t.options||this.getDefaultOptions(),e=this.svg.ownerDocument||window.document,i=e.createElementNS(kt,"g"),o=t.options.fixedDecimalPlaceDigits;for(let s of r){let h=null;switch(s.type){case"path":h=e.createElementNS(kt,"path"),h.setAttribute("d",this.opsToPath(s,o)),h.setAttribute("stroke",a.stroke),h.setAttribute("stroke-width",a.strokeWidth+""),h.setAttribute("fill","none"),a.strokeLineDash&&h.setAttribute("stroke-dasharray",a.strokeLineDash.join(" ").trim()),a.strokeLineDashOffset&&h.setAttribute("stroke-dashoffset",`${a.strokeLineDashOffset}`);break;case"fillPath":h=e.createElementNS(kt,"path"),h.setAttribute("d",this.opsToPath(s,o)),h.setAttribute("stroke","none"),h.setAttribute("stroke-width","0"),h.setAttribute("fill",a.fill||""),t.shape!=="curve"&&t.shape!=="polygon"||h.setAttribute("fill-rule","evenodd");break;case"fillSketch":h=this.fillSketch(e,s,a)}h&&i.appendChild(h)}return i}fillSketch(t,r,a){let e=a.fillWeight;e<0&&(e=a.strokeWidth/2);let i=t.createElementNS(kt,"path");return i.setAttribute("d",this.opsToPath(r,a.fixedDecimalPlaceDigits)),i.setAttribute("stroke",a.fill||""),i.setAttribute("stroke-width",e+""),i.setAttribute("fill","none"),a.fillLineDash&&i.setAttribute("stroke-dasharray",a.fillLineDash.join(" ").trim()),a.fillLineDashOffset&&i.setAttribute("stroke-dashoffset",`${a.fillLineDashOffset}`),i}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,r){return this.gen.opsToPath(t,r)}line(t,r,a,e,i){let o=this.gen.line(t,r,a,e,i);return this.draw(o)}rectangle(t,r,a,e,i){let o=this.gen.rectangle(t,r,a,e,i);return this.draw(o)}ellipse(t,r,a,e,i){let o=this.gen.ellipse(t,r,a,e,i);return this.draw(o)}circle(t,r,a,e){let i=this.gen.circle(t,r,a,e);return this.draw(i)}linearPath(t,r){let a=this.gen.linearPath(t,r);return this.draw(a)}polygon(t,r){let a=this.gen.polygon(t,r);return this.draw(a)}arc(t,r,a,e,i,o,s=!1,h){let l=this.gen.arc(t,r,a,e,i,o,s,h);return this.draw(l)}curve(t,r){let a=this.gen.curve(t,r);return this.draw(a)}path(t,r){let a=this.gen.path(t,r);return this.draw(a)}},M={canvas:(n,t)=>new Qt(n,t),svg:(n,t)=>new Jt(n,t),generator:n=>new ht(n),newSeed:()=>ht.newSeed()};var G=S(async(n,t,r)=>{var g,f;let a,e=t.useHtmlLabels||Q((g=X())==null?void 0:g.htmlLabels);r?a=r:a="node default";let i=n.insert("g").attr("class",a).attr("id",t.domId||t.id),o=i.insert("g").attr("class","label").attr("style",J(t.labelStyle)),s;t.label===void 0?s="":s=typeof t.label=="string"?t.label:t.label[0];let h=await ct(o,At(ut(s),X()),{useHtmlLabels:e,width:t.width||((f=X().flowchart)==null?void 0:f.wrappingWidth),cssClasses:"markdown-node-label",style:t.labelStyle,addSvgBackground:!!t.icon||!!t.img}),l=h.getBBox(),c=((t==null?void 0:t.padding)??0)/2;if(e){let p=h.children[0],u=Y(h),y=p.getElementsByTagName("img");if(y){let d=s.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...y].map(m=>new Promise(x=>{function b(){if(m.style.display="flex",m.style.flexDirection="column",d){let k=X().fontSize?X().fontSize:window.getComputedStyle(document.body).fontSize,w=5,[v=rs.fontSize]=os(k),$=v*w+"px";m.style.minWidth=$,m.style.maxWidth=$}else m.style.width="100%";x(m)}S(b,"setupImage"),setTimeout(()=>{m.complete&&b()}),m.addEventListener("error",b),m.addEventListener("load",b)})))}l=p.getBoundingClientRect(),u.attr("width",l.width),u.attr("height",l.height)}return e?o.attr("transform","translate("+-l.width/2+", "+-l.height/2+")"):o.attr("transform","translate(0, "+-l.height/2+")"),t.centerLabel&&o.attr("transform","translate("+-l.width/2+", "+-l.height/2+")"),o.insert("rect",":first-child"),{shapeSvg:i,bbox:l,halfPadding:c,label:o}},"labelHelper"),Kt=S(async(n,t,r)=>{var h,l,c,g,f,p;let a=r.useHtmlLabels||Q((l=(h=X())==null?void 0:h.flowchart)==null?void 0:l.htmlLabels),e=n.insert("g").attr("class","label").attr("style",r.labelStyle||""),i=await ct(e,At(ut(t),X()),{useHtmlLabels:a,width:r.width||((g=(c=X())==null?void 0:c.flowchart)==null?void 0:g.wrappingWidth),style:r.labelStyle,addSvgBackground:!!r.icon||!!r.img}),o=i.getBBox(),s=r.padding/2;if(Q((p=(f=X())==null?void 0:f.flowchart)==null?void 0:p.htmlLabels)){let u=i.children[0],y=Y(i);o=u.getBoundingClientRect(),y.attr("width",o.width),y.attr("height",o.height)}return a?e.attr("transform","translate("+-o.width/2+", "+-o.height/2+")"):e.attr("transform","translate(0, "+-o.height/2+")"),r.centerLabel&&e.attr("transform","translate("+-o.width/2+", "+-o.height/2+")"),e.insert("rect",":first-child"),{shapeSvg:n,bbox:o,halfPadding:s,label:e}},"insertLabel"),W=S((n,t)=>{let r=t.node().getBBox();n.width=r.width,n.height=r.height},"updateNodeBounds"),j=S((n,t)=>(n.look==="handDrawn"?"rough-node":"node")+" "+n.cssClasses+" "+(t||""),"getNodeClasses");function F(n){let t=n.map((r,a)=>`${a===0?"M":"L"}${r.x},${r.y}`);return t.push("Z"),t.join(" ")}S(F,"createPathFromPoints");function lt(n,t,r,a,e,i){let o=[],h=r-n,l=a-t,c=h/i,g=2*Math.PI/c,f=t+l/2;for(let p=0;p<=50;p++){let u=p/50,y=n+u*h,d=f+e*Math.sin(g*(y-n));o.push({x:y,y:d})}return o}S(lt,"generateFullSineWavePoints");function as(n,t,r,a,e,i){let o=[],s=e*Math.PI/180,c=(i*Math.PI/180-s)/(a-1);for(let g=0;g<a;g++){let f=s+g*c,p=n+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-p,y:-u})}return o}S(as,"generateCirclePoints");var Qe=S((n,t)=>{var r=n.x,a=n.y,e=t.x-r,i=t.y-a,o=n.width/2,s=n.height/2,h,l;return Math.abs(i)*o>Math.abs(e)*s?(i<0&&(s=-s),h=i===0?0:s*e/i,l=s):(e<0&&(o=-o),h=o,l=e===0?0:o*i/e),{x:r+h,y:a+l}},"intersectRect"),gt=Qe;function vs(n,t){t&&n.attr("style",t)}S(vs,"applyStyle");async function $s(n){let t=Y(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),r=t.append("xhtml:div"),a=n.label;n.label&&Tt(n.label)&&(a=await is(n.label.replace(ls.lineBreakRegex,`
`),X()));let e=n.isNode?"nodeLabel":"edgeLabel";return r.html('<span class="'+e+'" '+(n.labelStyle?'style="'+n.labelStyle+'"':"")+">"+a+"</span>"),vs(r,n.labelStyle),r.style("display","inline-block"),r.style("padding-right","1px"),r.style("white-space","nowrap"),r.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()}S($s,"addHtmlLabel");var Je=S(async(n,t,r,a)=>{let e=n||"";if(typeof e=="object"&&(e=e[0]),Q(X().flowchart.htmlLabels)){e=e.replace(/\\n|\n/g,"<br />"),q.info("vertexText"+e);let i={isNode:a,label:ut(e).replace(/fa[blrs]?:fa-[\w-]+/g,s=>`<i class='${s.replace(":"," ")}'></i>`),labelStyle:t&&t.replace("fill:","color:")};return await $s(i)}else{let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("style",t.replace("color:","fill:"));let o=[];typeof e=="string"?o=e.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(e)?o=e:o=[];for(let s of o){let h=document.createElementNS("http://www.w3.org/2000/svg","tspan");h.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),h.setAttribute("dy","1em"),h.setAttribute("x","0"),r?h.setAttribute("class","title-row"):h.setAttribute("class","row"),h.textContent=s.trim(),i.appendChild(h)}return i}},"createLabel"),ts=Je,at=S((n,t,r,a,e)=>["M",n+e,t,"H",n+r-e,"A",e,e,0,0,1,n+r,t+e,"V",t+a-e,"A",e,e,0,0,1,n+r-e,t+a,"H",n+e,"A",e,e,0,0,1,n,t+a-e,"V",t+e,"A",e,e,0,0,1,n+e,t,"Z"].join(" "),"createRoundedRectPathD"),Ue=S(n=>{let{handDrawnSeed:t}=X();return{fill:n,hachureAngle:120,hachureGap:4,fillWeight:2,roughness:.7,stroke:n,seed:t}},"solidStateFill"),pt=S(n=>{let t=Ke([...n.cssCompiledStyles||[],...n.cssStyles||[]]);return{stylesMap:t,stylesArray:[...t]}},"compileStyles"),Ke=S(n=>{let t=new Map;return n.forEach(r=>{let[a,e]=r.split(":");t.set(a.trim(),e==null?void 0:e.trim())}),t},"styles2Map"),H=S(n=>{let{stylesArray:t}=pt(n),r=[],a=[],e=[],i=[];return t.forEach(o=>{let s=o[0];s==="color"||s==="font-size"||s==="font-family"||s==="font-weight"||s==="font-style"||s==="text-decoration"||s==="text-align"||s==="text-transform"||s==="line-height"||s==="letter-spacing"||s==="word-spacing"||s==="text-shadow"||s==="text-overflow"||s==="white-space"||s==="word-wrap"||s==="word-break"||s==="overflow-wrap"||s==="hyphens"?r.push(o.join(":")+" !important"):(a.push(o.join(":")+" !important"),s.includes("stroke")&&e.push(o.join(":")+" !important"),s==="fill"&&i.push(o.join(":")+" !important"))}),{labelStyles:r.join(";"),nodeStyles:a.join(";"),stylesArray:t,borderStyles:e,backgroundStyles:i}},"styles2String"),T=S((n,t)=>{var h;let{themeVariables:r,handDrawnSeed:a}=X(),{nodeBorder:e,mainBkg:i}=r,{stylesMap:o}=pt(n);return Object.assign({roughness:.7,fill:o.get("fill")||i,fillStyle:"hachure",fillWeight:4,hachureGap:5.2,stroke:o.get("stroke")||e,seed:a,strokeWidth:((h=o.get("stroke-width"))==null?void 0:h.replace("px",""))||1.3,fillLineDash:[0,0]},t)},"userNodeOverrides"),Ds=S(async(n,t)=>{q.info("Creating subgraph rect for ",t.id,t);let r=X(),{themeVariables:a,handDrawnSeed:e}=r,{clusterBkg:i,clusterBorder:o}=a,{labelStyles:s,nodeStyles:h,borderStyles:l,backgroundStyles:c}=H(t),g=n.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),f=Q(r.flowchart.htmlLabels),p=g.insert("g").attr("class","cluster-label "),u=await ct(p,t.label,{style:t.labelStyle,useHtmlLabels:f,isNode:!0}),y=u.getBBox();if(Q(r.flowchart.htmlLabels)){let $=u.children[0],P=Y(u);y=$.getBoundingClientRect(),P.attr("width",y.width),P.attr("height",y.height)}let d=t.width<=y.width+t.padding?y.width+t.padding:t.width;t.width<=y.width+t.padding?t.diff=(d-t.width)/2-t.padding:t.diff=-t.padding;let m=t.height,x=t.x-d/2,b=t.y-m/2;q.trace("Data ",t,JSON.stringify(t));let k;if(t.look==="handDrawn"){let $=M.svg(g),P=T(t,{roughness:.7,fill:i,stroke:o,fillWeight:3,seed:e}),E=$.path(at(x,b,d,m,0),P);k=g.insert(()=>(q.debug("Rough node insert CXC",E),E),":first-child"),k.select("path:nth-child(2)").attr("style",l.join(";")),k.select("path").attr("style",c.join(";").replace("fill","stroke"))}else k=g.insert("rect",":first-child"),k.attr("style",h).attr("rx",t.rx).attr("ry",t.ry).attr("x",x).attr("y",b).attr("width",d).attr("height",m);let{subGraphTitleTopMargin:w}=Wt(r);if(p.attr("transform",`translate(${t.x-y.width/2}, ${t.y-t.height/2+w})`),s){let $=p.select("span");$&&$.attr("style",s)}let v=k.node().getBBox();return t.offsetX=0,t.width=v.width,t.height=v.height,t.offsetY=y.height-t.padding/2,t.intersect=function($){return gt(t,$)},{cluster:g,labelBBox:y}},"rect"),ta=S((n,t)=>{let r=n.insert("g").attr("class","note-cluster").attr("id",t.id),a=r.insert("rect",":first-child"),e=0*t.padding,i=e/2;a.attr("rx",t.rx).attr("ry",t.ry).attr("x",t.x-t.width/2-i).attr("y",t.y-t.height/2-i).attr("width",t.width+e).attr("height",t.height+e).attr("fill","none");let o=a.node().getBBox();return t.width=o.width,t.height=o.height,t.intersect=function(s){return gt(t,s)},{cluster:r,labelBBox:{width:0,height:0}}},"noteGroup"),sa=S(async(n,t)=>{let r=X(),{themeVariables:a,handDrawnSeed:e}=r,{altBackground:i,compositeBackground:o,compositeTitleBackground:s,nodeBorder:h}=a,l=n.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-id",t.id).attr("data-look",t.look),c=l.insert("g",":first-child"),g=l.insert("g").attr("class","cluster-label"),f=l.append("rect"),p=g.node().appendChild(await ts(t.label,t.labelStyle,void 0,!0)),u=p.getBBox();if(Q(r.flowchart.htmlLabels)){let E=p.children[0],A=Y(p);u=E.getBoundingClientRect(),A.attr("width",u.width),A.attr("height",u.height)}let y=0*t.padding,d=y/2,m=(t.width<=u.width+t.padding?u.width+t.padding:t.width)+y;t.width<=u.width+t.padding?t.diff=(m-t.width)/2-t.padding:t.diff=-t.padding;let x=t.height+y,b=t.height+y-u.height-6,k=t.x-m/2,w=t.y-x/2;t.width=m;let v=t.y-t.height/2-d+u.height+2,$;if(t.look==="handDrawn"){let E=t.cssClasses.includes("statediagram-cluster-alt"),A=M.svg(l),R=t.rx||t.ry?A.path(at(k,w,m,x,10),{roughness:.7,fill:s,fillStyle:"solid",stroke:h,seed:e}):A.rectangle(k,w,m,x,{seed:e});$=l.insert(()=>R,":first-child");let _=A.rectangle(k,v,m,b,{fill:E?i:o,fillStyle:E?"hachure":"solid",stroke:h,seed:e});$=l.insert(()=>R,":first-child"),f=l.insert(()=>_)}else $=c.insert("rect",":first-child"),$.attr("class","outer").attr("x",k).attr("y",w).attr("width",m).attr("height",x).attr("data-look",t.look),f.attr("class","inner").attr("x",k).attr("y",v).attr("width",m).attr("height",b);g.attr("transform",`translate(${t.x-u.width/2}, ${w+1-(Q(r.flowchart.htmlLabels)?0:3)})`);let P=$.node().getBBox();return t.height=P.height,t.offsetX=0,t.offsetY=u.height-t.padding/2,t.labelBBox=u,t.intersect=function(E){return gt(t,E)},{cluster:l,labelBBox:u}},"roundedWithTitle"),ea=S(async(n,t)=>{q.info("Creating subgraph rect for ",t.id,t);let r=X(),{themeVariables:a,handDrawnSeed:e}=r,{clusterBkg:i,clusterBorder:o}=a,{labelStyles:s,nodeStyles:h,borderStyles:l,backgroundStyles:c}=H(t),g=n.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),f=Q(r.flowchart.htmlLabels),p=g.insert("g").attr("class","cluster-label "),u=await ct(p,t.label,{style:t.labelStyle,useHtmlLabels:f,isNode:!0,width:t.width}),y=u.getBBox();if(Q(r.flowchart.htmlLabels)){let $=u.children[0],P=Y(u);y=$.getBoundingClientRect(),P.attr("width",y.width),P.attr("height",y.height)}let d=t.width<=y.width+t.padding?y.width+t.padding:t.width;t.width<=y.width+t.padding?t.diff=(d-t.width)/2-t.padding:t.diff=-t.padding;let m=t.height,x=t.x-d/2,b=t.y-m/2;q.trace("Data ",t,JSON.stringify(t));let k;if(t.look==="handDrawn"){let $=M.svg(g),P=T(t,{roughness:.7,fill:i,stroke:o,fillWeight:4,seed:e}),E=$.path(at(x,b,d,m,t.rx),P);k=g.insert(()=>(q.debug("Rough node insert CXC",E),E),":first-child"),k.select("path:nth-child(2)").attr("style",l.join(";")),k.select("path").attr("style",c.join(";").replace("fill","stroke"))}else k=g.insert("rect",":first-child"),k.attr("style",h).attr("rx",t.rx).attr("ry",t.ry).attr("x",x).attr("y",b).attr("width",d).attr("height",m);let{subGraphTitleTopMargin:w}=Wt(r);if(p.attr("transform",`translate(${t.x-y.width/2}, ${t.y-t.height/2+w})`),s){let $=p.select("span");$&&$.attr("style",s)}let v=k.node().getBBox();return t.offsetX=0,t.width=v.width,t.height=v.height,t.offsetY=y.height-t.padding/2,t.intersect=function($){return gt(t,$)},{cluster:g,labelBBox:y}},"kanbanSection"),aa=S((n,t)=>{let r=X(),{themeVariables:a,handDrawnSeed:e}=r,{nodeBorder:i}=a,o=n.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-look",t.look),s=o.insert("g",":first-child"),h=0*t.padding,l=t.width+h;t.diff=-t.padding;let c=t.height+h,g=t.x-l/2,f=t.y-c/2;t.width=l;let p;if(t.look==="handDrawn"){let d=M.svg(o).rectangle(g,f,l,c,{fill:"lightgrey",roughness:.5,strokeLineDash:[5],stroke:i,seed:e});p=o.insert(()=>d,":first-child")}else p=s.insert("rect",":first-child"),p.attr("class","divider").attr("x",g).attr("y",f).attr("width",l).attr("height",c).attr("data-look",t.look);let u=p.node().getBBox();return t.height=u.height,t.offsetX=0,t.offsetY=0,t.intersect=function(y){return gt(t,y)},{cluster:o,labelBBox:{}}},"divider"),ra=Ds,ia={rect:Ds,squareRect:ra,roundedWithTitle:sa,noteGroup:ta,divider:aa,kanbanSection:ea},Ps=new Map,Ha=S(async(n,t)=>{let r=t.shape||"rect",a=await ia[r](n,t);return Ps.set(t.id,a),a},"insertCluster"),Ia=S(()=>{Ps=new Map},"clear");function Cs(n,t){return n.intersect(t)}S(Cs,"intersectNode");var la=Cs;function Bs(n,t,r,a){var e=n.x,i=n.y,o=e-a.x,s=i-a.y,h=Math.sqrt(t*t*s*s+r*r*o*o),l=Math.abs(t*r*o/h);a.x<e&&(l=-l);var c=Math.abs(t*r*s/h);return a.y<i&&(c=-c),{x:e+l,y:i+c}}S(Bs,"intersectEllipse");var Rs=Bs;function Ls(n,t,r){return Rs(n,t,t,r)}S(Ls,"intersectCircle");var na=Ls;function Ns(n,t,r,a){var e,i,o,s,h,l,c,g,f,p,u,y,d,m,x;if(e=t.y-n.y,o=n.x-t.x,h=t.x*n.y-n.x*t.y,f=e*r.x+o*r.y+h,p=e*a.x+o*a.y+h,!(f!==0&&p!==0&&ss(f,p))&&(i=a.y-r.y,s=r.x-a.x,l=a.x*r.y-r.x*a.y,c=i*n.x+s*n.y+l,g=i*t.x+s*t.y+l,!(c!==0&&g!==0&&ss(c,g))&&(u=e*s-i*o,u!==0)))return y=Math.abs(u/2),d=o*l-s*h,m=d<0?(d-y)/u:(d+y)/u,d=i*h-e*l,x=d<0?(d-y)/u:(d+y)/u,{x:m,y:x}}S(Ns,"intersectLine");function ss(n,t){return n*t>0}S(ss,"sameSign");var ca=Ns;function As(n,t,r){let a=n.x,e=n.y,i=[],o=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(c){o=Math.min(o,c.x),s=Math.min(s,c.y)}):(o=Math.min(o,t.x),s=Math.min(s,t.y));let h=a-n.width/2-o,l=e-n.height/2-s;for(let c=0;c<t.length;c++){let g=t[c],f=t[c<t.length-1?c+1:0],p=ca(n,r,{x:h+g.x,y:l+g.y},{x:h+f.x,y:l+f.y});p&&i.push(p)}return i.length?(i.length>1&&i.sort(function(c,g){let f=c.x-r.x,p=c.y-r.y,u=Math.sqrt(f*f+p*p),y=g.x-r.x,d=g.y-r.y,m=Math.sqrt(y*y+d*d);return u<m?-1:u===m?0:1}),i[0]):n}S(As,"intersectPolygon");var oa=As,L={node:la,circle:na,ellipse:Rs,polygon:oa,rect:gt};function Ts(n,t){let{labelStyles:r}=H(t);t.labelStyle=r;let a=j(t),e=a;a||(e="anchor");let i=n.insert("g").attr("class",e).attr("id",t.domId||t.id),o=1,{cssStyles:s}=t,h=M.svg(i),l=T(t,{fill:"black",stroke:"none",fillStyle:"solid"});t.look!=="handDrawn"&&(l.roughness=0);let c=h.circle(0,0,o*2,l),g=i.insert(()=>c,":first-child");return g.attr("class","anchor").attr("style",J(s)),W(t,g),t.intersect=function(f){return q.info("Circle intersect",t,o,f),L.circle(t,o,f)},i}S(Ts,"anchor");function es(n,t,r,a,e,i,o){let h=(n+r)/2,l=(t+a)/2,c=Math.atan2(a-t,r-n),g=(r-n)/2,f=(a-t)/2,p=g/e,u=f/i,y=Math.sqrt(p**2+u**2);if(y>1)throw new Error("The given radii are too small to create an arc between the points.");let d=Math.sqrt(1-y**2),m=h+d*i*Math.sin(c)*(o?-1:1),x=l-d*e*Math.cos(c)*(o?-1:1),b=Math.atan2((t-x)/i,(n-m)/e),w=Math.atan2((a-x)/i,(r-m)/e)-b;o&&w<0&&(w+=2*Math.PI),!o&&w>0&&(w-=2*Math.PI);let v=[];for(let $=0;$<20;$++){let P=$/19,E=b+P*w,A=m+e*Math.cos(E),R=x+i*Math.sin(E);v.push({x:A,y:R})}return v}S(es,"generateArcPoints");async function Ws(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=i.width+t.padding+20,s=i.height+t.padding,h=s/2,l=h/(2.5+s/50),{cssStyles:c}=t,g=[{x:o/2,y:-s/2},{x:-o/2,y:-s/2},...es(-o/2,-s/2,-o/2,s/2,l,h,!1),{x:o/2,y:s/2},...es(o/2,s/2,o/2,-s/2,l,h,!0)],f=M.svg(e),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=F(g),y=f.path(u,p),d=e.insert(()=>y,":first-child");return d.attr("class","basic label-container"),c&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",c),a&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",a),d.attr("transform",`translate(${l/2}, 0)`),W(t,d),t.intersect=function(m){return L.polygon(t,g,m)},e}S(Ws,"bowTieRect");function rt(n,t,r,a){return n.insert("polygon",":first-child").attr("points",a.map(function(e){return e.x+","+e.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+r/2+")")}S(rt,"insertPolygonShape");async function Hs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=i.height+t.padding,s=12,h=i.width+t.padding+s,l=0,c=h,g=-o,f=0,p=[{x:l+s,y:g},{x:c,y:g},{x:c,y:f},{x:l,y:f},{x:l,y:g+s},{x:l+s,y:g}],u,{cssStyles:y}=t;if(t.look==="handDrawn"){let d=M.svg(e),m=T(t,{}),x=F(p),b=d.path(x,m);u=e.insert(()=>b,":first-child").attr("transform",`translate(${-h/2}, ${o/2})`),y&&u.attr("style",y)}else u=rt(e,h,o,p);return a&&u.attr("style",a),W(t,u),t.intersect=function(d){return L.polygon(t,p,d)},e}S(Hs,"card");function Is(n,t){let{nodeStyles:r}=H(t);t.label="";let a=n.insert("g").attr("class",j(t)).attr("id",t.domId??t.id),{cssStyles:e}=t,i=Math.max(28,t.width??0),o=[{x:0,y:i/2},{x:i/2,y:0},{x:0,y:-i/2},{x:-i/2,y:0}],s=M.svg(a),h=T(t,{});t.look!=="handDrawn"&&(h.roughness=0,h.fillStyle="solid");let l=F(o),c=s.path(l,h),g=a.insert(()=>c,":first-child");return e&&t.look!=="handDrawn"&&g.selectAll("path").attr("style",e),r&&t.look!=="handDrawn"&&g.selectAll("path").attr("style",r),t.width=28,t.height=28,t.intersect=function(f){return L.polygon(t,o,f)},a}S(Is,"choice");async function Es(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,halfPadding:o}=await G(n,t,j(t)),s=i.width/2+o,h,{cssStyles:l}=t;if(t.look==="handDrawn"){let c=M.svg(e),g=T(t,{}),f=c.circle(0,0,s*2,g);h=e.insert(()=>f,":first-child"),h.attr("class","basic label-container").attr("style",J(l))}else h=e.insert("circle",":first-child").attr("class","basic label-container").attr("style",a).attr("r",s).attr("cx",0).attr("cy",0);return W(t,h),t.intersect=function(c){return q.info("Circle intersect",t,s,c),L.circle(t,s,c)},e}S(Es,"circle");function Os(n){let t=Math.cos(Math.PI/4),r=Math.sin(Math.PI/4),a=n*2,e={x:a/2*t,y:a/2*r},i={x:-(a/2)*t,y:a/2*r},o={x:-(a/2)*t,y:-(a/2)*r},s={x:a/2*t,y:-(a/2)*r};return`M ${i.x},${i.y} L ${s.x},${s.y}
                   M ${e.x},${e.y} L ${o.x},${o.y}`}S(Os,"createLine");function _s(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r,t.label="";let e=n.insert("g").attr("class",j(t)).attr("id",t.domId??t.id),i=Math.max(30,(t==null?void 0:t.width)??0),{cssStyles:o}=t,s=M.svg(e),h=T(t,{});t.look!=="handDrawn"&&(h.roughness=0,h.fillStyle="solid");let l=s.circle(0,0,i*2,h),c=Os(i),g=s.path(c,h),f=e.insert(()=>l,":first-child");return f.insert(()=>g),o&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",o),a&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",a),W(t,f),t.intersect=function(p){return q.info("crossedCircle intersect",t,{radius:i,point:p}),L.circle(t,i,p)},e}S(_s,"crossedCircle");function st(n,t,r,a=100,e=0,i=180){let o=[],s=e*Math.PI/180,c=(i*Math.PI/180-s)/(a-1);for(let g=0;g<a;g++){let f=s+g*c,p=n+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-p,y:-u})}return o}S(st,"generateCirclePoints");async function zs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=i.width+(t.padding??0),h=i.height+(t.padding??0),l=Math.max(5,h*.1),{cssStyles:c}=t,g=[...st(s/2,-h/2,l,30,-90,0),{x:-s/2-l,y:l},...st(s/2+l*2,-l,l,20,-180,-270),...st(s/2+l*2,l,l,20,-90,-180),{x:-s/2-l,y:-h/2},...st(s/2,h/2,l,20,0,90)],f=[{x:s/2,y:-h/2-l},{x:-s/2,y:-h/2-l},...st(s/2,-h/2,l,20,-90,0),{x:-s/2-l,y:-l},...st(s/2+s*.1,-l,l,20,-180,-270),...st(s/2+s*.1,l,l,20,-90,-180),{x:-s/2-l,y:h/2},...st(s/2,h/2,l,20,0,90),{x:-s/2,y:h/2+l},{x:s/2,y:h/2+l}],p=M.svg(e),u=T(t,{fill:"none"});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let d=F(g).replace("Z",""),m=p.path(d,u),x=F(f),b=p.path(x,{...u}),k=e.insert("g",":first-child");return k.insert(()=>b,":first-child").attr("stroke-opacity",0),k.insert(()=>m,":first-child"),k.attr("class","text"),c&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",c),a&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",a),k.attr("transform",`translate(${l}, 0)`),o.attr("transform",`translate(${-s/2+l-(i.x-(i.left??0))},${-h/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,k),t.intersect=function(w){return L.polygon(t,f,w)},e}S(zs,"curlyBraceLeft");function et(n,t,r,a=100,e=0,i=180){let o=[],s=e*Math.PI/180,c=(i*Math.PI/180-s)/(a-1);for(let g=0;g<a;g++){let f=s+g*c,p=n+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:p,y:u})}return o}S(et,"generateCirclePoints");async function js(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=i.width+(t.padding??0),h=i.height+(t.padding??0),l=Math.max(5,h*.1),{cssStyles:c}=t,g=[...et(s/2,-h/2,l,20,-90,0),{x:s/2+l,y:-l},...et(s/2+l*2,-l,l,20,-180,-270),...et(s/2+l*2,l,l,20,-90,-180),{x:s/2+l,y:h/2},...et(s/2,h/2,l,20,0,90)],f=[{x:-s/2,y:-h/2-l},{x:s/2,y:-h/2-l},...et(s/2,-h/2,l,20,-90,0),{x:s/2+l,y:-l},...et(s/2+l*2,-l,l,20,-180,-270),...et(s/2+l*2,l,l,20,-90,-180),{x:s/2+l,y:h/2},...et(s/2,h/2,l,20,0,90),{x:s/2,y:h/2+l},{x:-s/2,y:h/2+l}],p=M.svg(e),u=T(t,{fill:"none"});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let d=F(g).replace("Z",""),m=p.path(d,u),x=F(f),b=p.path(x,{...u}),k=e.insert("g",":first-child");return k.insert(()=>b,":first-child").attr("stroke-opacity",0),k.insert(()=>m,":first-child"),k.attr("class","text"),c&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",c),a&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",a),k.attr("transform",`translate(${-l}, 0)`),o.attr("transform",`translate(${-s/2+(t.padding??0)/2-(i.x-(i.left??0))},${-h/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,k),t.intersect=function(w){return L.polygon(t,f,w)},e}S(js,"curlyBraceRight");function Z(n,t,r,a=100,e=0,i=180){let o=[],s=e*Math.PI/180,c=(i*Math.PI/180-s)/(a-1);for(let g=0;g<a;g++){let f=s+g*c,p=n+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-p,y:-u})}return o}S(Z,"generateCirclePoints");async function Gs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=i.width+(t.padding??0),h=i.height+(t.padding??0),l=Math.max(5,h*.1),{cssStyles:c}=t,g=[...Z(s/2,-h/2,l,30,-90,0),{x:-s/2-l,y:l},...Z(s/2+l*2,-l,l,20,-180,-270),...Z(s/2+l*2,l,l,20,-90,-180),{x:-s/2-l,y:-h/2},...Z(s/2,h/2,l,20,0,90)],f=[...Z(-s/2+l+l/2,-h/2,l,20,-90,-180),{x:s/2-l/2,y:l},...Z(-s/2-l/2,-l,l,20,0,90),...Z(-s/2-l/2,l,l,20,-90,0),{x:s/2-l/2,y:-l},...Z(-s/2+l+l/2,h/2,l,30,-180,-270)],p=[{x:s/2,y:-h/2-l},{x:-s/2,y:-h/2-l},...Z(s/2,-h/2,l,20,-90,0),{x:-s/2-l,y:-l},...Z(s/2+l*2,-l,l,20,-180,-270),...Z(s/2+l*2,l,l,20,-90,-180),{x:-s/2-l,y:h/2},...Z(s/2,h/2,l,20,0,90),{x:-s/2,y:h/2+l},{x:s/2-l-l/2,y:h/2+l},...Z(-s/2+l+l/2,-h/2,l,20,-90,-180),{x:s/2-l/2,y:l},...Z(-s/2-l/2,-l,l,20,0,90),...Z(-s/2-l/2,l,l,20,-90,0),{x:s/2-l/2,y:-l},...Z(-s/2+l+l/2,h/2,l,30,-180,-270)],u=M.svg(e),y=T(t,{fill:"none"});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let m=F(g).replace("Z",""),x=u.path(m,y),k=F(f).replace("Z",""),w=u.path(k,y),v=F(p),$=u.path(v,{...y}),P=e.insert("g",":first-child");return P.insert(()=>$,":first-child").attr("stroke-opacity",0),P.insert(()=>x,":first-child"),P.insert(()=>w,":first-child"),P.attr("class","text"),c&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",c),a&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",a),P.attr("transform",`translate(${l-l/4}, 0)`),o.attr("transform",`translate(${-s/2+(t.padding??0)/2-(i.x-(i.left??0))},${-h/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,P),t.intersect=function(E){return L.polygon(t,p,E)},e}S(Gs,"curlyBraces");async function Fs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=80,s=20,h=Math.max(o,(i.width+(t.padding??0)*2)*1.25,(t==null?void 0:t.width)??0),l=Math.max(s,i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),c=l/2,{cssStyles:g}=t,f=M.svg(e),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=h,y=l,d=u-c,m=y/4,x=[{x:d,y:0},{x:m,y:0},{x:0,y:y/2},{x:m,y},{x:d,y},...as(-d,-y/2,c,50,270,90)],b=F(x),k=f.path(b,p),w=e.insert(()=>k,":first-child");return w.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&w.selectChildren("path").attr("style",g),a&&t.look!=="handDrawn"&&w.selectChildren("path").attr("style",a),w.attr("transform",`translate(${-h/2}, ${-l/2})`),W(t,w),t.intersect=function(v){return L.polygon(t,x,v)},e}S(Fs,"curvedTrapezoid");var ha=S((n,t,r,a,e,i)=>[`M${n},${t+i}`,`a${e},${i} 0,0,0 ${r},0`,`a${e},${i} 0,0,0 ${-r},0`,`l0,${a}`,`a${e},${i} 0,0,0 ${r},0`,`l0,${-a}`].join(" "),"createCylinderPathD"),ga=S((n,t,r,a,e,i)=>[`M${n},${t+i}`,`M${n+r},${t+i}`,`a${e},${i} 0,0,0 ${-r},0`,`l0,${a}`,`a${e},${i} 0,0,0 ${r},0`,`l0,${-a}`].join(" "),"createOuterCylinderPathD"),pa=S((n,t,r,a,e,i)=>[`M${n-r/2},${-a/2}`,`a${e},${i} 0,0,0 ${r},0`].join(" "),"createInnerCylinderPathD");async function qs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+t.padding,t.width??0),h=s/2,l=h/(2.5+s/50),c=Math.max(i.height+l+t.padding,t.height??0),g,{cssStyles:f}=t;if(t.look==="handDrawn"){let p=M.svg(e),u=ga(0,0,s,c,h,l),y=pa(0,l,s,c,h,l),d=p.path(u,T(t,{})),m=p.path(y,T(t,{fill:"none"}));g=e.insert(()=>m,":first-child"),g=e.insert(()=>d,":first-child"),g.attr("class","basic label-container"),f&&g.attr("style",f)}else{let p=ha(0,0,s,c,h,l);g=e.insert("path",":first-child").attr("d",p).attr("class","basic label-container").attr("style",J(f)).attr("style",a)}return g.attr("label-offset-y",l),g.attr("transform",`translate(${-s/2}, ${-(c/2+l)})`),W(t,g),o.attr("transform",`translate(${-(i.width/2)-(i.x-(i.left??0))}, ${-(i.height/2)+(t.padding??0)/1.5-(i.y-(i.top??0))})`),t.intersect=function(p){let u=L.rect(t,p),y=u.x-(t.x??0);if(h!=0&&(Math.abs(y)<(t.width??0)/2||Math.abs(y)==(t.width??0)/2&&Math.abs(u.y-(t.y??0))>(t.height??0)/2-l)){let d=l*l*(1-y*y/(h*h));d>0&&(d=Math.sqrt(d)),d=l-d,p.y-(t.y??0)>0&&(d=-d),u.y+=d}return u},e}S(qs,"cylinder");async function Xs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=i.width+t.padding,h=i.height+t.padding,l=h*.2,c=-s/2,g=-h/2-l/2,{cssStyles:f}=t,p=M.svg(e),u=T(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=[{x:c,y:g+l},{x:-c,y:g+l},{x:-c,y:-g},{x:c,y:-g},{x:c,y:g},{x:-c,y:g},{x:-c,y:g+l}],d=p.polygon(y.map(x=>[x.x,x.y]),u),m=e.insert(()=>d,":first-child");return m.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",f),a&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",a),o.attr("transform",`translate(${c+(t.padding??0)/2-(i.x-(i.left??0))}, ${g+l+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,m),t.intersect=function(x){return L.rect(t,x)},e}S(Xs,"dividedRectangle");async function Ys(n,t){var f,p;let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,halfPadding:o}=await G(n,t,j(t)),h=i.width/2+o+5,l=i.width/2+o,c,{cssStyles:g}=t;if(t.look==="handDrawn"){let u=M.svg(e),y=T(t,{roughness:.2,strokeWidth:2.5}),d=T(t,{roughness:.2,strokeWidth:1.5}),m=u.circle(0,0,h*2,y),x=u.circle(0,0,l*2,d);c=e.insert("g",":first-child"),c.attr("class",J(t.cssClasses)).attr("style",J(g)),(f=c.node())==null||f.appendChild(m),(p=c.node())==null||p.appendChild(x)}else{c=e.insert("g",":first-child");let u=c.insert("circle",":first-child"),y=c.insert("circle");c.attr("class","basic label-container").attr("style",a),u.attr("class","outer-circle").attr("style",a).attr("r",h).attr("cx",0).attr("cy",0),y.attr("class","inner-circle").attr("style",a).attr("r",l).attr("cx",0).attr("cy",0)}return W(t,c),t.intersect=function(u){return q.info("DoubleCircle intersect",t,h,u),L.circle(t,h,u)},e}S(Ys,"doublecircle");function Vs(n,t,{config:{themeVariables:r}}){let{labelStyles:a,nodeStyles:e}=H(t);t.label="",t.labelStyle=a;let i=n.insert("g").attr("class",j(t)).attr("id",t.domId??t.id),o=7,{cssStyles:s}=t,h=M.svg(i),{nodeBorder:l}=r,c=T(t,{fillStyle:"solid"});t.look!=="handDrawn"&&(c.roughness=0);let g=h.circle(0,0,o*2,c),f=i.insert(()=>g,":first-child");return f.selectAll("path").attr("style",`fill: ${l} !important;`),s&&s.length>0&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",s),e&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",e),W(t,f),t.intersect=function(p){return q.info("filledCircle intersect",t,{radius:o,point:p}),L.circle(t,o,p)},i}S(Vs,"filledCircle");async function Zs(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=i.width+(t.padding??0),h=s+i.height,l=s+i.height,c=[{x:0,y:-h},{x:l,y:-h},{x:l/2,y:0}],{cssStyles:g}=t,f=M.svg(e),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=F(c),y=f.path(u,p),d=e.insert(()=>y,":first-child").attr("transform",`translate(${-h/2}, ${h/2})`);return g&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",g),a&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",a),t.width=s,t.height=h,W(t,d),o.attr("transform",`translate(${-i.width/2-(i.x-(i.left??0))}, ${-h/2+(t.padding??0)/2+(i.y-(i.top??0))})`),t.intersect=function(m){return q.info("Triangle intersect",t,c,m),L.polygon(t,c,m)},e}S(Zs,"flippedTriangle");function Qs(n,t,{dir:r,config:{state:a,themeVariables:e}}){let{nodeStyles:i}=H(t);t.label="";let o=n.insert("g").attr("class",j(t)).attr("id",t.domId??t.id),{cssStyles:s}=t,h=Math.max(70,(t==null?void 0:t.width)??0),l=Math.max(10,(t==null?void 0:t.height)??0);r==="LR"&&(h=Math.max(10,(t==null?void 0:t.width)??0),l=Math.max(70,(t==null?void 0:t.height)??0));let c=-1*h/2,g=-1*l/2,f=M.svg(o),p=T(t,{stroke:e.lineColor,fill:e.lineColor});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=f.rectangle(c,g,h,l,p),y=o.insert(()=>u,":first-child");s&&t.look!=="handDrawn"&&y.selectAll("path").attr("style",s),i&&t.look!=="handDrawn"&&y.selectAll("path").attr("style",i),W(t,y);let d=(a==null?void 0:a.padding)??0;return t.width&&t.height&&(t.width+=d/2||0,t.height+=d/2||0),t.intersect=function(m){return L.rect(t,m)},o}S(Qs,"forkJoin");async function Js(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let e=80,i=50,{shapeSvg:o,bbox:s}=await G(n,t,j(t)),h=Math.max(e,s.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),l=Math.max(i,s.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),c=l/2,{cssStyles:g}=t,f=M.svg(o),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=[{x:-h/2,y:-l/2},{x:h/2-c,y:-l/2},...as(-h/2+c,0,c,50,90,270),{x:h/2-c,y:l/2},{x:-h/2,y:l/2}],y=F(u),d=f.path(y,p),m=o.insert(()=>d,":first-child");return m.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",g),a&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",a),W(t,m),t.intersect=function(x){return q.info("Pill intersect",t,{radius:c,point:x}),L.polygon(t,u,x)},o}S(Js,"halfRoundedRectangle");var fa=S((n,t,r,a,e)=>[`M${n+e},${t}`,`L${n+r-e},${t}`,`L${n+r},${t-a/2}`,`L${n+r-e},${t-a}`,`L${n+e},${t-a}`,`L${n},${t-a/2}`,"Z"].join(" "),"createHexagonPathD");async function Us(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=4,s=i.height+t.padding,h=s/o,l=i.width+2*h+t.padding,c=[{x:h,y:0},{x:l-h,y:0},{x:l,y:-s/2},{x:l-h,y:-s},{x:h,y:-s},{x:0,y:-s/2}],g,{cssStyles:f}=t;if(t.look==="handDrawn"){let p=M.svg(e),u=T(t,{}),y=fa(0,0,l,s,h),d=p.path(y,u);g=e.insert(()=>d,":first-child").attr("transform",`translate(${-l/2}, ${s/2})`),f&&g.attr("style",f)}else g=rt(e,l,s,c);return a&&g.attr("style",a),t.width=l,t.height=s,W(t,g),t.intersect=function(p){return L.polygon(t,c,p)},e}S(Us,"hexagon");async function Ks(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.label="",t.labelStyle=r;let{shapeSvg:e}=await G(n,t,j(t)),i=Math.max(30,(t==null?void 0:t.width)??0),o=Math.max(30,(t==null?void 0:t.height)??0),{cssStyles:s}=t,h=M.svg(e),l=T(t,{});t.look!=="handDrawn"&&(l.roughness=0,l.fillStyle="solid");let c=[{x:0,y:0},{x:i,y:0},{x:0,y:o},{x:i,y:o}],g=F(c),f=h.path(g,l),p=e.insert(()=>f,":first-child");return p.attr("class","basic label-container"),s&&t.look!=="handDrawn"&&p.selectChildren("path").attr("style",s),a&&t.look!=="handDrawn"&&p.selectChildren("path").attr("style",a),p.attr("transform",`translate(${-i/2}, ${-o/2})`),W(t,p),t.intersect=function(u){return q.info("Pill intersect",t,{points:c}),L.polygon(t,c,u)},e}S(Ks,"hourglass");async function te(n,t,{config:{themeVariables:r,flowchart:a}}){let{labelStyles:e}=H(t);t.labelStyle=e;let i=t.assetHeight??48,o=t.assetWidth??48,s=Math.max(i,o),h=a==null?void 0:a.wrappingWidth;t.width=Math.max(s,h??0);let{shapeSvg:l,bbox:c,label:g}=await G(n,t,"icon-shape default"),f=t.pos==="t",p=s,u=s,{nodeBorder:y}=r,{stylesMap:d}=pt(t),m=-u/2,x=-p/2,b=t.label?8:0,k=M.svg(l),w=T(t,{stroke:"none",fill:"none"});t.look!=="handDrawn"&&(w.roughness=0,w.fillStyle="solid");let v=k.rectangle(m,x,u,p,w),$=Math.max(u,c.width),P=p+c.height+b,E=k.rectangle(-$/2,-P/2,$,P,{...w,fill:"transparent",stroke:"none"}),A=l.insert(()=>v,":first-child"),R=l.insert(()=>E);if(t.icon){let _=l.append("g");_.html(`<g>${await ft(t.icon,{height:s,width:s,fallbackPrefix:""})}</g>`);let D=_.node().getBBox(),C=D.width,N=D.height,B=D.x,I=D.y;_.attr("transform",`translate(${-C/2-B},${f?c.height/2+b/2-N/2-I:-c.height/2-b/2-N/2-I})`),_.attr("style",`color: ${d.get("stroke")??y};`)}return g.attr("transform",`translate(${-c.width/2-(c.x-(c.left??0))},${f?-P/2:P/2-c.height})`),A.attr("transform",`translate(0,${f?c.height/2+b/2:-c.height/2-b/2})`),W(t,R),t.intersect=function(_){if(q.info("iconSquare intersect",t,_),!t.label)return L.rect(t,_);let D=t.x??0,C=t.y??0,N=t.height??0,B=[];return f?B=[{x:D-c.width/2,y:C-N/2},{x:D+c.width/2,y:C-N/2},{x:D+c.width/2,y:C-N/2+c.height+b},{x:D+u/2,y:C-N/2+c.height+b},{x:D+u/2,y:C+N/2},{x:D-u/2,y:C+N/2},{x:D-u/2,y:C-N/2+c.height+b},{x:D-c.width/2,y:C-N/2+c.height+b}]:B=[{x:D-u/2,y:C-N/2},{x:D+u/2,y:C-N/2},{x:D+u/2,y:C-N/2+p},{x:D+c.width/2,y:C-N/2+p},{x:D+c.width/2/2,y:C+N/2},{x:D-c.width/2,y:C+N/2},{x:D-c.width/2,y:C-N/2+p},{x:D-u/2,y:C-N/2+p}],L.polygon(t,B,_)},l}S(te,"icon");async function se(n,t,{config:{themeVariables:r,flowchart:a}}){let{labelStyles:e}=H(t);t.labelStyle=e;let i=t.assetHeight??48,o=t.assetWidth??48,s=Math.max(i,o),h=a==null?void 0:a.wrappingWidth;t.width=Math.max(s,h??0);let{shapeSvg:l,bbox:c,label:g}=await G(n,t,"icon-shape default"),f=20,p=t.label?8:0,u=t.pos==="t",{nodeBorder:y,mainBkg:d}=r,{stylesMap:m}=pt(t),x=M.svg(l),b=T(t,{});t.look!=="handDrawn"&&(b.roughness=0,b.fillStyle="solid");let k=m.get("fill");b.stroke=k??d;let w=l.append("g");t.icon&&w.html(`<g>${await ft(t.icon,{height:s,width:s,fallbackPrefix:""})}</g>`);let v=w.node().getBBox(),$=v.width,P=v.height,E=v.x,A=v.y,R=Math.max($,P)*Math.SQRT2+f*2,_=x.circle(0,0,R,b),D=Math.max(R,c.width),C=R+c.height+p,N=x.rectangle(-D/2,-C/2,D,C,{...b,fill:"transparent",stroke:"none"}),B=l.insert(()=>_,":first-child"),I=l.insert(()=>N);return w.attr("transform",`translate(${-$/2-E},${u?c.height/2+p/2-P/2-A:-c.height/2-p/2-P/2-A})`),w.attr("style",`color: ${m.get("stroke")??y};`),g.attr("transform",`translate(${-c.width/2-(c.x-(c.left??0))},${u?-C/2:C/2-c.height})`),B.attr("transform",`translate(0,${u?c.height/2+p/2:-c.height/2-p/2})`),W(t,I),t.intersect=function(z){return q.info("iconSquare intersect",t,z),L.rect(t,z)},l}S(se,"iconCircle");async function ee(n,t,{config:{themeVariables:r,flowchart:a}}){let{labelStyles:e}=H(t);t.labelStyle=e;let i=t.assetHeight??48,o=t.assetWidth??48,s=Math.max(i,o),h=a==null?void 0:a.wrappingWidth;t.width=Math.max(s,h??0);let{shapeSvg:l,bbox:c,halfPadding:g,label:f}=await G(n,t,"icon-shape default"),p=t.pos==="t",u=s+g*2,y=s+g*2,{nodeBorder:d,mainBkg:m}=r,{stylesMap:x}=pt(t),b=-y/2,k=-u/2,w=t.label?8:0,v=M.svg(l),$=T(t,{});t.look!=="handDrawn"&&($.roughness=0,$.fillStyle="solid");let P=x.get("fill");$.stroke=P??m;let E=v.path(at(b,k,y,u,5),$),A=Math.max(y,c.width),R=u+c.height+w,_=v.rectangle(-A/2,-R/2,A,R,{...$,fill:"transparent",stroke:"none"}),D=l.insert(()=>E,":first-child").attr("class","icon-shape2"),C=l.insert(()=>_);if(t.icon){let N=l.append("g");N.html(`<g>${await ft(t.icon,{height:s,width:s,fallbackPrefix:""})}</g>`);let B=N.node().getBBox(),I=B.width,z=B.height,V=B.x,tt=B.y;N.attr("transform",`translate(${-I/2-V},${p?c.height/2+w/2-z/2-tt:-c.height/2-w/2-z/2-tt})`),N.attr("style",`color: ${x.get("stroke")??d};`)}return f.attr("transform",`translate(${-c.width/2-(c.x-(c.left??0))},${p?-R/2:R/2-c.height})`),D.attr("transform",`translate(0,${p?c.height/2+w/2:-c.height/2-w/2})`),W(t,C),t.intersect=function(N){if(q.info("iconSquare intersect",t,N),!t.label)return L.rect(t,N);let B=t.x??0,I=t.y??0,z=t.height??0,V=[];return p?V=[{x:B-c.width/2,y:I-z/2},{x:B+c.width/2,y:I-z/2},{x:B+c.width/2,y:I-z/2+c.height+w},{x:B+y/2,y:I-z/2+c.height+w},{x:B+y/2,y:I+z/2},{x:B-y/2,y:I+z/2},{x:B-y/2,y:I-z/2+c.height+w},{x:B-c.width/2,y:I-z/2+c.height+w}]:V=[{x:B-y/2,y:I-z/2},{x:B+y/2,y:I-z/2},{x:B+y/2,y:I-z/2+u},{x:B+c.width/2,y:I-z/2+u},{x:B+c.width/2/2,y:I+z/2},{x:B-c.width/2,y:I+z/2},{x:B-c.width/2,y:I-z/2+u},{x:B-y/2,y:I-z/2+u}],L.polygon(t,V,N)},l}S(ee,"iconRounded");async function ae(n,t,{config:{themeVariables:r,flowchart:a}}){let{labelStyles:e}=H(t);t.labelStyle=e;let i=t.assetHeight??48,o=t.assetWidth??48,s=Math.max(i,o),h=a==null?void 0:a.wrappingWidth;t.width=Math.max(s,h??0);let{shapeSvg:l,bbox:c,halfPadding:g,label:f}=await G(n,t,"icon-shape default"),p=t.pos==="t",u=s+g*2,y=s+g*2,{nodeBorder:d,mainBkg:m}=r,{stylesMap:x}=pt(t),b=-y/2,k=-u/2,w=t.label?8:0,v=M.svg(l),$=T(t,{});t.look!=="handDrawn"&&($.roughness=0,$.fillStyle="solid");let P=x.get("fill");$.stroke=P??m;let E=v.path(at(b,k,y,u,.1),$),A=Math.max(y,c.width),R=u+c.height+w,_=v.rectangle(-A/2,-R/2,A,R,{...$,fill:"transparent",stroke:"none"}),D=l.insert(()=>E,":first-child"),C=l.insert(()=>_);if(t.icon){let N=l.append("g");N.html(`<g>${await ft(t.icon,{height:s,width:s,fallbackPrefix:""})}</g>`);let B=N.node().getBBox(),I=B.width,z=B.height,V=B.x,tt=B.y;N.attr("transform",`translate(${-I/2-V},${p?c.height/2+w/2-z/2-tt:-c.height/2-w/2-z/2-tt})`),N.attr("style",`color: ${x.get("stroke")??d};`)}return f.attr("transform",`translate(${-c.width/2-(c.x-(c.left??0))},${p?-R/2:R/2-c.height})`),D.attr("transform",`translate(0,${p?c.height/2+w/2:-c.height/2-w/2})`),W(t,C),t.intersect=function(N){if(q.info("iconSquare intersect",t,N),!t.label)return L.rect(t,N);let B=t.x??0,I=t.y??0,z=t.height??0,V=[];return p?V=[{x:B-c.width/2,y:I-z/2},{x:B+c.width/2,y:I-z/2},{x:B+c.width/2,y:I-z/2+c.height+w},{x:B+y/2,y:I-z/2+c.height+w},{x:B+y/2,y:I+z/2},{x:B-y/2,y:I+z/2},{x:B-y/2,y:I-z/2+c.height+w},{x:B-c.width/2,y:I-z/2+c.height+w}]:V=[{x:B-y/2,y:I-z/2},{x:B+y/2,y:I-z/2},{x:B+y/2,y:I-z/2+u},{x:B+c.width/2,y:I-z/2+u},{x:B+c.width/2/2,y:I+z/2},{x:B-c.width/2,y:I+z/2},{x:B-c.width/2,y:I-z/2+u},{x:B-y/2,y:I-z/2+u}],L.polygon(t,V,N)},l}S(ae,"iconSquare");async function re(n,t,{config:{flowchart:r}}){let a=new Image;a.src=(t==null?void 0:t.img)??"",await a.decode();let e=Number(a.naturalWidth.toString().replace("px","")),i=Number(a.naturalHeight.toString().replace("px",""));t.imageAspectRatio=e/i;let{labelStyles:o}=H(t);t.labelStyle=o;let s=r==null?void 0:r.wrappingWidth;t.defaultWidth=r==null?void 0:r.wrappingWidth;let h=Math.max(t.label?s??0:0,(t==null?void 0:t.assetWidth)??e),l=t.constraint==="on"&&t!=null&&t.assetHeight?t.assetHeight*t.imageAspectRatio:h,c=t.constraint==="on"?l/t.imageAspectRatio:(t==null?void 0:t.assetHeight)??i;t.width=Math.max(l,s??0);let{shapeSvg:g,bbox:f,label:p}=await G(n,t,"image-shape default"),u=t.pos==="t",y=-l/2,d=-c/2,m=t.label?8:0,x=M.svg(g),b=T(t,{});t.look!=="handDrawn"&&(b.roughness=0,b.fillStyle="solid");let k=x.rectangle(y,d,l,c,b),w=Math.max(l,f.width),v=c+f.height+m,$=x.rectangle(-w/2,-v/2,w,v,{...b,fill:"none",stroke:"none"}),P=g.insert(()=>k,":first-child"),E=g.insert(()=>$);if(t.img){let A=g.append("image");A.attr("href",t.img),A.attr("width",l),A.attr("height",c),A.attr("preserveAspectRatio","none"),A.attr("transform",`translate(${-l/2},${u?v/2-c:-v/2})`)}return p.attr("transform",`translate(${-f.width/2-(f.x-(f.left??0))},${u?-c/2-f.height/2-m/2:c/2-f.height/2+m/2})`),P.attr("transform",`translate(0,${u?f.height/2+m/2:-f.height/2-m/2})`),W(t,E),t.intersect=function(A){if(q.info("iconSquare intersect",t,A),!t.label)return L.rect(t,A);let R=t.x??0,_=t.y??0,D=t.height??0,C=[];return u?C=[{x:R-f.width/2,y:_-D/2},{x:R+f.width/2,y:_-D/2},{x:R+f.width/2,y:_-D/2+f.height+m},{x:R+l/2,y:_-D/2+f.height+m},{x:R+l/2,y:_+D/2},{x:R-l/2,y:_+D/2},{x:R-l/2,y:_-D/2+f.height+m},{x:R-f.width/2,y:_-D/2+f.height+m}]:C=[{x:R-l/2,y:_-D/2},{x:R+l/2,y:_-D/2},{x:R+l/2,y:_-D/2+c},{x:R+f.width/2,y:_-D/2+c},{x:R+f.width/2/2,y:_+D/2},{x:R-f.width/2,y:_+D/2},{x:R-f.width/2,y:_-D/2+c},{x:R-l/2,y:_-D/2+c}],L.polygon(t,C,A)},g}S(re,"imageSquare");async function ie(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),s=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),h=[{x:0,y:0},{x:o,y:0},{x:o+3*s/6,y:-s},{x:-3*s/6,y:-s}],l,{cssStyles:c}=t;if(t.look==="handDrawn"){let g=M.svg(e),f=T(t,{}),p=F(h),u=g.path(p,f);l=e.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${s/2})`),c&&l.attr("style",c)}else l=rt(e,o,s,h);return a&&l.attr("style",a),t.width=o,t.height=s,W(t,l),t.intersect=function(g){return L.polygon(t,h,g)},e}S(ie,"inv_trapezoid");async function Rt(n,t,r){let{labelStyles:a,nodeStyles:e}=H(t);t.labelStyle=a;let{shapeSvg:i,bbox:o}=await G(n,t,j(t)),s=Math.max(o.width+r.labelPaddingX*2,(t==null?void 0:t.width)||0),h=Math.max(o.height+r.labelPaddingY*2,(t==null?void 0:t.height)||0),l=-s/2,c=-h/2,g,{rx:f,ry:p}=t,{cssStyles:u}=t;if(r!=null&&r.rx&&r.ry&&(f=r.rx,p=r.ry),t.look==="handDrawn"){let y=M.svg(i),d=T(t,{}),m=f||p?y.path(at(l,c,s,h,f||0),d):y.rectangle(l,c,s,h,d);g=i.insert(()=>m,":first-child"),g.attr("class","basic label-container").attr("style",J(u))}else g=i.insert("rect",":first-child"),g.attr("class","basic label-container").attr("style",e).attr("rx",J(f)).attr("ry",J(p)).attr("x",l).attr("y",c).attr("width",s).attr("height",h);return W(t,g),t.intersect=function(y){return L.rect(t,y)},i}S(Rt,"drawRect");async function le(n,t){let{shapeSvg:r,bbox:a,label:e}=await G(n,t,"label"),i=r.insert("rect",":first-child");return i.attr("width",.1).attr("height",.1),r.attr("class","label edgeLabel"),e.attr("transform",`translate(${-(a.width/2)-(a.x-(a.left??0))}, ${-(a.height/2)-(a.y-(a.top??0))})`),W(t,i),t.intersect=function(h){return L.rect(t,h)},r}S(le,"labelRect");async function ne(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=Math.max(i.width+(t.padding??0),(t==null?void 0:t.width)??0),s=Math.max(i.height+(t.padding??0),(t==null?void 0:t.height)??0),h=[{x:0,y:0},{x:o+3*s/6,y:0},{x:o,y:-s},{x:-(3*s)/6,y:-s}],l,{cssStyles:c}=t;if(t.look==="handDrawn"){let g=M.svg(e),f=T(t,{}),p=F(h),u=g.path(p,f);l=e.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${s/2})`),c&&l.attr("style",c)}else l=rt(e,o,s,h);return a&&l.attr("style",a),t.width=o,t.height=s,W(t,l),t.intersect=function(g){return L.polygon(t,h,g)},e}S(ne,"lean_left");async function ce(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=Math.max(i.width+(t.padding??0),(t==null?void 0:t.width)??0),s=Math.max(i.height+(t.padding??0),(t==null?void 0:t.height)??0),h=[{x:-3*s/6,y:0},{x:o,y:0},{x:o+3*s/6,y:-s},{x:0,y:-s}],l,{cssStyles:c}=t;if(t.look==="handDrawn"){let g=M.svg(e),f=T(t,{}),p=F(h),u=g.path(p,f);l=e.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${s/2})`),c&&l.attr("style",c)}else l=rt(e,o,s,h);return a&&l.attr("style",a),t.width=o,t.height=s,W(t,l),t.intersect=function(g){return L.polygon(t,h,g)},e}S(ce,"lean_right");function oe(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.label="",t.labelStyle=r;let e=n.insert("g").attr("class",j(t)).attr("id",t.domId??t.id),{cssStyles:i}=t,o=Math.max(35,(t==null?void 0:t.width)??0),s=Math.max(35,(t==null?void 0:t.height)??0),h=7,l=[{x:o,y:0},{x:0,y:s+h/2},{x:o-2*h,y:s+h/2},{x:0,y:2*s},{x:o,y:s-h/2},{x:2*h,y:s-h/2}],c=M.svg(e),g=T(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let f=F(l),p=c.path(f,g),u=e.insert(()=>p,":first-child");return i&&t.look!=="handDrawn"&&u.selectAll("path").attr("style",i),a&&t.look!=="handDrawn"&&u.selectAll("path").attr("style",a),u.attr("transform",`translate(-${o/2},${-s})`),W(t,u),t.intersect=function(y){return q.info("lightningBolt intersect",t,y),L.polygon(t,l,y)},e}S(oe,"lightningBolt");var ua=S((n,t,r,a,e,i,o)=>[`M${n},${t+i}`,`a${e},${i} 0,0,0 ${r},0`,`a${e},${i} 0,0,0 ${-r},0`,`l0,${a}`,`a${e},${i} 0,0,0 ${r},0`,`l0,${-a}`,`M${n},${t+i+o}`,`a${e},${i} 0,0,0 ${r},0`].join(" "),"createCylinderPathD"),ya=S((n,t,r,a,e,i,o)=>[`M${n},${t+i}`,`M${n+r},${t+i}`,`a${e},${i} 0,0,0 ${-r},0`,`l0,${a}`,`a${e},${i} 0,0,0 ${r},0`,`l0,${-a}`,`M${n},${t+i+o}`,`a${e},${i} 0,0,0 ${r},0`].join(" "),"createOuterCylinderPathD"),ma=S((n,t,r,a,e,i)=>[`M${n-r/2},${-a/2}`,`a${e},${i} 0,0,0 ${r},0`].join(" "),"createInnerCylinderPathD");async function he(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0),t.width??0),h=s/2,l=h/(2.5+s/50),c=Math.max(i.height+l+(t.padding??0),t.height??0),g=c*.1,f,{cssStyles:p}=t;if(t.look==="handDrawn"){let u=M.svg(e),y=ya(0,0,s,c,h,l,g),d=ma(0,l,s,c,h,l),m=T(t,{}),x=u.path(y,m),b=u.path(d,m);e.insert(()=>b,":first-child").attr("class","line"),f=e.insert(()=>x,":first-child"),f.attr("class","basic label-container"),p&&f.attr("style",p)}else{let u=ua(0,0,s,c,h,l,g);f=e.insert("path",":first-child").attr("d",u).attr("class","basic label-container").attr("style",J(p)).attr("style",a)}return f.attr("label-offset-y",l),f.attr("transform",`translate(${-s/2}, ${-(c/2+l)})`),W(t,f),o.attr("transform",`translate(${-(i.width/2)-(i.x-(i.left??0))}, ${-(i.height/2)+l-(i.y-(i.top??0))})`),t.intersect=function(u){let y=L.rect(t,u),d=y.x-(t.x??0);if(h!=0&&(Math.abs(d)<(t.width??0)/2||Math.abs(d)==(t.width??0)/2&&Math.abs(y.y-(t.y??0))>(t.height??0)/2-l)){let m=l*l*(1-d*d/(h*h));m>0&&(m=Math.sqrt(m)),m=l-m,u.y-(t.y??0)>0&&(m=-m),y.y+=m}return y},e}S(he,"linedCylinder");async function ge(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=h/4,c=h+l,{cssStyles:g}=t,f=M.svg(e),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=[{x:-s/2-s/2*.1,y:-c/2},{x:-s/2-s/2*.1,y:c/2},...lt(-s/2-s/2*.1,c/2,s/2+s/2*.1,c/2,l,.8),{x:s/2+s/2*.1,y:-c/2},{x:-s/2-s/2*.1,y:-c/2},{x:-s/2,y:-c/2},{x:-s/2,y:c/2*1.1},{x:-s/2,y:-c/2}],y=f.polygon(u.map(m=>[m.x,m.y]),p),d=e.insert(()=>y,":first-child");return d.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",g),a&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",a),d.attr("transform",`translate(0,${-l/2})`),o.attr("transform",`translate(${-s/2+(t.padding??0)+s/2*.1/2-(i.x-(i.left??0))},${-h/2+(t.padding??0)-l/2-(i.y-(i.top??0))})`),W(t,d),t.intersect=function(m){return L.polygon(t,u,m)},e}S(ge,"linedWaveEdgedRect");async function pe(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=5,c=-s/2,g=-h/2,{cssStyles:f}=t,p=M.svg(e),u=T(t,{}),y=[{x:c-l,y:g+l},{x:c-l,y:g+h+l},{x:c+s-l,y:g+h+l},{x:c+s-l,y:g+h},{x:c+s,y:g+h},{x:c+s,y:g+h-l},{x:c+s+l,y:g+h-l},{x:c+s+l,y:g-l},{x:c+l,y:g-l},{x:c+l,y:g},{x:c,y:g},{x:c,y:g+l}],d=[{x:c,y:g+l},{x:c+s-l,y:g+l},{x:c+s-l,y:g+h},{x:c+s,y:g+h},{x:c+s,y:g},{x:c,y:g}];t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let m=F(y),x=p.path(m,u),b=F(d),k=p.path(b,{...u,fill:"none"}),w=e.insert(()=>k,":first-child");return w.insert(()=>x,":first-child"),w.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",f),a&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",a),o.attr("transform",`translate(${-(i.width/2)-l-(i.x-(i.left??0))}, ${-(i.height/2)+l-(i.y-(i.top??0))})`),W(t,w),t.intersect=function(v){return L.polygon(t,y,v)},e}S(pe,"multiRect");async function fe(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=h/4,c=h+l,g=-s/2,f=-c/2,p=5,{cssStyles:u}=t,y=lt(g-p,f+c+p,g+s-p,f+c+p,l,.8),d=y==null?void 0:y[y.length-1],m=[{x:g-p,y:f+p},{x:g-p,y:f+c+p},...y,{x:g+s-p,y:d.y-p},{x:g+s,y:d.y-p},{x:g+s,y:d.y-2*p},{x:g+s+p,y:d.y-2*p},{x:g+s+p,y:f-p},{x:g+p,y:f-p},{x:g+p,y:f},{x:g,y:f},{x:g,y:f+p}],x=[{x:g,y:f+p},{x:g+s-p,y:f+p},{x:g+s-p,y:d.y-p},{x:g+s,y:d.y-p},{x:g+s,y:f},{x:g,y:f}],b=M.svg(e),k=T(t,{});t.look!=="handDrawn"&&(k.roughness=0,k.fillStyle="solid");let w=F(m),v=b.path(w,k),$=F(x),P=b.path($,k),E=e.insert(()=>v,":first-child");return E.insert(()=>P),E.attr("class","basic label-container"),u&&t.look!=="handDrawn"&&E.selectAll("path").attr("style",u),a&&t.look!=="handDrawn"&&E.selectAll("path").attr("style",a),E.attr("transform",`translate(0,${-l/2})`),o.attr("transform",`translate(${-(i.width/2)-p-(i.x-(i.left??0))}, ${-(i.height/2)+p-l/2-(i.y-(i.top??0))})`),W(t,E),t.intersect=function(A){return L.polygon(t,m,A)},e}S(fe,"multiWaveEdgedRectangle");async function ue(n,t,{config:{themeVariables:r}}){var m;let{labelStyles:a,nodeStyles:e}=H(t);t.labelStyle=a,t.useHtmlLabels||((m=Nt().flowchart)==null?void 0:m.htmlLabels)!==!1||(t.centerLabel=!0);let{shapeSvg:o,bbox:s}=await G(n,t,j(t)),h=Math.max(s.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),l=Math.max(s.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),c=-h/2,g=-l/2,{cssStyles:f}=t,p=M.svg(o),u=T(t,{fill:r.noteBkgColor,stroke:r.noteBorderColor});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=p.rectangle(c,g,h,l,u),d=o.insert(()=>y,":first-child");return d.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",f),e&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",e),W(t,d),t.intersect=function(x){return L.rect(t,x)},o}S(ue,"note");var da=S((n,t,r)=>[`M${n+r/2},${t}`,`L${n+r},${t-r/2}`,`L${n+r/2},${t-r}`,`L${n},${t-r/2}`,"Z"].join(" "),"createDecisionBoxPathD");async function ye(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=i.width+t.padding,s=i.height+t.padding,h=o+s,l=[{x:h/2,y:0},{x:h,y:-h/2},{x:h/2,y:-h},{x:0,y:-h/2}],c,{cssStyles:g}=t;if(t.look==="handDrawn"){let f=M.svg(e),p=T(t,{}),u=da(0,0,h),y=f.path(u,p);c=e.insert(()=>y,":first-child").attr("transform",`translate(${-h/2}, ${h/2})`),g&&c.attr("style",g)}else c=rt(e,h,h,l);return a&&c.attr("style",a),W(t,c),t.intersect=function(f){return q.debug(`APA12 Intersect called SPLIT
point:`,f,`
node:
`,t,`
res:`,L.polygon(t,l,f)),L.polygon(t,l,f)},e}S(ye,"question");async function me(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0),(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0),(t==null?void 0:t.height)??0),l=-s/2,c=-h/2,g=c/2,f=[{x:l+g,y:c},{x:l,y:0},{x:l+g,y:-c},{x:-l,y:-c},{x:-l,y:c}],{cssStyles:p}=t,u=M.svg(e),y=T(t,{});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let d=F(f),m=u.path(d,y),x=e.insert(()=>m,":first-child");return x.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",p),a&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",a),x.attr("transform",`translate(${-g/2},0)`),o.attr("transform",`translate(${-g/2-i.width/2-(i.x-(i.left??0))}, ${-(i.height/2)-(i.y-(i.top??0))})`),W(t,x),t.intersect=function(b){return L.polygon(t,f,b)},e}S(me,"rect_left_inv_arrow");async function de(n,t){var P,E;let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let e;t.cssClasses?e="node "+t.cssClasses:e="node default";let i=n.insert("g").attr("class",e).attr("id",t.domId||t.id),o=i.insert("g"),s=i.insert("g").attr("class","label").attr("style",a),h=t.description,l=t.label,c=s.node().appendChild(await ts(l,t.labelStyle,!0,!0)),g={width:0,height:0};if(Q((E=(P=X())==null?void 0:P.flowchart)==null?void 0:E.htmlLabels)){let A=c.children[0],R=Y(c);g=A.getBoundingClientRect(),R.attr("width",g.width),R.attr("height",g.height)}q.info("Text 2",h);let f=h||[],p=c.getBBox(),u=s.node().appendChild(await ts(f.join?f.join("<br/>"):f,t.labelStyle,!0,!0)),y=u.children[0],d=Y(u);g=y.getBoundingClientRect(),d.attr("width",g.width),d.attr("height",g.height);let m=(t.padding||0)/2;Y(u).attr("transform","translate( "+(g.width>p.width?0:(p.width-g.width)/2)+", "+(p.height+m+5)+")"),Y(c).attr("transform","translate( "+(g.width<p.width?0:-(p.width-g.width)/2)+", 0)"),g=s.node().getBBox(),s.attr("transform","translate("+-g.width/2+", "+(-g.height/2-m+3)+")");let x=g.width+(t.padding||0),b=g.height+(t.padding||0),k=-g.width/2-m,w=-g.height/2-m,v,$;if(t.look==="handDrawn"){let A=M.svg(i),R=T(t,{}),_=A.path(at(k,w,x,b,t.rx||0),R),D=A.line(-g.width/2-m,-g.height/2-m+p.height+m,g.width/2+m,-g.height/2-m+p.height+m,R);$=i.insert(()=>(q.debug("Rough node insert CXC",_),D),":first-child"),v=i.insert(()=>(q.debug("Rough node insert CXC",_),_),":first-child")}else v=o.insert("rect",":first-child"),$=o.insert("line"),v.attr("class","outer title-state").attr("style",a).attr("x",-g.width/2-m).attr("y",-g.height/2-m).attr("width",g.width+(t.padding||0)).attr("height",g.height+(t.padding||0)),$.attr("class","divider").attr("x1",-g.width/2-m).attr("x2",g.width/2+m).attr("y1",-g.height/2-m+p.height+m).attr("y2",-g.height/2-m+p.height+m);return W(t,v),t.intersect=function(A){return L.rect(t,A)},i}S(de,"rectWithTitle");async function xe(n,t){let r={rx:5,ry:5,classes:"",labelPaddingX:((t==null?void 0:t.padding)||0)*1,labelPaddingY:((t==null?void 0:t.padding)||0)*1};return Rt(n,t,r)}S(xe,"roundedRect");async function be(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=(t==null?void 0:t.padding)??0,h=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),l=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),c=-i.width/2-s,g=-i.height/2-s,{cssStyles:f}=t,p=M.svg(e),u=T(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=[{x:c,y:g},{x:c+h+8,y:g},{x:c+h+8,y:g+l},{x:c-8,y:g+l},{x:c-8,y:g},{x:c,y:g},{x:c,y:g+l}],d=p.polygon(y.map(x=>[x.x,x.y]),u),m=e.insert(()=>d,":first-child");return m.attr("class","basic label-container").attr("style",J(f)),a&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",a),f&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",a),o.attr("transform",`translate(${-h/2+4+(t.padding??0)-(i.x-(i.left??0))},${-l/2+(t.padding??0)-(i.y-(i.top??0))})`),W(t,m),t.intersect=function(x){return L.rect(t,x)},e}S(be,"shadedProcess");async function we(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=-s/2,c=-h/2,{cssStyles:g}=t,f=M.svg(e),p=T(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let u=[{x:l,y:c},{x:l,y:c+h},{x:l+s,y:c+h},{x:l+s,y:c-h/2}],y=F(u),d=f.path(y,p),m=e.insert(()=>d,":first-child");return m.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",g),a&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",a),m.attr("transform",`translate(0, ${h/4})`),o.attr("transform",`translate(${-s/2+(t.padding??0)-(i.x-(i.left??0))}, ${-h/4+(t.padding??0)-(i.y-(i.top??0))})`),W(t,m),t.intersect=function(x){return L.polygon(t,u,x)},e}S(we,"slopedRect");async function Se(n,t){let r={rx:0,ry:0,classes:"",labelPaddingX:((t==null?void 0:t.padding)||0)*2,labelPaddingY:((t==null?void 0:t.padding)||0)*1};return Rt(n,t,r)}S(Se,"squareRect");async function Me(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=i.height+t.padding,s=i.width+o/4+t.padding,h,{cssStyles:l}=t;if(t.look==="handDrawn"){let c=M.svg(e),g=T(t,{}),f=at(-s/2,-o/2,s,o,o/2),p=c.path(f,g);h=e.insert(()=>p,":first-child"),h.attr("class","basic label-container").attr("style",J(l))}else h=e.insert("rect",":first-child"),h.attr("class","basic label-container").attr("style",a).attr("rx",o/2).attr("ry",o/2).attr("x",-s/2).attr("y",-o/2).attr("width",s).attr("height",o);return W(t,h),t.intersect=function(c){return L.rect(t,c)},e}S(Me,"stadium");async function ke(n,t){return Rt(n,t,{rx:5,ry:5,classes:"flowchart-node"})}S(ke,"state");function ve(n,t,{config:{themeVariables:r}}){let{labelStyles:a,nodeStyles:e}=H(t);t.labelStyle=a;let{cssStyles:i}=t,{lineColor:o,stateBorder:s,nodeBorder:h}=r,l=n.insert("g").attr("class","node default").attr("id",t.domId||t.id),c=M.svg(l),g=T(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let f=c.circle(0,0,14,{...g,stroke:o,strokeWidth:2}),p=s??h,u=c.circle(0,0,5,{...g,fill:p,stroke:p,strokeWidth:2,fillStyle:"solid"}),y=l.insert(()=>f,":first-child");return y.insert(()=>u),i&&y.selectAll("path").attr("style",i),e&&y.selectAll("path").attr("style",e),W(t,y),t.intersect=function(d){return L.circle(t,7,d)},l}S(ve,"stateEnd");function $e(n,t,{config:{themeVariables:r}}){let{lineColor:a}=r,e=n.insert("g").attr("class","node default").attr("id",t.domId||t.id),i;if(t.look==="handDrawn"){let s=M.svg(e).circle(0,0,14,Ue(a));i=e.insert(()=>s),i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14)}else i=e.insert("circle",":first-child"),i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14);return W(t,i),t.intersect=function(o){return L.circle(t,7,o)},e}S($e,"stateStart");async function De(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=((t==null?void 0:t.padding)||0)/2,s=i.width+t.padding,h=i.height+t.padding,l=-i.width/2-o,c=-i.height/2-o,g=[{x:0,y:0},{x:s,y:0},{x:s,y:-h},{x:0,y:-h},{x:0,y:0},{x:-8,y:0},{x:s+8,y:0},{x:s+8,y:-h},{x:-8,y:-h},{x:-8,y:0}];if(t.look==="handDrawn"){let f=M.svg(e),p=T(t,{}),u=f.rectangle(l-8,c,s+16,h,p),y=f.line(l,c,l,c+h,p),d=f.line(l+s,c,l+s,c+h,p);e.insert(()=>y,":first-child"),e.insert(()=>d,":first-child");let m=e.insert(()=>u,":first-child"),{cssStyles:x}=t;m.attr("class","basic label-container").attr("style",J(x)),W(t,m)}else{let f=rt(e,s,h,g);a&&f.attr("style",a),W(t,f)}return t.intersect=function(f){return L.polygon(t,g,f)},e}S(De,"subroutine");async function Pe(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),s=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),h=-o/2,l=-s/2,c=.2*s,g=.2*s,{cssStyles:f}=t,p=M.svg(e),u=T(t,{}),y=[{x:h-c/2,y:l},{x:h+o+c/2,y:l},{x:h+o+c/2,y:l+s},{x:h-c/2,y:l+s}],d=[{x:h+o-c/2,y:l+s},{x:h+o+c/2,y:l+s},{x:h+o+c/2,y:l+s-g}];t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let m=F(y),x=p.path(m,u),b=F(d),k=p.path(b,{...u,fillStyle:"solid"}),w=e.insert(()=>k,":first-child");return w.insert(()=>x,":first-child"),w.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",f),a&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",a),W(t,w),t.intersect=function(v){return L.polygon(t,y,v)},e}S(Pe,"taggedRect");async function Ce(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=h/4,c=.2*s,g=.2*h,f=h+l,{cssStyles:p}=t,u=M.svg(e),y=T(t,{});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let d=[{x:-s/2-s/2*.1,y:f/2},...lt(-s/2-s/2*.1,f/2,s/2+s/2*.1,f/2,l,.8),{x:s/2+s/2*.1,y:-f/2},{x:-s/2-s/2*.1,y:-f/2}],m=-s/2+s/2*.1,x=-f/2-g*.4,b=[{x:m+s-c,y:(x+h)*1.4},{x:m+s,y:x+h-g},{x:m+s,y:(x+h)*.9},...lt(m+s,(x+h)*1.3,m+s-c,(x+h)*1.5,-h*.03,.5)],k=F(d),w=u.path(k,y),v=F(b),$=u.path(v,{...y,fillStyle:"solid"}),P=e.insert(()=>$,":first-child");return P.insert(()=>w,":first-child"),P.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",p),a&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",a),P.attr("transform",`translate(0,${-l/2})`),o.attr("transform",`translate(${-s/2+(t.padding??0)-(i.x-(i.left??0))},${-h/2+(t.padding??0)-l/2-(i.y-(i.top??0))})`),W(t,P),t.intersect=function(E){return L.polygon(t,d,E)},e}S(Ce,"taggedWaveEdgedRectangle");async function Be(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=Math.max(i.width+t.padding,(t==null?void 0:t.width)||0),s=Math.max(i.height+t.padding,(t==null?void 0:t.height)||0),h=-o/2,l=-s/2,c=e.insert("rect",":first-child");return c.attr("class","text").attr("style",a).attr("rx",0).attr("ry",0).attr("x",h).attr("y",l).attr("width",o).attr("height",s),W(t,c),t.intersect=function(g){return L.rect(t,g)},e}S(Be,"text");var xa=S((n,t,r,a,e,i)=>`M${n},${t}
    a${e},${i} 0,0,1 0,${-a}
    l${r},0
    a${e},${i} 0,0,1 0,${a}
    M${r},${-a}
    a${e},${i} 0,0,0 0,${a}
    l${-r},0`,"createCylinderPathD"),ba=S((n,t,r,a,e,i)=>[`M${n},${t}`,`M${n+r},${t}`,`a${e},${i} 0,0,0 0,${-a}`,`l${-r},0`,`a${e},${i} 0,0,0 0,${a}`,`l${r},0`].join(" "),"createOuterCylinderPathD"),wa=S((n,t,r,a,e,i)=>[`M${n+r/2},${-a/2}`,`a${e},${i} 0,0,0 0,${a}`].join(" "),"createInnerCylinderPathD");async function Re(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o,halfPadding:s}=await G(n,t,j(t)),h=t.look==="neo"?s*2:s,l=i.height+h,c=l/2,g=c/(2.5+l/50),f=i.width+g+h,{cssStyles:p}=t,u;if(t.look==="handDrawn"){let y=M.svg(e),d=ba(0,0,f,l,g,c),m=wa(0,0,f,l,g,c),x=y.path(d,T(t,{})),b=y.path(m,T(t,{fill:"none"}));u=e.insert(()=>b,":first-child"),u=e.insert(()=>x,":first-child"),u.attr("class","basic label-container"),p&&u.attr("style",p)}else{let y=xa(0,0,f,l,g,c);u=e.insert("path",":first-child").attr("d",y).attr("class","basic label-container").attr("style",J(p)).attr("style",a),u.attr("class","basic label-container"),p&&u.selectAll("path").attr("style",p),a&&u.selectAll("path").attr("style",a)}return u.attr("label-offset-x",g),u.attr("transform",`translate(${-f/2}, ${l/2} )`),o.attr("transform",`translate(${-(i.width/2)-g-(i.x-(i.left??0))}, ${-(i.height/2)-(i.y-(i.top??0))})`),W(t,u),t.intersect=function(y){let d=L.rect(t,y),m=d.y-(t.y??0);if(c!=0&&(Math.abs(m)<(t.height??0)/2||Math.abs(m)==(t.height??0)/2&&Math.abs(d.x-(t.x??0))>(t.width??0)/2-g)){let x=g*g*(1-m*m/(c*c));x!=0&&(x=Math.sqrt(Math.abs(x))),x=g-x,y.x-(t.x??0)>0&&(x=-x),d.x+=x}return d},e}S(Re,"tiltedCylinder");async function Le(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=i.width+t.padding,s=i.height+t.padding,h=[{x:-3*s/6,y:0},{x:o+3*s/6,y:0},{x:o,y:-s},{x:0,y:-s}],l,{cssStyles:c}=t;if(t.look==="handDrawn"){let g=M.svg(e),f=T(t,{}),p=F(h),u=g.path(p,f);l=e.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${s/2})`),c&&l.attr("style",c)}else l=rt(e,o,s,h);return a&&l.attr("style",a),t.width=o,t.height=s,W(t,l),t.intersect=function(g){return L.polygon(t,h,g)},e}S(Le,"trapezoid");async function Ne(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=60,s=20,h=Math.max(o,i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),l=Math.max(s,i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),{cssStyles:c}=t,g=M.svg(e),f=T(t,{});t.look!=="handDrawn"&&(f.roughness=0,f.fillStyle="solid");let p=[{x:-h/2*.8,y:-l/2},{x:h/2*.8,y:-l/2},{x:h/2,y:-l/2*.6},{x:h/2,y:l/2},{x:-h/2,y:l/2},{x:-h/2,y:-l/2*.6}],u=F(p),y=g.path(u,f),d=e.insert(()=>y,":first-child");return d.attr("class","basic label-container"),c&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",c),a&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",a),W(t,d),t.intersect=function(m){return L.polygon(t,p,m)},e}S(Ne,"trapezoidalPentagon");async function Ae(n,t){var x;let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Q((x=X().flowchart)==null?void 0:x.htmlLabels),h=i.width+(t.padding??0),l=h+i.height,c=h+i.height,g=[{x:0,y:0},{x:c,y:0},{x:c/2,y:-l}],{cssStyles:f}=t,p=M.svg(e),u=T(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=F(g),d=p.path(y,u),m=e.insert(()=>d,":first-child").attr("transform",`translate(${-l/2}, ${l/2})`);return f&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",f),a&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",a),t.width=h,t.height=l,W(t,m),o.attr("transform",`translate(${-i.width/2-(i.x-(i.left??0))}, ${l/2-(i.height+(t.padding??0)/(s?2:1)-(i.y-(i.top??0)))})`),t.intersect=function(b){return q.info("Triangle intersect",t,g,b),L.polygon(t,g,b)},e}S(Ae,"triangle");async function Te(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=h/8,c=h+l,{cssStyles:g}=t,p=70-s,u=p>0?p/2:0,y=M.svg(e),d=T(t,{});t.look!=="handDrawn"&&(d.roughness=0,d.fillStyle="solid");let m=[{x:-s/2-u,y:c/2},...lt(-s/2-u,c/2,s/2+u,c/2,l,.8),{x:s/2+u,y:-c/2},{x:-s/2-u,y:-c/2}],x=F(m),b=y.path(x,d),k=e.insert(()=>b,":first-child");return k.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",g),a&&t.look!=="handDrawn"&&k.selectAll("path").attr("style",a),k.attr("transform",`translate(0,${-l/2})`),o.attr("transform",`translate(${-s/2+(t.padding??0)-(i.x-(i.left??0))},${-h/2+(t.padding??0)-l-(i.y-(i.top??0))})`),W(t,k),t.intersect=function(w){return L.polygon(t,m,w)},e}S(Te,"waveEdgedRectangle");async function We(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i}=await G(n,t,j(t)),o=100,s=50,h=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),l=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),c=h/l,g=h,f=l;g>f*c?f=g/c:g=f*c,g=Math.max(g,o),f=Math.max(f,s);let p=Math.min(f*.2,f/4),u=f+p*2,{cssStyles:y}=t,d=M.svg(e),m=T(t,{});t.look!=="handDrawn"&&(m.roughness=0,m.fillStyle="solid");let x=[{x:-g/2,y:u/2},...lt(-g/2,u/2,g/2,u/2,p,1),{x:g/2,y:-u/2},...lt(g/2,-u/2,-g/2,-u/2,p,-1)],b=F(x),k=d.path(b,m),w=e.insert(()=>k,":first-child");return w.attr("class","basic label-container"),y&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",y),a&&t.look!=="handDrawn"&&w.selectAll("path").attr("style",a),W(t,w),t.intersect=function(v){return L.polygon(t,x,v)},e}S(We,"waveRectangle");async function He(n,t){let{labelStyles:r,nodeStyles:a}=H(t);t.labelStyle=r;let{shapeSvg:e,bbox:i,label:o}=await G(n,t,j(t)),s=Math.max(i.width+(t.padding??0)*2,(t==null?void 0:t.width)??0),h=Math.max(i.height+(t.padding??0)*2,(t==null?void 0:t.height)??0),l=5,c=-s/2,g=-h/2,{cssStyles:f}=t,p=M.svg(e),u=T(t,{}),y=[{x:c-l,y:g-l},{x:c-l,y:g+h},{x:c+s,y:g+h},{x:c+s,y:g-l}],d=`M${c-l},${g-l} L${c+s},${g-l} L${c+s},${g+h} L${c-l},${g+h} L${c-l},${g-l}
                M${c-l},${g} L${c+s},${g}
                M${c},${g-l} L${c},${g+h}`;t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let m=p.path(d,u),x=e.insert(()=>m,":first-child");return x.attr("transform",`translate(${l/2}, ${l/2})`),x.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",f),a&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",a),o.attr("transform",`translate(${-(i.width/2)+l/2-(i.x-(i.left??0))}, ${-(i.height/2)+l/2-(i.y-(i.top??0))})`),W(t,x),t.intersect=function(b){return L.polygon(t,y,b)},e}S(He,"windowPane");async function Ie(n,t,r,a,e=r.class.padding??12){let i=a?0:3,o=n.insert("g").attr("class",j(t)).attr("id",t.domId||t.id),s=null,h=null,l=null,c=null,g=0,f=0,p=0;if(s=o.insert("g").attr("class","annotation-group text"),t.annotations.length>0){let x=t.annotations[0];await bt(s,{text:`\xAB${x}\xBB`},0),g=s.node().getBBox().height}h=o.insert("g").attr("class","label-group text"),await bt(h,t,0,["font-weight: bolder"]);let u=h.node().getBBox();f=u.height,l=o.insert("g").attr("class","members-group text");let y=0;for(let x of t.members){let b=await bt(l,x,y,[x.parseClassifier()]);y+=b+i}p=l.node().getBBox().height,p<=0&&(p=e/2),c=o.insert("g").attr("class","methods-group text");let d=0;for(let x of t.methods){let b=await bt(c,x,d,[x.parseClassifier()]);d+=b+i}let m=o.node().getBBox();if(s!==null){let x=s.node().getBBox();s.attr("transform",`translate(${-x.width/2})`)}return h.attr("transform",`translate(${-u.width/2}, ${g})`),m=o.node().getBBox(),l.attr("transform",`translate(0, ${g+f+e*2})`),m=o.node().getBBox(),c.attr("transform",`translate(0, ${g+f+(p?p+e*4:e*2)})`),m=o.node().getBBox(),{shapeSvg:o,bbox:m}}S(Ie,"textHelper");async function bt(n,t,r,a=[]){let e=n.insert("g").attr("class","label").attr("style",a.join("; ")),i=Nt(),o="useHtmlLabels"in t?t.useHtmlLabels:Q(i.htmlLabels)??!0,s="";"text"in t?s=t.text:s=t.label,!o&&s.startsWith("\\")&&(s=s.substring(1)),Tt(s)&&(o=!0);let h=await ct(e,ns(ut(s)),{width:cs(s,i)+50,classes:"markdown-node-label",useHtmlLabels:o},i),l,c=1;if(o){let g=h.children[0],f=Y(h);c=g.innerHTML.split("<br>").length,g.innerHTML.includes("</math>")&&(c+=g.innerHTML.split("<mrow>").length-1);let p=g.getElementsByTagName("img");if(p){let u=s.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...p].map(y=>new Promise(d=>{function m(){var x;if(y.style.display="flex",y.style.flexDirection="column",u){let b=((x=i.fontSize)==null?void 0:x.toString())??window.getComputedStyle(document.body).fontSize,w=parseInt(b,10)*5+"px";y.style.minWidth=w,y.style.maxWidth=w}else y.style.width="100%";d(y)}S(m,"setupImage"),setTimeout(()=>{y.complete&&m()}),y.addEventListener("error",m),y.addEventListener("load",m)})))}l=g.getBoundingClientRect(),f.attr("width",l.width),f.attr("height",l.height)}else{a.includes("font-weight: bolder")&&Y(h).selectAll("tspan").attr("font-weight",""),c=h.children.length;let g=h.children[0];(h.textContent===""||h.textContent.includes("&gt"))&&(g.textContent=s[0]+s.substring(1).replaceAll("&gt;",">").replaceAll("&lt;","<").trim(),s[1]===" "&&(g.textContent=g.textContent[0]+" "+g.textContent.substring(1))),g.textContent==="undefined"&&(g.textContent=""),l=h.getBBox()}return e.attr("transform","translate(0,"+(-l.height/(2*c)+r)+")"),l.height}S(bt,"addText");async function Ee(n,t){var E,A;let r=X(),a=r.class.padding??12,e=a,i=t.useHtmlLabels??Q(r.htmlLabels)??!0,o=t;o.annotations=o.annotations??[],o.members=o.members??[],o.methods=o.methods??[];let{shapeSvg:s,bbox:h}=await Ie(n,t,r,i,e),{labelStyles:l,nodeStyles:c}=H(t);t.labelStyle=l,t.cssStyles=o.styles||"";let g=((E=o.styles)==null?void 0:E.join(";"))||c||"";t.cssStyles||(t.cssStyles=g.replaceAll("!important","").split(";"));let f=o.members.length===0&&o.methods.length===0&&!((A=r.class)!=null&&A.hideEmptyMembersBox),p=M.svg(s),u=T(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=h.width,d=h.height;o.members.length===0&&o.methods.length===0?d+=e:o.members.length>0&&o.methods.length===0&&(d+=e*2);let m=-y/2,x=-d/2,b=p.rectangle(m-a,x-a-(f?a:o.members.length===0&&o.methods.length===0?-a/2:0),y+2*a,d+2*a+(f?a*2:o.members.length===0&&o.methods.length===0?-a:0),u),k=s.insert(()=>b,":first-child");k.attr("class","basic label-container");let w=k.node().getBBox();s.selectAll(".text").each((R,_,D)=>{var V;let C=Y(D[_]),N=C.attr("transform"),B=0;if(N){let wt=RegExp(/translate\(([^,]+),([^)]+)\)/).exec(N);wt&&(B=parseFloat(wt[2]))}let I=B+x+a-(f?a:o.members.length===0&&o.methods.length===0?-a/2:0);i||(I-=4);let z=m;(C.attr("class").includes("label-group")||C.attr("class").includes("annotation-group"))&&(z=-((V=C.node())==null?void 0:V.getBBox().width)/2||0,s.selectAll("text").each(function(tt,wt,ze){window.getComputedStyle(ze[wt]).textAnchor==="middle"&&(z=0)})),C.attr("transform",`translate(${z}, ${I})`)});let v=s.select(".annotation-group").node().getBBox().height-(f?a/2:0)||0,$=s.select(".label-group").node().getBBox().height-(f?a/2:0)||0,P=s.select(".members-group").node().getBBox().height-(f?a/2:0)||0;if(o.members.length>0||o.methods.length>0||f){let R=p.line(w.x,v+$+x+a,w.x+w.width,v+$+x+a,u);s.insert(()=>R).attr("class","divider").attr("style",g)}if(f||o.members.length>0||o.methods.length>0){let R=p.line(w.x,v+$+P+x+e*2+a,w.x+w.width,v+$+P+x+a+e*2,u);s.insert(()=>R).attr("class","divider").attr("style",g)}if(o.look!=="handDrawn"&&s.selectAll("path").attr("style",g),k.select(":nth-child(2)").attr("style",g),s.selectAll(".divider").select("path").attr("style",g),t.labelStyle?s.selectAll("span").attr("style",t.labelStyle):s.selectAll("span").attr("style",g),!i){let R=RegExp(/color\s*:\s*([^;]*)/),_=R.exec(g);if(_){let D=_[0].replace("color","fill");s.selectAll("tspan").attr("style",D)}else if(l){let D=R.exec(l);if(D){let C=D[0].replace("color","fill");s.selectAll("tspan").attr("style",C)}}}return W(t,k),t.intersect=function(R){return L.rect(t,R)},s}S(Ee,"classBox");var Sa=S(n=>{switch(n){case"Very High":return"red";case"High":return"orange";case"Medium":return null;case"Low":return"blue";case"Very Low":return"lightblue"}},"colorFromPriority");async function Oe(n,t,{config:r}){var _,D;let{labelStyles:a,nodeStyles:e}=H(t);t.labelStyle=a||"";let i=10,o=t.width;t.width=(t.width??200)-10;let{shapeSvg:s,bbox:h,label:l}=await G(n,t,j(t)),c=t.padding||10,g="",f;"ticket"in t&&t.ticket&&((_=r==null?void 0:r.kanban)!=null&&_.ticketBaseUrl)&&(g=(D=r==null?void 0:r.kanban)==null?void 0:D.ticketBaseUrl.replace("#TICKET#",t.ticket),f=s.insert("svg:a",":first-child").attr("class","kanban-ticket-link").attr("xlink:href",g).attr("target","_blank"));let p={useHtmlLabels:t.useHtmlLabels,labelStyle:t.labelStyle||"",width:t.width,img:t.img,padding:t.padding||8,centerLabel:!1},u,y;f?{label:u,bbox:y}=await Kt(f,"ticket"in t&&t.ticket||"",p):{label:u,bbox:y}=await Kt(s,"ticket"in t&&t.ticket||"",p);let{label:d,bbox:m}=await Kt(s,"assigned"in t&&t.assigned||"",p);t.width=o;let x=10,b=(t==null?void 0:t.width)||0,k=Math.max(y.height,m.height)/2,w=Math.max(h.height+x*2,(t==null?void 0:t.height)||0)+k,v=-b/2,$=-w/2;l.attr("transform","translate("+(c-b/2)+", "+(-k-h.height/2)+")"),u.attr("transform","translate("+(c-b/2)+", "+(-k+h.height/2)+")"),d.attr("transform","translate("+(c+b/2-m.width-2*i)+", "+(-k+h.height/2)+")");let P,{rx:E,ry:A}=t,{cssStyles:R}=t;if(t.look==="handDrawn"){let C=M.svg(s),N=T(t,{}),B=E||A?C.path(at(v,$,b,w,E||0),N):C.rectangle(v,$,b,w,N);P=s.insert(()=>B,":first-child"),P.attr("class","basic label-container").attr("style",R||null)}else{P=s.insert("rect",":first-child"),P.attr("class","basic label-container __APA__").attr("style",e).attr("rx",E??5).attr("ry",A??5).attr("x",v).attr("y",$).attr("width",b).attr("height",w);let C="priority"in t&&t.priority;if(C){let N=s.append("line"),B=v+2,I=$+Math.floor((E??0)/2),z=$+w-Math.floor((E??0)/2);N.attr("x1",B).attr("y1",I).attr("x2",B).attr("y2",z).attr("stroke-width","4").attr("stroke",Sa(C))}}return W(t,P),t.height=w,t.intersect=function(C){return L.rect(t,C)},s}S(Oe,"kanbanItem");var Ma=[{semanticName:"Process",name:"Rectangle",shortName:"rect",description:"Standard process shape",aliases:["proc","process","rectangle"],internalAliases:["squareRect"],handler:Se},{semanticName:"Event",name:"Rounded Rectangle",shortName:"rounded",description:"Represents an event",aliases:["event"],internalAliases:["roundedRect"],handler:xe},{semanticName:"Terminal Point",name:"Stadium",shortName:"stadium",description:"Terminal point",aliases:["terminal","pill"],handler:Me},{semanticName:"Subprocess",name:"Framed Rectangle",shortName:"fr-rect",description:"Subprocess",aliases:["subprocess","subproc","framed-rectangle","subroutine"],handler:De},{semanticName:"Database",name:"Cylinder",shortName:"cyl",description:"Database storage",aliases:["db","database","cylinder"],handler:qs},{semanticName:"Start",name:"Circle",shortName:"circle",description:"Starting point",aliases:["circ"],handler:Es},{semanticName:"Decision",name:"Diamond",shortName:"diam",description:"Decision-making step",aliases:["decision","diamond","question"],handler:ye},{semanticName:"Prepare Conditional",name:"Hexagon",shortName:"hex",description:"Preparation or condition step",aliases:["hexagon","prepare"],handler:Us},{semanticName:"Data Input/Output",name:"Lean Right",shortName:"lean-r",description:"Represents input or output",aliases:["lean-right","in-out"],internalAliases:["lean_right"],handler:ce},{semanticName:"Data Input/Output",name:"Lean Left",shortName:"lean-l",description:"Represents output or input",aliases:["lean-left","out-in"],internalAliases:["lean_left"],handler:ne},{semanticName:"Priority Action",name:"Trapezoid Base Bottom",shortName:"trap-b",description:"Priority action",aliases:["priority","trapezoid-bottom","trapezoid"],handler:Le},{semanticName:"Manual Operation",name:"Trapezoid Base Top",shortName:"trap-t",description:"Represents a manual task",aliases:["manual","trapezoid-top","inv-trapezoid"],internalAliases:["inv_trapezoid"],handler:ie},{semanticName:"Stop",name:"Double Circle",shortName:"dbl-circ",description:"Represents a stop point",aliases:["double-circle"],internalAliases:["doublecircle"],handler:Ys},{semanticName:"Text Block",name:"Text Block",shortName:"text",description:"Text block",handler:Be},{semanticName:"Card",name:"Notched Rectangle",shortName:"notch-rect",description:"Represents a card",aliases:["card","notched-rectangle"],handler:Hs},{semanticName:"Lined/Shaded Process",name:"Lined Rectangle",shortName:"lin-rect",description:"Lined process shape",aliases:["lined-rectangle","lined-process","lin-proc","shaded-process"],handler:be},{semanticName:"Start",name:"Small Circle",shortName:"sm-circ",description:"Small starting point",aliases:["start","small-circle"],internalAliases:["stateStart"],handler:$e},{semanticName:"Stop",name:"Framed Circle",shortName:"fr-circ",description:"Stop point",aliases:["stop","framed-circle"],internalAliases:["stateEnd"],handler:ve},{semanticName:"Fork/Join",name:"Filled Rectangle",shortName:"fork",description:"Fork or join in process flow",aliases:["join"],internalAliases:["forkJoin"],handler:Qs},{semanticName:"Collate",name:"Hourglass",shortName:"hourglass",description:"Represents a collate operation",aliases:["hourglass","collate"],handler:Ks},{semanticName:"Comment",name:"Curly Brace",shortName:"brace",description:"Adds a comment",aliases:["comment","brace-l"],handler:zs},{semanticName:"Comment Right",name:"Curly Brace",shortName:"brace-r",description:"Adds a comment",handler:js},{semanticName:"Comment with braces on both sides",name:"Curly Braces",shortName:"braces",description:"Adds a comment",handler:Gs},{semanticName:"Com Link",name:"Lightning Bolt",shortName:"bolt",description:"Communication link",aliases:["com-link","lightning-bolt"],handler:oe},{semanticName:"Document",name:"Document",shortName:"doc",description:"Represents a document",aliases:["doc","document"],handler:Te},{semanticName:"Delay",name:"Half-Rounded Rectangle",shortName:"delay",description:"Represents a delay",aliases:["half-rounded-rectangle"],handler:Js},{semanticName:"Direct Access Storage",name:"Horizontal Cylinder",shortName:"h-cyl",description:"Direct access storage",aliases:["das","horizontal-cylinder"],handler:Re},{semanticName:"Disk Storage",name:"Lined Cylinder",shortName:"lin-cyl",description:"Disk storage",aliases:["disk","lined-cylinder"],handler:he},{semanticName:"Display",name:"Curved Trapezoid",shortName:"curv-trap",description:"Represents a display",aliases:["curved-trapezoid","display"],handler:Fs},{semanticName:"Divided Process",name:"Divided Rectangle",shortName:"div-rect",description:"Divided process shape",aliases:["div-proc","divided-rectangle","divided-process"],handler:Xs},{semanticName:"Extract",name:"Triangle",shortName:"tri",description:"Extraction process",aliases:["extract","triangle"],handler:Ae},{semanticName:"Internal Storage",name:"Window Pane",shortName:"win-pane",description:"Internal storage",aliases:["internal-storage","window-pane"],handler:He},{semanticName:"Junction",name:"Filled Circle",shortName:"f-circ",description:"Junction point",aliases:["junction","filled-circle"],handler:Vs},{semanticName:"Loop Limit",name:"Trapezoidal Pentagon",shortName:"notch-pent",description:"Loop limit step",aliases:["loop-limit","notched-pentagon"],handler:Ne},{semanticName:"Manual File",name:"Flipped Triangle",shortName:"flip-tri",description:"Manual file operation",aliases:["manual-file","flipped-triangle"],handler:Zs},{semanticName:"Manual Input",name:"Sloped Rectangle",shortName:"sl-rect",description:"Manual input step",aliases:["manual-input","sloped-rectangle"],handler:we},{semanticName:"Multi-Document",name:"Stacked Document",shortName:"docs",description:"Multiple documents",aliases:["documents","st-doc","stacked-document"],handler:fe},{semanticName:"Multi-Process",name:"Stacked Rectangle",shortName:"st-rect",description:"Multiple processes",aliases:["procs","processes","stacked-rectangle"],handler:pe},{semanticName:"Stored Data",name:"Bow Tie Rectangle",shortName:"bow-rect",description:"Stored data",aliases:["stored-data","bow-tie-rectangle"],handler:Ws},{semanticName:"Summary",name:"Crossed Circle",shortName:"cross-circ",description:"Summary",aliases:["summary","crossed-circle"],handler:_s},{semanticName:"Tagged Document",name:"Tagged Document",shortName:"tag-doc",description:"Tagged document",aliases:["tag-doc","tagged-document"],handler:Ce},{semanticName:"Tagged Process",name:"Tagged Rectangle",shortName:"tag-rect",description:"Tagged process",aliases:["tagged-rectangle","tag-proc","tagged-process"],handler:Pe},{semanticName:"Paper Tape",name:"Flag",shortName:"flag",description:"Paper tape",aliases:["paper-tape"],handler:We},{semanticName:"Odd",name:"Odd",shortName:"odd",description:"Odd shape",internalAliases:["rect_left_inv_arrow"],handler:me},{semanticName:"Lined Document",name:"Lined Document",shortName:"lin-doc",description:"Lined document",aliases:["lined-document"],handler:ge}],ka=S(()=>{let t=[...Object.entries({state:ke,choice:Is,note:ue,rectWithTitle:de,labelRect:le,iconSquare:ae,iconCircle:se,icon:te,iconRounded:ee,imageSquare:re,anchor:Ts,kanbanItem:Oe,classBox:Ee}),...Ma.flatMap(r=>[r.shortName,..."aliases"in r?r.aliases:[],..."internalAliases"in r?r.internalAliases:[]].map(e=>[e,r.handler]))];return Object.fromEntries(t)},"generateShapeMap"),_e=ka();function va(n){return n in _e}S(va,"isValidShape");var Lt=new Map;async function $a(n,t,r){let a,e;t.shape==="rect"&&(t.rx&&t.ry?t.shape="roundedRect":t.shape="squareRect");let i=t.shape?_e[t.shape]:void 0;if(!i)throw new Error(`No such shape: ${t.shape}. Please check your syntax.`);if(t.link){let o;r.config.securityLevel==="sandbox"?o="_top":t.linkTarget&&(o=t.linkTarget||"_blank"),a=n.insert("svg:a").attr("xlink:href",t.link).attr("target",o??null),e=await i(a,t,r)}else e=await i(n,t,r),a=e;return t.tooltip&&e.attr("title",t.tooltip),Lt.set(t.id,a),t.haveCallback&&a.attr("class",a.attr("class")+" clickable"),a}S($a,"insertNode");var zr=S((n,t)=>{Lt.set(t.id,n)},"setNodeElem"),jr=S(()=>{Lt.clear()},"clear"),Gr=S(n=>{let t=Lt.get(n.id);q.trace("Transforming node",n.diff,n,"translate("+(n.x-n.width/2-5)+", "+n.width/2+")");let r=8,a=n.diff||0;return n.clusterNode?t.attr("transform","translate("+(n.x+a-n.width/2)+", "+(n.y-n.height/2-r)+")"):t.attr("transform","translate("+n.x+", "+n.y+")"),a},"positionNode");export{M as a,G as b,W as c,ts as d,Ha as e,Ia as f,va as g,$a as h,zr as i,jr as j,Gr as k};
