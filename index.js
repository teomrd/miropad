var Ao=Object.create;var ye=Object.defineProperty;var No=Object.getOwnPropertyDescriptor;var Mo=Object.getOwnPropertyNames;var To=Object.getPrototypeOf,Po=Object.prototype.hasOwnProperty;var Io=(e,t,r)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var J=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Eo=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Mo(t))!Po.call(e,o)&&o!==r&&ye(e,o,{get:()=>t[o],enumerable:!(n=No(t,o))||n.enumerable});return e};var mn=(e,t,r)=>(r=e!=null?Ao(To(e)):{},Eo(t||!e||!e.__esModule?ye(r,"default",{value:e,enumerable:!0}):r,e));var B=(e,t,r)=>Io(e,typeof t!="symbol"?t+"":t,r);var _t=J(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.Warning=void 0;var Ee=class{constructor(t,r){this.message=t,typeof r=="number"?this.offset=r:r&&"line"in r&&(this.sourceLoc=r,this.offset=r.offset)}render(){let t=this.message;return this.sourceLoc?t+=` at line ${this.sourceLoc.line}, col ${this.sourceLoc.col}`:this.offset&&(t+=` at offset ${this.offset}`),t}};Kt.Warning=Ee});var Le=J(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.AttributeParser=void 0;var v;(function(e){e[e.SCANNING=0]="SCANNING",e[e.SCANNING_ID=1]="SCANNING_ID",e[e.SCANNING_CLASS=2]="SCANNING_CLASS",e[e.SCANNING_KEY=3]="SCANNING_KEY",e[e.SCANNING_VALUE=4]="SCANNING_VALUE",e[e.SCANNING_BARE_VALUE=5]="SCANNING_BARE_VALUE",e[e.SCANNING_QUOTED_VALUE=6]="SCANNING_QUOTED_VALUE",e[e.SCANNING_QUOTED_VALUE_CONTINUATION=7]="SCANNING_QUOTED_VALUE_CONTINUATION",e[e.SCANNING_ESCAPED=8]="SCANNING_ESCAPED",e[e.SCANNING_ESCAPED_IN_CONTINUATION=9]="SCANNING_ESCAPED_IN_CONTINUATION",e[e.SCANNING_COMMENT=10]="SCANNING_COMMENT",e[e.FAIL=11]="FAIL",e[e.DONE=12]="DONE",e[e.START=13]="START"})(v||(v={}));var xs=/^[a-zA-Z0-9_:-]/,ks=function(e){return xs.exec(e)!==null},H=[];H[v.START]=function(e,t){return e.subject.charAt(t)==="{"?v.SCANNING:v.FAIL};H[v.FAIL]=function(e,t){return v.FAIL};H[v.DONE]=function(e,t){return v.DONE};H[v.SCANNING]=function(e,t){let r=e.subject.charAt(t);return r===`
`||r==="\r"?v.SCANNING:r===" "||r==="	"?(e.addEvent(t,t,"attr_space"),v.SCANNING):r==="}"?v.DONE:r==="#"?(e.begin=t,e.addEvent(t,t,"attr_id_marker"),v.SCANNING_ID):r==="%"?(e.begin=t,v.SCANNING_COMMENT):r==="."?(e.begin=t,e.addEvent(t,t,"attr_class_marker"),v.SCANNING_CLASS):ks(r)?(e.begin=t,v.SCANNING_KEY):v.FAIL};H[v.SCANNING_COMMENT]=function(e,t){let r=e.subject.charAt(t);return r==="%"?(e.begin&&t>e.begin&&e.addEvent(e.begin,t,"comment"),v.SCANNING):r=="}"?v.DONE:v.SCANNING_COMMENT};H[v.SCANNING_ID]=function(e,t){let r=e.subject.charAt(t);return/^[^\]\[~!@#$%^&*(){}`,.<>\\|=+/?\s]/.exec(r)!==null?v.SCANNING_ID:r==="}"?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"id"),e.begin=null,v.DONE):/^\s/.exec(r)!==null?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"id"),r==="\r"||r===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_CLASS]=function(e,t){let r=e.subject.charAt(t);return/^\w/.exec(r)!==null||r==="_"||r==="-"||r===":"?v.SCANNING_CLASS:r==="}"?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"class"),e.begin=null,v.DONE):/^\s/.exec(r)!==null?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"class"),r==="\r"||r===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_KEY]=function(e,t){let r=e.subject.charAt(t);return r==="="&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"key"),e.addEvent(t,t,"attr_equal_marker"),e.begin=null,v.SCANNING_VALUE):/^[a-zA-Z0-9_:-]/.exec(r)!==null?v.SCANNING_KEY:v.FAIL};H[v.SCANNING_VALUE]=function(e,t){let r=e.subject.charAt(t);return r==='"'?(e.begin=t,e.addEvent(t,t,"attr_quote_marker"),v.SCANNING_QUOTED_VALUE):/^[a-zA-Z0-9_:-]/.exec(r)!==null?(e.begin=t,v.SCANNING_BARE_VALUE):v.FAIL};H[v.SCANNING_BARE_VALUE]=function(e,t){let r=e.subject.charAt(t);return/^[a-zA-Z0-9_:-]/.exec(r)!==null?v.SCANNING_BARE_VALUE:r==="}"&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"value"),e.begin=null,v.DONE):/^\s/.exec(r)&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"value"),r==="\r"||r===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_ESCAPED]=function(e,t){return v.SCANNING_QUOTED_VALUE};H[v.SCANNING_ESCAPED_IN_CONTINUATION]=function(e,t){return v.SCANNING_QUOTED_VALUE_CONTINUATION};H[v.SCANNING_QUOTED_VALUE]=function(e,t){let r=e.subject.charAt(t);return r==='"'&&e.begin&&e.lastpos?(e.addEvent(e.begin+1,e.lastpos,"value"),e.addEvent(t,t,"attr_quote_marker"),e.begin=null,v.SCANNING):r===`
`&&e.begin&&e.lastpos?(e.addEvent(e.begin+1,t,"value"),e.begin=null,v.SCANNING_QUOTED_VALUE_CONTINUATION):r==="\\"?v.SCANNING_ESCAPED:v.SCANNING_QUOTED_VALUE};H[v.SCANNING_QUOTED_VALUE_CONTINUATION]=function(e,t){let r=e.subject.charAt(t);return e.begin===null&&(e.begin=t),r==='"'&&e.begin&&e.lastpos?(e.addEvent(t,t,"attr_quote_marker"),e.addEvent(e.begin,e.lastpos,"value"),e.begin=null,v.SCANNING):r===`
`&&e.begin&&e.lastpos?(e.addEvent(e.begin,t,"value"),e.begin=null,v.SCANNING_QUOTED_VALUE_CONTINUATION):r==="\\"?v.SCANNING_ESCAPED_IN_CONTINUATION:v.SCANNING_QUOTED_VALUE_CONTINUATION};var De=class{constructor(t){this.subject=t,this.state=v.START,this.begin=null,this.lastpos=null,this.matches=[]}addEvent(t,r,n){this.matches.push({startpos:t,endpos:r,annot:n})}feed(t,r){let n=t;for(;n<=r;){if(this.state=H[this.state](this,n),this.state===v.DONE)return{status:"done",position:n};if(this.state===v.FAIL)return this.lastpos=n,{status:"fail",position:n};this.lastpos=n,n=n+1}return{status:"continue",position:r}}};Qt.AttributeParser=De});var Oe=J(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.find=St.pattern=void 0;var vs=function(e){return new RegExp(e,"yd")};St.pattern=vs;var Cs=function(e,t,r,n){t.lastIndex=r;let o;n!==void 0?o=e.substring(0,n+1):o=e;let s=t.exec(o);if(s!==null){let i=1,c=[];if(s.indices.length>1)for(let d=1;d<s.indices.length;d++){let[h,g]=s.indices[d];c.push(o.substring(h,g))}return{startpos:s.indices[0][0],endpos:s.indices[0][1]-1,captures:c}}else return null};St.find=Cs});var lr=J(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.InlineParser=void 0;var _s=Le(),Ss=_t(),j=Oe(),nr=9,Ue=10,Ve=13,ze=32,rr=33,or=34,sr=39,Be=40,As=41,Ns=42,Ms=43,je=45,Ts=46,Ps=58,Is=60,Es=61,Ge=91,Fe=92,Ds=93,Ls=94,Os=95,zs=96,Xt=123,Zt=125,Bs=126,ir=/[\r\n"'()*+.:<=[\\\]^_`${}~-]/g,ar=function(e,t,r){ir.lastIndex=t;let n=ir.exec(e);return n&&n.index<=r?n.index:null},cr=(0,j.pattern)(`[^ 	\r
]`),js=(0,j.pattern)("[ \\t]*\\r?\\n"),Gs=(0,j.pattern)("['!\"#$%&\\\\'()\\*+,\\-\\.\\/:;<=>?@\\[\\]\\^_`{|}~']"),Fs=(0,j.pattern)("\\<([^<>\\s]+)\\>"),$s=(0,j.pattern)(`[_*~^+='"-]`),Us=(0,j.pattern)(":[\\w_+-]+:"),Vs=(0,j.pattern)("\\.\\."),Rs=(0,j.pattern)("`*"),qs=(0,j.pattern)("`+"),Ws=(0,j.pattern)("\\$\\$"),Hs=(0,j.pattern)("\\$"),Js=(0,j.pattern)("\\\\"),Ys=(0,j.pattern)("\\{=[^\\s{}`]+\\}"),Ks=(0,j.pattern)("\\^([^\\]]+)\\]"),$e=function(e,t){return t>0&&e.subject.codePointAt(t-1)===Xt||e.subject.codePointAt(t+1)===Zt},Lt=function(){return!0},lt=function(e,t,r,n){return function(o,s,i){let c=o.subject,d=(0,j.find)(c,cr,s+1)!==null&&n(o,s),h=(0,j.find)(c,cr,s-1)!==null,g=o.matches[o.matches.length-1],k=g&&g.annot==="open_marker",A=s+1<=i&&c.codePointAt(s+1)===Zt,I=s,M=s;k&&(d=!0,h=!1,M=s-1),!k&&A&&(h=!0,d=!1,I=s+1),k&&r.match(/^right/)?r=r.replace(/^right/,"left"):A&&r.match(/^left/)&&(r=r.replace(/^left/,"right"));let z=e;A&&(z="{"+z);let S=o.openers[z];if(h&&S&&S.length>0){let w=S[S.length-1];if(w.endpos!==s-1)return o.clearOpeners(w.startpos,s),o.addMatch(w.startpos,w.endpos,"+"+t,w.matchIndex),o.addMatch(s,I,"-"+t),I+1}if(d){let w=e;return k&&(w="{"+w),o.addOpener(w,M,s,r),s+1}else return o.addMatch(s,I,r),I+1}},Qs={[zs]:function(e,t,r){let n=e.subject,o=(0,j.find)(n,Rs,t,r);if(o===null)return null;let s=o.endpos;return(0,j.find)(n,Ws,t-2)&&!(0,j.find)(n,Js,t-3)?(e.matches.pop(),e.matches.pop(),e.addMatch(t-2,s,"+display_math"),e.verbatimType="display_math"):(0,j.find)(n,Hs,t-1)?(e.matches.pop(),e.addMatch(t-1,s,"+inline_math"),e.verbatimType="inline_math"):(e.addMatch(t,s,"+verbatim"),e.verbatimType="verbatim"),e.verbatim=s-t+1,s+1},[Fe]:function(e,t,r){let n=e.subject,o=(0,j.find)(n,js,t+1,r);if(o!==null){if(e.matches.length>0){let s=e.matches[e.matches.length-1];if(s.annot==="str"){let i=s.endpos,c=s.startpos;for(;i>=c&&(n.codePointAt(i)===ze||n.codePointAt(i)===nr);)i=i-1;i<c?e.matches.pop():s.endpos=i}}return e.addMatch(t,t,"escape"),e.addMatch(t+1,o.endpos,"hard_break"),o.endpos+1}else{let s=(0,j.find)(n,Gs,t+1,r);return s!==null?(e.addMatch(t,t,"escape"),e.addMatch(s.startpos,s.endpos,"str"),s.endpos+1):t+1<=r&&n.codePointAt(t+1)===ze?(e.addMatch(t,t,"escape"),e.addMatch(t+1,t+1,"non_breaking_space"),t+2):(e.addMatch(t,t,"str"),t+1)}},[Is]:function(e,t,r){let n=e.subject,o=(0,j.find)(n,Fs,t,r);if(o===null)return null;let s=o.endpos,i=o.startpos,c=o.captures[0];return c.match(/[^:]@/)?(e.addMatch(i,i,"+email"),e.addMatch(i+1,s-1,"str"),e.addMatch(s,s,"-email"),s+1):c.match(/[a-zA-Z]:/)?(e.addMatch(i,i,"+url"),e.addMatch(i+1,s-1,"str"),e.addMatch(s,s,"-url"),s+1):null},[Bs]:lt("~","subscript","str",Lt),[Ls]:lt("^","superscript","str",Lt),[Os]:lt("_","emph","str",Lt),[Ns]:lt("*","strong","str",Lt),[Ms]:lt("+","insert","str",$e),[Es]:lt("=","mark","str",$e),[sr]:lt("'","single_quoted","right_single_quote",function(e,t){if(t===0)return!0;{let r=e.subject.codePointAt(t-1);return r===ze||r===nr||r===Ve||r===Ue||r===or||r===sr||r===je||r===Be||r===Ge}}),[or]:lt('"',"double_quoted","left_double_quote",Lt),[Xt]:function(e,t,r){return(0,j.find)(e.subject,$s,t+1,r)?(e.addMatch(t,t,"open_marker"),t+1):e.allowAttributes?(e.attributeParser=new _s.AttributeParser(e.subject),e.attributeStart=t,e.attributeSlices=[],t):(e.addMatch(t,t,"str"),t+1)},[Ps]:function(e,t,r){let n=(0,j.find)(e.subject,Us,t,r);return n?(e.addMatch(n.startpos,n.endpos,"symb"),n.endpos+1):(e.addMatch(t,t,"str"),t+1)},[Ts]:function(e,t,r){return(0,j.find)(e.subject,Vs,t+1,r)?(e.addMatch(t,t+2,"ellipses"),t+3):null},[Ge]:function(e,t,r){let n=(0,j.find)(e.subject,Ks,t+1,r);return n?(e.addMatch(t,n.endpos,"footnote_reference"),n.endpos+1):(e.addOpener("[",t,t,"str"),t+1)},[Ds]:function(e,t,r){let n=e.openers["["],o=e.subject;if(n&&n.length>0){let s=n[n.length-1];if(s.annot==="reference_link")return e.strMatches((s.subendpos||s.endpos)+1,t-1),o.codePointAt(s.startpos-1)===rr&&o.codePointAt(s.startpos-2)!==Fe?(e.addMatch(s.startpos-1,s.startpos-1,"image_marker",s.matchIndex-1),e.addMatch(s.startpos,s.endpos,"+imagetext",s.matchIndex),e.addMatch(s.substartpos||s.startpos,s.substartpos||s.startpos,"-imagetext",s.subMatchIndex)):(e.addMatch(s.startpos,s.endpos,"+linktext",s.matchIndex),e.addMatch(s.substartpos||s.startpos,s.substartpos||s.startpos,"-linktext",s.subMatchIndex)),e.addMatch(s.subendpos||s.endpos,s.subendpos||s.endpos,"+reference",s.subMatchIndex+1),e.addMatch(t,t,"-reference"),e.clearOpeners(s.startpos,t),t+1;if(t+1<=r&&o.codePointAt(t+1)===Ge)return s.annot="reference_link",e.addMatch(t,t,"str"),s.subMatchIndex=e.matches.length-1,e.addMatch(t+1,t+1,"str"),s.substartpos=t,s.subendpos=t+1,e.clearOpeners(s.startpos+1,t-1),t+2;if(t+1<=r&&o.codePointAt(t+1)===Be)return e.openers["("]=[],s.annot="explicit_link",e.addMatch(t,t,"str"),s.subMatchIndex=e.matches.length-1,e.addMatch(t+1,t+1,"str"),s.substartpos=t,s.subendpos=t+1,e.destination=!0,e.clearOpeners(s.startpos+1,t-1),t+2;if(t+1<=r&&o.codePointAt(t+1)===Xt)return e.addMatch(s.startpos,s.endpos,"+span",s.matchIndex),e.addMatch(t,t,"-span"),e.clearOpeners(s.startpos,t),t+1}return null},[Be]:function(e,t,r){return e.destination?(e.addOpener("(",t,t,"str"),t+1):null},[As]:function(e,t,r){if(!e.destination)return null;let n=e.openers["("];if(n&&n.length>0)return n.pop(),e.addMatch(t,t,"str"),t+1;{let o=e.subject,s=e.openers["["],i=s[s.length-1];if(s&&s.length>0&&i.annot==="explicit_link")return e.strMatches((i.subendpos||i.endpos)+1,t-1),o.codePointAt(i.startpos-1)===rr&&o.codePointAt(i.startpos-2)!==Fe?(e.addMatch(i.startpos-1,i.startpos-1,"image_marker",i.matchIndex-1),e.addMatch(i.startpos,i.endpos,"+imagetext",i.matchIndex),e.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-imagetext",i.subMatchIndex)):(e.addMatch(i.startpos,i.endpos,"+linktext",i.matchIndex),e.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-linktext",i.subMatchIndex)),e.addMatch(i.subendpos||i.endpos,i.subendpos||i.endpos,"+destination",i.subMatchIndex+1),e.addMatch(t,t,"-destination"),e.destination=!1,e.clearOpeners(i.startpos,t),t+1}return null},[je]:function(e,t,r){let n=e.subject;if(n.codePointAt(t-1)===Xt||n.codePointAt(t+1)===Zt){let d=lt("-","delete","str",$e)(e,t,r);if(d)return d}let o=t,s=0;for(;o<=r&&n.codePointAt(o)===je;)o++,s++;if(n.codePointAt(o)===Zt&&s--,s===0)return e.addMatch(t,t+1,"str"),t+2;let i=s%3===0,c=s%2===0;for(;s>0;)i?(e.addMatch(t,t+2,"em_dash"),t=t+3,s=s-3):c?(e.addMatch(t,t+1,"en_dash"),t=t+2,s=s-2):s>=3&&(s%2!==0||s>4)?(e.addMatch(t,t+2,"em_dash"),t=t+3,s=s-3):s>=2?(e.addMatch(t,t+1,"en_dash"),t=t+2,s=s-2):(e.addMatch(t,t,"str"),t=t+1,s=s-1);return t}},Re=class{constructor(t,r={}){this.options=r,this.warn=r.warn||(()=>{}),this.subject=t,this.matches=[],this.openers={},this.verbatim=0,this.verbatimType="",this.destination=!1,this.firstpos=-1,this.lastpos=0,this.allowAttributes=!0,this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,this.matchers=Qs}addMatch(t,r,n,o){let s={startpos:t,endpos:r,annot:n};o!==void 0?this.matches.splice(o,1,s):this.matches.push(s)}inVerbatim(){return this.verbatim>0}singleChar(t){return this.addMatch(t,t,"str"),t+1}reparseAttributes(){let t=this.attributeSlices;if(t!==null){if(this.allowAttributes=!1,this.attributeParser=null,this.attributeStart=null,t!==null)for(let r of t)this.feed(r.startpos,r.endpos);this.allowAttributes=!0,this.attributeSlices=null}}getMatches(){let t=this.subject;this.attributeParser&&this.reparseAttributes();let r=this.matches.length-1;if(this.matches[r]&&this.matches[r].annot==="soft_break"){this.matches.pop();let n=this.matches[this.matches.length-1];if(n&&n.annot==="str"&&t.codePointAt(n.endpos)===32){for(;n.endpos>=n.startpos&&t.codePointAt(n.endpos)===32;)n.endpos=n.endpos-1;n.endpos<n.startpos&&this.matches.pop()}}if(this.matches.length>0&&this.verbatim>0){let n=this.matches[this.matches.length-1];this.warn(new Ss.Warning("Unclosed verbatim",n.endpos)),this.matches.push({startpos:n.endpos,endpos:n.endpos,annot:"-"+this.verbatimType})}return this.matches}addOpener(t,r,n,o){this.openers[t]||(this.openers[t]=[]),this.openers[t].push({matchIndex:this.matches.length,startpos:r,endpos:n,annot:null,subMatchIndex:this.matches.length,substartpos:null,subendpos:null}),this.addMatch(r,n,o)}clearOpeners(t,r){for(let n in this.openers){let o=this.openers[n],s=o.length-1;for(;o[s];){let i=o[s];if(i.startpos>=t&&i.endpos<=r)o.splice(s,1);else if(i.substartpos&&i.substartpos>=t&&i.subendpos&&i.subendpos<=r)o[s].substartpos=null,o[s].subendpos=null,o[s].annot=null;else break;s--}}}strMatches(t,r){let n=this.matches.length-1;for(;n>0&&this.matches[n].startpos>=t;)n--;for(this.matches[n].startpos<t&&n++;this.matches[n]&&this.matches[n].endpos<=r;){let o=this.matches[n];o.annot!=="escape"&&o.annot!=="str"&&(o.annot="str"),n++}}feed(t,r){let n=this.subject;(this.firstpos===-1||t<this.firstpos)&&(this.firstpos=t),(this.lastpos===0||r>this.lastpos)&&(this.lastpos=r);let o=t;for(;o<=r;)if(this.attributeParser!==null){let s=o,i=ar(n,o,r),c;i===null?c=r:c=i;let d=this.attributeParser.feed(s,c),h=d.position;if(d.status==="done"){let g=this.attributeStart;g!==null&&this.addMatch(g,g,"+attributes");let k=this.attributeParser.matches;for(let A of k)this.addMatch(A.startpos,A.endpos,A.annot);this.addMatch(h,h,"-attributes"),this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,o=h+1}else d.status==="fail"?(this.reparseAttributes(),o=s):d.status==="continue"&&(this.attributeSlices===null&&(this.attributeSlices=[]),this.attributeSlices.push({startpos:s,endpos:h}),o=h+1)}else{let s=ar(n,o,r),i;if(s===null?i=r+1:i=s,i>o&&(this.addMatch(o,i-1,"str"),o=i,o>r))break;let c=n.codePointAt(o);if(c===void 0)throw new Error("Code point at "+o+" is undefined.");if(c===Ve||c===Ue)c===Ve&&n.codePointAt(o+1)===Ue&&o+1<=r?(this.addMatch(o,o+1,"soft_break"),o=o+2):(this.addMatch(o,o,"soft_break"),o=o+1);else if(this.verbatim>0)if(c===96){let d=(0,j.find)(n,qs,o,r);if(d){let h=d.endpos;if(d.endpos-o+1===this.verbatim){let g=(0,j.find)(n,Ys,h+1,r);g&&this.verbatimType==="verbatim"?(this.addMatch(o,h,"-"+this.verbatimType),this.addMatch(g.startpos,g.endpos,"raw_format"),o=g.endpos+1):(this.addMatch(o,h,"-"+this.verbatimType),o=h+1),this.verbatim=0,this.verbatimType="verbatim"}else this.addMatch(o,h,"str"),o=h+1}else this.addMatch(o,r,"str"),o=r+1}else this.addMatch(o,o,"str"),o=o+1;else{let d=this.matchers[c];if(d){let h=d(this,o,r);h===null?o=this.singleChar(o):o=h}else o=this.singleChar(o)}}}};te.InlineParser=Re});var Ke=J(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.parseEvents=void 0;var dr=_t(),Xs=Le(),G=Oe(),qe=lr(),We=function(e){return e==="+"||e==="-"||e==="*"||e===":"?[e]:/^[+*-] \[[Xx ]\]/.exec(e)?["X"]:/^[(]?[0-9]+[).]/.exec(e)?[e.replace(/[0-9]+/,"1")]:/^[(]?[ivxlcdm][).]/.exec(e)?[e.replace(/[a-z]+/,"i"),e.replace(/[a-z]+/,"a")]:/^[(]?[IVXLCDM][).]/.exec(e)?[e.replace(/[A-Z]+/,"I"),e.replace(/[A-Z]+/,"A")]:/^[(]?[ivxlcdm]+[).]/.exec(e)?[e.replace(/[a-z]+/,"i")]:/^[(]?[IVXLCDM]+[).]/.exec(e)?[e.replace(/[A-Z]+/,"I")]:/^[(]?[a-z][).]/.exec(e)?[e.replace(/[a-z]/,"a")]:/^[(]?[A-Z][).]/.exec(e)?[e.replace(/[A-Z]/,"A")]:[]},Zs=function(e){return e===32||e===9},ti=function(e){return e===10||e===13},hr=(0,G.pattern)("[ \\t]*\\r?\\n"),ei=(0,G.pattern)("^\\w+\\s"),ee=(0,G.pattern)("[ \\t\\r\\n]"),ni=(0,G.pattern)("[^ \\t\\r\\n]+"),ur=(0,G.pattern)("[>][ \\t\\r\\n]"),pr=(0,G.pattern)("#+"),ri=(0,G.pattern)("(~~~~*|````*)([ \\t]*)([^ \\t\\r\\n`]*)[ \\t]*\\r?\\n"),oi=(0,G.pattern)("(:?)--*(:?)([ \\t]*\\|[ \\t]*)"),si=(0,G.pattern)("[^`|\\r\\n]*(?:[|]|`+)"),ii=(0,G.pattern)("\\^[ \\t]+"),ai=(0,G.pattern)("\\[\\^([^\\]]+)\\]:[ \\t\\r\\n]"),ci=(0,G.pattern)("[-*][ 	]*[-*][ \\t]*[-*][-* \\t]*\\r?\\n"),li=(0,G.pattern)("(::::*)[ \\t]*\\r?\\n"),di=(0,G.pattern)("(::::*)[ \\t]*"),hi=(0,G.pattern)("([\\w_-]*)[ \\t]*\\r?\\n"),ui=(0,G.pattern)("\\[([^\\]\\r\\n]*)\\]:[ \\t]*([^ \\t\\r\\n]*)[\\r\\n]"),fr=(0,G.pattern)("(\\|[^\\r\\n]*\\|)[ \\t]*\\r?\\n"),He=(0,G.pattern)("(:?[-*+:]|\\([0-9]+\\)|[0-9]+[.)]|[ivxlcdmIVXLCDM]+[.)]|\\([ivxlcdmIVXLCDM]+\\)|[a-zA-Z][.)]|\\([a-zA-Z]\\))[ \\t\\r\\n]"),Je=(0,G.pattern)("[*+-] \\[[Xx ]\\][ \\t\\r\\n]"),P;(function(e){e[e.None=0]="None",e[e.Inline=1]="Inline",e[e.Block=2]="Block",e[e.Text=3]="Text",e[e.Cells=4]="Cells",e[e.Attributes=5]="Attributes",e[e.ListItem=6]="ListItem"})(P||(P={}));var R=class{constructor(t,r){this.name=t.name,this.type=t.type,this.content=t.content,this.continue=t.continue,this.close=t.close,this.indent=0,this.inlineParser=null,this.attributeParser=null,this.extra=r}},Ye=class{constructor(t,r={}){t.charAt(t.length-1)!==`
`&&(t=t+`
`),this.subject=t,this.maxoffset=t.length-1,this.options=r,this.warn=r.warn||(()=>{}),this.indent=0,this.startline=0,this.starteol=0,this.endeol=0,this.matches=[],this.containers=[],this.pos=0,this.lastMatchedContainer=0,this.finishedLine=!1,this.returned=0,this.paraSpec={name:"para",type:P.Block,content:P.Inline,continue:n=>this.find(ee)===null,open:n=>(this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+para"),!0),close:()=>{this.getInlineMatches(),this.containers.pop();let n=this.matches[this.matches.length-1],o=n&&n.endpos+1||this.pos;this.addMatch(o,o,"-para")}},this.specs=[{name:"block_quote",type:P.Block,content:P.Block,continue:n=>this.find(ur)!==null?(this.pos=this.pos+1,!0):!1,open:n=>this.find(ur)!==null?(this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+block_quote"),this.pos=this.pos+1,!0):!1,close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-block_quote")}},{name:"heading",type:P.Block,content:P.Inline,continue:n=>{let o=this.find(pr);return o&&n.extra.level===o.endpos-o.startpos+1&&(0,G.find)(this.subject,ee,o.endpos+1)?(this.pos=o.endpos+1,!0):!1},open:n=>{let o=this.find(pr);if(o&&(0,G.find)(this.subject,ee,o.endpos+1)){let s=o.endpos-o.startpos+1;return this.addContainer(new R(n,{level:s})),this.addMatch(o.startpos,o.endpos,"+heading"),this.pos=o.endpos+1,!0}else return!1},close:()=>{this.getInlineMatches(),this.containers.pop();let n=this.matches[this.matches.length-1],o=n&&n.endpos+1||this.pos;this.addMatch(o,o,"-heading")}},{name:"caption",type:P.Block,content:P.Inline,continue:n=>(0,G.find)(this.subject,ee,this.pos)===null,open:n=>{let o=this.find(ii);return o?(this.pos=o.endpos+1,this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+caption"),!0):!1},close:()=>{this.getInlineMatches(),this.containers.pop(),this.addMatch(this.pos-1,this.pos-1,"-caption")}},{name:"footnote",type:P.Block,content:P.Block,continue:n=>this.indent>(n.extra.indent||0)||this.pos===this.starteol,open:n=>{let o=this.find(ai);if(o){let s=o.startpos,i=o.endpos,c=o.captures[0];return this.addContainer(new R(n,{note_label:c,indent:this.indent})),this.addMatch(s,s,"+footnote"),this.addMatch(s+2,i-3,"note_label"),this.pos=i,!0}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-footnote")}},{name:"reference_definition",type:P.Block,content:P.None,continue:n=>{if(n.extra.indent>=this.indent)return!1;let o=this.find(ni);return this.pos<this.starteol&&o&&o.endpos===this.starteol-1?(this.addMatch(this.pos,this.starteol-1,"reference_value"),this.pos=this.starteol,!0):!1},open:n=>{let o=this.find(ui);if(o){let s=o.captures[0],i=o.captures[1];return this.addContainer(new R(n,{key:s,indent:this.indent})),this.addMatch(o.startpos,o.startpos,"+reference_definition"),this.addMatch(o.startpos,o.startpos+s.length+1,"reference_key"),i.length>0&&this.addMatch(this.starteol-i.length,this.starteol-1,"reference_value"),this.pos=this.starteol-1,!0}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-reference_definition")}},{name:"thematic_break",type:P.Block,content:P.None,continue:n=>!1,open:n=>{let o=this.find(ci);return o?(this.addContainer(new R(n,{})),this.addMatch(o.startpos,o.endpos,"thematic_break"),this.pos=o.endpos,!0):!1},close:()=>{this.containers.pop()}},{name:"list",type:P.Block,content:P.ListItem,continue:n=>{if(this.indent>n.extra.indent||this.pos===this.starteol)return!0;{let o=this.find(He);if(o===null)return!1;let s=this.subject.substring(o.startpos,o.endpos),i=this.find(Je);i!==null&&(s=this.subject.substring(i.startpos,i.startpos+5));let c=We(s),d=[];for(let h of n.extra.styles)c.includes(h)&&d.push(h);if(d.length>0)return n.extra.styles=d,!0}return!1},open:n=>{let o=this.find(He);if(o===null)return!1;let s=o.startpos,i=o.endpos,c=this.subject.substring(s,i),d=this.find(Je);d!==null&&(c=this.subject.substring(d.startpos,d.startpos+5));let h=We(c);if(h.length===0)return!1;let g={styles:h,indent:this.indent};this.addContainer(new R(n,g));let k="+list";for(let A of h)k=k+"|"+A;return this.addMatch(s,i-1,k),!0},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-list")}},{name:"list_item",type:P.ListItem,content:P.Block,continue:n=>this.indent>n.extra.indent||this.pos===this.starteol,open:n=>{let o=this.find(He);if(o===null)return!1;let s=o.startpos,i=o.endpos,c=this.subject.substring(s,i),d=null,h=this.find(Je);h!==null&&(c=this.subject.substring(h.startpos,h.startpos+5),d=this.subject.substring(h.startpos+3,h.startpos+4));let g=We(c);if(g.length===0)return!1;let k={styles:g,indent:this.indent};this.addContainer(new R(n,k));let A="+list_item";for(let I of g)A=A+"|"+I;return this.addMatch(s,i-1,A),this.pos=i,d&&(d===" "?this.addMatch(s+2,s+4,"checkbox_unchecked"):this.addMatch(s+2,s+4,"checkbox_checked"),this.pos=s+5),!0},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-list_item")}},{name:"table",type:P.Block,content:P.Cells,continue:n=>{let o=this.find(fr);if(o){let s=o.captures[0];return this.parseTableRow(o.startpos,o.startpos+s.length-1)}else return!1},open:n=>{let o=this.find(fr);if(o){this.addContainer(new R(n,{columns:0}));let s=o.captures[0];return this.addMatch(o.startpos,o.startpos,"+table"),this.parseTableRow(o.startpos,o.startpos+s.length-1)?!0:(this.matches.pop(),this.containers.pop(),!1)}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-table")}},{name:"attributes",type:P.Block,content:P.Attributes,open:n=>{if(this.subject.codePointAt(this.pos)===123){let o=new Xs.AttributeParser(this.subject),s=o.feed(this.pos,this.starteol);if(s.status==="fail")return!1;if(s.status==="done"&&(0,G.find)(this.subject,hr,s.position+1)===null)return!1;{let i=this.addContainer(new R(n,{status:s.status,indent:this.indent,startpos:this.pos,slices:[]}));return i.attributeParser=o,i.extra.slices=[{startpos:this.pos,endpos:this.starteol}],this.pos=this.starteol,!0}}else return!1},continue:n=>{if(n.extra.status==="done")return!1;if(n.attributeParser&&this.indent>n.extra.indent){n.extra.slices.push({startpos:this.pos,endpos:this.starteol});let i=n.attributeParser.feed(this.pos,this.endeol);if(n.extra.status=i.status,i.status!=="fail"||!(0,G.find)(this.subject,hr,i.position+1))return this.pos=this.starteol,!0}this.addMatch(n.extra.startpos,n.extra.startpos,"+para");let o=this.containers.pop(),s=this.addContainer(new R(this.paraSpec,{}));if(!s.inlineParser||!o)throw new Error("Missing inlineParser or attrContainer");return s.inlineParser.attributeSlices=o.extra.slices,s.inlineParser.reparseAttributes(),this.pos=s.inlineParser.lastpos+1,!0},close:()=>{let n=this.containers.pop();if(n)if(n.extra.status==="continue"){this.addMatch(n.extra.startpos,n.extra.startpos,"+para");let o=this.addContainer(new R(this.paraSpec,{}),!0);if(!o||!o.inlineParser)throw new Error("Could not add paragraph");o.inlineParser.attributeSlices=n.extra.slices,o.inlineParser.reparseAttributes(),o.close()}else{if(this.addMatch(n.extra.startpos,n.extra.startpos,"+block_attributes"),n.attributeParser){let o=n.attributeParser.matches;for(let s of o)this.matches.push(s)}this.addMatch(this.pos,this.pos,"-block_attributes")}}},{name:"fenced_div",type:P.Block,content:P.Block,continue:n=>{let o=this.tip();if(o&&o.name==="code_block")return!0;let s=this.find(li);if(s&&n.extra.colons){let i=s.captures[0];if(i.length>=n.extra.colons)return n.extra.endFenceStartpos=s.startpos,n.extra.endFenceEndpos=s.startpos+i.length-1,this.pos=s.endpos,!1}return!0},open:n=>{let o=this.find(di);if(!o)return!1;let s=o.captures[0],i=(0,G.find)(this.subject,hi,o.endpos+1);if(!i)return!1;let c=i.startpos,d=i.captures[0];return this.addContainer(new R(n,{colons:s.length})),this.addMatch(o.startpos,o.endpos,"+div"),d.length>0&&this.addMatch(c,c+d.length-1,"class"),this.pos=i.endpos+1,this.finishedLine=!0,!0},close:()=>{let n=this.containers.pop();if(!n)return;let o=n.extra.endFenceStartpos||this.pos,s=n.extra.endFenceEndpos||this.pos;this.addMatch(o,s,"-div"),o===s&&this.warn(new dr.Warning("Unclosed div",this.pos))}},{name:"code_block",type:P.Block,content:P.Text,continue:n=>{let o=this.find(n.extra.closePattern);return o?(n.extra.endFenceStartpos=o.startpos,n.extra.endFenceEndpos=o.startpos+o.captures[0].length-1,this.pos=o.endpos,this.finishedLine=!0,!1):!0},open:n=>{let o=this.find(ri);if(o){let[s,i,c]=o.captures,d=c.charAt(0)==="="&&!0||!1,h=(0,G.pattern)("("+s+s.substring(0,1)+"*)[ \\t]*[\\r\\n]"),g=this.addContainer(new R(n,{closePattern:h}));if(g.indent=this.indent,this.addMatch(o.startpos,o.startpos+s.length-1,"+code_block"),c.length>0){let k=o.startpos+s.length+i.length;d?this.addMatch(k,k+c.length-1,"raw_format"):this.addMatch(k,k+c.length-1,"code_language")}return this.pos=o.endpos,this.finishedLine=!0,!0}else return!1},close:()=>{let n=this.containers.pop();if(!n)return;let o=n.extra.endFenceStartpos||this.pos,s=n.extra.endFenceEndpos||this.pos;this.addMatch(o,s,"-code_block"),o===s&&this.warn(new dr.Warning("Unclosed code block",this.pos))}}]}find(t){return(0,G.find)(this.subject,t,this.pos)}tip(){return this.containers.length>=1?this.containers[this.containers.length-1]:null}addMatch(t,r,n){this.matches.push({startpos:Math.min(t,this.maxoffset),endpos:Math.min(r,this.maxoffset),annot:n})}getInlineMatches(){var t;let r=(t=this.tip())===null||t===void 0?void 0:t.inlineParser;if(r){let n;for(let o of r.getMatches())n&&n.annot==="str"&&o.annot==="str"&&o.startpos===n.endpos+1?this.matches[this.matches.length-1].endpos=o.endpos:this.matches.push(o),n=o}}closeUnmatchedContainers(){let t=this.lastMatchedContainer,r=this.tip();for(;r&&this.containers.length-1>t;)r.close(),r=this.tip()}addContainer(t,r){r||this.closeUnmatchedContainers();let n=this.tip();for(;n&&n.content!==t.type;)n.close(),n=this.tip();return t.content===P.Inline&&(t.inlineParser=new qe.InlineParser(this.subject,{warn:this.warn})),this.containers.push(t),t}skipSpace(){let t=this.subject,r=this.pos;for(;Zs(t.codePointAt(r));)r++;this.indent=r-this.startline,this.pos=r}getEol(){let t=this.subject,r=this.pos;for(;!ti(t.codePointAt(r));)r++;this.starteol=r,t.codePointAt(r)===13&&t.codePointAt(r+1)===10?this.endeol=r+1:this.endeol=r}parseTableCell(){let t=new qe.InlineParser(this.subject,{warn:this.warn}),r=!1,n=this.pos-1,o=n;for(this.skipSpace();!r;){let s=this.find(si);if(s===null){r=!1;break}else{let i=s.endpos;this.subject.charAt(i)==="`"||t.inVerbatim()?t.feed(this.pos,i):this.subject.charAt(i-1)==="\\"?t.feed(this.pos,i):(t.feed(this.pos,i-1),o=i,r=!0),this.pos=i+1}}if(r){let s=t.getMatches();return{startpos:n,endpos:o,matches:s}}else return null}parseTableRow(t,r){let n=this.matches.length,o=this.pos;this.addMatch(t,t,"+row"),this.pos++;let s=[],i=this.pos,c=!1;for(;!c;){let d=(0,G.find)(this.subject,oi,i);if(d!==null){let[h,g,k]=d.captures,A="separator_default";if(h.length>0&&g.length>0?A="separator_center":g.length>0?A="separator_right":h.length>0&&(A="separator_left"),s.push({startpos:d.startpos,endpos:d.endpos-k.length,annot:A}),i=d.endpos+1,i===this.starteol){c=!0;break}}else break}if(c){for(let d of s)this.addMatch(d.startpos,d.endpos,d.annot);return this.addMatch(this.starteol-1,this.starteol-1,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}for(;this.pos<=r;){let d=this.parseTableCell();if(d!==null){this.addMatch(d.startpos,d.startpos,"+cell");let h=d.matches;h.forEach((g,k)=>{let A=g.startpos,I=g.endpos;if(k===h.length-1&&g.annot==="str")for(;this.subject.codePointAt(I)===32&&I>=A;)I=I-1;this.addMatch(A,I,g.annot)}),this.addMatch(d.endpos,d.endpos,"-cell")}else{for(this.pos=o;this.matches.length>n;)this.matches.pop();return!1}}return this.addMatch(this.pos,this.pos,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}[Symbol.iterator](){let t=this.specs,r=this.subject.length;this.returned=0;let n=this;return{next(){for(;n.pos<r;){if(n.matches.length>0&&n.returned<n.matches.length)return n.returned=n.returned+1,{value:n.matches[n.returned-1],done:!1};n.indent=0,n.startline=n.pos,n.finishedLine=!1,n.getEol(),n.lastMatchedContainer=-1;let o=0;for(;o<n.containers.length;){let s=n.containers[o];if(n.skipSpace(),s.continue(s))n.lastMatchedContainer=o;else break;o=o+1}if(n.finishedLine)for(;n.containers.length>0&&n.lastMatchedContainer<n.containers.length-1;){let s=n.tip();s&&s.close()}if(!n.finishedLine){n.skipSpace();let s=n.pos===n.starteol,i=!1,c=n.containers[n.lastMatchedContainer],d=!s&&(!c||c.content===P.Block||c.content===P.ListItem)&&!n.find(ei);for(;d;){d=!1;for(let h of t)if((!c&&h.type===P.Block||c&&c.content===h.type)&&h.open(h)){if(n.tip())n.lastMatchedContainer=n.containers.length-1,c=n.containers[n.lastMatchedContainer],n.finishedLine?d=!1:(n.skipSpace(),i=!0,d=h.content===P.Block||h.content===P.ListItem);else throw new Error("No tip after opening container");break}}if(!n.finishedLine){n.skipSpace(),s=n.pos===n.starteol;let h=n.tip();if(!s&&!i&&n.lastMatchedContainer<n.containers.length-1&&h&&h.content===P.Inline||n.closeUnmatchedContainers(),h=n.tip(),(!h||h.content===P.Block)&&(s?i||n.addMatch(n.pos,n.endeol,"blankline"):(n.paraSpec.open(n.paraSpec),h=n.tip(),h&&(h.inlineParser=new qe.InlineParser(n.subject,n.options)))),h&&h.content===P.Text){let k=n.pos;h.indent!==null&&n.indent>h.indent&&(k=k-(n.indent-h.indent)),n.addMatch(k,n.endeol,"str")}else h&&h.content===P.Inline&&!s&&h.inlineParser&&h.inlineParser.feed(n.pos,n.endeol)}}n.pos=(n.endeol||n.pos)+1}return n.lastMatchedContainer=-1,n.closeUnmatchedContainers(),n.matches.length>0&&n.returned<n.matches.length?(n.returned=n.returned+1,{value:n.matches[n.returned-1],done:!1}):{value:{startpos:n.pos,endpos:n.pos,annot:""},done:!0}}}}},pi=function(e,t={}){return new Ye(e,t)};ne.parseEvents=pi});var re=J(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.isCaption=rt.isRow=rt.isBlock=rt.isInline=void 0;var fi={para:!0,heading:!0,block_quote:!0,thematic_break:!0,section:!0,div:!0,code_block:!0,raw_block:!0,bullet_list:!0,ordered_list:!0,task_list:!0,definition_list:!0,table:!0,reference:!0,footnote:!0};function mi(e){return fi[e.tag]||!1}rt.isBlock=mi;var gi={str:!0,soft_break:!0,hard_break:!0,non_breaking_space:!0,symb:!0,verbatim:!0,raw_inline:!0,inline_math:!0,display_math:!0,url:!0,email:!0,footnote_reference:!0,smart_punctuation:!0,emph:!0,strong:!0,link:!0,image:!0,span:!0,mark:!0,superscript:!0,subscript:!0,insert:!0,delete:!0,double_quoted:!0,single_quoted:!0};function bi(e){return gi[e.tag]||!1}rt.isInline=bi;function wi(e){return"head"in e}rt.isRow=wi;function yi(e){return!("head"in e)}rt.isCaption=yi});var ae=J(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.isInline=q.isCaption=q.isRow=q.isBlock=q.getStringContent=q.renderAST=q.parse=void 0;var xi=Ke(),mr=_t(),ie=re();Object.defineProperty(q,"isRow",{enumerable:!0,get:function(){return ie.isRow}});Object.defineProperty(q,"isBlock",{enumerable:!0,get:function(){return ie.isBlock}});Object.defineProperty(q,"isCaption",{enumerable:!0,get:function(){return ie.isCaption}});Object.defineProperty(q,"isInline",{enumerable:!0,get:function(){return ie.isInline}});var Xe=function(e){let t=[];return br(e,t),t.join("")};q.getStringContent=Xe;var br=function(e,t){if("text"in e)t.push(e.text);else if("tag"in e&&(e.tag==="soft_break"||e.tag==="hard_break"))t.push(`
`);else if("children"in e)for(let r of e.children)br(r,t)},Qe=function(e){return e.replace(/^ `/,"`").replace(/` $/,"`")},ki={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3,I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},gr=function(e){let t=0,r=0,n=e.length-1;for(;n>=0;){let o=e.charAt(n),s=ki[o];if(!s)throw new Error("Encountered bad character in roman numeral "+e);s<r?t=t-s:t=t+s,r=s,n=n-1}return t},vi=function(e,t){let r=t.replace(/[().]/g,""),n=e.replace(/[().]/g,"");switch(r){case"1":return parseInt(n,10);case"A":return(n.codePointAt(0)||65)-65+1;case"a":return(n.codePointAt(0)||97)-97+1;case"I":return gr(n);case"i":return gr(n)}},F;(function(e){e[e.Normal=0]="Normal",e[e.Verbatim=1]="Verbatim",e[e.Literal=2]="Literal"})(F||(F={}));var Ot=function(e){return e.trim().replace(/[ \t\r\n]+/g," ")},Ci=function(e,t={}){let r=[-1];if(t.sourcePositions)for(let u=0;u<e.length;u++)e[u]===`
`&&r.push(u);let n=function(u){let p=r.length,f=0,l=p-1,a=0,b=0;for(;!a;){let N=f+~~((l-f)/2);r[N]>u?l=N:r[N]<=u&&(N===l||r[N+1]>u?(a=N+1,b=u-r[N]):f===N&&f<l?f=N+1:f=N)}return{line:a,col:b,offset:u}},o=F.Normal,s="",i={},c={},d={},h={},g={},k=0,A=(0,xi.parseEvents)(e,t),I=t.warn||(()=>{}),M=function(u){if(Object.keys(g).length>0){u.attributes=u.attributes||{};for(let p in g)u.attributes[p]=g[p],delete g[p]}},z=function(u){let p=u.replace(/[\]\[~!@#$%^&*(){}`,.<>\\|=+/?\s]+/g," ").trim().replace(/ +/g,"-"),f=0,l=p;for(;!l||h[l];)f=f+1,l=(p||"s")+"-"+f;return l},S=function(u){let p={children:[],data:{},pos:u,attributes:void 0};M(p),O.push(p)},w=function(u){let p=O.pop();if(!p)throw new Error("Container stack is empty (popContainer)");return u&&p.pos&&(p.pos.end=u.end),p},y=function(){if(O.length>0)return O[O.length-1];throw new Error("Container stack is empty (topContainer)")},W=function(){let u=y();return u.children.length>0?u.children[u.children.length-1]:u},x=function(u){O.length>0&&O[O.length-1].children.push(u)},Y={str:(u,p,f,l)=>{let a=e.substring(p,f+1);o===F.Normal?x({tag:"str",text:a,pos:l}):s+=a},soft_break:(u,p,f,l)=>{o===F.Normal?x({tag:"soft_break",pos:l}):s+=`
`},escape:(u,p,f,l)=>{o===F.Verbatim&&(s+="\\")},hard_break:(u,p,f,l)=>{o===F.Normal?x({tag:"hard_break",pos:l}):s+=`
`},non_breaking_space:(u,p,f,l)=>{o===F.Verbatim?s+="\\ ":x({tag:"non_breaking_space",pos:l})},symb:(u,p,f,l)=>{if(o===F.Normal){let a=e.substring(p+1,f);x({tag:"symb",alias:a,pos:l})}else{let a=e.substring(p,f+1);s+=a}},footnote_reference:(u,p,f,l)=>{let a=e.substring(p+2,f);x({tag:"footnote_reference",text:Ot(a),pos:l})},"+reference_definition":(u,p,f,l)=>{S(l)},"-reference_definition":(u,p,f,l)=>{let a=w(l),b=Ot(a.data.key),N={tag:"reference",label:b,destination:a.data.value||"",attributes:a.attributes,pos:a.pos};a.data.key&&(i[b]=N)},reference_key:(u,p,f,l)=>{y().data.key=e.substring(p+1,f),y().data.value=""},reference_value:(u,p,f,l)=>{y().data.value=y().data.value+e.substring(p,f+1)},"+emph":(u,p,f,l)=>{S(l)},"-emph":(u,p,f,l)=>{let a=w(l);x({tag:"emph",children:a.children,pos:a.pos})},"+strong":(u,p,f,l)=>{S(l)},"-strong":(u,p,f,l)=>{let a=w(l);x({tag:"strong",children:a.children,pos:a.pos})},"+span":(u,p,f,l)=>{S(l)},"-span":(u,p,f,l)=>{let a=w(l);x({tag:"span",children:a.children,pos:a.pos})},"+mark":(u,p,f,l)=>{S(l)},"-mark":(u,p,f,l)=>{let a=w(l);x({tag:"mark",children:a.children,pos:a.pos})},"+superscript":(u,p,f,l)=>{S(l)},"-superscript":(u,p,f,l)=>{let a=w(l);x({tag:"superscript",children:a.children,pos:a.pos})},"+subscript":(u,p,f,l)=>{S(l)},"-subscript":(u,p,f,l)=>{let a=w(l);x({tag:"subscript",children:a.children,pos:a.pos})},"+delete":(u,p,f,l)=>{S(l)},"-delete":(u,p,f,l)=>{let a=w(l);x({tag:"delete",children:a.children,pos:a.pos})},"+insert":(u,p,f,l)=>{S(l)},"-insert":(u,p,f,l)=>{let a=w(l);x({tag:"insert",children:a.children,pos:a.pos})},"+double_quoted":(u,p,f,l)=>{S(l)},"-double_quoted":(u,p,f,l)=>{let a=w(l);x({tag:"double_quoted",children:a.children,pos:a.pos})},"+single_quoted":(u,p,f,l)=>{S(l)},"-single_quoted":(u,p,f,l)=>{let a=w(l);x({tag:"single_quoted",children:a.children,pos:a.pos})},"+attributes":(u,p,f,l)=>{S(l)},"-attributes":(u,p,f,l)=>{let a=w(l);if(a.attributes&&O.length>0){a.attributes.id&&(h[a.attributes.id]=!0);let b=W();if(b===y())return;let N=!1;if("tag"in b&&b.tag==="str"){let T=b.text.match(/[^\s]+$/);if(T&&T.index&&T.index>0){let Q;if(b.pos){let X=b.pos.end;b.pos.end={line:X.line,col:X.col-T[0].length,offset:X.offset-T[0].length},Q={start:{line:X.line,col:X.col-T[0].length+1,offset:X.offset-T[0].length+1},end:X}}b.text=b.text.substring(0,T.index),x({tag:"str",text:T[0],pos:Q})}else T||(N=!0)}if(b=W(),N){I(new mr.Warning("Ignoring unattached attribute",t.sourcePositions?n(p):p));return}b.attributes||(b.attributes={});for(let T in a.attributes)T==="class"&&b.attributes[T]?b.attributes[T]=b.attributes[T]+" "+a.attributes[T]:b.attributes[T]=a.attributes[T]}},"+block_attributes":(u,p,f,l)=>{S(l)},"-block_attributes":(u,p,f,l)=>{let a=w(l);if(a.attributes&&O.length>0){a.attributes.id&&(h[a.attributes.id]=!0);for(let b in a.attributes)b==="class"&&g[b]?g[b]=g[b]+" "+a.attributes[b]:g[b]=a.attributes[b]}},class:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.attributes||(a.attributes={}),a.attributes.class?a.attributes.class=a.attributes.class+" "+b:a.attributes.class=b},id:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.attributes?a.attributes.id=b:a.attributes={id:b}},key:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.data.key=b,a.attributes||(a.attributes={}),a.attributes[a.data.key]=""},value:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1).replace(/[ \r\n]+/g," ").replace(/\\([.,\\/#!$%^&*;:{}=\-_`~+[\]()'"?|])/g,"$1");if(a.attributes||(a.attributes={}),a.data.key)a.attributes[a.data.key]=a.attributes[a.data.key]+b;else throw new Error("Encountered value without key")},"+linktext":(u,p,f,l)=>{S(l),y().data.isimage=!1},"-linktext":(u,p,f,l)=>{},"+imagetext":(u,p,f,l)=>{S(l),y().data.isimage=!0},"-imagetext":(u,p,f,l)=>{},"+destination":(u,p,f,l)=>{o=F.Literal},"-destination":(u,p,f,l)=>{let a=w(l);x({tag:a.data.isimage?"image":"link",destination:s.replace(/[\r\n]/g,""),children:a.children,pos:a.pos}),o=F.Normal,s=""},"+reference":(u,p,f,l)=>{o=F.Literal},"-reference":(u,p,f,l)=>{let a=w(l),b=s;b.length===0&&(b=Xe(a)),x({tag:a.data.isimage?"image":"link",reference:Ot(b),children:a.children,pos:a.pos}),o=F.Normal,s=""},"+verbatim":(u,p,f,l)=>{o=F.Verbatim,S(l)},"-verbatim":(u,p,f,l)=>{let a=w(l);x({tag:"verbatim",text:Qe(s),pos:a.pos}),o=F.Normal,s=""},raw_format:(u,p,f,l)=>{let a=e.substring(p,f+1).replace(/^\{?=/,"").replace(/\}$/,""),b=y();if(o===F.Verbatim)b.data.format=a;else{let N=b.children[b.children.length-1];if(N&&"tag"in N&&N.tag==="verbatim")N.tag="raw_inline",N.format=a;else throw new Error("raw_format is not after verbatim or code_block.")}},"+display_math":(u,p,f,l)=>{o=F.Verbatim,S(l)},"+inline_math":(u,p,f,l)=>{o=F.Verbatim,S(l)},"-display_math":(u,p,f,l)=>{let a=w(l);x({tag:"display_math",text:Qe(s),pos:a.pos}),o=F.Normal,s=""},"-inline_math":(u,p,f,l)=>{let a=w(l);x({tag:"inline_math",text:Qe(s),pos:a.pos}),o=F.Normal,s=""},"+url":(u,p,f,l)=>{o=F.Literal,S(l)},"-url":(u,p,f,l)=>{let a=w(l);x({tag:"url",text:s.replace(/[\r\n]/g,""),pos:a.pos}),o=F.Normal,s=""},"+email":(u,p,f,l)=>{o=F.Literal,S(l)},"-email":(u,p,f,l)=>{let a=w(l);x({tag:"email",text:s.replace(/[\r\n]/g,""),pos:a.pos}),o=F.Normal,s=""},"+para":(u,p,f,l)=>{S(l)},"-para":(u,p,f,l)=>{let a=w(l);x({tag:"para",children:a.children,attributes:a.attributes,pos:a.pos})},"+heading":(u,p,f,l)=>{S(l),y().data.level=1+f-p},"-heading":(u,p,f,l)=>{let a=w(l);a.attributes||(a.attributes={}),a.autoAttributes||(a.autoAttributes={});let b=Xe(a).trim();a.attributes.id||(a.autoAttributes.id=z(b),h[a.autoAttributes.id]=!0);let N=Ot(b);!i[N]&&!c[N]&&(c[N]={tag:"reference",label:N,destination:"#"+(a.attributes.id||a.autoAttributes.id)});let T=y();if(T.data.headinglevel!==void 0){for(;T&&T.data.headinglevel!==void 0&&T.data.headinglevel>=a.data.level;)T=w(l),x({tag:"section",children:T.children,attributes:T.attributes,autoAttributes:T.autoAttributes,pos:T.pos}),T=y();S(l),y().data.headinglevel=a.data.level,a.autoAttributes&&a.autoAttributes.id&&(y().autoAttributes=a.autoAttributes,delete a.autoAttributes),a.attributes&&a.attributes.id&&(y().attributes=a.attributes,delete a.attributes)}x({tag:"heading",level:a.data.level,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+list":(u,p,f,l)=>{S(l),y().data.styles=u,y().data.blanklines=!1,y().data.tight=!0,k++},"-list":(u,p,f,l)=>{let a=w(l),b=a.data.styles[0];if(!b)throw new Error("No style defined for list");let N=vi(a.data.firstMarker,b);x(b===":"?{tag:"definition_list",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:b==="X"?{tag:"task_list",tight:a.data.tight,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:b==="+"||b==="*"||b==="-"?{tag:"bullet_list",tight:a.data.tight,style:b,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:{tag:"ordered_list",style:b,children:a.children,start:N,tight:a.data.tight,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}),k--},"+list_item":(u,p,f,l)=>{u.length<y().data.styles.length&&(y().data.styles=u),y().data.firstMarker||(y().data.firstMarker=e.substring(p,f+1)),S(l),u.length===1&&u[0]===":"&&(y().data.definitionList=!0)},"-list_item":(u,p,f,l)=>{let a=w(l);if(a.data.definitionList)if(a.children[0]&&a.children[0].tag==="para"){let b={tag:"term",children:a.children[0].children};a.children.shift();let N={tag:"definition",children:a.children};x({tag:"definition_list_item",children:[b,N],attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}else{let b={tag:"term",children:[]},N={tag:"definition",children:a.children};x({tag:"definition_list_item",children:[b,N],attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}else a.data.checkbox?x({tag:"task_list_item",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,checkbox:a.data.checkbox,pos:a.pos}):x({tag:"list_item",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},checkbox_checked:(u,p,f,l)=>{y().data.checkbox="checked"},checkbox_unchecked:(u,p,f,l)=>{y().data.checkbox="unchecked"},"+block_quote":(u,p,f,l)=>{S(l)},"-block_quote":(u,p,f,l)=>{let a=w(l);x({tag:"block_quote",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+table":(u,p,f,l)=>{S(l),y().data.aligns=[]},"-table":(u,p,f,l)=>{var a;let b=w(l),N=b.children,T={tag:"caption",children:[]};((a=N[0])===null||a===void 0?void 0:a.tag)==="caption"&&(T=N.shift()),x({tag:"table",children:[T,...N],attributes:b.attributes,autoAttributes:b.autoAttributes,pos:b.pos})},"+row":(u,p,f,l)=>{S(l),y().data.aligns=[]},"-row":(u,p,f,l)=>{let a=w(l);if(a.children.length===0){y().data.aligns=a.data.aligns;let b=W();if(b&&"tag"in b&&b.tag==="row"){b.head=!0;for(let N=0;N<b.children.length;N++)b.children[N].head=!0,b.children[N].align=a.data.aligns[N]||"default"}}else{a.data.aligns=[];for(let b=0;b<a.children.length;b++)a.children[b].align=y().data.aligns[b]||"default";x({tag:"row",children:a.children,head:!1,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}},separator_default:(u,p,f,l)=>{y().data.aligns.push("default")},separator_left:(u,p,f,l)=>{y().data.aligns.push("left")},separator_right:(u,p,f,l)=>{y().data.aligns.push("right")},separator_center:(u,p,f,l)=>{y().data.aligns.push("center")},"+cell":(u,p,f,l)=>{S(l)},"-cell":(u,p,f,l)=>{let a=w(l);x({tag:"cell",children:a.children,head:!1,align:"default",attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+caption":(u,p,f,l)=>{S(l)},"-caption":(u,p,f,l)=>{var a;let b=w(l),N=W();if(!N||"tag"in N&&N.tag!=="table")return;let T={tag:"caption",children:b.children,attributes:b.attributes,autoAttributes:b.autoAttributes,pos:b.pos};((a=N.children[0])===null||a===void 0?void 0:a.tag)==="caption"&&(N.children[0]=T)},"+footnote":(u,p,f,l)=>{S(l)},"-footnote":(u,p,f,l)=>{let a=w(l);if(a.data.label){let b=Ot(a.data.label);d[b]={tag:"footnote",label:b||"",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}}else I(new mr.Warning("Ignoring footnote without a label.",t.sourcePositions?n(f):f))},note_label:(u,p,f,l)=>{y().data.label=e.substring(p,f+1)},"+code_block":(u,p,f,l)=>{S(l),o=F.Verbatim},"-code_block":(u,p,f,l)=>{let a=w(l);a.data.format?x({tag:"raw_block",format:a.data.format,text:s,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}):x({tag:"code_block",text:s,lang:a.data.lang,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}),o=F.Normal,s=""},code_language:(u,p,f,l)=>{let a=y();a.data.lang=e.substring(p,f+1)},"+div":(u,p,f,l)=>{S(l)},"-div":(u,p,f,l)=>{let a=w(l);x({tag:"div",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},thematic_break:(u,p,f,l)=>{let a={tag:"thematic_break",pos:l};M(a),x(a)},left_single_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"left_single_quote",text:"'",pos:l})},right_single_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"right_single_quote",text:"'",pos:l})},left_double_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"left_double_quote",text:'"',pos:l})},right_double_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"right_double_quote",text:'"',pos:l})},ellipses:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"ellipses",text:"...",pos:l})},en_dash:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"en_dash",text:"--",pos:l})},em_dash:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"em_dash",text:"---",pos:l})},blankline:(u,p,f,l)=>{let a;"tight"in y().data?a=y():O.length>=2&&"tight"in O[O.length-2].data&&(a=O[O.length-2]),a&&(a.data.blanklines=!0)}},tt=function(u,p){let f,l,a;t.sourcePositions&&(f=n(p.startpos),l=n(p.endpos),a={start:f,end:l});let b=p.annot,N=[];if(p.annot.includes("|")){let Q=p.annot.split("|");b=Q[0],N=Q.slice(1)}if(k>0&&b!=="blankline"){let Q,X=y();X&&(X.data&&"tight"in X.data?Q=X:u.length>=2&&"tight"in u[u.length-2].data&&(Q=u[u.length-2])),Q&&(!/^[+-]list/.test(b)&&Q.data.blanklines&&(Q.data.tight=!1),/^[-+]list_item$/.test(b)||(Q.data.blanklines=!1))}let T=Y[b];T&&T(N,p.startpos,p.endpos,a)},O=[{children:[],data:{headinglevel:0},pos:{start:{line:0,col:0,offset:0},end:{line:0,col:0,offset:0}}}],K=0;for(let u of A)tt(O,u),K=u.endpos;let it;t.sourcePositions&&(it=n(K));let pt=y();for(;pt&&pt.data.headinglevel>0;)w(it&&{start:it,end:it}),x({tag:"section",children:pt.children,attributes:pt.attributes,autoAttributes:pt.autoAttributes,pos:pt.pos}),pt=y();let we={tag:"doc",references:i,autoReferences:c,footnotes:d,children:O[0].children};return O[0].autoAttributes&&(we.autoAttributes=O[0].autoAttributes),O[0].attributes&&(we.attributes=O[0].attributes),we};q.parse=Ci;var _i={children:!0,tag:!0,pos:!0,attributes:!0,autoAttributes:!0,references:!0,autoReferences:!0,footnotes:!0},se=function(e){return JSON.stringify(e).replace(/\\\n/g,"\\n")},oe=function(e,t,r){if(t.push(" ".repeat(r)),r>128){t.push(`(((DEEPLY NESTED CONTENT OMITTED)))
`);return}t.push(e.tag),e.pos&&t.push(` (${e.pos.start.line}:${e.pos.start.col}:${e.pos.start.offset}-${e.pos.end.line}:${e.pos.end.col}:${e.pos.end.offset})`);for(let n in e)if(!_i[n]){let o=e[n];o!=null&&t.push(` ${n}=${se(o)}`)}if(e.attributes)for(let n in e.attributes)t.push(` ${n}=${se(e.attributes[n])}`);if(t.push(`
`),e.children)for(let n of e.children)oe(n,t,r+2)},Si=function(e){let t=[];if(oe(e,t,0),Object.keys(e.references).length>0){t.push(`references
`);for(let r in e.references)t.push(`  [${se(r)}] =
`),oe(e.references[r],t,4)}if(Object.keys(e.footnotes).length>0){t.push(`footnotes
`);for(let r in e.footnotes)t.push(`  [${se(r)}] =
`),oe(e.footnotes[r],t,4)}return t.join("")};q.renderAST=Si});var yr=J(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.HTMLRenderer=At.renderHTML=void 0;var wr=ae(),Ai=_t(),Ni=/[&<>]/,Mi=/[&<>"]/,ce=class{constructor(t){this.smartPunctuationMap={right_single_quote:"\u2019",left_single_quote:"\u2018",right_double_quote:"\u201D",left_double_quote:"\u201C",ellipses:"\u2026",em_dash:"\u2014",en_dash:"\u2013"},this.warn=t.warn||(()=>{}),this.options=t||{},this.tight=!1,this.footnoteIndex={},this.nextFootnoteIndex=1,this.references={},this.autoReferences={}}escape(t){return Ni.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}escapeAttribute(t){return Mi.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):t}renderAttributes(t,r){let n="";if(r)for(let s in r)if(s==="class"){let i=r[s];t.attributes&&t.attributes.class&&(i=`${i} ${t.attributes.class}`),n+=` ${s}="${this.escapeAttribute(i)}"`}else n+=` ${s}="${this.escapeAttribute(r[s])}"`;let o=Object.assign(Object.assign({},t.autoAttributes),t.attributes);if(o)for(let s in o){let i=o[s];s==="class"&&r&&r.class||(n+=` ${s}="${this.escapeAttribute(i)}"`)}if(t.pos){let s=t.pos.start,i=t.pos.end;n+=` data-startpos="${s.line}:${s.col}:${s.offset}" data-endpos="${i.line}:${i.col}:${i.offset}"`}return n}renderTag(t,r,n){let o="";return(r.attributes||r.autoAttributes||n||r.pos)&&(o=this.renderAttributes(r,n)),`<${t}${o}>`}renderCloseTag(t){return`</${t}>`}inTags(t,r,n,o){let s=n>=2?`
`:"",i=n>=1?`
`:"";return`${this.renderTag(t,r,o)}${s}${this.renderChildren(r)}</${t}>${i}`}addBacklink(t,r){let n=`<a href="#fnref${r}" role="doc-backlink">\u21A9\uFE0E</a>`;return/\<\/p\>[\r\n]*$/.test(t)?t.replace(/\<\/p\>([\r\n]*)$/,n+"</p>$1"):t+`<p>${n}</p>
`}renderChildren(t){let r="",n=this.tight;"tight"in t&&(this.tight=!!t.tight);for(let o of t.children)r+=this.renderAstNode(o);return"tight"in t&&(this.tight=n),r}renderAstNode(t){var r;let n=(r=this.options.overrides)===null||r===void 0?void 0:r[t.tag];return n?n(t,this):this.renderAstNodeDefault(t)}renderNotes(t){let r="",n=[],o={};for(let s in t)o[s]=this.renderChildren(t[s]);for(let s in this.footnoteIndex){let i=this.footnoteIndex[s];i&&(n[i]=o[s])}r+=`<section role="doc-endnotes">
<hr>
<ol>
`;for(let s=1;s<n.length;s++){let i=n[s]||"";r+=`<li id="fn${s}">
`,r+=this.addBacklink(i,s),r+=`</li>
`}return r+=`</ol>
</section>
`,r}renderAstNodeDefault(t){var r;switch(t.tag){case"doc":{let n="";return n+=this.renderChildren(t),this.nextFootnoteIndex>1&&(n+=this.renderNotes(t.footnotes)),n}case"para":return this.tight?`${this.renderChildren(t)}
`:this.inTags("p",t,1);case"block_quote":return this.inTags("blockquote",t,2);case"div":return this.inTags("div",t,2);case"section":return this.inTags("section",t,2);case"list_item":return this.inTags("li",t,2);case"task_list_item":return this.inTags("li",t,2,{class:t.checkbox==="checked"?"checked":"unchecked"});case"definition_list_item":return this.renderChildren(t);case"definition":return this.inTags("dd",t,2);case"term":return this.inTags("dt",t,1);case"definition_list":return this.inTags("dl",t,2);case"bullet_list":return this.inTags("ul",t,2);case"task_list":return this.inTags("ul",t,2,{class:"task-list"});case"ordered_list":{let n={};return t.start&&t.start!==1&&(n.start=t.start.toString()),t.style&&!/1/.test(t.style)&&(n.type=t.style.replace(/[().]/g,"")),this.inTags("ol",t,2,n)}case"heading":return this.inTags(`h${t.level}`,t,1);case"footnote_reference":{let n="",o=t.text,s=this.footnoteIndex[o];return s||(s=this.nextFootnoteIndex,this.footnoteIndex[o]=s,this.nextFootnoteIndex++),n+=this.renderTag("a",t,{id:"fnref"+s,href:"#fn"+s,role:"doc-noteref"}),n+="<sup>",n+=this.escape(s.toString()),n+="</sup></a>",n}case"table":return this.inTags("table",t,2);case"caption":{let n="";return t.children.length>0&&(n+=this.inTags("caption",t,1)),n}case"row":return this.inTags("tr",t,2);case"cell":{let n={};return t.align&&t.align!=="default"&&(n.style=`text-align: ${t.align};`),this.inTags(t.head?"th":"td",t,1,n)}case"thematic_break":{let n="";return n+=this.renderTag("hr",t),n+=`
`,n}case"code_block":{let n="";return n+=this.renderTag("pre",t),n+="<code",t.lang&&(n+=` class="language-${this.escapeAttribute(t.lang)}"`),n+=">",n+=this.escape(t.text),n+=this.renderCloseTag("code"),n+=this.renderCloseTag("pre"),n+=`
`,n}case"raw_block":{let n="";return t.format==="html"&&(n+=t.text),n}case"str":return t.attributes||t.autoAttributes?`${this.renderTag("span",t)}${this.escape(t.text)}</span>`:this.escape(t.text);case"smart_punctuation":return this.smartPunctuationMap[t.type]||t.text;case"double_quoted":{let n="";return n+=this.smartPunctuationMap.left_double_quote||'"',n+=this.renderChildren(t),n+=this.smartPunctuationMap.right_double_quote||'"',n}case"single_quoted":{let n="";return n+=this.smartPunctuationMap.left_single_quote||"'",n+=this.renderChildren(t),n+=this.smartPunctuationMap.right_single_quote||"'",n}case"symb":return this.escape(`:${t.alias}:`);case"inline_math":{let n="";return n+=this.renderTag("span",t,{class:"math inline"}),n+=`\\(${this.escape(t.text)}\\)`,n+=this.renderCloseTag("span"),n}case"display_math":{let n="";return n+=this.renderTag("span",t,{class:"math display"}),n+=`\\[${this.escape(t.text)}\\]`,n+=this.renderCloseTag("span"),n}case"verbatim":{let n="";return n+=this.renderTag("code",t),n+=this.escape(t.text),n+=this.renderCloseTag("code"),n}case"raw_inline":{let n="";return t.format==="html"&&(n+=t.text),n}case"soft_break":return`
`;case"hard_break":return`<br>
`;case"non_breaking_space":return"&nbsp;";case"link":case"image":{let n={},o=t.destination;if(t.reference){let s=this.references[t.reference]||this.autoReferences[t.reference];if(s){if(o=s.destination,t.tag==="image"?(n.alt=(0,wr.getStringContent)(t),n.src=o):n.href=o,s.attributes)for(let i in s.attributes)(!t.attributes||!t.attributes[i])&&(n[i]=s.attributes[i]);if(s.autoAttributes)for(let i in s.autoAttributes)(!t.autoAttributes||!t.autoAttributes[i])&&(n[i]=s.autoAttributes[i])}else this.warn(new Ai.Warning(`Reference ${JSON.stringify(t.reference)} not found`,(r=t==null?void 0:t.pos)===null||r===void 0?void 0:r.end))}else t.tag==="image"?(n.alt=(0,wr.getStringContent)(t),o!==void 0&&(n.src=o)):o!==void 0&&(n.href=o);return t.tag==="image"?this.renderTag("img",t,n):this.inTags("a",t,0,n)}case"url":case"email":{let n="",o={};return t.tag==="email"?o.href="mailto:"+t.text:o.href=t.text,n+=this.renderTag("a",t,o),n+=this.escape(t.text),n+=this.renderCloseTag("a"),n}case"strong":return this.inTags("strong",t,0);case"emph":return this.inTags("em",t,0);case"span":return this.inTags("span",t,0);case"mark":return this.inTags("mark",t,0);case"insert":return this.inTags("ins",t,0);case"delete":return this.inTags("del",t,0);case"superscript":return this.inTags("sup",t,0);case"subscript":return this.inTags("sub",t,0);default:return""}}render(t){return this.references=t.references,this.autoReferences=t.autoReferences,this.renderAstNode(t)}};At.HTMLRenderer=ce;var Ti=function(e,t={}){return new ce(t).render(e)};At.renderHTML=Ti});var xr=J(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.applyFilter=void 0;var tn=class{constructor(t){this.finished=!1,this.stack=[],this.enter=!0,this.top=t,this.current=t}walk(t){for(;!this.finished;){t(this);let r=this.stack&&this.stack[this.stack.length-1];if(this.enter)"children"in this.current&&this.current.children.length>0?(this.stack.push({node:this.current,childIndex:0}),this.current=this.current.children[0],this.enter=!0):this.enter=!1;else if(r){r.childIndex++;let n=r.node.children[r.childIndex];n?(this.current=n,this.enter=!0):(this.stack.pop(),this.current=r.node,this.enter=!1)}else this.finished=!0}}},Pi=function(e,t,r){if(!e||!e.tag)throw new Error("Filter called on a non-node.");let n=r[e.tag];if(!n)return!1;let o;if(t?"enter"in n&&n.enter&&(o=n.enter):"exit"in n&&n.exit?o=n.exit:o=n,typeof o=="function")return o(e)},Ze=function(e,t){return new tn(e).walk(r=>{let n=Pi(r.current,r.enter,t),o=r.stack[r.stack.length-1];if(typeof n=="object"&&"stop"in n&&n.stop&&(n=n.stop,r.enter=!1),n){if(Array.isArray(n))if(o)o.node.children.splice(o.childIndex,1,...n),r.current=o.node.children[o.childIndex],n.length>1&&(o.childIndex+=n.length-1);else throw Error("Cannot replace top node with multiple nodes");else if(typeof n=="object"&&"tag"in n&&n.tag)if(o)o.node.children[o.childIndex]=n;else return n}}),e},Ii=function(e,t){let r=t(),n;Array.isArray(r)?n=r:n=[r];for(let o of n){Ze(e,o);for(let s in e.footnotes)Ze(e.footnotes[s],o);for(let s in e.references)Ze(e.references[s],o)}};le.applyFilter=Ii});var vr=J(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.fromPandoc=Nt.toPandoc=void 0;var he=_t(),de={Decimal:{Period:"1.",OneParen:"1)",TwoParens:"(1)"},LowerAlpha:{Period:"a.",OneParen:"a)",TwoParens:"(a)"},UpperAlpha:{Period:"A.",OneParen:"A)",TwoParens:"(A)"},LowerRoman:{Period:"i.",OneParen:"i)",TwoParens:"(i)"},UpperRoman:{Period:"I.",OneParen:"I)",TwoParens:"(I)"}},kr={};for(let e in de)for(let t in de[e])kr[de[e][t]]=[e,t];var Ei=function(e){return e.t==="Para"&&(e.t="Plain"),e},ot=function(e){let t=Object.assign(Object.assign({},e.autoAttributes),e.attributes);if(t){let r=t.id||"",n=t.class&&t.class.split(" ")||[],o=[];for(let s in t)s!==r&&s!=="class"&&o.push([s,t[s]]);return[r,n,o]}else return["",[],[]]},en=class{constructor(t={}){this.references={},this.footnotes={},this.options=t,this.smartPunctuationMap=this.options.smartPunctuationMap||{right_single_quote:"\u2019",left_single_quote:"\u2018",right_double_quote:"\u201D",left_double_quote:"\u201C",ellipses:"\u2026",em_dash:"\u2014",en_dash:"\u2013"},this.warn||(this.warn=()=>{})}toPandocChildren(t){if("children"in t){let r=[];return t.children.forEach(n=>{this.addToPandocElts(r,n)}),r}else return[]}toPandocDefinitionListItem(t){let r=this;return function(n){if(!("children"in n))return[];let[o,s]=n.children;return[r.toPandocChildren(o),[r.toPandocChildren(s)]]}}toPandocListItem(t){let r=this;return function(n){let o=r.toPandocChildren(n);return"checkbox"in n&&n.checkbox&&o[0].t==="Para"&&(n.checkbox==="checked"?o[0].c.unshift({t:"Str",c:"\u2612"},{t:"Space"}):o[0].c.unshift({t:"Str",c:"\u2610"},{t:"Space"})),"tight"in t&&t.tight&&(o=o.map(Ei)),o}}addToPandocElts(t,r){switch(r.tag){case"section":case"div":{let n=ot(r);r.tag==="section"&&n[1].unshift("section"),t.push({t:"Div",c:[n,this.toPandocChildren(r)]});break}case"block_quote":t.push({t:"BlockQuote",c:this.toPandocChildren(r)});break;case"definition_list":{let n=r.children.map(this.toPandocDefinitionListItem(r));t.push({t:"DefinitionList",c:n});break}case"task_list":case"bullet_list":{let n;n=r.children.map(this.toPandocListItem(r)),t.push({t:"BulletList",c:n});break}case"ordered_list":{let n=r.children.map(this.toPandocListItem(r)),[o,s]=kr[r.style],i=r.start||1;t.push({t:"OrderedList",c:[[i,{t:o},{t:s}],n]});break}case"task_list_item":case"list_item":break;case"para":t.push({t:"Para",c:this.toPandocChildren(r)});break;case"heading":t.push({t:"Header",c:[r.level,ot(r),this.toPandocChildren(r)]});break;case"code_block":{let n=ot(r);r.lang&&n[1].unshift(r.lang),t.push({t:"CodeBlock",c:[n,r.text]});break}case"raw_block":t.push({t:"RawBlock",c:[r.format,r.text]});break;case"thematic_break":t.push({t:"HorizontalRule"});break;case"table":{let n=ot(r),o=["",[],[]],s=[],i=[],c=[],d=[],h=[o,[]],g=[],k=[],A={left:"AlignLeft",right:"AlignRight",center:"AlignCenter",default:"AlignDefault"},I=function(w){return[{t:A[w.align]||"AlignDefault"},{t:"ColWidthDefault"}]},M=this,z=function(w){if("children"in w)return[ot(w),{t:"align"in w&&A[w.align]||"AlignDefault"},1,1,[{t:"Plain",c:M.toPandocChildren(w)}]]},S=function(w){if("children"in w)return[ot(w),w.children.map(z)]};for(let w=0;w<r.children.length;w++){let y=r.children[w];if(!("children"in y))break;i.length===0&&(i=y.children.map(I)),y.tag==="caption"?y.children.length&&(s=this.toPandocChildren(y)):y.head?k.length===0?g.push(S(y)):(d.push([o,0,g,k]),k=[],g=[S(y)]):(d.length===0&&k.length===0&&(c=g,g=[]),k.push(S(y)))}(g.length>0||k.length>0)&&d.push([o,0,g,k]),t.push({t:"Table",c:[n,[null,[{t:"Plain",c:s}]],i,[o,c],d,h]});break}case"raw_inline":t.push({t:"RawInline",c:[r.format,r.text]});break;case"soft_break":t.push({t:"SoftBreak"});break;case"hard_break":t.push({t:"LineBreak"});break;case"str":r.text.split(/ +/).forEach((n,o)=>{o>0&&t.push({t:"Space"}),n.length>0&&t.push({t:"Str",c:n})});break;case"verbatim":t.push({t:"Code",c:[ot(r),r.text]});break;case"inline_math":t.push({t:"Math",c:[{t:"InlineMath"},r.text]});break;case"display_math":t.push({t:"Math",c:[{t:"DisplayMath"},r.text]});break;case"non_breaking_space":t.push({t:"Str",c:"\xA0"});break;case"smart_punctuation":t.push({t:"Str",c:this.smartPunctuationMap[r.type]||r.text});break;case"symb":t.push({t:"Span",c:[["",["symbol"],[["alias",r.alias]]],[{t:"Str",c:":"+r.alias+":"}]]});break;case"single_quoted":case"double_quoted":{let n={t:r.tag==="single_quoted"?"SingleQuote":"DoubleQuote"};t.push({t:"Quoted",c:[n,this.toPandocChildren(r)]});break}case"email":case"url":{let n=r.text;r.tag==="email"&&(n="mailto:"+n);let o=ot(r);o[1].unshift(r.tag==="email"?"email":"uri"),t.push({t:"Link",c:[o,[{t:"Str",c:r.text}],[n,""]]});break}case"image":case"link":{let n=r.destination||"",o={};if(r.reference){let h=this.references[r.reference];if(h){n=h.destination||"";let g=Object.assign(Object.assign({},h.autoAttributes),h.attributes);if(g)for(let k in g)o[k]=g[k]}else this.warn(new he.Warning("Reference "+r.reference+" not found."))}let s=Object.assign(Object.assign({},r.autoAttributes),r.attributes);if(s)for(let h in s)o[h]&&h==="class"?o[h]+=" "+s[h]:o[h]||(o[h]=s[h]);let i=ot({tag:"link",attributes:o,children:[]}),c=n||"",d=r.attributes&&r.attributes.title||r.autoAttributes&&r.autoAttributes.title||"";d&&(i[2]=i[2].filter(([h,g])=>h!=="title")),t.push({t:r.tag==="link"?"Link":"Image",c:[i,this.toPandocChildren(r),[c,d]]});break}case"emph":t.push({t:"Emph",c:this.toPandocChildren(r)});break;case"strong":t.push({t:"Strong",c:this.toPandocChildren(r)});break;case"superscript":t.push({t:"Superscript",c:this.toPandocChildren(r)});break;case"subscript":t.push({t:"Subscript",c:this.toPandocChildren(r)});break;case"span":t.push({t:"Span",c:[ot(r),this.toPandocChildren(r)]});break;case"mark":t.push({t:"Span",c:[["",["mark"],[]],this.toPandocChildren(r)]});break;case"insert":t.push({t:"Underline",c:this.toPandocChildren(r)});break;case"delete":t.push({t:"Strikeout",c:this.toPandocChildren(r)});break;case"footnote_reference":{let n=this.footnotes[r.text];n?t.push({t:"Note",c:this.toPandocChildren(n)}):t.push({t:"Superscript",c:[{t:"Str",c:r.text}]});break}default:this.warn(new he.Warning("Skipping unhandled node "+r.tag))}}toPandoc(t){return this.references=t.references,this.footnotes=t.footnotes,{"pandoc-api-version":[1,23],meta:{},blocks:this.toPandocChildren(t)}}},st=function(e){let t={};e[0]&&(t.id=e[0]),e[1].length>0&&(t.class=e[1].join(" "));for(let r=0;r<e[2].length;r++)t[e[2][r][0].toString()]=e[2][r][1];return Object.keys(t).length===0?null:t},nn=function(e){return e.t==="Plain"||e.t==="Para"},Di=function(e){if(!e[0])return null;let t=e[0];return nn(t)&&t.c.length>=2&&t.c[0].t==="Str"&&t.c[1].t==="Space"?t.c[0].c==="\u2612"?(t.c.shift(),t.c.shift(),"checked"):t.c[0].c==="\u2610"?(t.c.shift(),t.c.shift(),"unchecked"):null:null},rn=class{constructor(t={}){this.footnotes={},this.footnoteIndex=0,this.options=t,this.warn=t.warn||(()=>{})}fromPandocInlines(t){let r=[],n=[];for(let o=0;o<t.length;o++){let s=t[o];if(s.t==="Str")r.push(s.c);else if(s.t==="Space")r.push(" ");else switch(r.length>0&&(n.push({tag:"str",text:r.join("")}),r=[]),s.t){case"SoftBreak":n.push({tag:"soft_break"});break;case"LineBreak":n.push({tag:"hard_break"});break;case"Emph":n.push({tag:"emph",children:this.fromPandocInlines(s.c)});break;case"Strong":n.push({tag:"strong",children:this.fromPandocInlines(s.c)});break;case"Superscript":n.push({tag:"superscript",children:this.fromPandocInlines(s.c)});break;case"Subscript":n.push({tag:"subscript",children:this.fromPandocInlines(s.c)});break;case"Strikeout":n.push({tag:"delete",children:this.fromPandocInlines(s.c)});break;case"Span":{let i={tag:"span",children:this.fromPandocInlines(s.c[1])},c=st(s.c[0]);c&&(i.attributes=c),n.push(i);break}case"Underline":n.push({tag:"span",attributes:{class:"underline"},children:this.fromPandocInlines(s.c)});break;case"SmallCaps":n.push({tag:"span",attributes:{class:"smallcaps"},children:this.fromPandocInlines(s.c)});break;case"Math":n.push({tag:s.c[0].t==="DisplayMath"?"display_math":"inline_math",text:s.c[1]});break;case"Quoted":s.c[0].t==="SingleQuote"?n.push({tag:"single_quoted",children:this.fromPandocInlines(s.c[1])}):n.push({tag:"double_quoted",children:this.fromPandocInlines(s.c[1])});break;case"RawInline":n.push({tag:"raw_inline",format:s.c[0],text:s.c[1]});break;case"Code":{let i=st(s.c[0]),c={tag:"verbatim",text:s.c[1]};i&&(c.attributes=i),n.push(c);break}case"Image":case"Link":{let i=st(s.c[0]);s.c[2][1]&&(i=i||{},i.title=s.c[2][1]);let c=s.c[2][0],d=this.fromPandocInlines(s.c[1]);if(s.t==="Image"){let h={tag:"image",destination:c,children:d};i&&(h.attributes=i),n.push(h)}else{let h={tag:"link",destination:c,children:d};i&&(h.attributes=i),n.push(h)}break}case"Cite":n.push({tag:"span",attributes:{class:"cite"},children:this.fromPandocInlines(s.c[1])});break;case"Note":{this.footnoteIndex++;let i=this.footnoteIndex.toString(),c=s.c.map(d=>this.fromPandocBlock(d));this.footnotes[this.footnoteIndex.toString()]={tag:"footnote",label:i,children:c},n.push({tag:"footnote_reference",text:i});break}default:}}return r.length>0&&n.push({tag:"str",text:r.join("")}),n}fromPandocBlock(t){switch(t.t){case"Plain":case"Para":return{tag:"para",children:this.fromPandocInlines(t.c)};case"BlockQuote":return{tag:"block_quote",children:t.c.map(r=>this.fromPandocBlock(r))};case"Div":{let r=st(t.c[0]),n=/\bsection\b/.test(r&&r.class||"")?"section":"div",o=t.c[1].map(s=>this.fromPandocBlock(s));if(n==="section")return r=r||{},r.class=r.class.replace(/section */,""),r.class||delete r.class,{tag:"section",attributes:r,children:o};{let s={tag:"div",children:o};return r&&(s.attributes=r),s}}case"Header":{let r=st(t.c[1]),n={tag:"heading",level:t.c[0],children:this.fromPandocInlines(t.c[2])};return r&&(n.attributes=r),n}case"HorizontalRule":return{tag:"thematic_break"};case"RawBlock":return{tag:"raw_block",format:t.c[0],text:t.c[1]};case"CodeBlock":{let r=st(t.c[0]),n;if(r&&r.class){let s=r.class.split(/  */);n=s[0],s.shift(),s.length>0?r.class=s.join(" "):delete r.class}let o={tag:"code_block",lang:n,text:t.c[1]};return r&&(o.attributes=r),n||delete o.lang,o}case"DefinitionList":{let r=[];for(let o=0;o<t.c.length;o++){let s=t.c[o][0],i=t.c[o][1],c=this.fromPandocInlines(s),d=[];for(let h=0;h<i.length;h++)i[h].map(g=>{d.push(this.fromPandocBlock(g))});r.push({tag:"definition_list_item",children:[{tag:"term",children:c},{tag:"definition",children:d}]})}return{tag:"definition_list",children:r}}case"OrderedList":case"BulletList":{let r=[],n=[],o=!1,s;t.t==="BulletList"?s=t.c:s=t.c[1];for(let i=0;i<s.length;i++){let c=Di(s[i]),d=s[i].map(h=>(h.t==="Plain"?o=!0:h.t==="Para"&&(o=!1),this.fromPandocBlock(h)));c!==null?n.push({tag:"task_list_item",checkbox:c,children:d}):r.push({tag:"list_item",children:d})}if(t.t==="BulletList")return n.length>0?{tag:"task_list",tight:o,children:n}:{tag:"bullet_list",style:"-",tight:o,children:r};if(t.t==="OrderedList"){let i=t.c[0][0],c=t.c[0][1].t;c==="DefaultStyle"&&(c="Decimal");let d=t.c[0][2].t;return d==="DefaultDelim"&&(d="Period"),{tag:"ordered_list",style:de[c][d],start:i,tight:o,children:r}}}case"Table":{let r=st(t.c[0]),n=t.c[1][1],o={tag:"caption",children:[]};n.length>1||n.length===1&&!nn(n[0])?this.warn(new he.Warning("Skipping block-level content in table caption.")):n[0]&&"c"in n[0]&&(o.children=this.fromPandocInlines(n[0].c));let s=t.c[2],i=[];for(let A in s)i.push(s[A][0].t.slice(5).toLowerCase());let c=[],d=t.c[3][1];for(let A in d)c.push(this.fromPandocRow(d[A],!0,0,i));let h=t.c[4];for(let A in h){let I=h[A][1],M=h[A][2];for(let S in M)c.push(this.fromPandocRow(M[S],!0,I,i));let z=h[A][3];for(let S in z)c.push(this.fromPandocRow(z[S],!1,I,i))}let g=t.c[5][1];for(let A in g)c.push(this.fromPandocRow(g[A],!1,0,i));let k={tag:"table",children:[o,...c]};return r&&(k.attributes=r),k}case"Figure":{let r=st(t.c[0]),n=/\bsection\b/.test(r&&r.class||"")?"section":"div",o=t.c[2].map(c=>this.fromPandocBlock(c)),s=t.c[1][1];if(s.length>0){let c=s.map(d=>this.fromPandocBlock(d));o.push(...c)}let i={tag:"div",children:o};return r&&(i.attributes=r),i}case"LineBlock":{let r=[];for(let n=0;n<t.c.length;n++)n>0&&r.push({tag:"hard_break"}),r.push(...this.fromPandocInlines(t.c[n]));return{tag:"para",children:r}}case"Null":return{tag:"raw_block",format:"none",text:""};default:}return{tag:"raw_block",format:"error",text:"Could not convert "+t.t}}fromPandocRow(t,r,n,o){let s=st(t[0]),i=t[1],c=[];for(let h=0;h<i.length;h++)c.push(this.fromPandocCell(i[h],r||h<n,o[h]));let d={tag:"row",head:r,children:c};return s&&(d.attributes=s),d}fromPandocCell(t,r,n){let o=[],s=st(t[0]),i=t[1].t.slice(5).toLowerCase();i==="default"&&(i=n);let c=t[4];c.length>1||c.length===1&&!nn(c[0])?(this.warn(new he.Warning("Skipping table cell with block-level content.")),o=[{tag:"str",text:"((content omitted))"}]):c[0]&&(o=this.fromPandocInlines(c[0].c));let d={tag:"cell",head:r,align:i,children:o};return s&&(d.attributes=s),d}fromPandoc(t){if(typeof t!="object")throw Error("Pandoc document must be an object");if(t["pandoc-api-version"])if(t.blocks){if(!t.meta)throw Error("Pandoc document lacks meta")}else throw Error("Pandoc document lacks blocks");else throw Error("Pandoc document lacks pandoc-api-version");return{tag:"doc",children:t.blocks.map(o=>this.fromPandocBlock(o)),footnotes:this.footnotes,references:{},autoReferences:{}}}},Li=function(e,t){return new en(t).toPandoc(e)};Nt.toPandoc=Li;var Oi=function(e,t){return new rn(t).fromPandoc(e)};Nt.fromPandoc=Oi});var Ar=J(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.renderDjot=void 0;var mt=re(),Cr=ae(),Sr=function(e){let t=e.tag;return t==="space"||t==="soft_break"||t==="hard_break"},zi=function(e){return e.children[0]&&Sr(e.children[0])},Bi=function(e){return e.children[0]&&Sr(e.children[e.children.length-1])},on=function(e,t){let r=e.text.match(/(`+)/g),n={};if(r)for(let s in r)n[r[s].length]=!0;let o=t;for(;n[o];)o++;return"`".repeat(o)},_r=function(e){if(e<0||e>=4e3)return"?";let t="";for(;e>0;)if(e>=1e3)t+="M",e-=1e3;else if(e>=900)t+="CM",e-=900;else if(e>=500)t+="D",e-=500;else if(e>=400)t+="CD",e-=400;else if(e>=100)t+="C",e-=100;else if(e>=90)t+="XC",e-=90;else if(e>=50)t+="L",e-=50;else if(e>=40)t+="XL",e-=40;else if(e>=10)t+="X",e-=10;else if(e==9)t+="IX",e-=9;else if(e>=5)t+="V",e-=5;else if(e==4)t+="IV",e-=4;else if(e>=1)t+="I",e-=1;else throw new Error("toRoman encountered x = "+e);return t},ji=function(e,t){let r=t.replace(/[a-zA-Z0-9]+/g,"$"),n=t.replace(/[.()]/g,""),o;switch(n){case"1":o=e.toString();break;case"a":o=String.fromCodePoint(96+e%26);break;case"A":o=String.fromCodePoint(64+e%26);break;case"i":o=_r(e).toLowerCase();break;case"I":o=_r(e);break;default:throw new Error("formatNumber encountered unknown style "+t)}return r.replace("$",o)},sn=class{constructor(t,r={}){this.prefixes=[],this.buffer=[],this.startOfLine=!0,this.endOfPrefix=0,this.column=0,this.needsBlankLine=!1,this.handlers={doc:n=>{this.renderChildren(n.children),this.prefixes=[],this.cr(),Object.keys(n.references).length>0&&(this.cr(),this.newline());for(let i in n.references)this.renderNode(n.references[i]);let s=Object.keys(n.footnotes).length>0;for(let i in n.footnotes)this.renderNode(n.footnotes[i]);this.prefixes=[],this.cr()},footnote:n=>{this.lit("[^"+n.label+"]:"),this.space(),this.needsBlankLine=!1,this.prefixes.push("  "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},reference:n=>{this.lit("["),this.lit(n.label),this.lit("]:"),this.prefixes.push("  "),this.space(),this.lit(n.destination),this.wrap(),this.prefixes.pop(),this.blankline()},para:n=>{this.renderChildren(n.children),this.blankline()},thematic_break:()=>{this.lit("* * * * *"),this.blankline()},div:n=>{this.lit(":::"),this.cr(),this.renderChildren(n.children),this.cr(),this.lit(":::"),this.blankline()},heading:n=>{let o="#".repeat(n.level);this.lit(o+" "),this.prefixes.push(o+" "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},block_quote:n=>{this.prefixes.push("> "),this.lit("> "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},section:n=>{this.renderChildren(n.children)},code_block:n=>{let o=on(n,3);this.lit(o),n.lang&&this.lit(" "+n.lang),this.cr(),this.litlines(n.text),this.cr(),this.lit(o),this.blankline()},raw_block:n=>{let o=on(n,3);this.lit(o),this.lit(" ="+n.format),this.cr(),this.litlines(n.text),this.cr(),this.lit(o),this.blankline()},definition_list:n=>{let o=n.children;for(let s=0;s<o.length;s++){let i=o[s];s>0&&this.newline(),this.lit(":"),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(2)),this.renderChildren(i.children),this.prefixes.pop()}},ordered_list:n=>{let o=n.style,s=n.start||1,i=n.children,c=n.tight;for(let d=0;d<i.length;d++){let h=i[d];d>0&&(this.cr(),c||this.newline());let g=ji(s+d,o);this.lit(g),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(g.length+1)),this.renderChildren(h.children),this.prefixes.pop()}c&&this.blankline()},bullet_list:n=>{let o=n.children,s=n.tight;for(let i=0;i<o.length;i++){let c=o[i];i>0&&(this.cr(),s||this.newline());let d=n.style;this.lit(d),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(d.length+1)),this.renderChildren(c.children),this.prefixes.pop()}s&&this.blankline()},task_list:n=>{let o=n.children,s=n.tight;for(let i=0;i<o.length;i++){let c=o[i];i>0&&(this.cr(),s||this.newline()),this.needsBlankLine=!1,this.lit(`- [${c.checkbox==="checked"?"X":" "}]`),this.space(),this.prefixes.push(" ".repeat(6)),this.renderChildren(c.children),this.prefixes.pop()}s&&this.blankline()},term:n=>{this.renderChildren(n.children),this.blankline()},definition:n=>{this.renderChildren(n.children)},table:n=>{let o=n.children.filter(mt.isCaption),s=n.children.filter(mt.isRow);for(let i=0;i<s.length;i++){let c=s[i];if("head"in c&&!c.head&&i>0&&s[i-1].head){let d=s[i-1];for(let h=0;h<d.children.length;h++){switch(h===0&&this.lit("|"),d&&d.children[h].align){case"left":this.lit(":--");break;case"right":this.lit("--:");break;case"center":this.lit(":-:");break;default:this.lit("---")}this.lit("|")}this.cr()}for(let d=0;d<c.children.length;d++){let h=c.children[d];d===0&&this.lit("|"),this.noWrap(()=>{h.tag==="cell"&&this.renderChildren(h.children)}),this.lit("|")}this.cr()}o.length>0&&o[0].children.length>0&&(this.newline(),this.lit("^ "),this.needsBlankLine=!1,this.prefixes.push("  "),this.renderChildren(o[0].children),this.prefixes.pop(),this.blankline()),this.blankline()},str:n=>{n.text.split(/  */).forEach((o,s)=>{s>0&&this.space(),this.out(o)})},space:()=>{this.space()},soft_break:()=>{this.soft_break()},smart_punctuation:n=>{this.lit(n.text)},non_breaking_space:()=>{this.lit("\\ ")},single_quoted:this.inlineContainer("'"),double_quoted:this.inlineContainer('"'),emph:this.inlineContainer("_"),strong:this.inlineContainer("*"),superscript:this.inlineContainer("^"),subscript:this.inlineContainer("~"),mark:this.inlineContainer("=",!0),delete:this.inlineContainer("-",!0),insert:this.inlineContainer("+",!0),footnote_reference:n=>{this.lit("[^"+n.text+"]")},symb:n=>{this.lit(":"+n.alias+":")},email:n=>{this.lit("<"+n.text+">")},url:n=>{this.lit("<"+n.text+">")},span:n=>{this.lit("["),this.renderChildren(n.children),this.lit("]")},link:n=>{this.lit("["),this.renderChildren(n.children),this.lit("]"),n.reference?(this.lit("["),n.reference!==(0,Cr.getStringContent)(n)&&this.lit(n.reference),this.lit("]")):n.destination?(this.lit("("),this.lit(n.destination),this.lit(")")):this.lit("()")},image:n=>{this.lit("!["),this.renderChildren(n.children),this.lit("]"),n.reference?(this.lit("["),n.reference!==(0,Cr.getStringContent)(n)&&this.lit(n.reference),this.lit("]")):n.destination?(this.lit("("),this.lit(n.destination),this.lit(")")):this.lit("()")},raw_inline:n=>{this.verbatimNode(n),this.lit("{="+n.format+"}")},verbatim:n=>{this.verbatimNode(n)},inline_math:n=>{this.lit("$"),this.verbatimNode(n)},display_math:n=>{this.lit("$$"),this.verbatimNode(n)}},this.doc=t,this.wrapWidth=(r==null?void 0:r.wrapWidth)||0}escape(t){return t=t.replace(/([~`'"${}[\]^<>\\*_]|-(?=-)|!(=\[)|\.(?=\.))/g,"\\$1"),(this.column===0||this.column===this.endOfPrefix)&&(t=t.replace(/^#/,"\\#")),t}out(t){this.lit(this.escape(t))}doBlankLines(){this.needsBlankLine&&(this.cr(),this.newline(),this.needsBlankLine=!1)}lit(t){this.buffer.push(t),this.column+=t.length,this.startOfLine=!1}blankline(){this.needsBlankLine=!0}newline(){if(this.endOfPrefix===this.column)for(;/  *$|^$/.test(this.buffer[this.buffer.length-1]);)this.buffer[this.buffer.length-1]=this.buffer[this.buffer.length-1].replace(/  *$/,""),this.buffer[this.buffer.length-1]===""&&this.buffer.pop();if(this.endOfPrefix=0,this.column=0,this.buffer.push(`
`),this.prefixes.length>0){for(let t=0,r=this.prefixes.length;t<r;t++)this.buffer.push(this.prefixes[t]),this.column+=this.prefixes[t].length;this.endOfPrefix=this.column}this.startOfLine=!0}cr(){this.startOfLine||this.newline()}wrap(){if(this.wrapWidth<=0)return;let t=this.buffer.length-1;if(!this.startOfLine&&this.buffer.length>0&&this.column>this.wrapWidth){let r;for(;t>=0&&(r=this.buffer[t],r!==" ");){if(/^[ \r\n]+$/.test(r))return;t--}}if(t<this.buffer.length-1){let r=this.buffer.splice(t+1);this.buffer[this.buffer.length-1]===" "&&this.buffer.pop(),this.newline(),this.startOfLine=!0;for(let n=0;n<r.length;n++)this.buffer.push(r[n]),this.column+=r[n].length,this.startOfLine=!1}}space(){this.wrap(),this.lit(" ")}soft_break(){this.wrapWidth===0?this.newline():this.space()}needsBraces(t){return zi(t)||Bi(t)||this.buffer.length>0&&/\w$/.test(this.buffer[this.buffer.length-1])}noWrap(t){let r=this.wrapWidth;this.wrapWidth=-1,t(),this.wrapWidth=r}inlineContainer(t,r){let n=this;return function(o){r=r||n.needsBraces(o),r&&n.lit("{"),n.lit(t),n.renderChildren(o.children),n.lit(t),r&&n.lit("}")}}litlines(t){let r=t.split(/\r?\n/);r[r.length-1]===""&&r.pop();for(let n of r)this.lit(n),this.cr()}verbatimNode(t){let r=on(t,1);this.lit(r),/^`/.test(t.text)&&this.lit(" "),this.lit(t.text),/`$/.test(t.text)&&this.lit(" "),this.lit(r)}renderChildren(t){for(let r=0,n=t.length;r<n;r++)this.renderNode(t[r]);t[0]&&!(0,mt.isBlock)(t[0])&&this.wrap()}renderNode(t){this.doBlankLines();let r=this.handlers[t.tag];if(r)t.attributes&&(0,mt.isBlock)(t)&&(this.renderAttributes(t),this.cr()),r(t),t.attributes&&(0,mt.isInline)(t)&&this.renderAttributes(t);else throw new Error("No renderer defined for node type "+t.tag)}renderAttributes(t){if(!t.attributes||Object.keys(t.attributes).length===0)return;let r=t.attributes;this.lit("{");let n=!0;(0,mt.isBlock)(t)&&this.prefixes.push(" ");for(let o in r){if(n||this.space(),o==="id")this.lit("#"),this.lit(r[o]);else if(o==="class"){let s=r[o].split(/  */);for(let i=0;i<s.length;i++)i>0&&this.space(),this.lit("."),this.lit(s[i])}else this.lit(o),this.lit('="'),this.out(r[o]),this.lit('"');n=!1}(0,mt.isBlock)(t)&&this.prefixes.pop(),this.lit("}")}render(){return this.renderNode(this.doc),this.buffer.join("")}},Gi=function(e,t={}){return new sn(e,t).render()};ue.renderDjot=Gi});var Nr=J(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.version=void 0;pe.version="0.3.1"});var Er=J($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.isInline=$.isBlock=$.version=$.renderDjot=$.toPandoc=$.fromPandoc=$.applyFilter=$.HTMLRenderer=$.renderHTML=$.parseEvents=$.renderAST=$.parse=void 0;var Mr=ae();Object.defineProperty($,"parse",{enumerable:!0,get:function(){return Mr.parse}});Object.defineProperty($,"renderAST",{enumerable:!0,get:function(){return Mr.renderAST}});var Fi=Ke();Object.defineProperty($,"parseEvents",{enumerable:!0,get:function(){return Fi.parseEvents}});var Tr=yr();Object.defineProperty($,"renderHTML",{enumerable:!0,get:function(){return Tr.renderHTML}});Object.defineProperty($,"HTMLRenderer",{enumerable:!0,get:function(){return Tr.HTMLRenderer}});var $i=xr();Object.defineProperty($,"applyFilter",{enumerable:!0,get:function(){return $i.applyFilter}});var Pr=vr();Object.defineProperty($,"fromPandoc",{enumerable:!0,get:function(){return Pr.fromPandoc}});Object.defineProperty($,"toPandoc",{enumerable:!0,get:function(){return Pr.toPandoc}});var Ui=Ar();Object.defineProperty($,"renderDjot",{enumerable:!0,get:function(){return Ui.renderDjot}});var Vi=Nr();Object.defineProperty($,"version",{enumerable:!0,get:function(){return Vi.version}});var Ir=re();Object.defineProperty($,"isBlock",{enumerable:!0,get:function(){return Ir.isBlock}});Object.defineProperty($,"isInline",{enumerable:!0,get:function(){return Ir.isInline}})});var po=J((V0,be)=>{(function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],t=typeof window<"u",r=t&&window.mozInnerScreenX!=null;function n(o,s,i){if(!t)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var c=i&&i.debug||!1;if(c){var d=document.querySelector("#input-textarea-caret-position-mirror-div");d&&d.parentNode.removeChild(d)}var h=document.createElement("div");h.id="input-textarea-caret-position-mirror-div",document.body.appendChild(h);var g=h.style,k=window.getComputedStyle?window.getComputedStyle(o):o.currentStyle,A=o.nodeName==="INPUT";g.whiteSpace="pre-wrap",A||(g.wordWrap="break-word"),g.position="absolute",c||(g.visibility="hidden"),e.forEach(function(z){A&&z==="lineHeight"?g.lineHeight=k.height:g[z]=k[z]}),r?o.scrollHeight>parseInt(k.height)&&(g.overflowY="scroll"):g.overflow="hidden",h.textContent=o.value.substring(0,s),A&&(h.textContent=h.textContent.replace(/\s/g,"\xA0"));var I=document.createElement("span");I.textContent=o.value.substring(s)||".",h.appendChild(I);var M={top:I.offsetTop+parseInt(k.borderTopWidth),left:I.offsetLeft+parseInt(k.borderLeftWidth),height:parseInt(k.lineHeight)};return c?I.style.backgroundColor="#aaa":document.body.removeChild(h),M}typeof be<"u"&&typeof be.exports<"u"?be.exports=n:t&&(window.getCaretCoordinates=n)})()});var gt=e=>Array.isArray(e);var Do=e=>({el:document.querySelector(e),elements:document.querySelectorAll(e),placeholder(t){return this.el.placeholder=t,this},getValue(){return this.el.value},insertAtCaret(t){return this.el.setRangeText(t,this.el.selectionStart,this.el.selectionEnd,"end"),this},setValue(t){this.el.value=t;let r=new Event("input",{bubbles:!0,cancelable:!0});return this.el.dispatchEvent(r),this},innerHTML(t){return this.el.innerHTML=t,this},html(t){return this.el.innerHTML="",this.append(t),this},append(t){return(gt(t)?t:[t]).forEach(n=>{let o=bt(n)?n:document.createTextNode(n);this.el.appendChild(o)}),this},appendListElement(t){let r=document.createElement("LI");return r.appendChild(document.createTextNode(t)),this.el.appendChild(r),this},removeClass(t){return this.el.classList.remove(t),this},removeClasses(t=[]){return t.map(r=>this.removeClass(r)),this},addClass(t){return this.el.classList.add(t),this},hasClass(t){return(" "+this.el.className+" ").indexOf(" "+t+" ")>-1},show(t=!0){return t?this.removeClass("hidden"):this.hide(),this},hide(){return this.addClass("hidden"),this},toggle(t="hidden"){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},focus(){return this.el.focus(),this},listenAll(t,r){return Array.prototype.slice.call(this.elements).map(o=>{o.addEventListener(t,s=>r(s.srcElement))}),this},listen(t,r){return this.el.addEventListener(t,n=>r(n,this)),this},click(){this.el&&this.el.click()},checked(t){return this.el.checked=!!t,this},disable(t=!0){return this.el.disabled=t,this}}),bt=e=>{try{return e instanceof HTMLElement}catch{return typeof e=="object"&&e.nodeType===1&&typeof e.style=="object"&&typeof e.ownerDocument=="object"}},m=Do;var ke={info:"info",success:"success",error:"error",warning:"warning"},ve=m("#notification"),xe=()=>{ve.removeClasses(Object.values(ke))};ve.el.onclick=()=>xe();var Lo=()=>Object.values(ke).reduce((e,t)=>({...e,[t](r){this.showNotification(r,t)}}),{}),Oo=(e=5)=>({autohideDuration:e,timer:void 0,removeAfter(){this.timer=self.setTimeout(()=>{xe()},this.autohideDuration*1e3)},showNotification(t,r=ke.info){xe(),ve.innerHTML(t).addClass(r),clearTimeout(this.timer),this.removeAfter()},...Lo()}),zo=Oo(),C=zo;var Bo=()=>{let e=localStorage.getItem("miropad.user");e?C.info(`\u{1F917} Happy to see you again from ${e}`):C.info(`<h1>Welcome \u{1F44B} \u{1F603} </h1>
       <p>Use  Ctrl+S:  to save your note<p/>
       <p>& Ctrl+P: to format a JSON doc<p/>
      `,100),localStorage.setItem("miropad.user",new Date().toLocaleDateString())},gn=Bo;var jo={set:function(e,t){return localStorage.setItem(e,t),this},update:function(e,t){let r=JSON.parse(this.get(e));return localStorage.setItem(e,JSON.stringify({...r,...t})),this},remove:function(e){return localStorage.removeItem(e),this},get:function(e){return gt(e)?e.reduce((t,r)=>({...t,[r]:this.get(r)}),{}):localStorage.getItem(e)},parse:function(e){let t=this.get(e);return JSON.parse(t)},getDictionary:function(){let e=localStorage.getItem("__dictionary__");return e?JSON.parse(e):[]},removeFromDictionary:function(e){let r=this.getDictionary().filter(n=>n!==e);localStorage.setItem("__dictionary__",JSON.stringify(r))},saveToDictionary:async function(e){if(e.length)try{let t=e.toLowerCase().replace(/[^a-zA-Zά-ώΑ-Ω]/g," "),r=await this.getDictionary(),n=[...t.split(" ").filter(s=>s.length>3),...r],o=[...new Set(n)];localStorage.setItem("__dictionary__",JSON.stringify(o))}catch(t){C.error(`\u{1F631} Something went wrong while trying to save to local storage ${t}`)}else C.warning("\u{1F615} Nothing to save!");return this}},_=jo;var et={github:{client_id:"70c1955dfe4914c52c10",request_state:"miro-pad"},auth_service:"https://vercel-api-phi.vercel.app/api/auth",mail_service:{api:"https://vercel-api-phi.vercel.app/api/mail",signature:`Theo Mironidis <br/>
    Software Engineer <br/>
    https://teomrd.github.io`},file_service:{api:"https://vercel-api-phi.vercel.app/api/upload"}};var Gt=(e,t=_.get("authToken"))=>fetch(`https://api.github.com/gists/${e}`,{headers:{Authorization:`token ${t}`}}).then(r=>{if(!r.ok)throw Error(r.statusText);return r.json()}),bn=(e=_.get("authToken"))=>fetch("https://api.github.com/gists",{headers:{Authorization:`token ${e}`}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}),wn=async(e,t=_.get("gistId"),r=_.get("authToken"))=>{let n=await fetch(`https://api.github.com/gists/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[e]:null},description:"MiroPad Gist",public:!1})});if(!n.ok)throw new Error(n.statusText);let o=await n.json();return C.info(`${e} deleted on Gist!`),o},yn=(e=Z(),t=_.get("gistId"),r=_.get("authToken"))=>{if(t&&r){let n=e.reduce((o,{id:s,text:i,deleted:c})=>({...o,[s]:c?null:{content:i}}),{});return fetch(`https://api.github.com/gists/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:n,description:"MiroPad Gist",public:!1})}).then(o=>{if(!o.ok)throw new Error(o.statusText);return o.json()}).then(o=>(e.map(({id:s,deleted:i})=>{i&&localStorage.removeItem(s)}),o))}},xn=async(e=_.get("authToken"))=>{let r=Z().reduce((s,i)=>({...s,[i.id]:{content:i.text}}),{}),n=await fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${e}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:r,description:"MiroPad Gist",public:!1})});if(!n.ok)throw Error(n.statusText);return await n.json()},kn=(e,t)=>fetch(`${et.auth_service}?state=${t}&code=${e}`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(r=>{if(!r.ok)throw Error(r.statusText);return r.json()}).then(r=>r),vn=async({note:e,token:t=_.get("authToken")})=>{let r=await fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[e.id]:{content:e.text}},description:"MiroPad Gist",public:!0})});if(!r.ok)throw Error(r.statusText);return await r.json()};var tc=new Uint8Array(0);function Cn(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function wt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Go(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,d=e.charAt(0),h=Math.log(c)/Math.log(256),g=Math.log(256)/Math.log(c);function k(M){if(M instanceof Uint8Array||(ArrayBuffer.isView(M)?M=new Uint8Array(M.buffer,M.byteOffset,M.byteLength):Array.isArray(M)&&(M=Uint8Array.from(M))),!(M instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(M.length===0)return"";for(var z=0,S=0,w=0,y=M.length;w!==y&&M[w]===0;)w++,z++;for(var W=(y-w)*g+1>>>0,x=new Uint8Array(W);w!==y;){for(var Y=M[w],tt=0,O=W-1;(Y!==0||tt<S)&&O!==-1;O--,tt++)Y+=256*x[O]>>>0,x[O]=Y%c>>>0,Y=Y/c>>>0;if(Y!==0)throw new Error("Non-zero carry");S=tt,w++}for(var K=W-S;K!==W&&x[K]===0;)K++;for(var it=d.repeat(z);K<W;++K)it+=e.charAt(x[K]);return it}function A(M){if(typeof M!="string")throw new TypeError("Expected String");if(M.length===0)return new Uint8Array;var z=0;if(M[z]!==" "){for(var S=0,w=0;M[z]===d;)S++,z++;for(var y=(M.length-z)*h+1>>>0,W=new Uint8Array(y);M[z];){var x=r[M.charCodeAt(z)];if(x===255)return;for(var Y=0,tt=y-1;(x!==0||Y<w)&&tt!==-1;tt--,Y++)x+=c*W[tt]>>>0,W[tt]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");w=Y,z++}if(M[z]!==" "){for(var O=y-w;O!==y&&W[O]===0;)O++;for(var K=new Uint8Array(S+(y-O)),it=S;O!==y;)K[it++]=W[O++];return K}}}function I(M){var z=A(M);if(z)return z;throw new Error(`Non-${t} character`)}return{encode:k,decodeUnsafe:A,decode:I}}var Fo=Go,$o=Fo,_n=$o;var Ce=class{constructor(t,r,n){B(this,"name");B(this,"prefix");B(this,"baseEncode");this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},_e=class{constructor(t,r,n){B(this,"name");B(this,"prefix");B(this,"baseDecode");B(this,"prefixCodePoint");this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Sn(this,t)}},Se=class{constructor(t){B(this,"decoders");this.decoders=t}or(t){return Sn(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Sn(e,t){return new Se({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Ae=class{constructor(t,r,n,o){B(this,"name");B(this,"prefix");B(this,"baseEncode");B(this,"baseDecode");B(this,"encoder");B(this,"decoder");this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Ce(t,r,n),this.decoder=new _e(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function An({name:e,prefix:t,encode:r,decode:n}){return new Ae(e,t,r,n)}function yt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=_n(r,e);return An({prefix:t,name:e,encode:n,decode:s=>wt(o(s))})}function Uo(e,t,r,n){let o={};for(let g=0;g<t.length;++g)o[t[g]]=g;let s=e.length;for(;e[s-1]==="=";)--s;let i=new Uint8Array(s*r/8|0),c=0,d=0,h=0;for(let g=0;g<s;++g){let k=o[e[g]];if(k===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<r|k,c+=r,c>=8&&(c-=8,i[h++]=255&d>>c)}if(c>=r||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return i}function Vo(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let d=0;d<e.length;++d)for(c=c<<8|e[d],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;s.length*r&7;)s+="=";return s}function nt({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return An({prefix:t,name:e,encode(o){return Vo(o,n,r)},decode(o){return Uo(o,n,r,e)}})}var Mt=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cc=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lc=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dc=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hc=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uc=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pc=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fc=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mc=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ft=yt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wc=yt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var at=yt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kc=yt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ro=Tn,Nn=128,qo=127,Wo=~qo,Ho=Math.pow(2,31);function Tn(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Ho;)t[r++]=e&255|Nn,e/=128;for(;e&Wo;)t[r++]=e&255|Nn,e>>>=7;return t[r]=e|0,Tn.bytes=r-n+1,t}var Jo=Ne,Yo=128,Mn=127;function Ne(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw Ne.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Mn)<<o:(i&Mn)*Math.pow(2,o),o+=7}while(i>=Yo);return Ne.bytes=s-n,r}var Ko=Math.pow(2,7),Qo=Math.pow(2,14),Xo=Math.pow(2,21),Zo=Math.pow(2,28),ts=Math.pow(2,35),es=Math.pow(2,42),ns=Math.pow(2,49),rs=Math.pow(2,56),os=Math.pow(2,63),ss=function(e){return e<Ko?1:e<Qo?2:e<Xo?3:e<Zo?4:e<ts?5:e<es?6:e<ns?7:e<rs?8:e<os?9:10},is={encode:Ro,decode:Jo,encodingLength:ss},as=is,Tt=as;function Pt(e,t=0){return[Tt.decode(e,t),Tt.decode.bytes]}function xt(e,t,r=0){return Tt.encode(e,t,r),t}function kt(e){return Tt.encodingLength(e)}function It(e,t){let r=t.byteLength,n=kt(e),o=n+kt(r),s=new Uint8Array(o+r);return xt(e,s,0),xt(r,s,n),s.set(t,o),new vt(e,r,t,s)}function In(e){let t=wt(e),[r,n]=Pt(t),[o,s]=Pt(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new vt(r,o,i,t)}function En(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Cn(e.bytes,r.bytes)}}var vt=class{constructor(t,r,n,o){B(this,"code");B(this,"size");B(this,"digest");B(this,"bytes");this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Ln(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return ls(r,Me(e),t??at.encoder);default:return ds(r,Me(e),t??Mt.encoder)}}var On=new WeakMap;function Me(e){let t=On.get(e);if(t==null){let r=new Map;return On.set(e,r),r}return t}var Bn,$t=class e{constructor(t,r,n,o){B(this,"code");B(this,"version");B(this,"multihash");B(this,"bytes");B(this,"/");B(this,Bn,"CID");this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Et)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==hs)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=It(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&En(t.multihash,n.multihash)}toString(t){return Ln(this,t)}toJSON(){return{"/":Ln(this)}}link(){return this}[(Bn=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??zn(n,o,s.bytes))}else if(r[us]===!0){let{version:n,multihash:o,code:s}=r,i=In(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Et)throw new Error(`Version 0 CID must use dag-pb (code: ${Et}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=zn(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Et,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=wt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new vt(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[k,A]=Pt(t.subarray(r));return r+=A,k},o=n(),s=Et;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),d=n(),h=r+d,g=h-i;return{version:o,codec:s,multihashCode:c,digestSize:d,multihashSize:g,size:h}}static parse(t,r){let[n,o]=cs(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Me(s).set(n,t),s}};function cs(e,t){switch(e[0]){case"Q":{let r=t??at;return[at.prefix,r.decode(`${at.prefix}${e}`)]}case at.prefix:{let r=t??at;return[at.prefix,r.decode(e)]}case Mt.prefix:{let r=t??Mt;return[Mt.prefix,r.decode(e)]}case Ft.prefix:{let r=t??Ft;return[Ft.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function ls(e,t,r){let{prefix:n}=r;if(n!==at.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function ds(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Et=112,hs=18;function zn(e,t,r){let n=kt(e),o=n+kt(t),s=new Uint8Array(o+r.byteLength);return xt(e,s,0),xt(t,s,n),s.set(r,o),s}var us=Symbol.for("@ipld/js-cid/CID");var ps=new TextEncoder,Lc=new TextDecoder;var jn=512;function Gn(e){return ps.encode(JSON.stringify(e))}function Pe({name:e,code:t,encode:r}){return new Te(e,t,r)}var Te=class{constructor(t,r,n){B(this,"name");B(this,"code");B(this,"encode");this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){let r=this.encode(t);return r instanceof Uint8Array?It(this.code,r):r.then(n=>It(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Fn(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var $n=Pe({name:"sha2-256",code:18,encode:Fn("SHA-256")}),jc=Pe({name:"sha2-512",code:19,encode:Fn("SHA-512")});var ms=async e=>{let t=Gn(e),r=await $n.digest(t);return $t.create(1,jn,r).toString()},Ut=ms;var gs=e=>{try{JSON.parse(e)}catch{return!1}return!0},Vt=gs;var Un=()=>document.title.split("|")[0],Ie=e=>{let t=Un();document.title=t.trim()+" | "+e.trim(),m(".title h3").html(e.trim())},Rt=()=>{let e=Un();document.title=e,m("title").innerHTML("\u270D\uFE0F MiroPad v3.1.16"),m(".title h3").innerHTML('\u270D\uFE0F MiroPad <span class="version">v3.1.16</span>')};var E={baseUrl:`${globalThis.location.origin}${globalThis.location.pathname}`,get:function(){return globalThis.location.href},getPageId:function(e=globalThis.location.href){return new URL(e).hash.slice(1).split("?")[0]||null},getSearchParams:function(e=globalThis.location.href){let n=new URL(e).href.split("?")[1]||"";return new URLSearchParams(n)},getParamsObject:function(e=globalThis.location.href){let t=this.getSearchParams(e),r={};for(let n of t.keys())r={...r,[n]:this.getSearchParam(n,e)};return r},getSearchParam(e,t=globalThis.location.href){return this.getSearchParams(t).get(e)},deleteParam:function(e){let t=this.getSearchParams();Array.isArray(e)?e.forEach(o=>{t.delete(o)}):t.delete(e);let{pathname:r}=globalThis.location,n=this.getPageId();return globalThis.location.assign(`${n?`#${n}`:r}${t.toString()?`?${t.toString()}`:""}`)},set:function(e=this.getPageId(),t=this.getParamsObject()){let r={...this.getParamsObject(),...t},n=new URLSearchParams(r);return globalThis.location.assign(`#${e}?${n.toString()}`)}};var ft=(e=!0)=>{e?(m("#save").removeClass("unsaved"),m("#logo").removeClass("unsaved")):(m("#save").addClass("unsaved"),m("#logo").addClass("unsaved"))};var Vn=e=>{let t=encodeURIComponent(e);if(t.length===0)throw new Error("You need to start with a valid title for your note!");return t},qt=e=>{let t=qn(e),r=V(t);if(r){let{dateCreated:n}=r;return n}throw new Error(`Note "${e}" cannot found!`)},bs=e=>{let t=V(e);t&&localStorage.setItem(e,JSON.stringify({title:t.title,deleted:!0,revisions:t.revisions}))},V=(e=E.getPageId(),t)=>{let r;try{if(r=JSON.parse(_.get(e)),!r.revisions)throw new Error("This is not a note!")}catch{return null}let n=r?Object.values(r.revisions).reduce((s,i)=>i.dateCreated>s.dateCreated?i:s,{dateCreated:0}):{},o=t?r.revisions[t]:n;return e?{...r,id:e,...o||{},numberOfRevisions:r&&r.revisions?Object.keys(r.revisions).length:void 0,title:r.title}:null},Rn=e=>{let t=V();t&&(_.update(t.id,{disableSync:e}),C.info(`"${t.title}" cloud sync ${e?"disabled \u{1F636}":"enabled \u26A1\uFE0F"}`))},Wt=(e=E.getPageId())=>{if(e){let t=E.getSearchParam("v")||void 0,r=V(void 0,t);r&&(m("#revisions").html(`${r.numberOfRevisions} revision${r.numberOfRevisions>1?"s":""}`),Ie(r.title),m(".terminal").setValue(r.text)),r||C.error("404 Note not found \u{1F937}\u200D\u2642\uFE0F")}},Ht=()=>{location.hash="",Rt(),m("#revisions").html(""),m(".terminal").setValue("").focus(),ft()},Ct=(e="")=>e.split(`
`)[0].trim().replace("#","").trim(),qn=e=>{let t=Ct(e);return Vn(t)},Wn=async e=>{if(e.length){let t=qn(e),r=Ct(e),n=V(t);if(n===null)return Jt(e);let{text:o}=n,s=await Ut(e),i=await Ut(o);if(s===i)return;let c=_.get(t),d=JSON.parse(c);_.set(t,JSON.stringify({...d,title:r,revisions:{...d&&d.revisions||{},[s]:{dateCreated:Date.now(),text:e}}}))}},Jt=async(e=m(".terminal").getValue())=>{if(await _.saveToDictionary(e),e.length){let t=await Ut(e);try{let r=e.split(`
`)[0].trim().replace("#","").trim();Ie(r);let n=Vn(r),o=_.get(n),s=JSON.parse(o);_.set(n,JSON.stringify({...s,title:r,lines:e.split(`
`),revisions:{...s&&s.revisions||{},[t]:{dateCreated:Date.now(),text:e}}})),E.set(n,{v:t}),_.set("lastLocalUpdate",new Date),C.success("\u{1F44C} Note saved!"),ft()}catch(r){C.error(`\u{1F631} Something went wrong while trying to save to local storage ${r}`)}}else C.warning("\u{1F615} Nothing to save!")},Z=({includeDeleted:e=!1}={})=>Object.entries(localStorage).filter(([,t])=>typeof t=="string").filter(([t,r])=>!t.startsWith("__")&&Vt(r)).map(([t,r])=>[t,JSON.parse(r)]).filter(([,t])=>!!t.title).reduce((t,[r])=>[...t,V(r)],[]).filter(({deleted:t})=>e?!0:!t),Hn=(e=null)=>e?Z().map(({id:r})=>V(r)).filter(r=>r!==null).filter(({text:r})=>r.toLowerCase().includes(e.toLowerCase()))[0]:void 0,Yt=()=>{if(confirm("Are you sure you want do that?")){let t=V();Ht(),t&&t.id&&(wn(t.id),bs(t.id))}L.hide()};var Jn=()=>!!_.get("authToken");var dt=({title:e,secondary:t,onclick:r,onSecondaryClick:n,icon:o},s=!1)=>{let i=document.createElement("LI");if(i.className=s?"selected":"",o){let h=o.cloneNode(!0);i.appendChild(h)}let c=bt(e)?e:document.createTextNode(e);c.onclick=r,i.appendChild(c);let d=document.createElement("span");if(t){d.className="secondary";let h=bt(t)?t:document.createTextNode(t);h.onclick=n,d.appendChild(h)}return i.appendChild(d),i};var Yn=(e,t)=>{let r=e.toLowerCase().split(t),n=0;return r.reduce((o,s,i)=>[...o,...i===0?[s]:[t,s]],[]).filter(o=>o!=="").map(o=>{n=n+o.length;let s=n-o.length,i=s+o.length;return e.slice(s,i)})};var Kn=e=>{let t=document.createElement("mark");return t.appendChild(document.createTextNode(e)),t},ct=({content:e="",highlight:t=""})=>{let r=document.createElement("div"),n=e.split(" "),o=t.toLowerCase().split(" ");return t.trim()===""?(r.appendChild(document.createTextNode(e)),r):(n.map(s=>{let i=o.map(c=>s.toLocaleLowerCase().includes(c)?c:void 0).filter(c=>c!==void 0);return{word:s,matches:i}}).forEach(({word:s,matches:i})=>{if(i.length>0){let c=i[0];if(s===c)r.appendChild(Kn(` ${s}`));else{let h=Yn(s,c).map(g=>g.toLowerCase()===c?Kn(g):document.createTextNode(g));r.appendChild(document.createTextNode(" ")),h.forEach(g=>{r.appendChild(g)})}}else r.appendChild(document.createTextNode(` ${s} `))}),r)};var Qn=()=>(C.info("You need to be authenticated!"),L.hide(),globalThis.location.replace(`https://github.com/login/oauth/authorize?client_id=${et.github.client_id}&scope=gist&state=${et.github.request_state}`)),Xn=async e=>{C.info("Downloading my Gists!");let t=await bn(e);L.setState({mode:L.getModes().gists}),C.info("Select Gist to sync with");let r=t.sort((o,s)=>new Date(s.updated_at).getTime()-new Date(o.updated_at).getTime()).map(({description:o,updated_at:s,id:i})=>({title:ct({content:`${o}(${i})`}),secondary:s,onclick:async()=>{await _.set("gistId",i),C.success(`${o}(${i}) selected for synchronization!`),Dt(),L.hide()}})),n=dt([{title:"Create a new Gist",onclick:async()=>{C.info("Syncing your MiroPads to a new Gist");try{let{id:o}=await xn();_.set("gistId",o),C.success("MiroPads synced to a new Gist \u{1F389}")}catch(o){C.error(o.message)}L.hide()}},...r]);m("#commands").html(""),m("#commands").append(n)},Dt=async(e=_.get("gistId"))=>{if(_.get("authToken")&&e){m("#logo").addClass("loading");let{files:r}=await Gt(e);Object.values(r).forEach(({content:n})=>{Wn(n)}),_.set("lastSync",new Date),C.success("\u2B07 MiroPad synced \u2705"),m("#logo").removeClass("loading")}},Zn=async()=>{let e=E.getSearchParam("code"),t=E.getSearchParam("state");if(e&&t){m("#logo").addClass("loading"),C.info("\u{1F510} Authenticating...");try{let{token:r}=await kn(e,t);_.set("authToken",r),C.info("\u26F3 You have been authenticated!"),E.deleteParam(["code","state"])}catch(r){C.error(r.message)}m("#logo").removeClass("loading")}};var ws=async(e="no-titled")=>{let t={suggestedName:`${e}`,types:[{description:"MiroPad text notes",accept:{"text/plain":[".miropad"]}}]};return await globalThis.showSaveFilePicker(t)},ys=async(e,t)=>{let r=await e.createWritable();await r.write(t),await r.close()},tr=async(e,t)=>{try{let r=await ws(t);await ys(r,e)}catch{C.error("An error occurred trying to save the file.");return}},er=(()=>{let e=document.createElement("a");return e.setAttribute("style","display: none"),e.setAttribute("id","download-to-file"),e.setAttribute("href","#"),document.body.appendChild(e),(t,r=`MiroPad-${new Date().toISOString()}.json`)=>{let n=JSON.stringify(t),o=new Blob([n],{type:"octet/stream"}),s=globalThis.URL.createObjectURL(o);e.href=s,e.download=r,e.click(),globalThis.URL.revokeObjectURL(s)}})();var fe=mn(Er()),me=e=>(0,fe.renderHTML)((0,fe.parse)(e,{warn:t=>console.log(t.render())}));var an=e=>{if(e.status.toString().slice(0,1)==="2")return e;throw new Error(e)},Ri=(e="")=>`<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
      <style>
      img {
        border-style: none;
        max-width: 100%;
        box-sizing: content-box;
      }
      </style>
    </head>
    <table style="width:100%;background-color:#ffffff" align="center" border="0" cellPadding="0" cellSpacing="0" role="presentation">
      <tbody>
        <tr>
          <td>
            <div><!--[if mso | IE]>
              <table role="presentation" width="100%" align="center" style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px;"><tr><td></td><td style="width:37.5em;background:#ffffff">
            <![endif]--></div>

            <div style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px"><img alt="Theo Mironidis Logo" src="https://teomrd.github.io/miroFavicon.f0c5b85b.png" width="42" height="42" style="display:block;outline:none;border:none;text-decoration:none;width:42px;height:42px" />
              ${e}
              <hr style="width:100%;border:none;border-top:1px solid #eaeaea;border-color:#dfe1e4;margin:42px 0 26px" />
              <a target="_blank" style="color:#b4becc;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen-Sans,Ubuntu,Cantarell,&quot;Helvetica Neue&quot;,sans-serif;font-size:14px" href="https://teomrd.github.io">
              ${et.mail_service.signature}
              </a>
            </div>
            <div><!--[if mso | IE]>
            </td><td></td></tr></table>
            <![endif]--></div>
          </td>
        </tr>
      </tbody>
    </table>
  </html>`,qi=async(e,t,r="MiroPad note")=>{if(!e){C.error("\u{1F47B} No message to send, type something and try again! \u{1F913}");return}try{await fetch(`${et.mail_service.api}`,{method:"POST",headers:{"x-secret-token":_.get("MIROPAD_SECRET_TOKEN"),accept:"application/json","content-type":"application/json"},body:JSON.stringify({to:t,subject:r,html:Ri(e)})}).then(an).then(n=>n.json()),C.success("Email sent \u{1F680}")}catch{C.error("Error not went through \u{1F4A5}! Check your credentials and try again!")}},Wi=()=>{let e=_.get("mail");if(e){let n=globalThis.prompt(`Mail ${e} again? (y)es/(no)`,"yeap");if(n===null)return n;if(n.slice(0,1).toLowerCase()==="y")return e}let t=globalThis.prompt("Where do you wanna send the mail to?"),r=globalThis.prompt("Do you wanna save that to your preferences for later on? (y)es/(no)","yeap");return r&&r.slice(0,1).toLowerCase()==="y"&&_.set("mail",t),t},Dr=e=>{let t=Wi();if(t===null){C.info("Sending mail cancelled \u{1F636}");return}C.info("Sending mail... \u{1F680}");let r=Ct(e),n=me(e);qi(n,t,r)};var ht=async(e,t="\u{1F4CB} Copied to clipboard")=>{try{await navigator.clipboard.writeText(e),C.success(t)}catch(r){C.error(r.message)}};var ge=(e,t,r)=>{let n=gt(e)?e:[e],o=document.createElement("button");return o.setAttribute("type","button"),r&&o.setAttribute("id",r),n.forEach(s=>{typeof s=="string"?o.appendChild(document.createTextNode(s)):o.appendChild(s)}),o.onclick=s=>t(s),o};var Hi={view:m(".preview"),init:function(){return this.update(),m(".terminal").listen("input",()=>this.update()),!!E.getSearchParam("md")?this.view.show():this.view.hide(),this},autoLink:function(){let e=_.parse("__auto-links__");if(!e)return;let t=Object.keys(e).map(o=>`${o}\\w+`).join("|"),r=new RegExp(`(${t})`,"g"),n=this.view.el.innerHTML.replace(r,o=>{let s=Object.keys(e).find(c=>o.startsWith(c)),i=e[s];return i.startsWith("http")?`<a href="${i}${o}" target="_blank">${o}</a>`:`<a href="${i}${o}">${o}</a>`});this.view.innerHTML(n)},update:function(){let md=m(".terminal").getValue();this.view.innerHTML(me(md)),this.autoLink();let{elements}=m("pre");Array.prototype.slice.call(elements).forEach(e=>{let t=ge("\u{1F4CB} Copy",async r=>{r.stopPropagation();let n=r.srcElement.previousSibling.innerHTML;await ht(n,"\u{1F4CB} Code copied to clipboard")});e.appendChild(t)}),m("code").listenAll("click",({innerHTML})=>{let result=eval(innerHTML);m(".console").show().innerHTML(result)}),m(".console").listen("click",async e=>{e.srcElement.classList.add("hidden");let t=e.srcElement.innerHTML;await ht(t,"\u{1F4CB} Code copied to clipboard")})},show:function(e=!0){this.view.show(),E.set(void 0,{md:e})},hide:function(){this.view.hide(),E.deleteParam("md")},toggle:function(e="true"){return E.getSearchParam("md")===e?this.hide():this.show(e),this}},ut=Hi;var Ji=e=>{let t=document.querySelector(e);if(Vt(t.value)){let r=JSON.stringify(JSON.parse(t.value),null,2);t.value=r,C.success("\u{1F44D} JSON value prettified")}else C.error("\u{1F627} Value is not in valid JSON format")},Lr=Ji;var Or=(e=1e3)=>new Promise(t=>{setTimeout(t,e)});var U=(e,t,r)=>{let n=document.createElement("IMG");return r&&n.classList.add(r),t&&n.setAttribute("alt",t),n.setAttribute("src",e),n};var zr="./list-LK7OCHR7.svg";var zt="./trash-RDL437QG.svg";var Br="./checkmark-circle-JQ7ADSUI.svg";var jr="./cloud-sync-F3RLGHML.svg";var Gr="./lighter-UBEI67LL.svg";var Fr="./enter-down-6TVO6OFR.svg";var $r="./download-FVXMIYZ4.svg";var Ur="./envelope-Z2VRVSLR.svg";var Vr="./bug-36UGMUXT.svg";var Rr="./picture-3TDOSVS3.svg";var qr="./printer-B7RMPYZC.svg";var Wr="./page-break-BLVP5QBQ.svg";var Hr="./frame-expand-CX6CNP53.svg";var Jr="./arrow-right-circle-2Q6EHM2H.svg";var Yr="./magic-wand-JQJ6EKRO.svg";var Kr="./rocket-AIY2RJJS.svg";var Qr="./spell-check-V6QYTGNT.svg";var Xr="./pencil-X3ZMY3QU.svg";var cn="./exit-up-GH6BPN2X.svg";var Zr="./leaf-CGBE7XAJ.svg";var to=async()=>{try{let e=V(),t=E.get();await navigator.share({title:e?e.title:"\u270D\uFE0F MiroPad",text:e?e.text:"Temporary note keeping app for the browser",url:t})}catch(e){C.info(`${e.message}`)}};var ma=()=>{let e=_.get("gistId");return _.get("authToken")?e?"Sync: Notes with my GitHub Gist":"Sync: Pick your Gist to sync with":"Sync: Authorize your GitHub account for synchronisation"},ga={title:"Share note",icon:U(cn,"share note"),sortTitle:"Share",call:to},ba={title:"Share public link",key:null,icon:U(cn,"share public link"),sortTitle:"Share public link",call:async()=>{L.hide(),await Jt(m(".terminal").getValue());let e=V();if(e){let r=(await vn({note:e})).history[0].url,n=await fetch(r).then(g=>g.json()),{files:o}=n,s=Object.values(o),[i]=s,{raw_url:c}=i,d=`${E.baseUrl}?raw=${c}`;ht(d,"MiroPad public link copied to clipboard \u{1F4CB}!")}}},ln=()=>[{title:"New note",icon:U(Xr,"new note"),sortTitle:"New",key:"n",call:Ht},{title:"Save",key:"s",icon:U(Br,"save note"),sortTitle:"Save",call:async()=>{L.hide(),await Jt(m(".terminal").getValue());let e=V();e&&!e.disableSync&&yn([e]),ft()}},...navigator.share?[ga]:[],{title:"Toggle MarkDown Viewer",icon:U(Wr,"toggle markdown viewer","rotate90"),sortTitle:"Split",key:"m",call:()=>{ut.toggle(),L.hide()}},{title:"Full MarkDown view",icon:U(Hr,"full view mode"),sortTitle:"Full view",key:"shift m",call:()=>{ut.toggle("full"),L.hide()}},...Jn()?[ba]:[],{title:"Zen mode",icon:U(Zr,"switch to zen mode"),sortTitle:"Zen mode",key:"shift z",call:()=>{!!E.getSearchParam("zen")?E.deleteParam("zen"):E.set(void 0,{zen:!0}),L.hide()}},{title:"List saved notes",icon:U(zr,"list notes"),sortTitle:"Notes",key:"p",call:()=>L.toggle(L.getModes().notes)},{title:"Delete note",key:"shift d",icon:U(zt,"delete note"),sortTitle:"Delete",call:Yt},{title:ma(),icon:U(jr,"sync with github"),key:null,call:async()=>{let e=_.get("authToken");if(!e)return Qn();if(!_.get("gistId"))return await Xn(e);L.hide(),await Dt()}},{title:"Sync: Reset Gist settings",icon:U(Gr,"reset github settings"),key:null,call:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("gistId"),localStorage.removeItem("lastLocalUpdate"),localStorage.removeItem("lastSync"),C.info("Gist setting have been reset!"),L.hide()}},{title:"Toggle sidebar",experimental:!0,key:"shift l",call:()=>{m("aside").toggle()}},{title:"Save to File System...",experimental:!0,icon:U(Fr,"save file"),key:"shift s",call:()=>{let e=V();if(e){let{text:t,title:r}=e;tr(t,r),L.hide()}}},{title:"Email note to...",experimental:!0,icon:U(Ur,"email"),key:"e",call:()=>{let e=m(".terminal").getValue();Dr(e),L.hide()}},{title:"Toggle experimental features",experimental:!1,icon:U(Vr,"lab"),key:null,call:()=>{let e=!!_.get("__experimental__");e?_.remove("__experimental__"):_.set("__experimental__",!0),C.showNotification(`Experimental features turned ${e?"off":"on"}`),L.hide()}},{title:"Toggle Autocompletion",experimental:!1,icon:U(Jr,"autocompletion"),key:null,call:()=>{let e=!!_.get("__autocomplete__");e?_.remove("__autocomplete__"):_.set("__autocomplete__",!0),C.showNotification(`Autocomplete feature turned ${e?"off":"on"}`),L.hide(),m(".terminal").focus()}},{title:"Add a cover picture",experimental:!0,icon:U(Rr,"cover picture"),key:null,call:async()=>{let e=prompt("Paste the image URL in here...");L.hide(),await Or(200),ht(`![bg](${e}){.cover}`,"\u{1F44C}Copied! Paste the code on the MiroPad editor"),m(".terminal").focus(),C.info("Paste the cover picture wherever you prefer on the MirPad editor")}},{title:"Print MarkDown output",experimental:!0,icon:U(qr,"print"),key:null,call:()=>{m(".preview").show(),ut.init(),globalThis.print(),L.hide()}},{key:"j",title:"Prettify JSON document",icon:U(Yr,"prettify json"),call:()=>{Lr(".terminal"),L.hide()}},{title:"Toggle command palette",icon:U(Kr,"toggle command palette"),key:["shift p","k"],call:()=>L.toggle(L.getModes().commands)},{title:"Find and Replace...",experimental:!0,icon:U(Qr,"find and replace"),key:"shift f",call:()=>{let e=m(".terminal").getValue().slice(m(".terminal").el.selectionStart,m(".terminal").el.selectionEnd),t=prompt("What do you wanna find?",e);if(!t)return C.info("Value not found");let r=m(".terminal").getValue().indexOf(t);m(".terminal").el.setSelectionRange(r,r+t.length);let n=prompt(`Replace ${t} with...`);n&&m(".terminal").el.setRangeText(n)}},{title:"Download all notes!",icon:U($r,"Download all notes on your local file system"),call:()=>{let e=Z({includeDeleted:!0});er(e),L.hide()}},{title:"Permanently delete ALL notes \u2757",icon:U(zt,"delete note"),call:()=>{confirm("Are you sure you want do delete ALL your notes?")&&(Z({includeDeleted:!0}).forEach(r=>{_.remove(r.id)}),Ht()),L.hide()}}];var wa={events:[],on(e,t){return Array.isArray(e)?(e.forEach(r=>{let n=r.key||r,o=r.call||t;this.on(n,o)}),this):(e&&typeof e=="string"&&t&&typeof t=="function"&&(this.events=[...this.events,{key:e.includes("shift")?e.replace("shift","").trim():e,shift:e.includes("shift"),fn(){t()}}]),this)},listen(){return document.addEventListener("keydown",e=>{this.handleEvent(e)}),this},handleEvent(e){this.events.map(t=>(t.key===e.key&&(e.ctrlKey===!0||e.metaKey===!0)&&e.shiftKey===t.shift&&(e.preventDefault(),t.fn()),!0))}},eo=wa;var no=(e,t)=>{let r=document.createElement("a");return r.href=t,r.appendChild(bt(e)?e:document.createTextNode(e)),r};var dn=(e,t=new Date)=>{let r=new Date(e).getFullYear(),n=new Date(t).getFullYear();return r===n},so=(e,t=new Date)=>{let r=new Date(e).getMonth(),n=new Date(t).getMonth();return r===n},ya=(e,t=new Date)=>{let r=new Date(e).getDate(),n=new Date(t).getDate();return r===n},ro=(e,t=new Date)=>dn(e,t)&&so(e,t)&&ya(e,t),xa=["January","February","March","April","May","June","July","August","September","October","November","December"],ka=xa.map(e=>e.slice(0,3)),oo=(e=new Date)=>{let t=new Date(e),r=new Date().getDate()-1;return so(t)&&dn(t)&&t.getDate()===r},Bt=e=>{let t=new Date(e),r=oo(e)?"":ka[t.getMonth()],n=dn(t)?"":t.getFullYear(),o=oo(t)?"Yesterday":t.getDate();return`${ro(t)?"":`${o} ${r} ${n}`} ${ro(t)?t.toLocaleTimeString():""}`};var io=e=>e.reduce((r,n)=>{if(r.length===0)return[n];let o=Math.max(...r);return[...r,...n>=o?[n]:[]]},[]).length===e.length;var hn=(e,t)=>{let r=e.split(" ").map(s=>s.toLowerCase()),o=t.split(" ").map(s=>s.toLowerCase()).map(s=>r.map((d,h)=>d.includes(s)?h:-1).reduce((d,h)=>h>-1?h:d,-1));return o.includes(-1)?!1:io(o)};var ao=()=>globalThis.Notification.requestPermission(),co=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(`${globalThis.location.pathname.slice(-1)==="/"?globalThis.location.pathname:`${globalThis.location.origin}/`}service-worker.js?v=v3.1.16`)};var lo=e=>Array.isArray(e)?e.map(t=>lo(t)).join(", "):e?`\u2318+${e.toUpperCase()}`:"",va=(()=>{let e;(c=>(c.off="off",c.notes="notes",c.revisions="revisions",c.commands="commands",c.gists="gists"))(e||(e={}));let t={input:"",mode:"off",options:{selected:0,length:0}};return{getState:function(){return t},getModes:function(){return e},setState:function(r){return t={...t,...r},t},show:function(r="commands"){switch(m("#commander").show(),m("#commander input").focus(),r){case"commands":this.generateCommands(),m("#commander input").setValue("> "),this.setState({mode:"commands"});break;case"notes":this.generateNotes(),m("#commander input").setValue(""),this.setState({mode:"notes"});break;case"revisions":this.generateRevisions(),m("#commander input").setValue(""),this.setState({mode:"revisions"});break;default:break}return this},hide:function(){return m("#commander").hide(),t.mode="off",this},toggle:function(r){return ao(),t.mode==="off"||t.mode!==r?this.show(r):this.hide(),this},commands:function(){return ln()},selectOption:function(r="down"){let n=t.options.selected,o=t.options.length-1,d=r==="down"?n===o?0:n+1:n===0?o:n-1;t.options={...t.options,selected:d}},initCommander:function(){return ln().slice(0,5).map(r=>{m(".mobile-dock").append(ge([r.icon,document.createTextNode(r.sortTitle)],r.call,r.title.toLowerCase().replace(/\s/g,"-")))}),m("#commander button").listen("click",()=>{this.hide()}),m("#commander input").listen("keydown",r=>{r.keyCode===40&&(t.mode==="revisions"&&m("#commands li.selected").click(),this.selectOption("down")),r.keyCode===38&&(t.mode==="revisions"&&m("#commands li.selected").click(),this.selectOption("up"))}).listen("keyup",r=>{r.keyCode===13&&(t.mode==="commands"?m("#commands li.selected div").click():m("#commands li.selected a").click()),r.keyCode===27&&m(".terminal").focus();let n=r.target;t.input!==n.value&&(t.options.selected=0),t.input=n.value,this.generateOptions(n.value)}),this},init:function(){return this.initCommander(),eo.listen().on(this.commands()),m(".menu").listen("click",()=>this.toggle()),m("#revisions").listen("click",()=>this.generateRevisions()),this},generateRevisions:function(){this.show(),t.mode="revisions";let r=V();if(r){let{revisions:n}=r,o=t.options.selected,s=Object.keys(n).sort((i,c)=>{let{dateCreated:d}=n[i],{dateCreated:h}=n[c];return h-d}).map((i,c)=>({title:ct({content:`...${i.slice(-10)}`}),secondary:`${Bt(n[i].dateCreated)}`,onclick:()=>{E.set(void 0,{v:i}),t.options.selected=c,this.generateRevisions()}})).map((i,c)=>dt(i,c===o));m("#commands").html(s),t.options={...t.options,length:s.length}}return this},generateOptions:function(r){switch(t.mode){case"commands":case"notes":r.slice(0,1)===">"?(t.mode="commands",this.generateCommands(r.slice(1).trim()),m("#commander input").placeholder("Search for commands...")):(t.mode="notes",this.generateNotes(r));return;case"revisions":return this.generateRevisions();case"off":break;default:break}},generateNotes:function(r=""){let n=t.options.selected,o=Z().filter(({title:s})=>hn(s,r)).filter(({id:s,deleted:i})=>!i&&s!==E.getPageId()).sort((s,i)=>{let c=qt(s.title);return qt(i.title)-c}).map(({id:s,title:i},c)=>{let d=qt(i),h=`${globalThis.location.origin}${globalThis.location.pathname}#${s}`,g=no(ct({content:i,highlight:r}),h);return dt({title:g,secondary:Bt(d),onclick:()=>{this.hide(),m(".terminal").focus()}},c===n)});return m("#commands").html(o),m("#commander input").placeholder(`Search from ${o.length} saved notes...`),t.options={...t.options,length:o.length},this},generateCommands:function(r=""){let n=t.options.selected,o=this.commands().filter(({title:s})=>hn(s,r)).filter(({experimental:s=!1})=>_.get("__experimental__")?!0:!s).map(({title:s,key:i,call:c,icon:d},h)=>dt({title:ct({content:s,highlight:r}),icon:d,secondary:lo(i),onclick:c},h===n));return m("#commands").html(o),t.options={...t.options,length:o.length},this}}})(),L=va;var ho="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var uo=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=ho[r[e]&63];return t};var fo=mn(po());var Ca=e=>{let t=e.replace(/[\r\n\t]+/g,"").toLowerCase();return jt.getMatchingWords(t)},un=(e,t)=>{let r="",n=t-1;do{let o=e[n]||"";n=o.trim()===""?-1:n-1,r=o.trim()!==""?`${o}${r}`:r}while(n>=0);return r},pn=e=>{let t=(0,fo.default)(e,e.selectionEnd),{top:r,left:n}=t,o=m(".terminal").el.scrollHeight,s=m("main").el;s.style.height=`${o}px`,m(".suggestion").el.style.top=`${r}px`,m(".suggestion").el.style.left=`${n}px`},fn=(e,t)=>e[t]===void 0||e[t].trim()==="",mo=e=>{let t=e.target.selectionEnd,r=D.el.getValue(),n=r[t-1];if(e.inputType==="deleteContentBackward"||n===" ")return D.setState({prediction:null,currentWord:null}),m(".suggestion").hide();let o=un(r,t);if(e.inputType==="insertText"&&fn(r,t)&&!o.startsWith("#")){pn(e.target);let i=Ca(o),[c]=i,d=c||"";D.setState({prediction:d,currentWord:o,matches:i.slice(0,10),options:{selected:0,length:i.length}});let h=D.getState();h.currentWord&&h.prediction&&h.currentWord.length>1?(D.renderInlineSuggestion(),D.renderOptions()):m(".suggestion").hide()}};var go=(e,t)=>e.split(`
`).reduce((o,s)=>{let{isFound:i}=o;if(i)return o;let c=`${o.text}${s}
`,d=c.length;return t>=d?{text:c,isFound:!1}:{text:s,isFound:!0}},{text:"",isFound:!1}).text;var bo=e=>{let t=go(e.target.value,e.target.selectionEnd),r={"* [":`
* [ ] `,"* ":`
* `," * [":`
 * [ ] `," * ":`
 * `};for(let[n,o]of Object.entries(r))if(t.startsWith(n)){e.preventDefault(),m(".terminal").insertAtCaret(o);break}};var wo=e=>{let t=e.target;if(!t)return;let r=t.selectionEnd,n=D.el.getValue(),o=n[r-1];if(e.inputType==="deleteContentBackward"||o===" ")return D.setState({prediction:null,currentWord:null}),m(".suggestion").hide();let s=un(n,r);if(s.startsWith("#")&&e.inputType==="insertText"&&fn(n,r)){pn(e.target);let c=Z().map(M=>M.id),d=s.slice(1),h=c.filter(M=>M.startsWith(d)),[g]=h,k=g,A=d;D.setState({prediction:k,currentWord:A,matches:h.slice(0,10),options:{selected:0,length:h.length}});let I=D.getState();I.currentWord&&I.prediction&&I.currentWord.length>1?(D.renderInlineSuggestion(),D.renderOptions()):m(".suggestion").hide()}};var D=(()=>{let e={matches:[],currentWord:null,prediction:null,options:{selected:0,length:0}},t=e;return{el:m(".terminal"),getState:function(){return t},setState:function(r){return t={...t,...r},t},resetState:function(){D.setState(e)},selectOption:function(r="down"){let n=t.options.selected,o=t.options.length-1,d=r==="down"?n===o?0:n+1:n===0?o:n-1;t.options={...t.options,selected:d},D.setState({prediction:t.matches[t.options.selected]}),D.renderInlineSuggestion(),D.renderOptions()},acceptCompletion:r=>{let n=(i,c)=>{let d=i.toLowerCase().replace(c.toLowerCase(),"");d?m(".terminal").insertAtCaret(`${d} `):m(".terminal").insertAtCaret("  "),m(".suggestion").hide(),D.resetState()},{prediction:o,currentWord:s}=t;if(r&&s)return n(r,s);o&&s&&(n(o,s),jt.insert(o))},renderInlineSuggestion:()=>{let{prediction:r,currentWord:n}=t;if(r&&n){let o=ct({content:`${r.slice(n.length)}`});o.setAttribute("id","inlineSuggestion"),m(".suggestion").show().html(o)}},renderOptions:()=>{let r=m(".suggestion .options");r&&r.el&&r.el.remove();let n=t.options.selected,o=t.matches.map((i,c)=>dt({title:ct({content:i}),secondary:U(zt,"delete word"),onSecondaryClick:()=>{_.removeFromDictionary(i),D.setState({matches:t.matches.filter(d=>d!==i)}),D.renderOptions()},onclick:()=>{D.acceptCompletion(i)},icon:null},c===n)),s=document.createElement("ul");s.classList.add("options"),s.classList.add("frost"),o.forEach(i=>s.append(i)),m(".suggestion").el.append(s)},onFocus:()=>{L.hide(),m(".note-info").hide()},onInput:r=>{!!_.get("__autocomplete__")&&mo(r),wo(r)},onArrowDown:r=>{t.matches.length>0&&(r.preventDefault(),D.selectOption("down"))},onArrowUp:r=>{t.matches.length>0&&(r.preventDefault(),D.selectOption("up"))},onEnter:r=>{t.matches.length>0&&(r.preventDefault(),D.acceptCompletion()),bo(r)},onEscape:()=>{D.resetState(),m(".suggestion").hide()},onTab:r=>{r.preventDefault(),D.acceptCompletion()},onKeyDown:r=>{r.keyCode===13&&D.onEnter(r),r.keyCode===40&&D.onArrowDown(r),r.keyCode===38&&D.onArrowUp(r),r.keyCode===9&&D.onTab(r),r.keyCode===32&&D.setState({prediction:""}),r.keyCode===27&&D.onEscape()},onKeyUp:r=>{let n=V(),o=Ct(r.target.value);m(".title h3").html(o);let{text:s=""}=n||{},i=!!(n&&D.el.getValue()===s);ft(i)},onPaste:async()=>{var n;let r=await navigator.clipboard.read();for(let o of r){let s=(n=o.types)==null?void 0:n.filter(i=>i.startsWith("image/"));for(let i of s){let c=await o.getType(i),d=_.get("MIROPAD_SECRET_TOKEN");if(d){let[h,g]=i.split("/"),k=`${uo()}.${g}`;m("#logo").addClass("loading");try{let{url:A}=await fetch(`${et.file_service.api}?fileName=${k}`,{method:"POST",headers:{"x-secret-token":d,accept:"application/json","content-type":"application/octet-stream"},body:c}).then(an).then(I=>I.json());m(".terminal").insertAtCaret(`![image](${A})`)}catch(A){console.error(A),C.error("Uploading file failed \u{1F4A5}!")}m("#logo").removeClass("loading")}else{let h=URL.createObjectURL(c);m(".terminal").insertAtCaret(`![image](${h})`)}ut.update()}}},init:function(){this.el.listen("focus",this.onFocus).listen("input",this.onInput).listen("keydown",this.onKeyDown).listen("keyup",this.onKeyUp).listen("paste",this.onPaste)}}})();var yo=()=>{let{authToken:e,gistId:t}=_.get(["authToken","gistId"]);return!!(e&&t)};var _a=e=>Object.entries(e).reduce((t,[r,n])=>{let o=t[n]||[];return{...t,[`${n}`]:[r,...o]}},{}),xo=()=>({char:null,children:{},frequency:0,hasChildren:function(){return Object.keys(this.children).length>0},isWord:function(){return this.frequency>0},contains:function(e){return Object.keys(this.children).includes(e)},getWords:function(e,t={}){let r=this;if(r.isWord()&&(t={...t,[e]:this.frequency}),r.hasChildren())for(let n of Object.values(r.children))t=n.getWords(`${e}${n.char}`,t);return t},increaseFrequency:function(){this.frequency=this.frequency+1},insert:function(e){let[t,...r]=e;if(t){let n=r.length===0;if(this.contains(t)){let o=this.children[t];return o.char=t,n&&o.increaseFrequency(),o.insert(r.join(""))}else return this.insertNode(t,n).insert(r.join(""))}},insertNode:function(e,t=!1){let r=xo();return t&&r.increaseFrequency(),r.char=e,this.children={...this.children,[e]:r},r}}),ko=()=>{let e=xo();return{insert:function(t=[]){return(Array.isArray(t)?t:[t]).forEach(n=>e.insert(n)),this},search:function(t=""){let r=e;return t.split("").forEach(n=>{r&&(r=r.children[n])}),r?r.getWords(t):{}},getMatchingWords:function(t=""){let r=_a(this.search(t));return Object.keys(r).sort((n,o)=>parseInt(o,10)-parseInt(n,10)).flatMap(n=>r[n].sort())}}};var Sa=e=>{let{message:t="Unexpected error occurred!"}=e;C.error(t)},vo=Sa;var Aa=async e=>{if(e){let t=await fetch(e).then(r=>{if(r.ok)return r.text();throw new Error(`Remote note could not be retrieved! code: ${r.status}`)});m(".terminal").setValue(t)}},Na=async e=>{if(e)try{let t=await Gt(e),{files:r}=t,n=Object.values(r),[o]=n,{content:s}=o;m(".terminal").setValue(s)}catch{C.error("MiroPad note not found! \u{1F937}\u200D\u2642\uFE0F")}},Co=async e=>{try{let{oldURL:o,newURL:s}=e,i=E.getPageId(o),c=E.getPageId(s),d=i!==c,{v:h}=E.getParamsObject(o),{v:g}=E.getParamsObject(s);[d,h!==g].some(z=>z)&&Wt();let{gistId:I,raw:M}=E.getParamsObject(s);await Na(I),await Aa(M)}catch(o){o instanceof Error?C.error(o.message):C.error("An unknown error occurred")}let t=!E.getPageId();m("#note-info-button").show(!t),m("#new-note").disable(t),E.getSearchParam("md")==="full"?m(".terminal").hide():m(".terminal").show(),E.getSearchParam("zen")==="true"?m(".header").hide():m(".header").show(),m(".note-info").hide();let r=E.getSearchParam("q"),n=Hn(r);n&&m(".terminal").setValue(n.text)};var _o=()=>{m(".task-list-item").listenAll("click",e=>{e.firstChild.checked=!e.firstChild.checked})};var jt=ko(),Ma=()=>{m("#note-info-close").listen("click",()=>{m(".note-info").hide()}),m("#note-info-button").listen("click",()=>{let e=V();if(m(".note-info").show(),m(".note-info .details").innerHTML(`<p>
      <label>
      Title
      </label>
      ${e.title}
      </p>
      <p>
        <label>
        Modified
        </label>
        ${Bt(e.dateCreated)}
      </p>
      <p>
        <label>
        No. of revisions
        </label>
        ${e.numberOfRevisions}
      </p>
      `),yo()&&e){let n=(()=>{let{disableSync:o}=e,s=document.createElement("P");return s.innerHTML=`
          <label>Sync</label>
            <label class="switch" title="Cloud Sync">
              <input id="sync" type="checkbox" ${!o&&"checked"}>
            <span class="slider round"></span>
          </label>
        `,s})();m(".note-info .details").append(n),m("#sync").listen("click",o=>{Rn(!o.target.checked)})}let r=(()=>{let n=document.createElement("P");return n.innerHTML=`
          <button
            class="icon-button"
            type="button"
            id="delete-note"
          >
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="-3 -3 27.5 27.5">
              <path  d="M15.5 2h-3.5v-0.5c0-0.827-0.673-1.5-1.5-1.5h-2c-0.827 0-1.5 0.673-1.5 1.5v0.5h-3.5c-0.827 0-1.5 0.673-1.5 1.5v1c0 0.652 0.418 1.208 1 1.414v12.586c0 0.827 0.673 1.5 1.5 1.5h10c0.827 0 1.5-0.673 1.5-1.5v-12.586c0.582-0.206 1-0.762 1-1.414v-1c0-0.827-0.673-1.5-1.5-1.5zM8 1.5c0-0.276 0.224-0.5 0.5-0.5h2c0.276 0 0.5 0.224 0.5 0.5v0.5h-3v-0.5zM14.5 19h-10c-0.276 0-0.5-0.224-0.5-0.5v-12.5h11v12.5c0 0.276-0.224 0.5-0.5 0.5zM16 4.5c0 0.276-0.224 0.5-0.5 0.5h-12c-0.276 0-0.5-0.224-0.5-0.5v-1c0-0.276 0.224-0.5 0.5-0.5h12c0.276 0 0.5 0.224 0.5 0.5v1z"></path>
              <path  d="M12.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M9.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M6.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
            </svg>
            Delete
          </button>
        `,n})();m(".note-info .details").append(r),m("#delete-note").listen("click",()=>{Yt()})})},Ta=async()=>{let e=_.getDictionary();jt.insert(e),globalThis.addEventListener("error",vo),gn(),L.init(),Ma(),D.init(),Rt(),Wt(E.getPageId()),m(".logo").listen("click",()=>{L.toggle(L.getModes().notes)}),m("#permalink").listen("click",async()=>{await ht(E.get())}),ut.init(),globalThis.addEventListener("hashchange",Co),co(),_o(),await Dt(),await Zn()},So=Ta;So();
//# sourceMappingURL=index.js.map
