var Ar=Object.create;var ye=Object.defineProperty;var Nr=Object.getOwnPropertyDescriptor;var Mr=Object.getOwnPropertyNames;var Tr=Object.getPrototypeOf,Pr=Object.prototype.hasOwnProperty;var Ir=(e,t,o)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var J=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Er=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Mr(t))!Pr.call(e,r)&&r!==o&&ye(e,r,{get:()=>t[r],enumerable:!(n=Nr(t,r))||n.enumerable});return e};var mn=(e,t,o)=>(o=e!=null?Ar(Tr(e)):{},Er(t||!e||!e.__esModule?ye(o,"default",{value:e,enumerable:!0}):o,e));var B=(e,t,o)=>Ir(e,typeof t!="symbol"?t+"":t,o);var _t=J(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.Warning=void 0;var Ee=class{constructor(t,o){this.message=t,typeof o=="number"?this.offset=o:o&&"line"in o&&(this.sourceLoc=o,this.offset=o.offset)}render(){let t=this.message;return this.sourceLoc?t+=` at line ${this.sourceLoc.line}, col ${this.sourceLoc.col}`:this.offset&&(t+=` at offset ${this.offset}`),t}};Kt.Warning=Ee});var Le=J(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.AttributeParser=void 0;var v;(function(e){e[e.SCANNING=0]="SCANNING",e[e.SCANNING_ID=1]="SCANNING_ID",e[e.SCANNING_CLASS=2]="SCANNING_CLASS",e[e.SCANNING_KEY=3]="SCANNING_KEY",e[e.SCANNING_VALUE=4]="SCANNING_VALUE",e[e.SCANNING_BARE_VALUE=5]="SCANNING_BARE_VALUE",e[e.SCANNING_QUOTED_VALUE=6]="SCANNING_QUOTED_VALUE",e[e.SCANNING_QUOTED_VALUE_CONTINUATION=7]="SCANNING_QUOTED_VALUE_CONTINUATION",e[e.SCANNING_ESCAPED=8]="SCANNING_ESCAPED",e[e.SCANNING_ESCAPED_IN_CONTINUATION=9]="SCANNING_ESCAPED_IN_CONTINUATION",e[e.SCANNING_COMMENT=10]="SCANNING_COMMENT",e[e.FAIL=11]="FAIL",e[e.DONE=12]="DONE",e[e.START=13]="START"})(v||(v={}));var xi=/^[a-zA-Z0-9_:-]/,ki=function(e){return xi.exec(e)!==null},H=[];H[v.START]=function(e,t){return e.subject.charAt(t)==="{"?v.SCANNING:v.FAIL};H[v.FAIL]=function(e,t){return v.FAIL};H[v.DONE]=function(e,t){return v.DONE};H[v.SCANNING]=function(e,t){let o=e.subject.charAt(t);return o===`
`||o==="\r"?v.SCANNING:o===" "||o==="	"?(e.addEvent(t,t,"attr_space"),v.SCANNING):o==="}"?v.DONE:o==="#"?(e.begin=t,e.addEvent(t,t,"attr_id_marker"),v.SCANNING_ID):o==="%"?(e.begin=t,v.SCANNING_COMMENT):o==="."?(e.begin=t,e.addEvent(t,t,"attr_class_marker"),v.SCANNING_CLASS):ki(o)?(e.begin=t,v.SCANNING_KEY):v.FAIL};H[v.SCANNING_COMMENT]=function(e,t){let o=e.subject.charAt(t);return o==="%"?(e.begin&&t>e.begin&&e.addEvent(e.begin,t,"comment"),v.SCANNING):o=="}"?v.DONE:v.SCANNING_COMMENT};H[v.SCANNING_ID]=function(e,t){let o=e.subject.charAt(t);return/^[^\]\[~!@#$%^&*(){}`,.<>\\|=+/?\s]/.exec(o)!==null?v.SCANNING_ID:o==="}"?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"id"),e.begin=null,v.DONE):/^\s/.exec(o)!==null?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"id"),o==="\r"||o===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_CLASS]=function(e,t){let o=e.subject.charAt(t);return/^\w/.exec(o)!==null||o==="_"||o==="-"||o===":"?v.SCANNING_CLASS:o==="}"?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"class"),e.begin=null,v.DONE):/^\s/.exec(o)!==null?(e.begin&&e.lastpos&&e.lastpos>e.begin&&e.addEvent(e.begin+1,e.lastpos,"class"),o==="\r"||o===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_KEY]=function(e,t){let o=e.subject.charAt(t);return o==="="&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"key"),e.addEvent(t,t,"attr_equal_marker"),e.begin=null,v.SCANNING_VALUE):/^[a-zA-Z0-9_:-]/.exec(o)!==null?v.SCANNING_KEY:v.FAIL};H[v.SCANNING_VALUE]=function(e,t){let o=e.subject.charAt(t);return o==='"'?(e.begin=t,e.addEvent(t,t,"attr_quote_marker"),v.SCANNING_QUOTED_VALUE):/^[a-zA-Z0-9_:-]/.exec(o)!==null?(e.begin=t,v.SCANNING_BARE_VALUE):v.FAIL};H[v.SCANNING_BARE_VALUE]=function(e,t){let o=e.subject.charAt(t);return/^[a-zA-Z0-9_:-]/.exec(o)!==null?v.SCANNING_BARE_VALUE:o==="}"&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"value"),e.begin=null,v.DONE):/^\s/.exec(o)&&e.begin&&e.lastpos?(e.addEvent(e.begin,e.lastpos,"value"),o==="\r"||o===`
`||e.addEvent(t,t,"attr_space"),e.begin=null,v.SCANNING):v.FAIL};H[v.SCANNING_ESCAPED]=function(e,t){return v.SCANNING_QUOTED_VALUE};H[v.SCANNING_ESCAPED_IN_CONTINUATION]=function(e,t){return v.SCANNING_QUOTED_VALUE_CONTINUATION};H[v.SCANNING_QUOTED_VALUE]=function(e,t){let o=e.subject.charAt(t);return o==='"'&&e.begin&&e.lastpos?(e.addEvent(e.begin+1,e.lastpos,"value"),e.addEvent(t,t,"attr_quote_marker"),e.begin=null,v.SCANNING):o===`
`&&e.begin&&e.lastpos?(e.addEvent(e.begin+1,t,"value"),e.begin=null,v.SCANNING_QUOTED_VALUE_CONTINUATION):o==="\\"?v.SCANNING_ESCAPED:v.SCANNING_QUOTED_VALUE};H[v.SCANNING_QUOTED_VALUE_CONTINUATION]=function(e,t){let o=e.subject.charAt(t);return e.begin===null&&(e.begin=t),o==='"'&&e.begin&&e.lastpos?(e.addEvent(t,t,"attr_quote_marker"),e.addEvent(e.begin,e.lastpos,"value"),e.begin=null,v.SCANNING):o===`
`&&e.begin&&e.lastpos?(e.addEvent(e.begin,t,"value"),e.begin=null,v.SCANNING_QUOTED_VALUE_CONTINUATION):o==="\\"?v.SCANNING_ESCAPED_IN_CONTINUATION:v.SCANNING_QUOTED_VALUE_CONTINUATION};var De=class{constructor(t){this.subject=t,this.state=v.START,this.begin=null,this.lastpos=null,this.matches=[]}addEvent(t,o,n){this.matches.push({startpos:t,endpos:o,annot:n})}feed(t,o){let n=t;for(;n<=o;){if(this.state=H[this.state](this,n),this.state===v.DONE)return{status:"done",position:n};if(this.state===v.FAIL)return this.lastpos=n,{status:"fail",position:n};this.lastpos=n,n=n+1}return{status:"continue",position:o}}};Qt.AttributeParser=De});var Oe=J(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.find=St.pattern=void 0;var vi=function(e){return new RegExp(e,"yd")};St.pattern=vi;var Ci=function(e,t,o,n){t.lastIndex=o;let r;n!==void 0?r=e.substring(0,n+1):r=e;let i=t.exec(r);if(i!==null){let s=1,c=[];if(i.indices.length>1)for(let d=1;d<i.indices.length;d++){let[h,g]=i.indices[d];c.push(r.substring(h,g))}return{startpos:i.indices[0][0],endpos:i.indices[0][1]-1,captures:c}}else return null};St.find=Ci});var lo=J(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.InlineParser=void 0;var _i=Le(),Si=_t(),j=Oe(),no=9,Ue=10,Ve=13,ze=32,oo=33,ro=34,io=39,Be=40,Ai=41,Ni=42,Mi=43,je=45,Ti=46,Pi=58,Ii=60,Ei=61,Ge=91,Fe=92,Di=93,Li=94,Oi=95,zi=96,Xt=123,Zt=125,Bi=126,so=/[\r\n"'()*+.:<=[\\\]^_`${}~-]/g,ao=function(e,t,o){so.lastIndex=t;let n=so.exec(e);return n&&n.index<=o?n.index:null},co=(0,j.pattern)(`[^ 	\r
]`),ji=(0,j.pattern)("[ \\t]*\\r?\\n"),Gi=(0,j.pattern)("['!\"#$%&\\\\'()\\*+,\\-\\.\\/:;<=>?@\\[\\]\\^_`{|}~']"),Fi=(0,j.pattern)("\\<([^<>\\s]+)\\>"),$i=(0,j.pattern)(`[_*~^+='"-]`),Ui=(0,j.pattern)(":[\\w_+-]+:"),Vi=(0,j.pattern)("\\.\\."),Ri=(0,j.pattern)("`*"),qi=(0,j.pattern)("`+"),Wi=(0,j.pattern)("\\$\\$"),Hi=(0,j.pattern)("\\$"),Ji=(0,j.pattern)("\\\\"),Yi=(0,j.pattern)("\\{=[^\\s{}`]+\\}"),Ki=(0,j.pattern)("\\^([^\\]]+)\\]"),$e=function(e,t){return t>0&&e.subject.codePointAt(t-1)===Xt||e.subject.codePointAt(t+1)===Zt},Lt=function(){return!0},lt=function(e,t,o,n){return function(r,i,s){let c=r.subject,d=(0,j.find)(c,co,i+1)!==null&&n(r,i),h=(0,j.find)(c,co,i-1)!==null,g=r.matches[r.matches.length-1],k=g&&g.annot==="open_marker",A=i+1<=s&&c.codePointAt(i+1)===Zt,I=i,M=i;k&&(d=!0,h=!1,M=i-1),!k&&A&&(h=!0,d=!1,I=i+1),k&&o.match(/^right/)?o=o.replace(/^right/,"left"):A&&o.match(/^left/)&&(o=o.replace(/^left/,"right"));let z=e;A&&(z="{"+z);let S=r.openers[z];if(h&&S&&S.length>0){let w=S[S.length-1];if(w.endpos!==i-1)return r.clearOpeners(w.startpos,i),r.addMatch(w.startpos,w.endpos,"+"+t,w.matchIndex),r.addMatch(i,I,"-"+t),I+1}if(d){let w=e;return k&&(w="{"+w),r.addOpener(w,M,i,o),i+1}else return r.addMatch(i,I,o),I+1}},Qi={[zi]:function(e,t,o){let n=e.subject,r=(0,j.find)(n,Ri,t,o);if(r===null)return null;let i=r.endpos;return(0,j.find)(n,Wi,t-2)&&!(0,j.find)(n,Ji,t-3)?(e.matches.pop(),e.matches.pop(),e.addMatch(t-2,i,"+display_math"),e.verbatimType="display_math"):(0,j.find)(n,Hi,t-1)?(e.matches.pop(),e.addMatch(t-1,i,"+inline_math"),e.verbatimType="inline_math"):(e.addMatch(t,i,"+verbatim"),e.verbatimType="verbatim"),e.verbatim=i-t+1,i+1},[Fe]:function(e,t,o){let n=e.subject,r=(0,j.find)(n,ji,t+1,o);if(r!==null){if(e.matches.length>0){let i=e.matches[e.matches.length-1];if(i.annot==="str"){let s=i.endpos,c=i.startpos;for(;s>=c&&(n.codePointAt(s)===ze||n.codePointAt(s)===no);)s=s-1;s<c?e.matches.pop():i.endpos=s}}return e.addMatch(t,t,"escape"),e.addMatch(t+1,r.endpos,"hard_break"),r.endpos+1}else{let i=(0,j.find)(n,Gi,t+1,o);return i!==null?(e.addMatch(t,t,"escape"),e.addMatch(i.startpos,i.endpos,"str"),i.endpos+1):t+1<=o&&n.codePointAt(t+1)===ze?(e.addMatch(t,t,"escape"),e.addMatch(t+1,t+1,"non_breaking_space"),t+2):(e.addMatch(t,t,"str"),t+1)}},[Ii]:function(e,t,o){let n=e.subject,r=(0,j.find)(n,Fi,t,o);if(r===null)return null;let i=r.endpos,s=r.startpos,c=r.captures[0];return c.match(/[^:]@/)?(e.addMatch(s,s,"+email"),e.addMatch(s+1,i-1,"str"),e.addMatch(i,i,"-email"),i+1):c.match(/[a-zA-Z]:/)?(e.addMatch(s,s,"+url"),e.addMatch(s+1,i-1,"str"),e.addMatch(i,i,"-url"),i+1):null},[Bi]:lt("~","subscript","str",Lt),[Li]:lt("^","superscript","str",Lt),[Oi]:lt("_","emph","str",Lt),[Ni]:lt("*","strong","str",Lt),[Mi]:lt("+","insert","str",$e),[Ei]:lt("=","mark","str",$e),[io]:lt("'","single_quoted","right_single_quote",function(e,t){if(t===0)return!0;{let o=e.subject.codePointAt(t-1);return o===ze||o===no||o===Ve||o===Ue||o===ro||o===io||o===je||o===Be||o===Ge}}),[ro]:lt('"',"double_quoted","left_double_quote",Lt),[Xt]:function(e,t,o){return(0,j.find)(e.subject,$i,t+1,o)?(e.addMatch(t,t,"open_marker"),t+1):e.allowAttributes?(e.attributeParser=new _i.AttributeParser(e.subject),e.attributeStart=t,e.attributeSlices=[],t):(e.addMatch(t,t,"str"),t+1)},[Pi]:function(e,t,o){let n=(0,j.find)(e.subject,Ui,t,o);return n?(e.addMatch(n.startpos,n.endpos,"symb"),n.endpos+1):(e.addMatch(t,t,"str"),t+1)},[Ti]:function(e,t,o){return(0,j.find)(e.subject,Vi,t+1,o)?(e.addMatch(t,t+2,"ellipses"),t+3):null},[Ge]:function(e,t,o){let n=(0,j.find)(e.subject,Ki,t+1,o);return n?(e.addMatch(t,n.endpos,"footnote_reference"),n.endpos+1):(e.addOpener("[",t,t,"str"),t+1)},[Di]:function(e,t,o){let n=e.openers["["],r=e.subject;if(n&&n.length>0){let i=n[n.length-1];if(i.annot==="reference_link")return e.strMatches((i.subendpos||i.endpos)+1,t-1),r.codePointAt(i.startpos-1)===oo&&r.codePointAt(i.startpos-2)!==Fe?(e.addMatch(i.startpos-1,i.startpos-1,"image_marker",i.matchIndex-1),e.addMatch(i.startpos,i.endpos,"+imagetext",i.matchIndex),e.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-imagetext",i.subMatchIndex)):(e.addMatch(i.startpos,i.endpos,"+linktext",i.matchIndex),e.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-linktext",i.subMatchIndex)),e.addMatch(i.subendpos||i.endpos,i.subendpos||i.endpos,"+reference",i.subMatchIndex+1),e.addMatch(t,t,"-reference"),e.clearOpeners(i.startpos,t),t+1;if(t+1<=o&&r.codePointAt(t+1)===Ge)return i.annot="reference_link",e.addMatch(t,t,"str"),i.subMatchIndex=e.matches.length-1,e.addMatch(t+1,t+1,"str"),i.substartpos=t,i.subendpos=t+1,e.clearOpeners(i.startpos+1,t-1),t+2;if(t+1<=o&&r.codePointAt(t+1)===Be)return e.openers["("]=[],i.annot="explicit_link",e.addMatch(t,t,"str"),i.subMatchIndex=e.matches.length-1,e.addMatch(t+1,t+1,"str"),i.substartpos=t,i.subendpos=t+1,e.destination=!0,e.clearOpeners(i.startpos+1,t-1),t+2;if(t+1<=o&&r.codePointAt(t+1)===Xt)return e.addMatch(i.startpos,i.endpos,"+span",i.matchIndex),e.addMatch(t,t,"-span"),e.clearOpeners(i.startpos,t),t+1}return null},[Be]:function(e,t,o){return e.destination?(e.addOpener("(",t,t,"str"),t+1):null},[Ai]:function(e,t,o){if(!e.destination)return null;let n=e.openers["("];if(n&&n.length>0)return n.pop(),e.addMatch(t,t,"str"),t+1;{let r=e.subject,i=e.openers["["],s=i[i.length-1];if(i&&i.length>0&&s.annot==="explicit_link")return e.strMatches((s.subendpos||s.endpos)+1,t-1),r.codePointAt(s.startpos-1)===oo&&r.codePointAt(s.startpos-2)!==Fe?(e.addMatch(s.startpos-1,s.startpos-1,"image_marker",s.matchIndex-1),e.addMatch(s.startpos,s.endpos,"+imagetext",s.matchIndex),e.addMatch(s.substartpos||s.startpos,s.substartpos||s.startpos,"-imagetext",s.subMatchIndex)):(e.addMatch(s.startpos,s.endpos,"+linktext",s.matchIndex),e.addMatch(s.substartpos||s.startpos,s.substartpos||s.startpos,"-linktext",s.subMatchIndex)),e.addMatch(s.subendpos||s.endpos,s.subendpos||s.endpos,"+destination",s.subMatchIndex+1),e.addMatch(t,t,"-destination"),e.destination=!1,e.clearOpeners(s.startpos,t),t+1}return null},[je]:function(e,t,o){let n=e.subject;if(n.codePointAt(t-1)===Xt||n.codePointAt(t+1)===Zt){let d=lt("-","delete","str",$e)(e,t,o);if(d)return d}let r=t,i=0;for(;r<=o&&n.codePointAt(r)===je;)r++,i++;if(n.codePointAt(r)===Zt&&i--,i===0)return e.addMatch(t,t+1,"str"),t+2;let s=i%3===0,c=i%2===0;for(;i>0;)s?(e.addMatch(t,t+2,"em_dash"),t=t+3,i=i-3):c?(e.addMatch(t,t+1,"en_dash"),t=t+2,i=i-2):i>=3&&(i%2!==0||i>4)?(e.addMatch(t,t+2,"em_dash"),t=t+3,i=i-3):i>=2?(e.addMatch(t,t+1,"en_dash"),t=t+2,i=i-2):(e.addMatch(t,t,"str"),t=t+1,i=i-1);return t}},Re=class{constructor(t,o={}){this.options=o,this.warn=o.warn||(()=>{}),this.subject=t,this.matches=[],this.openers={},this.verbatim=0,this.verbatimType="",this.destination=!1,this.firstpos=-1,this.lastpos=0,this.allowAttributes=!0,this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,this.matchers=Qi}addMatch(t,o,n,r){let i={startpos:t,endpos:o,annot:n};r!==void 0?this.matches.splice(r,1,i):this.matches.push(i)}inVerbatim(){return this.verbatim>0}singleChar(t){return this.addMatch(t,t,"str"),t+1}reparseAttributes(){let t=this.attributeSlices;if(t!==null){if(this.allowAttributes=!1,this.attributeParser=null,this.attributeStart=null,t!==null)for(let o of t)this.feed(o.startpos,o.endpos);this.allowAttributes=!0,this.attributeSlices=null}}getMatches(){let t=this.subject;this.attributeParser&&this.reparseAttributes();let o=this.matches.length-1;if(this.matches[o]&&this.matches[o].annot==="soft_break"){this.matches.pop();let n=this.matches[this.matches.length-1];if(n&&n.annot==="str"&&t.codePointAt(n.endpos)===32){for(;n.endpos>=n.startpos&&t.codePointAt(n.endpos)===32;)n.endpos=n.endpos-1;n.endpos<n.startpos&&this.matches.pop()}}if(this.matches.length>0&&this.verbatim>0){let n=this.matches[this.matches.length-1];this.warn(new Si.Warning("Unclosed verbatim",n.endpos)),this.matches.push({startpos:n.endpos,endpos:n.endpos,annot:"-"+this.verbatimType})}return this.matches}addOpener(t,o,n,r){this.openers[t]||(this.openers[t]=[]),this.openers[t].push({matchIndex:this.matches.length,startpos:o,endpos:n,annot:null,subMatchIndex:this.matches.length,substartpos:null,subendpos:null}),this.addMatch(o,n,r)}clearOpeners(t,o){for(let n in this.openers){let r=this.openers[n],i=r.length-1;for(;r[i];){let s=r[i];if(s.startpos>=t&&s.endpos<=o)r.splice(i,1);else if(s.substartpos&&s.substartpos>=t&&s.subendpos&&s.subendpos<=o)r[i].substartpos=null,r[i].subendpos=null,r[i].annot=null;else break;i--}}}strMatches(t,o){let n=this.matches.length-1;for(;n>0&&this.matches[n].startpos>=t;)n--;for(this.matches[n].startpos<t&&n++;this.matches[n]&&this.matches[n].endpos<=o;){let r=this.matches[n];r.annot!=="escape"&&r.annot!=="str"&&(r.annot="str"),n++}}feed(t,o){let n=this.subject;(this.firstpos===-1||t<this.firstpos)&&(this.firstpos=t),(this.lastpos===0||o>this.lastpos)&&(this.lastpos=o);let r=t;for(;r<=o;)if(this.attributeParser!==null){let i=r,s=ao(n,r,o),c;s===null?c=o:c=s;let d=this.attributeParser.feed(i,c),h=d.position;if(d.status==="done"){let g=this.attributeStart;g!==null&&this.addMatch(g,g,"+attributes");let k=this.attributeParser.matches;for(let A of k)this.addMatch(A.startpos,A.endpos,A.annot);this.addMatch(h,h,"-attributes"),this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,r=h+1}else d.status==="fail"?(this.reparseAttributes(),r=i):d.status==="continue"&&(this.attributeSlices===null&&(this.attributeSlices=[]),this.attributeSlices.push({startpos:i,endpos:h}),r=h+1)}else{let i=ao(n,r,o),s;if(i===null?s=o+1:s=i,s>r&&(this.addMatch(r,s-1,"str"),r=s,r>o))break;let c=n.codePointAt(r);if(c===void 0)throw new Error("Code point at "+r+" is undefined.");if(c===Ve||c===Ue)c===Ve&&n.codePointAt(r+1)===Ue&&r+1<=o?(this.addMatch(r,r+1,"soft_break"),r=r+2):(this.addMatch(r,r,"soft_break"),r=r+1);else if(this.verbatim>0)if(c===96){let d=(0,j.find)(n,qi,r,o);if(d){let h=d.endpos;if(d.endpos-r+1===this.verbatim){let g=(0,j.find)(n,Yi,h+1,o);g&&this.verbatimType==="verbatim"?(this.addMatch(r,h,"-"+this.verbatimType),this.addMatch(g.startpos,g.endpos,"raw_format"),r=g.endpos+1):(this.addMatch(r,h,"-"+this.verbatimType),r=h+1),this.verbatim=0,this.verbatimType="verbatim"}else this.addMatch(r,h,"str"),r=h+1}else this.addMatch(r,o,"str"),r=o+1}else this.addMatch(r,r,"str"),r=r+1;else{let d=this.matchers[c];if(d){let h=d(this,r,o);h===null?r=this.singleChar(r):r=h}else r=this.singleChar(r)}}}};te.InlineParser=Re});var Ke=J(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.parseEvents=void 0;var ho=_t(),Xi=Le(),G=Oe(),qe=lo(),We=function(e){return e==="+"||e==="-"||e==="*"||e===":"?[e]:/^[+*-] \[[Xx ]\]/.exec(e)?["X"]:/^[(]?[0-9]+[).]/.exec(e)?[e.replace(/[0-9]+/,"1")]:/^[(]?[ivxlcdm][).]/.exec(e)?[e.replace(/[a-z]+/,"i"),e.replace(/[a-z]+/,"a")]:/^[(]?[IVXLCDM][).]/.exec(e)?[e.replace(/[A-Z]+/,"I"),e.replace(/[A-Z]+/,"A")]:/^[(]?[ivxlcdm]+[).]/.exec(e)?[e.replace(/[a-z]+/,"i")]:/^[(]?[IVXLCDM]+[).]/.exec(e)?[e.replace(/[A-Z]+/,"I")]:/^[(]?[a-z][).]/.exec(e)?[e.replace(/[a-z]/,"a")]:/^[(]?[A-Z][).]/.exec(e)?[e.replace(/[A-Z]/,"A")]:[]},Zi=function(e){return e===32||e===9},ts=function(e){return e===10||e===13},uo=(0,G.pattern)("[ \\t]*\\r?\\n"),es=(0,G.pattern)("^\\w+\\s"),ee=(0,G.pattern)("[ \\t\\r\\n]"),ns=(0,G.pattern)("[^ \\t\\r\\n]+"),po=(0,G.pattern)("[>][ \\t\\r\\n]"),fo=(0,G.pattern)("#+"),os=(0,G.pattern)("(~~~~*|````*)([ \\t]*)([^ \\t\\r\\n`]*)[ \\t]*\\r?\\n"),rs=(0,G.pattern)("(:?)--*(:?)([ \\t]*\\|[ \\t]*)"),is=(0,G.pattern)("[^`|\\r\\n]*(?:[|]|`+)"),ss=(0,G.pattern)("\\^[ \\t]+"),as=(0,G.pattern)("\\[\\^([^\\]]+)\\]:[ \\t\\r\\n]"),cs=(0,G.pattern)("[-*][ 	]*[-*][ \\t]*[-*][-* \\t]*\\r?\\n"),ls=(0,G.pattern)("(::::*)[ \\t]*\\r?\\n"),ds=(0,G.pattern)("(::::*)[ \\t]*"),hs=(0,G.pattern)("([\\w_-]*)[ \\t]*\\r?\\n"),us=(0,G.pattern)("\\[([^\\]\\r\\n]*)\\]:[ \\t]*([^ \\t\\r\\n]*)[\\r\\n]"),mo=(0,G.pattern)("(\\|[^\\r\\n]*\\|)[ \\t]*\\r?\\n"),He=(0,G.pattern)("(:?[-*+:]|\\([0-9]+\\)|[0-9]+[.)]|[ivxlcdmIVXLCDM]+[.)]|\\([ivxlcdmIVXLCDM]+\\)|[a-zA-Z][.)]|\\([a-zA-Z]\\))[ \\t\\r\\n]"),Je=(0,G.pattern)("[*+-] \\[[Xx ]\\][ \\t\\r\\n]"),P;(function(e){e[e.None=0]="None",e[e.Inline=1]="Inline",e[e.Block=2]="Block",e[e.Text=3]="Text",e[e.Cells=4]="Cells",e[e.Attributes=5]="Attributes",e[e.ListItem=6]="ListItem"})(P||(P={}));var R=class{constructor(t,o){this.name=t.name,this.type=t.type,this.content=t.content,this.continue=t.continue,this.close=t.close,this.indent=0,this.inlineParser=null,this.attributeParser=null,this.extra=o}},Ye=class{constructor(t,o={}){t.charAt(t.length-1)!==`
`&&(t=t+`
`),this.subject=t,this.maxoffset=t.length-1,this.options=o,this.warn=o.warn||(()=>{}),this.indent=0,this.startline=0,this.starteol=0,this.endeol=0,this.matches=[],this.containers=[],this.pos=0,this.lastMatchedContainer=0,this.finishedLine=!1,this.returned=0,this.paraSpec={name:"para",type:P.Block,content:P.Inline,continue:n=>this.find(ee)===null,open:n=>(this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+para"),!0),close:()=>{this.getInlineMatches(),this.containers.pop();let n=this.matches[this.matches.length-1],r=n&&n.endpos+1||this.pos;this.addMatch(r,r,"-para")}},this.specs=[{name:"block_quote",type:P.Block,content:P.Block,continue:n=>this.find(po)!==null?(this.pos=this.pos+1,!0):!1,open:n=>this.find(po)!==null?(this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+block_quote"),this.pos=this.pos+1,!0):!1,close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-block_quote")}},{name:"heading",type:P.Block,content:P.Inline,continue:n=>{let r=this.find(fo);return r&&n.extra.level===r.endpos-r.startpos+1&&(0,G.find)(this.subject,ee,r.endpos+1)?(this.pos=r.endpos+1,!0):!1},open:n=>{let r=this.find(fo);if(r&&(0,G.find)(this.subject,ee,r.endpos+1)){let i=r.endpos-r.startpos+1;return this.addContainer(new R(n,{level:i})),this.addMatch(r.startpos,r.endpos,"+heading"),this.pos=r.endpos+1,!0}else return!1},close:()=>{this.getInlineMatches(),this.containers.pop();let n=this.matches[this.matches.length-1],r=n&&n.endpos+1||this.pos;this.addMatch(r,r,"-heading")}},{name:"caption",type:P.Block,content:P.Inline,continue:n=>(0,G.find)(this.subject,ee,this.pos)===null,open:n=>{let r=this.find(ss);return r?(this.pos=r.endpos+1,this.addContainer(new R(n,{})),this.addMatch(this.pos,this.pos,"+caption"),!0):!1},close:()=>{this.getInlineMatches(),this.containers.pop(),this.addMatch(this.pos-1,this.pos-1,"-caption")}},{name:"footnote",type:P.Block,content:P.Block,continue:n=>this.indent>(n.extra.indent||0)||this.pos===this.starteol,open:n=>{let r=this.find(as);if(r){let i=r.startpos,s=r.endpos,c=r.captures[0];return this.addContainer(new R(n,{note_label:c,indent:this.indent})),this.addMatch(i,i,"+footnote"),this.addMatch(i+2,s-3,"note_label"),this.pos=s,!0}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-footnote")}},{name:"reference_definition",type:P.Block,content:P.None,continue:n=>{if(n.extra.indent>=this.indent)return!1;let r=this.find(ns);return this.pos<this.starteol&&r&&r.endpos===this.starteol-1?(this.addMatch(this.pos,this.starteol-1,"reference_value"),this.pos=this.starteol,!0):!1},open:n=>{let r=this.find(us);if(r){let i=r.captures[0],s=r.captures[1];return this.addContainer(new R(n,{key:i,indent:this.indent})),this.addMatch(r.startpos,r.startpos,"+reference_definition"),this.addMatch(r.startpos,r.startpos+i.length+1,"reference_key"),s.length>0&&this.addMatch(this.starteol-s.length,this.starteol-1,"reference_value"),this.pos=this.starteol-1,!0}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-reference_definition")}},{name:"thematic_break",type:P.Block,content:P.None,continue:n=>!1,open:n=>{let r=this.find(cs);return r?(this.addContainer(new R(n,{})),this.addMatch(r.startpos,r.endpos,"thematic_break"),this.pos=r.endpos,!0):!1},close:()=>{this.containers.pop()}},{name:"list",type:P.Block,content:P.ListItem,continue:n=>{if(this.indent>n.extra.indent||this.pos===this.starteol)return!0;{let r=this.find(He);if(r===null)return!1;let i=this.subject.substring(r.startpos,r.endpos),s=this.find(Je);s!==null&&(i=this.subject.substring(s.startpos,s.startpos+5));let c=We(i),d=[];for(let h of n.extra.styles)c.includes(h)&&d.push(h);if(d.length>0)return n.extra.styles=d,!0}return!1},open:n=>{let r=this.find(He);if(r===null)return!1;let i=r.startpos,s=r.endpos,c=this.subject.substring(i,s),d=this.find(Je);d!==null&&(c=this.subject.substring(d.startpos,d.startpos+5));let h=We(c);if(h.length===0)return!1;let g={styles:h,indent:this.indent};this.addContainer(new R(n,g));let k="+list";for(let A of h)k=k+"|"+A;return this.addMatch(i,s-1,k),!0},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-list")}},{name:"list_item",type:P.ListItem,content:P.Block,continue:n=>this.indent>n.extra.indent||this.pos===this.starteol,open:n=>{let r=this.find(He);if(r===null)return!1;let i=r.startpos,s=r.endpos,c=this.subject.substring(i,s),d=null,h=this.find(Je);h!==null&&(c=this.subject.substring(h.startpos,h.startpos+5),d=this.subject.substring(h.startpos+3,h.startpos+4));let g=We(c);if(g.length===0)return!1;let k={styles:g,indent:this.indent};this.addContainer(new R(n,k));let A="+list_item";for(let I of g)A=A+"|"+I;return this.addMatch(i,s-1,A),this.pos=s,d&&(d===" "?this.addMatch(i+2,i+4,"checkbox_unchecked"):this.addMatch(i+2,i+4,"checkbox_checked"),this.pos=i+5),!0},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-list_item")}},{name:"table",type:P.Block,content:P.Cells,continue:n=>{let r=this.find(mo);if(r){let i=r.captures[0];return this.parseTableRow(r.startpos,r.startpos+i.length-1)}else return!1},open:n=>{let r=this.find(mo);if(r){this.addContainer(new R(n,{columns:0}));let i=r.captures[0];return this.addMatch(r.startpos,r.startpos,"+table"),this.parseTableRow(r.startpos,r.startpos+i.length-1)?!0:(this.matches.pop(),this.containers.pop(),!1)}else return!1},close:()=>{this.containers.pop(),this.addMatch(this.pos,this.pos,"-table")}},{name:"attributes",type:P.Block,content:P.Attributes,open:n=>{if(this.subject.codePointAt(this.pos)===123){let r=new Xi.AttributeParser(this.subject),i=r.feed(this.pos,this.starteol);if(i.status==="fail")return!1;if(i.status==="done"&&(0,G.find)(this.subject,uo,i.position+1)===null)return!1;{let s=this.addContainer(new R(n,{status:i.status,indent:this.indent,startpos:this.pos,slices:[]}));return s.attributeParser=r,s.extra.slices=[{startpos:this.pos,endpos:this.starteol}],this.pos=this.starteol,!0}}else return!1},continue:n=>{if(n.extra.status==="done")return!1;if(n.attributeParser&&this.indent>n.extra.indent){n.extra.slices.push({startpos:this.pos,endpos:this.starteol});let s=n.attributeParser.feed(this.pos,this.endeol);if(n.extra.status=s.status,s.status!=="fail"||!(0,G.find)(this.subject,uo,s.position+1))return this.pos=this.starteol,!0}this.addMatch(n.extra.startpos,n.extra.startpos,"+para");let r=this.containers.pop(),i=this.addContainer(new R(this.paraSpec,{}));if(!i.inlineParser||!r)throw new Error("Missing inlineParser or attrContainer");return i.inlineParser.attributeSlices=r.extra.slices,i.inlineParser.reparseAttributes(),this.pos=i.inlineParser.lastpos+1,!0},close:()=>{let n=this.containers.pop();if(n)if(n.extra.status==="continue"){this.addMatch(n.extra.startpos,n.extra.startpos,"+para");let r=this.addContainer(new R(this.paraSpec,{}),!0);if(!r||!r.inlineParser)throw new Error("Could not add paragraph");r.inlineParser.attributeSlices=n.extra.slices,r.inlineParser.reparseAttributes(),r.close()}else{if(this.addMatch(n.extra.startpos,n.extra.startpos,"+block_attributes"),n.attributeParser){let r=n.attributeParser.matches;for(let i of r)this.matches.push(i)}this.addMatch(this.pos,this.pos,"-block_attributes")}}},{name:"fenced_div",type:P.Block,content:P.Block,continue:n=>{let r=this.tip();if(r&&r.name==="code_block")return!0;let i=this.find(ls);if(i&&n.extra.colons){let s=i.captures[0];if(s.length>=n.extra.colons)return n.extra.endFenceStartpos=i.startpos,n.extra.endFenceEndpos=i.startpos+s.length-1,this.pos=i.endpos,!1}return!0},open:n=>{let r=this.find(ds);if(!r)return!1;let i=r.captures[0],s=(0,G.find)(this.subject,hs,r.endpos+1);if(!s)return!1;let c=s.startpos,d=s.captures[0];return this.addContainer(new R(n,{colons:i.length})),this.addMatch(r.startpos,r.endpos,"+div"),d.length>0&&this.addMatch(c,c+d.length-1,"class"),this.pos=s.endpos+1,this.finishedLine=!0,!0},close:()=>{let n=this.containers.pop();if(!n)return;let r=n.extra.endFenceStartpos||this.pos,i=n.extra.endFenceEndpos||this.pos;this.addMatch(r,i,"-div"),r===i&&this.warn(new ho.Warning("Unclosed div",this.pos))}},{name:"code_block",type:P.Block,content:P.Text,continue:n=>{let r=this.find(n.extra.closePattern);return r?(n.extra.endFenceStartpos=r.startpos,n.extra.endFenceEndpos=r.startpos+r.captures[0].length-1,this.pos=r.endpos,this.finishedLine=!0,!1):!0},open:n=>{let r=this.find(os);if(r){let[i,s,c]=r.captures,d=c.charAt(0)==="="&&!0||!1,h=(0,G.pattern)("("+i+i.substring(0,1)+"*)[ \\t]*[\\r\\n]"),g=this.addContainer(new R(n,{closePattern:h}));if(g.indent=this.indent,this.addMatch(r.startpos,r.startpos+i.length-1,"+code_block"),c.length>0){let k=r.startpos+i.length+s.length;d?this.addMatch(k,k+c.length-1,"raw_format"):this.addMatch(k,k+c.length-1,"code_language")}return this.pos=r.endpos,this.finishedLine=!0,!0}else return!1},close:()=>{let n=this.containers.pop();if(!n)return;let r=n.extra.endFenceStartpos||this.pos,i=n.extra.endFenceEndpos||this.pos;this.addMatch(r,i,"-code_block"),r===i&&this.warn(new ho.Warning("Unclosed code block",this.pos))}}]}find(t){return(0,G.find)(this.subject,t,this.pos)}tip(){return this.containers.length>=1?this.containers[this.containers.length-1]:null}addMatch(t,o,n){this.matches.push({startpos:Math.min(t,this.maxoffset),endpos:Math.min(o,this.maxoffset),annot:n})}getInlineMatches(){var t;let o=(t=this.tip())===null||t===void 0?void 0:t.inlineParser;if(o){let n;for(let r of o.getMatches())n&&n.annot==="str"&&r.annot==="str"&&r.startpos===n.endpos+1?this.matches[this.matches.length-1].endpos=r.endpos:this.matches.push(r),n=r}}closeUnmatchedContainers(){let t=this.lastMatchedContainer,o=this.tip();for(;o&&this.containers.length-1>t;)o.close(),o=this.tip()}addContainer(t,o){o||this.closeUnmatchedContainers();let n=this.tip();for(;n&&n.content!==t.type;)n.close(),n=this.tip();return t.content===P.Inline&&(t.inlineParser=new qe.InlineParser(this.subject,{warn:this.warn})),this.containers.push(t),t}skipSpace(){let t=this.subject,o=this.pos;for(;Zi(t.codePointAt(o));)o++;this.indent=o-this.startline,this.pos=o}getEol(){let t=this.subject,o=this.pos;for(;!ts(t.codePointAt(o));)o++;this.starteol=o,t.codePointAt(o)===13&&t.codePointAt(o+1)===10?this.endeol=o+1:this.endeol=o}parseTableCell(){let t=new qe.InlineParser(this.subject,{warn:this.warn}),o=!1,n=this.pos-1,r=n;for(this.skipSpace();!o;){let i=this.find(is);if(i===null){o=!1;break}else{let s=i.endpos;this.subject.charAt(s)==="`"||t.inVerbatim()?t.feed(this.pos,s):this.subject.charAt(s-1)==="\\"?t.feed(this.pos,s):(t.feed(this.pos,s-1),r=s,o=!0),this.pos=s+1}}if(o){let i=t.getMatches();return{startpos:n,endpos:r,matches:i}}else return null}parseTableRow(t,o){let n=this.matches.length,r=this.pos;this.addMatch(t,t,"+row"),this.pos++;let i=[],s=this.pos,c=!1;for(;!c;){let d=(0,G.find)(this.subject,rs,s);if(d!==null){let[h,g,k]=d.captures,A="separator_default";if(h.length>0&&g.length>0?A="separator_center":g.length>0?A="separator_right":h.length>0&&(A="separator_left"),i.push({startpos:d.startpos,endpos:d.endpos-k.length,annot:A}),s=d.endpos+1,s===this.starteol){c=!0;break}}else break}if(c){for(let d of i)this.addMatch(d.startpos,d.endpos,d.annot);return this.addMatch(this.starteol-1,this.starteol-1,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}for(;this.pos<=o;){let d=this.parseTableCell();if(d!==null){this.addMatch(d.startpos,d.startpos,"+cell");let h=d.matches;h.forEach((g,k)=>{let A=g.startpos,I=g.endpos;if(k===h.length-1&&g.annot==="str")for(;this.subject.codePointAt(I)===32&&I>=A;)I=I-1;this.addMatch(A,I,g.annot)}),this.addMatch(d.endpos,d.endpos,"-cell")}else{for(this.pos=r;this.matches.length>n;)this.matches.pop();return!1}}return this.addMatch(this.pos,this.pos,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}[Symbol.iterator](){let t=this.specs,o=this.subject.length;this.returned=0;let n=this;return{next(){for(;n.pos<o;){if(n.matches.length>0&&n.returned<n.matches.length)return n.returned=n.returned+1,{value:n.matches[n.returned-1],done:!1};n.indent=0,n.startline=n.pos,n.finishedLine=!1,n.getEol(),n.lastMatchedContainer=-1;let r=0;for(;r<n.containers.length;){let i=n.containers[r];if(n.skipSpace(),i.continue(i))n.lastMatchedContainer=r;else break;r=r+1}if(n.finishedLine)for(;n.containers.length>0&&n.lastMatchedContainer<n.containers.length-1;){let i=n.tip();i&&i.close()}if(!n.finishedLine){n.skipSpace();let i=n.pos===n.starteol,s=!1,c=n.containers[n.lastMatchedContainer],d=!i&&(!c||c.content===P.Block||c.content===P.ListItem)&&!n.find(es);for(;d;){d=!1;for(let h of t)if((!c&&h.type===P.Block||c&&c.content===h.type)&&h.open(h)){if(n.tip())n.lastMatchedContainer=n.containers.length-1,c=n.containers[n.lastMatchedContainer],n.finishedLine?d=!1:(n.skipSpace(),s=!0,d=h.content===P.Block||h.content===P.ListItem);else throw new Error("No tip after opening container");break}}if(!n.finishedLine){n.skipSpace(),i=n.pos===n.starteol;let h=n.tip();if(!i&&!s&&n.lastMatchedContainer<n.containers.length-1&&h&&h.content===P.Inline||n.closeUnmatchedContainers(),h=n.tip(),(!h||h.content===P.Block)&&(i?s||n.addMatch(n.pos,n.endeol,"blankline"):(n.paraSpec.open(n.paraSpec),h=n.tip(),h&&(h.inlineParser=new qe.InlineParser(n.subject,n.options)))),h&&h.content===P.Text){let k=n.pos;h.indent!==null&&n.indent>h.indent&&(k=k-(n.indent-h.indent)),n.addMatch(k,n.endeol,"str")}else h&&h.content===P.Inline&&!i&&h.inlineParser&&h.inlineParser.feed(n.pos,n.endeol)}}n.pos=(n.endeol||n.pos)+1}return n.lastMatchedContainer=-1,n.closeUnmatchedContainers(),n.matches.length>0&&n.returned<n.matches.length?(n.returned=n.returned+1,{value:n.matches[n.returned-1],done:!1}):{value:{startpos:n.pos,endpos:n.pos,annot:""},done:!0}}}}},ps=function(e,t={}){return new Ye(e,t)};ne.parseEvents=ps});var oe=J(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.isCaption=ot.isRow=ot.isBlock=ot.isInline=void 0;var fs={para:!0,heading:!0,block_quote:!0,thematic_break:!0,section:!0,div:!0,code_block:!0,raw_block:!0,bullet_list:!0,ordered_list:!0,task_list:!0,definition_list:!0,table:!0,reference:!0,footnote:!0};function ms(e){return fs[e.tag]||!1}ot.isBlock=ms;var gs={str:!0,soft_break:!0,hard_break:!0,non_breaking_space:!0,symb:!0,verbatim:!0,raw_inline:!0,inline_math:!0,display_math:!0,url:!0,email:!0,footnote_reference:!0,smart_punctuation:!0,emph:!0,strong:!0,link:!0,image:!0,span:!0,mark:!0,superscript:!0,subscript:!0,insert:!0,delete:!0,double_quoted:!0,single_quoted:!0};function bs(e){return gs[e.tag]||!1}ot.isInline=bs;function ws(e){return"head"in e}ot.isRow=ws;function ys(e){return!("head"in e)}ot.isCaption=ys});var ae=J(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.isInline=q.isCaption=q.isRow=q.isBlock=q.getStringContent=q.renderAST=q.parse=void 0;var xs=Ke(),go=_t(),se=oe();Object.defineProperty(q,"isRow",{enumerable:!0,get:function(){return se.isRow}});Object.defineProperty(q,"isBlock",{enumerable:!0,get:function(){return se.isBlock}});Object.defineProperty(q,"isCaption",{enumerable:!0,get:function(){return se.isCaption}});Object.defineProperty(q,"isInline",{enumerable:!0,get:function(){return se.isInline}});var Xe=function(e){let t=[];return wo(e,t),t.join("")};q.getStringContent=Xe;var wo=function(e,t){if("text"in e)t.push(e.text);else if("tag"in e&&(e.tag==="soft_break"||e.tag==="hard_break"))t.push(`
`);else if("children"in e)for(let o of e.children)wo(o,t)},Qe=function(e){return e.replace(/^ `/,"`").replace(/` $/,"`")},ks={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3,I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},bo=function(e){let t=0,o=0,n=e.length-1;for(;n>=0;){let r=e.charAt(n),i=ks[r];if(!i)throw new Error("Encountered bad character in roman numeral "+e);i<o?t=t-i:t=t+i,o=i,n=n-1}return t},vs=function(e,t){let o=t.replace(/[().]/g,""),n=e.replace(/[().]/g,"");switch(o){case"1":return parseInt(n,10);case"A":return(n.codePointAt(0)||65)-65+1;case"a":return(n.codePointAt(0)||97)-97+1;case"I":return bo(n);case"i":return bo(n)}},F;(function(e){e[e.Normal=0]="Normal",e[e.Verbatim=1]="Verbatim",e[e.Literal=2]="Literal"})(F||(F={}));var Ot=function(e){return e.trim().replace(/[ \t\r\n]+/g," ")},Cs=function(e,t={}){let o=[-1];if(t.sourcePositions)for(let u=0;u<e.length;u++)e[u]===`
`&&o.push(u);let n=function(u){let p=o.length,f=0,l=p-1,a=0,b=0;for(;!a;){let N=f+~~((l-f)/2);o[N]>u?l=N:o[N]<=u&&(N===l||o[N+1]>u?(a=N+1,b=u-o[N]):f===N&&f<l?f=N+1:f=N)}return{line:a,col:b,offset:u}},r=F.Normal,i="",s={},c={},d={},h={},g={},k=0,A=(0,xs.parseEvents)(e,t),I=t.warn||(()=>{}),M=function(u){if(Object.keys(g).length>0){u.attributes=u.attributes||{};for(let p in g)u.attributes[p]=g[p],delete g[p]}},z=function(u){let p=u.replace(/[\]\[~!@#$%^&*(){}`,.<>\\|=+/?\s]+/g," ").trim().replace(/ +/g,"-"),f=0,l=p;for(;!l||h[l];)f=f+1,l=(p||"s")+"-"+f;return l},S=function(u){let p={children:[],data:{},pos:u,attributes:void 0};M(p),O.push(p)},w=function(u){let p=O.pop();if(!p)throw new Error("Container stack is empty (popContainer)");return u&&p.pos&&(p.pos.end=u.end),p},y=function(){if(O.length>0)return O[O.length-1];throw new Error("Container stack is empty (topContainer)")},W=function(){let u=y();return u.children.length>0?u.children[u.children.length-1]:u},x=function(u){O.length>0&&O[O.length-1].children.push(u)},Y={str:(u,p,f,l)=>{let a=e.substring(p,f+1);r===F.Normal?x({tag:"str",text:a,pos:l}):i+=a},soft_break:(u,p,f,l)=>{r===F.Normal?x({tag:"soft_break",pos:l}):i+=`
`},escape:(u,p,f,l)=>{r===F.Verbatim&&(i+="\\")},hard_break:(u,p,f,l)=>{r===F.Normal?x({tag:"hard_break",pos:l}):i+=`
`},non_breaking_space:(u,p,f,l)=>{r===F.Verbatim?i+="\\ ":x({tag:"non_breaking_space",pos:l})},symb:(u,p,f,l)=>{if(r===F.Normal){let a=e.substring(p+1,f);x({tag:"symb",alias:a,pos:l})}else{let a=e.substring(p,f+1);i+=a}},footnote_reference:(u,p,f,l)=>{let a=e.substring(p+2,f);x({tag:"footnote_reference",text:Ot(a),pos:l})},"+reference_definition":(u,p,f,l)=>{S(l)},"-reference_definition":(u,p,f,l)=>{let a=w(l),b=Ot(a.data.key),N={tag:"reference",label:b,destination:a.data.value||"",attributes:a.attributes,pos:a.pos};a.data.key&&(s[b]=N)},reference_key:(u,p,f,l)=>{y().data.key=e.substring(p+1,f),y().data.value=""},reference_value:(u,p,f,l)=>{y().data.value=y().data.value+e.substring(p,f+1)},"+emph":(u,p,f,l)=>{S(l)},"-emph":(u,p,f,l)=>{let a=w(l);x({tag:"emph",children:a.children,pos:a.pos})},"+strong":(u,p,f,l)=>{S(l)},"-strong":(u,p,f,l)=>{let a=w(l);x({tag:"strong",children:a.children,pos:a.pos})},"+span":(u,p,f,l)=>{S(l)},"-span":(u,p,f,l)=>{let a=w(l);x({tag:"span",children:a.children,pos:a.pos})},"+mark":(u,p,f,l)=>{S(l)},"-mark":(u,p,f,l)=>{let a=w(l);x({tag:"mark",children:a.children,pos:a.pos})},"+superscript":(u,p,f,l)=>{S(l)},"-superscript":(u,p,f,l)=>{let a=w(l);x({tag:"superscript",children:a.children,pos:a.pos})},"+subscript":(u,p,f,l)=>{S(l)},"-subscript":(u,p,f,l)=>{let a=w(l);x({tag:"subscript",children:a.children,pos:a.pos})},"+delete":(u,p,f,l)=>{S(l)},"-delete":(u,p,f,l)=>{let a=w(l);x({tag:"delete",children:a.children,pos:a.pos})},"+insert":(u,p,f,l)=>{S(l)},"-insert":(u,p,f,l)=>{let a=w(l);x({tag:"insert",children:a.children,pos:a.pos})},"+double_quoted":(u,p,f,l)=>{S(l)},"-double_quoted":(u,p,f,l)=>{let a=w(l);x({tag:"double_quoted",children:a.children,pos:a.pos})},"+single_quoted":(u,p,f,l)=>{S(l)},"-single_quoted":(u,p,f,l)=>{let a=w(l);x({tag:"single_quoted",children:a.children,pos:a.pos})},"+attributes":(u,p,f,l)=>{S(l)},"-attributes":(u,p,f,l)=>{let a=w(l);if(a.attributes&&O.length>0){a.attributes.id&&(h[a.attributes.id]=!0);let b=W();if(b===y())return;let N=!1;if("tag"in b&&b.tag==="str"){let T=b.text.match(/[^\s]+$/);if(T&&T.index&&T.index>0){let Q;if(b.pos){let X=b.pos.end;b.pos.end={line:X.line,col:X.col-T[0].length,offset:X.offset-T[0].length},Q={start:{line:X.line,col:X.col-T[0].length+1,offset:X.offset-T[0].length+1},end:X}}b.text=b.text.substring(0,T.index),x({tag:"str",text:T[0],pos:Q})}else T||(N=!0)}if(b=W(),N){I(new go.Warning("Ignoring unattached attribute",t.sourcePositions?n(p):p));return}b.attributes||(b.attributes={});for(let T in a.attributes)T==="class"&&b.attributes[T]?b.attributes[T]=b.attributes[T]+" "+a.attributes[T]:b.attributes[T]=a.attributes[T]}},"+block_attributes":(u,p,f,l)=>{S(l)},"-block_attributes":(u,p,f,l)=>{let a=w(l);if(a.attributes&&O.length>0){a.attributes.id&&(h[a.attributes.id]=!0);for(let b in a.attributes)b==="class"&&g[b]?g[b]=g[b]+" "+a.attributes[b]:g[b]=a.attributes[b]}},class:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.attributes||(a.attributes={}),a.attributes.class?a.attributes.class=a.attributes.class+" "+b:a.attributes.class=b},id:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.attributes?a.attributes.id=b:a.attributes={id:b}},key:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1);a.data.key=b,a.attributes||(a.attributes={}),a.attributes[a.data.key]=""},value:(u,p,f,l)=>{let a=y(),b=e.substring(p,f+1).replace(/[ \r\n]+/g," ").replace(/\\([.,\\/#!$%^&*;:{}=\-_`~+[\]()'"?|])/g,"$1");if(a.attributes||(a.attributes={}),a.data.key)a.attributes[a.data.key]=a.attributes[a.data.key]+b;else throw new Error("Encountered value without key")},"+linktext":(u,p,f,l)=>{S(l),y().data.isimage=!1},"-linktext":(u,p,f,l)=>{},"+imagetext":(u,p,f,l)=>{S(l),y().data.isimage=!0},"-imagetext":(u,p,f,l)=>{},"+destination":(u,p,f,l)=>{r=F.Literal},"-destination":(u,p,f,l)=>{let a=w(l);x({tag:a.data.isimage?"image":"link",destination:i.replace(/[\r\n]/g,""),children:a.children,pos:a.pos}),r=F.Normal,i=""},"+reference":(u,p,f,l)=>{r=F.Literal},"-reference":(u,p,f,l)=>{let a=w(l),b=i;b.length===0&&(b=Xe(a)),x({tag:a.data.isimage?"image":"link",reference:Ot(b),children:a.children,pos:a.pos}),r=F.Normal,i=""},"+verbatim":(u,p,f,l)=>{r=F.Verbatim,S(l)},"-verbatim":(u,p,f,l)=>{let a=w(l);x({tag:"verbatim",text:Qe(i),pos:a.pos}),r=F.Normal,i=""},raw_format:(u,p,f,l)=>{let a=e.substring(p,f+1).replace(/^\{?=/,"").replace(/\}$/,""),b=y();if(r===F.Verbatim)b.data.format=a;else{let N=b.children[b.children.length-1];if(N&&"tag"in N&&N.tag==="verbatim")N.tag="raw_inline",N.format=a;else throw new Error("raw_format is not after verbatim or code_block.")}},"+display_math":(u,p,f,l)=>{r=F.Verbatim,S(l)},"+inline_math":(u,p,f,l)=>{r=F.Verbatim,S(l)},"-display_math":(u,p,f,l)=>{let a=w(l);x({tag:"display_math",text:Qe(i),pos:a.pos}),r=F.Normal,i=""},"-inline_math":(u,p,f,l)=>{let a=w(l);x({tag:"inline_math",text:Qe(i),pos:a.pos}),r=F.Normal,i=""},"+url":(u,p,f,l)=>{r=F.Literal,S(l)},"-url":(u,p,f,l)=>{let a=w(l);x({tag:"url",text:i.replace(/[\r\n]/g,""),pos:a.pos}),r=F.Normal,i=""},"+email":(u,p,f,l)=>{r=F.Literal,S(l)},"-email":(u,p,f,l)=>{let a=w(l);x({tag:"email",text:i.replace(/[\r\n]/g,""),pos:a.pos}),r=F.Normal,i=""},"+para":(u,p,f,l)=>{S(l)},"-para":(u,p,f,l)=>{let a=w(l);x({tag:"para",children:a.children,attributes:a.attributes,pos:a.pos})},"+heading":(u,p,f,l)=>{S(l),y().data.level=1+f-p},"-heading":(u,p,f,l)=>{let a=w(l);a.attributes||(a.attributes={}),a.autoAttributes||(a.autoAttributes={});let b=Xe(a).trim();a.attributes.id||(a.autoAttributes.id=z(b),h[a.autoAttributes.id]=!0);let N=Ot(b);!s[N]&&!c[N]&&(c[N]={tag:"reference",label:N,destination:"#"+(a.attributes.id||a.autoAttributes.id)});let T=y();if(T.data.headinglevel!==void 0){for(;T&&T.data.headinglevel!==void 0&&T.data.headinglevel>=a.data.level;)T=w(l),x({tag:"section",children:T.children,attributes:T.attributes,autoAttributes:T.autoAttributes,pos:T.pos}),T=y();S(l),y().data.headinglevel=a.data.level,a.autoAttributes&&a.autoAttributes.id&&(y().autoAttributes=a.autoAttributes,delete a.autoAttributes),a.attributes&&a.attributes.id&&(y().attributes=a.attributes,delete a.attributes)}x({tag:"heading",level:a.data.level,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+list":(u,p,f,l)=>{S(l),y().data.styles=u,y().data.blanklines=!1,y().data.tight=!0,k++},"-list":(u,p,f,l)=>{let a=w(l),b=a.data.styles[0];if(!b)throw new Error("No style defined for list");let N=vs(a.data.firstMarker,b);x(b===":"?{tag:"definition_list",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:b==="X"?{tag:"task_list",tight:a.data.tight,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:b==="+"||b==="*"||b==="-"?{tag:"bullet_list",tight:a.data.tight,style:b,children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}:{tag:"ordered_list",style:b,children:a.children,start:N,tight:a.data.tight,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}),k--},"+list_item":(u,p,f,l)=>{u.length<y().data.styles.length&&(y().data.styles=u),y().data.firstMarker||(y().data.firstMarker=e.substring(p,f+1)),S(l),u.length===1&&u[0]===":"&&(y().data.definitionList=!0)},"-list_item":(u,p,f,l)=>{let a=w(l);if(a.data.definitionList)if(a.children[0]&&a.children[0].tag==="para"){let b={tag:"term",children:a.children[0].children};a.children.shift();let N={tag:"definition",children:a.children};x({tag:"definition_list_item",children:[b,N],attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}else{let b={tag:"term",children:[]},N={tag:"definition",children:a.children};x({tag:"definition_list_item",children:[b,N],attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}else a.data.checkbox?x({tag:"task_list_item",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,checkbox:a.data.checkbox,pos:a.pos}):x({tag:"list_item",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},checkbox_checked:(u,p,f,l)=>{y().data.checkbox="checked"},checkbox_unchecked:(u,p,f,l)=>{y().data.checkbox="unchecked"},"+block_quote":(u,p,f,l)=>{S(l)},"-block_quote":(u,p,f,l)=>{let a=w(l);x({tag:"block_quote",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+table":(u,p,f,l)=>{S(l),y().data.aligns=[]},"-table":(u,p,f,l)=>{var a;let b=w(l),N=b.children,T={tag:"caption",children:[]};((a=N[0])===null||a===void 0?void 0:a.tag)==="caption"&&(T=N.shift()),x({tag:"table",children:[T,...N],attributes:b.attributes,autoAttributes:b.autoAttributes,pos:b.pos})},"+row":(u,p,f,l)=>{S(l),y().data.aligns=[]},"-row":(u,p,f,l)=>{let a=w(l);if(a.children.length===0){y().data.aligns=a.data.aligns;let b=W();if(b&&"tag"in b&&b.tag==="row"){b.head=!0;for(let N=0;N<b.children.length;N++)b.children[N].head=!0,b.children[N].align=a.data.aligns[N]||"default"}}else{a.data.aligns=[];for(let b=0;b<a.children.length;b++)a.children[b].align=y().data.aligns[b]||"default";x({tag:"row",children:a.children,head:!1,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})}},separator_default:(u,p,f,l)=>{y().data.aligns.push("default")},separator_left:(u,p,f,l)=>{y().data.aligns.push("left")},separator_right:(u,p,f,l)=>{y().data.aligns.push("right")},separator_center:(u,p,f,l)=>{y().data.aligns.push("center")},"+cell":(u,p,f,l)=>{S(l)},"-cell":(u,p,f,l)=>{let a=w(l);x({tag:"cell",children:a.children,head:!1,align:"default",attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},"+caption":(u,p,f,l)=>{S(l)},"-caption":(u,p,f,l)=>{var a;let b=w(l),N=W();if(!N||"tag"in N&&N.tag!=="table")return;let T={tag:"caption",children:b.children,attributes:b.attributes,autoAttributes:b.autoAttributes,pos:b.pos};((a=N.children[0])===null||a===void 0?void 0:a.tag)==="caption"&&(N.children[0]=T)},"+footnote":(u,p,f,l)=>{S(l)},"-footnote":(u,p,f,l)=>{let a=w(l);if(a.data.label){let b=Ot(a.data.label);d[b]={tag:"footnote",label:b||"",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}}else I(new go.Warning("Ignoring footnote without a label.",t.sourcePositions?n(f):f))},note_label:(u,p,f,l)=>{y().data.label=e.substring(p,f+1)},"+code_block":(u,p,f,l)=>{S(l),r=F.Verbatim},"-code_block":(u,p,f,l)=>{let a=w(l);a.data.format?x({tag:"raw_block",format:a.data.format,text:i,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}):x({tag:"code_block",text:i,lang:a.data.lang,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos}),r=F.Normal,i=""},code_language:(u,p,f,l)=>{let a=y();a.data.lang=e.substring(p,f+1)},"+div":(u,p,f,l)=>{S(l)},"-div":(u,p,f,l)=>{let a=w(l);x({tag:"div",children:a.children,attributes:a.attributes,autoAttributes:a.autoAttributes,pos:a.pos})},thematic_break:(u,p,f,l)=>{let a={tag:"thematic_break",pos:l};M(a),x(a)},left_single_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"left_single_quote",text:"'",pos:l})},right_single_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"right_single_quote",text:"'",pos:l})},left_double_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"left_double_quote",text:'"',pos:l})},right_double_quote:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"right_double_quote",text:'"',pos:l})},ellipses:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"ellipses",text:"...",pos:l})},en_dash:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"en_dash",text:"--",pos:l})},em_dash:(u,p,f,l)=>{x({tag:"smart_punctuation",type:"em_dash",text:"---",pos:l})},blankline:(u,p,f,l)=>{let a;"tight"in y().data?a=y():O.length>=2&&"tight"in O[O.length-2].data&&(a=O[O.length-2]),a&&(a.data.blanklines=!0)}},tt=function(u,p){let f,l,a;t.sourcePositions&&(f=n(p.startpos),l=n(p.endpos),a={start:f,end:l});let b=p.annot,N=[];if(p.annot.includes("|")){let Q=p.annot.split("|");b=Q[0],N=Q.slice(1)}if(k>0&&b!=="blankline"){let Q,X=y();X&&(X.data&&"tight"in X.data?Q=X:u.length>=2&&"tight"in u[u.length-2].data&&(Q=u[u.length-2])),Q&&(!/^[+-]list/.test(b)&&Q.data.blanklines&&(Q.data.tight=!1),/^[-+]list_item$/.test(b)||(Q.data.blanklines=!1))}let T=Y[b];T&&T(N,p.startpos,p.endpos,a)},O=[{children:[],data:{headinglevel:0},pos:{start:{line:0,col:0,offset:0},end:{line:0,col:0,offset:0}}}],K=0;for(let u of A)tt(O,u),K=u.endpos;let st;t.sourcePositions&&(st=n(K));let pt=y();for(;pt&&pt.data.headinglevel>0;)w(st&&{start:st,end:st}),x({tag:"section",children:pt.children,attributes:pt.attributes,autoAttributes:pt.autoAttributes,pos:pt.pos}),pt=y();let we={tag:"doc",references:s,autoReferences:c,footnotes:d,children:O[0].children};return O[0].autoAttributes&&(we.autoAttributes=O[0].autoAttributes),O[0].attributes&&(we.attributes=O[0].attributes),we};q.parse=Cs;var _s={children:!0,tag:!0,pos:!0,attributes:!0,autoAttributes:!0,references:!0,autoReferences:!0,footnotes:!0},ie=function(e){return JSON.stringify(e).replace(/\\\n/g,"\\n")},re=function(e,t,o){if(t.push(" ".repeat(o)),o>128){t.push(`(((DEEPLY NESTED CONTENT OMITTED)))
`);return}t.push(e.tag),e.pos&&t.push(` (${e.pos.start.line}:${e.pos.start.col}:${e.pos.start.offset}-${e.pos.end.line}:${e.pos.end.col}:${e.pos.end.offset})`);for(let n in e)if(!_s[n]){let r=e[n];r!=null&&t.push(` ${n}=${ie(r)}`)}if(e.attributes)for(let n in e.attributes)t.push(` ${n}=${ie(e.attributes[n])}`);if(t.push(`
`),e.children)for(let n of e.children)re(n,t,o+2)},Ss=function(e){let t=[];if(re(e,t,0),Object.keys(e.references).length>0){t.push(`references
`);for(let o in e.references)t.push(`  [${ie(o)}] =
`),re(e.references[o],t,4)}if(Object.keys(e.footnotes).length>0){t.push(`footnotes
`);for(let o in e.footnotes)t.push(`  [${ie(o)}] =
`),re(e.footnotes[o],t,4)}return t.join("")};q.renderAST=Ss});var xo=J(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.HTMLRenderer=At.renderHTML=void 0;var yo=ae(),As=_t(),Ns=/[&<>]/,Ms=/[&<>"]/,ce=class{constructor(t){this.smartPunctuationMap={right_single_quote:"\u2019",left_single_quote:"\u2018",right_double_quote:"\u201D",left_double_quote:"\u201C",ellipses:"\u2026",em_dash:"\u2014",en_dash:"\u2013"},this.warn=t.warn||(()=>{}),this.options=t||{},this.tight=!1,this.footnoteIndex={},this.nextFootnoteIndex=1,this.references={},this.autoReferences={}}escape(t){return Ns.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}escapeAttribute(t){return Ms.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):t}renderAttributes(t,o){let n="";if(o)for(let i in o)if(i==="class"){let s=o[i];t.attributes&&t.attributes.class&&(s=`${s} ${t.attributes.class}`),n+=` ${i}="${this.escapeAttribute(s)}"`}else n+=` ${i}="${this.escapeAttribute(o[i])}"`;let r=Object.assign(Object.assign({},t.autoAttributes),t.attributes);if(r)for(let i in r){let s=r[i];i==="class"&&o&&o.class||(n+=` ${i}="${this.escapeAttribute(s)}"`)}if(t.pos){let i=t.pos.start,s=t.pos.end;n+=` data-startpos="${i.line}:${i.col}:${i.offset}" data-endpos="${s.line}:${s.col}:${s.offset}"`}return n}renderTag(t,o,n){let r="";return(o.attributes||o.autoAttributes||n||o.pos)&&(r=this.renderAttributes(o,n)),`<${t}${r}>`}renderCloseTag(t){return`</${t}>`}inTags(t,o,n,r){let i=n>=2?`
`:"",s=n>=1?`
`:"";return`${this.renderTag(t,o,r)}${i}${this.renderChildren(o)}</${t}>${s}`}addBacklink(t,o){let n=`<a href="#fnref${o}" role="doc-backlink">\u21A9\uFE0E</a>`;return/\<\/p\>[\r\n]*$/.test(t)?t.replace(/\<\/p\>([\r\n]*)$/,n+"</p>$1"):t+`<p>${n}</p>
`}renderChildren(t){let o="",n=this.tight;"tight"in t&&(this.tight=!!t.tight);for(let r of t.children)o+=this.renderAstNode(r);return"tight"in t&&(this.tight=n),o}renderAstNode(t){var o;let n=(o=this.options.overrides)===null||o===void 0?void 0:o[t.tag];return n?n(t,this):this.renderAstNodeDefault(t)}renderNotes(t){let o="",n=[],r={};for(let i in t)r[i]=this.renderChildren(t[i]);for(let i in this.footnoteIndex){let s=this.footnoteIndex[i];s&&(n[s]=r[i])}o+=`<section role="doc-endnotes">
<hr>
<ol>
`;for(let i=1;i<n.length;i++){let s=n[i]||"";o+=`<li id="fn${i}">
`,o+=this.addBacklink(s,i),o+=`</li>
`}return o+=`</ol>
</section>
`,o}renderAstNodeDefault(t){var o;switch(t.tag){case"doc":{let n="";return n+=this.renderChildren(t),this.nextFootnoteIndex>1&&(n+=this.renderNotes(t.footnotes)),n}case"para":return this.tight?`${this.renderChildren(t)}
`:this.inTags("p",t,1);case"block_quote":return this.inTags("blockquote",t,2);case"div":return this.inTags("div",t,2);case"section":return this.inTags("section",t,2);case"list_item":return this.inTags("li",t,2);case"task_list_item":return this.inTags("li",t,2,{class:t.checkbox==="checked"?"checked":"unchecked"});case"definition_list_item":return this.renderChildren(t);case"definition":return this.inTags("dd",t,2);case"term":return this.inTags("dt",t,1);case"definition_list":return this.inTags("dl",t,2);case"bullet_list":return this.inTags("ul",t,2);case"task_list":return this.inTags("ul",t,2,{class:"task-list"});case"ordered_list":{let n={};return t.start&&t.start!==1&&(n.start=t.start.toString()),t.style&&!/1/.test(t.style)&&(n.type=t.style.replace(/[().]/g,"")),this.inTags("ol",t,2,n)}case"heading":return this.inTags(`h${t.level}`,t,1);case"footnote_reference":{let n="",r=t.text,i=this.footnoteIndex[r];return i||(i=this.nextFootnoteIndex,this.footnoteIndex[r]=i,this.nextFootnoteIndex++),n+=this.renderTag("a",t,{id:"fnref"+i,href:"#fn"+i,role:"doc-noteref"}),n+="<sup>",n+=this.escape(i.toString()),n+="</sup></a>",n}case"table":return this.inTags("table",t,2);case"caption":{let n="";return t.children.length>0&&(n+=this.inTags("caption",t,1)),n}case"row":return this.inTags("tr",t,2);case"cell":{let n={};return t.align&&t.align!=="default"&&(n.style=`text-align: ${t.align};`),this.inTags(t.head?"th":"td",t,1,n)}case"thematic_break":{let n="";return n+=this.renderTag("hr",t),n+=`
`,n}case"code_block":{let n="";return n+=this.renderTag("pre",t),n+="<code",t.lang&&(n+=` class="language-${this.escapeAttribute(t.lang)}"`),n+=">",n+=this.escape(t.text),n+=this.renderCloseTag("code"),n+=this.renderCloseTag("pre"),n+=`
`,n}case"raw_block":{let n="";return t.format==="html"&&(n+=t.text),n}case"str":return t.attributes||t.autoAttributes?`${this.renderTag("span",t)}${this.escape(t.text)}</span>`:this.escape(t.text);case"smart_punctuation":return this.smartPunctuationMap[t.type]||t.text;case"double_quoted":{let n="";return n+=this.smartPunctuationMap.left_double_quote||'"',n+=this.renderChildren(t),n+=this.smartPunctuationMap.right_double_quote||'"',n}case"single_quoted":{let n="";return n+=this.smartPunctuationMap.left_single_quote||"'",n+=this.renderChildren(t),n+=this.smartPunctuationMap.right_single_quote||"'",n}case"symb":return this.escape(`:${t.alias}:`);case"inline_math":{let n="";return n+=this.renderTag("span",t,{class:"math inline"}),n+=`\\(${this.escape(t.text)}\\)`,n+=this.renderCloseTag("span"),n}case"display_math":{let n="";return n+=this.renderTag("span",t,{class:"math display"}),n+=`\\[${this.escape(t.text)}\\]`,n+=this.renderCloseTag("span"),n}case"verbatim":{let n="";return n+=this.renderTag("code",t),n+=this.escape(t.text),n+=this.renderCloseTag("code"),n}case"raw_inline":{let n="";return t.format==="html"&&(n+=t.text),n}case"soft_break":return`
`;case"hard_break":return`<br>
`;case"non_breaking_space":return"&nbsp;";case"link":case"image":{let n={},r=t.destination;if(t.reference){let i=this.references[t.reference]||this.autoReferences[t.reference];if(i){if(r=i.destination,t.tag==="image"?(n.alt=(0,yo.getStringContent)(t),n.src=r):n.href=r,i.attributes)for(let s in i.attributes)(!t.attributes||!t.attributes[s])&&(n[s]=i.attributes[s]);if(i.autoAttributes)for(let s in i.autoAttributes)(!t.autoAttributes||!t.autoAttributes[s])&&(n[s]=i.autoAttributes[s])}else this.warn(new As.Warning(`Reference ${JSON.stringify(t.reference)} not found`,(o=t==null?void 0:t.pos)===null||o===void 0?void 0:o.end))}else t.tag==="image"?(n.alt=(0,yo.getStringContent)(t),r!==void 0&&(n.src=r)):r!==void 0&&(n.href=r);return t.tag==="image"?this.renderTag("img",t,n):this.inTags("a",t,0,n)}case"url":case"email":{let n="",r={};return t.tag==="email"?r.href="mailto:"+t.text:r.href=t.text,n+=this.renderTag("a",t,r),n+=this.escape(t.text),n+=this.renderCloseTag("a"),n}case"strong":return this.inTags("strong",t,0);case"emph":return this.inTags("em",t,0);case"span":return this.inTags("span",t,0);case"mark":return this.inTags("mark",t,0);case"insert":return this.inTags("ins",t,0);case"delete":return this.inTags("del",t,0);case"superscript":return this.inTags("sup",t,0);case"subscript":return this.inTags("sub",t,0);default:return""}}render(t){return this.references=t.references,this.autoReferences=t.autoReferences,this.renderAstNode(t)}};At.HTMLRenderer=ce;var Ts=function(e,t={}){return new ce(t).render(e)};At.renderHTML=Ts});var ko=J(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.applyFilter=void 0;var tn=class{constructor(t){this.finished=!1,this.stack=[],this.enter=!0,this.top=t,this.current=t}walk(t){for(;!this.finished;){t(this);let o=this.stack&&this.stack[this.stack.length-1];if(this.enter)"children"in this.current&&this.current.children.length>0?(this.stack.push({node:this.current,childIndex:0}),this.current=this.current.children[0],this.enter=!0):this.enter=!1;else if(o){o.childIndex++;let n=o.node.children[o.childIndex];n?(this.current=n,this.enter=!0):(this.stack.pop(),this.current=o.node,this.enter=!1)}else this.finished=!0}}},Ps=function(e,t,o){if(!e||!e.tag)throw new Error("Filter called on a non-node.");let n=o[e.tag];if(!n)return!1;let r;if(t?"enter"in n&&n.enter&&(r=n.enter):"exit"in n&&n.exit?r=n.exit:r=n,typeof r=="function")return r(e)},Ze=function(e,t){return new tn(e).walk(o=>{let n=Ps(o.current,o.enter,t),r=o.stack[o.stack.length-1];if(typeof n=="object"&&"stop"in n&&n.stop&&(n=n.stop,o.enter=!1),n){if(Array.isArray(n))if(r)r.node.children.splice(r.childIndex,1,...n),o.current=r.node.children[r.childIndex],n.length>1&&(r.childIndex+=n.length-1);else throw Error("Cannot replace top node with multiple nodes");else if(typeof n=="object"&&"tag"in n&&n.tag)if(r)r.node.children[r.childIndex]=n;else return n}}),e},Is=function(e,t){let o=t(),n;Array.isArray(o)?n=o:n=[o];for(let r of n){Ze(e,r);for(let i in e.footnotes)Ze(e.footnotes[i],r);for(let i in e.references)Ze(e.references[i],r)}};le.applyFilter=Is});var Co=J(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.fromPandoc=Nt.toPandoc=void 0;var he=_t(),de={Decimal:{Period:"1.",OneParen:"1)",TwoParens:"(1)"},LowerAlpha:{Period:"a.",OneParen:"a)",TwoParens:"(a)"},UpperAlpha:{Period:"A.",OneParen:"A)",TwoParens:"(A)"},LowerRoman:{Period:"i.",OneParen:"i)",TwoParens:"(i)"},UpperRoman:{Period:"I.",OneParen:"I)",TwoParens:"(I)"}},vo={};for(let e in de)for(let t in de[e])vo[de[e][t]]=[e,t];var Es=function(e){return e.t==="Para"&&(e.t="Plain"),e},rt=function(e){let t=Object.assign(Object.assign({},e.autoAttributes),e.attributes);if(t){let o=t.id||"",n=t.class&&t.class.split(" ")||[],r=[];for(let i in t)i!==o&&i!=="class"&&r.push([i,t[i]]);return[o,n,r]}else return["",[],[]]},en=class{constructor(t={}){this.references={},this.footnotes={},this.options=t,this.smartPunctuationMap=this.options.smartPunctuationMap||{right_single_quote:"\u2019",left_single_quote:"\u2018",right_double_quote:"\u201D",left_double_quote:"\u201C",ellipses:"\u2026",em_dash:"\u2014",en_dash:"\u2013"},this.warn||(this.warn=()=>{})}toPandocChildren(t){if("children"in t){let o=[];return t.children.forEach(n=>{this.addToPandocElts(o,n)}),o}else return[]}toPandocDefinitionListItem(t){let o=this;return function(n){if(!("children"in n))return[];let[r,i]=n.children;return[o.toPandocChildren(r),[o.toPandocChildren(i)]]}}toPandocListItem(t){let o=this;return function(n){let r=o.toPandocChildren(n);return"checkbox"in n&&n.checkbox&&r[0].t==="Para"&&(n.checkbox==="checked"?r[0].c.unshift({t:"Str",c:"\u2612"},{t:"Space"}):r[0].c.unshift({t:"Str",c:"\u2610"},{t:"Space"})),"tight"in t&&t.tight&&(r=r.map(Es)),r}}addToPandocElts(t,o){switch(o.tag){case"section":case"div":{let n=rt(o);o.tag==="section"&&n[1].unshift("section"),t.push({t:"Div",c:[n,this.toPandocChildren(o)]});break}case"block_quote":t.push({t:"BlockQuote",c:this.toPandocChildren(o)});break;case"definition_list":{let n=o.children.map(this.toPandocDefinitionListItem(o));t.push({t:"DefinitionList",c:n});break}case"task_list":case"bullet_list":{let n;n=o.children.map(this.toPandocListItem(o)),t.push({t:"BulletList",c:n});break}case"ordered_list":{let n=o.children.map(this.toPandocListItem(o)),[r,i]=vo[o.style],s=o.start||1;t.push({t:"OrderedList",c:[[s,{t:r},{t:i}],n]});break}case"task_list_item":case"list_item":break;case"para":t.push({t:"Para",c:this.toPandocChildren(o)});break;case"heading":t.push({t:"Header",c:[o.level,rt(o),this.toPandocChildren(o)]});break;case"code_block":{let n=rt(o);o.lang&&n[1].unshift(o.lang),t.push({t:"CodeBlock",c:[n,o.text]});break}case"raw_block":t.push({t:"RawBlock",c:[o.format,o.text]});break;case"thematic_break":t.push({t:"HorizontalRule"});break;case"table":{let n=rt(o),r=["",[],[]],i=[],s=[],c=[],d=[],h=[r,[]],g=[],k=[],A={left:"AlignLeft",right:"AlignRight",center:"AlignCenter",default:"AlignDefault"},I=function(w){return[{t:A[w.align]||"AlignDefault"},{t:"ColWidthDefault"}]},M=this,z=function(w){if("children"in w)return[rt(w),{t:"align"in w&&A[w.align]||"AlignDefault"},1,1,[{t:"Plain",c:M.toPandocChildren(w)}]]},S=function(w){if("children"in w)return[rt(w),w.children.map(z)]};for(let w=0;w<o.children.length;w++){let y=o.children[w];if(!("children"in y))break;s.length===0&&(s=y.children.map(I)),y.tag==="caption"?y.children.length&&(i=this.toPandocChildren(y)):y.head?k.length===0?g.push(S(y)):(d.push([r,0,g,k]),k=[],g=[S(y)]):(d.length===0&&k.length===0&&(c=g,g=[]),k.push(S(y)))}(g.length>0||k.length>0)&&d.push([r,0,g,k]),t.push({t:"Table",c:[n,[null,[{t:"Plain",c:i}]],s,[r,c],d,h]});break}case"raw_inline":t.push({t:"RawInline",c:[o.format,o.text]});break;case"soft_break":t.push({t:"SoftBreak"});break;case"hard_break":t.push({t:"LineBreak"});break;case"str":o.text.split(/ +/).forEach((n,r)=>{r>0&&t.push({t:"Space"}),n.length>0&&t.push({t:"Str",c:n})});break;case"verbatim":t.push({t:"Code",c:[rt(o),o.text]});break;case"inline_math":t.push({t:"Math",c:[{t:"InlineMath"},o.text]});break;case"display_math":t.push({t:"Math",c:[{t:"DisplayMath"},o.text]});break;case"non_breaking_space":t.push({t:"Str",c:"\xA0"});break;case"smart_punctuation":t.push({t:"Str",c:this.smartPunctuationMap[o.type]||o.text});break;case"symb":t.push({t:"Span",c:[["",["symbol"],[["alias",o.alias]]],[{t:"Str",c:":"+o.alias+":"}]]});break;case"single_quoted":case"double_quoted":{let n={t:o.tag==="single_quoted"?"SingleQuote":"DoubleQuote"};t.push({t:"Quoted",c:[n,this.toPandocChildren(o)]});break}case"email":case"url":{let n=o.text;o.tag==="email"&&(n="mailto:"+n);let r=rt(o);r[1].unshift(o.tag==="email"?"email":"uri"),t.push({t:"Link",c:[r,[{t:"Str",c:o.text}],[n,""]]});break}case"image":case"link":{let n=o.destination||"",r={};if(o.reference){let h=this.references[o.reference];if(h){n=h.destination||"";let g=Object.assign(Object.assign({},h.autoAttributes),h.attributes);if(g)for(let k in g)r[k]=g[k]}else this.warn(new he.Warning("Reference "+o.reference+" not found."))}let i=Object.assign(Object.assign({},o.autoAttributes),o.attributes);if(i)for(let h in i)r[h]&&h==="class"?r[h]+=" "+i[h]:r[h]||(r[h]=i[h]);let s=rt({tag:"link",attributes:r,children:[]}),c=n||"",d=o.attributes&&o.attributes.title||o.autoAttributes&&o.autoAttributes.title||"";d&&(s[2]=s[2].filter(([h,g])=>h!=="title")),t.push({t:o.tag==="link"?"Link":"Image",c:[s,this.toPandocChildren(o),[c,d]]});break}case"emph":t.push({t:"Emph",c:this.toPandocChildren(o)});break;case"strong":t.push({t:"Strong",c:this.toPandocChildren(o)});break;case"superscript":t.push({t:"Superscript",c:this.toPandocChildren(o)});break;case"subscript":t.push({t:"Subscript",c:this.toPandocChildren(o)});break;case"span":t.push({t:"Span",c:[rt(o),this.toPandocChildren(o)]});break;case"mark":t.push({t:"Span",c:[["",["mark"],[]],this.toPandocChildren(o)]});break;case"insert":t.push({t:"Underline",c:this.toPandocChildren(o)});break;case"delete":t.push({t:"Strikeout",c:this.toPandocChildren(o)});break;case"footnote_reference":{let n=this.footnotes[o.text];n?t.push({t:"Note",c:this.toPandocChildren(n)}):t.push({t:"Superscript",c:[{t:"Str",c:o.text}]});break}default:this.warn(new he.Warning("Skipping unhandled node "+o.tag))}}toPandoc(t){return this.references=t.references,this.footnotes=t.footnotes,{"pandoc-api-version":[1,23],meta:{},blocks:this.toPandocChildren(t)}}},it=function(e){let t={};e[0]&&(t.id=e[0]),e[1].length>0&&(t.class=e[1].join(" "));for(let o=0;o<e[2].length;o++)t[e[2][o][0].toString()]=e[2][o][1];return Object.keys(t).length===0?null:t},nn=function(e){return e.t==="Plain"||e.t==="Para"},Ds=function(e){if(!e[0])return null;let t=e[0];return nn(t)&&t.c.length>=2&&t.c[0].t==="Str"&&t.c[1].t==="Space"?t.c[0].c==="\u2612"?(t.c.shift(),t.c.shift(),"checked"):t.c[0].c==="\u2610"?(t.c.shift(),t.c.shift(),"unchecked"):null:null},on=class{constructor(t={}){this.footnotes={},this.footnoteIndex=0,this.options=t,this.warn=t.warn||(()=>{})}fromPandocInlines(t){let o=[],n=[];for(let r=0;r<t.length;r++){let i=t[r];if(i.t==="Str")o.push(i.c);else if(i.t==="Space")o.push(" ");else switch(o.length>0&&(n.push({tag:"str",text:o.join("")}),o=[]),i.t){case"SoftBreak":n.push({tag:"soft_break"});break;case"LineBreak":n.push({tag:"hard_break"});break;case"Emph":n.push({tag:"emph",children:this.fromPandocInlines(i.c)});break;case"Strong":n.push({tag:"strong",children:this.fromPandocInlines(i.c)});break;case"Superscript":n.push({tag:"superscript",children:this.fromPandocInlines(i.c)});break;case"Subscript":n.push({tag:"subscript",children:this.fromPandocInlines(i.c)});break;case"Strikeout":n.push({tag:"delete",children:this.fromPandocInlines(i.c)});break;case"Span":{let s={tag:"span",children:this.fromPandocInlines(i.c[1])},c=it(i.c[0]);c&&(s.attributes=c),n.push(s);break}case"Underline":n.push({tag:"span",attributes:{class:"underline"},children:this.fromPandocInlines(i.c)});break;case"SmallCaps":n.push({tag:"span",attributes:{class:"smallcaps"},children:this.fromPandocInlines(i.c)});break;case"Math":n.push({tag:i.c[0].t==="DisplayMath"?"display_math":"inline_math",text:i.c[1]});break;case"Quoted":i.c[0].t==="SingleQuote"?n.push({tag:"single_quoted",children:this.fromPandocInlines(i.c[1])}):n.push({tag:"double_quoted",children:this.fromPandocInlines(i.c[1])});break;case"RawInline":n.push({tag:"raw_inline",format:i.c[0],text:i.c[1]});break;case"Code":{let s=it(i.c[0]),c={tag:"verbatim",text:i.c[1]};s&&(c.attributes=s),n.push(c);break}case"Image":case"Link":{let s=it(i.c[0]);i.c[2][1]&&(s=s||{},s.title=i.c[2][1]);let c=i.c[2][0],d=this.fromPandocInlines(i.c[1]);if(i.t==="Image"){let h={tag:"image",destination:c,children:d};s&&(h.attributes=s),n.push(h)}else{let h={tag:"link",destination:c,children:d};s&&(h.attributes=s),n.push(h)}break}case"Cite":n.push({tag:"span",attributes:{class:"cite"},children:this.fromPandocInlines(i.c[1])});break;case"Note":{this.footnoteIndex++;let s=this.footnoteIndex.toString(),c=i.c.map(d=>this.fromPandocBlock(d));this.footnotes[this.footnoteIndex.toString()]={tag:"footnote",label:s,children:c},n.push({tag:"footnote_reference",text:s});break}default:}}return o.length>0&&n.push({tag:"str",text:o.join("")}),n}fromPandocBlock(t){switch(t.t){case"Plain":case"Para":return{tag:"para",children:this.fromPandocInlines(t.c)};case"BlockQuote":return{tag:"block_quote",children:t.c.map(o=>this.fromPandocBlock(o))};case"Div":{let o=it(t.c[0]),n=/\bsection\b/.test(o&&o.class||"")?"section":"div",r=t.c[1].map(i=>this.fromPandocBlock(i));if(n==="section")return o=o||{},o.class=o.class.replace(/section */,""),o.class||delete o.class,{tag:"section",attributes:o,children:r};{let i={tag:"div",children:r};return o&&(i.attributes=o),i}}case"Header":{let o=it(t.c[1]),n={tag:"heading",level:t.c[0],children:this.fromPandocInlines(t.c[2])};return o&&(n.attributes=o),n}case"HorizontalRule":return{tag:"thematic_break"};case"RawBlock":return{tag:"raw_block",format:t.c[0],text:t.c[1]};case"CodeBlock":{let o=it(t.c[0]),n;if(o&&o.class){let i=o.class.split(/  */);n=i[0],i.shift(),i.length>0?o.class=i.join(" "):delete o.class}let r={tag:"code_block",lang:n,text:t.c[1]};return o&&(r.attributes=o),n||delete r.lang,r}case"DefinitionList":{let o=[];for(let r=0;r<t.c.length;r++){let i=t.c[r][0],s=t.c[r][1],c=this.fromPandocInlines(i),d=[];for(let h=0;h<s.length;h++)s[h].map(g=>{d.push(this.fromPandocBlock(g))});o.push({tag:"definition_list_item",children:[{tag:"term",children:c},{tag:"definition",children:d}]})}return{tag:"definition_list",children:o}}case"OrderedList":case"BulletList":{let o=[],n=[],r=!1,i;t.t==="BulletList"?i=t.c:i=t.c[1];for(let s=0;s<i.length;s++){let c=Ds(i[s]),d=i[s].map(h=>(h.t==="Plain"?r=!0:h.t==="Para"&&(r=!1),this.fromPandocBlock(h)));c!==null?n.push({tag:"task_list_item",checkbox:c,children:d}):o.push({tag:"list_item",children:d})}if(t.t==="BulletList")return n.length>0?{tag:"task_list",tight:r,children:n}:{tag:"bullet_list",style:"-",tight:r,children:o};if(t.t==="OrderedList"){let s=t.c[0][0],c=t.c[0][1].t;c==="DefaultStyle"&&(c="Decimal");let d=t.c[0][2].t;return d==="DefaultDelim"&&(d="Period"),{tag:"ordered_list",style:de[c][d],start:s,tight:r,children:o}}}case"Table":{let o=it(t.c[0]),n=t.c[1][1],r={tag:"caption",children:[]};n.length>1||n.length===1&&!nn(n[0])?this.warn(new he.Warning("Skipping block-level content in table caption.")):n[0]&&"c"in n[0]&&(r.children=this.fromPandocInlines(n[0].c));let i=t.c[2],s=[];for(let A in i)s.push(i[A][0].t.slice(5).toLowerCase());let c=[],d=t.c[3][1];for(let A in d)c.push(this.fromPandocRow(d[A],!0,0,s));let h=t.c[4];for(let A in h){let I=h[A][1],M=h[A][2];for(let S in M)c.push(this.fromPandocRow(M[S],!0,I,s));let z=h[A][3];for(let S in z)c.push(this.fromPandocRow(z[S],!1,I,s))}let g=t.c[5][1];for(let A in g)c.push(this.fromPandocRow(g[A],!1,0,s));let k={tag:"table",children:[r,...c]};return o&&(k.attributes=o),k}case"Figure":{let o=it(t.c[0]),n=/\bsection\b/.test(o&&o.class||"")?"section":"div",r=t.c[2].map(c=>this.fromPandocBlock(c)),i=t.c[1][1];if(i.length>0){let c=i.map(d=>this.fromPandocBlock(d));r.push(...c)}let s={tag:"div",children:r};return o&&(s.attributes=o),s}case"LineBlock":{let o=[];for(let n=0;n<t.c.length;n++)n>0&&o.push({tag:"hard_break"}),o.push(...this.fromPandocInlines(t.c[n]));return{tag:"para",children:o}}case"Null":return{tag:"raw_block",format:"none",text:""};default:}return{tag:"raw_block",format:"error",text:"Could not convert "+t.t}}fromPandocRow(t,o,n,r){let i=it(t[0]),s=t[1],c=[];for(let h=0;h<s.length;h++)c.push(this.fromPandocCell(s[h],o||h<n,r[h]));let d={tag:"row",head:o,children:c};return i&&(d.attributes=i),d}fromPandocCell(t,o,n){let r=[],i=it(t[0]),s=t[1].t.slice(5).toLowerCase();s==="default"&&(s=n);let c=t[4];c.length>1||c.length===1&&!nn(c[0])?(this.warn(new he.Warning("Skipping table cell with block-level content.")),r=[{tag:"str",text:"((content omitted))"}]):c[0]&&(r=this.fromPandocInlines(c[0].c));let d={tag:"cell",head:o,align:s,children:r};return i&&(d.attributes=i),d}fromPandoc(t){if(typeof t!="object")throw Error("Pandoc document must be an object");if(t["pandoc-api-version"])if(t.blocks){if(!t.meta)throw Error("Pandoc document lacks meta")}else throw Error("Pandoc document lacks blocks");else throw Error("Pandoc document lacks pandoc-api-version");return{tag:"doc",children:t.blocks.map(r=>this.fromPandocBlock(r)),footnotes:this.footnotes,references:{},autoReferences:{}}}},Ls=function(e,t){return new en(t).toPandoc(e)};Nt.toPandoc=Ls;var Os=function(e,t){return new on(t).fromPandoc(e)};Nt.fromPandoc=Os});var No=J(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.renderDjot=void 0;var mt=oe(),_o=ae(),Ao=function(e){let t=e.tag;return t==="space"||t==="soft_break"||t==="hard_break"},zs=function(e){return e.children[0]&&Ao(e.children[0])},Bs=function(e){return e.children[0]&&Ao(e.children[e.children.length-1])},rn=function(e,t){let o=e.text.match(/(`+)/g),n={};if(o)for(let i in o)n[o[i].length]=!0;let r=t;for(;n[r];)r++;return"`".repeat(r)},So=function(e){if(e<0||e>=4e3)return"?";let t="";for(;e>0;)if(e>=1e3)t+="M",e-=1e3;else if(e>=900)t+="CM",e-=900;else if(e>=500)t+="D",e-=500;else if(e>=400)t+="CD",e-=400;else if(e>=100)t+="C",e-=100;else if(e>=90)t+="XC",e-=90;else if(e>=50)t+="L",e-=50;else if(e>=40)t+="XL",e-=40;else if(e>=10)t+="X",e-=10;else if(e==9)t+="IX",e-=9;else if(e>=5)t+="V",e-=5;else if(e==4)t+="IV",e-=4;else if(e>=1)t+="I",e-=1;else throw new Error("toRoman encountered x = "+e);return t},js=function(e,t){let o=t.replace(/[a-zA-Z0-9]+/g,"$"),n=t.replace(/[.()]/g,""),r;switch(n){case"1":r=e.toString();break;case"a":r=String.fromCodePoint(96+e%26);break;case"A":r=String.fromCodePoint(64+e%26);break;case"i":r=So(e).toLowerCase();break;case"I":r=So(e);break;default:throw new Error("formatNumber encountered unknown style "+t)}return o.replace("$",r)},sn=class{constructor(t,o={}){this.prefixes=[],this.buffer=[],this.startOfLine=!0,this.endOfPrefix=0,this.column=0,this.needsBlankLine=!1,this.handlers={doc:n=>{this.renderChildren(n.children),this.prefixes=[],this.cr(),Object.keys(n.references).length>0&&(this.cr(),this.newline());for(let s in n.references)this.renderNode(n.references[s]);let i=Object.keys(n.footnotes).length>0;for(let s in n.footnotes)this.renderNode(n.footnotes[s]);this.prefixes=[],this.cr()},footnote:n=>{this.lit("[^"+n.label+"]:"),this.space(),this.needsBlankLine=!1,this.prefixes.push("  "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},reference:n=>{this.lit("["),this.lit(n.label),this.lit("]:"),this.prefixes.push("  "),this.space(),this.lit(n.destination),this.wrap(),this.prefixes.pop(),this.blankline()},para:n=>{this.renderChildren(n.children),this.blankline()},thematic_break:()=>{this.lit("* * * * *"),this.blankline()},div:n=>{this.lit(":::"),this.cr(),this.renderChildren(n.children),this.cr(),this.lit(":::"),this.blankline()},heading:n=>{let r="#".repeat(n.level);this.lit(r+" "),this.prefixes.push(r+" "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},block_quote:n=>{this.prefixes.push("> "),this.lit("> "),this.renderChildren(n.children),this.prefixes.pop(),this.blankline()},section:n=>{this.renderChildren(n.children)},code_block:n=>{let r=rn(n,3);this.lit(r),n.lang&&this.lit(" "+n.lang),this.cr(),this.litlines(n.text),this.cr(),this.lit(r),this.blankline()},raw_block:n=>{let r=rn(n,3);this.lit(r),this.lit(" ="+n.format),this.cr(),this.litlines(n.text),this.cr(),this.lit(r),this.blankline()},definition_list:n=>{let r=n.children;for(let i=0;i<r.length;i++){let s=r[i];i>0&&this.newline(),this.lit(":"),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(2)),this.renderChildren(s.children),this.prefixes.pop()}},ordered_list:n=>{let r=n.style,i=n.start||1,s=n.children,c=n.tight;for(let d=0;d<s.length;d++){let h=s[d];d>0&&(this.cr(),c||this.newline());let g=js(i+d,r);this.lit(g),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(g.length+1)),this.renderChildren(h.children),this.prefixes.pop()}c&&this.blankline()},bullet_list:n=>{let r=n.children,i=n.tight;for(let s=0;s<r.length;s++){let c=r[s];s>0&&(this.cr(),i||this.newline());let d=n.style;this.lit(d),this.needsBlankLine=!1,this.space(),this.prefixes.push(" ".repeat(d.length+1)),this.renderChildren(c.children),this.prefixes.pop()}i&&this.blankline()},task_list:n=>{let r=n.children,i=n.tight;for(let s=0;s<r.length;s++){let c=r[s];s>0&&(this.cr(),i||this.newline()),this.needsBlankLine=!1,this.lit(`- [${c.checkbox==="checked"?"X":" "}]`),this.space(),this.prefixes.push(" ".repeat(6)),this.renderChildren(c.children),this.prefixes.pop()}i&&this.blankline()},term:n=>{this.renderChildren(n.children),this.blankline()},definition:n=>{this.renderChildren(n.children)},table:n=>{let r=n.children.filter(mt.isCaption),i=n.children.filter(mt.isRow);for(let s=0;s<i.length;s++){let c=i[s];if("head"in c&&!c.head&&s>0&&i[s-1].head){let d=i[s-1];for(let h=0;h<d.children.length;h++){switch(h===0&&this.lit("|"),d&&d.children[h].align){case"left":this.lit(":--");break;case"right":this.lit("--:");break;case"center":this.lit(":-:");break;default:this.lit("---")}this.lit("|")}this.cr()}for(let d=0;d<c.children.length;d++){let h=c.children[d];d===0&&this.lit("|"),this.noWrap(()=>{h.tag==="cell"&&this.renderChildren(h.children)}),this.lit("|")}this.cr()}r.length>0&&r[0].children.length>0&&(this.newline(),this.lit("^ "),this.needsBlankLine=!1,this.prefixes.push("  "),this.renderChildren(r[0].children),this.prefixes.pop(),this.blankline()),this.blankline()},str:n=>{n.text.split(/  */).forEach((r,i)=>{i>0&&this.space(),this.out(r)})},space:()=>{this.space()},soft_break:()=>{this.soft_break()},smart_punctuation:n=>{this.lit(n.text)},non_breaking_space:()=>{this.lit("\\ ")},single_quoted:this.inlineContainer("'"),double_quoted:this.inlineContainer('"'),emph:this.inlineContainer("_"),strong:this.inlineContainer("*"),superscript:this.inlineContainer("^"),subscript:this.inlineContainer("~"),mark:this.inlineContainer("=",!0),delete:this.inlineContainer("-",!0),insert:this.inlineContainer("+",!0),footnote_reference:n=>{this.lit("[^"+n.text+"]")},symb:n=>{this.lit(":"+n.alias+":")},email:n=>{this.lit("<"+n.text+">")},url:n=>{this.lit("<"+n.text+">")},span:n=>{this.lit("["),this.renderChildren(n.children),this.lit("]")},link:n=>{this.lit("["),this.renderChildren(n.children),this.lit("]"),n.reference?(this.lit("["),n.reference!==(0,_o.getStringContent)(n)&&this.lit(n.reference),this.lit("]")):n.destination?(this.lit("("),this.lit(n.destination),this.lit(")")):this.lit("()")},image:n=>{this.lit("!["),this.renderChildren(n.children),this.lit("]"),n.reference?(this.lit("["),n.reference!==(0,_o.getStringContent)(n)&&this.lit(n.reference),this.lit("]")):n.destination?(this.lit("("),this.lit(n.destination),this.lit(")")):this.lit("()")},raw_inline:n=>{this.verbatimNode(n),this.lit("{="+n.format+"}")},verbatim:n=>{this.verbatimNode(n)},inline_math:n=>{this.lit("$"),this.verbatimNode(n)},display_math:n=>{this.lit("$$"),this.verbatimNode(n)}},this.doc=t,this.wrapWidth=(o==null?void 0:o.wrapWidth)||0}escape(t){return t=t.replace(/([~`'"${}[\]^<>\\*_]|-(?=-)|!(=\[)|\.(?=\.))/g,"\\$1"),(this.column===0||this.column===this.endOfPrefix)&&(t=t.replace(/^#/,"\\#")),t}out(t){this.lit(this.escape(t))}doBlankLines(){this.needsBlankLine&&(this.cr(),this.newline(),this.needsBlankLine=!1)}lit(t){this.buffer.push(t),this.column+=t.length,this.startOfLine=!1}blankline(){this.needsBlankLine=!0}newline(){if(this.endOfPrefix===this.column)for(;/  *$|^$/.test(this.buffer[this.buffer.length-1]);)this.buffer[this.buffer.length-1]=this.buffer[this.buffer.length-1].replace(/  *$/,""),this.buffer[this.buffer.length-1]===""&&this.buffer.pop();if(this.endOfPrefix=0,this.column=0,this.buffer.push(`
`),this.prefixes.length>0){for(let t=0,o=this.prefixes.length;t<o;t++)this.buffer.push(this.prefixes[t]),this.column+=this.prefixes[t].length;this.endOfPrefix=this.column}this.startOfLine=!0}cr(){this.startOfLine||this.newline()}wrap(){if(this.wrapWidth<=0)return;let t=this.buffer.length-1;if(!this.startOfLine&&this.buffer.length>0&&this.column>this.wrapWidth){let o;for(;t>=0&&(o=this.buffer[t],o!==" ");){if(/^[ \r\n]+$/.test(o))return;t--}}if(t<this.buffer.length-1){let o=this.buffer.splice(t+1);this.buffer[this.buffer.length-1]===" "&&this.buffer.pop(),this.newline(),this.startOfLine=!0;for(let n=0;n<o.length;n++)this.buffer.push(o[n]),this.column+=o[n].length,this.startOfLine=!1}}space(){this.wrap(),this.lit(" ")}soft_break(){this.wrapWidth===0?this.newline():this.space()}needsBraces(t){return zs(t)||Bs(t)||this.buffer.length>0&&/\w$/.test(this.buffer[this.buffer.length-1])}noWrap(t){let o=this.wrapWidth;this.wrapWidth=-1,t(),this.wrapWidth=o}inlineContainer(t,o){let n=this;return function(r){o=o||n.needsBraces(r),o&&n.lit("{"),n.lit(t),n.renderChildren(r.children),n.lit(t),o&&n.lit("}")}}litlines(t){let o=t.split(/\r?\n/);o[o.length-1]===""&&o.pop();for(let n of o)this.lit(n),this.cr()}verbatimNode(t){let o=rn(t,1);this.lit(o),/^`/.test(t.text)&&this.lit(" "),this.lit(t.text),/`$/.test(t.text)&&this.lit(" "),this.lit(o)}renderChildren(t){for(let o=0,n=t.length;o<n;o++)this.renderNode(t[o]);t[0]&&!(0,mt.isBlock)(t[0])&&this.wrap()}renderNode(t){this.doBlankLines();let o=this.handlers[t.tag];if(o)t.attributes&&(0,mt.isBlock)(t)&&(this.renderAttributes(t),this.cr()),o(t),t.attributes&&(0,mt.isInline)(t)&&this.renderAttributes(t);else throw new Error("No renderer defined for node type "+t.tag)}renderAttributes(t){if(!t.attributes||Object.keys(t.attributes).length===0)return;let o=t.attributes;this.lit("{");let n=!0;(0,mt.isBlock)(t)&&this.prefixes.push(" ");for(let r in o){if(n||this.space(),r==="id")this.lit("#"),this.lit(o[r]);else if(r==="class"){let i=o[r].split(/  */);for(let s=0;s<i.length;s++)s>0&&this.space(),this.lit("."),this.lit(i[s])}else this.lit(r),this.lit('="'),this.out(o[r]),this.lit('"');n=!1}(0,mt.isBlock)(t)&&this.prefixes.pop(),this.lit("}")}render(){return this.renderNode(this.doc),this.buffer.join("")}},Gs=function(e,t={}){return new sn(e,t).render()};ue.renderDjot=Gs});var Mo=J(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.version=void 0;pe.version="0.3.1"});var Do=J($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.isInline=$.isBlock=$.version=$.renderDjot=$.toPandoc=$.fromPandoc=$.applyFilter=$.HTMLRenderer=$.renderHTML=$.parseEvents=$.renderAST=$.parse=void 0;var To=ae();Object.defineProperty($,"parse",{enumerable:!0,get:function(){return To.parse}});Object.defineProperty($,"renderAST",{enumerable:!0,get:function(){return To.renderAST}});var Fs=Ke();Object.defineProperty($,"parseEvents",{enumerable:!0,get:function(){return Fs.parseEvents}});var Po=xo();Object.defineProperty($,"renderHTML",{enumerable:!0,get:function(){return Po.renderHTML}});Object.defineProperty($,"HTMLRenderer",{enumerable:!0,get:function(){return Po.HTMLRenderer}});var $s=ko();Object.defineProperty($,"applyFilter",{enumerable:!0,get:function(){return $s.applyFilter}});var Io=Co();Object.defineProperty($,"fromPandoc",{enumerable:!0,get:function(){return Io.fromPandoc}});Object.defineProperty($,"toPandoc",{enumerable:!0,get:function(){return Io.toPandoc}});var Us=No();Object.defineProperty($,"renderDjot",{enumerable:!0,get:function(){return Us.renderDjot}});var Vs=Mo();Object.defineProperty($,"version",{enumerable:!0,get:function(){return Vs.version}});var Eo=oe();Object.defineProperty($,"isBlock",{enumerable:!0,get:function(){return Eo.isBlock}});Object.defineProperty($,"isInline",{enumerable:!0,get:function(){return Eo.isInline}})});var pr=J((V0,be)=>{(function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],t=typeof window<"u",o=t&&window.mozInnerScreenX!=null;function n(r,i,s){if(!t)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var c=s&&s.debug||!1;if(c){var d=document.querySelector("#input-textarea-caret-position-mirror-div");d&&d.parentNode.removeChild(d)}var h=document.createElement("div");h.id="input-textarea-caret-position-mirror-div",document.body.appendChild(h);var g=h.style,k=window.getComputedStyle?window.getComputedStyle(r):r.currentStyle,A=r.nodeName==="INPUT";g.whiteSpace="pre-wrap",A||(g.wordWrap="break-word"),g.position="absolute",c||(g.visibility="hidden"),e.forEach(function(z){A&&z==="lineHeight"?g.lineHeight=k.height:g[z]=k[z]}),o?r.scrollHeight>parseInt(k.height)&&(g.overflowY="scroll"):g.overflow="hidden",h.textContent=r.value.substring(0,i),A&&(h.textContent=h.textContent.replace(/\s/g,"\xA0"));var I=document.createElement("span");I.textContent=r.value.substring(i)||".",h.appendChild(I);var M={top:I.offsetTop+parseInt(k.borderTopWidth),left:I.offsetLeft+parseInt(k.borderLeftWidth),height:parseInt(k.lineHeight)};return c?I.style.backgroundColor="#aaa":document.body.removeChild(h),M}typeof be<"u"&&typeof be.exports<"u"?be.exports=n:t&&(window.getCaretCoordinates=n)})()});var gt=e=>Array.isArray(e);var Dr=e=>({el:document.querySelector(e),elements:document.querySelectorAll(e),placeholder(t){return this.el.placeholder=t,this},getValue(){return this.el.value},insertAtCaret(t){return this.el.setRangeText(t,this.el.selectionStart,this.el.selectionEnd,"end"),this},setValue(t){this.el.value=t;let o=new Event("input",{bubbles:!0,cancelable:!0});return this.el.dispatchEvent(o),this},innerHTML(t){return this.el.innerHTML=t,this},html(t){return this.el.innerHTML="",this.append(t),this},append(t){return(gt(t)?t:[t]).forEach(n=>{let r=bt(n)?n:document.createTextNode(n);this.el.appendChild(r)}),this},appendListElement(t){let o=document.createElement("LI");return o.appendChild(document.createTextNode(t)),this.el.appendChild(o),this},removeClass(t){return this.el.classList.remove(t),this},removeClasses(t=[]){return t.map(o=>this.removeClass(o)),this},addClass(t){return this.el.classList.add(t),this},hasClass(t){return(" "+this.el.className+" ").indexOf(" "+t+" ")>-1},show(t=!0){return t?this.removeClass("hidden"):this.hide(),this},hide(){return this.addClass("hidden"),this},toggle(t="hidden"){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},focus(){return this.el.focus(),this},listenAll(t,o){return Array.prototype.slice.call(this.elements).map(r=>{r.addEventListener(t,i=>o(i.srcElement))}),this},listen(t,o){return this.el.addEventListener(t,n=>o(n,this)),this},click(){this.el&&this.el.click()},checked(t){return this.el.checked=!!t,this},disable(t=!0){return this.el.disabled=t,this}}),bt=e=>{try{return e instanceof HTMLElement}catch{return typeof e=="object"&&e.nodeType===1&&typeof e.style=="object"&&typeof e.ownerDocument=="object"}},m=Dr;var ke={info:"info",success:"success",error:"error",warning:"warning"},ve=m("#notification"),xe=()=>{ve.removeClasses(Object.values(ke))};ve.el.onclick=()=>xe();var Lr=()=>Object.values(ke).reduce((e,t)=>({...e,[t](o){this.showNotification(o,t)}}),{}),Or=(e=5)=>({autohideDuration:e,timer:void 0,removeAfter(){this.timer=self.setTimeout(()=>{xe()},this.autohideDuration*1e3)},showNotification(t,o=ke.info){xe(),ve.innerHTML(t).addClass(o),clearTimeout(this.timer),this.removeAfter()},...Lr()}),zr=Or(),C=zr;var Br=()=>{let e=localStorage.getItem("miropad.user");e?C.info(`\u{1F917} Happy to see you again from ${e}`):C.info(`<h1>Welcome \u{1F44B} \u{1F603} </h1>
       <p>Use  Ctrl+S:  to save your note<p/>
       <p>& Ctrl+P: to format a JSON doc<p/>
      `,100),localStorage.setItem("miropad.user",new Date().toLocaleDateString())},gn=Br;var jr={set:function(e,t){return localStorage.setItem(e,t),this},update:function(e,t){let o=JSON.parse(this.get(e));return localStorage.setItem(e,JSON.stringify({...o,...t})),this},remove:function(e){return localStorage.removeItem(e),this},get:function(e){return gt(e)?e.reduce((t,o)=>({...t,[o]:this.get(o)}),{}):localStorage.getItem(e)},parse:function(e){let t=this.get(e);return JSON.parse(t)},getDictionary:function(){let e=localStorage.getItem("__dictionary__");return e?JSON.parse(e):[]},removeFromDictionary:function(e){let o=this.getDictionary().filter(n=>n!==e);localStorage.setItem("__dictionary__",JSON.stringify(o))},saveToDictionary:async function(e){if(e.length)try{let t=e.toLowerCase().replace(/[^a-zA-Z--]/g," "),o=await this.getDictionary(),n=[...t.split(" ").filter(i=>i.length>3),...o],r=[...new Set(n)];localStorage.setItem("__dictionary__",JSON.stringify(r))}catch(t){C.error(`\u{1F631} Something went wrong while trying to save to local storage ${t}`)}else C.warning("\u{1F615} Nothing to save!");return this}},_=jr;var et={github:{client_id:"70c1955dfe4914c52c10",request_state:"miro-pad"},auth_service:"https://vercel-api-phi.vercel.app/api/auth",mail_service:{api:"https://vercel-api-phi.vercel.app/api/mail",signature:`Theo Mironidis <br/>
    Software Engineer <br/>
    https://teomrd.github.io`},file_service:{api:"https://vercel-api-phi.vercel.app/api/upload"}};var Gt=(e,t=_.get("authToken"))=>fetch(`https://api.github.com/gists/${e}`,{headers:{Authorization:`token ${t}`}}).then(o=>{if(!o.ok)throw Error(o.statusText);return o.json()}),bn=(e=_.get("authToken"))=>fetch("https://api.github.com/gists",{headers:{Authorization:`token ${e}`}}).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}),wn=async(e,t=_.get("gistId"),o=_.get("authToken"))=>{let n=await fetch(`https://api.github.com/gists/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[e]:null},description:"MiroPad Gist",public:!1})});if(!n.ok)throw new Error(n.statusText);let r=await n.json();return C.info(`${e} deleted on Gist!`),r},yn=(e=Z(),t=_.get("gistId"),o=_.get("authToken"))=>{if(t&&o){let n=e.reduce((r,{id:i,text:s,deleted:c})=>({...r,[i]:c?null:{content:s}}),{});return fetch(`https://api.github.com/gists/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:n,description:"MiroPad Gist",public:!1})}).then(r=>{if(!r.ok)throw new Error(r.statusText);return r.json()}).then(r=>(e.map(({id:i,deleted:s})=>{s&&localStorage.removeItem(i)}),r))}},xn=async(e=_.get("authToken"))=>{let o=Z().reduce((i,s)=>({...i,[s.id]:{content:s.text}}),{}),n=await fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${e}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:o,description:"MiroPad Gist",public:!1})});if(!n.ok)throw Error(n.statusText);return await n.json()},kn=(e,t)=>fetch(`${et.auth_service}?state=${t}&code=${e}`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(o=>{if(!o.ok)throw Error(o.statusText);return o.json()}).then(o=>o),vn=async({note:e,token:t=_.get("authToken")})=>{let o=await fetch("https://api.github.com/gists",{method:"POST",headers:{Authorization:`token ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({files:{[e.id]:{content:e.text}},description:"MiroPad Gist",public:!0})});if(!o.ok)throw Error(o.statusText);return await o.json()};var tc=new Uint8Array(0);function Cn(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let o=0;o<e.byteLength;o++)if(e[o]!==t[o])return!1;return!0}function wt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Gr(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var o=new Uint8Array(256),n=0;n<o.length;n++)o[n]=255;for(var r=0;r<e.length;r++){var i=e.charAt(r),s=i.charCodeAt(0);if(o[s]!==255)throw new TypeError(i+" is ambiguous");o[s]=r}var c=e.length,d=e.charAt(0),h=Math.log(c)/Math.log(256),g=Math.log(256)/Math.log(c);function k(M){if(M instanceof Uint8Array||(ArrayBuffer.isView(M)?M=new Uint8Array(M.buffer,M.byteOffset,M.byteLength):Array.isArray(M)&&(M=Uint8Array.from(M))),!(M instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(M.length===0)return"";for(var z=0,S=0,w=0,y=M.length;w!==y&&M[w]===0;)w++,z++;for(var W=(y-w)*g+1>>>0,x=new Uint8Array(W);w!==y;){for(var Y=M[w],tt=0,O=W-1;(Y!==0||tt<S)&&O!==-1;O--,tt++)Y+=256*x[O]>>>0,x[O]=Y%c>>>0,Y=Y/c>>>0;if(Y!==0)throw new Error("Non-zero carry");S=tt,w++}for(var K=W-S;K!==W&&x[K]===0;)K++;for(var st=d.repeat(z);K<W;++K)st+=e.charAt(x[K]);return st}function A(M){if(typeof M!="string")throw new TypeError("Expected String");if(M.length===0)return new Uint8Array;var z=0;if(M[z]!==" "){for(var S=0,w=0;M[z]===d;)S++,z++;for(var y=(M.length-z)*h+1>>>0,W=new Uint8Array(y);M[z];){var x=o[M.charCodeAt(z)];if(x===255)return;for(var Y=0,tt=y-1;(x!==0||Y<w)&&tt!==-1;tt--,Y++)x+=c*W[tt]>>>0,W[tt]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");w=Y,z++}if(M[z]!==" "){for(var O=y-w;O!==y&&W[O]===0;)O++;for(var K=new Uint8Array(S+(y-O)),st=S;O!==y;)K[st++]=W[O++];return K}}}function I(M){var z=A(M);if(z)return z;throw new Error(`Non-${t} character`)}return{encode:k,decodeUnsafe:A,decode:I}}var Fr=Gr,$r=Fr,_n=$r;var Ce=class{constructor(t,o,n){B(this,"name");B(this,"prefix");B(this,"baseEncode");this.name=t,this.prefix=o,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},_e=class{constructor(t,o,n){B(this,"name");B(this,"prefix");B(this,"baseDecode");B(this,"prefixCodePoint");this.name=t,this.prefix=o;let r=o.codePointAt(0);if(r===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Sn(this,t)}},Se=class{constructor(t){B(this,"decoders");this.decoders=t}or(t){return Sn(this,t)}decode(t){let o=t[0],n=this.decoders[o];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Sn(e,t){return new Se({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Ae=class{constructor(t,o,n,r){B(this,"name");B(this,"prefix");B(this,"baseEncode");B(this,"baseDecode");B(this,"encoder");B(this,"decoder");this.name=t,this.prefix=o,this.baseEncode=n,this.baseDecode=r,this.encoder=new Ce(t,o,n),this.decoder=new _e(t,o,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function An({name:e,prefix:t,encode:o,decode:n}){return new Ae(e,t,o,n)}function yt({name:e,prefix:t,alphabet:o}){let{encode:n,decode:r}=_n(o,e);return An({prefix:t,name:e,encode:n,decode:i=>wt(r(i))})}function Ur(e,t,o,n){let r={};for(let g=0;g<t.length;++g)r[t[g]]=g;let i=e.length;for(;e[i-1]==="=";)--i;let s=new Uint8Array(i*o/8|0),c=0,d=0,h=0;for(let g=0;g<i;++g){let k=r[e[g]];if(k===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<o|k,c+=o,c>=8&&(c-=8,s[h++]=255&d>>c)}if(c>=o||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return s}function Vr(e,t,o){let n=t[t.length-1]==="=",r=(1<<o)-1,i="",s=0,c=0;for(let d=0;d<e.length;++d)for(c=c<<8|e[d],s+=8;s>o;)s-=o,i+=t[r&c>>s];if(s!==0&&(i+=t[r&c<<o-s]),n)for(;i.length*o&7;)i+="=";return i}function nt({name:e,prefix:t,bitsPerChar:o,alphabet:n}){return An({prefix:t,name:e,encode(r){return Vr(r,n,o)},decode(r){return Ur(r,n,o,e)}})}var Mt=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cc=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lc=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dc=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hc=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uc=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pc=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fc=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mc=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ft=yt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wc=yt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var at=yt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kc=yt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rr=Tn,Nn=128,qr=127,Wr=~qr,Hr=Math.pow(2,31);function Tn(e,t,o){t=t||[],o=o||0;for(var n=o;e>=Hr;)t[o++]=e&255|Nn,e/=128;for(;e&Wr;)t[o++]=e&255|Nn,e>>>=7;return t[o]=e|0,Tn.bytes=o-n+1,t}var Jr=Ne,Yr=128,Mn=127;function Ne(e,n){var o=0,n=n||0,r=0,i=n,s,c=e.length;do{if(i>=c)throw Ne.bytes=0,new RangeError("Could not decode varint");s=e[i++],o+=r<28?(s&Mn)<<r:(s&Mn)*Math.pow(2,r),r+=7}while(s>=Yr);return Ne.bytes=i-n,o}var Kr=Math.pow(2,7),Qr=Math.pow(2,14),Xr=Math.pow(2,21),Zr=Math.pow(2,28),ti=Math.pow(2,35),ei=Math.pow(2,42),ni=Math.pow(2,49),oi=Math.pow(2,56),ri=Math.pow(2,63),ii=function(e){return e<Kr?1:e<Qr?2:e<Xr?3:e<Zr?4:e<ti?5:e<ei?6:e<ni?7:e<oi?8:e<ri?9:10},si={encode:Rr,decode:Jr,encodingLength:ii},ai=si,Tt=ai;function Pt(e,t=0){return[Tt.decode(e,t),Tt.decode.bytes]}function xt(e,t,o=0){return Tt.encode(e,t,o),t}function kt(e){return Tt.encodingLength(e)}function It(e,t){let o=t.byteLength,n=kt(e),r=n+kt(o),i=new Uint8Array(r+o);return xt(e,i,0),xt(o,i,n),i.set(t,r),new vt(e,o,t,i)}function In(e){let t=wt(e),[o,n]=Pt(t),[r,i]=Pt(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==r)throw new Error("Incorrect length");return new vt(o,r,s,t)}function En(e,t){if(e===t)return!0;{let o=t;return e.code===o.code&&e.size===o.size&&o.bytes instanceof Uint8Array&&Cn(e.bytes,o.bytes)}}var vt=class{constructor(t,o,n,r){B(this,"code");B(this,"size");B(this,"digest");B(this,"bytes");this.code=t,this.size=o,this.digest=n,this.bytes=r}};function Ln(e,t){let{bytes:o,version:n}=e;switch(n){case 0:return li(o,Me(e),t??at.encoder);default:return di(o,Me(e),t??Mt.encoder)}}var On=new WeakMap;function Me(e){let t=On.get(e);if(t==null){let o=new Map;return On.set(e,o),o}return t}var Bn,$t=class e{constructor(t,o,n,r){B(this,"code");B(this,"version");B(this,"multihash");B(this,"bytes");B(this,"/");B(this,Bn,"CID");this.code=o,this.version=t,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:o}=this;if(t!==Et)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(o.code!==hi)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(o)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:o}=this.multihash,n=It(t,o);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,o){let n=o;return n!=null&&t.code===n.code&&t.version===n.version&&En(t.multihash,n.multihash)}toString(t){return Ln(this,t)}toJSON(){return{"/":Ln(this)}}link(){return this}[(Bn=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let o=t;if(o instanceof e)return o;if(o["/"]!=null&&o["/"]===o.bytes||o.asCID===o){let{version:n,code:r,multihash:i,bytes:s}=o;return new e(n,r,i,s??zn(n,r,i.bytes))}else if(o[ui]===!0){let{version:n,multihash:r,code:i}=o,s=In(r);return e.create(n,i,s)}else return null}static create(t,o,n){if(typeof o!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(o!==Et)throw new Error(`Version 0 CID must use dag-pb (code: ${Et}) block encoding`);return new e(t,o,n,n.bytes)}case 1:{let r=zn(t,o,n.bytes);return new e(t,o,n,r)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Et,t)}static createV1(t,o){return e.create(1,t,o)}static decode(t){let[o,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return o}static decodeFirst(t){let o=e.inspectBytes(t),n=o.size-o.multihashSize,r=wt(t.subarray(n,n+o.multihashSize));if(r.byteLength!==o.multihashSize)throw new Error("Incorrect length");let i=r.subarray(o.multihashSize-o.digestSize),s=new vt(o.multihashCode,o.digestSize,i,r);return[o.version===0?e.createV0(s):e.createV1(o.codec,s),t.subarray(o.size)]}static inspectBytes(t){let o=0,n=()=>{let[k,A]=Pt(t.subarray(o));return o+=A,k},r=n(),i=Et;if(r===18?(r=0,o=0):i=n(),r!==0&&r!==1)throw new RangeError(`Invalid CID version ${r}`);let s=o,c=n(),d=n(),h=o+d,g=h-s;return{version:r,codec:i,multihashCode:c,digestSize:d,multihashSize:g,size:h}}static parse(t,o){let[n,r]=ci(t,o),i=e.decode(r);if(i.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Me(i).set(n,t),i}};function ci(e,t){switch(e[0]){case"Q":{let o=t??at;return[at.prefix,o.decode(`${at.prefix}${e}`)]}case at.prefix:{let o=t??at;return[at.prefix,o.decode(e)]}case Mt.prefix:{let o=t??Mt;return[Mt.prefix,o.decode(e)]}case Ft.prefix:{let o=t??Ft;return[Ft.prefix,o.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function li(e,t,o){let{prefix:n}=o;if(n!==at.prefix)throw Error(`Cannot string encode V0 in ${o.name} encoding`);let r=t.get(n);if(r==null){let i=o.encode(e).slice(1);return t.set(n,i),i}else return r}function di(e,t,o){let{prefix:n}=o,r=t.get(n);if(r==null){let i=o.encode(e);return t.set(n,i),i}else return r}var Et=112,hi=18;function zn(e,t,o){let n=kt(e),r=n+kt(t),i=new Uint8Array(r+o.byteLength);return xt(e,i,0),xt(t,i,n),i.set(o,r),i}var ui=Symbol.for("@ipld/js-cid/CID");var pi=new TextEncoder,Lc=new TextDecoder;var jn=512;function Gn(e){return pi.encode(JSON.stringify(e))}function Pe({name:e,code:t,encode:o}){return new Te(e,t,o)}var Te=class{constructor(t,o,n){B(this,"name");B(this,"code");B(this,"encode");this.name=t,this.code=o,this.encode=n}digest(t){if(t instanceof Uint8Array){let o=this.encode(t);return o instanceof Uint8Array?It(this.code,o):o.then(n=>It(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Fn(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var $n=Pe({name:"sha2-256",code:18,encode:Fn("SHA-256")}),jc=Pe({name:"sha2-512",code:19,encode:Fn("SHA-512")});var mi=async e=>{let t=Gn(e),o=await $n.digest(t);return $t.create(1,jn,o).toString()},Ut=mi;var gi=e=>{try{JSON.parse(e)}catch{return!1}return!0},Vt=gi;var Un=()=>document.title.split("|")[0],Ie=e=>{let t=Un();document.title=t.trim()+" | "+e.trim(),m(".title h3").html(e.trim())},Rt=()=>{let e=Un();document.title=e,m("title").innerHTML("\u270D\uFE0F MiroPad v3.1.15"),m(".title h3").innerHTML('\u270D\uFE0F MiroPad <span class="version">v3.1.15</span>')};var E={baseUrl:`${globalThis.location.origin}${globalThis.location.pathname}`,get:function(){return globalThis.location.href},getPageId:function(e=globalThis.location.href){return new URL(e).hash.slice(1).split("?")[0]||null},getSearchParams:function(e=globalThis.location.href){let n=new URL(e).href.split("?")[1]||"";return new URLSearchParams(n)},getParamsObject:function(e=globalThis.location.href){let t=this.getSearchParams(e),o={};for(let n of t.keys())o={...o,[n]:this.getSearchParam(n,e)};return o},getSearchParam(e,t=globalThis.location.href){return this.getSearchParams(t).get(e)},deleteParam:function(e){let t=this.getSearchParams();Array.isArray(e)?e.forEach(r=>{t.delete(r)}):t.delete(e);let{pathname:o}=globalThis.location,n=this.getPageId();return globalThis.location.assign(`${n?`#${n}`:o}${t.toString()?`?${t.toString()}`:""}`)},set:function(e=this.getPageId(),t=this.getParamsObject()){let o={...this.getParamsObject(),...t},n=new URLSearchParams(o);return globalThis.location.assign(`#${e}?${n.toString()}`)}};var ft=(e=!0)=>{e?(m("#save").removeClass("unsaved"),m("#logo").removeClass("unsaved")):(m("#save").addClass("unsaved"),m("#logo").addClass("unsaved"))};var Vn=e=>{let t=encodeURIComponent(e);if(t.length===0)throw new Error("You need to start with a valid title for your note!");return t},qt=e=>{let t=qn(e),o=V(t);if(o){let{dateCreated:n}=o;return n}throw new Error(`Note "${e}" cannot found!`)},bi=e=>{let t=V(e);t&&localStorage.setItem(e,JSON.stringify({title:t.title,deleted:!0,revisions:t.revisions}))},V=(e=E.getPageId(),t)=>{let o;try{if(o=JSON.parse(_.get(e)),!o.revisions)throw new Error("This is not a note!")}catch{return null}let n=o?Object.values(o.revisions).reduce((i,s)=>s.dateCreated>i.dateCreated?s:i,{dateCreated:0}):{},r=t?o.revisions[t]:n;return e?{...o,id:e,...r||{},numberOfRevisions:o&&o.revisions?Object.keys(o.revisions).length:void 0,title:o.title}:null},Rn=e=>{let t=V();t&&(_.update(t.id,{disableSync:e}),C.info(`"${t.title}" cloud sync ${e?"disabled \u{1F636}":"enabled \u26A1\uFE0F"}`))},Wt=(e=E.getPageId())=>{if(e){let t=E.getSearchParam("v")||void 0,o=V(void 0,t);o&&(m("#revisions").html(`${o.numberOfRevisions} revision${o.numberOfRevisions>1?"s":""}`),Ie(o.title),m(".terminal").setValue(o.text)),o||C.error("404 Note not found \u{1F937}\u200D\u2642\uFE0F")}},Ht=()=>{location.hash="",Rt(),m("#revisions").html(""),m(".terminal").setValue("").focus(),ft()},Ct=(e="")=>e.split(`
`)[0].trim().replace("#","").trim(),qn=e=>{let t=Ct(e);return Vn(t)},Wn=async e=>{if(e.length){let t=qn(e),o=Ct(e),n=V(t);if(n===null)return Jt(e);let{text:r}=n,i=await Ut(e),s=await Ut(r);if(i===s)return;let c=_.get(t),d=JSON.parse(c);_.set(t,JSON.stringify({...d,title:o,revisions:{...d&&d.revisions||{},[i]:{dateCreated:Date.now(),text:e}}}))}},Jt=async(e=m(".terminal").getValue())=>{if(await _.saveToDictionary(e),e.length){let t=await Ut(e);try{let o=e.split(`
`)[0].trim().replace("#","").trim();Ie(o);let n=Vn(o),r=_.get(n),i=JSON.parse(r);_.set(n,JSON.stringify({...i,title:o,lines:e.split(`
`),revisions:{...i&&i.revisions||{},[t]:{dateCreated:Date.now(),text:e}}})),E.set(n,{v:t}),_.set("lastLocalUpdate",new Date),C.success("\u{1F44C} Note saved!"),ft()}catch(o){C.error(`\u{1F631} Something went wrong while trying to save to local storage ${o}`)}}else C.warning("\u{1F615} Nothing to save!")},Z=({includeDeleted:e=!1}={})=>Object.entries(localStorage).filter(([,t])=>typeof t=="string").filter(([t,o])=>!t.startsWith("__")&&Vt(o)).map(([t,o])=>[t,JSON.parse(o)]).filter(([,t])=>!!t.title).reduce((t,[o])=>[...t,V(o)],[]).filter(({deleted:t})=>e?!0:!t),Hn=(e=null)=>e?Z().map(({id:o})=>V(o)).filter(o=>o!==null).filter(({text:o})=>o.toLowerCase().includes(e.toLowerCase()))[0]:void 0,Yt=()=>{if(confirm("Are you sure you want do that?")){let t=V();Ht(),t&&t.id&&(wn(t.id),bi(t.id))}L.hide()};var Jn=()=>!!_.get("authToken");var dt=({title:e,secondary:t,onclick:o,onSecondaryClick:n,icon:r},i=!1)=>{let s=document.createElement("LI");if(s.className=i?"selected":"",r){let h=r.cloneNode(!0);s.appendChild(h)}let c=bt(e)?e:document.createTextNode(e);c.onclick=o,s.appendChild(c);let d=document.createElement("span");if(t){d.className="secondary";let h=bt(t)?t:document.createTextNode(t);h.onclick=n,d.appendChild(h)}return s.appendChild(d),s};var Yn=(e,t)=>{let o=e.toLowerCase().split(t),n=0;return o.reduce((r,i,s)=>[...r,...s===0?[i]:[t,i]],[]).filter(r=>r!=="").map(r=>{n=n+r.length;let i=n-r.length,s=i+r.length;return e.slice(i,s)})};var Kn=e=>{let t=document.createElement("mark");return t.appendChild(document.createTextNode(e)),t},ct=({content:e="",highlight:t=""})=>{let o=document.createElement("div"),n=e.split(" "),r=t.toLowerCase().split(" ");return t.trim()===""?(o.appendChild(document.createTextNode(e)),o):(n.map(i=>{let s=r.map(c=>i.toLocaleLowerCase().includes(c)?c:void 0).filter(c=>c!==void 0);return{word:i,matches:s}}).forEach(({word:i,matches:s})=>{if(s.length>0){let c=s[0];if(i===c)o.appendChild(Kn(` ${i}`));else{let h=Yn(i,c).map(g=>g.toLowerCase()===c?Kn(g):document.createTextNode(g));o.appendChild(document.createTextNode(" ")),h.forEach(g=>{o.appendChild(g)})}}else o.appendChild(document.createTextNode(` ${i} `))}),o)};var Qn=()=>(C.info("You need to be authenticated!"),L.hide(),globalThis.location.replace(`https://github.com/login/oauth/authorize?client_id=${et.github.client_id}&scope=gist&state=${et.github.request_state}`)),Xn=async e=>{C.info("Downloading my Gists!");let t=await bn(e);L.setState({mode:L.getModes().gists}),C.info("Select Gist to sync with");let o=t.sort((r,i)=>new Date(i.updated_at).getTime()-new Date(r.updated_at).getTime()).map(({description:r,updated_at:i,id:s})=>({title:ct({content:`${r}(${s})`}),secondary:i,onclick:async()=>{await _.set("gistId",s),C.success(`${r}(${s}) selected for synchronization!`),Dt(),L.hide()}})),n=dt([{title:"Create a new Gist",onclick:async()=>{C.info("Syncing your MiroPads to a new Gist");try{let{id:r}=await xn();_.set("gistId",r),C.success("MiroPads synced to a new Gist \u{1F389}")}catch(r){C.error(r.message)}L.hide()}},...o]);m("#commands").html(""),m("#commands").append(n)},Dt=async(e=_.get("gistId"))=>{if(_.get("authToken")&&e){m("#logo").addClass("loading");let{files:o}=await Gt(e);Object.values(o).forEach(({content:n})=>{Wn(n)}),_.set("lastSync",new Date),C.success("\u2B07 MiroPad synced \u2705"),m("#logo").removeClass("loading")}},Zn=async()=>{let e=E.getSearchParam("code"),t=E.getSearchParam("state");if(e&&t){m("#logo").addClass("loading"),C.info("\u{1F510} Authenticating...");try{let{token:o}=await kn(e,t);_.set("authToken",o),C.info("\u26F3 You have been authenticated!"),E.deleteParam(["code","state"])}catch(o){C.error(o.message)}m("#logo").removeClass("loading")}};var wi=async(e="no-titled")=>{let t={suggestedName:`${e}`,types:[{description:"MiroPad text notes",accept:{"text/plain":[".miropad"]}}]};return await globalThis.showSaveFilePicker(t)},yi=async(e,t)=>{let o=await e.createWritable();await o.write(t),await o.close()},to=async(e,t)=>{try{let o=await wi(t);await yi(o,e)}catch{C.error("An error occurred trying to save the file.");return}},eo=(()=>{let e=document.createElement("a");return e.setAttribute("style","display: none"),e.setAttribute("id","download-to-file"),e.setAttribute("href","#"),document.body.appendChild(e),(t,o=`MiroPad-${new Date().toISOString()}.json`)=>{let n=JSON.stringify(t),r=new Blob([n],{type:"octet/stream"}),i=globalThis.URL.createObjectURL(r);e.href=i,e.download=o,e.click(),globalThis.URL.revokeObjectURL(i)}})();var fe=mn(Do()),me=e=>(0,fe.renderHTML)((0,fe.parse)(e,{warn:t=>console.log(t.render())}));var an=e=>{if(e.status.toString().slice(0,1)==="2")return e;throw new Error(e)},Rs=(e="")=>`<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
      <style>
      img {
        border-style: none;
        max-width: 100%;
        box-sizing: content-box;
      }
      </style>
    </head>
    <table style="width:100%;background-color:#ffffff" align="center" border="0" cellPadding="0" cellSpacing="0" role="presentation">
      <tbody>
        <tr>
          <td>
            <div><!--[if mso | IE]>
              <table role="presentation" width="100%" align="center" style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px;"><tr><td></td><td style="width:37.5em;background:#ffffff">
            <![endif]--></div>

            <div style="max-width:37.5em;margin:0 auto;padding:20px 0 48px;width:560px"><img alt="Theo Mironidis Logo" src="https://teomrd.github.io/miroFavicon.f0c5b85b.png" width="42" height="42" style="display:block;outline:none;border:none;text-decoration:none;width:42px;height:42px" />
              ${e}
              <hr style="width:100%;border:none;border-top:1px solid #eaeaea;border-color:#dfe1e4;margin:42px 0 26px" />
              <a target="_blank" style="color:#b4becc;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen-Sans,Ubuntu,Cantarell,&quot;Helvetica Neue&quot;,sans-serif;font-size:14px" href="https://teomrd.github.io">
              ${et.mail_service.signature}
              </a>
            </div>
            <div><!--[if mso | IE]>
            </td><td></td></tr></table>
            <![endif]--></div>
          </td>
        </tr>
      </tbody>
    </table>
  </html>`,qs=async(e,t,o="MiroPad note")=>{if(!e){C.error("\u{1F47B} No message to send, type something and try again! \u{1F913}");return}try{await fetch(`${et.mail_service.api}`,{method:"POST",headers:{"x-secret-token":_.get("MIROPAD_SECRET_TOKEN"),accept:"application/json","content-type":"application/json"},body:JSON.stringify({to:t,subject:o,html:Rs(e)})}).then(an).then(n=>n.json()),C.success("Email sent \u{1F680}")}catch{C.error("Error not went through \u{1F4A5}! Check your credentials and try again!")}},Ws=()=>{let e=_.get("mail");if(e){let n=globalThis.prompt(`Mail ${e} again? (y)es/(no)`,"yeap");if(n===null)return n;if(n.slice(0,1).toLowerCase()==="y")return e}let t=globalThis.prompt("Where do you wanna send the mail to?"),o=globalThis.prompt("Do you wanna save that to your preferences for later on? (y)es/(no)","yeap");return o&&o.slice(0,1).toLowerCase()==="y"&&_.set("mail",t),t},Lo=e=>{let t=Ws();if(t===null){C.info("Sending mail cancelled \u{1F636}");return}C.info("Sending mail... \u{1F680}");let o=Ct(e),n=me(e);qs(n,t,o)};var ht=async(e,t="\u{1F4CB} Copied to clipboard")=>{try{await navigator.clipboard.writeText(e),C.success(t)}catch(o){C.error(o.message)}};var ge=(e,t,o)=>{let n=gt(e)?e:[e],r=document.createElement("button");return r.setAttribute("type","button"),o&&r.setAttribute("id",o),n.forEach(i=>{typeof i=="string"?r.appendChild(document.createTextNode(i)):r.appendChild(i)}),r.onclick=i=>t(i),r};var Hs={view:m(".preview"),init:function(){return this.update(),m(".terminal").listen("input",()=>this.update()),!!E.getSearchParam("md")?this.view.show():this.view.hide(),this},autoLink:function(){let e=_.parse("__auto-links__");if(!e)return;let t=Object.keys(e).map(r=>`${r}\\w+`).join("|"),o=new RegExp(`(${t})`,"g"),n=this.view.el.innerHTML.replace(o,r=>{let i=Object.keys(e).find(c=>r.startsWith(c)),s=e[i];return s.startsWith("http")?`<a href="${s}${r}" target="_blank">${r}</a>`:`<a href="${s}${r}">${r}</a>`});this.view.innerHTML(n)},update:function(){let md=m(".terminal").getValue();this.view.innerHTML(me(md)),this.autoLink();let{elements}=m("pre");Array.prototype.slice.call(elements).forEach(e=>{let t=ge("\u{1F4CB} Copy",async o=>{o.stopPropagation();let n=o.srcElement.previousSibling.innerHTML;await ht(n,"\u{1F4CB} Code copied to clipboard")});e.appendChild(t)}),m("code").listenAll("click",({innerHTML})=>{let result=eval(innerHTML);m(".console").show().innerHTML(result)}),m(".console").listen("click",async e=>{e.srcElement.classList.add("hidden");let t=e.srcElement.innerHTML;await ht(t,"\u{1F4CB} Code copied to clipboard")})},show:function(e=!0){this.view.show(),E.set(void 0,{md:e})},hide:function(){this.view.hide(),E.deleteParam("md")},toggle:function(e="true"){return E.getSearchParam("md")===e?this.hide():this.show(e),this}},ut=Hs;var Js=e=>{let t=document.querySelector(e);if(Vt(t.value)){let o=JSON.stringify(JSON.parse(t.value),null,2);t.value=o,C.success("\u{1F44D} JSON value prettified")}else C.error("\u{1F627} Value is not in valid JSON format")},Oo=Js;var zo=(e=1e3)=>new Promise(t=>{setTimeout(t,e)});var U=(e,t,o)=>{let n=document.createElement("IMG");return o&&n.classList.add(o),t&&n.setAttribute("alt",t),n.setAttribute("src",e),n};var Bo="./list-LK7OCHR7.svg";var zt="./trash-RDL437QG.svg";var jo="./checkmark-circle-JQ7ADSUI.svg";var Go="./cloud-sync-F3RLGHML.svg";var Fo="./lighter-UBEI67LL.svg";var $o="./enter-down-6TVO6OFR.svg";var Uo="./download-FVXMIYZ4.svg";var Vo="./envelope-Z2VRVSLR.svg";var Ro="./bug-36UGMUXT.svg";var qo="./picture-3TDOSVS3.svg";var Wo="./printer-B7RMPYZC.svg";var Ho="./page-break-BLVP5QBQ.svg";var Jo="./frame-expand-CX6CNP53.svg";var Yo="./arrow-right-circle-2Q6EHM2H.svg";var Ko="./magic-wand-JQJ6EKRO.svg";var Qo="./rocket-AIY2RJJS.svg";var Xo="./spell-check-V6QYTGNT.svg";var Zo="./pencil-X3ZMY3QU.svg";var cn="./exit-up-GH6BPN2X.svg";var tr="./leaf-CGBE7XAJ.svg";var er=async()=>{try{let e=V(),t=E.get();await navigator.share({title:e?e.title:"\u270D\uFE0F MiroPad",text:e?e.text:"Temporary note keeping app for the browser",url:t})}catch(e){C.info(`${e.message}`)}};var ma=()=>{let e=_.get("gistId");return _.get("authToken")?e?"Sync: Notes with my GitHub Gist":"Sync: Pick your Gist to sync with":"Sync: Authorize your GitHub account for synchronisation"},ga={title:"Share note",icon:U(cn,"share note"),sortTitle:"Share",call:er},ba={title:"Share public link",key:null,icon:U(cn,"share public link"),sortTitle:"Share public link",call:async()=>{L.hide(),await Jt(m(".terminal").getValue());let e=V();if(e){let o=(await vn({note:e})).history[0].url,n=await fetch(o).then(g=>g.json()),{files:r}=n,i=Object.values(r),[s]=i,{raw_url:c}=s,d=`${E.baseUrl}?raw=${c}`;ht(d,"MiroPad public link copied to clipboard \u{1F4CB}!")}}},ln=()=>[{title:"New note",icon:U(Zo,"new note"),sortTitle:"New",key:"n",call:Ht},{title:"Save",key:"s",icon:U(jo,"save note"),sortTitle:"Save",call:async()=>{L.hide(),await Jt(m(".terminal").getValue());let e=V();e&&!e.disableSync&&yn([e]),ft()}},...navigator.share?[ga]:[],{title:"Toggle MarkDown Viewer",icon:U(Ho,"toggle markdown viewer","rotate90"),sortTitle:"Split",key:"m",call:()=>{ut.toggle(),L.hide()}},{title:"Full MarkDown view",icon:U(Jo,"full view mode"),sortTitle:"Full view",key:"shift m",call:()=>{ut.toggle("full"),L.hide()}},...Jn()?[ba]:[],{title:"Zen mode",icon:U(tr,"switch to zen mode"),sortTitle:"Zen mode",key:"shift z",call:()=>{!!E.getSearchParam("zen")?E.deleteParam("zen"):E.set(void 0,{zen:!0}),L.hide()}},{title:"List saved notes",icon:U(Bo,"list notes"),sortTitle:"Notes",key:"p",call:()=>L.toggle(L.getModes().notes)},{title:"Delete note",key:"shift d",icon:U(zt,"delete note"),sortTitle:"Delete",call:Yt},{title:ma(),icon:U(Go,"sync with github"),key:null,call:async()=>{let e=_.get("authToken");if(!e)return Qn();if(!_.get("gistId"))return await Xn(e);L.hide(),await Dt()}},{title:"Sync: Reset Gist settings",icon:U(Fo,"reset github settings"),key:null,call:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("gistId"),localStorage.removeItem("lastLocalUpdate"),localStorage.removeItem("lastSync"),C.info("Gist setting have been reset!"),L.hide()}},{title:"Toggle sidebar",experimental:!0,key:"shift l",call:()=>{m("aside").toggle()}},{title:"Save to File System...",experimental:!0,icon:U($o,"save file"),key:"shift s",call:()=>{let e=V();if(e){let{text:t,title:o}=e;to(t,o),L.hide()}}},{title:"Email note to...",experimental:!0,icon:U(Vo,"email"),key:"e",call:()=>{let e=m(".terminal").getValue();Lo(e),L.hide()}},{title:"Toggle experimental features",experimental:!1,icon:U(Ro,"lab"),key:null,call:()=>{let e=!!_.get("__experimental__");e?_.remove("__experimental__"):_.set("__experimental__",!0),C.showNotification(`Experimental features turned ${e?"off":"on"}`),L.hide()}},{title:"Toggle Autocompletion",experimental:!1,icon:U(Yo,"autocompletion"),key:null,call:()=>{let e=!!_.get("__autocomplete__");e?_.remove("__autocomplete__"):_.set("__autocomplete__",!0),C.showNotification(`Autocomplete feature turned ${e?"off":"on"}`),L.hide(),m(".terminal").focus()}},{title:"Add a cover picture",experimental:!0,icon:U(qo,"cover picture"),key:null,call:async()=>{let e=prompt("Paste the image URL in here...");L.hide(),await zo(200),ht(`<div class="cover" style="background-image: url('${e}')"></div>`,"\u{1F44C}Copied! Paste the code on the MiroPad editor"),m(".terminal").focus(),C.info("Paste the cover picture wherever you prefer on the MirPad editor")}},{title:"Print MarkDown output",experimental:!0,icon:U(Wo,"print"),key:null,call:()=>{m(".preview").show(),ut.init(),globalThis.print(),L.hide()}},{key:"j",title:"Prettify JSON document",icon:U(Ko,"prettify json"),call:()=>{Oo(".terminal"),L.hide()}},{title:"Toggle command palette",icon:U(Qo,"toggle command palette"),key:["shift p","k"],call:()=>L.toggle(L.getModes().commands)},{title:"Find and Replace...",experimental:!0,icon:U(Xo,"find and replace"),key:"shift f",call:()=>{let e=m(".terminal").getValue().slice(m(".terminal").el.selectionStart,m(".terminal").el.selectionEnd),t=prompt("What do you wanna find?",e);if(!t)return C.info("Value not found");let o=m(".terminal").getValue().indexOf(t);m(".terminal").el.setSelectionRange(o,o+t.length);let n=prompt(`Replace ${t} with...`);n&&m(".terminal").el.setRangeText(n)}},{title:"Download all notes!",icon:U(Uo,"Download all notes on your local file system"),call:()=>{let e=Z({includeDeleted:!0});eo(e),L.hide()}},{title:"Permanently delete ALL notes \u2757",icon:U(zt,"delete note"),call:()=>{confirm("Are you sure you want do delete ALL your notes?")&&(Z({includeDeleted:!0}).forEach(o=>{_.remove(o.id)}),Ht()),L.hide()}}];var wa={events:[],on(e,t){return Array.isArray(e)?(e.forEach(o=>{let n=o.key||o,r=o.call||t;this.on(n,r)}),this):(e&&typeof e=="string"&&t&&typeof t=="function"&&(this.events=[...this.events,{key:e.includes("shift")?e.replace("shift","").trim():e,shift:e.includes("shift"),fn(){t()}}]),this)},listen(){return document.addEventListener("keydown",e=>{this.handleEvent(e)}),this},handleEvent(e){this.events.map(t=>(t.key===e.key&&(e.ctrlKey===!0||e.metaKey===!0)&&e.shiftKey===t.shift&&(e.preventDefault(),t.fn()),!0))}},nr=wa;var or=(e,t)=>{let o=document.createElement("a");return o.href=t,o.appendChild(bt(e)?e:document.createTextNode(e)),o};var dn=(e,t=new Date)=>{let o=new Date(e).getFullYear(),n=new Date(t).getFullYear();return o===n},sr=(e,t=new Date)=>{let o=new Date(e).getMonth(),n=new Date(t).getMonth();return o===n},ya=(e,t=new Date)=>{let o=new Date(e).getDate(),n=new Date(t).getDate();return o===n},rr=(e,t=new Date)=>dn(e,t)&&sr(e,t)&&ya(e,t),xa=["January","February","March","April","May","June","July","August","September","October","November","December"],ka=xa.map(e=>e.slice(0,3)),ir=(e=new Date)=>{let t=new Date(e),o=new Date().getDate()-1;return sr(t)&&dn(t)&&t.getDate()===o},Bt=e=>{let t=new Date(e),o=ir(e)?"":ka[t.getMonth()],n=dn(t)?"":t.getFullYear(),r=ir(t)?"Yesterday":t.getDate();return`${rr(t)?"":`${r} ${o} ${n}`} ${rr(t)?t.toLocaleTimeString():""}`};var ar=e=>e.reduce((o,n)=>{if(o.length===0)return[n];let r=Math.max(...o);return[...o,...n>=r?[n]:[]]},[]).length===e.length;var hn=(e,t)=>{let o=e.split(" ").map(i=>i.toLowerCase()),r=t.split(" ").map(i=>i.toLowerCase()).map(i=>o.map((d,h)=>d.includes(i)?h:-1).reduce((d,h)=>h>-1?h:d,-1));return r.includes(-1)?!1:ar(r)};var cr=()=>globalThis.Notification.requestPermission(),lr=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(`${globalThis.location.pathname.slice(-1)==="/"?globalThis.location.pathname:`${globalThis.location.origin}/`}service-worker.js?v=v3.1.15`)};var dr=e=>Array.isArray(e)?e.map(t=>dr(t)).join(", "):e?`\u2318+${e.toUpperCase()}`:"",va=(()=>{let e;(c=>(c.off="off",c.notes="notes",c.revisions="revisions",c.commands="commands",c.gists="gists"))(e||(e={}));let t={input:"",mode:"off",options:{selected:0,length:0}};return{getState:function(){return t},getModes:function(){return e},setState:function(o){return t={...t,...o},t},show:function(o="commands"){switch(m("#commander").show(),m("#commander input").focus(),o){case"commands":this.generateCommands(),m("#commander input").setValue("> "),this.setState({mode:"commands"});break;case"notes":this.generateNotes(),m("#commander input").setValue(""),this.setState({mode:"notes"});break;case"revisions":this.generateRevisions(),m("#commander input").setValue(""),this.setState({mode:"revisions"});break;default:break}return this},hide:function(){return m("#commander").hide(),t.mode="off",this},toggle:function(o){return cr(),t.mode==="off"||t.mode!==o?this.show(o):this.hide(),this},commands:function(){return ln()},selectOption:function(o="down"){let n=t.options.selected,r=t.options.length-1,d=o==="down"?n===r?0:n+1:n===0?r:n-1;t.options={...t.options,selected:d}},initCommander:function(){return ln().slice(0,5).map(o=>{m(".mobile-dock").append(ge([o.icon,document.createTextNode(o.sortTitle)],o.call,o.title.toLowerCase().replace(/\s/g,"-")))}),m("#commander button").listen("click",()=>{this.hide()}),m("#commander input").listen("keydown",o=>{o.keyCode===40&&(t.mode==="revisions"&&m("#commands li.selected").click(),this.selectOption("down")),o.keyCode===38&&(t.mode==="revisions"&&m("#commands li.selected").click(),this.selectOption("up"))}).listen("keyup",o=>{o.keyCode===13&&(t.mode==="commands"?m("#commands li.selected div").click():m("#commands li.selected a").click()),o.keyCode===27&&m(".terminal").focus();let n=o.target;t.input!==n.value&&(t.options.selected=0),t.input=n.value,this.generateOptions(n.value)}),this},init:function(){return this.initCommander(),nr.listen().on(this.commands()),m(".menu").listen("click",()=>this.toggle()),m("#revisions").listen("click",()=>this.generateRevisions()),this},generateRevisions:function(){this.show(),t.mode="revisions";let o=V();if(o){let{revisions:n}=o,r=t.options.selected,i=Object.keys(n).sort((s,c)=>{let{dateCreated:d}=n[s],{dateCreated:h}=n[c];return h-d}).map((s,c)=>({title:ct({content:`...${s.slice(-10)}`}),secondary:`${Bt(n[s].dateCreated)}`,onclick:()=>{E.set(void 0,{v:s}),t.options.selected=c,this.generateRevisions()}})).map((s,c)=>dt(s,c===r));m("#commands").html(i),t.options={...t.options,length:i.length}}return this},generateOptions:function(o){switch(t.mode){case"commands":case"notes":o.slice(0,1)===">"?(t.mode="commands",this.generateCommands(o.slice(1).trim()),m("#commander input").placeholder("Search for commands...")):(t.mode="notes",this.generateNotes(o));return;case"revisions":return this.generateRevisions();case"off":break;default:break}},generateNotes:function(o=""){let n=t.options.selected,r=Z().filter(({title:i})=>hn(i,o)).filter(({id:i,deleted:s})=>!s&&i!==E.getPageId()).sort((i,s)=>{let c=qt(i.title);return qt(s.title)-c}).map(({id:i,title:s},c)=>{let d=qt(s),h=`${globalThis.location.origin}${globalThis.location.pathname}#${i}`,g=or(ct({content:s,highlight:o}),h);return dt({title:g,secondary:Bt(d),onclick:()=>{this.hide(),m(".terminal").focus()}},c===n)});return m("#commands").html(r),m("#commander input").placeholder(`Search from ${r.length} saved notes...`),t.options={...t.options,length:r.length},this},generateCommands:function(o=""){let n=t.options.selected,r=this.commands().filter(({title:i})=>hn(i,o)).filter(({experimental:i=!1})=>_.get("__experimental__")?!0:!i).map(({title:i,key:s,call:c,icon:d},h)=>dt({title:ct({content:i,highlight:o}),icon:d,secondary:dr(s),onclick:c},h===n));return m("#commands").html(r),t.options={...t.options,length:r.length},this}}})(),L=va;var hr="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var ur=(e=21)=>{let t="",o=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=hr[o[e]&63];return t};var fr=mn(pr());var Ca=e=>{let t=e.replace(/[\r\n\t]+/g,"").toLowerCase();return jt.getMatchingWords(t)},un=(e,t)=>{let o="",n=t-1;do{let r=e[n]||"";n=r.trim()===""?-1:n-1,o=r.trim()!==""?`${r}${o}`:o}while(n>=0);return o},pn=e=>{let t=(0,fr.default)(e,e.selectionEnd),{top:o,left:n}=t,r=m(".terminal").el.scrollHeight,i=m("main").el;i.style.height=`${r}px`,m(".suggestion").el.style.top=`${o}px`,m(".suggestion").el.style.left=`${n}px`},fn=(e,t)=>e[t]===void 0||e[t].trim()==="",mr=e=>{let t=e.target.selectionEnd,o=D.el.getValue(),n=o[t-1];if(e.inputType==="deleteContentBackward"||n===" ")return D.setState({prediction:null,currentWord:null}),m(".suggestion").hide();let r=un(o,t);if(e.inputType==="insertText"&&fn(o,t)&&!r.startsWith("#")){pn(e.target);let s=Ca(r),[c]=s,d=c||"";D.setState({prediction:d,currentWord:r,matches:s.slice(0,10),options:{selected:0,length:s.length}});let h=D.getState();h.currentWord&&h.prediction&&h.currentWord.length>1?(D.renderInlineSuggestion(),D.renderOptions()):m(".suggestion").hide()}};var gr=(e,t)=>e.split(`
`).reduce((r,i)=>{let{isFound:s}=r;if(s)return r;let c=`${r.text}${i}
`,d=c.length;return t>=d?{text:c,isFound:!1}:{text:i,isFound:!0}},{text:"",isFound:!1}).text;var br=e=>{let t=gr(e.target.value,e.target.selectionEnd),o={"* [":`
* [] `,"* ":`
* `," * [":`
 * [] `," * ":`
 * `};for(let[n,r]of Object.entries(o))if(t.startsWith(n)){e.preventDefault(),m(".terminal").insertAtCaret(r);break}};var wr=e=>{let t=e.target;if(!t)return;let o=t.selectionEnd,n=D.el.getValue(),r=n[o-1];if(e.inputType==="deleteContentBackward"||r===" ")return D.setState({prediction:null,currentWord:null}),m(".suggestion").hide();let i=un(n,o);if(i.startsWith("#")&&e.inputType==="insertText"&&fn(n,o)){pn(e.target);let c=Z().map(M=>M.id),d=i.slice(1),h=c.filter(M=>M.startsWith(d)),[g]=h,k=g,A=d;D.setState({prediction:k,currentWord:A,matches:h.slice(0,10),options:{selected:0,length:h.length}});let I=D.getState();I.currentWord&&I.prediction&&I.currentWord.length>1?(D.renderInlineSuggestion(),D.renderOptions()):m(".suggestion").hide()}};var D=(()=>{let e={matches:[],currentWord:null,prediction:null,options:{selected:0,length:0}},t=e;return{el:m(".terminal"),getState:function(){return t},setState:function(o){return t={...t,...o},t},resetState:function(){D.setState(e)},selectOption:function(o="down"){let n=t.options.selected,r=t.options.length-1,d=o==="down"?n===r?0:n+1:n===0?r:n-1;t.options={...t.options,selected:d},D.setState({prediction:t.matches[t.options.selected]}),D.renderInlineSuggestion(),D.renderOptions()},acceptCompletion:o=>{let n=(s,c)=>{let d=s.toLowerCase().replace(c.toLowerCase(),"");d?m(".terminal").insertAtCaret(`${d} `):m(".terminal").insertAtCaret("  "),m(".suggestion").hide(),D.resetState()},{prediction:r,currentWord:i}=t;if(o&&i)return n(o,i);r&&i&&(n(r,i),jt.insert(r))},renderInlineSuggestion:()=>{let{prediction:o,currentWord:n}=t;if(o&&n){let r=ct({content:`${o.slice(n.length)}`});r.setAttribute("id","inlineSuggestion"),m(".suggestion").show().html(r)}},renderOptions:()=>{let o=m(".suggestion .options");o&&o.el&&o.el.remove();let n=t.options.selected,r=t.matches.map((s,c)=>dt({title:ct({content:s}),secondary:U(zt,"delete word"),onSecondaryClick:()=>{_.removeFromDictionary(s),D.setState({matches:t.matches.filter(d=>d!==s)}),D.renderOptions()},onclick:()=>{D.acceptCompletion(s)},icon:null},c===n)),i=document.createElement("ul");i.classList.add("options"),i.classList.add("frost"),r.forEach(s=>i.append(s)),m(".suggestion").el.append(i)},onFocus:()=>{L.hide(),m(".note-info").hide()},onInput:o=>{!!_.get("__autocomplete__")&&mr(o),wr(o)},onArrowDown:o=>{t.matches.length>0&&(o.preventDefault(),D.selectOption("down"))},onArrowUp:o=>{t.matches.length>0&&(o.preventDefault(),D.selectOption("up"))},onEnter:o=>{t.matches.length>0&&(o.preventDefault(),D.acceptCompletion()),br(o)},onEscape:()=>{D.resetState(),m(".suggestion").hide()},onTab:o=>{o.preventDefault(),D.acceptCompletion()},onKeyDown:o=>{o.keyCode===13&&D.onEnter(o),o.keyCode===40&&D.onArrowDown(o),o.keyCode===38&&D.onArrowUp(o),o.keyCode===9&&D.onTab(o),o.keyCode===32&&D.setState({prediction:""}),o.keyCode===27&&D.onEscape()},onKeyUp:o=>{let n=V(),r=Ct(o.target.value);m(".title h3").html(r);let{text:i=""}=n||{},s=!!(n&&D.el.getValue()===i);ft(s)},onPaste:async()=>{var n;let o=await navigator.clipboard.read();for(let r of o){let i=(n=r.types)==null?void 0:n.filter(s=>s.startsWith("image/"));for(let s of i){let c=await r.getType(s),d=_.get("MIROPAD_SECRET_TOKEN");if(d){let[h,g]=s.split("/"),k=`${ur()}.${g}`;m("#logo").addClass("loading");try{let{url:A}=await fetch(`${et.file_service.api}?fileName=${k}`,{method:"POST",headers:{"x-secret-token":d,accept:"application/json","content-type":"application/octet-stream"},body:c}).then(an).then(I=>I.json());m(".terminal").insertAtCaret(`![image](${A})`)}catch(A){console.error(A),C.error("Uploading file failed \u{1F4A5}!")}m("#logo").removeClass("loading")}else{let h=URL.createObjectURL(c);m(".terminal").insertAtCaret(`![image](${h})`)}ut.update()}}},init:function(){this.el.listen("focus",this.onFocus).listen("input",this.onInput).listen("keydown",this.onKeyDown).listen("keyup",this.onKeyUp).listen("paste",this.onPaste)}}})();var yr=()=>{let{authToken:e,gistId:t}=_.get(["authToken","gistId"]);return!!(e&&t)};var _a=e=>Object.entries(e).reduce((t,[o,n])=>{let r=t[n]||[];return{...t,[`${n}`]:[o,...r]}},{}),xr=()=>({char:null,children:{},frequency:0,hasChildren:function(){return Object.keys(this.children).length>0},isWord:function(){return this.frequency>0},contains:function(e){return Object.keys(this.children).includes(e)},getWords:function(e,t={}){let o=this;if(o.isWord()&&(t={...t,[e]:this.frequency}),o.hasChildren())for(let n of Object.values(o.children))t=n.getWords(`${e}${n.char}`,t);return t},increaseFrequency:function(){this.frequency=this.frequency+1},insert:function(e){let[t,...o]=e;if(t){let n=o.length===0;if(this.contains(t)){let r=this.children[t];return r.char=t,n&&r.increaseFrequency(),r.insert(o.join(""))}else return this.insertNode(t,n).insert(o.join(""))}},insertNode:function(e,t=!1){let o=xr();return t&&o.increaseFrequency(),o.char=e,this.children={...this.children,[e]:o},o}}),kr=()=>{let e=xr();return{insert:function(t=[]){return(Array.isArray(t)?t:[t]).forEach(n=>e.insert(n)),this},search:function(t=""){let o=e;return t.split("").forEach(n=>{o&&(o=o.children[n])}),o?o.getWords(t):{}},getMatchingWords:function(t=""){let o=_a(this.search(t));return Object.keys(o).sort((n,r)=>parseInt(r,10)-parseInt(n,10)).flatMap(n=>o[n].sort())}}};var Sa=e=>{let{message:t="Unexpected error occurred!"}=e;C.error(t)},vr=Sa;var Aa=async e=>{if(e){let t=await fetch(e).then(o=>{if(o.ok)return o.text();throw new Error(`Remote note could not be retrieved! code: ${o.status}`)});m(".terminal").setValue(t)}},Na=async e=>{if(e)try{let t=await Gt(e),{files:o}=t,n=Object.values(o),[r]=n,{content:i}=r;m(".terminal").setValue(i)}catch{C.error("MiroPad note not found! \u{1F937}\u200D\u2642\uFE0F")}},Cr=async e=>{try{let{oldURL:r,newURL:i}=e,s=E.getPageId(r),c=E.getPageId(i),d=s!==c,{v:h}=E.getParamsObject(r),{v:g}=E.getParamsObject(i);[d,h!==g].some(z=>z)&&Wt();let{gistId:I,raw:M}=E.getParamsObject(i);await Na(I),await Aa(M)}catch(r){r instanceof Error?C.error(r.message):C.error("An unknown error occurred")}let t=!E.getPageId();m("#note-info-button").show(!t),m("#new-note").disable(t),E.getSearchParam("md")==="full"?m(".terminal").hide():m(".terminal").show(),E.getSearchParam("zen")==="true"?m(".header").hide():m(".header").show(),m(".note-info").hide();let o=E.getSearchParam("q"),n=Hn(o);n&&m(".terminal").setValue(n.text)};var _r=()=>{m(".task-list-item").listenAll("click",e=>{e.firstChild.checked=!e.firstChild.checked})};var jt=kr(),Ma=()=>{m("#note-info-close").listen("click",()=>{m(".note-info").hide()}),m("#note-info-button").listen("click",()=>{let e=V();if(m(".note-info").show(),m(".note-info .details").innerHTML(`<p>
      <label>
      Title
      </label>
      ${e.title}
      </p>
      <p>
        <label>
        Modified
        </label>
        ${Bt(e.dateCreated)}
      </p>
      <p>
        <label>
        No. of revisions
        </label>
        ${e.numberOfRevisions}
      </p>
      `),yr()&&e){let n=(()=>{let{disableSync:r}=e,i=document.createElement("P");return i.innerHTML=`
          <label>Sync</label>
            <label class="switch" title="Cloud Sync">
              <input id="sync" type="checkbox" ${!r&&"checked"}>
            <span class="slider round"></span>
          </label>
        `,i})();m(".note-info .details").append(n),m("#sync").listen("click",r=>{Rn(!r.target.checked)})}let o=(()=>{let n=document.createElement("P");return n.innerHTML=`
          <button
            class="icon-button"
            type="button"
            id="delete-note"
          >
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="-3 -3 27.5 27.5">
              <path  d="M15.5 2h-3.5v-0.5c0-0.827-0.673-1.5-1.5-1.5h-2c-0.827 0-1.5 0.673-1.5 1.5v0.5h-3.5c-0.827 0-1.5 0.673-1.5 1.5v1c0 0.652 0.418 1.208 1 1.414v12.586c0 0.827 0.673 1.5 1.5 1.5h10c0.827 0 1.5-0.673 1.5-1.5v-12.586c0.582-0.206 1-0.762 1-1.414v-1c0-0.827-0.673-1.5-1.5-1.5zM8 1.5c0-0.276 0.224-0.5 0.5-0.5h2c0.276 0 0.5 0.224 0.5 0.5v0.5h-3v-0.5zM14.5 19h-10c-0.276 0-0.5-0.224-0.5-0.5v-12.5h11v12.5c0 0.276-0.224 0.5-0.5 0.5zM16 4.5c0 0.276-0.224 0.5-0.5 0.5h-12c-0.276 0-0.5-0.224-0.5-0.5v-1c0-0.276 0.224-0.5 0.5-0.5h12c0.276 0 0.5 0.224 0.5 0.5v1z"></path>
              <path  d="M12.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M9.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
              <path  d="M6.5 7c-0.276 0-0.5 0.224-0.5 0.5v10c0 0.276 0.224 0.5 0.5 0.5s0.5-0.224 0.5-0.5v-10c0-0.276-0.224-0.5-0.5-0.5z"></path>
            </svg>
            Delete
          </button>
        `,n})();m(".note-info .details").append(o),m("#delete-note").listen("click",()=>{Yt()})})},Ta=async()=>{let e=_.getDictionary();jt.insert(e),globalThis.addEventListener("error",vr),gn(),L.init(),Ma(),D.init(),Rt(),Wt(E.getPageId()),m(".logo").listen("click",()=>{L.toggle(L.getModes().notes)}),m("#permalink").listen("click",async()=>{await ht(E.get())}),ut.init(),globalThis.addEventListener("hashchange",Cr),lr(),_r(),await Dt(),await Zn()},Sr=Ta;Sr();
//# sourceMappingURL=index.js.map
